<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Parley-svn] r457 - / tags tags/parley-0.55 tags/parley-0.55/db tags/parley-0.55/doc tags/parley-0.55/lib tags/parley-0.55/lib/Parley tags/parley-0.55/lib/Parley/App tags/parley-0.55/lib/Parley/App/Communication tags/parley-0.55/lib/Parley/Controller tags/parley-0.55/lib/Parley/Controller/User tags/parley-0.55/lib/Parley/Model tags/parley-0.55/lib/Parley/Schema tags/parley-0.55/lib/Parley/View tags/parley-0.55/lib/Template tags/parley-0.55/lib/Template/Plugin tags/parley-0.55/lib/Text tags/parley-0.55/lib/Text/Search tags/parley-0.55/root tags/parley-0.55/root/base tags/parley-0.55/root/base/about tags/parley-0.55/root/base/error tags/parley-0.55/root/base/forum tags/parley-0.55/root/base/help tags/parley-0.55/root/base/menu tags/parley-0.55/root/base/menu/left tags/parley-0.55/root/base/my tags/parley-0.55/root/base/post tags/parley-0.55/root/base/search tags/parley-0.55/root/base/shared tags/parley-0.55/root/base/thread tags/parley-0.55/root/base/user tags/parley-0.55/root/bas! e/user/lostpassword tags/parley-0.55/root/base/user/signup tags/parley-0.55/root/css tags/parley-0.55/root/css/images tags/parley-0.55/root/email_templates tags/parley-0.55/root/static tags/parley-0.55/root/static/images tags/parley-0.55/root/static/images/filetypes tags/parley-0.55/root/static/magic tags/parley-0.55/root/static/magic/src tags/parley-0.55/root/static/magic/src/animation tags/parley-0.55/root/static/magic/src/cal tags/parley-0.55/root/static/magic/src/charting tags/parley-0.55/root/static/magic/src/charting/svg tags/parley-0.55/root/static/magic/src/charting/vml tags/parley-0.55/root/static/magic/src/collections tags/parley-0.55/root/static/magic/src/crypto tags/parley-0.55/root/static/magic/src/data tags/parley-0.55/root/static/magic/src/data/core tags/parley-0.55/root/static/magic/src/data/old tags/parley-0.55/root/static/magic/src/data/old/format tags/parley-0.55/root/static/magic/src/data/old/provider tags/parley-0.55/root/static/magic/src/date tags/parl! ey-0.55/root/static/magic/src/debug tags/parley-0.55/root/stat! ic/magic
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/parley-svn/2007-August/index.html" >
   <LINK REL="made" HREF="mailto:parley-svn%40lists.berlios.de?Subject=Re%3A%20%5BParley-svn%5D%20r457%20-%20/%20tags%20tags/parley-0.55%20tags/parley-0.55/db%0A%20tags/parley-0.55/doc%20tags/parley-0.55/lib%20tags/parley-0.55/lib/Parley%0A%20tags/parley-0.55/lib/Parley/App%0A%20tags/parley-0.55/lib/Parley/App/Communication%0A%20tags/parley-0.55/lib/Parley/Controller%0A%20tags/parley-0.55/lib/Parley/Controller/User%0A%20tags/parley-0.55/lib/Parley/Model%20tags/parley-0.55/lib/Parley/Schema%0A%20tags/parley-0.55/lib/Parley/View%20tags/parley-0.55/lib/Template%0A%20tags/parley-0.55/lib/Template/Plugin%20tags/parley-0.55/lib/Text%0A%20tags/parley-0.55/lib/Text/Search%20tags/parley-0.55/root%0A%20tags/parley-0.55/root/base%20tags/parley-0.55/root/base/about%0A%20tags/parley-0.55/root/base/error%20tags/parley-0.55/root/base/forum%0A%20tags/parley-0.55/root/base/help%20tags/parley-0.55/root/base/menu%0A%20tags/parley-0.55/root/base/menu/left%20tags/parley-0.55/root/base/my%0A%20tags/parley-0.55/root/base/post%20tags/parley-0.55/root/base/search%0A%20tags/parley-0.55/root/base/shared%20tags/parley-0.55/root/base/thread%0A%20tags/parley-0.55/root/base/user%20tags/parley-0.55/root/bas%21%0A%20e/user/lostpassword%20tags/parley-0.55/root/base/user/signup%0A%20tags/parley-0.55/root/css%20tags/parley-0.55/root/css/images%0A%20tags/parley-0.55/root/email_templates%20tags/parley-0.55/root/static%0A%20tags/parley-0.55/root/static/images%0A%20tags/parley-0.55/root/static/images/filetypes%0A%20tags/parley-0.55/root/static/magic%20tags/parley-0.55/root/static/magic/src%0A%20tags/parley-0.55/root/static/magic/src/animation%0A%20tags/parley-0.55/root/static/magic/src/cal%0A%20tags/parley-0.55/root/static/magic/src/charting%0A%20tags/parley-0.55/root/static/magic/src/charting/svg%0A%20tags/parley-0.55/root/static/magic/src/charting/vml%0A%20tags/parley-0.55/root/static/magic/src/collections%0A%20tags/parley-0.55/root/static/magic/src/crypto%0A%20tags/parley-0.55/root/static/magic/src/data%0A%20tags/parley-0.55/root/static/magic/src/data/core%0A%20tags/parley-0.55/root/static/magic/src/data/old%0A%20tags/parley-0.55/root/static/magic/src/data/old/format%0A%20tags/parley-0.55/root/static/magic/src/data/old/provider%0A%20tags/parley-0.55/root/static/magic/src/date%20tags/parl%21%0A%20ey-0.55/root/static/magic/src/debug%20tags/parley-0.55/root/stat%21%20ic/magic&In-Reply-To=%3C200708311919.l7VJJo00016373%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000342.html">
   <LINK REL="Next"  HREF="000344.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Parley-svn] r457 - / tags tags/parley-0.55 tags/parley-0.55/db tags/parley-0.55/doc tags/parley-0.55/lib tags/parley-0.55/lib/Parley tags/parley-0.55/lib/Parley/App tags/parley-0.55/lib/Parley/App/Communication tags/parley-0.55/lib/Parley/Controller tags/parley-0.55/lib/Parley/Controller/User tags/parley-0.55/lib/Parley/Model tags/parley-0.55/lib/Parley/Schema tags/parley-0.55/lib/Parley/View tags/parley-0.55/lib/Template tags/parley-0.55/lib/Template/Plugin tags/parley-0.55/lib/Text tags/parley-0.55/lib/Text/Search tags/parley-0.55/root tags/parley-0.55/root/base tags/parley-0.55/root/base/about tags/parley-0.55/root/base/error tags/parley-0.55/root/base/forum tags/parley-0.55/root/base/help tags/parley-0.55/root/base/menu tags/parley-0.55/root/base/menu/left tags/parley-0.55/root/base/my tags/parley-0.55/root/base/post tags/parley-0.55/root/base/search tags/parley-0.55/root/base/shared tags/parley-0.55/root/base/thread tags/parley-0.55/root/base/user tags/parley-0.55/root/bas! e/user/lostpassword tags/parley-0.55/root/base/user/signup tags/parley-0.55/root/css tags/parley-0.55/root/css/images tags/parley-0.55/root/email_templates tags/parley-0.55/root/static tags/parley-0.55/root/static/images tags/parley-0.55/root/static/images/filetypes tags/parley-0.55/root/static/magic tags/parley-0.55/root/static/magic/src tags/parley-0.55/root/static/magic/src/animation tags/parley-0.55/root/static/magic/src/cal tags/parley-0.55/root/static/magic/src/charting tags/parley-0.55/root/static/magic/src/charting/svg tags/parley-0.55/root/static/magic/src/charting/vml tags/parley-0.55/root/static/magic/src/collections tags/parley-0.55/root/static/magic/src/crypto tags/parley-0.55/root/static/magic/src/data tags/parley-0.55/root/static/magic/src/data/core tags/parley-0.55/root/static/magic/src/data/old tags/parley-0.55/root/static/magic/src/data/old/format tags/parley-0.55/root/static/magic/src/data/old/provider tags/parley-0.55/root/static/magic/src/date tags/parl! ey-0.55/root/static/magic/src/debug tags/parley-0.55/root/stat! ic/magic</H1>
    <B>chiselwright at BerliOS</B> 
    <A HREF="mailto:parley-svn%40lists.berlios.de?Subject=Re%3A%20%5BParley-svn%5D%20r457%20-%20/%20tags%20tags/parley-0.55%20tags/parley-0.55/db%0A%20tags/parley-0.55/doc%20tags/parley-0.55/lib%20tags/parley-0.55/lib/Parley%0A%20tags/parley-0.55/lib/Parley/App%0A%20tags/parley-0.55/lib/Parley/App/Communication%0A%20tags/parley-0.55/lib/Parley/Controller%0A%20tags/parley-0.55/lib/Parley/Controller/User%0A%20tags/parley-0.55/lib/Parley/Model%20tags/parley-0.55/lib/Parley/Schema%0A%20tags/parley-0.55/lib/Parley/View%20tags/parley-0.55/lib/Template%0A%20tags/parley-0.55/lib/Template/Plugin%20tags/parley-0.55/lib/Text%0A%20tags/parley-0.55/lib/Text/Search%20tags/parley-0.55/root%0A%20tags/parley-0.55/root/base%20tags/parley-0.55/root/base/about%0A%20tags/parley-0.55/root/base/error%20tags/parley-0.55/root/base/forum%0A%20tags/parley-0.55/root/base/help%20tags/parley-0.55/root/base/menu%0A%20tags/parley-0.55/root/base/menu/left%20tags/parley-0.55/root/base/my%0A%20tags/parley-0.55/root/base/post%20tags/parley-0.55/root/base/search%0A%20tags/parley-0.55/root/base/shared%20tags/parley-0.55/root/base/thread%0A%20tags/parley-0.55/root/base/user%20tags/parley-0.55/root/bas%21%0A%20e/user/lostpassword%20tags/parley-0.55/root/base/user/signup%0A%20tags/parley-0.55/root/css%20tags/parley-0.55/root/css/images%0A%20tags/parley-0.55/root/email_templates%20tags/parley-0.55/root/static%0A%20tags/parley-0.55/root/static/images%0A%20tags/parley-0.55/root/static/images/filetypes%0A%20tags/parley-0.55/root/static/magic%20tags/parley-0.55/root/static/magic/src%0A%20tags/parley-0.55/root/static/magic/src/animation%0A%20tags/parley-0.55/root/static/magic/src/cal%0A%20tags/parley-0.55/root/static/magic/src/charting%0A%20tags/parley-0.55/root/static/magic/src/charting/svg%0A%20tags/parley-0.55/root/static/magic/src/charting/vml%0A%20tags/parley-0.55/root/static/magic/src/collections%0A%20tags/parley-0.55/root/static/magic/src/crypto%0A%20tags/parley-0.55/root/static/magic/src/data%0A%20tags/parley-0.55/root/static/magic/src/data/core%0A%20tags/parley-0.55/root/static/magic/src/data/old%0A%20tags/parley-0.55/root/static/magic/src/data/old/format%0A%20tags/parley-0.55/root/static/magic/src/data/old/provider%0A%20tags/parley-0.55/root/static/magic/src/date%20tags/parl%21%0A%20ey-0.55/root/static/magic/src/debug%20tags/parley-0.55/root/stat%21%20ic/magic&In-Reply-To=%3C200708311919.l7VJJo00016373%40sheep.berlios.de%3E"
       TITLE="[Parley-svn] r457 - / tags tags/parley-0.55 tags/parley-0.55/db tags/parley-0.55/doc tags/parley-0.55/lib tags/parley-0.55/lib/Parley tags/parley-0.55/lib/Parley/App tags/parley-0.55/lib/Parley/App/Communication tags/parley-0.55/lib/Parley/Controller tags/parley-0.55/lib/Parley/Controller/User tags/parley-0.55/lib/Parley/Model tags/parley-0.55/lib/Parley/Schema tags/parley-0.55/lib/Parley/View tags/parley-0.55/lib/Template tags/parley-0.55/lib/Template/Plugin tags/parley-0.55/lib/Text tags/parley-0.55/lib/Text/Search tags/parley-0.55/root tags/parley-0.55/root/base tags/parley-0.55/root/base/about tags/parley-0.55/root/base/error tags/parley-0.55/root/base/forum tags/parley-0.55/root/base/help tags/parley-0.55/root/base/menu tags/parley-0.55/root/base/menu/left tags/parley-0.55/root/base/my tags/parley-0.55/root/base/post tags/parley-0.55/root/base/search tags/parley-0.55/root/base/shared tags/parley-0.55/root/base/thread tags/parley-0.55/root/base/user tags/parley-0.55/root/bas! e/user/lostpassword tags/parley-0.55/root/base/user/signup tags/parley-0.55/root/css tags/parley-0.55/root/css/images tags/parley-0.55/root/email_templates tags/parley-0.55/root/static tags/parley-0.55/root/static/images tags/parley-0.55/root/static/images/filetypes tags/parley-0.55/root/static/magic tags/parley-0.55/root/static/magic/src tags/parley-0.55/root/static/magic/src/animation tags/parley-0.55/root/static/magic/src/cal tags/parley-0.55/root/static/magic/src/charting tags/parley-0.55/root/static/magic/src/charting/svg tags/parley-0.55/root/static/magic/src/charting/vml tags/parley-0.55/root/static/magic/src/collections tags/parley-0.55/root/static/magic/src/crypto tags/parley-0.55/root/static/magic/src/data tags/parley-0.55/root/static/magic/src/data/core tags/parley-0.55/root/static/magic/src/data/old tags/parley-0.55/root/static/magic/src/data/old/format tags/parley-0.55/root/static/magic/src/data/old/provider tags/parley-0.55/root/static/magic/src/date tags/parl! ey-0.55/root/static/magic/src/debug tags/parley-0.55/root/stat! ic/magic">chiselwright at mail.berlios.de
       </A><BR>
    <I>Fri Aug 31 21:19:50 CEST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="000342.html">[Parley-svn] r456 - / trunk trunk/lib
</A></li>
        <LI>Next message: <A HREF="000344.html">[Parley-svn] r458 - / trunk trunk/lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#350">[ date ]</a>
              <a href="thread.html#350">[ thread ]</a>
              <a href="subject.html#350">[ subject ]</a>
              <a href="author.html#350">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: chiselwright
Date: 2007-08-31 21:18:32 +0200 (Fri, 31 Aug 2007)
New Revision: 457

Added:
   tags/parley-0.55/
   tags/parley-0.55/Changes
   tags/parley-0.55/MANIFEST
   tags/parley-0.55/MANIFEST.SKIP
   tags/parley-0.55/Makefile.PL
   tags/parley-0.55/README
   tags/parley-0.55/TODO
   tags/parley-0.55/db/
   tags/parley-0.55/db/parley.psql
   tags/parley-0.55/db/patch.skel
   tags/parley-0.55/db/patch_0.06_to_0.07.psql
   tags/parley-0.55/db/patch_0.07_to_0.08.psql
   tags/parley-0.55/db/patch_0.08_to_0.09.psql
   tags/parley-0.55/db/patch_0.09_to_0.10.psql
   tags/parley-0.55/db/patch_0.50_to_0.51.psql
   tags/parley-0.55/db/patch_0.52_to_0.53.psql
   tags/parley-0.55/doc/
   tags/parley-0.55/doc/parley-qs.html
   tags/parley-0.55/lib/
   tags/parley-0.55/lib/Parley.pm
   tags/parley-0.55/lib/Parley/
   tags/parley-0.55/lib/Parley/App/
   tags/parley-0.55/lib/Parley/App/Communication/
   tags/parley-0.55/lib/Parley/App/Communication/Email.pm
   tags/parley-0.55/lib/Parley/App/DFV.pm
   tags/parley-0.55/lib/Parley/App/DateTime.pm
   tags/parley-0.55/lib/Parley/App/Error.pm
   tags/parley-0.55/lib/Parley/App/Notification.pm
   tags/parley-0.55/lib/Parley/Controller/
   tags/parley-0.55/lib/Parley/Controller/Admin.pm
   tags/parley-0.55/lib/Parley/Controller/Forum.pm
   tags/parley-0.55/lib/Parley/Controller/Help.pm
   tags/parley-0.55/lib/Parley/Controller/My.pm
   tags/parley-0.55/lib/Parley/Controller/Post.pm
   tags/parley-0.55/lib/Parley/Controller/Root.pm
   tags/parley-0.55/lib/Parley/Controller/Search.pm
   tags/parley-0.55/lib/Parley/Controller/Thread.pm
   tags/parley-0.55/lib/Parley/Controller/User.pm
   tags/parley-0.55/lib/Parley/Controller/User/
   tags/parley-0.55/lib/Parley/Controller/User/LostPassword.pm
   tags/parley-0.55/lib/Parley/Controller/User/SignUp.pm
   tags/parley-0.55/lib/Parley/Model/
   tags/parley-0.55/lib/Parley/Model/ParleyDB.pm
   tags/parley-0.55/lib/Parley/Schema.pm
   tags/parley-0.55/lib/Parley/Schema/
   tags/parley-0.55/lib/Parley/Schema/Authentication.pm
   tags/parley-0.55/lib/Parley/Schema/EmailQueue.pm
   tags/parley-0.55/lib/Parley/Schema/Forum.pm
   tags/parley-0.55/lib/Parley/Schema/ForumModerator.pm
   tags/parley-0.55/lib/Parley/Schema/PasswordReset.pm
   tags/parley-0.55/lib/Parley/Schema/Person.pm
   tags/parley-0.55/lib/Parley/Schema/Post.pm
   tags/parley-0.55/lib/Parley/Schema/Preference.pm
   tags/parley-0.55/lib/Parley/Schema/PreferenceTimeString.pm
   tags/parley-0.55/lib/Parley/Schema/RegistrationAuthentication.pm
   tags/parley-0.55/lib/Parley/Schema/Thread.pm
   tags/parley-0.55/lib/Parley/Schema/ThreadView.pm
   tags/parley-0.55/lib/Parley/View/
   tags/parley-0.55/lib/Parley/View/Plain.pm
   tags/parley-0.55/lib/Parley/View/TT.pm
   tags/parley-0.55/lib/Template/
   tags/parley-0.55/lib/Template/Plugin/
   tags/parley-0.55/lib/Template/Plugin/ForumCode.pm
   tags/parley-0.55/lib/Text/
   tags/parley-0.55/lib/Text/Search/
   tags/parley-0.55/lib/Text/Search/SQL.pm
   tags/parley-0.55/parley.yml
   tags/parley-0.55/root/
   tags/parley-0.55/root/base/
   tags/parley-0.55/root/base/about/
   tags/parley-0.55/root/base/about/modules
   tags/parley-0.55/root/base/error/
   tags/parley-0.55/root/base/error/simple
   tags/parley-0.55/root/base/footer
   tags/parley-0.55/root/base/forum/
   tags/parley-0.55/root/base/forum/list
   tags/parley-0.55/root/base/forum/view
   tags/parley-0.55/root/base/header
   tags/parley-0.55/root/base/help/
   tags/parley-0.55/root/base/help/contents
   tags/parley-0.55/root/base/help/faq
   tags/parley-0.55/root/base/help/formatting_posts
   tags/parley-0.55/root/base/help/unknown
   tags/parley-0.55/root/base/menu/
   tags/parley-0.55/root/base/menu/left/
   tags/parley-0.55/root/base/menu/left/main
   tags/parley-0.55/root/base/menu/menubar
   tags/parley-0.55/root/base/menu/statusbar
   tags/parley-0.55/root/base/my/
   tags/parley-0.55/root/base/my/preferences
   tags/parley-0.55/root/base/my/selectplace_ajaxresult
   tags/parley-0.55/root/base/my/tab_avatar
   tags/parley-0.55/root/base/my/tab_notifications
   tags/parley-0.55/root/base/my/tab_time
   tags/parley-0.55/root/base/my/tab_watch
   tags/parley-0.55/root/base/my/tab_you
   tags/parley-0.55/root/base/post/
   tags/parley-0.55/root/base/post/edit
   tags/parley-0.55/root/base/search/
   tags/parley-0.55/root/base/search/forum
   tags/parley-0.55/root/base/shared/
   tags/parley-0.55/root/base/shared/autocomplete_style
   tags/parley-0.55/root/base/shared/focus_username_js
   tags/parley-0.55/root/base/shared/login_dialog
   tags/parley-0.55/root/base/shared/moderator_list
   tags/parley-0.55/root/base/shared/navigation
   tags/parley-0.55/root/base/shared/pager_advanced
   tags/parley-0.55/root/base/shared/search_dialog
   tags/parley-0.55/root/base/shared/thread_watch
   tags/parley-0.55/root/base/shared/threadcrumbs
   tags/parley-0.55/root/base/shared/useful_tt_stuff
   tags/parley-0.55/root/base/shared/user_avatar
   tags/parley-0.55/root/base/shared/user_status
   tags/parley-0.55/root/base/thread/
   tags/parley-0.55/root/base/thread/add
   tags/parley-0.55/root/base/thread/recent
   tags/parley-0.55/root/base/thread/reply
   tags/parley-0.55/root/base/thread/view
   tags/parley-0.55/root/base/thread/watches
   tags/parley-0.55/root/base/user/
   tags/parley-0.55/root/base/user/auth_emailed
   tags/parley-0.55/root/base/user/auth_success
   tags/parley-0.55/root/base/user/login
   tags/parley-0.55/root/base/user/lostpassword/
   tags/parley-0.55/root/base/user/lostpassword/lost_password
   tags/parley-0.55/root/base/user/lostpassword/lost_password_details_sent
   tags/parley-0.55/root/base/user/lostpassword/reset
   tags/parley-0.55/root/base/user/lostpassword/reset_success
   tags/parley-0.55/root/base/user/profile
   tags/parley-0.55/root/base/user/signup/
   tags/parley-0.55/root/base/user/signup/signup
   tags/parley-0.55/root/controls.js
   tags/parley-0.55/root/css/
   tags/parley-0.55/root/css/common.css
   tags/parley-0.55/root/css/default.css
   tags/parley-0.55/root/css/images/
   tags/parley-0.55/root/css/images/bg.gif
   tags/parley-0.55/root/css/images/client_logo.gif
   tags/parley-0.55/root/css/images/logo.png
   tags/parley-0.55/root/css/layout23.css
   tags/parley-0.55/root/css/layout27.css
   tags/parley-0.55/root/css/layout33.css
   tags/parley-0.55/root/dragdrop.js
   tags/parley-0.55/root/effects.js
   tags/parley-0.55/root/email_templates/
   tags/parley-0.55/root/email_templates/authentication_email.eml
   tags/parley-0.55/root/email_templates/password_reset.eml
   tags/parley-0.55/root/email_templates/thread_update_notify.eml
   tags/parley-0.55/root/email_templates/thread_update_notify.html
   tags/parley-0.55/root/email_templates/username_reminder.eml
   tags/parley-0.55/root/favicon.ico
   tags/parley-0.55/root/prototype.js
   tags/parley-0.55/root/static/
   tags/parley-0.55/root/static/images/
   tags/parley-0.55/root/static/images/btn_120x50_built.png
   tags/parley-0.55/root/static/images/btn_120x50_built_shadow.png
   tags/parley-0.55/root/static/images/btn_120x50_powered.png
   tags/parley-0.55/root/static/images/btn_120x50_powered_shadow.png
   tags/parley-0.55/root/static/images/btn_88x31_built.png
   tags/parley-0.55/root/static/images/btn_88x31_built_shadow.png
   tags/parley-0.55/root/static/images/btn_88x31_powered.png
   tags/parley-0.55/root/static/images/btn_88x31_powered_shadow.png
   tags/parley-0.55/root/static/images/catalyst_logo.png
   tags/parley-0.55/root/static/images/filetypes/
   tags/parley-0.55/root/static/images/filetypes/image.png
   tags/parley-0.55/root/static/images/filetypes/pdf.png
   tags/parley-0.55/root/static/images/locked.png
   tags/parley-0.55/root/static/images/sticky.png
   tags/parley-0.55/root/static/images/unread_posts.gif
   tags/parley-0.55/root/static/magic/
   tags/parley-0.55/root/static/magic/dojo.js
   tags/parley-0.55/root/static/magic/iframe_history.html
   tags/parley-0.55/root/static/magic/src/
   tags/parley-0.55/root/static/magic/src/AdapterRegistry.js
   tags/parley-0.55/root/static/magic/src/Deferred.js
   tags/parley-0.55/root/static/magic/src/DeferredList.js
   tags/parley-0.55/root/static/magic/src/a11y.js
   tags/parley-0.55/root/static/magic/src/animation.js
   tags/parley-0.55/root/static/magic/src/animation/
   tags/parley-0.55/root/static/magic/src/animation/Animation.js
   tags/parley-0.55/root/static/magic/src/animation/AnimationEvent.js
   tags/parley-0.55/root/static/magic/src/animation/AnimationSequence.js
   tags/parley-0.55/root/static/magic/src/animation/Timer.js
   tags/parley-0.55/root/static/magic/src/animation/__package__.js
   tags/parley-0.55/root/static/magic/src/behavior.js
   tags/parley-0.55/root/static/magic/src/bootstrap1.js
   tags/parley-0.55/root/static/magic/src/browser_debug.js
   tags/parley-0.55/root/static/magic/src/browser_debug_xd.js
   tags/parley-0.55/root/static/magic/src/cal/
   tags/parley-0.55/root/static/magic/src/cal/iCalendar.js
   tags/parley-0.55/root/static/magic/src/cal/textDirectory.js
   tags/parley-0.55/root/static/magic/src/charting/
   tags/parley-0.55/root/static/magic/src/charting/Axis.js
   tags/parley-0.55/root/static/magic/src/charting/Chart.js
   tags/parley-0.55/root/static/magic/src/charting/Plot.js
   tags/parley-0.55/root/static/magic/src/charting/PlotArea.js
   tags/parley-0.55/root/static/magic/src/charting/Plotters.js
   tags/parley-0.55/root/static/magic/src/charting/README.txt
   tags/parley-0.55/root/static/magic/src/charting/Series.js
   tags/parley-0.55/root/static/magic/src/charting/__package__.js
   tags/parley-0.55/root/static/magic/src/charting/svg/
   tags/parley-0.55/root/static/magic/src/charting/svg/Axis.js
   tags/parley-0.55/root/static/magic/src/charting/svg/PlotArea.js
   tags/parley-0.55/root/static/magic/src/charting/svg/Plotters.js
   tags/parley-0.55/root/static/magic/src/charting/vml/
   tags/parley-0.55/root/static/magic/src/charting/vml/Axis.js
   tags/parley-0.55/root/static/magic/src/charting/vml/PlotArea.js
   tags/parley-0.55/root/static/magic/src/charting/vml/Plotters.js
   tags/parley-0.55/root/static/magic/src/collections/
   tags/parley-0.55/root/static/magic/src/collections/ArrayList.js
   tags/parley-0.55/root/static/magic/src/collections/BinaryTree.js
   tags/parley-0.55/root/static/magic/src/collections/Collections.js
   tags/parley-0.55/root/static/magic/src/collections/Dictionary.js
   tags/parley-0.55/root/static/magic/src/collections/Graph.js
   tags/parley-0.55/root/static/magic/src/collections/Queue.js
   tags/parley-0.55/root/static/magic/src/collections/Set.js
   tags/parley-0.55/root/static/magic/src/collections/SkipList.js
   tags/parley-0.55/root/static/magic/src/collections/SortedList.js
   tags/parley-0.55/root/static/magic/src/collections/Stack.js
   tags/parley-0.55/root/static/magic/src/collections/Store.js
   tags/parley-0.55/root/static/magic/src/collections/__package__.js
   tags/parley-0.55/root/static/magic/src/crypto.js
   tags/parley-0.55/root/static/magic/src/crypto/
   tags/parley-0.55/root/static/magic/src/crypto/Blowfish.js
   tags/parley-0.55/root/static/magic/src/crypto/LICENSE
   tags/parley-0.55/root/static/magic/src/crypto/MD5.js
   tags/parley-0.55/root/static/magic/src/crypto/Rijndael.js
   tags/parley-0.55/root/static/magic/src/crypto/SHA1.js
   tags/parley-0.55/root/static/magic/src/crypto/SHA256.js
   tags/parley-0.55/root/static/magic/src/crypto/__package__.js
   tags/parley-0.55/root/static/magic/src/data.js
   tags/parley-0.55/root/static/magic/src/data/
   tags/parley-0.55/root/static/magic/src/data/CsvStore.js
   tags/parley-0.55/root/static/magic/src/data/OpmlStore.js
   tags/parley-0.55/root/static/magic/src/data/RdfStore.js
   tags/parley-0.55/root/static/magic/src/data/YahooStore.js
   tags/parley-0.55/root/static/magic/src/data/core/
   tags/parley-0.55/root/static/magic/src/data/core/Read.js
   tags/parley-0.55/root/static/magic/src/data/core/RemoteStore.js
   tags/parley-0.55/root/static/magic/src/data/core/Result.js
   tags/parley-0.55/root/static/magic/src/data/core/Write.js
   tags/parley-0.55/root/static/magic/src/data/old/
   tags/parley-0.55/root/static/magic/src/data/old/Attribute.js
   tags/parley-0.55/root/static/magic/src/data/old/Item.js
   tags/parley-0.55/root/static/magic/src/data/old/Kind.js
   tags/parley-0.55/root/static/magic/src/data/old/Observable.js
   tags/parley-0.55/root/static/magic/src/data/old/ResultSet.js
   tags/parley-0.55/root/static/magic/src/data/old/Type.js
   tags/parley-0.55/root/static/magic/src/data/old/Value.js
   tags/parley-0.55/root/static/magic/src/data/old/__package__.js
   tags/parley-0.55/root/static/magic/src/data/old/format/
   tags/parley-0.55/root/static/magic/src/data/old/format/Csv.js
   tags/parley-0.55/root/static/magic/src/data/old/format/Json.js
   tags/parley-0.55/root/static/magic/src/data/old/provider/
   tags/parley-0.55/root/static/magic/src/data/old/provider/Base.js
   tags/parley-0.55/root/static/magic/src/data/old/provider/Delicious.js
   tags/parley-0.55/root/static/magic/src/data/old/provider/FlatFile.js
   tags/parley-0.55/root/static/magic/src/data/old/provider/JotSpot.js
   tags/parley-0.55/root/static/magic/src/data/old/provider/MySql.js
   tags/parley-0.55/root/static/magic/src/data/old/to_do.txt
   tags/parley-0.55/root/static/magic/src/date.js
   tags/parley-0.55/root/static/magic/src/date/
   tags/parley-0.55/root/static/magic/src/date/common.js
   tags/parley-0.55/root/static/magic/src/date/format.js
   tags/parley-0.55/root/static/magic/src/date/serialize.js
   tags/parley-0.55/root/static/magic/src/date/supplemental.js
   tags/parley-0.55/root/static/magic/src/debug.js
   tags/parley-0.55/root/static/magic/src/debug/
   tags/parley-0.55/root/static/magic/src/debug/Firebug.js
   tags/parley-0.55/root/static/magic/src/debug/arrow_hide.gif
   tags/parley-0.55/root/static/magic/src/debug/arrow_show.gif
   tags/parley-0.55/root/static/magic/src/debug/console.js
   tags/parley-0.55/root/static/magic/src/debug/deep.html
   tags/parley-0.55/root/static/magic/src/debug/spacer.gif
   tags/parley-0.55/root/static/magic/src/dnd/
   tags/parley-0.55/root/static/magic/src/dnd/DragAndDrop.js
   tags/parley-0.55/root/static/magic/src/dnd/HtmlDragAndDrop.js
   tags/parley-0.55/root/static/magic/src/dnd/HtmlDragCopy.js
   tags/parley-0.55/root/static/magic/src/dnd/HtmlDragManager.js
   tags/parley-0.55/root/static/magic/src/dnd/HtmlDragMove.js
   tags/parley-0.55/root/static/magic/src/dnd/Sortable.js
   tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDrop.js
   tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDropV3.js
   tags/parley-0.55/root/static/magic/src/dnd/__package__.js
   tags/parley-0.55/root/static/magic/src/docs.js
   tags/parley-0.55/root/static/magic/src/dom.js
   tags/parley-0.55/root/static/magic/src/event.js
   tags/parley-0.55/root/static/magic/src/event/
   tags/parley-0.55/root/static/magic/src/event/__package__.js
   tags/parley-0.55/root/static/magic/src/event/browser.js
   tags/parley-0.55/root/static/magic/src/event/common.js
   tags/parley-0.55/root/static/magic/src/event/topic.js
   tags/parley-0.55/root/static/magic/src/experimental.js
   tags/parley-0.55/root/static/magic/src/flash.js
   tags/parley-0.55/root/static/magic/src/flash/
   tags/parley-0.55/root/static/magic/src/flash/flash6/
   tags/parley-0.55/root/static/magic/src/flash/flash6/DojoExternalInterface.as
   tags/parley-0.55/root/static/magic/src/flash/flash6/flash6_gateway.fla
   tags/parley-0.55/root/static/magic/src/flash/flash8/
   tags/parley-0.55/root/static/magic/src/flash/flash8/DojoExternalInterface.as
   tags/parley-0.55/root/static/magic/src/flash/flash8/ExpressInstall.as
   tags/parley-0.55/root/static/magic/src/gfx/
   tags/parley-0.55/root/static/magic/src/gfx/Colorspace.js
   tags/parley-0.55/root/static/magic/src/gfx/__package__.js
   tags/parley-0.55/root/static/magic/src/gfx/color.js
   tags/parley-0.55/root/static/magic/src/gfx/color/
   tags/parley-0.55/root/static/magic/src/gfx/color/hsl.js
   tags/parley-0.55/root/static/magic/src/gfx/color/hsv.js
   tags/parley-0.55/root/static/magic/src/gfx/common.js
   tags/parley-0.55/root/static/magic/src/gfx/matrix.js
   tags/parley-0.55/root/static/magic/src/gfx/path.js
   tags/parley-0.55/root/static/magic/src/gfx/shape.js
   tags/parley-0.55/root/static/magic/src/gfx/svg.js
   tags/parley-0.55/root/static/magic/src/gfx/vml.js
   tags/parley-0.55/root/static/magic/src/graphics/
   tags/parley-0.55/root/static/magic/src/graphics/Colorspace.js
   tags/parley-0.55/root/static/magic/src/graphics/__package__.js
   tags/parley-0.55/root/static/magic/src/graphics/color.js
   tags/parley-0.55/root/static/magic/src/graphics/color/
   tags/parley-0.55/root/static/magic/src/graphics/color/hsl.js
   tags/parley-0.55/root/static/magic/src/graphics/color/hsv.js
   tags/parley-0.55/root/static/magic/src/hostenv_adobesvg.js
   tags/parley-0.55/root/static/magic/src/hostenv_browser.js
   tags/parley-0.55/root/static/magic/src/hostenv_dashboard.js
   tags/parley-0.55/root/static/magic/src/hostenv_jsc.js
   tags/parley-0.55/root/static/magic/src/hostenv_rhino.js
   tags/parley-0.55/root/static/magic/src/hostenv_spidermonkey.js
   tags/parley-0.55/root/static/magic/src/hostenv_svg.js
   tags/parley-0.55/root/static/magic/src/hostenv_wsh.js
   tags/parley-0.55/root/static/magic/src/html.js
   tags/parley-0.55/root/static/magic/src/html/
   tags/parley-0.55/root/static/magic/src/html/__package__.js
   tags/parley-0.55/root/static/magic/src/html/color.js
   tags/parley-0.55/root/static/magic/src/html/common.js
   tags/parley-0.55/root/static/magic/src/html/display.js
   tags/parley-0.55/root/static/magic/src/html/iframe.js
   tags/parley-0.55/root/static/magic/src/html/images/
   tags/parley-0.55/root/static/magic/src/html/images/shadowB.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowBL.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowBR.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowL.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowR.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowT.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowTL.png
   tags/parley-0.55/root/static/magic/src/html/images/shadowTR.png
   tags/parley-0.55/root/static/magic/src/html/layout.js
   tags/parley-0.55/root/static/magic/src/html/metrics.js
   tags/parley-0.55/root/static/magic/src/html/selection.js
   tags/parley-0.55/root/static/magic/src/html/shadow.js
   tags/parley-0.55/root/static/magic/src/html/style.js
   tags/parley-0.55/root/static/magic/src/html/util.js
   tags/parley-0.55/root/static/magic/src/i18n/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/README
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/de/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/de/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/en/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/en/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/es/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/es/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fi/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fi/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fr/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fr/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorianExtras.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/hu/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/hu/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/it/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/it/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorianExtras.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ko/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ko/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/nl/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/nl/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt-br/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt-br/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/sv/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/sv/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-cn/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-cn/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-hk/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-hk/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-tw/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-tw/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorian.js
   tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorianExtras.js
   tags/parley-0.55/root/static/magic/src/i18n/common.js
   tags/parley-0.55/root/static/magic/src/i18n/currency.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/
   tags/parley-0.55/root/static/magic/src/i18n/currency/common.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/EUR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/GBP.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/INR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ITL.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/JPY.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/README
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/USD.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en-us/
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en-us/USD.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/EUR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/GBP.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/INR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/ITL.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/JPY.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/USD.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/EUR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/GBP.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/INR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/ITL.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/JPY.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/USD.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/EUR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/GBP.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/INR.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/ITL.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/JPY.js
   tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/USD.js
   tags/parley-0.55/root/static/magic/src/i18n/number.js
   tags/parley-0.55/root/static/magic/src/iCalendar.js
   tags/parley-0.55/root/static/magic/src/io.js
   tags/parley-0.55/root/static/magic/src/io/
   tags/parley-0.55/root/static/magic/src/io/BrowserIO.js
   tags/parley-0.55/root/static/magic/src/io/IframeIO.js
   tags/parley-0.55/root/static/magic/src/io/RepubsubIO.js
   tags/parley-0.55/root/static/magic/src/io/RhinoIO.js
   tags/parley-0.55/root/static/magic/src/io/ScriptSrcIO.js
   tags/parley-0.55/root/static/magic/src/io/XhrIframeProxy.js
   tags/parley-0.55/root/static/magic/src/io/__package__.js
   tags/parley-0.55/root/static/magic/src/io/cometd.js
   tags/parley-0.55/root/static/magic/src/io/common.js
   tags/parley-0.55/root/static/magic/src/io/cookie.js
   tags/parley-0.55/root/static/magic/src/io/xip_client.html
   tags/parley-0.55/root/static/magic/src/io/xip_server.html
   tags/parley-0.55/root/static/magic/src/json.js
   tags/parley-0.55/root/static/magic/src/lang.js
   tags/parley-0.55/root/static/magic/src/lang/
   tags/parley-0.55/root/static/magic/src/lang/__package__.js
   tags/parley-0.55/root/static/magic/src/lang/array.js
   tags/parley-0.55/root/static/magic/src/lang/assert.js
   tags/parley-0.55/root/static/magic/src/lang/common.js
   tags/parley-0.55/root/static/magic/src/lang/declare.js
   tags/parley-0.55/root/static/magic/src/lang/extras.js
   tags/parley-0.55/root/static/magic/src/lang/func.js
   tags/parley-0.55/root/static/magic/src/lang/repr.js
   tags/parley-0.55/root/static/magic/src/lang/timing/
   tags/parley-0.55/root/static/magic/src/lang/timing/Streamer.js
   tags/parley-0.55/root/static/magic/src/lang/timing/Timer.js
   tags/parley-0.55/root/static/magic/src/lang/timing/__package__.js
   tags/parley-0.55/root/static/magic/src/lang/type.js
   tags/parley-0.55/root/static/magic/src/lfx/
   tags/parley-0.55/root/static/magic/src/lfx/Animation.js
   tags/parley-0.55/root/static/magic/src/lfx/__package__.js
   tags/parley-0.55/root/static/magic/src/lfx/extras.js
   tags/parley-0.55/root/static/magic/src/lfx/html.js
   tags/parley-0.55/root/static/magic/src/lfx/rounded.js
   tags/parley-0.55/root/static/magic/src/lfx/shadow.js
   tags/parley-0.55/root/static/magic/src/lfx/toggle.js
   tags/parley-0.55/root/static/magic/src/loader.js
   tags/parley-0.55/root/static/magic/src/loader_xd.js
   tags/parley-0.55/root/static/magic/src/logging/
   tags/parley-0.55/root/static/magic/src/logging/ConsoleLogger.js
   tags/parley-0.55/root/static/magic/src/logging/Logger.js
   tags/parley-0.55/root/static/magic/src/logging/__package__.js
   tags/parley-0.55/root/static/magic/src/math.js
   tags/parley-0.55/root/static/magic/src/math/
   tags/parley-0.55/root/static/magic/src/math/__package__.js
   tags/parley-0.55/root/static/magic/src/math/curves.js
   tags/parley-0.55/root/static/magic/src/math/matrix.js
   tags/parley-0.55/root/static/magic/src/math/points.js
   tags/parley-0.55/root/static/magic/src/namespaces/
   tags/parley-0.55/root/static/magic/src/namespaces/dojo.js
   tags/parley-0.55/root/static/magic/src/ns.js
   tags/parley-0.55/root/static/magic/src/profile.js
   tags/parley-0.55/root/static/magic/src/regexp.js
   tags/parley-0.55/root/static/magic/src/rpc/
   tags/parley-0.55/root/static/magic/src/rpc/Deferred.js
   tags/parley-0.55/root/static/magic/src/rpc/JotService.js
   tags/parley-0.55/root/static/magic/src/rpc/JsonService.js
   tags/parley-0.55/root/static/magic/src/rpc/RpcService.js
   tags/parley-0.55/root/static/magic/src/rpc/YahooService.js
   tags/parley-0.55/root/static/magic/src/rpc/__package__.js
   tags/parley-0.55/root/static/magic/src/rpc/yahoo.smd
   tags/parley-0.55/root/static/magic/src/selection/
   tags/parley-0.55/root/static/magic/src/selection/Selection.js
   tags/parley-0.55/root/static/magic/src/storage.js
   tags/parley-0.55/root/static/magic/src/storage/
   tags/parley-0.55/root/static/magic/src/storage/Storage.as
   tags/parley-0.55/root/static/magic/src/storage/__package__.js
   tags/parley-0.55/root/static/magic/src/storage/browser.js
   tags/parley-0.55/root/static/magic/src/storage/java/
   tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.class
   tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.java
   tags/parley-0.55/root/static/magic/src/storage/storage_dialog.fla
   tags/parley-0.55/root/static/magic/src/string.js
   tags/parley-0.55/root/static/magic/src/string/
   tags/parley-0.55/root/static/magic/src/string/Builder.js
   tags/parley-0.55/root/static/magic/src/string/__package__.js
   tags/parley-0.55/root/static/magic/src/string/common.js
   tags/parley-0.55/root/static/magic/src/string/extras.js
   tags/parley-0.55/root/static/magic/src/style.js
   tags/parley-0.55/root/static/magic/src/svg.js
   tags/parley-0.55/root/static/magic/src/text/
   tags/parley-0.55/root/static/magic/src/text/__package__.js
   tags/parley-0.55/root/static/magic/src/text/textDirectory.js
   tags/parley-0.55/root/static/magic/src/undo/
   tags/parley-0.55/root/static/magic/src/undo/Manager.js
   tags/parley-0.55/root/static/magic/src/undo/__package__.js
   tags/parley-0.55/root/static/magic/src/undo/browser.js
   tags/parley-0.55/root/static/magic/src/uri/
   tags/parley-0.55/root/static/magic/src/uri/Uri.js
   tags/parley-0.55/root/static/magic/src/uri/__package__.js
   tags/parley-0.55/root/static/magic/src/uri/cache.js
   tags/parley-0.55/root/static/magic/src/uuid/
   tags/parley-0.55/root/static/magic/src/uuid/LightweightGenerator.js
   tags/parley-0.55/root/static/magic/src/uuid/NameBasedGenerator.js
   tags/parley-0.55/root/static/magic/src/uuid/NilGenerator.js
   tags/parley-0.55/root/static/magic/src/uuid/RandomGenerator.js
   tags/parley-0.55/root/static/magic/src/uuid/TimeBasedGenerator.js
   tags/parley-0.55/root/static/magic/src/uuid/Uuid.js
   tags/parley-0.55/root/static/magic/src/uuid/__package__.js
   tags/parley-0.55/root/static/magic/src/validate.js
   tags/parley-0.55/root/static/magic/src/validate/
   tags/parley-0.55/root/static/magic/src/validate/__package__.js
   tags/parley-0.55/root/static/magic/src/validate/check.js
   tags/parley-0.55/root/static/magic/src/validate/common.js
   tags/parley-0.55/root/static/magic/src/validate/creditCard.js
   tags/parley-0.55/root/static/magic/src/validate/datetime.js
   tags/parley-0.55/root/static/magic/src/validate/de.js
   tags/parley-0.55/root/static/magic/src/validate/jp.js
   tags/parley-0.55/root/static/magic/src/validate/us.js
   tags/parley-0.55/root/static/magic/src/validate/web.js
   tags/parley-0.55/root/static/magic/src/widget/
   tags/parley-0.55/root/static/magic/src/widget/AccordionContainer.js
   tags/parley-0.55/root/static/magic/src/widget/AnimatedPng.js
   tags/parley-0.55/root/static/magic/src/widget/Button.js
   tags/parley-0.55/root/static/magic/src/widget/Chart.js
   tags/parley-0.55/root/static/magic/src/widget/Checkbox.js
   tags/parley-0.55/root/static/magic/src/widget/Clock.js
   tags/parley-0.55/root/static/magic/src/widget/ColorPalette.js
   tags/parley-0.55/root/static/magic/src/widget/ComboBox.js
   tags/parley-0.55/root/static/magic/src/widget/ContentPane.js
   tags/parley-0.55/root/static/magic/src/widget/CurrencyTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/DatePicker.js
   tags/parley-0.55/root/static/magic/src/widget/DateTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/DebugConsole.js
   tags/parley-0.55/root/static/magic/src/widget/Dialog.js
   tags/parley-0.55/root/static/magic/src/widget/DocPane.js
   tags/parley-0.55/root/static/magic/src/widget/DomWidget.js
   tags/parley-0.55/root/static/magic/src/widget/DropdownContainer.js
   tags/parley-0.55/root/static/magic/src/widget/DropdownDatePicker.js
   tags/parley-0.55/root/static/magic/src/widget/DropdownTimePicker.js
   tags/parley-0.55/root/static/magic/src/widget/Editor.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/AlwaysShowToolbar.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ContextMenu.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/CreateLinkDialog.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplace.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplaceDialog.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertImageDialog.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertTableDialog.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/SimpleSignalCommands.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/TableOperation.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ToolbarDndSupport.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/__package__.js
   tags/parley-0.55/root/static/magic/src/widget/Editor2Toolbar.js
   tags/parley-0.55/root/static/magic/src/widget/FilteringTable.js
   tags/parley-0.55/root/static/magic/src/widget/FisheyeList.js
   tags/parley-0.55/root/static/magic/src/widget/FloatingPane.js
   tags/parley-0.55/root/static/magic/src/widget/Form.js
   tags/parley-0.55/root/static/magic/src/widget/GoogleMap.js
   tags/parley-0.55/root/static/magic/src/widget/HtmlWidget.js
   tags/parley-0.55/root/static/magic/src/widget/InlineEditBox.js
   tags/parley-0.55/root/static/magic/src/widget/IntegerTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/InternetTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/LayoutContainer.js
   tags/parley-0.55/root/static/magic/src/widget/LinkPane.js
   tags/parley-0.55/root/static/magic/src/widget/Manager.js
   tags/parley-0.55/root/static/magic/src/widget/Menu2.js
   tags/parley-0.55/root/static/magic/src/widget/MonthlyCalendar.js
   tags/parley-0.55/root/static/magic/src/widget/PageContainer.js
   tags/parley-0.55/root/static/magic/src/widget/Parse.js
   tags/parley-0.55/root/static/magic/src/widget/PopupContainer.js
   tags/parley-0.55/root/static/magic/src/widget/ProgressBar.js
   tags/parley-0.55/root/static/magic/src/widget/RadioGroup.js
   tags/parley-0.55/root/static/magic/src/widget/RealNumberTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/RegexpTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/RemoteTabController.js
   tags/parley-0.55/root/static/magic/src/widget/Repeater.js
   tags/parley-0.55/root/static/magic/src/widget/ResizableTextarea.js
   tags/parley-0.55/root/static/magic/src/widget/ResizeHandle.js
   tags/parley-0.55/root/static/magic/src/widget/RichText.js
   tags/parley-0.55/root/static/magic/src/widget/Rounded.js
   tags/parley-0.55/root/static/magic/src/widget/Select.js
   tags/parley-0.55/root/static/magic/src/widget/Show.js
   tags/parley-0.55/root/static/magic/src/widget/ShowAction.js
   tags/parley-0.55/root/static/magic/src/widget/ShowSlide.js
   tags/parley-0.55/root/static/magic/src/widget/SlideShow.js
   tags/parley-0.55/root/static/magic/src/widget/Slider.js
   tags/parley-0.55/root/static/magic/src/widget/SortableTable.js
   tags/parley-0.55/root/static/magic/src/widget/Spinner.js
   tags/parley-0.55/root/static/magic/src/widget/SplitContainer.js
   tags/parley-0.55/root/static/magic/src/widget/SvgButton.js
   tags/parley-0.55/root/static/magic/src/widget/SvgWidget.js
   tags/parley-0.55/root/static/magic/src/widget/SwtWidget.js
   tags/parley-0.55/root/static/magic/src/widget/TabContainer.js
   tags/parley-0.55/root/static/magic/src/widget/TaskBar.js
   tags/parley-0.55/root/static/magic/src/widget/Textbox.js
   tags/parley-0.55/root/static/magic/src/widget/TimePicker.js
   tags/parley-0.55/root/static/magic/src/widget/TitlePane.js
   tags/parley-0.55/root/static/magic/src/widget/Toaster.js
   tags/parley-0.55/root/static/magic/src/widget/Toggler.js
   tags/parley-0.55/root/static/magic/src/widget/Toolbar.js
   tags/parley-0.55/root/static/magic/src/widget/Tooltip.js
   tags/parley-0.55/root/static/magic/src/widget/Tree.js
   tags/parley-0.55/root/static/magic/src/widget/TreeBasicController.js
   tags/parley-0.55/root/static/magic/src/widget/TreeBasicControllerV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeCommon.js
   tags/parley-0.55/root/static/magic/src/widget/TreeContextMenu.js
   tags/parley-0.55/root/static/magic/src/widget/TreeContextMenuV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeControllerExtension.js
   tags/parley-0.55/root/static/magic/src/widget/TreeDemo.js
   tags/parley-0.55/root/static/magic/src/widget/TreeDeselectOnDblselect.js
   tags/parley-0.55/root/static/magic/src/widget/TreeDisableWrapExtension.js
   tags/parley-0.55/root/static/magic/src/widget/TreeDndControllerV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeDocIconExtension.js
   tags/parley-0.55/root/static/magic/src/widget/TreeEditor.js
   tags/parley-0.55/root/static/magic/src/widget/TreeEmphasizeOnSelect.js
   tags/parley-0.55/root/static/magic/src/widget/TreeExpandToNodeOnSelect.js
   tags/parley-0.55/root/static/magic/src/widget/TreeExtension.js
   tags/parley-0.55/root/static/magic/src/widget/TreeLinkExtension.js
   tags/parley-0.55/root/static/magic/src/widget/TreeLoadingController.js
   tags/parley-0.55/root/static/magic/src/widget/TreeLoadingControllerV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeNode.js
   tags/parley-0.55/root/static/magic/src/widget/TreeNodeV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeRPCController.js
   tags/parley-0.55/root/static/magic/src/widget/TreeRpcControllerV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeSelector.js
   tags/parley-0.55/root/static/magic/src/widget/TreeSelectorV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeTimeoutIterator.js
   tags/parley-0.55/root/static/magic/src/widget/TreeToggleOnSelect.js
   tags/parley-0.55/root/static/magic/src/widget/TreeV3.js
   tags/parley-0.55/root/static/magic/src/widget/TreeWithNode.js
   tags/parley-0.55/root/static/magic/src/widget/UsTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/ValidationTextbox.js
   tags/parley-0.55/root/static/magic/src/widget/Widget.js
   tags/parley-0.55/root/static/magic/src/widget/Wizard.js
   tags/parley-0.55/root/static/magic/src/widget/YahooMap.js
   tags/parley-0.55/root/static/magic/src/widget/__package__.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoContainer.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoItem.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoNavigator.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoPane.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/SourcePane.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/__package__.js
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.css
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.html
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.css
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.html
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.css
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.html
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.css
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.html
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.css
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.html
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/general.css
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/test_thumb.gif
   tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/viewDemo.png
   tags/parley-0.55/root/static/magic/src/widget/html/
   tags/parley-0.55/root/static/magic/src/widget/html/layout.js
   tags/parley-0.55/root/static/magic/src/widget/html/loader.js
   tags/parley-0.55/root/static/magic/src/widget/html/stabile.js
   tags/parley-0.55/root/static/magic/src/widget/nls/
   tags/parley-0.55/root/static/magic/src/widget/nls/DropdownDatePicker.js
   tags/parley-0.55/root/static/magic/src/widget/nls/DropdownTimePicker.js
   tags/parley-0.55/root/static/magic/src/widget/nls/TimePicker.js
   tags/parley-0.55/root/static/magic/src/widget/nls/fr/
   tags/parley-0.55/root/static/magic/src/widget/nls/fr/validate.js
   tags/parley-0.55/root/static/magic/src/widget/nls/ja/
   tags/parley-0.55/root/static/magic/src/widget/nls/ja/validate.js
   tags/parley-0.55/root/static/magic/src/widget/nls/validate.js
   tags/parley-0.55/root/static/magic/src/widget/nls/zh-cn/
   tags/parley-0.55/root/static/magic/src/widget/nls/zh-cn/validate.js
   tags/parley-0.55/root/static/magic/src/widget/svg/
   tags/parley-0.55/root/static/magic/src/widget/svg/Chart.js
   tags/parley-0.55/root/static/magic/src/widget/templates/
   tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.css
   tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.html
   tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.html
   tags/parley-0.55/root/static/magic/src/widget/templates/CheckboxA11y.html
   tags/parley-0.55/root/static/magic/src/widget/templates/CiviCrmDatePicker.html
   tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.html
   tags/parley-0.55/root/static/magic/src/widget/templates/ComboButtonTemplate.html
   tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.css
   tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.html
   tags/parley-0.55/root/static/magic/src/widget/templates/DemoEngine.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Dialog.html
   tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.css
   tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.html
   tags/parley-0.55/root/static/magic/src/widget/templates/DropDownButtonTemplate.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/createlink.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/find.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/insertimage.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/inserttable.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/replace.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorDialog.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontName.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontSize.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FormatBlock.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_gecko.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_ie.css
   tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.css
   tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.html
   tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbarOneline.html
   tags/parley-0.55/root/static/magic/src/widget/templates/FisheyeList.css
   tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.css
   tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.html
   tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.css
   tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Menu.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Menu2.css
   tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.css
   tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.html
   tags/parley-0.55/root/static/magic/src/widget/templates/PopUpButton.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.html
   tags/parley-0.55/root/static/magic/src/widget/templates/RemoteTabControl.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.html
   tags/parley-0.55/root/static/magic/src/widget/templates/ResizeHandle.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Show.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Show.html
   tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.html
   tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.css
   tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Slider.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Slider.html
   tags/parley-0.55/root/static/magic/src/widget/templates/SliderHorizontal.html
   tags/parley-0.55/root/static/magic/src/widget/templates/SliderVertical.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.html
   tags/parley-0.55/root/static/magic/src/widget/templates/SplitContainer.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.html
   tags/parley-0.55/root/static/magic/src/widget/templates/TabContainerA11y.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TaskBar.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TaskBarItemTemplate.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Textbox.html
   tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.html
   tags/parley-0.55/root/static/magic/src/widget/templates/TitlePane.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Toaster.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Toolbar.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TooltipTemplate.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Tree.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TreeDisableWrap.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TreeDocIcon.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TreeEditor.css
   tags/parley-0.55/root/static/magic/src/widget/templates/TreeV3.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Validate.css
   tags/parley-0.55/root/static/magic/src/widget/templates/ValidationTextbox.html
   tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.css
   tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.html
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/aggregate.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/backcolor.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/bg-fade.png
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/bold.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/cancel.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/copy.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/createlink.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/cut.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/delete.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/forecolor.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/hilitecolor.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/indent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/inserthorizontalrule.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertimage.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertorderedlist.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/inserttable.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertunorderedlist.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/italic.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifycenter.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyfull.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyleft.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyright.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/left_to_right.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_bullet_indent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_bullet_outdent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_num_indent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_num_outdent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/outdent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/paste.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/redo.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/removeformat.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/right_to_left.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/save.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/sep.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/space.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/strikethrough.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/subscript.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/superscript.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/underline.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/undo.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/buttons/wikiword.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/check.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/decrementMonth.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/decrementWeek.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/grabCorner.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/Tree.css
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/blank.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/closed.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/document.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/minus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/plus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/transparent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_blank.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_child.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_expand_minus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_expand_plus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_c.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_p.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_t.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_v.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_x.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_y.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_z.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_loading.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_loading.jpg
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/closed.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/document.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_leaf.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_loading.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_minus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_plus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_bhalf.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_half.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_long.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/minus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/open.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/plus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/t.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/x.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/bar.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/bdYearBg.1.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/bdYearBg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/blank.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/clock.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/combo_box_arrow.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dateIcon.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/decrementMonth.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/decrementMonth.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpBg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveBL.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveBR.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveTL.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveTR.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpHorizLine.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpHorizLineFoot.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg2.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpVertLine.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpYearBg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dpYearBg.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dropdownButtonsArrow-disabled.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/dropdownButtonsArrow.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneClose.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneMaximize.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneMinimize.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneRestore.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/h-bar.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/incrementMonth.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/incrementMonth.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/no.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/no.svg
   tags/parley-0.55/root/static/magic/src/widget/templates/images/scBackground.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg-progress-vert.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg-vert.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button-horz.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button-vert.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_down_arrow.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_left_arrow.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_right_arrow.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_up_arrow.png
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaAccordionOff.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaAccordionSelected.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-c.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-r.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaBarBg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-c.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-r.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-c.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-r.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaMenuBg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-c.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-r.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/spinnerDecrement.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/spinnerIncrement.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_disabled.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_off.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_on.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_left.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_left_curr.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_right.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_right_curr.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_close.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_close_h.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left_r.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left_r_curr.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right_r.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right_r_curr.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_top_left.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_top_right.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/timeIcon.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/toolbar-bg.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/transparent.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_blank.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_child.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_expand_minus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_expand_plus.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_c.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_l.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_p.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_t.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_v.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_x.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_y.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_z.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_node.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/verticalbar.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/images/whiteDownArrow.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/incrementMonth.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/incrementWeek.gif
   tags/parley-0.55/root/static/magic/src/widget/templates/richtextframe.html
   tags/parley-0.55/root/static/magic/src/widget/validate.js
   tags/parley-0.55/root/static/magic/src/widget/vml/
   tags/parley-0.55/root/static/magic/src/widget/vml/Chart.js
   tags/parley-0.55/root/static/magic/src/xml/
   tags/parley-0.55/root/static/magic/src/xml/Parse.js
   tags/parley-0.55/root/static/magic/src/xml/XslTransform.js
   tags/parley-0.55/root/static/magic/src/xml/__package__.js
   tags/parley-0.55/root/static/script/
   tags/parley-0.55/root/static/script/prototype.js
   tags/parley-0.55/root/static/user_file/
   tags/parley-0.55/script/
   tags/parley-0.55/script/parley_cgi.pl
   tags/parley-0.55/script/parley_create.pl
   tags/parley-0.55/script/parley_email_engine.pl
   tags/parley-0.55/script/parley_fastcgi.pl
   tags/parley-0.55/script/parley_server.pl
   tags/parley-0.55/script/parley_test.pl
   tags/parley-0.55/script/time_string_sample.pl
   tags/parley-0.55/t/
   tags/parley-0.55/t/01app.t
   tags/parley-0.55/t/02pod.t
   tags/parley-0.55/t/03podcoverage.t
   tags/parley-0.55/t/04_forumcode.t
   tags/parley-0.55/t/50.text_search.sql.t
   tags/parley-0.55/t/controller_Admin.t
   tags/parley-0.55/t/controller_Forum.t
   tags/parley-0.55/t/controller_Help.t
   tags/parley-0.55/t/controller_My.t
   tags/parley-0.55/t/controller_Post.t
   tags/parley-0.55/t/controller_Search.t
   tags/parley-0.55/t/controller_Thread.t
   tags/parley-0.55/t/controller_User.t
   tags/parley-0.55/t/model_ParleyDB.t
   tags/parley-0.55/t/view_Plain.t
   tags/parley-0.55/t/view_TT.t
Modified:
   /
Log:
 <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">r3761 at wiggin</A>:  chisel | 2007-08-31 08:18:08 +0100
 Tagging v0.55 of Parley



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 6a361f96-f029-0410-94f8-848cdd0f6ccf:/local/parley:3760
6fba2e3f-c318-0410-85fa-910d1bc53201:/local/parley:5151
c0683b51-46fc-0310-adae-a083e7ee0929:/local/berlios/parley:15762
f1659af6-751b-0410-a472-c93ec2bf8afc:/local/parley:1222
   + 6a361f96-f029-0410-94f8-848cdd0f6ccf:/local/parley:3761
6fba2e3f-c318-0410-85fa-910d1bc53201:/local/parley:5151
c0683b51-46fc-0310-adae-a083e7ee0929:/local/berlios/parley:15762
f1659af6-751b-0410-a472-c93ec2bf8afc:/local/parley:1222


Property changes on: tags/parley-0.55
___________________________________________________________________
Name: svn:ignore
   + *gz
*swp
Makefile
Makefile.old
blib
inc
MANIFEST.bak
META.yml


Added: tags/parley-0.55/Changes
===================================================================
--- tags/parley-0.55/Changes	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/Changes	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,176 @@
+This file documents the revision history for Parley.
+
+0.55    Fri Aug 31 08:06:25 BST 2007
+    - users can now upload an avatar image (from my/preferences)
+    - properly fixed Password Reset process
+    - added database updating for edit-fields on &quot;Your Details&quot; in
+      my/preferences
+    - removed (redundant) root/static/magic/src-0.4.2/ directory
+
+0.54    Thu Aug  9 09:01:48 BST 2007
+    - fixed Password Reset process [DFV profile out of date]
+    - factored out some common functionality (DFV contraints and &quot;intervals&quot;)
+    - added &quot;&lt;interval&gt; ago&quot; to post information displayed in thread/view
+    - fix bug where we don't store IP for thread/add (first post)
+    - added paging to forum/view page
+    - added paging to thread/recent page
+    - added thread/watches; moving functionality out of my/preferences
+    - added initial help pages
+    - more UI, layout and CSS modifications
+
+0.53    Wed Jul  4 08:55:12 BST 2007
+    - added a basic profile page for users
+    - added more missing dependencies to Makefile.PL
+    - added more time/TZ options for user
+    - automatically add thread-watch on new thread/post
+      (checkbox value defaults to appropriate pref value for user)
+    - fixed output when no threads are watched (Watches in Preferences)
+    - fix for bug with person.preference not being set when new user is created
+    - improved preference screen (time, watch info, notifications)
+    - improved Template::Plugin::ForumCode (markup and docs)
+    - improve form handling for prefs
+    - navigation is now through the dojo menu widget; #navigation and #extra areas are now empty
+    - person preference data now created at sign-up time
+    - preferences are now in a tabbed container
+    - reimplemented post/edit
+    - reimplemented post/edit (lost in the 0.5 rewrite)
+    - schema tweaks and fixes
+    - store the IP address of each post author
+    - tidied up CSS and layout
+
+0.52    Fri May  4 19:00:32 BST 2007
+
+    - added DB configuration to parley.yml
+    - added missing dependencies to Makefile.PL
+    - added Quick Start guide
+
+0.51    Fri May  4 08:27:57 BST 2007
+
+    - added initial moderator code
+    - added moderator actions on forum/thread views (lock/stick)
+    - moderators can lock threads at posting time (lock + reason)
+    - raise error when trying to reply to a locked thread (prevent &quot;Evil Hackers&quot; replying)
+    - hide Reply and Quote buttons for locked thread
+    - added pager and reply button to bottom of thread/view
+    - added &quot;Thread Locked&quot; to thread/view if thread is locked
+    - added thread/recent for list of all recently updated threads
+    - added thread/recent?forum=X for list of all recently updated threads in a
+      given forum
+    - post_count for forums now incremented with new posts
+    - basic search functionality added
+
+0.50    Thu Apr  5 08:31:04 BST 2007
+
+    THIS RELEASE ENCOMPASSES A GROUND-UP RE-WRITE. Previous functionality may
+    not yet have been re-implemented.
+
+    - written email daemon to send queued Parley emails
+    - thread-watchers now get an email queued to tell them there's something to
+      read
+    - login_if_required() now uses detach() instead of redirect()
+    - last_post_in_list() [Schema::Post] no longer uses slice()
+    - try to display user avatar image in a [% TRY/CATCH %] block, showing
+      nothing if it fails (i.e. user has no avatar)
+    - update DFV profile for DFV 4.50
+    - logged-in users get bounced from user/signup to the default_uri
+    - moved send_email() out to Parley::Communication::Email
+    - send_email() now uses queue_email() to insert pending emails into
+      database queue instead of sending immediately
+    - consolidate schema and patches
+    - add email_queue table to database and modify
+      Schema::EmailQueue accordingly
+    - fix post/view to work with [new?] uri_for() syntax
+    - re-implement, starting from a fresh call to catalyst.pl
+    - use Schema based model
+    - general tidy-up of existing methods
+
+    - thread/add: start work on new message notification
+    - thread/watch: set/remove a watch on a thread (in preparation for
+      notification emails)
+    - thread/next_post: continue reading a thread from where you last saw it
+    - thread/view: if logged in keep track of thread viewing progress
+    - started moving from Prototype to Dojo
+    - added thread_post_count(), thread_position() and page_containing_post()
+      to Post model class
+    - added /post/view action, used to redirect to a thread page containing the
+      specified post
+    - /thread/view now detach()es to /post/view if we have a current_post in
+      the stash
+
+0.09  Thu May 11 17:50:07 BST 2006
+    - make email column unique
+      ** this may cause problems if you already have a large amount of user data **
+    - added lost password functionality in Controller::User::LostPassword
+    - factored signup functionality out into Controller::User::SignUp
+    - start moving towards use of &lt;fieldset&gt; instead of &lt;table&gt; for form layout
+    - use a floating loginbox instead of a separate screen (as inspired by
+      calendarhub.com)
+    - added visual feedback when TZ preference is updated
+    - show time-formatting sample in my/preferences
+    - store the referer when visiting my/preferences making it easier to return
+      to where we were previously
+    - added about/modules, an easier way to obtain version information for
+      loaded modules
+    - modify log-in check in auto() to use Auth::DBIC calling style
+    - use ConfigLoader plugin to load application config
+    - add authed_user() function, and alter instances of
+      $c-&gt;session-&gt;{authed_user} accordingly
+    - added new function to Parley::App::Helper - application_email_address()
+    - update dependencies/versions in Makefile.PL
+    - added Template::Plugin::ForumCode (not all BBCode functionality is
+      complete yet)
+    - use ForumCode plugin to process various display elements
+    - email from-address for emails is now set in config file
+    - new helper function application_email_address()
+    - small layout fixes
+    - change name of session file
+    - ammend statusbar and post-edit templating to work correctly with new
+      storage location of authed_user object
+
+0.08  Tue Jan 31 08:54:32 GMT 2006
+    - move to using uri_for(...) in redirects
+    - hide per-post actions in a locked thread
+    - allow users to edit their own posts
+    - show if a post has been edited
+    - added paging for long threads (fixed to 10 posts/thread for the moment)
+    - if we have a post when viewing thread, go to last page in thread
+      [ideally we'd like to go to the page containing the post, but we don't
+      know how to work this out yet]
+
+0.07  Thu Jan 26 08:49:19 GMT 2006
+    - added preference table to main schema
+    - added patch file for moving from 0.06 to 0.07 db schema
+    - nicedate() sets timezone to value in user's preference
+    - added my/preferences page, to allow setting of timezone area
+    - fixed behaviour with login_if_required() in auto()
+    - store updated and valid timezone prefs
+    - update schema to include new columns (post.reply_to, person.last_post,
+      person.post_count)
+    - update person.count after a new post or reply
+    - alter thread view layout and include post count for person
+    - store user's last post (not sure why we might want this, it just feels
+      useful)
+    - make &quot;reply to post&quot; button work as expected
+    - allow users to quote a previous reply, and display quoted text with post
+      in thread view
+
+0.06  Sun Jan 22 23:14:31 GMT 2006
+    - added and updated module dependencies in Makefile.PL
+    - added application warning if using known 'bad version' of
+      DBIx::Class::Loader
+    - display thread's first post on reply screen
+    - re-copied end() feom DefaultEnd plugin, and applied local additions
+      This fixed an unexplained bug when logging out
+    - removed / from form actions in login and signup
+    - remove signup table width to avoid IE 100% bug
+    - warn if using buggy DBIx::Class::Loader
+    - fixed authed_user info fetch to use joins
+    - added sticky and locked columns to thread table
+    - order thread list to show sticky threads first
+    - don't show Reply row if a thread is locked
+    
+    There's no interface method for setting a thread sticky/locked yet
+
+
+0.01  Wed Jan  4 09:39:38 2006
+        - initial revision, generated by Catalyst

Added: tags/parley-0.55/MANIFEST
===================================================================
--- tags/parley-0.55/MANIFEST	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/MANIFEST	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,895 @@
+Changes
+db/parley.psql
+db/patch.skel
+db/patch_0.06_to_0.07.psql
+db/patch_0.07_to_0.08.psql
+db/patch_0.08_to_0.09.psql
+db/patch_0.09_to_0.10.psql
+db/patch_0.50_to_0.51.psql
+db/patch_0.52_to_0.53.psql
+doc/parley-qs.html
+inc/Module/AutoInstall.pm
+inc/Module/Install.pm
+inc/Module/Install/AutoInstall.pm
+inc/Module/Install/Base.pm
+inc/Module/Install/Can.pm
+inc/Module/Install/Catalyst.pm
+inc/Module/Install/Fetch.pm
+inc/Module/Install/Include.pm
+inc/Module/Install/Makefile.pm
+inc/Module/Install/Metadata.pm
+inc/Module/Install/Scripts.pm
+inc/Module/Install/Win32.pm
+inc/Module/Install/WriteAll.pm
+interval.pl
+lib/Parley.pm
+lib/Parley/App/Communication/Email.pm
+lib/Parley/App/DateTime.pm
+lib/Parley/App/DFV.pm
+lib/Parley/App/Error.pm
+lib/Parley/App/Notification.pm
+lib/Parley/Controller/Admin.pm
+lib/Parley/Controller/Forum.pm
+lib/Parley/Controller/Help.pm
+lib/Parley/Controller/My.pm
+lib/Parley/Controller/Post.pm
+lib/Parley/Controller/Root.pm
+lib/Parley/Controller/Search.pm
+lib/Parley/Controller/Thread.pm
+lib/Parley/Controller/User.pm
+lib/Parley/Controller/User/LostPassword.pm
+lib/Parley/Controller/User/SignUp.pm
+lib/Parley/Model/ParleyDB.pm
+lib/Parley/Schema.pm
+lib/Parley/Schema/Authentication.pm
+lib/Parley/Schema/EmailQueue.pm
+lib/Parley/Schema/Forum.pm
+lib/Parley/Schema/ForumModerator.pm
+lib/Parley/Schema/PasswordReset.pm
+lib/Parley/Schema/Person.pm
+lib/Parley/Schema/Post.pm
+lib/Parley/Schema/Preference.pm
+lib/Parley/Schema/PreferenceTimeString.pm
+lib/Parley/Schema/RegistrationAuthentication.pm
+lib/Parley/Schema/Thread.pm
+lib/Parley/Schema/ThreadView.pm
+lib/Parley/View/Plain.pm
+lib/Parley/View/TT.pm
+lib/Template/Plugin/ForumCode.pm
+lib/Text/Search/SQL.pm
+Makefile.PL
+MANIFEST			This list of files
+MANIFEST.bak
+MANIFEST.foo
+MANIFEST.SKIP
+META.yml
+parley.yml
+README
+root/base/about/modules
+root/base/error/simple
+root/base/footer
+root/base/forum/list
+root/base/forum/view
+root/base/header
+root/base/help/contents
+root/base/help/faq
+root/base/help/formatting_posts
+root/base/help/unknown
+root/base/menu/left/main
+root/base/menu/menubar
+root/base/menu/statusbar
+root/base/my/preferences
+root/base/my/selectplace_ajaxresult
+root/base/my/tab_avatar
+root/base/my/tab_notifications
+root/base/my/tab_time
+root/base/my/tab_watch
+root/base/my/tab_you
+root/base/post/edit
+root/base/search/forum
+root/base/shared/autocomplete_style
+root/base/shared/focus_username_js
+root/base/shared/login_dialog
+root/base/shared/moderator_list
+root/base/shared/navigation
+root/base/shared/pager_advanced
+root/base/shared/search_dialog
+root/base/shared/thread_watch
+root/base/shared/threadcrumbs
+root/base/shared/useful_tt_stuff
+root/base/shared/user_avatar
+root/base/shared/user_status
+root/base/thread/add
+root/base/thread/recent
+root/base/thread/reply
+root/base/thread/view
+root/base/thread/watches
+root/base/user/auth_emailed
+root/base/user/auth_success
+root/base/user/login
+root/base/user/lostpassword/lost_password
+root/base/user/lostpassword/lost_password_details_sent
+root/base/user/lostpassword/reset
+root/base/user/lostpassword/reset_success
+root/base/user/profile
+root/base/user/signup/signup
+root/controls.js
+root/css/common.css
+root/css/default.css
+root/css/images/bg.gif
+root/css/images/client_logo.gif
+root/css/images/logo.png
+root/css/layout23.css
+root/css/layout27.css
+root/css/layout28.css
+root/css/layout33.css
+root/dragdrop.js
+root/effects.js
+root/email_templates/authentication_email.eml
+root/email_templates/password_reset.eml
+root/email_templates/thread_update_notify.eml
+root/email_templates/thread_update_notify.html
+root/email_templates/username_reminder.eml
+root/favicon.ico
+root/prototype.js
+root/static/images/btn_120x50_built.png
+root/static/images/btn_120x50_built_shadow.png
+root/static/images/btn_120x50_powered.png
+root/static/images/btn_120x50_powered_shadow.png
+root/static/images/btn_88x31_built.png
+root/static/images/btn_88x31_built_shadow.png
+root/static/images/btn_88x31_powered.png
+root/static/images/btn_88x31_powered_shadow.png
+root/static/images/catalyst_logo.png
+root/static/images/filetypes/image.png
+root/static/images/filetypes/pdf.png
+root/static/images/locked.png
+root/static/images/sticky.png
+root/static/images/unread_posts.gif
+root/static/magic/dojo.js
+root/static/magic/iframe_history.html
+root/static/magic/src/a11y.js
+root/static/magic/src/AdapterRegistry.js
+root/static/magic/src/animation.js
+root/static/magic/src/animation/__package__.js
+root/static/magic/src/animation/Animation.js
+root/static/magic/src/animation/AnimationEvent.js
+root/static/magic/src/animation/AnimationSequence.js
+root/static/magic/src/animation/Timer.js
+root/static/magic/src/behavior.js
+root/static/magic/src/bootstrap1.js
+root/static/magic/src/browser_debug.js
+root/static/magic/src/browser_debug_xd.js
+root/static/magic/src/cal/iCalendar.js
+root/static/magic/src/cal/textDirectory.js
+root/static/magic/src/charting/__package__.js
+root/static/magic/src/charting/Axis.js
+root/static/magic/src/charting/Chart.js
+root/static/magic/src/charting/Plot.js
+root/static/magic/src/charting/PlotArea.js
+root/static/magic/src/charting/Plotters.js
+root/static/magic/src/charting/README.txt
+root/static/magic/src/charting/Series.js
+root/static/magic/src/charting/svg/Axis.js
+root/static/magic/src/charting/svg/PlotArea.js
+root/static/magic/src/charting/svg/Plotters.js
+root/static/magic/src/charting/vml/Axis.js
+root/static/magic/src/charting/vml/PlotArea.js
+root/static/magic/src/charting/vml/Plotters.js
+root/static/magic/src/collections/__package__.js
+root/static/magic/src/collections/ArrayList.js
+root/static/magic/src/collections/BinaryTree.js
+root/static/magic/src/collections/Collections.js
+root/static/magic/src/collections/Dictionary.js
+root/static/magic/src/collections/Graph.js
+root/static/magic/src/collections/Queue.js
+root/static/magic/src/collections/Set.js
+root/static/magic/src/collections/SkipList.js
+root/static/magic/src/collections/SortedList.js
+root/static/magic/src/collections/Stack.js
+root/static/magic/src/collections/Store.js
+root/static/magic/src/crypto.js
+root/static/magic/src/crypto/__package__.js
+root/static/magic/src/crypto/Blowfish.js
+root/static/magic/src/crypto/LICENSE
+root/static/magic/src/crypto/MD5.js
+root/static/magic/src/crypto/Rijndael.js
+root/static/magic/src/crypto/SHA1.js
+root/static/magic/src/crypto/SHA256.js
+root/static/magic/src/data.js
+root/static/magic/src/data/core/Read.js
+root/static/magic/src/data/core/RemoteStore.js
+root/static/magic/src/data/core/Result.js
+root/static/magic/src/data/core/Write.js
+root/static/magic/src/data/CsvStore.js
+root/static/magic/src/data/old/__package__.js
+root/static/magic/src/data/old/Attribute.js
+root/static/magic/src/data/old/format/Csv.js
+root/static/magic/src/data/old/format/Json.js
+root/static/magic/src/data/old/Item.js
+root/static/magic/src/data/old/Kind.js
+root/static/magic/src/data/old/Observable.js
+root/static/magic/src/data/old/provider/Base.js
+root/static/magic/src/data/old/provider/Delicious.js
+root/static/magic/src/data/old/provider/FlatFile.js
+root/static/magic/src/data/old/provider/JotSpot.js
+root/static/magic/src/data/old/provider/MySql.js
+root/static/magic/src/data/old/ResultSet.js
+root/static/magic/src/data/old/to_do.txt
+root/static/magic/src/data/old/Type.js
+root/static/magic/src/data/old/Value.js
+root/static/magic/src/data/OpmlStore.js
+root/static/magic/src/data/RdfStore.js
+root/static/magic/src/data/YahooStore.js
+root/static/magic/src/date.js
+root/static/magic/src/date/common.js
+root/static/magic/src/date/format.js
+root/static/magic/src/date/serialize.js
+root/static/magic/src/date/supplemental.js
+root/static/magic/src/debug.js
+root/static/magic/src/debug/arrow_hide.gif
+root/static/magic/src/debug/arrow_show.gif
+root/static/magic/src/debug/console.js
+root/static/magic/src/debug/deep.html
+root/static/magic/src/debug/Firebug.js
+root/static/magic/src/debug/spacer.gif
+root/static/magic/src/Deferred.js
+root/static/magic/src/DeferredList.js
+root/static/magic/src/dnd/__package__.js
+root/static/magic/src/dnd/DragAndDrop.js
+root/static/magic/src/dnd/HtmlDragAndDrop.js
+root/static/magic/src/dnd/HtmlDragCopy.js
+root/static/magic/src/dnd/HtmlDragManager.js
+root/static/magic/src/dnd/HtmlDragMove.js
+root/static/magic/src/dnd/Sortable.js
+root/static/magic/src/dnd/TreeDragAndDrop.js
+root/static/magic/src/dnd/TreeDragAndDropV3.js
+root/static/magic/src/docs.js
+root/static/magic/src/dom.js
+root/static/magic/src/event.js
+root/static/magic/src/event/__package__.js
+root/static/magic/src/event/browser.js
+root/static/magic/src/event/common.js
+root/static/magic/src/event/topic.js
+root/static/magic/src/experimental.js
+root/static/magic/src/flash.js
+root/static/magic/src/flash/flash6/DojoExternalInterface.as
+root/static/magic/src/flash/flash6/flash6_gateway.fla
+root/static/magic/src/flash/flash8/DojoExternalInterface.as
+root/static/magic/src/flash/flash8/ExpressInstall.as
+root/static/magic/src/gfx/__package__.js
+root/static/magic/src/gfx/color.js
+root/static/magic/src/gfx/color/hsl.js
+root/static/magic/src/gfx/color/hsv.js
+root/static/magic/src/gfx/Colorspace.js
+root/static/magic/src/gfx/common.js
+root/static/magic/src/gfx/matrix.js
+root/static/magic/src/gfx/path.js
+root/static/magic/src/gfx/shape.js
+root/static/magic/src/gfx/svg.js
+root/static/magic/src/gfx/vml.js
+root/static/magic/src/graphics/__package__.js
+root/static/magic/src/graphics/color.js
+root/static/magic/src/graphics/color/hsl.js
+root/static/magic/src/graphics/color/hsv.js
+root/static/magic/src/graphics/Colorspace.js
+root/static/magic/src/hostenv_adobesvg.js
+root/static/magic/src/hostenv_browser.js
+root/static/magic/src/hostenv_dashboard.js
+root/static/magic/src/hostenv_jsc.js
+root/static/magic/src/hostenv_rhino.js
+root/static/magic/src/hostenv_spidermonkey.js
+root/static/magic/src/hostenv_svg.js
+root/static/magic/src/hostenv_wsh.js
+root/static/magic/src/html.js
+root/static/magic/src/html/__package__.js
+root/static/magic/src/html/color.js
+root/static/magic/src/html/common.js
+root/static/magic/src/html/display.js
+root/static/magic/src/html/iframe.js
+root/static/magic/src/html/images/shadowB.png
+root/static/magic/src/html/images/shadowBL.png
+root/static/magic/src/html/images/shadowBR.png
+root/static/magic/src/html/images/shadowL.png
+root/static/magic/src/html/images/shadowR.png
+root/static/magic/src/html/images/shadowT.png
+root/static/magic/src/html/images/shadowTL.png
+root/static/magic/src/html/images/shadowTR.png
+root/static/magic/src/html/layout.js
+root/static/magic/src/html/metrics.js
+root/static/magic/src/html/selection.js
+root/static/magic/src/html/shadow.js
+root/static/magic/src/html/style.js
+root/static/magic/src/html/util.js
+root/static/magic/src/i18n/calendar/nls/de/gregorian.js
+root/static/magic/src/i18n/calendar/nls/en/gregorian.js
+root/static/magic/src/i18n/calendar/nls/es/gregorian.js
+root/static/magic/src/i18n/calendar/nls/fi/gregorian.js
+root/static/magic/src/i18n/calendar/nls/fr/gregorian.js
+root/static/magic/src/i18n/calendar/nls/gregorian.js
+root/static/magic/src/i18n/calendar/nls/gregorianExtras.js
+root/static/magic/src/i18n/calendar/nls/hu/gregorian.js
+root/static/magic/src/i18n/calendar/nls/it/gregorian.js
+root/static/magic/src/i18n/calendar/nls/ja/gregorian.js
+root/static/magic/src/i18n/calendar/nls/ja/gregorianExtras.js
+root/static/magic/src/i18n/calendar/nls/ko/gregorian.js
+root/static/magic/src/i18n/calendar/nls/nl/gregorian.js
+root/static/magic/src/i18n/calendar/nls/pt-br/gregorian.js
+root/static/magic/src/i18n/calendar/nls/pt/gregorian.js
+root/static/magic/src/i18n/calendar/nls/README
+root/static/magic/src/i18n/calendar/nls/sv/gregorian.js
+root/static/magic/src/i18n/calendar/nls/zh-cn/gregorian.js
+root/static/magic/src/i18n/calendar/nls/zh-hk/gregorian.js
+root/static/magic/src/i18n/calendar/nls/zh-tw/gregorian.js
+root/static/magic/src/i18n/calendar/nls/zh/gregorian.js
+root/static/magic/src/i18n/calendar/nls/zh/gregorianExtras.js
+root/static/magic/src/i18n/common.js
+root/static/magic/src/i18n/currency.js
+root/static/magic/src/i18n/currency/common.js
+root/static/magic/src/i18n/currency/nls/en-us/USD.js
+root/static/magic/src/i18n/currency/nls/en/EUR.js
+root/static/magic/src/i18n/currency/nls/en/GBP.js
+root/static/magic/src/i18n/currency/nls/en/INR.js
+root/static/magic/src/i18n/currency/nls/en/ITL.js
+root/static/magic/src/i18n/currency/nls/en/JPY.js
+root/static/magic/src/i18n/currency/nls/en/USD.js
+root/static/magic/src/i18n/currency/nls/EUR.js
+root/static/magic/src/i18n/currency/nls/GBP.js
+root/static/magic/src/i18n/currency/nls/hi/EUR.js
+root/static/magic/src/i18n/currency/nls/hi/GBP.js
+root/static/magic/src/i18n/currency/nls/hi/INR.js
+root/static/magic/src/i18n/currency/nls/hi/ITL.js
+root/static/magic/src/i18n/currency/nls/hi/JPY.js
+root/static/magic/src/i18n/currency/nls/hi/USD.js
+root/static/magic/src/i18n/currency/nls/INR.js
+root/static/magic/src/i18n/currency/nls/ITL.js
+root/static/magic/src/i18n/currency/nls/ja/EUR.js
+root/static/magic/src/i18n/currency/nls/ja/GBP.js
+root/static/magic/src/i18n/currency/nls/ja/INR.js
+root/static/magic/src/i18n/currency/nls/ja/ITL.js
+root/static/magic/src/i18n/currency/nls/ja/JPY.js
+root/static/magic/src/i18n/currency/nls/ja/USD.js
+root/static/magic/src/i18n/currency/nls/JPY.js
+root/static/magic/src/i18n/currency/nls/README
+root/static/magic/src/i18n/currency/nls/USD.js
+root/static/magic/src/i18n/number.js
+root/static/magic/src/iCalendar.js
+root/static/magic/src/io.js
+root/static/magic/src/io/__package__.js
+root/static/magic/src/io/BrowserIO.js
+root/static/magic/src/io/cometd.js
+root/static/magic/src/io/common.js
+root/static/magic/src/io/cookie.js
+root/static/magic/src/io/IframeIO.js
+root/static/magic/src/io/RepubsubIO.js
+root/static/magic/src/io/RhinoIO.js
+root/static/magic/src/io/ScriptSrcIO.js
+root/static/magic/src/io/XhrIframeProxy.js
+root/static/magic/src/io/xip_client.html
+root/static/magic/src/io/xip_server.html
+root/static/magic/src/json.js
+root/static/magic/src/lang.js
+root/static/magic/src/lang/__package__.js
+root/static/magic/src/lang/array.js
+root/static/magic/src/lang/assert.js
+root/static/magic/src/lang/common.js
+root/static/magic/src/lang/declare.js
+root/static/magic/src/lang/extras.js
+root/static/magic/src/lang/func.js
+root/static/magic/src/lang/repr.js
+root/static/magic/src/lang/timing/__package__.js
+root/static/magic/src/lang/timing/Streamer.js
+root/static/magic/src/lang/timing/Timer.js
+root/static/magic/src/lang/type.js
+root/static/magic/src/lfx/__package__.js
+root/static/magic/src/lfx/Animation.js
+root/static/magic/src/lfx/extras.js
+root/static/magic/src/lfx/html.js
+root/static/magic/src/lfx/rounded.js
+root/static/magic/src/lfx/shadow.js
+root/static/magic/src/lfx/toggle.js
+root/static/magic/src/loader.js
+root/static/magic/src/loader_xd.js
+root/static/magic/src/logging/__package__.js
+root/static/magic/src/logging/ConsoleLogger.js
+root/static/magic/src/logging/Logger.js
+root/static/magic/src/math.js
+root/static/magic/src/math/__package__.js
+root/static/magic/src/math/curves.js
+root/static/magic/src/math/matrix.js
+root/static/magic/src/math/points.js
+root/static/magic/src/namespaces/dojo.js
+root/static/magic/src/ns.js
+root/static/magic/src/profile.js
+root/static/magic/src/regexp.js
+root/static/magic/src/rpc/__package__.js
+root/static/magic/src/rpc/Deferred.js
+root/static/magic/src/rpc/JotService.js
+root/static/magic/src/rpc/JsonService.js
+root/static/magic/src/rpc/RpcService.js
+root/static/magic/src/rpc/yahoo.smd
+root/static/magic/src/rpc/YahooService.js
+root/static/magic/src/selection/Selection.js
+root/static/magic/src/storage.js
+root/static/magic/src/storage/__package__.js
+root/static/magic/src/storage/browser.js
+root/static/magic/src/storage/java/DojoFileStorageProvider.class
+root/static/magic/src/storage/java/DojoFileStorageProvider.java
+root/static/magic/src/storage/Storage.as
+root/static/magic/src/storage/storage_dialog.fla
+root/static/magic/src/string.js
+root/static/magic/src/string/__package__.js
+root/static/magic/src/string/Builder.js
+root/static/magic/src/string/common.js
+root/static/magic/src/string/extras.js
+root/static/magic/src/style.js
+root/static/magic/src/svg.js
+root/static/magic/src/text/__package__.js
+root/static/magic/src/text/textDirectory.js
+root/static/magic/src/undo/__package__.js
+root/static/magic/src/undo/browser.js
+root/static/magic/src/undo/Manager.js
+root/static/magic/src/uri/__package__.js
+root/static/magic/src/uri/cache.js
+root/static/magic/src/uri/Uri.js
+root/static/magic/src/uuid/__package__.js
+root/static/magic/src/uuid/LightweightGenerator.js
+root/static/magic/src/uuid/NameBasedGenerator.js
+root/static/magic/src/uuid/NilGenerator.js
+root/static/magic/src/uuid/RandomGenerator.js
+root/static/magic/src/uuid/TimeBasedGenerator.js
+root/static/magic/src/uuid/Uuid.js
+root/static/magic/src/validate.js
+root/static/magic/src/validate/__package__.js
+root/static/magic/src/validate/check.js
+root/static/magic/src/validate/common.js
+root/static/magic/src/validate/creditCard.js
+root/static/magic/src/validate/datetime.js
+root/static/magic/src/validate/de.js
+root/static/magic/src/validate/jp.js
+root/static/magic/src/validate/us.js
+root/static/magic/src/validate/web.js
+root/static/magic/src/widget/__package__.js
+root/static/magic/src/widget/AccordionContainer.js
+root/static/magic/src/widget/AnimatedPng.js
+root/static/magic/src/widget/Button.js
+root/static/magic/src/widget/Chart.js
+root/static/magic/src/widget/Checkbox.js
+root/static/magic/src/widget/Clock.js
+root/static/magic/src/widget/ColorPalette.js
+root/static/magic/src/widget/ComboBox.js
+root/static/magic/src/widget/ContentPane.js
+root/static/magic/src/widget/CurrencyTextbox.js
+root/static/magic/src/widget/DatePicker.js
+root/static/magic/src/widget/DateTextbox.js
+root/static/magic/src/widget/DebugConsole.js
+root/static/magic/src/widget/demoEngine/__package__.js
+root/static/magic/src/widget/demoEngine/DemoContainer.js
+root/static/magic/src/widget/demoEngine/DemoItem.js
+root/static/magic/src/widget/demoEngine/DemoNavigator.js
+root/static/magic/src/widget/demoEngine/DemoPane.js
+root/static/magic/src/widget/demoEngine/SourcePane.js
+root/static/magic/src/widget/demoEngine/templates/DemoContainer.css
+root/static/magic/src/widget/demoEngine/templates/DemoContainer.html
+root/static/magic/src/widget/demoEngine/templates/DemoItem.css
+root/static/magic/src/widget/demoEngine/templates/DemoItem.html
+root/static/magic/src/widget/demoEngine/templates/DemoNavigator.css
+root/static/magic/src/widget/demoEngine/templates/DemoNavigator.html
+root/static/magic/src/widget/demoEngine/templates/DemoPane.css
+root/static/magic/src/widget/demoEngine/templates/DemoPane.html
+root/static/magic/src/widget/demoEngine/templates/general.css
+root/static/magic/src/widget/demoEngine/templates/images/test_thumb.gif
+root/static/magic/src/widget/demoEngine/templates/images/viewDemo.png
+root/static/magic/src/widget/demoEngine/templates/SourcePane.css
+root/static/magic/src/widget/demoEngine/templates/SourcePane.html
+root/static/magic/src/widget/Dialog.js
+root/static/magic/src/widget/DocPane.js
+root/static/magic/src/widget/DomWidget.js
+root/static/magic/src/widget/DropdownContainer.js
+root/static/magic/src/widget/DropdownDatePicker.js
+root/static/magic/src/widget/DropdownTimePicker.js
+root/static/magic/src/widget/Editor.js
+root/static/magic/src/widget/Editor2.js
+root/static/magic/src/widget/Editor2Plugin/__package__.js
+root/static/magic/src/widget/Editor2Plugin/AlwaysShowToolbar.js
+root/static/magic/src/widget/Editor2Plugin/ContextMenu.js
+root/static/magic/src/widget/Editor2Plugin/CreateLinkDialog.js
+root/static/magic/src/widget/Editor2Plugin/FindReplace.js
+root/static/magic/src/widget/Editor2Plugin/FindReplaceDialog.js
+root/static/magic/src/widget/Editor2Plugin/InsertImageDialog.js
+root/static/magic/src/widget/Editor2Plugin/InsertTableDialog.js
+root/static/magic/src/widget/Editor2Plugin/SimpleSignalCommands.js
+root/static/magic/src/widget/Editor2Plugin/TableOperation.js
+root/static/magic/src/widget/Editor2Plugin/ToolbarDndSupport.js
+root/static/magic/src/widget/Editor2Toolbar.js
+root/static/magic/src/widget/FilteringTable.js
+root/static/magic/src/widget/FisheyeList.js
+root/static/magic/src/widget/FloatingPane.js
+root/static/magic/src/widget/Form.js
+root/static/magic/src/widget/GoogleMap.js
+root/static/magic/src/widget/html/layout.js
+root/static/magic/src/widget/html/loader.js
+root/static/magic/src/widget/html/stabile.js
+root/static/magic/src/widget/HtmlWidget.js
+root/static/magic/src/widget/InlineEditBox.js
+root/static/magic/src/widget/IntegerTextbox.js
+root/static/magic/src/widget/InternetTextbox.js
+root/static/magic/src/widget/LayoutContainer.js
+root/static/magic/src/widget/LinkPane.js
+root/static/magic/src/widget/Manager.js
+root/static/magic/src/widget/Menu2.js
+root/static/magic/src/widget/MonthlyCalendar.js
+root/static/magic/src/widget/nls/DropdownDatePicker.js
+root/static/magic/src/widget/nls/DropdownTimePicker.js
+root/static/magic/src/widget/nls/fr/validate.js
+root/static/magic/src/widget/nls/ja/validate.js
+root/static/magic/src/widget/nls/TimePicker.js
+root/static/magic/src/widget/nls/validate.js
+root/static/magic/src/widget/nls/zh-cn/validate.js
+root/static/magic/src/widget/PageContainer.js
+root/static/magic/src/widget/Parse.js
+root/static/magic/src/widget/PopupContainer.js
+root/static/magic/src/widget/ProgressBar.js
+root/static/magic/src/widget/RadioGroup.js
+root/static/magic/src/widget/RealNumberTextbox.js
+root/static/magic/src/widget/RegexpTextbox.js
+root/static/magic/src/widget/RemoteTabController.js
+root/static/magic/src/widget/Repeater.js
+root/static/magic/src/widget/ResizableTextarea.js
+root/static/magic/src/widget/ResizeHandle.js
+root/static/magic/src/widget/RichText.js
+root/static/magic/src/widget/Rounded.js
+root/static/magic/src/widget/Select.js
+root/static/magic/src/widget/Show.js
+root/static/magic/src/widget/ShowAction.js
+root/static/magic/src/widget/ShowSlide.js
+root/static/magic/src/widget/Slider.js
+root/static/magic/src/widget/SlideShow.js
+root/static/magic/src/widget/SortableTable.js
+root/static/magic/src/widget/Spinner.js
+root/static/magic/src/widget/SplitContainer.js
+root/static/magic/src/widget/svg/Chart.js
+root/static/magic/src/widget/SvgButton.js
+root/static/magic/src/widget/SvgWidget.js
+root/static/magic/src/widget/SwtWidget.js
+root/static/magic/src/widget/TabContainer.js
+root/static/magic/src/widget/TaskBar.js
+root/static/magic/src/widget/templates/AccordionPane.css
+root/static/magic/src/widget/templates/AccordionPane.html
+root/static/magic/src/widget/templates/buttons/aggregate.gif
+root/static/magic/src/widget/templates/buttons/backcolor.gif
+root/static/magic/src/widget/templates/buttons/bg-fade.png
+root/static/magic/src/widget/templates/buttons/bold.gif
+root/static/magic/src/widget/templates/buttons/cancel.gif
+root/static/magic/src/widget/templates/buttons/copy.gif
+root/static/magic/src/widget/templates/buttons/createlink.gif
+root/static/magic/src/widget/templates/buttons/cut.gif
+root/static/magic/src/widget/templates/buttons/delete.gif
+root/static/magic/src/widget/templates/buttons/forecolor.gif
+root/static/magic/src/widget/templates/buttons/hilitecolor.gif
+root/static/magic/src/widget/templates/buttons/indent.gif
+root/static/magic/src/widget/templates/buttons/inserthorizontalrule.gif
+root/static/magic/src/widget/templates/buttons/insertimage.gif
+root/static/magic/src/widget/templates/buttons/insertorderedlist.gif
+root/static/magic/src/widget/templates/buttons/inserttable.gif
+root/static/magic/src/widget/templates/buttons/insertunorderedlist.gif
+root/static/magic/src/widget/templates/buttons/italic.gif
+root/static/magic/src/widget/templates/buttons/justifycenter.gif
+root/static/magic/src/widget/templates/buttons/justifyfull.gif
+root/static/magic/src/widget/templates/buttons/justifyleft.gif
+root/static/magic/src/widget/templates/buttons/justifyright.gif
+root/static/magic/src/widget/templates/buttons/left_to_right.gif
+root/static/magic/src/widget/templates/buttons/list_bullet_indent.gif
+root/static/magic/src/widget/templates/buttons/list_bullet_outdent.gif
+root/static/magic/src/widget/templates/buttons/list_num_indent.gif
+root/static/magic/src/widget/templates/buttons/list_num_outdent.gif
+root/static/magic/src/widget/templates/buttons/outdent.gif
+root/static/magic/src/widget/templates/buttons/paste.gif
+root/static/magic/src/widget/templates/buttons/redo.gif
+root/static/magic/src/widget/templates/buttons/removeformat.gif
+root/static/magic/src/widget/templates/buttons/right_to_left.gif
+root/static/magic/src/widget/templates/buttons/save.gif
+root/static/magic/src/widget/templates/buttons/sep.gif
+root/static/magic/src/widget/templates/buttons/space.gif
+root/static/magic/src/widget/templates/buttons/strikethrough.gif
+root/static/magic/src/widget/templates/buttons/subscript.gif
+root/static/magic/src/widget/templates/buttons/superscript.gif
+root/static/magic/src/widget/templates/buttons/underline.gif
+root/static/magic/src/widget/templates/buttons/undo.gif
+root/static/magic/src/widget/templates/buttons/wikiword.gif
+root/static/magic/src/widget/templates/ButtonTemplate.css
+root/static/magic/src/widget/templates/ButtonTemplate.html
+root/static/magic/src/widget/templates/check.gif
+root/static/magic/src/widget/templates/Checkbox.css
+root/static/magic/src/widget/templates/Checkbox.html
+root/static/magic/src/widget/templates/CheckboxA11y.html
+root/static/magic/src/widget/templates/CiviCrmDatePicker.html
+root/static/magic/src/widget/templates/ComboBox.css
+root/static/magic/src/widget/templates/ComboBox.html
+root/static/magic/src/widget/templates/ComboButtonTemplate.html
+root/static/magic/src/widget/templates/DatePicker.css
+root/static/magic/src/widget/templates/DatePicker.html
+root/static/magic/src/widget/templates/decrementMonth.gif
+root/static/magic/src/widget/templates/decrementWeek.gif
+root/static/magic/src/widget/templates/DemoEngine.html
+root/static/magic/src/widget/templates/Dialog.html
+root/static/magic/src/widget/templates/DocPane.css
+root/static/magic/src/widget/templates/DocPane.html
+root/static/magic/src/widget/templates/DropDownButtonTemplate.html
+root/static/magic/src/widget/templates/Editor2/Dialog/createlink.html
+root/static/magic/src/widget/templates/Editor2/Dialog/find.html
+root/static/magic/src/widget/templates/Editor2/Dialog/insertimage.html
+root/static/magic/src/widget/templates/Editor2/Dialog/inserttable.html
+root/static/magic/src/widget/templates/Editor2/Dialog/replace.html
+root/static/magic/src/widget/templates/Editor2/EditorDialog.html
+root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontName.html
+root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontSize.html
+root/static/magic/src/widget/templates/Editor2/EditorToolbar_FormatBlock.html
+root/static/magic/src/widget/templates/Editor2/showtableborder_gecko.css
+root/static/magic/src/widget/templates/Editor2/showtableborder_ie.css
+root/static/magic/src/widget/templates/EditorToolbar.css
+root/static/magic/src/widget/templates/EditorToolbar.html
+root/static/magic/src/widget/templates/EditorToolbarOneline.html
+root/static/magic/src/widget/templates/FisheyeList.css
+root/static/magic/src/widget/templates/FloatingPane.css
+root/static/magic/src/widget/templates/FloatingPane.html
+root/static/magic/src/widget/templates/grabCorner.gif
+root/static/magic/src/widget/templates/images/bar.gif
+root/static/magic/src/widget/templates/images/bdYearBg.1.gif
+root/static/magic/src/widget/templates/images/bdYearBg.gif
+root/static/magic/src/widget/templates/images/blank.gif
+root/static/magic/src/widget/templates/images/clock.png
+root/static/magic/src/widget/templates/images/combo_box_arrow.png
+root/static/magic/src/widget/templates/images/dateIcon.gif
+root/static/magic/src/widget/templates/images/decrementMonth.gif
+root/static/magic/src/widget/templates/images/decrementMonth.png
+root/static/magic/src/widget/templates/images/dpBg.gif
+root/static/magic/src/widget/templates/images/dpCurveBL.png
+root/static/magic/src/widget/templates/images/dpCurveBR.png
+root/static/magic/src/widget/templates/images/dpCurveTL.png
+root/static/magic/src/widget/templates/images/dpCurveTR.png
+root/static/magic/src/widget/templates/images/dpHorizLine.gif
+root/static/magic/src/widget/templates/images/dpHorizLineFoot.gif
+root/static/magic/src/widget/templates/images/dpMonthBg.gif
+root/static/magic/src/widget/templates/images/dpMonthBg.png
+root/static/magic/src/widget/templates/images/dpMonthBg2.png
+root/static/magic/src/widget/templates/images/dpVertLine.gif
+root/static/magic/src/widget/templates/images/dpYearBg.gif
+root/static/magic/src/widget/templates/images/dpYearBg.png
+root/static/magic/src/widget/templates/images/dropdownButtonsArrow-disabled.gif
+root/static/magic/src/widget/templates/images/dropdownButtonsArrow.gif
+root/static/magic/src/widget/templates/images/floatingPaneClose.gif
+root/static/magic/src/widget/templates/images/floatingPaneMaximize.gif
+root/static/magic/src/widget/templates/images/floatingPaneMinimize.gif
+root/static/magic/src/widget/templates/images/floatingPaneRestore.gif
+root/static/magic/src/widget/templates/images/h-bar.gif
+root/static/magic/src/widget/templates/images/incrementMonth.gif
+root/static/magic/src/widget/templates/images/incrementMonth.png
+root/static/magic/src/widget/templates/images/no.gif
+root/static/magic/src/widget/templates/images/no.svg
+root/static/magic/src/widget/templates/images/scBackground.gif
+root/static/magic/src/widget/templates/images/slider-bg-progress-vert.gif
+root/static/magic/src/widget/templates/images/slider-bg-vert.gif
+root/static/magic/src/widget/templates/images/slider-bg.gif
+root/static/magic/src/widget/templates/images/slider-button-horz.png
+root/static/magic/src/widget/templates/images/slider-button-vert.png
+root/static/magic/src/widget/templates/images/slider-button.png
+root/static/magic/src/widget/templates/images/slider.gif
+root/static/magic/src/widget/templates/images/slider_down_arrow.png
+root/static/magic/src/widget/templates/images/slider_left_arrow.png
+root/static/magic/src/widget/templates/images/slider_right_arrow.png
+root/static/magic/src/widget/templates/images/slider_up_arrow.png
+root/static/magic/src/widget/templates/images/soriaAccordionOff.gif
+root/static/magic/src/widget/templates/images/soriaAccordionSelected.gif
+root/static/magic/src/widget/templates/images/soriaActive-c.gif
+root/static/magic/src/widget/templates/images/soriaActive-l.gif
+root/static/magic/src/widget/templates/images/soriaActive-r.gif
+root/static/magic/src/widget/templates/images/soriaBarBg.gif
+root/static/magic/src/widget/templates/images/soriaButton-c.gif
+root/static/magic/src/widget/templates/images/soriaButton-l.gif
+root/static/magic/src/widget/templates/images/soriaButton-r.gif
+root/static/magic/src/widget/templates/images/soriaDisabled-c.gif
+root/static/magic/src/widget/templates/images/soriaDisabled-l.gif
+root/static/magic/src/widget/templates/images/soriaDisabled-r.gif
+root/static/magic/src/widget/templates/images/soriaMenuBg.gif
+root/static/magic/src/widget/templates/images/soriaPressed-c.gif
+root/static/magic/src/widget/templates/images/soriaPressed-l.gif
+root/static/magic/src/widget/templates/images/soriaPressed-r.gif
+root/static/magic/src/widget/templates/images/spinnerDecrement.gif
+root/static/magic/src/widget/templates/images/spinnerIncrement.gif
+root/static/magic/src/widget/templates/images/submenu_disabled.gif
+root/static/magic/src/widget/templates/images/submenu_off.gif
+root/static/magic/src/widget/templates/images/submenu_on.gif
+root/static/magic/src/widget/templates/images/tab_bot_left.gif
+root/static/magic/src/widget/templates/images/tab_bot_left_curr.gif
+root/static/magic/src/widget/templates/images/tab_bot_right.gif
+root/static/magic/src/widget/templates/images/tab_bot_right_curr.gif
+root/static/magic/src/widget/templates/images/tab_close.gif
+root/static/magic/src/widget/templates/images/tab_close_h.gif
+root/static/magic/src/widget/templates/images/tab_left.gif
+root/static/magic/src/widget/templates/images/tab_left_r.gif
+root/static/magic/src/widget/templates/images/tab_left_r_curr.gif
+root/static/magic/src/widget/templates/images/tab_right.gif
+root/static/magic/src/widget/templates/images/tab_right_r.gif
+root/static/magic/src/widget/templates/images/tab_right_r_curr.gif
+root/static/magic/src/widget/templates/images/tab_top_left.gif
+root/static/magic/src/widget/templates/images/tab_top_right.gif
+root/static/magic/src/widget/templates/images/timeIcon.gif
+root/static/magic/src/widget/templates/images/toolbar-bg.gif
+root/static/magic/src/widget/templates/images/transparent.gif
+root/static/magic/src/widget/templates/images/Tree/blank.gif
+root/static/magic/src/widget/templates/images/Tree/closed.gif
+root/static/magic/src/widget/templates/images/Tree/document.gif
+root/static/magic/src/widget/templates/images/Tree/minus.gif
+root/static/magic/src/widget/templates/images/Tree/plus.gif
+root/static/magic/src/widget/templates/images/Tree/transparent.gif
+root/static/magic/src/widget/templates/images/Tree/Tree.css
+root/static/magic/src/widget/templates/images/Tree/treenode_blank.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_child.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_expand_minus.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_expand_plus.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_c.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_l.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_p.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_t.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_v.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_x.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_y.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_grid_z.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_loading.gif
+root/static/magic/src/widget/templates/images/Tree/treenode_loading.jpg
+root/static/magic/src/widget/templates/images/treenode_blank.gif
+root/static/magic/src/widget/templates/images/treenode_child.gif
+root/static/magic/src/widget/templates/images/treenode_expand_minus.gif
+root/static/magic/src/widget/templates/images/treenode_expand_plus.gif
+root/static/magic/src/widget/templates/images/treenode_grid_c.gif
+root/static/magic/src/widget/templates/images/treenode_grid_l.gif
+root/static/magic/src/widget/templates/images/treenode_grid_p.gif
+root/static/magic/src/widget/templates/images/treenode_grid_t.gif
+root/static/magic/src/widget/templates/images/treenode_grid_v.gif
+root/static/magic/src/widget/templates/images/treenode_grid_x.gif
+root/static/magic/src/widget/templates/images/treenode_grid_y.gif
+root/static/magic/src/widget/templates/images/treenode_grid_z.gif
+root/static/magic/src/widget/templates/images/treenode_node.gif
+root/static/magic/src/widget/templates/images/TreeV3/closed.gif
+root/static/magic/src/widget/templates/images/TreeV3/document.gif
+root/static/magic/src/widget/templates/images/TreeV3/expand_leaf.gif
+root/static/magic/src/widget/templates/images/TreeV3/expand_loading.gif
+root/static/magic/src/widget/templates/images/TreeV3/expand_minus.gif
+root/static/magic/src/widget/templates/images/TreeV3/expand_plus.gif
+root/static/magic/src/widget/templates/images/TreeV3/i.gif
+root/static/magic/src/widget/templates/images/TreeV3/i_bhalf.gif
+root/static/magic/src/widget/templates/images/TreeV3/i_half.gif
+root/static/magic/src/widget/templates/images/TreeV3/i_long.gif
+root/static/magic/src/widget/templates/images/TreeV3/l.gif
+root/static/magic/src/widget/templates/images/TreeV3/minus.gif
+root/static/magic/src/widget/templates/images/TreeV3/open.gif
+root/static/magic/src/widget/templates/images/TreeV3/plus.gif
+root/static/magic/src/widget/templates/images/TreeV3/t.gif
+root/static/magic/src/widget/templates/images/TreeV3/x.gif
+root/static/magic/src/widget/templates/images/verticalbar.gif
+root/static/magic/src/widget/templates/images/whiteDownArrow.gif
+root/static/magic/src/widget/templates/incrementMonth.gif
+root/static/magic/src/widget/templates/incrementWeek.gif
+root/static/magic/src/widget/templates/InlineEditBox.css
+root/static/magic/src/widget/templates/InlineEditBox.html
+root/static/magic/src/widget/templates/Menu.css
+root/static/magic/src/widget/templates/Menu2.css
+root/static/magic/src/widget/templates/MonthlyCalendar.css
+root/static/magic/src/widget/templates/MonthlyCalendar.html
+root/static/magic/src/widget/templates/PopUpButton.css
+root/static/magic/src/widget/templates/ProgressBar.css
+root/static/magic/src/widget/templates/ProgressBar.html
+root/static/magic/src/widget/templates/RemoteTabControl.css
+root/static/magic/src/widget/templates/ResizableTextarea.css
+root/static/magic/src/widget/templates/ResizableTextarea.html
+root/static/magic/src/widget/templates/ResizeHandle.css
+root/static/magic/src/widget/templates/richtextframe.html
+root/static/magic/src/widget/templates/Show.css
+root/static/magic/src/widget/templates/Show.html
+root/static/magic/src/widget/templates/ShowSlide.css
+root/static/magic/src/widget/templates/ShowSlide.html
+root/static/magic/src/widget/templates/Slider.css
+root/static/magic/src/widget/templates/Slider.html
+root/static/magic/src/widget/templates/SliderHorizontal.html
+root/static/magic/src/widget/templates/SliderVertical.html
+root/static/magic/src/widget/templates/SlideShow.css
+root/static/magic/src/widget/templates/SlideShow.html
+root/static/magic/src/widget/templates/Spinner.css
+root/static/magic/src/widget/templates/Spinner.html
+root/static/magic/src/widget/templates/SplitContainer.css
+root/static/magic/src/widget/templates/TabContainer.css
+root/static/magic/src/widget/templates/TabContainer.html
+root/static/magic/src/widget/templates/TabContainerA11y.css
+root/static/magic/src/widget/templates/TaskBar.css
+root/static/magic/src/widget/templates/TaskBarItemTemplate.html
+root/static/magic/src/widget/templates/Textbox.html
+root/static/magic/src/widget/templates/TimePicker.css
+root/static/magic/src/widget/templates/TimePicker.html
+root/static/magic/src/widget/templates/TitlePane.html
+root/static/magic/src/widget/templates/Toaster.css
+root/static/magic/src/widget/templates/Toolbar.css
+root/static/magic/src/widget/templates/TooltipTemplate.css
+root/static/magic/src/widget/templates/Tree.css
+root/static/magic/src/widget/templates/TreeDisableWrap.css
+root/static/magic/src/widget/templates/TreeDocIcon.css
+root/static/magic/src/widget/templates/TreeEditor.css
+root/static/magic/src/widget/templates/TreeV3.css
+root/static/magic/src/widget/templates/Validate.css
+root/static/magic/src/widget/templates/ValidationTextbox.html
+root/static/magic/src/widget/templates/Wizard.css
+root/static/magic/src/widget/templates/Wizard.html
+root/static/magic/src/widget/Textbox.js
+root/static/magic/src/widget/TimePicker.js
+root/static/magic/src/widget/TitlePane.js
+root/static/magic/src/widget/Toaster.js
+root/static/magic/src/widget/Toggler.js
+root/static/magic/src/widget/Toolbar.js
+root/static/magic/src/widget/Tooltip.js
+root/static/magic/src/widget/Tree.js
+root/static/magic/src/widget/TreeBasicController.js
+root/static/magic/src/widget/TreeBasicControllerV3.js
+root/static/magic/src/widget/TreeCommon.js
+root/static/magic/src/widget/TreeContextMenu.js
+root/static/magic/src/widget/TreeContextMenuV3.js
+root/static/magic/src/widget/TreeControllerExtension.js
+root/static/magic/src/widget/TreeDemo.js
+root/static/magic/src/widget/TreeDeselectOnDblselect.js
+root/static/magic/src/widget/TreeDisableWrapExtension.js
+root/static/magic/src/widget/TreeDndControllerV3.js
+root/static/magic/src/widget/TreeDocIconExtension.js
+root/static/magic/src/widget/TreeEditor.js
+root/static/magic/src/widget/TreeEmphasizeOnSelect.js
+root/static/magic/src/widget/TreeExpandToNodeOnSelect.js
+root/static/magic/src/widget/TreeExtension.js
+root/static/magic/src/widget/TreeLinkExtension.js
+root/static/magic/src/widget/TreeLoadingController.js
+root/static/magic/src/widget/TreeLoadingControllerV3.js
+root/static/magic/src/widget/TreeNode.js
+root/static/magic/src/widget/TreeNodeV3.js
+root/static/magic/src/widget/TreeRPCController.js
+root/static/magic/src/widget/TreeRpcControllerV3.js
+root/static/magic/src/widget/TreeSelector.js
+root/static/magic/src/widget/TreeSelectorV3.js
+root/static/magic/src/widget/TreeTimeoutIterator.js
+root/static/magic/src/widget/TreeToggleOnSelect.js
+root/static/magic/src/widget/TreeV3.js
+root/static/magic/src/widget/TreeWithNode.js
+root/static/magic/src/widget/UsTextbox.js
+root/static/magic/src/widget/validate.js
+root/static/magic/src/widget/ValidationTextbox.js
+root/static/magic/src/widget/vml/Chart.js
+root/static/magic/src/widget/Widget.js
+root/static/magic/src/widget/Wizard.js
+root/static/magic/src/widget/YahooMap.js
+root/static/magic/src/xml/__package__.js
+root/static/magic/src/xml/Parse.js
+root/static/magic/src/xml/XslTransform.js
+root/static/script/prototype.js
+root/static/test_Menu2.html
+script/parley_cgi.pl
+script/parley_create.pl
+script/parley_email_engine.pl
+script/parley_fastcgi.pl
+script/parley_server.pl
+script/parley_test.pl
+script/time_string_sample.pl
+t/01app.t
+t/02pod.t
+t/03podcoverage.t
+t/04_forumcode.t
+t/50.text_search.sql.t
+t/bug/password_reset.t
+t/controller_Admin.t
+t/controller_Forum.t
+t/controller_Help.t
+t/controller_My.t
+t/controller_Post.t
+t/controller_Search.t
+t/controller_Thread.t
+t/controller_User.t
+t/model_ParleyDB.t
+t/view_Plain.t
+t/view_TT.t
+TODO
+watch.sql

Added: tags/parley-0.55/MANIFEST.SKIP
===================================================================
--- tags/parley-0.55/MANIFEST.SKIP	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/MANIFEST.SKIP	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,11 @@
+^Makefile$
+^Parley.*gz$
+^Parley.*tar$
+swp$
+tmp$
+\.old$
+base.messy
+^blib
+^html
+Parley-0.*
+.*user_file.*

Added: tags/parley-0.55/Makefile.PL
===================================================================
--- tags/parley-0.55/Makefile.PL	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/Makefile.PL	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,45 @@
+use inc::Module::Install;
+
+name 'Parley';
+all_from 'lib/Parley.pm';
+
+requires 'Catalyst' =&gt; '5.7001';
+requires 'Catalyst::Action::RenderView';
+requires 'Catalyst::Model::DBIC::Schema';
+requires 'Catalyst::Plugin::Authentication';
+requires 'Catalyst::Plugin::Authentication::Credential::Password';
+requires 'Catalyst::Plugin::Authentication::Store::DBIC';
+requires 'Catalyst::Plugin::ConfigLoader';
+requires 'Catalyst::Plugin::Dumper';
+requires 'Catalyst::Plugin::Email';
+requires 'Catalyst::Plugin::FillInForm';
+requires 'Catalyst::Plugin::FormValidator';
+requires 'Catalyst::Plugin::Session';
+requires 'Catalyst::Plugin::Session::State::Cookie';
+requires 'Cache::FastMmap';
+requires 'Catalyst::Plugin::Session::Store::FastMmap';
+requires 'Catalyst::Plugin::StackTrace';
+requires 'Catalyst::Plugin::Static::Simple';
+requires 'Catalyst::View::TT';
+requires 'Data::FormValidator' =&gt; '4.50';
+requires 'Data::SpreadPagination';
+requires 'DateTime';
+requires 'DateTime::Format::Pg';
+requires 'DateTime::TimeZone';
+requires 'Email::Valid';
+requires 'Graphics::Magick';
+requires 'Image::Size';
+requires 'List::MoreUtils';
+requires 'MIME::Lite';
+requires 'Perl6::Export::Attrs';
+requires 'Proc::Daemon';
+requires 'Proc::PID::File';
+requires 'Readonly';
+requires 'Text::Context::EitherSide';
+requires 'YAML'; # This should reflect the config file format you've chosen
+                 # See Catalyst::Plugin::ConfigLoader for supported formats
+catalyst;
+
+install_script glob('script/*.pl');
+auto_install;
+WriteAll;

Added: tags/parley-0.55/README
===================================================================
--- tags/parley-0.55/README	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/README	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1 @@
+Run script/parley_server.pl to test the application.

Added: tags/parley-0.55/TODO
===================================================================
--- tags/parley-0.55/TODO	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/TODO	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+TODO LIST
+
+  - message preview before posting
+  - proper/better validation error hadling for AJAX field updates
+  - user profile image uploads
+  - fix CSS for &lt;fieldset&gt;s
+D - factor out error setting, handling and displaying
+D - install Proc::Daemon (etc) for email script
+D - factor out DFV &quot;equality&quot; functions
+D - factor out interval_ago() and _time_string()

Added: tags/parley-0.55/db/parley.psql
===================================================================
--- tags/parley-0.55/db/parley.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/parley.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,249 @@
+-- Phorum schema
+
+-- to get your user and database:
+--  createuser -A -d parley
+--  createdb -U parley -E UTF8 parley
+--  psql -U parley -d parley -f db/parley.psql
+
+\set QUIET 'on'
+
+-- wrap it all in a transaction
+BEGIN;
+
+-- we have authentication
+CREATE TABLE authentication (
+    authentication_id       SERIAL          not null        primary key,
+    username                text            not null,
+    password                text            not null,
+    authenticated           boolean         NOT NULL        default False,
+
+    UNIQUE (username)
+);
+
+
+-- a table of acceptable TZ strings
+CREATE TABLE preference_time_string (
+    preference_time_string_id       SERIAL      primary key,
+    time_string                     text        not null,
+    sample                          text        not null,
+    comment                         text
+);
+-- some TZ strings
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%A %d %B %Y at %R', 'Thursday 13 July 2006 at 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%F %T', '2006-07-13 18:15:00');
+INSERT INTO preference_time_string (time_string, sample, comment) VALUES ('%c','Thu 13 Jul 2006 18:15:00 BST','locale\'s date and time'); 
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%A at %R', 'Thursday at 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%a, %d %b; %R', 'Thu, 13 Jul; 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%a, %d %b; %R', 'Thu, 13 Jul; 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%R, %b %d', '18:15, Jul 13');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%R, %b %d ''%y', '18:15, Jul 13 \'06');
+
+
+CREATE TABLE preference (
+    preference_id   SERIAL      primary key,
+
+    timezone        text        not null
+            default 'UTC',
+    time_format     integer     references preference_time_string,
+    show_tz         boolean     default True,
+
+    notify_thread_watch     boolean     default False,
+    watch_on_post           boolean     default True
+);
+
+CREATE TABLE person (
+    person_id       SERIAL      primary key,
+    
+    first_name      text        not null,
+    last_name       text        not null,
+    email           text        not null,
+    
+    forum_name      text        not null,
+
+    preference      integer
+                    references preference,
+
+    authentication  integer
+                    references authentication,
+
+    UNIQUE(forum_name),
+    UNIQUE(email)
+);
+
+CREATE TABLE registration_authentication (
+    registration_authentication_id  text  primary key,
+    recipient       integer     not null
+                    references person,
+    expires         date
+);
+
+-- new table used during forgotten password process
+CREATE TABLE password_reset (
+    password_reset_id       text        primary key,
+    recipient               integer     not null
+                            references person,
+    expires                 timestamp
+);
+
+CREATE TABLE forum (
+    forum_id        SERIAL      primary key,
+    name            text        not null,
+    description     text,
+
+    active          boolean     not null    default True,
+
+    post_count      integer     not null    default 0,
+
+    UNIQUE(name)
+);
+
+CREATE TABLE thread (
+    thread_id       SERIAL      primary key,
+    forum           integer     not null
+                    references forum,
+
+    subject         text        not null,
+    
+    created         timestamp with time zone
+                    default CURRENT_TIMESTAMP,
+    creator         integer     not null
+                    references person,
+    post_count      integer     not null    default 0,
+    view_count      integer     not null    default 0,
+
+    active          boolean     not null    default True,
+
+    sticky          boolean     not null    default False,
+    locked          boolean     not null    default False
+);
+
+CREATE TABLE post (
+    post_id         SERIAL      primary key,
+    thread          integer     not null
+                    references thread,
+
+    subject         text,
+    message         text        not null,
+
+    created         timestamp with time zone
+                    default CURRENT_TIMESTAMP,
+    creator         integer     not null
+                    references person,
+
+    ip_addr         inet
+
+);
+
+-- add ReplyTo information for post
+ALTER TABLE post ADD COLUMN reply_to
+    integer references post
+;
+-- deal with quoted replies
+ALTER TABLE post
+ADD COLUMN quoted_post
+integer REFERENCES post;
+
+ALTER TABLE post
+ADD COLUMN quoted_text text;
+
+-- add LastPost information
+ALTER TABLE thread ADD COLUMN last_post
+    integer references post
+;
+ALTER TABLE forum ADD COLUMN last_post
+    integer references post
+;
+
+-- person posting information
+ALTER TABLE person ADD COLUMN last_post
+    integer references post
+;
+ALTER TABLE person ADD COLUMN post_count
+    integer NOT NULL default 0
+;
+
+-- post edited time (if any)
+ALTER TABLE post
+    ADD COLUMN
+        edited  timestamp with time zone
+;
+
+
+-- when a user last viewed a thread
+CREATE TABLE thread_view (
+    thread_view_id      SERIAL      not null        primary key,
+    person              integer     not null        references person,
+    thread              integer     not null        references thread,
+    timestamp           timestamp with time zone    not null
+                        default CURRENT_TIMESTAMP,
+
+    watched             boolean     not null        default False,
+    last_notified       timestamp with time zone
+                        default NULL,
+
+    unique(person, thread)
+);
+
+-- overall it's better to queue outgoing emails, and have a separate process
+-- deal with them
+CREATE TABLE email_queue (
+    email_queue_id      SERIAL      not null        primary key,
+    queued              timestamp with time zone    not null
+                        default CURRENT_TIMESTAMP,
+
+    recipient           integer     not null        references person,
+    cc                  integer                     references person,
+    bcc                 integer                     references person,
+
+    sender              text        not null,
+
+    subject             text        not null,
+    text_content        text        not null,
+    html_content        text,
+
+    -- delivery statuses
+    attempted_delivery  boolean     not null        default False
+);
+
+
+-- a table of person/forum to show who's a moderator
+CREATE TABLE forum_moderator (
+    person              integer     not null    references person,
+    forum               integer     not null    references forum,
+    can_moderate        boolean     not null    default true,
+
+    unique(person,forum)
+);
+
+
+
+--
+-- some default stuff
+--
+
+-- #0 authentication
+INSERT INTO authentication
+(authentication_id, username, password, authenticated)
+VALUES
+(0, 'topdog', md5('k1tt3n'), true);
+
+-- #0 preference
+INSERT INTO preference
+(preference_id, timezone)
+VALUES
+(0, 'UTC');
+
+-- #0 person info
+INSERT INTO person
+(person_id,first_name, last_name, email, forum_name, authentication, preference)
+VALUES
+(0, 'Top','Dog','<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">topdog at herlpacker.co.uk</A>','TopDog', 0, 0);
+
+INSERT INTO forum (forum_id, name, description) VALUES (0, 'Off-Topic', 'General off-topic discussion');
+INSERT INTO forum (name, description) VALUES ('Suggestions', 'Things you think should be added');
+INSERT INTO forum (name, description) VALUES ('Bugs', 'If you find anything broken, report it here');
+
+-- commit our schema
+COMMIT;
+
+-- vim:ft=sql

Added: tags/parley-0.55/db/patch.skel
===================================================================
--- tags/parley-0.55/db/patch.skel	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch.skel	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+-- Patch:
+--   From: a.bb
+--   To:   x.yy
+--
+-- Description:
+--   [outline the purpose of the patch]
+
+BEGIN;
+
+-- update the schema version stored in the database
+UPDATE _schema_info_ SET version='x.yy';
+
+-- patch starts here --
+-- patch ends   here --
+
+COMMIT;

Added: tags/parley-0.55/db/patch_0.06_to_0.07.psql
===================================================================
--- tags/parley-0.55/db/patch_0.06_to_0.07.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch_0.06_to_0.07.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,58 @@
+-- Patch:
+--   From: 0.06
+--   To:   0.07
+--
+-- Description:
+--   + add preferences table
+--   + add new preference column to person table as FK to preference
+--   + give user #0 a preference
+
+BEGIN;
+
+-- patch starts here --
+
+CREATE TABLE preference (
+    preference_id   SERIAL      primary key,
+
+    timezone        text        not null
+            default 'UTC'
+);
+ALTER TABLE person ADD COLUMN preference
+    integer references preference
+;
+
+INSERT INTO preference
+(preference_id, timezone)
+VALUES
+(0, 'UTC');
+
+UPDATE person
+SET preference=0
+WHERE person_id=0
+
+
+-- add ReplyTo information for post
+ALTER TABLE post ADD COLUMN reply_to
+    integer references post
+;
+
+-- person posting information
+ALTER TABLE person ADD COLUMN last_post
+    integer references post
+;
+ALTER TABLE person ADD COLUMN post_count
+    integer NOT NULL default 0
+;
+
+-- deal with quoted replies
+ALTER TABLE post
+ADD COLUMN quoted_post
+integer REFERENCES post;
+
+ALTER TABLE post
+ADD COLUMN quoted_text text;
+
+
+-- patch ends here --
+
+COMMIT;

Added: tags/parley-0.55/db/patch_0.07_to_0.08.psql
===================================================================
--- tags/parley-0.55/db/patch_0.07_to_0.08.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch_0.07_to_0.08.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,21 @@
+-- Patch:
+--   From: 0.07
+--   To:   0.08
+--
+-- Description:
+--   add 'edited' column to post table
+
+BEGIN;
+
+-- patch starts here --
+
+
+ALTER TABLE post
+    ADD COLUMN
+        edited  timestamp with time zone
+;
+
+
+-- patch ends here --
+
+COMMIT;

Added: tags/parley-0.55/db/patch_0.08_to_0.09.psql
===================================================================
--- tags/parley-0.55/db/patch_0.08_to_0.09.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch_0.08_to_0.09.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,32 @@
+-- Patch:
+--   From: 0.08
+--   To:   0.09
+--
+-- Description:
+--   new table for password_reset requests
+
+BEGIN;
+
+-- patch starts here --
+
+-- new table used during forgotten password process
+CREATE TABLE password_reset (
+    password_reset_id       text        primary key,
+    recipient               integer     not null
+                            references person,
+    expires                 timestamp
+);
+
+-- email address should be unique
+-- you may run into trouble here if you've got non-unique values here already
+-- SORRY!
+
+-- a nasty, evil option would be:
+--  update person set email = forum_name || '-' || email where person_id &gt; 0;
+ALTER TABLE person
+  ADD UNIQUE(email)
+;
+
+-- patch ends here --
+
+COMMIT;

Added: tags/parley-0.55/db/patch_0.09_to_0.10.psql
===================================================================
--- tags/parley-0.55/db/patch_0.09_to_0.10.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch_0.09_to_0.10.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,75 @@
+-- Patch:
+--   From: 0.09
+--   To:   0.10
+--
+-- Description:
+--  new table for tracking when a viewer has last viewed a thread
+
+BEGIN;
+
+-- patch starts here --
+
+CREATE TABLE thread_view (
+    thread_view_id      SERIAL      not null        primary key,
+    person              integer     not null        references person,
+    thread              integer     not null        references thread,
+    timestamp           timestamp with time zone    not null
+                        default CURRENT_TIMESTAMP,
+
+    watched             boolean     not null        default False,
+    last_notified       timestamp with time zone
+                        default NULL,
+
+    unique(person, thread)
+);
+
+
+-- overall it's better to queue outgoing emails, and have a separate process
+-- deal with them
+CREATE TABLE email_queue (
+    email_queue_id      SERIAL      not null        primary key,
+    queued              timestamp with time zone    not null
+                        default CURRENT_TIMESTAMP,
+
+    recipient           integer     not null        references person,
+    cc                  integer                     references person,
+    bcc                 integer                     references person,
+
+    sender              text        not null,
+
+    subject             text        not null,
+    text_content        text        not null,
+    html_content        text,
+
+    -- delivery statuses
+    attempted_delivery  boolean     not null        default False
+
+);
+
+-- a table of acceptable TZ strings
+CREATE TABLE preference_time_string (
+    preference_time_string_id     SERIAL      primary key,
+    time_string                   text        not null,
+    sample                        text        not null,
+    comment                       text
+);
+-- some TZ strings
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%A %d %B %Y at %R', 'Thursday 13 July 2006 at 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%F %T', '2006-07-13 18:15:00');
+INSERT INTO preference_time_string (time_string, sample, comment) VALUES ('%c','Thu 13 Jul 2006 18:15:00 BST','locale\'s date and time'); 
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%A at %R', 'Thursday at 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%a, %d %b; %R', 'Thu, 13 Jul; 18:15');
+
+-- add time_format_string to user preferences
+ALTER TABLE preference
+ADD COLUMN time_format integer
+    references preference_time_string
+;
+ALTER TABLE preference
+ADD COLUMN show_tz boolean
+    default True
+;
+
+-- patch ends here --
+
+COMMIT;

Added: tags/parley-0.55/db/patch_0.50_to_0.51.psql
===================================================================
--- tags/parley-0.55/db/patch_0.50_to_0.51.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch_0.50_to_0.51.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+-- Patch:
+--   From: 0.09
+--   To:   0.10
+--
+-- Description:
+--  new table for tracking when a viewer has last viewed a thread
+
+BEGIN;
+
+-- patch starts here --
+
+-- a table of person/forum to show who's a moderator
+CREATE TABLE forum_moderator (
+    person              integer     not null    references person,
+    forum               integer     not null    references forum,
+    can_moderate        boolean     not null    default true,
+
+    unique(person,forum)
+);
+
+-- patch ends here --
+
+COMMIT;

Added: tags/parley-0.55/db/patch_0.52_to_0.53.psql
===================================================================
--- tags/parley-0.55/db/patch_0.52_to_0.53.psql	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/db/patch_0.52_to_0.53.psql	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,30 @@
+-- Patch:
+--   From: 0.52
+--   To:   0.53
+--
+-- Description:
+--  new time format preferences
+
+BEGIN;
+
+-- patch starts here --
+
+--  new time format preferences
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%a, %d %b; %R', 'Thu, 13 Jul; 18:15');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%R, %b %d', '18:15, Jul 13');
+INSERT INTO preference_time_string (time_string, sample) VALUES ('%R, %b %d ''%y', '18:15, Jul 13 \'06');
+
+-- new post field (to capture IP of poster)
+ALTER TABLE post
+    ADD COLUMN  ip_addr     inet
+;
+
+-- new fields in preference table
+ALTER TABLE preference
+    ADD COLUMN  notify_thread_watch boolean default False,
+    ADD COLUMN  watch_on_post       boolean default True
+;
+
+-- patch ends here --
+
+COMMIT;

Added: tags/parley-0.55/doc/parley-qs.html
===================================================================
--- tags/parley-0.55/doc/parley-qs.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/doc/parley-qs.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,69 @@
+&lt;html&gt;
+    &lt;head&gt;
+        &lt;title&gt;Parley - Quick Start Guide&lt;/title&gt;
+    &lt;/head&gt;
+
+    &lt;body&gt;
+        &lt;h1&gt;Parley - Quick Start Guide&lt;/h1&gt;
+
+        &lt;p&gt;This is a quick guide to getting Parley running on a machine using
+        the Catalyst testing/development server.&lt;/p&gt;
+
+        &lt;p&gt;&lt;b&gt;NOTE&lt;/b&gt; v0.51 has missing dependencies in Makefile.PL. Save
+        yourself some pain and fetch v0.52 or later.&lt;/p&gt;
+
+        &lt;h2&gt;Initial Installation&lt;/h2&gt;
+        &lt;blockquote&gt;&lt;code&gt;
+        mkdir -p ~/development&lt;br /&gt;
+        cd ~/development&lt;br /&gt;
+&lt;br /&gt;
+        wget <A HREF="http://download.berlios.de/parley/Parley-0.52.tar.gz&lt;br">http://download.berlios.de/parley/Parley-0.52.tar.gz&lt;br</A> /&gt;
+        tar -zxvf Parley-0.52.tar.gz&lt;br /&gt;
+        cd Parley-0.52/&lt;br /&gt;
+&lt;br /&gt;
+        perl Makefile.PL&lt;br /&gt;
+        &lt;em&gt;# install missing dependencies&lt;/em&gt;&lt;br /&gt;
+        &lt;em&gt;# 'sudo make' may work here&lt;/em&gt;&lt;br /&gt;
+&lt;br /&gt;
+        &lt;em&gt;# you may need to tweak pg_hba.conf&lt;/em&gt;&lt;br /&gt;
+        &lt;em&gt;## local   all  parley                trust&lt;/em&gt;&lt;br /&gt;
+        &lt;em&gt;## host&nbsp;   all  parley  127.0.0.1/32  trust&lt;/em&gt;&lt;br /&gt;
+        sudo -u postgres createuser -A -d parley&lt;br /&gt;
+        createdb -U parley -E UTF8 parley&lt;br /&gt;
+        psql -U parley -d parley -f db/parley.psql&lt;br /&gt;
+        &lt;/code&gt;&lt;/blockquote&gt;
+
+        &lt;h2&gt;Configuring&lt;/h2&gt;
+
+        &lt;p&gt;If you're running Parley out of the box it should Just Work.&lt;/p&gt;
+
+        &lt;p&gt;One problem can sometimes be with the database connection.
+        If you find you can't connect, make sure you've correctly configured
+        &lt;code&gt;pg_hba.conf&lt;/code&gt; and that the &lt;code&gt;Model::ParleyDB&lt;/code&gt;
+        section in &lt;code&gt;parley.yml&lt;/code&gt; appears sane for your setup.&lt;/p&gt;
+
+        &lt;h2&gt;Running the Server&lt;/h2&gt;
+
+        &lt;blockquote&gt;&lt;code&gt;
+        ./script/parley_server.pl
+        &lt;/code&gt;&lt;/blockquote&gt;
+
+        &lt;h2&gt;Ubuntu Users&lt;/h2&gt;
+
+        &lt;p&gt;There are others, but these are the key packages I'd recommend installing
+        with &quot;sudo aptitude install ...&quot;
+
+        &lt;ul&gt;
+            &lt;li&gt;libdbi-perl&lt;/li&gt;
+            &lt;li&gt;libdbd-pg-perl&lt;/li&gt;
+            &lt;li&gt;libfile-copy-recursive-perl&lt;/li&gt;
+            &lt;li&gt;libtemplate-perl&lt;/li&gt;
+            &lt;li&gt;libtemplate-timer-perl&lt;/li&gt;
+            &lt;li&gt;libdatetime-perl&lt;/li&gt;
+            &lt;li&gt;libdatetime-format-pg-perl&lt;/li&gt;
+            &lt;li&gt;libdatetime-timezone-perl&lt;/li&gt;
+            &lt;li&gt;liblist-moreutils-perl&lt;/li&gt;
+        &lt;/ul&gt;
+        &lt;/p&gt;
+    &lt;/body&gt;
+&lt;/html&gt;

Added: tags/parley-0.55/lib/Parley/App/Communication/Email.pm
===================================================================
--- tags/parley-0.55/lib/Parley/App/Communication/Email.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/App/Communication/Email.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,202 @@
+package Parley::App::Communication::Email;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+
+use Perl6::Export::Attrs;
+
+sub queue_email :Export( :email ) {
+    my ($c, $options) = @_;
+    my $queued_mail = $c-&gt;model('ParleyDB')-&gt;resultset('EmailQueue')-&gt;create(
+        {
+            sender          =&gt; $options-&gt;{headers}{from}        || q{Missing From &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at somewhere.com</A>&gt;},
+
+            recipient       =&gt; $options-&gt;{recipient}-&gt;id()      || 0,
+            subject         =&gt; $options-&gt;{headers}{subject}     || q{Subject Line Missing},
+            text_content    =&gt; $options-&gt;{text_content}         || q{Email Body Text Missing},
+            html_content    =&gt; $options-&gt;{html_content}         || undef,
+        }
+    );
+    return 1; # success
+}
+
+sub send_email :Export( :email ) {
+    my ($c, $options) = @_;
+    my ($text_content, $html_content, $email_status);
+
+    # preparing for future expansion, where we intend to build multipart emails
+    # and we'll be using -&gt;{template}{text} and -&gt;{template}{html}
+    if (            exists $options-&gt;{template}
+            and ref($options-&gt;{template}) ne 'HASH'
+    ) {
+        $c-&gt;log-&gt;warn(
+              q{DEPRECATED use of -&gt;{template} = 'file.eml'}
+            . q{: plain-text template name should be stored in }
+            . q{-&gt;{template}{text} instead of -&gt;{template}}
+        );
+
+        # put the data in the right place
+        my $tpl_name = $options-&gt;{template};
+        $options-&gt;{template} = {};
+        $options-&gt;{template}{text} = $tpl_name;
+    }
+
+    # we don't send anything immediately ... push it into the queue of outgoing
+    # messages
+
+    # prepare the text content portion of the message - we read this from a
+    # [template] file which we render
+    $text_content = $c-&gt;view('Plain')-&gt;render(
+        $c,
+        $options-&gt;{template}{text},
+        {
+            additional_template_paths =&gt; [ $c-&gt;config-&gt;{root} . q{/email_templates}],
+
+            # automatically make the person data available
+            person =&gt; $options-&gt;{person},
+
+            # pass through extra TT data
+            %{ $options-&gt;{template_data} || {} },
+        }
+    );
+
+    # if we have html_content, prepare that for queueing
+    if (defined $options-&gt;{template}{html}) {
+        $html_content = $c-&gt;view('Plain')-&gt;render(
+            $c,
+            $options-&gt;{template}{html},
+            {
+                additional_template_paths =&gt; [ $c-&gt;config-&gt;{root} . q{/email_templates}],
+
+                # automatically make the person data available
+                person =&gt; $options-&gt;{person},
+
+                # pass through extra TT data
+                %{ $options-&gt;{template_data} || {} },
+            }
+        );
+    }
+
+    # queue the message
+    $email_status = $c-&gt;queue_email(
+        {
+            headers =&gt; {
+                from        =&gt;     $options-&gt;{headers}{from}
+                                || q{Missing From &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">missing.from at localhost</A>&gt;},
+                subject     =&gt;     $options-&gt;{headers}{subject}
+                                || q{Subject Line Missing},
+            },
+
+            recipient       =&gt; $options-&gt;{person},
+            text_content    =&gt; $text_content,
+            html_content    =&gt; $html_content,
+        },
+    );
+
+    # did we queue the email OK?
+    if ($email_status) {
+        $c-&gt;log-&gt;info(
+              q{send_email(}
+            . $options-&gt;{person}-&gt;email()
+            . q{): }
+            . $email_status
+        );
+
+        return 1;
+    }
+    else {
+        $c-&gt;log-&gt;error( $email_status );
+        $c-&gt;stash-&gt;{error}{message} = q{There was a problem sending an email from the system};
+        return 0;
+    }
+}
+
+sub old_send_email :Export( :email ) {
+    my ($c, $options) = @_;
+
+    # preparing for future expansion, where we intend to build multipart emails
+    # and we'll be using -&gt;{template}{text} and -&gt;{template}{html}
+    if (            exists $options-&gt;{template}
+            and ref($options-&gt;{template}) ne 'HASH'
+    ) {
+        $c-&gt;log-&gt;warn(
+              q{DEPRECATED use of -&gt;{template} = 'file.eml'}
+            . q{: plain-text template name should be stored in }
+            . q{-&gt;{template}{text} instead of -&gt;{template}}
+        );
+
+        # put the data in the right place
+        my $tpl_name = $options-&gt;{template};
+        $options-&gt;{template} = {};
+        $options-&gt;{template}{text} = $tpl_name;
+    }
+
+    # send an email off to the new user
+    my $email_status = $c-&gt;email(
+        header =&gt; [
+            To      =&gt; $options-&gt;{person}-&gt;email(),
+            From    =&gt; $options-&gt;{headers}{from}      || q{Missing From &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at somewhere.com</A>&gt;},
+            Subject =&gt; $options-&gt;{headers}{subject}   || q{Subject Line Missing},
+        ],
+
+        body =&gt; $c-&gt;view('Plain')-&gt;render(
+            $c,
+            $options-&gt;{template}{text},
+            {
+                additional_template_paths =&gt; [ $c-&gt;config-&gt;{root} . q{/email_templates}],
+
+                # automatically make the person data available
+                person =&gt; $options-&gt;{person},
+
+                # pass through extra TT data
+                %{ $options-&gt;{template_data} || {} },
+            }
+        ),
+    );
+
+    # did we get &quot;Message sent&quot; from the email send?
+    if ($email_status eq q{Message sent}) {
+        $c-&gt;log-&gt;info(
+              q{send_email(}
+            . $options-&gt;{person}-&gt;email()
+            . q{): }
+            . $email_status
+        );
+
+        return 1;
+    }
+    else {
+        $c-&gt;log-&gt;error( $email_status );
+        $c-&gt;stash-&gt;{error}{message} = q{Sorry, we are currently unable to store your information. Please try again later.};
+        return 0;
+    }
+}
+
+1;
+
+__END__
+
+=head1 NAME
+
+Parley::App::Communication::Email - email helper functions
+
+=head1 SYNOPSIS
+
+  use Parley::App::Communication::Email;
+
+  $self-&gt;send_email($c, $options);
+
+=head1 SEE ALSO
+
+L&lt;Parley::Controller::Root&gt;, L&lt;Catalyst::Plugin::Email&gt;, L&lt;Catalyst&gt;
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut

Added: tags/parley-0.55/lib/Parley/App/DFV.pm
===================================================================
--- tags/parley-0.55/lib/Parley/App/DFV.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/App/DFV.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,95 @@
+package Parley::App::DFV;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+
+use Email::Valid;
+use Perl6::Export::Attrs;
+
+sub dfv_constraint_confirm_equal :Export( :constraints ) {
+    my ($attrs)  = @_;
+
+    my ($first, $second) = @{ $attrs-&gt;{fields} } if $attrs-&gt;{fields};
+
+    return sub {
+        my $dfv = shift;
+        my $data = $dfv-&gt;get_filtered_data();
+
+        return ( $data-&gt;{$first} eq $data-&gt;{$second} );
+    }
+}
+
+sub dfv_constraint_valid_email :Export( :constraints ) {
+    my $attrs = @_;
+
+    return sub {
+        my $dfv = shift;
+        my $data = $dfv-&gt;get_filtered_data();
+
+        return Email::Valid-&gt;address($data-&gt;{email});
+    }
+}
+
+sub form_data_valid :Export( :validation ) {
+    my ($self, $c) = @_;
+
+    # deal with missing/invalid fields
+    if ($c-&gt;form-&gt;has_missing()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{You must fill in all the required fields};
+        foreach my $f ( $c-&gt;form-&gt;missing ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+
+        return; # invalid form data
+    }
+    elsif ($c-&gt;form-&gt;has_invalid()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{One or more fields are invalid};
+        foreach my $f ( $c-&gt;form-&gt;invalid ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+
+        return; # invalid form data
+    }
+
+    # otherwise, the form data is ok ...
+    return 1;
+}
+
+1;
+
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley::App::DFV - Functions used with Data::FormValidator
+
+=head1 SYNOPSIS
+
+  use Parley::App::DFV qw( :constraints );
+
+  my %dfv_profile_for = (
+    'some_form' =&gt; {
+
+        # ...
+
+        constraint_methods =&gt; {
+            confirm_email =&gt;
+                dfv_constraint_confirm_equal(
+                    {
+                        fields =&gt; [qw/email confirm_email/],
+                    }
+                ),
+        },
+
+        # ...
+
+    },
+  );
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at users.berlios.de</A>&gt; &gt;&gt;
+
+=cut

Added: tags/parley-0.55/lib/Parley/App/DateTime.pm
===================================================================
--- tags/parley-0.55/lib/Parley/App/DateTime.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/App/DateTime.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,42 @@
+package Parley::App::DateTime;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+
+use DateTime;
+use Perl6::Export::Attrs;
+
+sub interval_ago_string :Export( :interval ) {
+    my ($datetime) = @_;
+    my ($now, $duration, $longest_duration);
+
+    # get now as a DT object
+    $now = DateTime-&gt;now();
+
+    # the difference between now and the post time
+    $duration = $now - $datetime;
+
+    # we use the largest unit to give an idea of how long ago the post was made
+    foreach my $unit (qw[years months days hours minutes seconds]) {
+        if ($longest_duration = $duration-&gt;in_units($unit)) {
+            return _time_string($longest_duration, $unit);
+        }
+    };
+
+    # we should get *something* in the loop above, but just in case
+    return '0 seconds';
+}
+
+
+sub _time_string {
+    my ($duration, $unit) = @_;
+
+    # DateTime::Duration uses plural names for units
+    # so if we have ONE we need to return the singular
+    if (1 == $duration) {
+        $unit =~ s{s\z}{};
+    }
+
+    return &quot;$duration $unit&quot;;
+}
+1;

Added: tags/parley-0.55/lib/Parley/App/Error.pm
===================================================================
--- tags/parley-0.55/lib/Parley/App/Error.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/App/Error.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+package Parley::App::Error;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+
+use Perl6::Export::Attrs;
+
+sub has_errors :Export(:methods) {
+    my ($c) = @_;
+
+    return (exists $c-&gt;stash-&gt;{view}{error}{messages});
+}
+
+sub parley_warn :Export(:methods) {
+    my ($c, $error_msg) = @_;
+
+    # if we don't have an error &quot;type&quot; set it to warning
+    $c-&gt;stash-&gt;{view}{error}{type} ||= q{warning};
+
+    # push the incoming error onto the &quot;error stack&quot;
+    push @{ $c-&gt;stash-&gt;{view}{error}{messages} },
+        $error_msg;
+}
+
+sub parley_die {
+    my ($c, $error_msg) = @_;
+
+    # die overrides existing types
+    $c-&gt;stash-&gt;{view}{error}{type} = q{die};
+
+    # push the incoming error onto the &quot;error stack&quot;
+    push @{ $c-&gt;stash-&gt;{view}{error}{messages} },
+        $error_msg;
+}
+
+1;

Added: tags/parley-0.55/lib/Parley/App/Notification.pm
===================================================================
--- tags/parley-0.55/lib/Parley/App/Notification.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/App/Notification.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,94 @@
+package Parley::App::Notification;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+
+use Perl6::Export::Attrs;
+
+sub notify_watchers :Export( :watch ) {
+    my ($c, $post) = @_;
+    my ($send_status);
+
+    # get a list of people we want to inform
+    my $notification_list = $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')
+        -&gt;notification_list( $post )
+    ;
+    $c-&gt;log-&gt;debug( q{No. WATCHERS: } . $notification_list-&gt;count() );
+
+    # loop through the list [resultset], queue and email
+    # and update the time they were last notified
+    while (my $thread_view_row = $notification_list-&gt;next()) {
+        $c-&gt;log-&gt;debug( q{NOTIFY: } . $thread_view_row-&gt;person()-&gt;id() );
+        $c-&gt;log-&gt;debug( q{NOTIFY: } . $thread_view_row-&gt;person()-&gt;forum_name() );
+
+        # DO NOT notify people that have the 'notify_thread_watch' preference set to false
+        if (not $thread_view_row-&gt;person()-&gt;preference()-&gt;notify_thread_watch()) {
+            $c-&gt;log-&gt;debug( q{NOTIFY: DO NOT NOTIFY PERSON (preference.notify_thread_watch=false)} );
+            next;
+        }
+        $c-&gt;log-&gt;debug( q{NOTIFY: NOTIFY PERSON (preference.notify_thread_watch=true)} );
+
+        # send email
+        $send_status = $c-&gt;send_email(
+            {
+                template        =&gt; {
+                    text    =&gt; q{thread_update_notify.eml},
+                    html    =&gt; q{thread_update_notify.html},
+                },
+                person          =&gt; $thread_view_row-&gt;person(),
+                headers         =&gt; {
+                    from    =&gt; $c-&gt;application_email_address(),
+                    subject =&gt; qq{New Reply: } . $post-&gt;thread()-&gt;subject(),
+                },
+                template_data   =&gt; {
+                    post    =&gt; $post,
+                },
+            }
+        );
+
+        # update thread_view record for thread-person
+        my $thread_view_record = $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')
+            -&gt;find(
+                person  =&gt; $thread_view_row-&gt;person()-&gt;id(),
+                thread  =&gt; $post-&gt;thread()-&gt;id(),
+            )
+        ;
+        $thread_view_record-&gt;last_notified(
+            #$thread_view_record-&gt;timestamp()
+            Time::Piece-&gt;new(time)-&gt;datetime,
+        );
+        $thread_view_record-&gt;update();
+    }
+
+    return;
+}
+
+
+1;
+
+__END__
+
+=head1 NAME
+
+Parley::App::Notification - notification helper functions
+
+=head1 SYNOPSIS
+
+  use Parley::App::Notification;
+
+  $c-&gt;notify_watchers($post);
+
+=head1 SEE ALSO
+
+L&lt;Parley::Controller::Root&gt;, L&lt;Catalyst::Plugin::Email&gt;, L&lt;Catalyst&gt;
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut

Added: tags/parley-0.55/lib/Parley/Controller/Admin.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Admin.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Admin.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,106 @@
+package Parley::Controller::Admin;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+sub index : Private {
+    my ( $self, $c ) = @_;
+
+    $c-&gt;response-&gt;body('Matched Parley::Controller::Admin in Admin.');
+}
+
+sub auto : Private {
+    my ($self, $c) = @_;
+    $c-&gt;log-&gt;debug( 'Admin::auto()' );
+
+    # if we're not a moderator, bounce back to where we came from
+    if (not $c-&gt;stash-&gt;{moderator}) {
+        $c-&gt;log-&gt;debug( 'not a moderator' );
+        $c-&gt;response-&gt;redirect( $c-&gt;request-&gt;referer() );
+        return 0;
+    }
+
+    # succeed
+    $c-&gt;log-&gt;debug( 'a moderator' );
+    return 1;
+}
+
+sub lock :Local {
+    my ($self, $c) = @_;
+
+    # the 'lock' parameter tells us if we're adding or removing a lock
+    # if it's not specified, default action os to ADD a lock
+    my $locked = $c-&gt;request-&gt;param('lock');
+    if (not defined $locked) {
+        $locked = 1;
+    }
+    $c-&gt;log-&gt;debug( qq{lock: $locked} );
+
+    # we should already have the thread we're locking, but let's check anyway
+    if (not defined $c-&gt;_current_thread()) {
+        $c-&gt;stash-&gt;{error}{message} = q{You must specify the thread to lock};
+        $c-&gt;log-&gt;error( q{You must specify the thread to lock} );
+        return;
+    }
+
+    # update the lock status
+    $c-&gt;_current_thread()-&gt;locked( $locked );
+    $c-&gt;_current_thread()-&gt;update();
+
+    # go back to where we came from
+    $c-&gt;response-&gt;redirect( $c-&gt;request-&gt;referer() );
+    return;
+}
+
+sub sticky :Local {
+    my ($self, $c) = @_;
+
+    # the 'sticky' parameter tells us if we're adding or removing a sticky
+    # if it's not specified, default action os to ADD a sticky
+    my $sticky = $c-&gt;request-&gt;param('sticky');
+    if (not defined $sticky) {
+        $sticky = 1;
+    }
+    $c-&gt;log-&gt;debug( qq{sticky: $sticky} );
+
+    # we should already have the thread we're sticking, but let's check anyway
+    if (not defined $c-&gt;_current_thread()) {
+        $c-&gt;stash-&gt;{error}{message} = q{You must specify the thread to stick};
+        $c-&gt;log-&gt;error( q{You must specify the thread to stick} );
+        return;
+    }
+
+    # update the stick status
+    $c-&gt;_current_thread()-&gt;sticky( $sticky );
+    $c-&gt;_current_thread()-&gt;update();
+
+    # go back to where we came from
+    $c-&gt;response-&gt;redirect( $c-&gt;request-&gt;referer() );
+    return;
+}
+
+=head1 NAME
+
+Parley::Controller::Admin - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 METHODS
+
+=head2 index 
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at berlios.de</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley/Controller/Forum.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Forum.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Forum.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,100 @@
+package Parley::Controller::Forum;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+sub list : Local {
+    my ($self, $c) = @_;
+
+    # get a list of (active) forums
+    $c-&gt;stash-&gt;{forum_list} = $c-&gt;model('ParleyDB')-&gt;resultset('Forum')-&gt;search(
+        {
+            active =&gt; 1,
+        },
+        {
+            'order_by'  =&gt; 'forum_id ASC',
+        }
+    );
+}
+
+sub view : Local {
+    my ($self, $c) = @_;
+
+    # page to show - either a param, or show the first
+    $c-&gt;stash-&gt;{current_page}= $c-&gt;request-&gt;param('page') || 1;
+
+    # get a list of (active) threads in a given forum
+    $c-&gt;stash-&gt;{thread_list} = $c-&gt;model('ParleyDB')-&gt;resultset('Thread')-&gt;search(
+        {
+            forum       =&gt; $c-&gt;_current_forum-&gt;id(),
+            active      =&gt; 1,
+        },
+        {
+            join        =&gt; 'last_post',
+            order_by    =&gt; 'sticky DESC, last_post.created DESC',
+            # pager information
+            rows        =&gt; $c-&gt;config-&gt;{threads_per_page},
+            page        =&gt; $c-&gt;stash-&gt;{current_page},
+        }
+    );
+
+    # setup the pager
+    $self-&gt;_forum_view_pager($c);
+}
+
+
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller (Private/Helper) Methods
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _forum_view_pager {
+    my ($self, $c) = @_;
+
+    $c-&gt;stash-&gt;{page} = $c-&gt;stash-&gt;{thread_list}-&gt;pager();
+
+    # TODO - find a better way to do this if possible
+    # set up Data::SpreadPagination
+    my $pagination = Data::SpreadPagination-&gt;new(
+        {
+            totalEntries        =&gt; $c-&gt;stash-&gt;{page}-&gt;total_entries(),
+            entriesPerPage      =&gt; $c-&gt;config-&gt;{threads_per_page},
+            currentPage         =&gt; $c-&gt;stash-&gt;{current_page},
+            maxPages            =&gt; 4,
+        }
+    );
+    $c-&gt;stash-&gt;{page_range_spread} = $pagination-&gt;pages_in_spread();
+}
+
+
+1;
+
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley::Controller::Forum - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 METHODS
+
+=head2 index 
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Controller/Help.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Help.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Help.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,63 @@
+package Parley::Controller::Help;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+sub index : Private {
+    my ( $self, $c ) = @_;
+    $c-&gt;stash-&gt;{template} = 'help/contents';
+}
+
+sub default :Private {
+    my ($self, $c) = @_;
+    my $help_template;
+
+    # the section / page to show is derived from the URI
+    $help_template = $c-&gt;request-&gt;arguments-&gt;[1];
+
+    # set the template to use based on the URI
+    $c-&gt;stash-&gt;{template} = qq[help/${help_template}];
+    # send to the view
+    $c-&gt;forward('Parley::View::TT');
+
+    # deal with errors (i.e. missing templates)
+    if ($c-&gt;error) {
+        # only show the &quot;unknown help section&quot; page if we couldn't find the
+        # page to show
+        if ($c-&gt;error-&gt;[0] =~ m{file error - help/$help_template: not found}ms) {
+            $c-&gt;clear_errors;
+            $c-&gt;forward( 'unknown' );
+        }
+    }
+}
+
+sub unknown :Local {
+    my ($self, $c) = @_;
+    $c-&gt;stash-&gt;{template} = 'help/unknown';
+}
+
+=head1 NAME
+
+Parley::Controller::Help - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 METHODS
+
+=head2 index 
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at users.berlios.de</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley/Controller/My.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/My.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/My.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,558 @@
+package Parley::Controller::My;
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+use Graphics::Magick;
+use Image::Size qw( html_imgsize imgsize );
+
+use Parley::App::Error qw( :methods );
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Global class data
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+my %dfv_profile_for = (
+    # DFV validation profile for preferences
+    time_format =&gt; {
+        # make sure we get *something* for checkboxes
+        # (which don't submit anything at all when unchecked)
+        defaults =&gt; {
+            use_utc     =&gt; 0,
+            show_tz     =&gt; 0,
+        },
+
+        require_some =&gt; {
+            tz_data =&gt; [ 1, qw(use_utc selectZone) ],
+        },
+        optional =&gt; [
+            qw( show_tz time_format ),
+        ],
+
+        filters     =&gt; [qw( trim )],
+        msgs =&gt; {
+            format  =&gt; q{%s},
+            missing =&gt; q{One or more required fields are missing},
+
+            constraints =&gt; {
+                tz_data =&gt; 'you must do stuff',
+            },
+        },
+    },
+
+    notifications =&gt; {
+        # make sure we get *something* for checkboxes
+        # (which don't submit anything at all when unchecked)
+        defaults =&gt; {
+            watch_on_post       =&gt; 0,
+            notify_thread_watch =&gt; 0,
+        },
+
+        required =&gt; [
+            qw(
+                watch_on_post
+                notify_thread_watch
+            )
+        ],
+    },
+
+    user_avatar =&gt; {
+        required =&gt; [
+            qw(
+                avatar_file
+            )
+        ],
+    },
+);
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller Actions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub auto : Private {
+    my ($self, $c) = @_;
+    # need to be logged in to perform any 'my' actions
+    my $status = $c-&gt;login_if_required(
+        q{You must be logged in before you can access this area}
+    );
+    if (not defined $status) {
+        return 0;
+    }
+
+    # undecided if you need to be authed to perform 'my' actions
+    #if (not Parley::App::Helper-&gt;is_authenticted($c)) {
+    #    $c-&gt;stash-&gt;{error}{message} = q{You need to authenticate your registration before you can start a new topic.};
+    #}
+
+
+    # data we always want in the stash for /my
+
+    # what's the current time? then we can show it in the TZ area
+    $c-&gt;stash-&gt;{current_time} = DateTime-&gt;now();
+
+    # fetch timezone categories
+    my $tz_categories = DateTime::TimeZone-&gt;all_names();
+    $c-&gt;stash-&gt;{tz_categories} = $tz_categories;
+
+    # fetch time formats
+    $c-&gt;stash-&gt;{time_formats} =
+        $c-&gt;model('ParleyDB')-&gt;resultset('PreferenceTimeString')-&gt;search(
+            {},     # fetch everything
+            {
+                order_by    =&gt; 'sample',    # order by the &quot;preview/sample&quot; string
+            }
+        );
+
+
+    return 1;
+}
+
+
+sub index : Private {
+    my ( $self, $c ) = @_;
+
+    $c-&gt;response-&gt;body('Matched Parley::Controller::My in My.');
+}
+
+
+sub preferences : Local {
+    my ($self, $c) = @_;
+    my ($tz_categories);
+
+    # where did we come from? it would be nice to return there when we're done
+    if (
+        defined $c-&gt;request-&gt;referer()
+            and 
+        $c-&gt;request-&gt;referer() !~ m{/my/preferences}xms
+    ) {
+        $c-&gt;session-&gt;{my_pref_came_from} = $c-&gt;request-&gt;referer();
+    }
+
+    # show a specific tab?
+    if (defined $c-&gt;request-&gt;param('tab')) {
+        $c-&gt;flash-&gt;{show_pref_tab} ||= 'tab_' . $c-&gt;request-&gt;param('tab');
+    }
+
+    # formfill/stash data
+    if ('UTC' eq $c-&gt;_authed_user()-&gt;preference()-&gt;timezone()) {
+        $c-&gt;stash-&gt;{formdata}{use_utc} = 1;
+    }
+    else {
+        $c-&gt;stash-&gt;{formdata}{selectZone}
+            = $c-&gt;_authed_user()-&gt;preference()-&gt;timezone();
+    }
+    # time format
+    if (defined $c-&gt;_authed_user()-&gt;preference()-&gt;time_format()) {
+        $c-&gt;stash-&gt;{formdata}{time_format} =
+            $c-&gt;_authed_user()-&gt;preference()-&gt;time_format()-&gt;id();
+    }
+    # show tz?
+    $c-&gt;stash-&gt;{formdata}{show_tz}
+        = $c-&gt;_authed_user()-&gt;preference()-&gt;show_tz();
+
+    # watched threads
+    my $watches = $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;search(
+        {
+            person      =&gt; $c-&gt;_authed_user()-&gt;id(),
+            watched     =&gt; 1,
+        },
+        {
+            order_by    =&gt; 'last_post.created DESC',
+            join        =&gt; {
+                'thread' =&gt; 'last_post',
+            },
+        }
+    );
+    $c-&gt;stash-&gt;{thread_watches} = $watches;
+
+    return;
+}
+
+sub update :Path('/my/preferences/update') {
+    my ($self, $c) = @_;
+    my $form_name = $c-&gt;request-&gt;param('form_name');
+
+    # use the my/preferences template
+    $c-&gt;stash-&gt;{template} = 'my/preferences';
+
+    # make sure the form name matches something we have a DFV profile for
+    if (not exists $dfv_profile_for{ $form_name }) {
+        parley_warn($c, qq{no such form: $form_name});
+        return;
+    }
+
+    # validate the specified form
+    $c-&gt;form(
+        $dfv_profile_for{ $form_name }
+    );
+
+    # are we updating TZ preferences?
+    my $ok_update;
+    if ('time_format' eq $form_name) {
+        # return to the right tab
+        # use session flash, or we lose the info with the redirect
+        $c-&gt;flash-&gt;{show_pref_tab} = 'tab_time';
+
+        $ok_update = $self-&gt;_process_form_time_format( $c );
+    }
+    # are we updating notification preferences?
+    elsif ('notifications' eq $form_name) {
+        # return to the right tab
+        # use session flash, or we lose the info with the redirect
+        $c-&gt;flash-&gt;{show_pref_tab} = 'tab_notify';
+
+        $ok_update = $self-&gt;_process_form_notifications( $c );
+    }
+    # are we updating the avatar
+    elsif ('user_avatar' eq $form_name) {
+        # return to the right tab
+        # use session flash, or we lose the info with the redirect
+        $c-&gt;flash-&gt;{show_pref_tab} = 'tab_avatar';
+
+        $ok_update = $self-&gt;_process_form_avatar( $c );
+    }
+
+    # otherwise we haven't decided how to handle the specified form ...
+    else {
+        $c-&gt;stash-&gt;{error}{message} = &quot;don't know how to handle: $form_name&quot;;
+        return;
+    }
+
+    if ($ok_update) {
+        $c-&gt;response-&gt;redirect( $c-&gt;uri_for('/my/preferences') );
+    }
+    else {
+        $c-&gt;stash-&gt;{template} = 'my/preferences';
+    }
+
+    return;
+}
+
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Private Methods
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _form_data_valid {
+    my ($self, $c) = @_;
+
+    # deal with missing/invalid fields
+    if ($c-&gt;form-&gt;has_missing()) {
+        parley_warn($c, q{You must fill in all the required fields});
+        foreach my $f ( $c-&gt;form-&gt;missing ) {
+            parley_warn($c, $f);
+        }
+
+        return; # invalid form data
+    }
+    elsif ($c-&gt;form-&gt;has_invalid()) {
+        parley_warn($c, q{One or more fields are invalid});
+        foreach my $f ( $c-&gt;form-&gt;invalid ) {
+            parley_warn($c, $f);
+        }
+
+        return; # invalid form data
+    }
+
+    # otherwise, the form data is ok ...
+    return 1;
+}
+
+
+sub upload : Global {
+    my ($self, $c) = @_;
+
+    if ( $c-&gt;request-&gt;parameters-&gt;{form_submit} eq 'yes' ) {
+
+        if ( my $upload = $c-&gt;request-&gt;upload('avatar_file') ) {
+
+            my $filename = $upload-&gt;filename;
+            my $target   = &quot;/tmp/upload/$filename&quot;;
+
+            unless ( $upload-&gt;link_to($target) || $upload-&gt;copy_to($target) ) {
+                die( &quot;Failed to copy '$filename' to '$target': $!&quot; );
+            }
+        }
+    }
+
+    #$c-&gt;stash-&gt;{template} = 'file_upload.html';
+    $c-&gt;stash-&gt;{template} = 'my/preferences';
+}
+
+
+sub _process_form_avatar {
+    my ($self, $c) = @_;
+    my ($upload);
+    $c-&gt;log-&gt;debug('_process_form_avatar');
+
+    if (not $self-&gt;_form_data_valid($c)) {
+        $c-&gt;log-&gt;debug('form data is not valid');
+        return;
+    }
+
+    $c-&gt;log-&gt;info( $c-&gt;request-&gt;param('avatar_file') );
+    
+    if ( $upload = $c-&gt;request-&gt;upload('avatar_file') ) {
+        $c-&gt;log-&gt;debug( ref($upload) );
+        $c-&gt;log-&gt;debug( $upload-&gt;filename );
+        $c-&gt;log-&gt;debug( $upload-&gt;type );
+        $c-&gt;log-&gt;debug( $upload-&gt;size );
+
+        # reject files that are too large
+        if ($upload-&gt;size &gt; 20480 ) {
+            parley_warn($c, q{File size too large. File must be no larger than 20K});
+            $c-&gt;log-&gt;info(q{File size too large. File must be no larger than 20K});
+            return;
+        }
+
+        # reject anything that doesn't appear to be an image
+        if ($upload-&gt;type !~ m{\Aimage/}xms) {
+            parley_warn(
+                $c,
+                  q{Uploaded file does not appear to be an image file [}
+                . $upload-&gt;type
+                . q{]}
+            );
+            return;
+        }
+
+        # store the file (but don't make it active yet)
+        my $filename    = $upload-&gt;filename;
+        my $target_dir  =   $c-&gt;path_to('root')
+                          . q{/static/user_file/}
+                          . $c-&gt;_authed_user-&gt;id();
+        my $target      = $target_dir . q{/} . $filename;
+
+        # create the directory if it doesn't exist
+        if (not -d $target_dir) {
+            mkdir $target_dir;
+            if (not -d $target_dir) {
+                parley_warn($c, q{Failed to create destination directory.  Unable to store upload.});
+                $c-&gt;log-&gt;error( qq{$target_dir - $!} );
+                return;
+            }
+        }
+
+        # save the file for processing
+        if ( not $upload-&gt;link_to($target) and not $upload-&gt;copy_to($target) ) {
+            parley_warn($c, q{Failed to store upload.});
+            $c-&gt;log-&gt;error( qq{$target - $!} );
+            return;
+        }
+        $c-&gt;log-&gt;info($target, $target_dir);
+
+        # check the image dimensions, and if it's too large, scale it down to
+        # something we accept, also convert it to a JPG
+        _convert_and_scale_image($target, $target_dir);
+    }
+
+    return 1;
+}
+
+sub _process_form_notifications {
+    my ($self, $c) = @_;
+
+    if (not $self-&gt;_form_data_valid($c)) {
+        return;
+    }
+
+    # Automatically add watches for new posts?
+    $c-&gt;_authed_user()-&gt;preference()-&gt;watch_on_post(
+        $c-&gt;form-&gt;valid('watch_on_post')
+    );
+
+    # Receive email notification for watched threads
+    $c-&gt;_authed_user()-&gt;preference()-&gt;notify_thread_watch(
+        $c-&gt;form-&gt;valid('notify_thread_watch')
+    );
+
+    # store changes
+    $c-&gt;_authed_user()-&gt;preference()-&gt;update;
+
+    return;
+}
+
+
+sub _process_form_time_format {
+    my ($self, $c) = @_;
+
+    if (not $self-&gt;_form_data_valid($c)) {
+        return;
+    }
+
+    $c-&gt;log-&gt;debug(
+        ref($c-&gt;_authed_user()-&gt;preference())
+    );
+
+    # tz preference value
+    if ($c-&gt;form-&gt;valid('use_utc')) {
+        $c-&gt;_authed_user()-&gt;preference()-&gt;timezone('UTC');
+    }
+    else {
+        $c-&gt;_authed_user()-&gt;preference()-&gt;timezone(
+            $c-&gt;form-&gt;valid('selectZone')
+        );
+    }
+    # time_format preference
+    if (defined $c-&gt;form-&gt;valid('time_format')) {
+        $c-&gt;_authed_user()-&gt;preference()-&gt;time_format(
+            $c-&gt;form-&gt;valid('time_format')
+        )
+    }
+    else {
+        $c-&gt;_authed_user()-&gt;preference()-&gt;time_format( undef );
+    }
+    # show_tz
+    $c-&gt;_authed_user()-&gt;preference()-&gt;show_tz(
+        ($c-&gt;form-&gt;valid('show_tz') || 0)
+    );
+    # store changes
+    $c-&gt;_authed_user()-&gt;preference()-&gt;update();
+
+    return;
+}
+
+sub saveHandler : Local {
+    my ($self, $c) = @_;
+    my $fieldname = $c-&gt;request-&gt;param('fieldname');
+
+    my %field_map = (
+        'First Name' =&gt; {
+            'resultset'     =&gt; 'Person',
+            'db_column'     =&gt; 'first_name',
+        },
+        'Last Name' =&gt; {
+            'resultset'     =&gt; 'Person',
+            'db_column'     =&gt; 'last_name',
+        },
+        'Forum Name' =&gt; {
+            'resultset'     =&gt; 'Person',
+            'db_column'     =&gt; 'forum_name',
+            'is_unique'     =&gt; 1,
+        },
+    );
+
+    if (exists $field_map{$fieldname}) {
+        my $resultset = $field_map{$fieldname}-&gt;{resultset};
+        my $db_column = $field_map{$fieldname}-&gt;{db_column};
+        my $is_unique = $field_map{$fieldname}-&gt;{is_unique} || 0;
+
+        # get the user we're authed as
+        my $person = $c-&gt;model('ParleyDB')-&gt;resultset($resultset)-&gt;find(
+            $c-&gt;_authed_user()-&gt;id()
+        );
+        # it would be nice to deduce this from the schema, but hey ..
+        # .. this'll do for now
+        if ($is_unique) {
+            # make sure the value isn't already in use
+            my $count = $c-&gt;model('ParleyDB')-&gt;resultset($resultset)-&gt;count(
+                {
+                    $db_column =&gt; $c-&gt;request-&gt;param('value'),
+                }
+            );
+            if ($count) {
+                $c-&gt;response-&gt;body(
+                      q{&lt;p&gt;'}
+                    . $c-&gt;request-&gt;param('value')
+                    . q{' has already been used by another user.&lt;/p&gt;}
+                );
+                return;
+            };
+        }
+
+        # perform the update
+        eval {
+            # update the relevant field
+            $person-&gt;update(
+                {
+                    $db_column =&gt; $c-&gt;request-&gt;param('value'),
+                }
+            );
+        };
+        # check for errors
+        if ($@) {
+            parley_warn($c, $@);
+            $c-&gt;response-&gt;body(qq{&lt;p&gt;ERROR: $@&lt;/p&gt;});
+        }
+        else {
+            $c-&gt;response-&gt;body(
+                  q{&lt;p&gt;Updated }
+                . $fieldname
+                . q{ from '}
+                . $c-&gt;request-&gt;param('ovalue')
+                . q{' to '}
+                . $c-&gt;request-&gt;param('value')
+                . q{'&lt;/p&gt;}
+            );
+        }
+    }
+    else {
+        $c-&gt;response-&gt;body(q{&lt;p&gt;Unknown field name&lt;/p&gt;});
+    }
+}
+
+sub _convert_and_scale_image {
+    my ($file, $destdir) = @_;
+    my $options = {
+        'width'  =&gt; 100,
+        'height' =&gt; 150,
+    };
+
+    # get the image dimensions
+    my ($width, $height) = imgsize($file);
+
+    # create a new image mangling object
+    my $img = Graphics::Magick-&gt;new()
+        or die $!;
+
+    # read in the image file
+    $img-&gt;Read($file);
+
+    if ($width &gt; $options-&gt;{width} or $height &gt; $options-&gt;{height}) {
+        # scale the longest side - if it's square, scale by height
+        if ($width &gt; $height) {
+            # scale down by width
+            warn('# scale down by width');
+            $img-&gt;Resize(
+                geometry =&gt; $options-&gt;{width}
+            );
+        }
+        elsif ($height &gt;= $width) {
+            # scale down by height
+            warn('# scale down by height');
+            $img-&gt;Resize(
+                geometry =&gt; q{x} . $options-&gt;{height}
+            );
+        }
+    }
+
+    # write out the scaled image
+    $img-&gt;Write($destdir . q{/avatar.jpg});
+
+    return;
+}
+
+=head1 NAME
+
+Parley::Controller::My - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 METHODS
+
+=head2 index 
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at users.berlios.de</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley/Controller/Post.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Post.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Post.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,156 @@
+package Parley::Controller::Post;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+use DateTime;
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Global class data
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+my %dfv_profile_for = (
+    # DFV validation profile for adding a new topic
+    edit_post =&gt; {
+        required    =&gt; [qw( post_message )],
+        filters     =&gt; [qw( trim )],
+        msgs =&gt; {
+            format  =&gt; q{%s},
+            missing =&gt; q{One or more required fields are missing},
+        },
+    },
+);
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller Actions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub edit : Local {
+    my ($self, $c) = @_;
+
+    # if we don't have a post param, then return with an error
+    unless (defined $c-&gt;_current_post) {
+        $c-&gt;stash-&gt;{error}{message} = q{Incomplete URL};
+        return;
+    }
+
+    # you need to be logged in to edit a post
+    # (although non-logged users shouldn't see an edit link, you never know
+    # what people will make-up or bookmark)
+    $c-&gt;login_if_required(q{You must be logged in before you can edit your posts.});
+
+    # you can only edit you own posts
+    # (unless you're a moderator, but we don't do that yet)
+    if ($c-&gt;_authed_user()-&gt;id() != $c-&gt;_current_post()-&gt;creator()-&gt;id()) {
+        $c-&gt;stash-&gt;{error}{message} = q{You can only edit posts you have made};
+        return;
+    }
+
+    # you can't edit a locked post
+    elsif ($c-&gt;_current_post-&gt;thread-&gt;locked) {
+        $c-&gt;stash-&gt;{error}{message} = q{You can't edit locked posts};
+        return;
+    }
+
+    # process the form submission
+    else {
+        # validate the form data
+        $c-&gt;form(
+            $dfv_profile_for{edit_post}
+        );
+        # deal with missing/invalid fields
+        if ($c-&gt;form-&gt;has_missing()) {
+            $c-&gt;stash-&gt;{view}{error}{message} = q{You must fill in all the required fields};
+            foreach my $f ( $c-&gt;form-&gt;missing ) {
+                push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+            }
+        }
+        elsif ($c-&gt;form-&gt;has_invalid()) {
+            $c-&gt;stash-&gt;{view}{error}{message} = q{One or more fields are invalid};
+            foreach my $f ( $c-&gt;form-&gt;invalid ) {
+                push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+            }
+        }
+        # otherwise; everything seems fine - edit the post
+        else {
+            # update the post with the new information
+            $c-&gt;_current_post-&gt;message( $c-&gt;form-&gt;valid-&gt;{post_message} );
+
+            # set the edited time
+            $c-&gt;_current_post-&gt;edited( DateTime-&gt;now() );
+
+            # store the updates in the db
+            $c-&gt;_current_post-&gt;update();
+
+            # view the (updated) post
+            $c-&gt;detach('/post/view');
+        }
+    }
+}
+
+sub view : Local {
+    my ($self, $c) = @_;
+
+    # if we don't have a post param, then return with an error
+    unless (defined $c-&gt;_current_post) {
+        $c-&gt;stash-&gt;{error}{message} = q{Incomplete URL};
+        return;
+    }
+
+    # work out what page in which thread the post lives
+    my $thread = $c-&gt;_current_post-&gt;thread-&gt;id();
+    my $page_number =  $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;page_containing_post(
+        $c-&gt;stash-&gt;{current_post},
+        $c-&gt;config-&gt;{posts_per_page},
+    );
+
+    # build the URL to redirect to
+    my $redirect_url =
+        $c-&gt;uri_for(
+            '/thread/view',
+            {
+                thread  =&gt; $thread,
+                page    =&gt; $page_number,
+            }
+        )
+        . &quot;#&quot; . $c-&gt;_current_post-&gt;id()
+    ;
+
+    # redirect to the relevant place in the appropriate thread
+    $c-&gt;log-&gt;debug( &quot;post/view: redirecting to $redirect_url&quot; );
+    $c-&gt;response-&gt;redirect( $redirect_url );
+    return;
+}
+
+
+1;
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley::Controller::Post - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 ACTIONS
+
+=head2 view 
+
+View a specific post, specified by the post in $c-&gt;_current_post
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Controller/Root.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Root.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Root.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,256 @@
+package Parley::Controller::Root;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+#
+# Sets the actions in this controller to be registered with no prefix
+# so they function identically to actions created in MyApp.pm
+#
+__PACKAGE__-&gt;config-&gt;{namespace} = '';
+
+# pre-populate values in the stash if we're given &quot;appropriate&quot; information:
+# - _authed_user
+# - _current_post
+# - _current_thread
+# - _current_forum
+sub auto : Private {
+    my ($self, $c) = @_;
+
+    # get a list of (all/available) forums
+    $c-&gt;stash-&gt;{available_forums} = $c-&gt;model('ParleyDB')-&gt;resultset('Forum')-&gt;search(
+        {
+            active  =&gt; 1,
+        },
+        {
+            order_by    =&gt; 'name ASC',
+        }
+    );
+
+    ############################################################
+    # if we have a user ... fetch some info (if we don't already have it)
+    ############################################################
+    if ( $c-&gt;user and not defined $c-&gt;_authed_user ) {
+        $c-&gt;log-&gt;info('Fetching user information for ' . $c-&gt;user-&gt;id);
+
+        # get the person info for the username
+        my $row = $c-&gt;model('ParleyDB')-&gt;resultset('Person')-&gt;find(
+            {
+                'authentication.username'   =&gt; $c-&gt;user-&gt;username(),
+            },
+            {
+                join =&gt; 'authentication',
+            },
+        );
+        $c-&gt;_authed_user( $row );
+
+        #####################################################################
+        # cater for database upgrades, and make sure the user has preferences
+        #####################################################################
+        #Parley::App::Helper-&gt;user_preference_check($c);
+    }
+
+
+    ##################################################
+    # do we have a post id in the URL?
+    ##################################################
+    if (defined $c-&gt;request-&gt;param('post')) {
+        # make sure the paramter looks sane
+        if (not $c-&gt;request-&gt;param('post') =~ m{\A\d+\z}) {
+            $c-&gt;stash-&gt;{error}{message} = 'non-integer post id passed: ['
+                . $c-&gt;request-&gt;param('post')
+                . ']';
+            return;
+        }
+
+        # get the matching post
+        $c-&gt;_current_post(
+            $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;find(
+                {
+                    post_id  =&gt; $c-&gt;request-&gt;param('post')
+                }
+            )
+        );
+
+        # set the current_thread from the current_post
+        $c-&gt;_current_thread(
+            $c-&gt;_current_post-&gt;thread()
+        );
+
+        # set the current_forum from the current thread
+        $c-&gt;_current_forum(
+            $c-&gt;_current_thread-&gt;forum()
+        );
+    }
+    ##################################################
+    # (elsif) do we have a thread id in the URL?
+    ##################################################
+    elsif (defined $c-&gt;request-&gt;param('thread')) {
+        # make sure the paramter looks sane
+        if (not $c-&gt;request-&gt;param('thread') =~ m{\A\d+\z}) {
+            $c-&gt;stash-&gt;{error}{message} = 'non-integer thread id passed: ['
+                . $c-&gt;request-&gt;param('thread')
+                . ']';
+            return;
+        }
+
+        # get the matching thread
+        $c-&gt;_current_thread(
+            $c-&gt;model('ParleyDB')-&gt;resultset('Thread')-&gt;find(
+                {
+                    thread_id  =&gt; $c-&gt;request-&gt;param('thread'),
+                }
+            )
+        );
+
+        # set the current_forum from the current thread
+        $c-&gt;_current_forum(
+            $c-&gt;_current_thread-&gt;forum()
+        );
+    }
+    ##################################################
+    # do we have a forum id in the URL?
+    ##################################################
+    elsif (defined $c-&gt;request-&gt;param('forum')) {
+        # make sure the paramter looks sane
+        if (not $c-&gt;request-&gt;param('forum') =~ m{\A\d+\z}) {
+            $c-&gt;stash-&gt;{error}{message} = 'non-integer forum id passed: ['
+                . $c-&gt;request-&gt;param('forum')
+                . ']';
+            return;
+        }
+
+        # get the matching forum
+        $c-&gt;_current_forum(
+            $c-&gt;model('ParleyDB')-&gt;resultset('Forum')-&gt;find(
+                {
+                    forum_id  =&gt; $c-&gt;request-&gt;param('forum'),
+                }
+            )
+        );
+    }
+
+
+    ##################################################
+    # if we are logged in and if we have a current_forum, can the (current)
+    # user moderate it?
+    ##################################################
+    if (defined $c-&gt;_authed_user() and defined $c-&gt;_current_forum()) {
+        # 'topdog' user can moderate anything
+        if (0 == $c-&gt;_authed_user()-&gt;id()) {
+            $c-&gt;log-&gt;debug( q{topdog user moderates anything he wants} );
+            $c-&gt;stash-&gt;{moderator} = 1;
+        }
+        else {
+            # look up person/forum
+            my $results = $c-&gt;model('ParleyDB')-&gt;resultset('ForumModerator')-&gt;find(
+                {
+                    person  =&gt; $c-&gt;_authed_user()-&gt;id(),
+                    forum   =&gt; $c-&gt;_current_forum()-&gt;id(),
+                },
+                {
+                    key     =&gt; 'forum_moderator_person_key',
+                }
+            );
+            # if we found something, they must moderate the current forum
+            if ($results) {
+                $c-&gt;log-&gt;debug( q{user moderates this forum} );
+                $c-&gt;stash-&gt;{moderator} = 1;
+            }
+        }
+    }
+
+    # let things continue ...
+    return 1;
+}
+
+# if someone hits the application index '/' then send them off to the default
+# action (defined in the app-config)
+sub index : Private {
+    my ( $self, $c ) = @_;
+    # redirect to the default action
+    $c-&gt;response-&gt;redirect( $c-&gt;uri_for($c-&gt;config-&gt;{default_uri}) );
+}
+
+# by default show a 404 for anything we don't know about
+sub default : Private {
+    my ( $self, $c ) = @_;
+
+    $c-&gt;response-&gt;status(404);
+    $c-&gt;response-&gt;body( '404 Not Found' );
+}
+
+
+# deal with the end of the phase
+sub render : ActionClass('RenderView') {
+    my ($self, $c) = @_;
+
+    # if we have any error(s) in the stash, automatically show the error page
+    if (defined $c-&gt;stash-&gt;{error}) {
+        $c-&gt;stash-&gt;{template} = 'error/simple';
+        $c-&gt;log-&gt;error( $c-&gt;stash-&gt;{error}{message} );
+    }
+}
+
+sub end : Private {
+    my ($self, $c) = @_;
+    $c-&gt;forward('render');
+
+    # fill in any forms
+    $c-&gt;fillform( );
+    $c-&gt;fillform( $c-&gt;stash-&gt;{formdata} );
+}
+
+
+1;
+
+__END__
+
+
+=pod
+
+=head1 NAME
+
+Parley::Controller::Root - Root Controller for Parley
+
+=head1 DESCRIPTION
+
+[enter your description here]
+
+=head1 METHODS
+
+=head2 auto
+
+Used to fetch user-information if the user has authenticated.
+
+Also pre-populate current_(post|thread|forum) values in the stash if we have
+appropriate information in the URL's query parameters.
+
+=head2 default
+
+Emit a 404 status and a 'Not Found' message.
+
+=head2 end
+
+Attempt to render a view, if needed.
+
+If I&lt;error&gt; is defined in the stash, render the error template.
+
+=head2 index
+
+Redirect to the applications default action, as defined by I&lt;default_uri&gt; in
+parley.yml
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Controller/Search.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Search.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Search.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,154 @@
+package Parley::Controller::Search;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+use Text::Search::SQL;
+use URI;
+use URI::QueryParam;
+
+sub index : Private {
+    my ( $self, $c ) = @_;
+
+    $c-&gt;response-&gt;body('Matched Parley::Controller::Search in Search.');
+}
+
+sub end :Private {
+    my ($self, $c) = @_;
+
+    # we're likely to want pages results for numerous seaches
+    $self-&gt;_results_view_pager($c);
+
+    # finish processing the page and display
+    $c-&gt;forward('/end');
+}
+
+sub forum :Local {
+    my ($self, $c) = @_;
+    my ($search_terms, $resultset, $tss, $search_where, $where, @join);
+
+    # page to show - either a param, or show the first
+    $c-&gt;stash-&gt;{current_page}= $c-&gt;request-&gt;param('page') || 1;
+
+    # the search terms
+    $search_terms = $c-&gt;request-&gt;param('search_terms');
+
+    # if we don't have anything to search for ..
+    if (not defined $search_terms or $search_terms =~ m{\A\s*\z}xms) {
+        return;
+    }
+
+    # start with no join(s)
+    @join = ();
+
+    # save the search terms for the template to display
+    $c-&gt;stash-&gt;{search_terms}{raw} = $search_terms;
+
+    # get a suitable where-clause to use based on the search terms
+    $tss = Text::Search::SQL-&gt;new(
+        {
+            search_term     =&gt; $search_terms,
+            search_type     =&gt; q{ilike},
+            search_fields   =&gt; [ qw(me.subject me.message) ],
+        }
+    );
+    $tss-&gt;parse();
+    $search_where = $tss-&gt;get_sql_where();
+
+    # build the where clause to pass to our search
+    $where = {
+        # we want to OR the items in $sql_where
+        -or =&gt; $search_where,
+    };
+
+    # if we have a search_forum, limit to that
+    if (defined $c-&gt;request-&gt;param('search_forum')) {
+        my ($forum);
+        eval {
+            $forum = $c-&gt;model('ParleyDB')-&gt;resultset('Forum')-&gt;find(
+                {
+                    forum_id    =&gt; $c-&gt;request-&gt;param('search_forum'),
+                }
+            );
+        };
+
+        if (defined $forum) {
+            $where-&gt;{'thread.forum'} = $forum-&gt;id(),
+            push @join, 'thread';
+            # put in the stash
+            $c-&gt;stash-&gt;{search_forum} = $forum;
+        }
+    }
+
+    # search for any posts in the forum with the search_terms (phrase) in the
+    # subject or body
+    $resultset = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;search(
+        $where,
+        {
+            join        =&gt; \@join,
+            order_by    =&gt; q{created DESC},
+            # results paging
+            rows        =&gt; $c-&gt;config-&gt;{search_results_per_page},
+            page        =&gt; $c-&gt;stash-&gt;{current_page},
+        }
+    );
+
+    if ($resultset-&gt;count() &gt; 0) {
+        $c-&gt;stash-&gt;{search_results} = $resultset;
+    }
+}
+
+sub _results_view_pager {
+    my ($self, $c) = @_;
+
+    if (not $c-&gt;stash-&gt;{search_results}) {
+        $c-&gt;log-&gt;debug('no results - no pager');
+        return;
+    }
+
+    $c-&gt;stash-&gt;{page} = $c-&gt;stash-&gt;{search_results}-&gt;pager();
+
+    # TODO - find a better way to do this if possible
+    # set up Data::SpreadPagination
+    my $pagination = Data::SpreadPagination-&gt;new(
+        {
+            totalEntries        =&gt; $c-&gt;stash-&gt;{page}-&gt;total_entries(),
+            entriesPerPage      =&gt; $c-&gt;config-&gt;{search_results_per_page},
+            currentPage         =&gt; $c-&gt;stash-&gt;{current_page},
+            maxPages            =&gt; 4,
+        }
+    );
+    $c-&gt;stash-&gt;{page_range_spread} = $pagination-&gt;pages_in_spread();
+
+    # extra params to use in pager links (to preserve search data)
+    my $u = URI-&gt;new(&quot;&quot;, &quot;http&quot;);
+    $u-&gt;query_param(search_terms =&gt; $c-&gt;stash-&gt;{search_terms}{raw});
+    $u-&gt;query_param(search_forum =&gt; $c-&gt;request-&gt;param('search_forum'));
+    $c-&gt;stash-&gt;{url_extra_args} = '&amp;' . $u-&gt;query();
+}
+
+=head1 NAME
+
+Parley::Controller::Search - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 METHODS
+
+=head2 index 
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at users.berlios.de</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley/Controller/Thread.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/Thread.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/Thread.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,992 @@
+package Parley::Controller::Thread;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+use Data::SpreadPagination;
+
+use Parley::App::Notification qw( :watch );
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Global class data
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+my %dfv_profile_for = (
+    # DFV validation profile for adding a new topic
+    new_topic =&gt; {
+        required    =&gt; [qw( thread_subject thread_message )],
+        optional    =&gt; [qw( watch_on_post )],
+        filters     =&gt; [qw( trim )],
+        msgs =&gt; {
+            format  =&gt; q{%s},
+            missing =&gt; q{One or more required fields are missing},
+        },
+    },
+
+    # DFV validation profile for adding a reply to an existing topic
+    new_reply =&gt; {
+        required    =&gt; [qw( thread_message )],
+        optional    =&gt; [qw( thread_subject lock_thread watch_on_post )],
+        filters     =&gt; [qw( trim )],
+    },
+);
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller Actions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub add : Local {
+    my ($self, $c) = @_;
+
+    # make sure we're logged in
+    $c-&gt;login_if_required(q{You must be logged in before you can add a new topic.});
+
+    # make sure we're authenticated
+    # XXX
+
+    # if we have a form POST ...
+    if (defined $c-&gt;request-&gt;method() and $c-&gt;request-&gt;method() eq 'POST') {
+        $self-&gt;_add_new_thread($c);
+    }
+    # otherwise we continue merrily on our way, and simply display the
+    # thread/add page
+    else {
+        # thread/add template shown automagically
+    }
+}
+
+sub next_post : Local {
+    my ($self, $c) = @_;
+
+    # make sure we're logged in
+    $c-&gt;login_if_required(q{You must be logged in before you can use the thread continuation function});
+
+    # get the most recent post the user has seen
+    my $last_viewed_post = $c-&gt;model('ParleyDB')-&gt;resultset('Thread')-&gt;last_post_viewed_in_thread(
+        $c-&gt;_authed_user(),
+        $c-&gt;_current_thread(),
+    );
+
+    # get the post after the last one viewed, and make this the current post
+    $c-&gt;_current_post(
+        $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;next_post(
+            $last_viewed_post
+        )
+    );
+
+    # view the next post (now the current post)
+    $c-&gt;detach('/post/view');
+}
+
+sub recent : Local {
+    my ($self, $c) = @_;
+    my ($where, @join);
+
+    # page to show - either a param, or show the first
+    $c-&gt;stash-&gt;{current_page}= $c-&gt;request-&gt;param('page') || 1;
+
+    # always want to join with last_post table
+    @join = qw(last_post);
+
+    # only search active forums
+    $where-&gt;{active} = 1;
+
+    # if we're only interested in a given forum
+    if (defined $c-&gt;_current_forum()) {
+        $where-&gt;{forum} = $c-&gt;_current_forum-&gt;id();
+    }
+
+    # Trying to achieve:
+    # SELECT me.thread_id, me.locked, me.creator, me.subject, me.active,
+    #   me.forum, me.created, me.last_post, me.sticky, me.post_count,
+    #   me.view_count, forum_moderator.can_moderate
+    # FROM thread me
+    # LEFT JOIN forum_moderator ON ( me.forum = forum_moderator.forum )
+    # JOIN post last_post ON ( last_post.post_id = me.last_post )
+    # ORDER BY sticky DESC, last_post.created DESC;
+    #
+    # Version 2 of the SQL we're aiming for:
+    #   SELECT  thread_id,post_count,active,sticky,person,can_moderate
+    #   FROM    thread me
+    #       JOIN post last_post
+    #       ON ( last_post.post_id = me.last_post )
+    #
+    #       LEFT JOIN forum_moderator forum_moderators
+    #       ON (    forum_moderators.forum = me.forum
+    #               and
+    #               forum_moderators.person = NULL)
+    #   WHERE ( active = true );
+
+
+    # if we have an authed_user, we can see if they're a moderator for given
+    # threads
+    # XXX
+#    if (defined $c-&gt;_authed_user()) {
+#        # limit to person we're authed as
+#        $where-&gt;{'forum_moderators.person'} = $c-&gt;_authed_user()-&gt;id();
+#        # add the new join that's required
+#        push @join, 'forum_moderators';
+#    }
+#    else {
+#        $where-&gt;{'forum_moderators.person'} = undef;
+#        push @join, 'forum_moderators';
+#    }
+
+    # get a list of threads, most recently updated first
+    $c-&gt;stash-&gt;{thread_list} = $c-&gt;model('ParleyDB')-&gt;resultset('Thread')-&gt;search(
+        $where,
+        {
+            join        =&gt; \@join,
+            order_by    =&gt; 'last_post.created DESC',
+
+            rows        =&gt; $c-&gt;config-&gt;{threads_per_page},
+            page        =&gt; $c-&gt;stash-&gt;{current_page},
+        }
+    );
+
+    # setup the pager
+    $self-&gt;_prepare_pager($c, $c-&gt;stash-&gt;{thread_list});
+
+    $c-&gt;log-&gt;debug( $c-&gt;stash-&gt;{thread_list}-&gt;count() );
+    return;
+}
+
+sub reply : Local {
+    my ($self, $c) = @_;
+
+    # make sure we're logged in
+    $c-&gt;login_if_required(q{You must be logged in before you can add a reply.});
+
+    # make sure we're authenticated
+    # XXX
+
+    # can't reply to a locked thread
+    if ($c-&gt;_current_thread()-&gt;locked()) {
+        #die q{can't reply to a locked thread!};
+        $c-&gt;stash-&gt;{error}{message} = q{You can't reply to a locked thread};
+        return;
+    };
+
+    # if we have a current post, then we're performing a quoted reply
+    # (otherwise we should have the thread that we're adding a reply to)
+    # are we quoting a post that we're replying to?
+    if (defined $c-&gt;_current_post()) {
+        $c-&gt;stash-&gt;{quote_post} = $c-&gt;_current_post();
+    }
+
+    # get the post we're replying to
+    $self-&gt;_get_thread_reply_post($c);
+
+    # if we have a form POST ...
+    if (defined $c-&gt;request-&gt;method()
+            and $c-&gt;request-&gt;method() eq 'POST'
+            and defined $c-&gt;request-&gt;param('post_reply')
+    ) {
+        $c-&gt;log-&gt;debug('calling: _add_new_reply($c)');
+        $self-&gt;_add_new_reply($c);
+    }
+    # other wise we continue merrily on our way, and simply display the
+    # thread/reply page
+    else {
+        $c-&gt;log-&gt;debug('allowing fall-through to view in reply()');
+        # thread/reply template shown automagically
+    }
+}
+
+sub view : Local {
+    my ($self, $c) = @_;
+
+    # page to show - either a param, or show the first
+    $c-&gt;stash-&gt;{current_page}= $c-&gt;request-&gt;param('page') || 1;
+
+    # if we have a current_post, view the page with the post on it
+    if ($c-&gt;_current_post) {
+        $c-&gt;detach('/post/view');
+    }
+
+    ##################################################
+    # get all the posts in the thread
+    ##################################################
+    $c-&gt;stash-&gt;{post_list} = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;search(
+        {
+            thread =&gt; $c-&gt;_current_thread-&gt;id(),
+        },
+        {
+            order_by    =&gt; 'created ASC',
+            rows        =&gt; $c-&gt;config-&gt;{posts_per_page},
+            page        =&gt; $c-&gt;stash-&gt;{current_page},
+        }
+    );
+
+    ##################################################
+    # updates triggered by viewing a thread
+    ##################################################
+    {
+        $self-&gt;_increase_thread_view_count($c);
+    }
+
+    ##################################################
+    # some updates for logged in users
+    ##################################################
+    if ($c-&gt;_authed_user) {
+        $c-&gt;log-&gt;debug('thread view by authed user');
+
+        # update thread_view for user
+        $self-&gt;_update_thread_view($c);
+
+        # store thread watch status info
+        $self-&gt;_watching_thread($c);
+    }
+
+    ##################################################
+    # general information for all viewers
+    ##################################################
+    {
+        # get the number of people watching the thread
+        $self-&gt;_thread_watch_count($c);
+
+        # setup the pager
+        #$self-&gt;_thread_view_pager($c);
+        $self-&gt;_prepare_pager($c, $c-&gt;stash-&gt;{post_list});
+    }
+
+    1; # return 'true'
+}
+
+sub watch :Local {
+    my ($self, $c) = @_;
+
+    # the watch parameter tells us if we're adding or removing a watch
+    # if it's not specified, default action os to ADD a watch
+    my $watched = $c-&gt;request-&gt;param('watch');
+    if (not defined $watched) {
+        $watched = 1;
+    }
+
+    # need to be logged in to watch threads
+    $c-&gt;login_if_required($c, q{You must be logged in before you can watch a topic.});
+
+    # get the ThreadView so we can update it
+    my $thread_view = $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;find(
+        {
+            person  =&gt; $c-&gt;_authed_user()-&gt;id(),
+            thread  =&gt; $c-&gt;_current_thread()-&gt;id(),
+        }
+    );
+
+    # if we couldn't find a thread view, then something odd is happening -
+    # logged in users should always have a thread_view entry
+    if (not defined $thread_view) {
+        $c-&gt;stash-&gt;{error}{message} = q{Failed to watch requested thread};
+        $c-&gt;log-&gt;error(q{User doesn't have a thread_view entry});
+        return;
+    }
+
+    # we have a thread_view entry for the user, so update it, and redirect the
+    # user back to the thread
+
+    # update the watched status
+    $thread_view-&gt;watched( $watched );
+    $thread_view-&gt;update();
+
+    # if we have a current post we can use that to return to the &quot;right
+    # place&quot; in the thread
+    if (defined $c-&gt;_current_post()) {
+        $c-&gt;detach('/post/view');
+    }
+    # otherwise we want to redirect back to the same page in the current
+    # thread
+    else {
+        my ($page_number, $redirect_url);
+
+        # page to show - either a param, or show the first
+        $page_number = $c-&gt;request-&gt;param('page') || 1;
+
+        # build the URL to redirect to
+        $redirect_url = $c-&gt;uri_for(
+            '/thread/view',
+            {
+                thread  =&gt; $c-&gt;_current_thread()-&gt;id(),
+                page    =&gt; $page_number,
+            }
+        );
+
+        # redirect to the apropriate place
+        $c-&gt;response-&gt;redirect( $redirect_url );
+        return;
+    }
+}
+
+sub watches : Local {
+    my ($self, $c) = @_;
+
+    # make sure we're logged in
+    $c-&gt;login_if_required(q{You must be logged in before you can view your watched threads});
+
+    # watched threads
+    my $watches = $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;search(
+        {
+            person      =&gt; $c-&gt;_authed_user()-&gt;id(),
+            watched     =&gt; 1,
+        },
+        {
+            order_by    =&gt; 'last_post.created DESC',
+            join        =&gt; {
+                'thread' =&gt; 'last_post',
+            },
+        }
+    );
+    $c-&gt;stash-&gt;{thread_watches} = $watches;
+
+    # if we've got a list of threads to stop watching ...
+    if (my @thread_ids = $c-&gt;request-&gt;param('stop_watching')) {
+        $c-&gt;log-&gt;debug( q{stop_watching parameter found} );
+        foreach my $thread_id ( @thread_ids ) {
+            # get the ThreadView so we can update it
+            my $thread_view = $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;find(
+                {
+                    person  =&gt; $c-&gt;_authed_user()-&gt;id(),
+                    thread  =&gt; $thread_id,
+                }
+            );
+
+            # if we couldn't find a thread view, then something odd is happening -
+            # logged in users should always have a thread_view entry
+            if (not defined $thread_view) {
+                $c-&gt;stash-&gt;{error}{message} = q{Failed to watch requested thread};
+                $c-&gt;log-&gt;error(q{User doesn't have a thread_view entry});
+                return;
+            }
+
+            # we have a thread_view entry for the user, so update it
+
+            # update the watched status
+            $thread_view-&gt;watched( 0 );
+            $thread_view-&gt;update();
+        }
+    }
+
+    return;
+}
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller (Private/Helper) Methods
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _add_new_reply {
+    my ($self, $c) = @_;
+    my ($new_reply);
+
+    # validate the form data
+    $c-&gt;form(
+        $dfv_profile_for{new_reply}
+    );
+
+    # deal with missing/invalid fields
+    if ($c-&gt;form-&gt;has_missing()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{You must fill in all the required fields};
+        foreach my $f ( $c-&gt;form-&gt;missing ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+    }
+    elsif ($c-&gt;form-&gt;has_invalid()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{One or more fields are invalid};
+        foreach my $f ( $c-&gt;form-&gt;invalid ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+    }
+
+    # otherwise, the form data is ok ...
+    else {
+        # try to add the reply to the thread
+        eval {
+            $new_reply = $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+                sub { return $self-&gt;_txn_add_new_reply($c) }
+            );
+        };
+        # deal with any transaction errors
+        if ($@) {                                   # Transaction failed
+            die &quot;something terrible has happened!&quot;  #
+                if ($@ =~ /Rollback failed/);       # Rollback failed
+
+            $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+            $c-&gt;log-&gt;error( $@ );
+            return;
+        }
+    }
+
+    # getting here means we validated the form, and added required data for the
+    # new thread
+
+    # set the current post
+    $c-&gt;_current_post( $new_reply );
+
+    # let interested parties know about the new post
+    notify_watchers( $c, $new_reply );
+
+    # view the &quot;next post&quot; in the new thread
+    $c-&gt;detach('next_post');
+}
+
+sub _add_new_thread {
+    my ($self, $c) = @_;
+    my ($new_thread);
+
+    # validate the form data
+    $c-&gt;form(
+        $dfv_profile_for{new_topic}
+    );
+
+    # deal with missing/invalid fields
+    if ($c-&gt;form-&gt;has_missing()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{You must fill in all the required fields};
+        foreach my $f ( $c-&gt;form-&gt;missing ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+    }
+    elsif ($c-&gt;form-&gt;has_invalid()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{One or more fields are invalid};
+        foreach my $f ( $c-&gt;form-&gt;invalid ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+    }
+
+    # otherwise, the form data is ok ...
+    else {
+        # try to add the thread
+        eval {
+            $new_thread = $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+                sub { return $self-&gt;_txn_add_new_thread($c) }
+            );
+        };
+        # deal with any transaction errors
+        if ($@) {                                   # Transaction failed
+            die &quot;something terrible has happened!&quot;  #
+                if ($@ =~ /Rollback failed/);       # Rollback failed
+
+            $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+            $c-&gt;log-&gt;error( $@ );
+            return;
+        }
+    }
+
+    # getting here means we validated the form, and added required data for the
+    # new thread
+
+    # set the current thread
+    $c-&gt;_current_thread( $new_thread );
+
+    # view the &quot;next post&quot; in the new thread
+    $c-&gt;detach('next_post');
+}
+
+sub _get_thread_reply_post {
+    my ($self, $c) = @_;
+    my ($posts);
+
+    # it would be good to display the relevant post in the thread, so people know
+    # what they're replying to
+    # - if adding a reply, assume the first post
+    # - if we have a post value, then that's the one we're replying to
+    if (defined $c-&gt;_current_post()) {
+        # get the specific post we're responding to
+        $posts = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;search(
+            {
+                post_id     =&gt; $c-&gt;_current_post()-&gt;id(),
+            },
+            {
+                rows        =&gt; 1,
+            }
+        );
+    }
+    elsif (defined $c-&gt;_current_thread()) {
+        # get the first post in the thread
+        $posts = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;search(
+            {
+                thread      =&gt; $c-&gt;_current_thread()-&gt;id(),
+            },
+            {
+                order_by    =&gt; 'created ASC',
+                rows        =&gt; 1,
+            }
+        );
+    }
+    else {
+        $c-&gt;stash-&gt;{error}{message} = q{No information for thread or post to reply to};
+        return;
+    }
+
+    # if we don't have one post, something really odd happened
+    if (1 != $posts-&gt;count()) {
+        $c-&gt;stash-&gt;{error}{message} = q{I don't know how you managed to reply to a thread with no posts};
+        return;
+    }
+
+    # save the first (and only) post from our results
+    $c-&gt;stash-&gt;{responding_to_post} = $posts-&gt;first();
+
+    # be successful
+    return 1;
+}
+
+sub _increase_post_count {
+    my ($self, $c, $thread) = @_;
+
+    # make the update in a transaction
+    eval {
+        # make sure $post_count is sane
+        my $post_count = $thread-&gt;post_count() || 0;
+
+        # increase the number of replies for the thread
+        $thread-&gt;post_count(
+            $post_count + 1
+        );
+        $thread-&gt;update();
+
+        # increase the number of posts for the forum
+        $thread-&gt;forum-&gt;post_count(
+            ($thread-&gt;forum-&gt;post_count() || 0) + 1
+        );
+        $thread-&gt;forum-&gt;update;
+    };
+    # deal with any transaction errors
+    if ($@) {                                   # Transaction failed
+        die &quot;something terrible has happened!&quot;  #
+            if ($@ =~ /Rollback failed/);       # Rollback failed
+
+        $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+        $c-&gt;log-&gt;error( $@ );
+        return;
+    }
+}
+
+
+sub _increase_thread_view_count {
+    my ($self, $c) = @_;
+
+    # do nothing if we don't have a current_thread
+    if (not defined $c-&gt;_current_thread) {
+        $c-&gt;log-&gt;error( q{Can't increase view count for undefined thread} );
+        return;
+    }
+
+    # increase the post count
+    eval {
+        $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+            sub {
+                $c-&gt;log-&gt;info( q{Increasing view count} );
+                $c-&gt;_current_thread-&gt;view_count(
+                    $c-&gt;_current_thread-&gt;view_count + 1
+                );
+                $c-&gt;_current_thread-&gt;update;
+            }
+        )
+    };
+    # deal with any transaction errors
+    if ($@) {                                   # Transaction failed
+        die &quot;something terrible has happened!&quot;  #
+            if ($@ =~ /Rollback failed/);       # Rollback failed
+
+        $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+        $c-&gt;log-&gt;error( $@ );
+        return;
+    }
+}
+
+sub _prepare_pager {
+    my ($self, $c, $list) = @_;
+
+    $c-&gt;stash-&gt;{page} = $list-&gt;pager();
+
+    my $pagination = Data::SpreadPagination-&gt;new(
+        {
+            totalEntries        =&gt; $c-&gt;stash-&gt;{page}-&gt;total_entries(),
+            entriesPerPage      =&gt; $c-&gt;stash-&gt;{page}-&gt;entries_per_page(),
+            currentPage         =&gt; $c-&gt;stash-&gt;{page}-&gt;current_page(),
+            maxPages            =&gt; 4,
+        }
+    );
+    $c-&gt;stash-&gt;{page_range_spread} = $pagination-&gt;pages_in_spread();
+}
+
+
+sub _thread_watch_count {
+    my ($self, $c) = @_;
+
+    # how many people are watching the current thread?
+    $c-&gt;stash-&gt;{watcher_count} =
+        $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;count(
+            {
+                thread  =&gt; $c-&gt;_current_thread()-&gt;id(),
+                watched =&gt; 1,
+            }
+        )
+    ;
+}
+
+sub _update_last_post {
+    my ($self, $c, $new_post) = @_;
+
+    # do the updates in a transaction
+    eval {
+        $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+            sub {
+                # get the thread the post lives in
+                my $thread = $new_post-&gt;thread;
+
+                # get the forum the thread lives in
+                my $forum = $thread-&gt;forum;
+
+                # set the last_post for both forum and thread
+                $forum-&gt; last_post($new_post-&gt;post_id());
+                $thread-&gt;last_post($new_post-&gt;post_id());
+                $forum -&gt;update();
+                $thread-&gt;update();
+            }
+        );
+    };
+    # deal with any transaction errors
+    if ($@) {                                   # Transaction failed
+        die &quot;something terrible has happened!&quot;  #
+            if ($@ =~ /Rollback failed/);       # Rollback failed
+
+        $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+        $c-&gt;log-&gt;error( $@ );
+        return;
+    }
+}
+
+sub _update_person_post_info {
+    my ($self, $c, $post) = @_;
+    my $person = $c-&gt;_authed_user();
+
+    # make the update in a transaction
+    eval {
+        # increase the post count for the user
+        $person-&gt;post_count( $person-&gt;post_count() + 1 );
+        # make a note of their last post
+        $person-&gt;last_post( $post-&gt;id() );
+        # push the changes back tot the db
+        $person-&gt;update();
+    };
+    # deal with any transaction errors
+    if ($@) {                                   # Transaction failed
+        die &quot;something terrible has happened!&quot;  #
+            if ($@ =~ /Rollback failed/);       # Rollback failed
+
+        $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+        $c-&gt;log-&gt;error( $@ );
+        return;
+    }
+}
+
+sub _update_thread_view {
+    my ($self, $c) = @_;
+    my ($last_post, $last_post_timestamp);
+
+    $c-&gt;log-&gt;info(q{called: _update_thread_view()});
+    
+    # get the last post on the page
+    $last_post = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;last_post_in_list(
+        $c-&gt;stash-&gt;{post_list}
+    );
+
+    # get the timestamp of the last post
+    $last_post_timestamp = $last_post-&gt;created();
+    $c-&gt;log-&gt;debug( qq{\$last_post_timestamp = $last_post_timestamp} );
+
+    # make a note of when the user last viewed this thread, if a record doesn't already exist
+    my $thread_view =
+        $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;find_or_create(
+            {
+                person      =&gt; $c-&gt;_authed_user()-&gt;id(),
+                thread      =&gt; $c-&gt;_current_thread()-&gt;id(),
+                timestamp   =&gt; $last_post_timestamp,
+            },
+        )
+    ;
+
+    # set the timestamp the time of the last post on the page (unless the
+    # existing time is later)
+    if ($thread_view-&gt;timestamp() &lt; $last_post_timestamp) {
+        $c-&gt;log-&gt;debug('thread view time is less than last_post time');
+        $thread_view-&gt;timestamp( $last_post_timestamp );
+    }
+
+    # update/store the thread_view record
+    $thread_view-&gt;update;
+}
+
+sub _watching_thread {
+    my ($self, $c) = @_;
+    
+    # find out if the user is watching the thread, and store it in the stash
+    $c-&gt;stash-&gt;{watching_thread} =
+        $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;watching_thread(
+            $c-&gt;_current_thread(),
+            $c-&gt;_authed_user(),
+        )
+    ;
+}
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Functions for database transactions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _txn_add_new_reply {
+    my ($self, $c) = @_;
+    $c-&gt;log-&gt;info( q{_txn_add_new_reply} );
+
+    my ($new_post);
+
+    # make sure we have a current thread
+    if(not $c-&gt;_current_thread) {
+        die q{No current thread in _txn_add_new_reply()};
+    }
+
+    # create a new post in the current thread
+    $new_post = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;create(
+        {
+            thread      =&gt; $c-&gt;_current_thread()-&gt;id(),
+            subject     =&gt; $c-&gt;form-&gt;valid-&gt;{thread_subject},
+            message     =&gt; $c-&gt;form-&gt;valid-&gt;{thread_message},
+            creator     =&gt; $c-&gt;_authed_user-&gt;id(),
+            ip_addr     =&gt; $c-&gt;request-&gt;address(),
+        }
+    );
+
+    # if we have current post information, then the post is in reply to another
+    # post (i.e. quoted reply, not just reply-to-thread)
+    if (defined $c-&gt;_current_post()) {
+        # mark what the new post is in reply-to
+        $new_post-&gt;reply_to( $c-&gt;_current_post()-&gt;id() );
+    }
+
+    # do we have a quoted post? if we do we need to store the
+    # (potentially ammended) quoted text, and the actual post being
+    # quoted (so we can get author, date, etc)
+    if (defined $c-&gt;request-&gt;param('have_quoted_post')) {
+        $new_post-&gt;quoted_post( $c-&gt;_current_post()-&gt;id() );
+        $new_post-&gt;quoted_text( $c-&gt;req-&gt;param('quote_message') );
+    }
+
+    # the thread's last post is the one we just created
+    $c-&gt;_current_thread()-&gt;last_post( $new_post-&gt;id );
+
+    # we've got one post in our new thread
+    $self-&gt;_increase_post_count($c, $c-&gt;_current_thread());
+
+    # update information about the most recent forum/thread post
+    $self-&gt;_update_last_post($c, $new_post);
+
+    # update information about the poster (count, etc)
+    $self-&gt;_update_person_post_info($c, $new_post);
+
+    # would we like to lock the thread?
+    if ($c-&gt;form-&gt;valid-&gt;{lock_thread} and $c-&gt;stash-&gt;{moderator}) {
+        $c-&gt;log-&gt;debug( q{locking thread after replying} );
+        $new_post-&gt;thread-&gt;locked(1);
+        $new_post-&gt;thread-&gt;update;
+    }
+
+    # would we like to set a thread watch at the time of posting?
+    if ($c-&gt;form-&gt;valid-&gt;{watch_on_post}) {
+        $c-&gt;log-&gt;debug( q{Auto-add thread watch on new post} );
+        my $thread_view =
+            $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;find(
+                {
+                    person      =&gt; $c-&gt;_authed_user()-&gt;id(),
+                    thread      =&gt; $c-&gt;_current_thread()-&gt;id(),
+                },
+            )
+        ;
+        if (defined $thread_view) {
+            $c-&gt;log-&gt;debug( q{Adding Watch} );
+            #$thread_view-&gt;timestamp( $new_post-&gt;created() );
+            $thread_view-&gt;watched( 1 );
+            $thread_view-&gt;update;
+        }
+    }
+
+    # update the records
+    $new_post-&gt;update;
+
+    # return the new topic/thread
+    return $new_post;
+}
+
+sub _txn_add_new_thread {
+    my ($self, $c) = @_;
+    $c-&gt;log-&gt;info( q{_txn_add_new_thread} );
+    
+    my ($new_thread, $new_post);
+
+    # create a new thread
+    $new_thread = $c-&gt;model('ParleyDB')-&gt;resultset('Thread')-&gt;create(
+        {
+            forum       =&gt; $c-&gt;_current_forum-&gt;id(),
+            subject     =&gt; $c-&gt;form-&gt;valid-&gt;{thread_subject},
+            creator     =&gt; $c-&gt;_authed_user-&gt;id(),
+        }
+    );
+
+    # create a new post in the new thread
+    $new_post = $c-&gt;model('ParleyDB')-&gt;resultset('Post')-&gt;create(
+        {
+            thread      =&gt; $new_thread-&gt;id(),
+            subject     =&gt; $c-&gt;form-&gt;valid-&gt;{thread_subject},
+            message     =&gt; $c-&gt;form-&gt;valid-&gt;{thread_message},
+            creator     =&gt; $c-&gt;_authed_user-&gt;id(),
+            ip_addr     =&gt; $c-&gt;request-&gt;address(),
+        }
+    );
+
+    # the thread's last post is the one we just created
+    $new_thread-&gt;last_post( $new_post-&gt;id );
+
+    # we've got one post in our new thread
+    $new_thread-&gt;post_count( 1 );
+    $new_thread-&gt;forum-&gt;post_count(
+        ($new_thread-&gt;forum-&gt;post_count() || 0) + 1
+    );
+
+    # if the poster wants to add a watch we need to create the ThreadView record here
+    # (it's a new thread so they can't have viewed it yet)
+    if ($c-&gt;form-&gt;valid-&gt;{watch_on_post}) {
+        $c-&gt;log-&gt;debug( q{Auto-add thread watch on new thread} );
+        my $thread_view =
+            $c-&gt;model('ParleyDB')-&gt;resultset('ThreadView')-&gt;create(
+                {
+                    person      =&gt; $c-&gt;_authed_user()-&gt;id(),
+                    thread      =&gt; $new_thread-&gt;id(),
+                    watched     =&gt; 1,
+                },
+            )
+        ;
+    }
+
+    # update information about the most recent forum/thread post
+    $self-&gt;_update_last_post($c, $new_post);
+
+    # update information about the poster (count, etc)
+    $self-&gt;_update_person_post_info($c, $new_post);
+
+    # update the records
+    $new_thread-&gt;update;
+    $new_thread-&gt;forum-&gt;update;
+    $new_post-&gt;update;
+
+    # return the new topic/thread
+    return $new_thread;
+}
+
+1;
+
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley::Controller::Thread - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 ACTIONS
+
+=head2 add
+
+Adds a new thread to a specified forum
+
+=head2 next_post
+
+Take the logged-in user to the post after the last one they have viewed. If
+they haven't viewed any posts they should be taken to the first in the thread.
+If the last post they saw was the last in the thread they should be taken to
+the last post in the thread.
+
+=head2 reply
+
+Reply to a post in an existing thread.
+
+=head2 view
+
+This action prepares data in the stash for viewing the current thread.
+
+=head2
+
+This action is used to add/remove a watch for a given thread
+
+=head1 PRIVATE METHODS
+
+=head2 _add_new_reply($self,$c)
+
+The guts of the process to add a new reply to an existing thread
+
+=head2 _add_new_thread($self,$c)
+
+The guts of the process to add a new thread/topic to a forum
+
+=head2 _get_thread_reply_post($self,$c)
+
+Returns the post being replied to in a thread.
+
+=head2 _increase_post_count($self,$c,$thread)
+
+Increase the number of posts (by one) for a given thread
+
+=head2 _increase_thread_view_count($self,$c)
+
+Inside a transaction, increase the number of views a thread has by one.
+
+=head2 _thread_view_pager($self,$c)
+
+Set-up C&lt;$c-E&lt;gt&gt;stash-E&lt;gt&gt;{page}&gt; and
+C&lt;$c-E&lt;gt&gt;stash-E&lt;gt&gt;{page_range_spread}&gt; for the current thread.
+These are used by the pager in the templates (Page X of Y, etc).
+
+=head2 _thread_watch_count($self,$c)
+
+Sets C&lt;$c-E&lt;gt&gt;stash-E&lt;gt&gt;{watcher_count}&gt; with the number of people who have a
+watch set for the current thread.
+
+=head2 _update_last_post($self,$c,$new_post)
+
+Given a (new) post, update the values for the last post in the relevant thread
+and forum.
+
+=head2 _update_person_post_info($self,$c,$post)
+
+Called when someone makes a new post, increments the total number of posts made
+by the user, and updates the record of the last post they made.
+
+=head2 _watching_thread
+
+Sets C&lt;$c-E&lt;gt&gt;stash-E&lt;gt&gt;{watching_thread}&gt; with a true|false value indicating
+whether the current authenticated user is watching the current thread.
+
+Sets 
+
+=head2 _update_thread_view
+
+This method updates an existing record in the thread_view table, or creates a
+new one if it doesn't exist.
+
+The timestamp value for the record (keyed on I&lt;person-thread&gt;) is updated to
+the timestamp of the creation time for the last post on the page - unless the
+user has already viewed a page containing later posts.
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at berlios.de</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Controller/User/LostPassword.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/User/LostPassword.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/User/LostPassword.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,462 @@
+package Parley::Controller::User::LostPassword;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+use List::MoreUtils qw{ uniq };
+use Digest::MD5 qw{ md5_hex };
+use Readonly;
+use Time::Piece;
+use Time::Seconds;
+
+use Parley::App::DFV qw( :constraints :validation );
+use Parley::App::Error qw( :methods );
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Global class data
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+Readonly my $LIFETIME =&gt; Time::Seconds::ONE_HOUR;
+
+my %dfv_profile_for = (
+    'password_reset' =&gt; {
+        require_some =&gt; {
+            user_details =&gt; [
+                1,
+                qw/ username email /
+            ],
+        },
+
+        filters =&gt; [qw(trim)],
+
+        constraint_methods =&gt; {
+            confirm_email =&gt;
+                dfv_constraint_confirm_equal(
+                    {
+                        fields =&gt; [qw/email confirm_email/],
+                    }
+                ),
+        },
+
+        msgs =&gt; {
+            constraints =&gt; {
+                email =&gt; q{You must enter a valid email address},
+            },
+            missing =&gt; q{One or more required fields are missing},
+            format =&gt; '%s',
+        },
+    },
+
+    'set_new_password' =&gt; {
+        required =&gt; [
+            qw/
+                reset_username
+                new_password
+                confirm_password
+            /
+        ],
+
+        filters =&gt; [qw(trim)],
+
+        constraint_methods =&gt; {
+            confirm_password =&gt;
+                dfv_constraint_confirm_equal(
+                    {
+                        fields =&gt; [qw/new_password confirm_password/],
+                    }
+                ),
+        },
+
+        msgs =&gt; {
+            constraints =&gt; {
+                confirm_password =&gt; q{The passwords do not match},
+            },
+            missing =&gt; q{One or more required fields are missing},
+            format =&gt; '%s',
+        },
+    }
+);
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller Actions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+
+# nice and easy - catch the url to display the lost password page
+# if we have a form submit, deal with it
+sub lost_password : Path('/user/password/forgotten') {
+    my ($self, $c) = @_;
+    my ($results, @messages);
+
+    if (defined $c-&gt;request-&gt;method()
+            and $c-&gt;request-&gt;method() eq 'POST'
+            and defined $c-&gt;request-&gt;param('pwd_reset_submit')
+    ) {
+        @messages = $self-&gt;_user_reset($c);
+
+        # if we have any validation errors ...
+        #if (exists $c-&gt;stash-&gt;{view}{error}{messages}) {
+        if (has_errors($c)) {
+            # we may wish to Do Stuff here
+        }
+
+        # no messages, means that all should be well, so head off to the
+        # &quot;details in the post&quot; page
+        else {
+            $c-&gt;stash-&gt;{template} = 'user/lostpassword/lost_password_details_sent';
+        }
+    }
+}
+
+
+# this action uses the uid in the URL to work out who's password we are
+# resetting, after a little validation, we can use the new choice of password
+# for the user
+sub reset : Path('/user/password/reset') {
+    my ($self, $c, $reset_uid) = @_;
+    my ($results, @messages);
+
+
+    # we should have the reset UID in the URL
+    if (not defined $reset_uid) {
+        parley_warn($c, q{Incomplete password reset URL});
+        #$c-&gt;stash-&gt;{error}{message} = q{Incomplete password reset URL};
+        return;
+    }
+
+    # fetch the info from the database
+    my $pwd_reset = $c-&gt;model('ParleyDB')-&gt;resultset('PasswordReset')-&gt;find(
+        {
+            password_reset_id =&gt; $reset_uid,
+        }
+    );
+
+    # if we don't have any matches then the id was bogus
+    if (not defined $pwd_reset) {
+        $c-&gt;stash-&gt;{error}{message} = q{Bogus password reset ID};
+        return;
+    }
+
+    # put the reset_uid into the stash
+    $c-&gt;stash-&gt;{reset_uid} = $reset_uid;
+
+    # make user available to template
+    $c-&gt;stash-&gt;{reset_user} = $pwd_reset-&gt;recipient();
+
+    # deal with a form submission
+    if (defined $c-&gt;request-&gt;method()
+            and $c-&gt;request-&gt;method() eq 'POST'
+            and defined $c-&gt;request-&gt;param('reset_password')
+    ) {
+        $self-&gt;_reset_password($c, $pwd_reset);
+
+        # if we have any validation errors ...
+        #if (exists $c-&gt;stash-&gt;{view}{error}{messages}) {
+        if (has_errors($c)) {
+            # we may want to Do Stuff when there are errors
+        }
+
+        # no messages, means that all should be well, so head off to the
+        # &quot;details in the post&quot; page
+        else {
+            $c-&gt;stash-&gt;{template} = 'user/lostpassword/reset_success';
+        }
+    }
+    # fall through and show the form
+}
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller (Private/Helper) Methods
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _reset_password {
+    my ($self, $c, $pwd_reset) = @_;
+    my (@messages);
+    $c-&gt;log-&gt;debug('_reset_password()');
+
+    # validate form data
+    $c-&gt;form(
+        $dfv_profile_for{set_new_password}
+    );
+    if (not $self-&gt;form_data_valid($c)) {
+        $c-&gt;log-&gt;error( q{INVALID FORM DATA} );
+        return;
+    }
+
+    # otherwise the form data is ok...
+
+    # less typing ..
+    my $reset_username = $pwd_reset-&gt;recipient()-&gt;authentication()-&gt;username;
+    $c-&gt;log-&gt;debug( &quot;password reset for: $reset_username&quot; );
+
+    # make sure the username matches
+    if ($reset_username eq $c-&gt;form-&gt;valid-&gt;{reset_username}) {
+        # perform everything in a transaction
+        eval {
+            $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+                sub { return $self-&gt;_txn_user_password_update($c, $pwd_reset); }
+            );
+        };
+        # deal with any transaction errors
+        if ($@) {                                   # Transaction failed
+            die &quot;something terrible has happened!&quot;  #
+                if ($@ =~ /Rollback failed/);       # Rollback failed
+
+            $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+            $c-&gt;log-&gt;error( $@ );
+            return;
+        }
+    }
+    else {
+        # incorrect username
+        push @messages, 'Incorrect username supplied';
+        parley_warn($c, q{Incorrect username supplied});
+    }
+
+    return 1;
+}
+
+sub _send_username_reminder {
+    my ($self, $c, $person) = @_;
+    my ($send_status);
+    
+    # send the email
+    $send_status = $c-&gt;send_email(
+        {
+            template    =&gt; {
+                text    =&gt; q{username_reminder.eml},
+            },
+            person      =&gt; $person,
+            headers =&gt; {
+                from    =&gt; $c-&gt;application_email_address(),
+                subject =&gt; qq{Your @{[$c-&gt;config-&gt;{name}]} username},
+            },
+        }
+    );
+}
+
+sub _user_password_reset {
+    my ($self, $c, $person) = @_;
+    my ($pwd_reset, $send_status);
+
+    # make the update in a transaction
+    eval {
+        $pwd_reset = $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+            sub { return $self-&gt;_txn_password_reset($c, $person) }
+        );
+    };
+    # deal with any transaction errors
+    if ($@) {                                   # Transaction failed
+        die &quot;something terrible has happened!&quot;  #
+            if ($@ =~ /Rollback failed/);       # Rollback failed
+
+        $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+        $c-&gt;log-&gt;error( $@ );
+        return;
+    }
+
+    # getting here means that we've created a new password_reset entry,
+    # zapped the current password, and set authenticated=f for the person
+
+    # now send the user an email
+    # send an email off to the (new) user
+    $send_status = $c-&gt;send_email(
+        {
+            template    =&gt; {
+                text    =&gt; q{password_reset.eml},
+            },
+            person      =&gt; $person,
+            headers =&gt; {
+                from    =&gt; $c-&gt;application_email_address(),
+                subject =&gt; qq{Reset your @{[$c-&gt;config-&gt;{name}]} password},
+            },
+            template_data =&gt; {
+                pwd_reset =&gt; $pwd_reset,
+            },
+        }
+    );
+
+    return $send_status;
+}
+
+sub _user_reset {
+    my ($self, $c) = @_;
+    my ($results, @messages, $email_send_status, $send_username_reminder);
+
+    # validate the form data
+    $c-&gt;form(
+        $dfv_profile_for{password_reset}
+    );
+    if (not $self-&gt;form_data_valid($c)) {
+        $c-&gt;log-&gt;error( q{INVALID FORM DATA} );
+        return;
+    }
+
+#    # deal with missing/invalid fields
+#    if ($c-&gt;form-&gt;has_missing()) {
+#        $c-&gt;stash-&gt;{view}{error}{message} = q{You must fill in all the required fields};
+#        foreach my $f ( $c-&gt;form-&gt;missing ) {
+#            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+#        }
+#    }
+#    elsif ($c-&gt;form-&gt;has_invalid()) {
+#        $c-&gt;stash-&gt;{view}{error}{message} = q{One or more fields are invalid};
+#        foreach my $f ( $c-&gt;form-&gt;invalid ) {
+#            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+#        }
+#    }
+
+    # otherwise the form data is ok...
+#    else {
+        my ($criteria, $matches, $person);
+
+        # make sure we can match user/email supplied
+        if (defined $c-&gt;form-&gt;valid-&gt;{username}) {
+            $criteria-&gt;{'authentication.username'}
+                = $c-&gt;form-&gt;valid-&gt;{username};
+
+            # make sure we don't send a username reminder
+            $send_username_reminder = 0;
+        }
+        elsif (defined $c-&gt;form-&gt;valid-&gt;{email}) {
+            $criteria-&gt;{'email'}
+                = $c-&gt;form-&gt;valid-&gt;{email};
+
+            # assume the user used their email address because they couldn't
+            # remember their username, and send them a username reminder email
+            $send_username_reminder = 1;
+        }
+        else {
+            #push @messages, q{Missing criteria in the database lookup};
+            parley_warn($c, q{Missing criteria in the database lookup});
+            $c-&gt;log-&gt;error(q{Lookup criteria missing in _user_reset()});
+            #return uniq(sort @messages);
+            return;
+        }
+        $matches = $c-&gt;model('ParleyDB')-&gt;resultset('Person')-&gt;search(
+            $criteria,
+            {
+                join =&gt; 'authentication',
+            }
+        );
+
+        # make sure we don't have too many matches
+        if ($matches-&gt;count &gt; 1) {
+            #push @messages, q{Database lookup returned too many records};
+            parley_warn($c, q{Database lookup returned too many records});
+            $c-&gt;log-&gt;error(q{Looks like the SQL for password reset is a bit borked});
+            $c-&gt;log-&gt;error(
+                  q{Lookup returned }
+                . $matches-&gt;count
+                . q{ record(s)}
+            );
+            $c-&gt;log-&gt;dumper($criteria);
+            #return uniq(sort @messages);
+            return;
+        }
+
+        # make sure we don't have too few matches
+        elsif ($matches-&gt;count &lt; 1) {
+            push @messages, q{There are no users matching that information};
+            #$c-&gt;log-&gt;debug(' NO MATCHES ');
+        }
+
+        # otherwise, do the work
+        else {
+            # get the first (and should be only) match
+            $person = $matches-&gt;first();
+            #$c-&gt;log-&gt;dumper( $person-&gt;{_column_data}, 'COLUMN_DATA' );
+
+            # if required, send a username reminder
+            if ($send_username_reminder) {
+                $self-&gt;_send_username_reminder($c, $person);
+            }
+
+            # do the actual password reset
+            $email_send_status = $self-&gt;_user_password_reset($c, $person);
+            if (not $email_send_status) {
+                push @messages, q{Failed to send password reset email};
+            }
+        }
+#    }
+
+        #return uniq(sort @messages);
+    return 1;
+}
+
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Functions for database transactions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _txn_password_reset {
+    my ($self, $c, $person) = @_;
+    my ($random, $pwd_reset);
+
+    $c-&gt;log-&gt;dumper( ref $self,     'REF_SELF' );
+    $c-&gt;log-&gt;dumper( ref $c,        'REF_C' );
+    $c-&gt;log-&gt;dumper( ref $person,   'REF_PERSON' );
+
+    # if it's good enough for Cozens, it's good enough for me :-)
+    $random = md5_hex(time.(0+{}).$$.rand);
+
+    # create an invitation
+    $pwd_reset = $c-&gt;model('ParleyDB')-&gt;resultset('PasswordReset')-&gt;create(
+        {
+            'password_reset_id' =&gt; $random,
+            'recipient'		=&gt; $person-&gt;person_id,
+            'expires'		=&gt; Time::Piece-&gt;new(time + $LIFETIME)-&gt;datetime,
+        }
+    );
+
+    # as far as I know, no md5_hex value is 'X', so set the hexed password to X
+    # to prevent anyone logging in after a reset request
+    $person-&gt;authentication-&gt;password('X');
+    # the person is no longer authenticated
+    $person-&gt;authentication-&gt;authenticated(0);
+    # update the person's record
+    $person-&gt;authentication-&gt;update();
+
+    # return the new entry in password_reset so it ca be used back up the
+    # chain, e.g. in the email to the user
+    return $pwd_reset;
+}
+
+sub _txn_user_password_update {
+    my ($self, $c, $pwd_reset) = @_;
+
+    # less typing
+    my $authentication = $pwd_reset-&gt;recipient()-&gt;authentication();
+
+    # update the user's password
+    $authentication-&gt;password(
+        md5_hex( $c-&gt;form-&gt;valid-&gt;{new_password} )
+    );
+
+    # set the user as authenticated
+    $authentication-&gt;authenticated( 1 );
+
+    # update authentication information
+    $authentication-&gt;update();
+
+    # delete all outstanding reset URLs for the user
+    $c-&gt;model('ParleyDB')-&gt;resultset('PasswordReset')-&gt;search(
+        {
+            recipient =&gt; $pwd_reset-&gt;recipient()-&gt;id()
+        }
+    ) -&gt;delete;
+}
+
+1;
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley::Controller::User::LostPassword
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Controller/User/SignUp.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/User/SignUp.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/User/SignUp.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,370 @@
+package Parley::Controller::User::SignUp;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+use List::MoreUtils qw{ uniq };
+use Digest::MD5 qw{ md5_hex };
+use Email::Valid;
+use Readonly;
+use Time::Piece;
+use Time::Seconds;
+
+use Parley::App::DFV qw( :constraints );
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Global class data
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+Readonly my $LIFETIME =&gt; Time::Seconds::ONE_WEEK;
+
+my %dfv_profile_for = (
+    'signup' =&gt; {
+        required =&gt; [ qw(
+                new_username new_password confirm_password email confirm_email
+                first_name last_name forum_name
+        ) ],
+
+        filters =&gt; [qw(trim)],
+
+        constraint_methods =&gt; {
+            confirm_password =&gt;
+                dfv_constraint_confirm_equal(
+                    {
+                        fields =&gt; [qw/new_password confirm_password/],
+                    }
+                ),
+
+            email =&gt;
+                dfv_constraint_valid_email(
+                    {
+                        fields =&gt; [qw/email/],
+                    }
+                ),
+
+            confirm_email =&gt;
+                dfv_constraint_confirm_equal(
+                    {
+                        fields =&gt; [qw/email confirm_email/],
+                    }
+                ),
+        },
+
+        msgs =&gt; {
+            constraints =&gt; {
+                confirm_password =&gt; q{The passwords do not match},
+                confirm_email =&gt; q{The email addresses do not match},
+                email =&gt; q{You must enter a valid email address},
+            },
+            missing =&gt; q{One or more required fields are missing},
+            format =&gt; '%s',
+        },
+    },
+);
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller Actions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub authenticate : Path('/user/authenticate') {
+    my ($self, $c, $auth_id) = @_;
+
+    # we should have an auth-id in the url
+    if (not defined $auth_id) {
+        $c-&gt;stash-&gt;{error}{message} = q{Incomplete authentication URL};
+        return;
+    }
+
+    # fetch the info from the database
+    my $regauth = $c-&gt;model('ParleyDB')-&gt;resultset('RegistrationAuthentication')-&gt;find(
+        {
+            registration_authentication_id =&gt; $auth_id,
+        }
+    );
+
+    # if we don't have any matches then the id was bogus
+    if (not defined $regauth) {
+        $c-&gt;stash-&gt;{error}{message} = q{Bogus authentication ID};
+        return;
+    }
+
+    # TODO
+    # if we get this far, we've got a valid ID, so we can yank out their details,
+    # and to be safe we'll finish the process by asking them for their password
+    #
+    # for now, we assume the link clicking is good enough, and we mark them
+    # as authenticated
+
+    # get the person matching the ID
+    $c-&gt;stash-&gt;{signup_user} = $c-&gt;model('ParleyDB')-&gt;resultset('Person')-&gt;find(
+        {
+            person_id =&gt; $regauth-&gt;recipient-&gt;person_id(),
+        }
+    );
+
+    # get the first (and should be only) match
+    $c-&gt;log-&gt;dumper($c-&gt;stash-&gt;{signup_user}-&gt;{_column_data});
+
+    # mark the person as authenticated
+    $c-&gt;stash-&gt;{signup_user}-&gt;authentication-&gt;authenticated(1);
+    $c-&gt;stash-&gt;{signup_user}-&gt;authentication-&gt;update();
+
+    # delete registration_authentication record
+    $regauth-&gt;delete;
+
+    # set a suitable success template
+    $c-&gt;stash-&gt;{template} = 'user/auth_success';
+}
+
+
+sub signup : Path('/user/signup') {
+    my ( $self, $c ) = @_;
+    my (@messages);
+
+    # logged-in? no need to signup again...
+    if ($c-&gt;is_logged_in()) {
+        $c-&gt;response-&gt;redirect( $c-&gt;uri_for($c-&gt;config()-&gt;{default_uri}) );
+        return;
+    }
+
+    # deal with form submissions
+    if (defined $c-&gt;request-&gt;method()
+            and $c-&gt;request-&gt;method() eq 'POST'
+            and defined $c-&gt;request-&gt;param('form_submit')
+    ) {
+        @messages = $self-&gt;_user_signup($c);
+    }
+
+    if (scalar @messages) {
+        $c-&gt;stash-&gt;{messages} = \@messages;
+    }
+}
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Controller (Private/Helper) Methods
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _add_new_user {
+    my ($self, $c) = @_;
+    my ($valid_results, @messages, $new_user);
+
+    # less typing
+    $valid_results = $c-&gt;form-&gt;valid;
+
+    # is the requested username already in use?
+    if ($self-&gt;_username_exists($c, $valid_results-&gt;{new_username})) {
+        push @messages, q{The username you have chosen is already in use. Please try a different one.};
+    }
+    # is the requested email address already in use?
+    if ($self-&gt;_email_exists($c, $valid_results-&gt;{email})) {
+        push @messages, q{The email address you have chosen is already in use.&lt;br /&gt;Please try a different one, or use the &lt;a href=&quot;user/password/forgotten&quot;&gt;Forgotten Password&lt;/a&gt; page.};
+    }
+    # is the requested forum name already in use?
+    if ($self-&gt;_forumname_exists($c, $valid_results-&gt;{forum_name})) {
+        push @messages, q{The forum name you have chosen is already in use. Please try a different one.};
+    }
+
+    # if we DON'T have any messages, then there were no errors, so we can try
+    # to add the new user
+    if (not scalar @messages) {
+        # make the new user inside a transaction
+        eval {
+            $new_user = $c-&gt;model('ParleyDB')-&gt;schema-&gt;txn_do(
+                sub { return $self-&gt;_txn_add_new_user($c) }
+            );
+        };
+        # deal with any transaction errors
+        if ($@) {                                   # Transaction failed
+            die &quot;something terrible has happened!&quot;  #
+                if ($@ =~ /Rollback failed/);       # Rollback failed
+
+            $c-&gt;stash-&gt;{error}{message} = qq{Database transaction failed: $@};
+            $c-&gt;log-&gt;error( $@ );
+            return;
+        }
+    }
+
+
+    # return our error messages (if any)
+    return sort(@messages);
+}
+
+sub _create_regauth {
+    my ($self, $c, $person) = @_;
+    my ($random, $invitation);
+
+    # if it's good enough for Cozens, it's good enough for me
+    $random = md5_hex(time.(0+{}).$$.rand);
+
+    # create an invitation
+    $invitation = $c-&gt;model('ParleyDB')-&gt;resultset('RegistrationAuthentication')-&gt;create(
+        {
+            'registration_authentication_id'	=&gt; $random,
+            'recipient'				=&gt; $person-&gt;person_id,
+            'expires'				=&gt; Time::Piece-&gt;new(time + $LIFETIME)-&gt;datetime,
+        }
+    );
+
+    return $invitation;
+}
+
+sub _email_exists {
+    my ($self, $c, $email) = @_;
+    # look for the specified email
+    $c-&gt;log-&gt;info(&quot;Looking for: $email&quot;);
+    my $match_count = $c-&gt;model('ParleyDB')-&gt;resultset('Person')-&gt;count(
+        email =&gt; $email,
+    );
+    # return the number of matches
+    return $match_count;
+}
+
+sub _forumname_exists {
+    my ($self, $c, $forum_name) = @_;
+    # look for the specified forum_name
+    $c-&gt;log-&gt;info(&quot;Looking for: $forum_name&quot;);
+    my $match_count = $c-&gt;model('ParleyDB')-&gt;resultset('Person')-&gt;count(
+        forum_name =&gt; $forum_name,
+    );
+    # return the number of matches
+    return $match_count;
+}
+
+sub _new_user_authentication_email {
+    my ($self, $c, $person) = @_;
+    my ($invitation, $send_status);
+
+    # create a new reg-auth entry
+    $invitation = $self-&gt;_create_regauth($c, $person);
+
+    # send an email off to the (new) user
+    $send_status = $c-&gt;send_email(
+        {
+            template    =&gt; {
+                text    =&gt; q{authentication_email.eml},
+            },
+            person      =&gt; $person,
+            headers =&gt; {
+                from    =&gt; $c-&gt;application_email_address(),
+                subject =&gt; qq{Activate your @{[$c-&gt;config-&gt;{name}]} registration},
+            },
+            template_data =&gt; {
+                regauth =&gt; $invitation,
+            },
+        }
+    );
+
+    return $send_status;
+}
+
+sub _user_signup {
+    my ($self, $c) = @_;
+    my ($results, @messages);
+
+    # validate the form data
+    $c-&gt;form(
+        $dfv_profile_for{signup}
+    );
+
+    # deal with missing/invalid fields
+    if ($c-&gt;form-&gt;has_missing()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{You must fill in all the required fields};
+        foreach my $f ( $c-&gt;form-&gt;missing ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+    }
+    elsif ($c-&gt;form-&gt;has_invalid()) {
+        $c-&gt;stash-&gt;{view}{error}{message} = q{One or more fields are invalid};
+        foreach my $f ( $c-&gt;form-&gt;invalid ) {
+            push @{ $c-&gt;stash-&gt;{view}{error}{messages} }, $f;
+        }
+    }
+
+    # otherwise the form data is ok...
+    else {
+        @messages = $self-&gt;_add_new_user($c, $results);
+    }
+
+    return (uniq(sort @messages));
+}
+
+sub _username_exists {
+    my ($self, $c, $username) = @_;
+    # look for the specified username
+    $c-&gt;log-&gt;info(&quot;Looking for: $username&quot;);
+    my $match_count = $c-&gt;model('ParleyDB')-&gt;resultset('Authentication')-&gt;count(
+        username =&gt; $username,
+    );
+    # return the number of matches
+    return $match_count;
+}
+
+
+# send notification email
+
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+# Functions for database transactions
+# ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
+
+sub _txn_add_new_user {
+    my ($self, $c) = @_;
+    my ($valid_results, $new_auth, $new_person, $new_preference, $status_ok);
+
+    # less typing
+    $valid_results = $c-&gt;form-&gt;valid;
+
+    # add authentication record
+    $new_auth = $c-&gt;model('ParleyDB')-&gt;resultset('Authentication')-&gt;create(
+        {
+            username =&gt; $c-&gt;form-&gt;valid-&gt;{new_username},
+            password =&gt; md5_hex( $c-&gt;form-&gt;valid-&gt;{new_password} ),
+        }
+    );
+
+    # add new person
+    $new_person = $c-&gt;model('ParleyDB')-&gt;resultset('Person')-&gt;create(
+        {
+            first_name      =&gt; $valid_results-&gt;{first_name},
+            last_name       =&gt; $valid_results-&gt;{last_name},
+            forum_name      =&gt; $valid_results-&gt;{forum_name},
+            email           =&gt; $valid_results-&gt;{email},
+            authentication  =&gt; $new_auth-&gt;id(),
+        }
+    );
+
+    # add (default) prefs for new person
+    $new_preference = $c-&gt;model('ParleyDB')-&gt;resultset('Preference')-&gt;create(
+        {
+            # default everything
+            show_tz =&gt; 1,
+        }
+    );
+    # and link to the new person
+    $new_person-&gt;preference( $new_preference-&gt;id() );
+    $new_person-&gt;update;
+
+    # send an authentication email
+    $status_ok = $self-&gt;_new_user_authentication_email( $c, $new_person );
+
+    # if we sent the email OK take them off to a &quot;it worked&quot; type screen
+    if ($status_ok) {
+        $c-&gt;stash-&gt;{newdata}  = $new_person;
+        $c-&gt;stash-&gt;{template} = q{user/auth_emailed};
+    }
+}
+
+
+
+1;
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley::Controller::User::SignUp
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Controller/User.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Controller/User.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Controller/User.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,138 @@
+package Parley::Controller::User;
+
+use strict;
+use warnings;
+use base 'Catalyst::Controller';
+
+# deal with user login requests on user/login
+sub login : Path('/user/login') {
+    my ( $self, $c ) = @_;
+
+    # default form message
+    $c-&gt;stash-&gt;{'message'} = 'Please enter your username and password';
+    # if we have a custom message to use ..
+    $c-&gt;stash-&gt;{'login_message'} = delete( $c-&gt;session-&gt;{login_message} );
+    # make sure we use the correct template - we sometimes detach() here
+    $c-&gt;stash-&gt;{template} = 'user/login';
+
+    # if we have a username, try to log the user in
+    if ( $c-&gt;request-&gt;param('username') ) {
+        # try to log the user in
+        my $login_status = $c-&gt;login(
+            $c-&gt;request-&gt;param('username'),
+            $c-&gt;request-&gt;param('password'),
+        );
+
+        # if we have a user we're logged in
+        if ( $login_status ) {
+            my $base    = $c-&gt;request-&gt;base();
+            my $action  = $c-&gt;request-&gt;action();
+
+            $c-&gt;log-&gt;debug(&quot;base:   $base&quot;);
+            $c-&gt;log-&gt;debug(&quot;action: $action&quot;);
+
+            # if we've stored somewhere to go after we log-in, got there now
+            if ( $c-&gt;session-&gt;{after_login} ) {
+                $c-&gt;response-&gt;redirect( delete $c-&gt;session-&gt;{after_login} );
+            }
+
+            # (else) if we've just been through Forgotten Password, don't go back there
+            elsif ($c-&gt;request-&gt;referer() =~ m{user/password/}) {
+                # go to the default app URL
+                $c-&gt;response-&gt;redirect( $c-&gt;uri_for($c-&gt;config()-&gt;{default_uri}) );
+            }
+
+            # (else) if we've just been through the Authentication, don't go back there
+            elsif ($c-&gt;request-&gt;referer() =~ m{user/authenticate/}) {
+                # go to the default app URL
+                $c-&gt;response-&gt;redirect( $c-&gt;uri_for($c-&gt;config()-&gt;{default_uri}) );
+            }
+
+            # (else) redirect to where we were referred from, unless our referer is our action
+            elsif ( $c-&gt;request-&gt;referer() =~ m{\A$base}xms and $c-&gt;request-&gt;referer() !~ m{$action\z}xms) {
+                # go to where we came from
+                $c-&gt;response-&gt;redirect( $c-&gt;request-&gt;referer() );
+            }
+
+            # (else) if all else fails go to the application's default_uri
+            else {
+                $c-&gt;response-&gt;redirect( $c-&gt;uri_for($c-&gt;config()-&gt;{default_uri}) );
+            }
+        }
+
+        # otherwise we failed to login, try again!
+        else {
+            $c-&gt;stash-&gt;{'message'}
+                = 'Unable to authenticate the login details supplied';
+        }
+    }
+}
+
+sub logout : Path('/user/logout') {
+    my ($self, $c) = @_;
+
+    # session logout, and remove information we've stashed
+    $c-&gt;logout;
+    delete $c-&gt;session-&gt;{'authed_user'};
+
+    # redisplay the page we were on, or just do the 'default' action
+    my $base    = $c-&gt;request-&gt;base();
+    my $action  = $c-&gt;request-&gt;action();
+    # redirect to where we were referred from, unless our referer is our action
+    if ( $c-&gt;request-&gt;referer() =~ m{\A$base}xms and $c-&gt;request-&gt;referer() !~ m{$action\z}xms) {
+        $c-&gt;response-&gt;redirect( $c-&gt;request-&gt;referer() );
+    }
+    else {
+        $c-&gt;response-&gt;redirect( $c-&gt;uri_for($c-&gt;config()-&gt;{default_uri}) );
+    }
+}
+
+sub profile :Local {
+    my ($self, $c) = @_;
+    my ($user_id, $person);
+
+    $user_id = $c-&gt;request-&gt;param('user');
+    if (defined $user_id) {
+        # make sure we got a sane looking user-id
+        if (not $user_id =~ m{\A\d+\z}) {
+            $c-&gt;stash-&gt;{error}{message} = 'non-integer user passed';
+            return;
+        }
+
+        # fetch the matching user
+        $c-&gt;stash-&gt;{profiled_user}
+            = $c-&gt;model('ParleyDB::Person')-&gt;find( $user_id );
+    }
+    else {
+        $c-&gt;stash-&gt;{error}{message} = 'No user specified';
+        return;
+    }
+}
+
+
+1;
+
+__END__
+
+=head1 NAME
+
+Parley::Controller::User - Catalyst Controller
+
+=head1 DESCRIPTION
+
+Catalyst Controller.
+
+=head1 METHODS
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Model/ParleyDB.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Model/ParleyDB.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Model/ParleyDB.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,37 @@
+package Parley::Model::ParleyDB;
+
+use strict;
+use base 'Catalyst::Model::DBIC::Schema';
+
+__PACKAGE__-&gt;config(
+    schema_class =&gt; 'Parley::Schema',
+    connect_info =&gt; [
+        'dbi:Pg:dbname=parley',
+        'parley',
+        
+    ],
+);
+
+=head1 NAME
+
+Parley::Model::ParleyDB - Catalyst DBIC Schema Model
+=head1 SYNOPSIS
+
+See L&lt;Parley&gt;
+
+=head1 DESCRIPTION
+
+L&lt;Catalyst::Model::DBIC::Schema&gt; Model using schema L&lt;Parley::Schema&gt;
+
+=head1 AUTHOR
+
+Chisel Wright,,,
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley/Schema/Authentication.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/Authentication.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/Authentication.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,51 @@
+package Parley::Schema::Authentication;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;authentication&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;authentication_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('authentication_authentication_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+  &quot;password&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;authenticated&quot;,
+  {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;false&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+  &quot;username&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;authentication_id&quot;);
+__PACKAGE__-&gt;add_unique_constraint(&quot;authentication_username_key&quot;, [&quot;username&quot;]);
+__PACKAGE__-&gt;has_many(
+  &quot;people&quot;,
+  &quot;Person&quot;,
+  { &quot;foreign.authentication&quot; =&gt; &quot;self.authentication_id&quot; },
+);
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema/EmailQueue.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/EmailQueue.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/EmailQueue.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,75 @@
+package Parley::Schema::EmailQueue;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;email_queue&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;recipient&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;cc&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;bcc&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;sender&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; undef,
+  },
+  &quot;subject&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;html_content&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; undef,
+  },
+  &quot;email_queue_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('email_queue_email_queue_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+  &quot;attempted_delivery&quot;,
+  {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;false&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+  &quot;text_content&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;queued&quot;,
+  {
+    data_type =&gt; &quot;timestamp with time zone&quot;,
+    default_value =&gt; &quot;now()&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 8,
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;email_queue_id&quot;);
+__PACKAGE__-&gt;belongs_to(&quot;recipient&quot;, &quot;Person&quot;, { person_id =&gt; &quot;recipient&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;cc&quot;, &quot;Person&quot;, { person_id =&gt; &quot;recipient&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;bcc&quot;, &quot;Person&quot;, { person_id =&gt; &quot;recipient&quot; });
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema/Forum.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/Forum.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/Forum.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,105 @@
+package Parley::Schema::Forum;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;forum&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;last_post&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;post_count&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; 0, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;forum_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('forum_forum_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+  &quot;active&quot;,
+  {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;true&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+  &quot;name&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;description&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; undef,
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;forum_id&quot;);
+__PACKAGE__-&gt;add_unique_constraint(&quot;forum_name_key&quot;, [&quot;name&quot;]);
+__PACKAGE__-&gt;has_many(&quot;threads&quot;, &quot;Thread&quot;, { &quot;foreign.forum&quot; =&gt; &quot;self.forum_id&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;last_post&quot;, &quot;Post&quot;, { post_id =&gt; &quot;last_post&quot; });
+
+sub moderators {
+    my $self = shift;
+    my ($schema, $results, @modlist);
+
+    $schema = $self-&gt;result_source()-&gt;schema();
+
+    # get all forum_moderators for a given forum
+    $results = $schema-&gt;resultset('ForumModerator')-&gt;search(
+        {
+            forum           =&gt; $self-&gt;id(),
+            can_moderate    =&gt; 1,
+        },
+    );
+
+    while (my $res = $results-&gt;next()) {
+        push @modlist, $res-&gt;person();
+    }
+
+    return \@modlist;
+}
+
+sub interval_ago {
+    my $self = shift;
+    my ($now, $duration, $longest_duration);
+
+    # get now as a DT object
+    $now = DateTime-&gt;now();
+
+    # the difference between now and the post time
+    $duration = $now - $self-&gt;created();
+
+    # we use the largest unit to give an idea of how long ago the post was made
+    foreach my $unit (qw[years months days hours minutes seconds]) {
+        if ($longest_duration = $duration-&gt;in_units($unit)) {
+            return _time_string($longest_duration, $unit);
+        }
+    };
+
+    # we should get *something* in the loop above, but just in case
+    return '0 seconds';
+}
+sub _time_string {
+    my ($duration, $unit) = @_;
+
+    # DateTime::Duration uses plural names for units
+    # so if we have ONE we need to return the singular
+    if (1 == $duration) {
+        $unit =~ s{s\z}{};
+    }
+
+    return &quot;$duration $unit&quot;;
+}
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema/ForumModerator.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/ForumModerator.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/ForumModerator.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+package Parley::Schema::ForumModerator;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components('PK::Auto', 'Core');
+__PACKAGE__-&gt;table('forum_moderator');
+__PACKAGE__-&gt;add_columns(
+    person =&gt; {
+        data_type       =&gt; &quot;integer&quot;,
+        default_value   =&gt; undef,
+        is_nullable     =&gt; 0,
+        size            =&gt; 4
+    },
+
+    forum =&gt; {
+        data_type       =&gt; &quot;integer&quot;,
+        default_value   =&gt; undef,
+        is_nullable     =&gt; 0,
+        size            =&gt; 4
+    },
+
+    can_moderate =&gt; {
+        data_type =&gt; &quot;boolean&quot;,
+        default_value =&gt; &quot;false&quot;,
+        is_nullable =&gt; 0,
+        size =&gt; 1,
+    },
+);
+
+__PACKAGE__-&gt;add_unique_constraint('forum_moderator_person_key', ['person', 'forum']);
+__PACKAGE__-&gt;belongs_to('person', 'Person', { person_id =&gt; 'person' });
+__PACKAGE__-&gt;belongs_to('forum',  'Forum',  {  forum_id =&gt; 'forum'  });
+
+1;

Added: tags/parley-0.55/lib/Parley/Schema/PasswordReset.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/PasswordReset.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/PasswordReset.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+package Parley::Schema::PasswordReset;
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;password_reset&quot;);
+__PACKAGE__-&gt;add_columns(
+
+  password_reset_id =&gt; {
+    data_type =&gt; &quot;integer&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+
+  recipient =&gt; {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; 4
+  },
+
+  expires =&gt; {
+    data_type =&gt; &quot;timestamp without time zone&quot;,
+    is_nullable =&gt; 1,
+    size =&gt; 8,
+  },
+);
+
+__PACKAGE__-&gt;set_primary_key(&quot;password_reset_id&quot;);
+
+__PACKAGE__-&gt;belongs_to(&quot;recipient&quot;, &quot;Person&quot;, { person_id =&gt; &quot;recipient&quot; });
+
+1;

Added: tags/parley-0.55/lib/Parley/Schema/Person.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/Person.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/Person.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,86 @@
+package Parley::Schema::Person;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;person&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;person_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('person_person_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+  &quot;authentication&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;last_name&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;email&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;forum_name&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;preference&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;last_post&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;post_count&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; 0, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;first_name&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;person_id&quot;);
+__PACKAGE__-&gt;add_unique_constraint(&quot;person_forum_name_key&quot;, [&quot;forum_name&quot;]);
+__PACKAGE__-&gt;add_unique_constraint(&quot;person_email_key&quot;, [&quot;email&quot;]);
+__PACKAGE__-&gt;has_many(&quot;threads&quot;, &quot;Thread&quot;, { &quot;foreign.creator&quot; =&gt; &quot;self.person_id&quot; });
+__PACKAGE__-&gt;has_many(
+  &quot;email_queues&quot;,
+  &quot;EmailQueue&quot;,
+  { &quot;foreign.recipient&quot; =&gt; &quot;self.person_id&quot; },
+);
+__PACKAGE__-&gt;has_many(&quot;posts&quot;, &quot;Post&quot;, { &quot;foreign.creator&quot; =&gt; &quot;self.person_id&quot; });
+__PACKAGE__-&gt;has_many(
+  &quot;thread_views&quot;,
+  &quot;ThreadView&quot;,
+  { &quot;foreign.person&quot; =&gt; &quot;self.person_id&quot; },
+);
+__PACKAGE__-&gt;belongs_to(&quot;preference&quot;, &quot;Preference&quot;, { preference_id =&gt; &quot;preference&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;last_post&quot;, &quot;Post&quot;, { post_id =&gt; &quot;last_post&quot; });
+__PACKAGE__-&gt;belongs_to(
+  &quot;authentication&quot;,
+  &quot;Authentication&quot;,
+  { authentication_id =&gt; &quot;authentication&quot; },
+);
+__PACKAGE__-&gt;has_many(
+  &quot;registration_authentications&quot;,
+  &quot;RegistrationAuthentication&quot;,
+  { &quot;foreign.recipient&quot; =&gt; &quot;self.person_id&quot; },
+);
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema/Post.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/Post.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/Post.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,223 @@
+package Parley::Schema::Post;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+use Data::Dump qw(pp);
+
+use DateTime;
+use DateTime::Format::Pg;
+use Text::Context::EitherSide;
+use Text::Search::SQL;
+
+use Parley::App::DateTime qw( :interval );
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;ResultSetManager&quot;, &quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;post&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;creator&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;subject&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; undef,
+  },
+  &quot;quoted_post&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;message&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;quoted_text&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; undef,
+  },
+  &quot;created&quot;,
+  {
+    data_type =&gt; &quot;timestamp with time zone&quot;,
+    default_value =&gt; &quot;now()&quot;,
+    is_nullable =&gt; 1,
+    size =&gt; 8,
+  },
+  &quot;thread&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;reply_to&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;post_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('post_post_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+  &quot;edited&quot;,
+  {
+    data_type =&gt; &quot;timestamp with time zone&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; 8,
+  },
+
+  ip_addr =&gt; {
+    data_type =&gt; &quot;inet&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; 8,
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;post_id&quot;);
+__PACKAGE__-&gt;has_many(&quot;threads&quot;, &quot;Thread&quot;, { &quot;foreign.last_post&quot; =&gt; &quot;self.post_id&quot; });
+__PACKAGE__-&gt;has_many(&quot;forums&quot;, &quot;Forum&quot;, { &quot;foreign.last_post&quot; =&gt; &quot;self.post_id&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;creator&quot;, &quot;Person&quot;, { person_id =&gt; &quot;creator&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;reply_to&quot;, &quot;Post&quot;, { post_id =&gt; &quot;reply_to&quot; });
+__PACKAGE__-&gt;has_many(
+  &quot;post_reply_toes&quot;,
+  &quot;Post&quot;,
+  { &quot;foreign.reply_to&quot; =&gt; &quot;self.post_id&quot; },
+);
+__PACKAGE__-&gt;belongs_to(&quot;thread&quot;, &quot;Thread&quot;, { thread_id =&gt; &quot;thread&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;quoted_post&quot;, &quot;Post&quot;, { post_id =&gt; &quot;quoted_post&quot; });
+__PACKAGE__-&gt;has_many(
+  &quot;post_quoted_posts&quot;,
+  &quot;Post&quot;,
+  { &quot;foreign.quoted_post&quot; =&gt; &quot;self.post_id&quot; },
+);
+__PACKAGE__-&gt;has_many(&quot;people&quot;, &quot;Person&quot;, { &quot;foreign.last_post&quot; =&gt; &quot;self.post_id&quot; });
+
+
+
+
+foreach my $datecol (qw/created edited/) {
+    __PACKAGE__-&gt;inflate_column($datecol, {
+        inflate =&gt; sub { DateTime::Format::Pg-&gt;parse_datetime(shift); },
+        deflate =&gt; sub { DateTime::Format::Pg-&gt;format_datetime(shift); },
+    });
+}
+
+
+
+# we used to use -&gt;slice() but it sopped working on page #2 (!!)
+# this may be slower [not benchmarked] but it works
+sub last_post_in_list : ResultSet {
+    my ($self, $post_list) = @_;
+    my ($current_post);
+
+    while (my $tmp = $post_list-&gt;next()) {
+        # do nothing, we're just iterating the list
+        $current_post = $tmp;
+        #warn qq{LOOP: } . ref($current_post);
+    }
+    # return the current post, which is the last one we saw
+    # i.e. the last one in the list
+    #warn qq{CURRENT: } . ref($current_post);
+    return $current_post;
+}
+
+
+sub next_post :ResultSet {
+    my ($self, $post) = @_;
+    my $next_post;
+
+    # we want to find the next post after the one we've been given, based on
+    # creation time
+    # if for some reason there are no matches, just return the post we were passed
+    $next_post = $self-&gt;search(
+        {
+            created =&gt; { '&gt;' =&gt; DateTime::Format::Pg-&gt;format_datetime($post-&gt;created()) },
+            thread  =&gt; $post-&gt;thread()-&gt;id(),
+        },
+        {
+            rows    =&gt; 1,
+        }
+    );
+
+    if (defined $next_post-&gt;first()) {
+        return $next_post-&gt;first();
+    }
+
+    return $post;
+}
+
+
+sub page_containing_post : ResultSet {
+    my ($self, $post, $posts_per_page) = @_;
+
+    my $position_in_thread = $self-&gt;thread_position($post);
+
+    # work out what page the Nth post is on
+    my $page_number = int(($position_in_thread - 1) / $posts_per_page) + 1;
+
+    return $page_number;
+}
+
+
+sub thread_position : ResultSet {
+    my ($self, $post) = @_;
+
+    if (not defined $post) {
+        warn('$post id undefined in call to Parley::Model::ParleyDB::Post-&gt;thread_position()');
+        return;
+    }
+
+    # explicitly 'deflate' the creation time, as DBIx::Class (&lt;=v0.06003) doesn't deflate on search()
+    my $position = $self-&gt;count(
+        {
+            thread  =&gt; $post-&gt;thread()-&gt;id(),
+            created =&gt; {
+                '&lt;='   =&gt; DateTime::Format::Pg-&gt;format_datetime($post-&gt;created())
+            },
+        }
+    );
+
+    return $position;
+}
+
+# accessor to use in search results to return context matches
+sub match_context {
+    my $self = shift;
+    my $search_terms = shift;
+    my ($tss, $terms);
+
+    if (not defined $search_terms) {
+        return;
+    }
+
+    $tss = Text::Search::SQL-&gt;new(
+        {
+            search_term     =&gt; $search_terms,
+        }
+    );
+    $tss-&gt;parse();
+    $terms = $tss-&gt;get_chunks();
+    warn pp($terms);
+    warn pp($self-&gt;message());
+
+    my $context = Text::Context::EitherSide-&gt;new( $self-&gt;message(), context =&gt; 3 );
+    return $context-&gt;as_string( @{ $terms } );
+}
+
+sub interval_ago {
+    my $self = shift;
+    my ($now, $duration, $longest_duration);
+
+    my $interval_string = interval_ago_string(
+        $self-&gt;created()
+    );
+    return $interval_string;
+}
+
+1;
+__END__
+vim: ts=8 sts=4 et sw=4 sr sta
+

Added: tags/parley-0.55/lib/Parley/Schema/Preference.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/Preference.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/Preference.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,63 @@
+package Parley::Schema::Preference;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;preference&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;timezone&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; &quot;'UTC'::text&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+
+  &quot;preference_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('preference_preference_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+
+  'time_format' =&gt; {
+    data_type =&gt; 'integer',
+    size =&gt; 4,
+  },
+
+  'show_tz' =&gt; {
+    data_type =&gt; 'boolean',
+    default_value =&gt; 'true',
+    size =&gt; 1,
+  },
+
+  'notify_thread_watch' =&gt; {
+    data_type =&gt; 'boolean',
+    default_value =&gt; 'false',
+    size =&gt; 1,
+  },
+
+  'watch_on_post' =&gt; {
+    data_type =&gt; 'boolean',
+    default_value =&gt; 'false',
+    size =&gt; 1,
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;preference_id&quot;);
+__PACKAGE__-&gt;has_many(
+  &quot;people&quot;,
+  &quot;Person&quot;,
+  { &quot;foreign.preference&quot; =&gt; &quot;self.preference_id&quot; },
+);
+
+__PACKAGE__-&gt;belongs_to(&quot;time_format&quot;, &quot;PreferenceTimeString&quot;, { preference_time_string_id =&gt; &quot;time_format&quot; });
+
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema/PreferenceTimeString.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/PreferenceTimeString.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/PreferenceTimeString.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,33 @@
+package Parley::Schema::PreferenceTimeString;
+use strict;
+use warnings;
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;preference_time_string&quot;);
+__PACKAGE__-&gt;add_columns(
+    preference_time_string_id =&gt; {
+        data_type =&gt; &quot;integer&quot;,
+        default_value =&gt; &quot;nextval('preference_time_string_preference_time_string_id_seq'::regclass)&quot;,
+        is_nullable =&gt; 0,
+        size =&gt; 4,
+    },
+    time_string =&gt; {
+        data_type =&gt; &quot;text&quot;,
+        is_nullable =&gt; 0,
+        size =&gt; undef,
+    },
+    sample =&gt; {
+        data_type =&gt; &quot;text&quot;,
+        is_nullable =&gt; 0,
+        size =&gt; undef,
+    },
+    comment =&gt; {
+        data_type =&gt; &quot;text&quot;,
+        is_nullable =&gt; 1,
+        size =&gt; undef,
+    },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;preference_time_string_id&quot;);
+
+1;

Added: tags/parley-0.55/lib/Parley/Schema/RegistrationAuthentication.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/RegistrationAuthentication.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/RegistrationAuthentication.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+package Parley::Schema::RegistrationAuthentication;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components(&quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;registration_authentication&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;recipient&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;registration_authentication_id&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;expires&quot;,
+  { data_type =&gt; &quot;date&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;registration_authentication_id&quot;);
+__PACKAGE__-&gt;belongs_to(&quot;recipient&quot;, &quot;Person&quot;, { person_id =&gt; &quot;recipient&quot; });
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema/Thread.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/Thread.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/Thread.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,249 @@
+package Parley::Schema::Thread;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+
+__PACKAGE__-&gt;load_components('ResultSetManager', &quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;thread&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;thread_id&quot;,
+  {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('thread_thread_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+  &quot;locked&quot;,
+  {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;false&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+  &quot;creator&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;subject&quot;,
+  {
+    data_type =&gt; &quot;text&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; undef,
+  },
+  &quot;active&quot;,
+  {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;true&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+  &quot;forum&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;created&quot;,
+  {
+    data_type =&gt; &quot;timestamp with time zone&quot;,
+    default_value =&gt; &quot;now()&quot;,
+    is_nullable =&gt; 1,
+    size =&gt; 8,
+  },
+  &quot;last_post&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; undef, is_nullable =&gt; 1, size =&gt; 4 },
+  &quot;sticky&quot;,
+  {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;false&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+  &quot;post_count&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; 0, is_nullable =&gt; 0, size =&gt; 4 },
+  &quot;view_count&quot;,
+  { data_type =&gt; &quot;integer&quot;, default_value =&gt; 0, is_nullable =&gt; 0, size =&gt; 4 },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;thread_id&quot;);
+__PACKAGE__-&gt;belongs_to(&quot;creator&quot;, &quot;Person&quot;, { person_id =&gt; &quot;creator&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;last_post&quot;, &quot;Post&quot;, { post_id =&gt; &quot;last_post&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;forum&quot;, &quot;Forum&quot;, { forum_id =&gt; &quot;forum&quot; });
+__PACKAGE__-&gt;has_many(&quot;posts&quot;, &quot;Post&quot;, { &quot;foreign.thread&quot; =&gt; &quot;self.thread_id&quot; });
+__PACKAGE__-&gt;has_many(
+  &quot;thread_views&quot;,
+  &quot;ThreadView&quot;,
+  { &quot;foreign.thread&quot; =&gt; &quot;self.thread_id&quot; },
+);
+
+__PACKAGE__-&gt;has_many(
+    'forum_moderators',
+    'ForumModerator',
+    {
+        'foreign.forum' =&gt; 'self.forum',
+    }
+);
+
+
+foreach my $datecol (qw/created/) {
+    __PACKAGE__-&gt;inflate_column($datecol, {
+        inflate =&gt; sub { DateTime::Format::Pg-&gt;parse_datetime(shift); },
+        deflate =&gt; sub { DateTime::Format::Pg-&gt;format_datetime(shift); },
+    });
+}
+
+# This is slightly complicated; the way we find the last post a user has seen
+# in a thread is:
+#
+# - If there is a thread_view entry for person-thread then find the last post
+#    made on or before that time
+# - If there is no thread_view entry, then the user has never seen the thread
+#   before, in which case the last post viewed is considered to be the
+#   first post in the thread
+sub last_post_viewed_in_thread :ResultSet {
+    my ($self, $person, $thread) = @_;
+    my ($last_viewed, $last_post) = @_;
+
+    my $schema = $self-&gt;result_source()-&gt;schema();
+
+    # we need to be careful that we haven't deleted/hidden the post that
+    # matches the exact timestamp of last_viewed for a thread - this is why we
+    # use &lt;= and not ==, since we can just return the latest undeleted post
+
+    # get the entry (if any) for person-thread from the thread_view table
+    $last_viewed = $schema-&gt;resultset('ThreadView')-&gt;find(
+        {
+            person  =&gt; $person-&gt;id(),
+            thread  =&gt; $thread-&gt;id(),
+        }
+    );
+
+    # if we don't have a $last_viewed, then return the thread's first post
+    if (not defined $last_viewed) {
+        warn &quot;thread has never been viewed - returning first post in thread&quot;;
+
+        # get all the posts in the thread, oldest first
+        my $posts_in_thread = $schema-&gt;resultset('Post')-&gt;search(
+            {
+                thread  =&gt; $thread-&gt;id(),
+            },
+            {
+                rows        =&gt; 1,
+                order_by    =&gt; 'created ASC',
+            }
+        );
+
+        # set the first post
+        $last_post = $posts_in_thread-&gt;first();
+    }
+
+    # otherwise, find the most recent post made on or before the timestamp in
+    # $last_viewed
+    else {
+        warn q{looking for a post on or before } . $last_viewed-&gt;timestamp();
+
+        # get a list of posts created on or before our last-post time, newest
+        # first
+        my $list_of_posts = $schema-&gt;resultset('Post')-&gt;search(
+            {
+                created =&gt; {
+                    '&lt;=',
+                    DateTime::Format::Pg-&gt;format_datetime(
+                        $last_viewed-&gt;timestamp()
+                    )
+                },
+                thread  =&gt; $thread-&gt;id(),
+            },
+            {
+                rows        =&gt; 1,
+                order_by    =&gt; 'created DESC',
+            }
+        );
+
+        # the most recent post is the first (and only) post in our list
+        $last_post = $list_of_posts-&gt;first();
+    }
+
+    # we should now have a Post object in $last_post
+    if (not defined $last_post) {
+        warn q{$last_post is undefined in last_post_viewed_in_thread()};
+        return;
+    }
+
+    # return the last post ..
+    return $last_post;
+}
+
+sub _last_post_viewed_in_thread :ResultSet {
+    my ($self, $person, $thread) = @_;
+    my ($last_viewed, $last_post);
+
+    my $schema = $self-&gt;result_source()-&gt;schema();
+
+    # we need to be careful that we haven't deleted/hidden the post that
+    # matches the exact timestamp of last_viewed for a thread - this is why we
+    # use &lt;= and not ==, since we can just return the latest undeleted post
+
+    # get the &quot;last_viewed&quot; value from thread_view
+    $last_viewed = $schema-&gt;resultset('ThreadView')-&gt;search(
+        {
+            person  =&gt; $person-&gt;id(),
+            thread  =&gt; $thread-&gt;id(),
+        },
+        {
+            rows =&gt; 1,
+        }
+    );
+
+    # if last_viewed isn't defined, it should mean the user has never viewed
+    # this thread
+    if (not defined $last_viewed) {
+        warn &quot;thread has never been viewed - returning first post in thread&quot;;
+
+        $last_post = $schema-&gt;resultset('Post')-&gt;search(
+            {
+                thread  =&gt; $thread-&gt;id(),
+            },
+            {
+                rows        =&gt; 1,
+                order_by    =&gt; 'created ASC',
+            }
+        );
+
+        return $last_post-&gt;first();
+    }
+        
+    #die dump(ref $last_viewed);
+    if (not $last_viewed-&gt;count()) {
+        warn &quot;no matches for 'last viewed' in last_post_viewed_in_thread()&quot;;
+        return;
+    }
+
+    # now get the last post made on or before our timestamp for when we last
+    # viewed the thread
+    $last_post = $schema-&gt;resultset('Post')-&gt;search(
+        {
+            created =&gt; {
+                '&lt;=', 
+                DateTime::Format::Pg-&gt;format_datetime($last_viewed-&gt;timestamp())
+            },
+            thread  =&gt; $thread-&gt;id(),
+        },
+        {
+            rows        =&gt; 1,
+            order_by    =&gt; 'created DESC',
+        }
+    );
+
+    # return the first result (if we have any)
+    if ($last_post-&gt;count()) {
+        return $last_post-&gt;first();
+    }
+
+    # oh well, we didn't get anything
+    # XXX this might cause problems in the future, but we'll see
+    return;
+}
+
+
+1;
+__END__
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Parley/Schema/ThreadView.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema/ThreadView.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema/ThreadView.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,155 @@
+package Parley::Schema::ThreadView;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class';
+use DateTime::Format::Pg;
+
+use Parley::App::DateTime qw( :interval );
+
+__PACKAGE__-&gt;load_components('ResultSetManager', &quot;PK::Auto&quot;, &quot;Core&quot;);
+__PACKAGE__-&gt;table(&quot;thread_view&quot;);
+__PACKAGE__-&gt;add_columns(
+  &quot;watched&quot; =&gt; {
+    data_type =&gt; &quot;boolean&quot;,
+    default_value =&gt; &quot;false&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 1,
+  },
+
+  &quot;thread_view_id&quot; =&gt; {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; &quot;nextval('thread_view_thread_view_id_seq'::regclass)&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 4,
+  },
+
+  &quot;last_notified&quot; =&gt; {
+    data_type =&gt; &quot;timestamp with time zone&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 1,
+    size =&gt; 8,
+  },
+
+  &quot;thread&quot; =&gt; {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; 4
+  },
+  &quot;timestamp&quot; =&gt; {
+    data_type =&gt; &quot;timestamp with time zone&quot;,
+    default_value =&gt; &quot;now()&quot;,
+    is_nullable =&gt; 0,
+    size =&gt; 8,
+  },
+  &quot;person&quot; =&gt; {
+    data_type =&gt; &quot;integer&quot;,
+    default_value =&gt; undef,
+    is_nullable =&gt; 0,
+    size =&gt; 4
+  },
+);
+__PACKAGE__-&gt;set_primary_key(&quot;thread_view_id&quot;);
+__PACKAGE__-&gt;add_unique_constraint(&quot;thread_view_person_key&quot;, [&quot;person&quot;, &quot;thread&quot;]);
+__PACKAGE__-&gt;belongs_to(&quot;thread&quot;, &quot;Thread&quot;, { thread_id =&gt; &quot;thread&quot; });
+__PACKAGE__-&gt;belongs_to(&quot;person&quot;, &quot;Person&quot;, { person_id =&gt; &quot;person&quot; });
+
+
+
+
+foreach my $datecol (qw/timestamp/) {
+    __PACKAGE__-&gt;inflate_column($datecol, {
+        inflate =&gt; sub { DateTime::Format::Pg-&gt;parse_datetime(shift); },
+        deflate =&gt; sub { DateTime::Format::Pg-&gt;format_datetime(shift); },
+    });
+}
+
+
+sub watching_thread : ResultSet {
+    my ($self, $thread, $person) = @_;
+
+    if (not defined $thread) {
+        warn 'undefined value passed as $thread in watching_thread()';
+        return;
+    }
+    if (not defined $person) {
+        warn 'undefined value passed as $person in watching_thread()';
+        return;
+    }
+
+    my $thread_view = $self-&gt;find(
+        {
+            person  =&gt; $person-&gt;id(),
+            thread  =&gt; $thread-&gt;id(),
+        }
+    );
+
+    return $thread_view-&gt;watched();
+}
+
+sub notification_list : ResultSet {
+    my ($self, $post) = @_;
+    my ($schema);
+
+    if (not defined $post) {
+        warn 'undefined value passed as $post in notification_list()';
+        return;
+    }
+
+    # make sure we have full object details
+    # [we don't seem to get all the default column data for a new create()]
+    $schema = $self-&gt;result_source()-&gt;schema();
+    $post = $schema-&gt;resultset('Post')-&gt;find(
+        post_id =&gt; $post-&gt;id()
+    );
+    if (not defined $post) {
+        warn 'failed to re-fetch post in notification_list()';
+        return;
+    }
+
+    # find the list of people to notify about this update
+    my $notification_list = $self-&gt;search(
+        {
+            # the thread the post belongs to
+            thread          =&gt; $post-&gt;thread()-&gt;id(),
+            # only interested in records where a person is watching
+            watched         =&gt; 1,
+            # and they last viewed the thread before the last post
+            timestamp       =&gt; {
+                '&lt;',
+                DateTime::Format::Pg-&gt;format_datetime(
+                    $post-&gt;created()
+                )
+            },
+            # and they've not been notified
+            last_notified   =&gt; [
+                {   '=',    undef   },
+                   \'&lt; timestamp'    ,
+            ],
+            # and they aren't the person that created the post itself
+            person          =&gt; {
+                '!=',
+                $post-&gt;creator()-&gt;id(),
+            },
+        }
+    );
+
+    return $notification_list;
+}
+
+sub interval_ago {
+    my $self = shift;
+    my ($now, $duration, $longest_duration);
+
+    my $interval_string = interval_ago_string(
+        $self-&gt;timestamp()
+    );
+    return $interval_string;
+}
+
+1;
+

Added: tags/parley-0.55/lib/Parley/Schema.pm
===================================================================
--- tags/parley-0.55/lib/Parley/Schema.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/Schema.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+package Parley::Schema;
+
+# Created by DBIx::Class::Schema::Loader v0.03004 @ 2006-08-10 09:12:24
+
+use strict;
+use warnings;
+
+use base 'DBIx::Class::Schema';
+
+__PACKAGE__-&gt;load_classes;
+$ENV{DBIC_TRACE} = 0;
+
+1;

Added: tags/parley-0.55/lib/Parley/View/Plain.pm
===================================================================
--- tags/parley-0.55/lib/Parley/View/Plain.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/View/Plain.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+package Parley::View::Plain;
+
+use strict;
+use base 'Catalyst::View::TT';
+
+=head1 NAME
+
+Parley::View::Plain - Catalyst TT View
+
+=head1 SYNOPSIS
+
+See L&lt;Parley&gt;
+
+=head1 DESCRIPTION
+
+Catalyst TT View.
+
+=head1 AUTHOR
+
+Chisel Wright,,,
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley/View/TT.pm
===================================================================
--- tags/parley-0.55/lib/Parley/View/TT.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley/View/TT.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+package Parley::View::TT;
+
+use strict;
+use base 'Catalyst::View::TT';
+
+=head1 NAME
+
+Parley::View::TT - Catalyst TT View
+
+=head1 SYNOPSIS
+
+See L&lt;Parley&gt;
+
+=head1 DESCRIPTION
+
+Catalyst TT View.
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+1;

Added: tags/parley-0.55/lib/Parley.pm
===================================================================
--- tags/parley-0.55/lib/Parley.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Parley.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,256 @@
+package Parley;
+
+use strict;
+use warnings;
+
+use Catalyst::Runtime '5.70';
+use Catalyst qw/
+    -Debug
+    Dumper
+    StackTrace
+
+    ConfigLoader
+
+    FormValidator
+    FillInForm
+
+    Email
+    Static::Simple
+
+    Session
+    Session::Store::FastMmap
+    Session::State::Cookie
+
+    Authentication
+    Authentication::Store::DBIC
+    Authentication::Credential::Password
+/;
+
+use Parley::App::Communication::Email qw( :email );
+
+our $VERSION = '0.55';
+
+__PACKAGE__-&gt;config( version =&gt; $VERSION );
+__PACKAGE__-&gt;setup;
+
+# only show certain log levels in output
+__PACKAGE__-&gt;log (Catalyst::Log-&gt;new( @{__PACKAGE__-&gt;config-&gt;{log_levels}} ));
+
+# I'm sure there's a (better) way to do this by overriding set()/get() in Class::Accessor
+{
+    sub set_get {
+        my $c = shift;
+        my $key = shift;
+
+        if(@_ == 1) {
+            $c-&gt;stash-&gt;{$key} = $_[0];
+        }
+        elsif(@_ &gt; 1) {
+            $c-&gt;stash-&gt;{$key} = [@_];
+        }
+
+        $c-&gt;stash-&gt;{$key};
+    }
+
+    sub _authed_user {
+        my $c = shift;
+        $c-&gt;set_get('authed_user', @_);
+    }
+    sub _current_post {
+        my $c = shift;
+        $c-&gt;set_get('current_post', @_);
+    }
+    sub _current_thread {
+        my $c = shift;
+        $c-&gt;set_get('current_thread', @_);
+    }
+    sub _current_forum {
+        my $c = shift;
+        $c-&gt;set_get('current_forum', @_);
+    }
+}
+
+################################################################################
+
+
+sub application_email_address {
+    my ($c) = @_;
+
+    my $address = 
+          $c-&gt;config-&gt;{alerts}{from_name}
+        . q{ &lt;}
+        . $c-&gt;config-&gt;{alerts}{from_address}
+        . q{&gt;}
+    ;
+
+    return $address;
+}
+
+
+sub is_logged_in {
+    my ($c) = @_;
+
+    if ($c-&gt;user) {
+        return 1;
+    }
+
+    return 0;
+}
+
+sub login_if_required {
+    my ($c, $message) = @_;
+
+    if( not $c-&gt;is_logged_in($c) ) {
+        # make sure we return here after a successful login
+        $c-&gt;session-&gt;{after_login} = $c-&gt;request-&gt;uri();
+        # set an informative message to display on the login screen
+        if (defined $message) {
+            $c-&gt;session-&gt;{login_message} = $message;
+        }
+        # send the user to the login screen
+        $c-&gt;detach( '/user/login' );
+        return;
+    }
+}
+
+1;
+
+__END__
+
+=pod
+
+=head1 NAME
+
+Parley - Catalyst based application
+
+=head1 SYNOPSIS
+
+    script/parley_server.pl
+
+=head1 DESCRIPTION
+
+Catalyst driven forum application
+
+=head1 METHODS
+
+=head2 application_email_address($c)
+
+=over 4
+
+B&lt;Return Value:&gt; $string
+
+=back
+
+Returns the email address string for the application built from the
+I&lt;from_name&gt; and I&lt;from_address&gt; in the alerts section of parley.yml
+
+=head2 is_logged_in($c)
+
+=over 4
+
+B&lt;Return Value:&gt; 0 or 1
+
+=back
+
+Returns 1 or 0 depending on whether there is a logged-in user or not.
+
+=head2 login_if_required($c,$message)
+
+=over 4
+
+B&lt;Return Value:&gt; Void Context
+
+=back
+
+If a user isn't logged in, send them to the login page, optionally setting the
+message for the login box.
+
+Once logged in the user should (by virtue of stored session data, and login
+magic) be redirected to wherever they were trying to view before the required
+login.
+
+=head2 send_email($c,\%options)
+
+=over 4
+
+B&lt;Return Value:&gt; 0 or 1
+
+=back
+
+Send an email using the render() method in the TT view. \%options should
+contain the following keys:
+
+=over 4
+
+=item headers
+
+Header fields to be passed though to the call to L&lt;Catalyst::Plugin::Email&gt;.
+
+=item person
+
+A Parley::Schema::Person object for the intended recipient of the message.
+
+Or, any object with an email() method, and methods to match
+&quot;S&lt;[% person.foo() %]&gt;&quot;
+methods called in the email template(s).
+
+=item template
+
+Used to store the name of the email template(s) to be sent. I&lt;Currently the
+application only sends plain-text emails, so only one file is specified.&gt;
+
+The text template name should be passed in -&gt;{template}{text}.
+
+The html template name should be passed in -&gt;{template}{html}. (I&lt;Not Implemented&gt;)
+
+=back
+
+=head1 EVIL, LAZY STASH ACCESS
+
+I know someone will look at this at some point and tell me this is evil, but
+I've added some get/set method shortcuts for commonly used stash items.
+
+=over 4
+
+=item $c-&gt;_authed_user
+
+get/set value stored in $c-&gt;stash-&gt;{_authed_user}:
+
+  $c-&gt;_authed_user( $some_value );
+
+=item $c-&gt;_current_post
+
+get/set value stored in $c-&gt;stash-&gt;{_current_post}:
+
+  $c-&gt;current_post( $some_value );
+
+=item $c-&gt;_current_thread
+
+get/set value stored in $c-&gt;stash-&gt;{_current_thread}:
+
+  $c-&gt;_current_thread( $some_value );
+
+=item $c-&gt;_current_forum
+
+get/set value stored in $c-&gt;stash-&gt;{_current_forum}:
+
+  $c-&gt;_current_forum( $some_value );
+
+=back
+
+=head1 SEE ALSO
+
+L&lt;Parley::Controller::Root&gt;, L&lt;Catalyst::Plugin::Email&gt;, L&lt;Catalyst&gt;
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel at herlpacker.co.uk</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut
+
+vim: ts=8 sts=4 et sw=4 sr sta

Added: tags/parley-0.55/lib/Template/Plugin/ForumCode.pm
===================================================================
--- tags/parley-0.55/lib/Template/Plugin/ForumCode.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Template/Plugin/ForumCode.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,311 @@
+package Template::Plugin::ForumCode;
+use strict;
+use warnings;
+
+use base qw{ Template::Plugin };
+use base qw{ Template::Plugin::HTML };
+
+use version; our $VERSION = qv('0.0.1');
+
+sub new {
+    my ($class, $context, @args) = @_;
+
+    my $new_obj = bless {}, $class;
+
+    # simple [x][/x] --&gt; &lt;x&gt;&lt;/x&gt; tags
+    $new_obj-&gt;{simple_tags} = [qw{
+        b
+        u
+        i
+    }];
+    # replacements; e.g. __x__ --&gt; &lt;u&gt;x&lt;/u&gt;
+    $new_obj-&gt;{replacements} = [
+        {   from =&gt; '__',       to =&gt; 'u'   },
+        {   from =&gt; '\*\*',     to =&gt; 'b'   },
+        #{   from =&gt; '\/\/',     to =&gt; 'i'   },
+    ];
+
+    return $new_obj;
+}
+
+sub forumcode {
+    my ($self, $text) = @_;
+
+    # first of all ESCAPE EVERYTHING!
+    $text = Template::Plugin::HTML-&gt;escape($text);
+
+    # turn newlines into &lt;br /&gt; tags
+    $self-&gt;_preserve_newlines(\$text );
+
+    $self-&gt;_simple_tags     ( \$text );
+    $self-&gt;_replacements    ( \$text );
+    $self-&gt;_colouring       ( \$text );
+    $self-&gt;_lists           ( \$text );
+    $self-&gt;_url_links       ( \$text );
+    $self-&gt;_images          ( \$text );
+    
+    return $text;
+}
+
+sub _preserve_newlines {
+    my ($self, $textref) = @_;
+
+    $$textref =~ s{\n}{&lt;br /&gt;}xmsg;
+}
+
+sub _simple_tags {
+    my ($self, $textref) = @_;
+
+    # deal with acceptable [x]...[/x] markup
+    foreach my $tag (@{ $self-&gt;{simple_tags} }) {
+        # we should be able to combine these two into one
+        #$$textref =~ s{\[$tag\]}{&lt;$tag&gt;}g;
+        #$$textref =~ s{\[/$tag\]}{&lt;/$tag&gt;}g;
+        $$textref =~ s{
+            \[($tag)\]
+            (.+?)
+            \[/$tag\]
+        }
+        {&lt;$1&gt;$2&lt;/$1&gt;}xmsg;
+    }
+}
+
+sub _replacements {
+    my ($self, $textref) = @_;
+
+    # now deal with replacements
+    foreach my $tag (@{ $self-&gt;{replacements} }) {
+        $$textref =~ s{
+            $tag-&gt;{from}
+            (.+?)
+            $tag-&gt;{from}
+        }
+        {&lt;$tag-&gt;{to}&gt;$1&lt;/$tag-&gt;{to}&gt;}gx;
+    }
+}
+
+sub _url_links {
+    my ($self, $textref) = @_;
+
+    # deal with links with no text-label
+    $$textref =~ s{\[url\](.+?)\[/url\]}
+        {&lt;a href=&quot;$1&quot;&gt;$1&lt;/a&gt;}xmsg;
+    # deal with links with a text-label
+    $$textref =~ s{
+        \[url           # start of url tag
+        \s+             # need some whitespace
+        name=&quot;     # name=&quot;
+        (.+?)           # the name
+        &quot;          # closing &quot;
+        \s*             # optional whitespace
+        \]              # close the opening tag
+        (.+?)           # the url
+        \[/url\]        # close the URL tag
+    }
+    {&lt;a href=&quot;$2&quot;&gt;$1&lt;/a&gt;}xmsg;
+}
+
+sub _images {
+    my ($self, $textref) = @_;
+
+    # deal with image tags
+    $$textref =~ s{
+        \[img
+        (.*?)
+        \]
+        (.+?)
+        \[/img\]
+    }
+    {&lt;img src=&quot;$2&quot;$1 /&gt;}xmsg;
+}
+
+sub _colouring {
+    my ($self, $textref) = @_;
+
+    # deal with colouring
+    $$textref =~ s{
+        \[(colou?r)
+        =
+        (
+              red | orange | yellow | green | blue
+            | black | white
+            | \#[0-9a-fA-F]{3}
+            | \#[0-9a-fA-F]{6}
+        )
+        \]
+        (.+?)
+        \[/\1\]
+    }
+    {&lt;span style=&quot;color: $2&quot;&gt;$3&lt;/span&gt;}ixmsg;
+}
+
+sub _lists {
+    my ($self, $textref) = @_;
+
+    $$textref =~ s{
+        \[list\]
+        (?:
+            \s*
+            (?:
+                &lt;br\s*?/&gt;
+            )?
+            \s*
+        )
+        (.+?)
+        \[/list\]
+        [\s]*
+        (?:
+            &lt;br\s*?/&gt;
+        )?
+    }
+    {_list_elements($1)}xmsge;
+}
+
+sub _list_elements {
+    my ($text) = @_;
+
+    # ordered lists
+    if (
+        $text =~ s{
+            \[\*\]
+            \s*
+            (.+?)
+            &lt;br\s*?/&gt;
+            \s*
+        }
+        {&lt;li&gt;$1&lt;/li&gt;}xmsg
+    ) {
+        return qq{&lt;ul&gt;$text&lt;/ul&gt;};
+    }
+
+    # ordered lists
+    if (
+        $text =~ s{
+            \[1\]
+            \s*
+            (.+?)
+            &lt;br\s*?/&gt;
+            \s*
+        }
+        {&lt;li&gt;$1&lt;/li&gt;}xmsg
+    ) {
+        return qq{&lt;ol&gt;$text&lt;/ol&gt;};
+    }
+
+
+    # otherwise, just return what we were given
+    return $text;
+}
+
+1;
+__END__
+vim: ts=8 sts=4 et sw=4 sr sta
+
+=pod
+
+=head1 NAME
+
+Template::Plugin::ForumCode - class for &quot;ForumCode&quot; filter
+
+=head1 SYNOPSIS
+
+  # load the TT module
+  [% USE ForumCode %]
+
+  # ForumCodify some text
+  [% ForumCode.forumcode('[b]bold[/u] [u]underlined[/u] [i]italic[/i]') %]
+  [% ForumCode.forumcode('**bold** __underlined__') %]
+
+=head1 DESCRIPTION
+
+This module implements ForumCode, a simple markup language inspired by the
+likes of BBCode.
+
+ForumCode allows end-users (of a web-site) limited access to a set of HTML
+markup through a HTML-esque syntax.
+
+This module works by using L&lt;Template::Plugin::HTML&gt; to escape all HTML
+entities and markup. It then performs a series of transformations to convert
+ForumCode markup into the appropriate HTML markup.
+
+=head1 MARKUP
+
+The ForumCode plugin will perform the following transformations:
+
+=over 4
+
+=item B&lt;[b]&gt;...B&lt;[/b]&gt; or B&lt;**&gt;...B&lt;**&gt;
+
+Make the text between the markers I&lt;bold&gt;.
+
+=item B&lt;[u]&gt;...B&lt;[/u]&gt; or B&lt;__&gt;...B&lt;___&gt;
+
+Make the text between the markers I&lt;underlined&gt;.
+  
+=item B&lt;[i]&gt;...B&lt;[/i]&gt;
+
+Make the text between the markers I&lt;italicised&gt;.
+
+=item B&lt;[url]&gt;<A HREF="http://...B&lt;[/url">http://...B&lt;[/url</A>]&gt;
+
+Make the text between the markers into a I&lt;HTML link&gt;. If you
+would like to give the link a name, use the following format:
+
+S&lt;[url B&lt;name=&quot;...&quot;&gt;]<A HREF="http://...[/url">http://...[/url</A>]&gt;
+
+=item B&lt;[img]&gt;<A HREF="http://...B&lt;[/img">http://...B&lt;[/img</A>]&gt;
+
+Insert an I&lt;image&gt;, specified by the URL between the markers.
+
+=item B&lt;[colour=I&lt;code&gt;]&gt;...B&lt;[/colour]&gt;
+
+Make a block of text appear in the I&lt;colour&gt; specified by I&lt;code&gt;.
+
+I&lt;code&gt; can be any of the named colours: red, orange, yellow, green, blue, black, white.
+
+I&lt;code&gt; may also be a #RGB value in either the #XYZ or #XXYYZZ format.
+
+For the sake of international relations C&lt;&lt; [color=I&lt;code&gt;]...[/color] &gt;&gt; may aslo be used.
+
+=item B&lt;[list]&gt;...B&lt;[/list]&gt;
+
+Create an ordered or unordered list of items. To create an I&lt;unordered list&gt; use B&lt;[*]&gt; to
+mark the start of each list item. To create an I&lt;ordered list&gt; use B&lt;[1]&gt; to mark the start
+of each list item.
+
+  e.g. an unordered list
+   [list]
+   [*]apple
+   [*]orange
+   [*]banana
+   [/list]
+
+  e.g. an ordered list
+   [list]
+   [1]first
+   [1]second
+   [1]third
+   [/list]
+
+=back
+
+=head1 PUBLIC METHODS
+
+=head2 new
+
+Create a new instance of the plugin for TT usage
+
+=head2 forumcode
+
+The transformation function
+
+=head1 AUTHOR
+
+Chisel Wright C&lt;&lt; &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chiselwright at users.berlios.de</A>&gt; &gt;&gt;
+
+=head1 LICENSE
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut

Added: tags/parley-0.55/lib/Text/Search/SQL.pm
===================================================================
--- tags/parley-0.55/lib/Text/Search/SQL.pm	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/lib/Text/Search/SQL.pm	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,164 @@
+package Text::Search::SQL;
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+use Carp;
+use Data::Dump qw(pp);
+
+sub new {
+    my ($proto, $options) = @_;
+
+    my $defaults = {
+        search_term     =&gt; undef,
+        search_type     =&gt; '=',
+        search_fields   =&gt; [],
+    };
+
+    my $self = bless $defaults, ref($proto) || $proto;
+
+    # slip in the options passed to us
+    while (my ($k,$v) = each %{$options}) {
+        if (exists $defaults-&gt;{$k}) {
+            if (not ref($self-&gt;{$k})) {
+                $self-&gt;{$k} = $v;
+            }
+            elsif ( ref $self-&gt;{$k} and (ref($v) eq ref($self-&gt;{$k}))) {
+                $self-&gt;{$k} = $v;
+            }
+            else {
+                Carp::carp( qq{'$k' should be of type } . ref($self-&gt;{$k}) );
+            }
+        }
+        else {
+            Carp::carp( qq{unknown option '$k'} );
+        }
+    }
+
+    return $self;
+}
+
+sub set_search_term {
+    my ($self, $value) = @_;
+
+    $self-&gt;{search_term} = $value;
+}
+sub get_search_term {
+    my ($self) = @_;
+    return $self-&gt;{search_term};
+}
+
+sub set_search_type {
+    my ($self, $value) = @_;
+
+    $self-&gt;{search_type} = $value;
+}
+sub get_search_type {
+    my ($self) = @_;
+    return $self-&gt;{search_type};
+}
+
+sub set_search_fields {
+    my ($self, $value) = @_;
+
+    $self-&gt;{search_fields} = $value;
+}
+sub get_search_fields {
+    my ($self) = @_;
+    return $self-&gt;{search_fields};
+}
+
+sub set_chunks {
+    my ($self, $value) = @_;
+
+    $self-&gt;{chunks} = $value;
+}
+sub get_chunks {
+    my ($self) = @_;
+    return $self-&gt;{chunks};
+}
+
+sub set_sql_where {
+    my ($self, $value) = @_;
+
+    $self-&gt;{sql_where} = $value;
+}
+sub get_sql_where {
+    my ($self) = @_;
+    return $self-&gt;{sql_where};
+}
+
+sub parse {
+    my ($self) = @_;
+    my ($fields, $clauses, $search_type, $chunks);
+
+    $search_type = $self-&gt;get_search_type();
+
+    # split the search term into its relevant chunks
+    $self-&gt;set_chunks( $self-&gt;_parse_chunks( $self-&gt;{search_term} ) );
+
+    # can't do anything more if we don't have search_fields
+    $fields = $self-&gt;get_search_fields();
+    if (not @{$fields}) {
+        Carp::carp( qq{no search_fields defined, cannot prepare SQL::Abstract data} );
+        return;
+    }
+
+    # get the chunks
+    $chunks = $self-&gt;get_chunks();
+    # if we're doing a &quot;like&quot; match, then wrap the terms in %...%
+    if ($search_type =~ m{\A(?:ilike|like)\z}xms) {
+        @{ $chunks } = map (qq{%$_%}, @{ $chunks });
+    }
+
+    # build there where-clause
+    foreach my $field ( @{$fields} ) {
+        push @{ $clauses },
+            $field =&gt; { $search_type =&gt; $chunks }
+        ;
+    }
+
+    $self-&gt;{sql_where} = $clauses;
+
+    return 1;
+}
+
+sub _parse_chunks {
+    my ($self, $string) = @_;
+    my (@chunks, @quotes);
+
+    # we only group with double quotes
+    @quotes = qw( &quot; );
+
+    # pull out quoted groups of words
+    foreach my $quote (@quotes) {
+        while ($string =~ s{${quote}(.+?)${quote}}{ }g) {
+            push @chunks, $1;
+        }
+    }
+
+    # strip leading and trailing whitespace
+    $string =~ s{\A\s+}{};
+    $string =~ s{\s+\z}{};
+
+    # split on whitespace - how naive!
+    push @chunks, split( m{\s+}, $string );
+
+    return \@chunks;
+}
+
+
+1;
+
+__END__
+
+=pod
+
+=head1 NAME
+
+Text::Search::SQL - split search terms into something that can be used with DBIx::Class or SQL::Abstract
+
+=head1 AUTHOR
+
+Chisel Wright C&lt; &lt;&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">chisel.wright at users.berlios.de</A>&gt;&gt; &gt;
+
+=cut

Added: tags/parley-0.55/parley.yml
===================================================================
--- tags/parley-0.55/parley.yml	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/parley.yml	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,73 @@
+--- #YAML:1.0
+# DO NOT USE TABS FOR INDENTATION OR label/value SEPARATION!!!
+name:                       Parley
+default_uri:                /forum/list
+posts_per_page:             10
+threads_per_page:           25
+search_results_per_page:    25
+replies_have_own_subject:   0
+
+alerts:
+    from_name:      'Parley'
+    from_address:   '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">parley at localhost</A>'
+
+# comment out any log levels you don't want to see in your logs
+# 'info' and 'debug' are common choices for suppresing in a live environment
+log_levels:
+    - 'info'
+    - 'debug'
+    - 'warn'
+    - 'error'
+    - 'fatal'
+
+Model::ParleyDB:
+    schema_class: 'Parley::Schema'
+    connect_info:   
+        - 'dbi:Pg:dbname=parley;host=localhost'
+        - 'parley'
+        - ''
+        - AutoCommit: 1
+
+# emails; perldoc Catalyst::Plugin::Email
+# this passes options as an array :(
+email:
+    - SMTP
+    - localhost
+
+#--
+#-- LINES BELOW THIS SHOULDN'T NEED CHANGING
+#--
+
+# the default view to use
+default_view:         'TT'
+
+# authentiation settings; perldoc Catalyst::Plugin::Authentication::Store::DBIC
+authentication:
+    dbic:
+        user_class:         'Parley::Model::ParleyDB::Authentication'
+        user_field:         'username'
+        password_field:     'password'
+        password_type:      'hashed'
+        password_hash_type: 'MD5'
+
+# session settings; perldoc Catalyst::Plugin::Session::FastMmap
+session:
+    expires:    3600
+    storage:    '/tmp/parley.session'
+
+
+# template toolkit options
+View::TT:
+    EVAL_PERL:      '0'
+    PRE_PROCESS:    'header'
+    POST_PROCESS:   'footer'
+    POST_CHOMP:     '1'
+    PRE_CHOMP:      '0'
+    # comment out the following line to enable Template::Timer output in your
+    # template source
+    CONTEXT:        ''
+
+static:
+    ignore_extensions:
+        - asp
+        - php

Added: tags/parley-0.55/root/base/about/modules
===================================================================
--- tags/parley-0.55/root/base/about/modules	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/about/modules	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,39 @@
+
+&lt;h1&gt;Loaded modules with a version number&lt;/h1&gt;
+&lt;table&gt;
+[% FOREACH module = loaded_module_data.sort('name') %]
+[% IF module.version &amp;&amp; ! (module.version == '-1, set by base.pm') %]
+&lt;tr&gt;
+&lt;td&gt;[% module.name %]&lt;/td&gt;
+&lt;td&gt;[% module.version || '&lt;i&gt;undefined&lt;/i&gt;' %]&lt;/td&gt;
+&lt;/tr&gt;
+[% END %]
+[% END %]
+&lt;/table&gt;
+
+
+
+&lt;h1&gt;Loaded modules with no version number&lt;/h1&gt;
+&lt;table&gt;
+[% FOREACH module = loaded_module_data.sort('name') %]
+[% IF ! module.version %]
+&lt;tr&gt;
+&lt;td&gt;[% module.name %]&lt;/td&gt;
+&lt;td&gt;[% module.version || '&lt;i&gt;undefined&lt;/i&gt;' %]&lt;/td&gt;
+&lt;/tr&gt;
+[% END %]
+[% END %]
+&lt;/table&gt;
+
+
+&lt;h1&gt;Loaded modules with version set by base.pm&lt;/h1&gt;
+&lt;table&gt;
+[% FOREACH module = loaded_module_data.sort('name') %]
+[% IF module.version == '-1, set by base.pm' %]
+&lt;tr&gt;
+&lt;td&gt;[% module.name %]&lt;/td&gt;
+&lt;td&gt;[% module.version || '&lt;i&gt;undefined&lt;/i&gt;' %]&lt;/td&gt;
+&lt;/tr&gt;
+[% END %]
+[% END %]
+&lt;/table&gt;

Added: tags/parley-0.55/root/base/error/simple
===================================================================
--- tags/parley-0.55/root/base/error/simple	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/error/simple	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+&lt;h1&gt;An error has occurred&lt;/h1&gt;
+
+&lt;p&gt;
+The following error message was returned by the application:
+
+&lt;blockquote&gt;[% error.message %]&lt;/blockquote&gt;
+&lt;/p&gt;
+
+&lt;!-- offer the user the chance to return somewhere interesting --&gt;
+[% IF current_thread || current_forum %]
+&lt;ul&gt;
+    [% IF current_thread %]
+    [% IF authed_user %]
+    &lt;li&gt;Continue reading: &lt;a href=&quot;thread/next_post?thread=[%current_thread.id%]&quot;&gt;[%current_thread.subject%]&lt;/a&gt;&lt;/li&gt;
+    [% END %]
+    &lt;li&gt;Return to: &lt;a href=&quot;thread/view?thread=[%current_thread.id%]&quot;&gt;[%current_thread.subject%]&lt;/a&gt;&lt;/li&gt;
+    [% END %]
+
+    [% IF current_forum %]
+    &lt;li&gt;View all &lt;a href=&quot;forum/view?forum=[%current_forum.id%]&quot;&gt;[%current_forum.name%]&lt;/a&gt; threads&lt;/li&gt;
+    [% END %]
+&lt;/ul&gt;
+[% END %]

Added: tags/parley-0.55/root/base/footer
===================================================================
--- tags/parley-0.55/root/base/footer	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/footer	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+&lt;!-- Footer : Start --&gt;
+                &lt;/div&gt;&lt;!-- content div --&gt;
+            &lt;/div&gt;&lt;!-- wrapper div --&gt;
+
+            &lt;div id=&quot;navigation&quot;&gt;
+            &lt;p&gt; &nbsp; &lt;/p&gt;
+            &lt;!--
+                &lt;p&gt;Navigation&lt;/p&gt;
+                [%# PROCESS shared/navigation %]
+
+                &lt;p&gt;
+                &lt;a href=&quot;javascript:;&quot; onclick=&quot;search_dialog.show(); return false;&quot;&gt;Search&lt;/a&gt;
+                &lt;/p&gt;
+
+                &lt;p&gt;
+                &lt;a href=&quot;thread/recent&quot;&gt;Recently Updated Threads&lt;/a&gt;
+                &lt;/p&gt;
+
+                [% IF authed_user %]
+                &lt;p&gt;
+                &lt;a href=&quot;my/preferences&quot;&gt;Preferences&lt;/a&gt;
+                &lt;/p&gt;
+                [% END %]
+                --&gt;
+            &lt;/div&gt;&lt;!-- navigation div --&gt;
+
+            &lt;div id=&quot;extra&quot;&gt;
+            &lt;p&gt; &nbsp; &lt;/p&gt;
+                [%# PROCESS shared/user_status %]
+            &lt;/div&gt;&lt;!-- extra div --&gt;
+
+            &lt;div id=&quot;footer&quot;&gt;
+                &lt;p&gt;&copy; Chisel Wright 2006-2007. All Rights Reserved.&lt;/p&gt;
+            &lt;/div&gt;&lt;!-- footer div --&gt;
+
+
+            &lt;span style=&quot;display: block; float: right; margin-right: 20px;&quot;&gt;
+            &lt;a href=&quot;<A HREF="http://catalystframework.org">http://catalystframework.org</A>&quot;&gt;&lt;img
+                src=&quot;static/images/btn_88x31_powered.png&quot;
+                width=&quot;88&quot;
+                height=&quot;31&quot;
+                alt=&quot;Powered By Catalyst&quot;
+                style=&quot;border: none;&quot;
+                /&gt;&lt;/a&gt;
+            &lt;/span&gt;
+
+            [% INCLUDE shared/login_dialog %]
+            [% INCLUDE shared/search_dialog %]
+        &lt;/div&gt;&lt;!-- container div --&gt;
+
+    &lt;/body&gt;
+&lt;/html&gt;
+&lt;!-- Footer : End --&gt;
+

Added: tags/parley-0.55/root/base/forum/list
===================================================================
--- tags/parley-0.55/root/base/forum/list	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/forum/list	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+&lt;h1&gt;Forum List&lt;/h1&gt;
+
+&lt;table class=&quot;forum_list&quot;&gt;
+&lt;tbody&gt;
+    &lt;tr&gt;
+        &lt;th&gt;Forum&lt;/th&gt;
+        &lt;th&gt;Last Post&lt;/th&gt;
+        &lt;th&gt;Posts&lt;/th&gt;
+    &lt;/tr&gt;
+
+    [% WHILE (forum = forum_list.next) %]
+    &lt;tr&gt;
+        &lt;td&gt;
+            &lt;a href=&quot;forum/view?forum=[% forum.id %]&quot; class=&quot;forum_link&quot;&gt;[% forum.name %]&lt;/a&gt;
+            &lt;br /&gt;
+            &lt;span class=&quot;forum_description&quot;&gt;[% forum.description %]&lt;/span&gt;
+        &lt;/td&gt;
+        &lt;td&gt;
+            [% IF forum.last_post %]
+            [% nicedate(forum.last_post.created) %]
+            &lt;br /&gt;
+            &lt;span class=&quot;topic_creator&quot;&gt;posted by
+                &lt;span class=&quot;post_creator&quot;&gt;[% forum.last_post.creator.forum_name %]&lt;/span&gt;
+            &lt;/span&gt;
+            [% ELSE %]
+            &lt;br /&gt;
+            &lt;span class=&quot;topic_creator&quot;&gt;No posts&lt;/span&gt;
+            [% END %]
+        &lt;/td&gt;
+        &lt;td&gt;
+            [% forum.post_count %]
+        &lt;/td&gt;
+    &lt;/tr&gt;
+    [% END %]
+&lt;/tbody&gt;
+&lt;/table&gt;

Added: tags/parley-0.55/root/base/forum/view
===================================================================
--- tags/parley-0.55/root/base/forum/view	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/forum/view	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,101 @@
+&lt;h1&gt;[% current_forum.name %] : List Of Active Threads&lt;/h1&gt;
+
+&lt;!-- NO LONGER NEEDED - IT'S PART OF THE MENUS NOW
+&lt;p style=&quot;font-size: small;&quot;&gt;
+&lt;a href=&quot;thread/add?forum=[% current_forum.id %]&quot;&gt;[Start A New Topic]&lt;/a&gt;
+&lt;a href=&quot;javascript:;&quot; onclick=&quot;search_dialog.show(); return false;&quot;&gt;[Search]&lt;/a&gt;
+--&gt;
+
+
+[%- IF thread_list.count &gt; 0 %]
+[% PROCESS shared/pager_advanced %]
+&lt;table class=&quot;forum_view&quot;&gt;
+  &lt;tr&gt;
+    &lt;th&gt;&nbsp;&lt;/th&gt;
+    &lt;th&gt;Topic&lt;/th&gt;
+    &lt;th&gt;Last Post&lt;/th&gt;
+    &lt;th&gt;Replies&lt;/th&gt;
+    &lt;th&gt;Views&lt;/th&gt;
+    [% IF 0 &amp;&amp; moderator %]&lt;th&gt;Actions&lt;/th&gt;[% END %]
+  &lt;/tr&gt;
+  [%- WHILE (thread = thread_list.next) %]
+  &lt;tr&gt;
+    &lt;td width=&quot;36&quot;&gt;
+    &lt;!-- interesting things about the thread; sticky, locked, etc --&gt;
+    [%- IF thread.sticky %]
+    &lt;img src=&quot;static/images/sticky.png&quot; alt=&quot;Sticky&quot; title=&quot;Sticky Topic&quot; width=&quot;16&quot; height=&quot;16&quot; /&gt;
+    [%- END %]
+    [%- IF thread.locked %]
+    &lt;img src=&quot;static/images/locked.png&quot; alt=&quot;Locked&quot; title=&quot;Locked Topic&quot; width=&quot;16&quot; height=&quot;16&quot; /&gt;
+    [%- END %]
+    &lt;/td&gt;
+
+    &lt;td&gt;
+    &lt;a href=&quot;thread/view?thread=[% thread.id %]&quot; class=&quot;topic_link&quot;&gt;[% ForumCode.escape(thread.subject) %]&lt;/a&gt;
+    &lt;br /&gt;
+    &lt;span class=&quot;forum_mini_pager&quot;&gt;
+        [%- IF authed_user || mini_pager %]
+        [
+            [%- IF authed_user %]
+            &lt;a href=&quot;thread/next_post?thread=[% thread.id %]&quot;&gt;Continue&lt;/a&gt;
+            [%- END %]
+        ]
+        [%- END %]
+    &lt;/span&gt;
+    &lt;span class=&quot;topic_creator&quot;&gt;created by
+        &lt;span class=&quot;post_creator&quot;&gt;[% thread.creator.forum_name %]&lt;/span&gt;
+    &lt;/span&gt;
+    &lt;/td&gt;
+
+    &lt;td&gt;
+     [% nicedate(thread.last_post.created) %]
+     &lt;br /&gt;
+     &lt;span class=&quot;topic_creator&quot;&gt;posted by
+        &lt;span class=&quot;post_creator&quot;&gt;[% thread.last_post.creator.forum_name %]&lt;/span&gt;
+     &lt;/span&gt;
+    &lt;/td&gt;
+
+    &lt;td style=&quot;text-align: center;&quot;&gt;
+      [%# number of replies is one less than the number of posts %]
+      [% thread.post_count - 1 %]
+    &lt;/td&gt;
+
+    &lt;td style=&quot;text-align: center;&quot;&gt;
+      [% thread.view_count %]
+    &lt;/td&gt;
+
+    [% IF 0 &amp;&amp; moderator %]
+        &lt;td&gt;
+            &lt;!-- add/remove sticky --&gt;
+            [% IF thread.sticky %]
+            &lt;a href=&quot;admin/sticky?thread=[% thread.id %]&amp;sticky=0&quot;&gt;{S-}&lt;/a&gt;
+            [% ELSE %]
+            &lt;a href=&quot;admin/sticky?thread=[% thread.id %]&quot;&gt;{S+}&lt;/a&gt;
+            [% END %]
+
+            &lt;!-- add/remove locked --&gt;
+            [% IF thread.locked %]
+            &lt;a href=&quot;admin/lock?thread=[% thread.id %]&amp;lock=0&quot;&gt;{L-}&lt;/a&gt;
+            [% ELSE %]
+            &lt;a href=&quot;admin/lock?thread=[% thread.id %]&quot;&gt;{L+}&lt;/a&gt;
+            [% END %]
+
+            &lt;!-- add/removed active --&gt;
+            [% IF thread.active %]{A-}[% ELSE %]{A+}[% END %]
+        &lt;/td&gt;
+    [% END %]
+    &lt;/tr&gt;
+  [% END %]
+    &lt;tr&gt;
+        &lt;td colspan=&quot;5&quot;&gt;
+            [% PROCESS shared/moderator_list %]
+        &lt;/td&gt;
+    &lt;/tr&gt;
+&lt;/table&gt;
+
+
+[% PROCESS shared/pager_advanced %]
+[% ELSE %]
+  No active threads in this forum
+[% END %]
+

Added: tags/parley-0.55/root/base/header
===================================================================
--- tags/parley-0.55/root/base/header	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/header	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,84 @@
+&lt;?xml version=&quot;1.0&quot;?&gt;
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd</A>&quot;&gt;
+
+[% PROCESS shared/useful_tt_stuff %]
+
+&lt;!-- Header : Start --&gt;
+&lt;html&gt;
+    &lt;head&gt;
+        &lt;base href=&quot;[% c.req.base %]&quot; /&gt;
+        &lt;title&gt;
+            [% c.config.name %]
+
+            [%# Show version if we're debugging %]
+            [% IF c.debug %]
+            ([% c.config.version %])
+            [% END %]
+
+            [%# Show custom page title if we have one %]
+            [% IF page_title %]
+             : [% page_title %]
+            [%# Show thread name if we have one %]
+            [% ELSIF current_thread %]
+             : [% current_thread.subject %]
+            [%# Show forum name if we have one %]
+            [% ELSIF current_forum %]
+             : [% current_forum.name %]
+            [% END %]
+        &lt;/title&gt;
+        &lt;meta name=&quot;author&quot; content=&quot;Chisel Wright&quot; /&gt;
+        &lt;link rel=&quot;shortcut icon&quot; href=&quot;[% c.request.base %]/favicon.ico&quot; type=&quot;image/x-icon&quot; /&gt;
+        &lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; title=&quot;Default&quot; href=&quot;[% c.request.base %]/css/common.css&quot; /&gt;
+        &lt;link type=&quot;text/css&quot; rel=&quot;stylesheet&quot; title=&quot;Default&quot; href=&quot;[% c.request.base %]/css/layout27.css&quot; /&gt;
+
+        &lt;!-- Dojo Magic --&gt;
+        &lt;script type=&quot;text/javascript&quot;&gt;
+            var djConfig = { isDebug: true };
+        &lt;/script&gt;
+        &lt;script type=&quot;text/javascript&quot; src=&quot;[% c.request.base %]/static/magic/dojo.js&quot;&gt;&lt;/script&gt;
+        &lt;script type=&quot;text/javascript&quot;&gt;
+            dojo.require(&quot;dojo.widget.Menu2&quot;);
+            dojo.require(&quot;dojo.lfx.*&quot;);         // animations and eye candy
+            dojo.require(&quot;dojo.widget.Dialog&quot;);
+            dojo.require(&quot;dojo.widget.Button&quot;);
+
+            dojo.require(&quot;dojo.widget.TabContainer&quot;);
+            dojo.require(&quot;dojo.widget.LinkPane&quot;);
+            dojo.require(&quot;dojo.widget.ContentPane&quot;);
+            dojo.require(&quot;dojo.widget.LayoutContainer&quot;);
+
+
+            dojo.require(&quot;dojo.widget.InlineEditBox&quot;);
+            dojo.require(&quot;dojo.event.*&quot;);
+            dojo.hostenv.writeIncludes();
+        &lt;/script&gt;
+    &lt;/head&gt;
+
+    &lt;body&gt;
+        &lt;div id=&quot;container&quot;&gt;
+            &lt;div id=&quot;header&quot;&gt;
+                &lt;h1&gt;Parley&lt;/h1&gt;
+            &lt;/div&gt;&lt;!-- header div --&gt;
+
+            &lt;div id=&quot;userinfo_box&quot;&gt;
+                Current User:
+                [% IF authed_user %]
+                &lt;em&gt;[% authed_user.forum_name %]&lt;/em&gt;
+                [% ELSE %]
+                &lt;em&gt;Guest User&lt;/em&gt;
+                [% END %]
+            &lt;/div&gt;
+        [% PROCESS menu/menubar %]
+
+
+            &lt;div id=&quot;wrapper&quot;&gt;
+                &lt;div id=&quot;content&quot;&gt;
+
+                    [% IF view.error.messages %]
+                    &lt;div class=&quot;error_messages&quot;&gt;
+                        [% FOREACH msg IN view.error.messages %]
+                        [% msg %]&lt;br /&gt;
+                        [% END %]
+                    &lt;/div&gt;
+                    [% END %]
+&lt;!-- Header : End --&gt;

Added: tags/parley-0.55/root/base/help/contents
===================================================================
--- tags/parley-0.55/root/base/help/contents	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/help/contents	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,14 @@
+&lt;h1&gt;Help Contents&lt;/h1&gt;
+
+&lt;p&gt;Obviously this page needs a bit more content, but we all have to start
+somewhere.&lt;/p&gt;
+
+&lt;h2&gt;General Help&lt;/h2&gt;
+&lt;ol start=&quot;1&quot;&gt;
+&lt;li&gt;&lt;a href=&quot;help/faq&quot;&gt;Frequently Asked Questions&lt;/a&gt;&lt;/li&gt;
+&lt;/ol&gt;
+
+&lt;h2&gt;Posting&lt;/h2&gt;
+&lt;ol start=&quot;2&quot;&gt;
+    &lt;li&gt;&lt;a href=&quot;help/formatting_posts&quot;&gt;Adding (ForumCode) formating to posts&lt;/a&gt;&lt;/li&gt;
+&lt;/ol&gt;

Added: tags/parley-0.55/root/base/help/faq
===================================================================
--- tags/parley-0.55/root/base/help/faq	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/help/faq	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,47 @@
+&lt;h1&gt;Frequently Asked Questions&lt;/h1&gt;
+
+&lt;p&gt;This page should answer common queries and problems.
+If it doesn't you're just being difficult *wink*&lt;/p&gt;
+
+&lt;h3&gt;General Questions&lt;/h3&gt;
+
+&lt;ol class=&quot;help&quot;&gt;
+    &lt;li&gt;Does the world need another piece of forum/message board software?
+    &lt;br /&gt;
+    &lt;em&gt;
+    Possibly not. This is a personal quest for me. if it's useful to someone
+    else that's even better.
+    I've always thought that the Perl landscape was missing a well-written
+    and functional forum application.
+    Add to that the emergence of the
+    &lt;a href=&quot;<A HREF="http://catalystframework.org/">http://catalystframework.org/</A>&quot;&gt;Catalyst framework&lt;/a&gt;
+    and a desire to explore the benefits of this project and you've got Parley.
+    &lt;/em&gt;
+    &lt;/li&gt;
+&lt;/ol&gt;
+
+&lt;h3&gt;Technical Questions&lt;/h3&gt;
+
+&lt;ol class=&quot;help&quot;&gt;
+    &lt;li&gt;What software does this forum run on?
+    &lt;br /&gt;
+    &lt;em&gt;
+    The core elements of the application are:
+    &lt;a href=&quot;<A HREF="http://perl.com/">http://perl.com/</A>&quot;&gt;Perl&lt;/a&gt;,
+    &lt;a href=&quot;<A HREF="http://postgresql.org/">http://postgresql.org/</A>&quot;&gt;PostgreSQL&lt;/a&gt;
+    and
+    &lt;a href=&quot;<A HREF="http://template-toolkit.org/">http://template-toolkit.org/</A>&quot;&gt;Template Toolkit&lt;/a&gt;.
+    These elements are all tied together using the
+    &lt;a href=&quot;<A HREF="http://catalystframework.org/">http://catalystframework.org/</A>&quot;&gt;Catalyst framework&lt;/a&gt;.
+    &lt;/em&gt;
+    &lt;/li&gt;
+
+    &lt;li&gt;PostgreSQL?! What about MySQL, SQLite, ...?
+    &lt;br /&gt;
+    &lt;em&gt;
+    I prefer PostgreSQL. I don't have the time or energy to make the application
+    compatible with everyone's preferred database. I'll happily accept patches
+    that don't break the application's coupling with PostgreSQL.
+    &lt;/em&gt;
+    &lt;/li&gt;
+&lt;/ol&gt;

Added: tags/parley-0.55/root/base/help/formatting_posts
===================================================================
--- tags/parley-0.55/root/base/help/formatting_posts	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/help/formatting_posts	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,193 @@
+&lt;h1&gt;Formatting Posts&lt;/h1&gt;
+
+&lt;p&gt;Allowing raw HTML markup in posts leads to a very special
+world of pain. With that in mind a form of markup inspired by
+BBCode [&lt;b&gt;link?&lt;/b&gt;] was developed for this project. As it's
+not an identical implementation of BBCode it has it's own name
+- &lt;i&gt;ForumCode&lt;/i&gt;&lt;/p&gt;
+
+&lt;h2&gt;Simple Formatting&lt;/h2&gt;
+
+&lt;h3&gt;Bold, Italic and Underline&lt;/h3&gt;
+&lt;ul class=&quot;help&quot;&gt;
+    &lt;li&gt;
+        To make a section of text appear in &lt;b&gt;bold&lt;/b&gt; use
+        &lt;code&gt;[b]...[/b]&lt;/code&gt;:
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[b]This is bold text[/b]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[b]This is bold text[/b]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        To make a section of text appear in &lt;em&gt;italics&lt;/em&gt; use
+        &lt;code&gt;[i]...[/i]&lt;/code&gt;:
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[i]This is emphasised text[/i]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[i]This is emphasised text[/i]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        To make a section of text appear &lt;em&gt;underlined&lt;/em&gt; use
+        &lt;code&gt;[u]...[/u]&lt;/code&gt;:
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[u]This is emphasised text[/u]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[u]This is underlined text[/u]') %]
+    &lt;/li&gt;
+&lt;/ul&gt;
+
+&lt;h3&gt;Making Lists&lt;/h3&gt;
+&lt;p&gt;There are two types of list, ordered - the items are numbered, and unordered - the
+items are bulleted. Lists are always enclosed by &lt;code&gt;[list]...[/list]&lt;/code&gt; markers.
+The type of list you create is dependant on whether you use &lt;code&gt;[1]&lt;/code&gt; or &lt;code&gt;[*]&lt;/code&gt;
+for list items.
+&lt;/p&gt;
+&lt;ul class=&quot;help&quot;&gt;
+    &lt;li&gt;
+        To create an &lt;em&gt;ordered list&lt;/em&gt; use &lt;code&gt;[1]&lt;/code&gt;
+        to mark list items.
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[list]&lt;br /&gt;
+                [1]first&lt;br /&gt;
+                [1]second&lt;br /&gt;
+                [1]third&lt;br /&gt;
+        [/list]&lt;/code&gt;&lt;/q&gt;
+        &lt;br /&gt;
+        produces:
+        [% ForumCode.forumcode('[list]
+        [1]first
+        [1]second
+        [1]third
+        [/list]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        To create an &lt;em&gt;unordered list&lt;/em&gt; use &lt;code&gt;[*]&lt;/code&gt;
+        to mark list items.
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[list]&lt;br /&gt;
+                [*]apple&lt;br /&gt;
+                [*]orange&lt;br /&gt;
+                [*]banana&lt;br /&gt;
+        [/list]&lt;/code&gt;&lt;/q&gt;
+        &lt;br /&gt;
+        produces:
+        [% ForumCode.forumcode('[list]
+        [*]apple
+        [*]orange
+        [*]banana
+        [/list]') %]
+    &lt;/li&gt;
+&lt;/ul&gt;
+&lt;p&gt;&lt;b&gt;NOTE:&lt;/b&gt; Separating elements with line-breaks is required.
+&lt;q&gt;&lt;code&gt;[list] [*]apple [*]orange [*]banana [/list]&lt;/code&gt;&lt;/q&gt; will output:&lt;br /&gt;
+[% ForumCode.forumcode('[list] [*]apple [*]orange [*]banana [/list]') %]
+&lt;/p&gt;
+
+&lt;h3&gt;Linking to external resources&lt;/h3&gt;
+&lt;p&gt;The forum software does NOT automatically hunt out all text resembling URLs
+to turn them into clickable links. If you want a clickable link in a post
+you need to use the [url]...[/url] code:&lt;/p&gt;
+&lt;ul class=&quot;help&quot;&gt;
+    &lt;li&gt;
+        To make a URL appear as a clickable link use
+        &lt;code&gt;[url]<A HREF="http://...[/url">http://...[/url</A>]&lt;/code&gt;:
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[url]<A HREF="http://google.com/[/url">http://google.com/[/url</A>]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[url]<A HREF="http://google.com/[/url">http://google.com/[/url</A>]') %]
+    &lt;/li&gt;
+&lt;/ul&gt;
+
+&lt;p&gt;You may also make a section of text appear as a named link by
+using the &quot;name=...&quot; attribute in the code block:&lt;/p&gt;
+&lt;ul class=&quot;help&quot;&gt;
+    &lt;li&gt;
+        To make a URL appear as a names clickable link use
+        &lt;code&gt;[url &lt;em&gt;name=&quot;XXX&quot;&lt;/em&gt;]<A HREF="http://...[/url">http://...[/url</A>]&lt;/code&gt;:
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[url name=&quot;Google&quot;]<A HREF="http://google.com/[/url">http://google.com/[/url</A>]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[url name=&quot;Google&quot;]<A HREF="http://google.com/[/url">http://google.com/[/url</A>]') %]
+    &lt;/li&gt;
+&lt;/ul&gt;
+
+&lt;p&gt;As well as inserting clickable links, you may also insert images into posts.&lt;/p&gt;
+&lt;ul class=&quot;help&quot;&gt;
+    &lt;li&gt;
+        To make an image appear in a posting use
+        &lt;code&gt;[img]...[/img]&lt;/code&gt;:
+        &lt;br /&gt;
+        &lt;em&gt;e.g.&lt;/em&gt;
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[img][%c.request.base%]static/images/btn_88x31_powered.png[/img]&lt;/code&gt;&lt;/q&gt;
+        produces
+        &lt;br /&gt;
+        [% ForumCode.forumcode(&quot;[img]${c.request.base}static/images/btn_88x31_powered.png[/img]&quot;) %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        You may also include extra attributes such as
+        &lt;code&gt;title=&lt;/code&gt;, &lt;code&gt;alt=&lt;/code&gt;, etc.
+        Research the HTML &lt;img&gt; tag [&lt;b&gt;link?&lt;/b&gt;]
+        for the full list of attributes.
+        &lt;br /&gt;
+        &lt;q&gt;&lt;code&gt;[img title='Powered by Catalyst' width='50'][%c.request.base%]static/images/btn_88x31_powered.png[/img]&lt;/code&gt;&lt;/q&gt;
+        produces
+        &lt;br /&gt;
+        [% ForumCode.forumcode(&quot;[img title='Powered by Catalyst' width='50']${c.request.base}static/images/btn_88x31_powered.png[/img]&quot;) %]
+    &lt;/li&gt;
+&lt;/ul&gt;
+
+&lt;h3&gt;Colouring&lt;/h3&gt;
+&lt;p&gt;One surefire way to annoy people to the point where they'd like to remove
+your internal organs with a spoon is to use lots of unnecessary colours in your posts.
+The ForumCode to invoke this reaction is
+&lt;code&gt;[colour=&lt;em&gt;code&lt;/em&gt;]...[/colour]&lt;/code&gt;. In the spirit of furthering international
+relations, those of you with a preference for American spellings may use &lt;code&gt;[color=&lt;em&gt;code&lt;/em&gt;]...[/color]&lt;/code&gt;.
+&lt;/p&gt;
+&lt;p&gt;&lt;code&gt;&lt;em&gt;code&lt;/em&gt;&lt;/code&gt; can be any of the following: red, orange, yellow, green, blue, black, white.&lt;/p&gt;
+&lt;p&gt;&lt;code&gt;&lt;em&gt;code&lt;/em&gt;&lt;/code&gt; can also be any #RGB or #RRGGBB HTML colour values.&lt;/p&gt;
+
+&lt;em&gt;e.g.&lt;/em&gt;
+&lt;ul class=&quot;help&quot;&gt;
+    &lt;li&gt;
+        &lt;q&gt;&lt;code&gt;[colour=red]Red Text[/colour]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[colour=red]Red Text[/colour]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        &lt;q&gt;&lt;code&gt;[colour=#f00]Red Text[/colour]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[colour=#f00]Red Text[/colour]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        &lt;q&gt;&lt;code&gt;[colour=#ff0000]Red Text[/colour]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[colour=#ff0000]Red Text[/colour]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        &lt;q&gt;&lt;code&gt;[colour=blue]Blue Text[/colour]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[colour=blue]Blue Text[/colour]') %]
+    &lt;/li&gt;
+    &lt;li&gt;
+        &lt;q&gt;&lt;code&gt;[colour=white]White Text[/colour]&lt;/code&gt;&lt;/q&gt;
+        produces
+        [% ForumCode.forumcode('[colour=white]White Text[/colour]') %]
+        &lt;br /&gt;(white-on-white text, useful for novice spies; highlight the
+        line to see the white-on-white text)
+    &lt;/li&gt;
+&lt;/ul&gt;

Added: tags/parley-0.55/root/base/help/unknown
===================================================================
--- tags/parley-0.55/root/base/help/unknown	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/help/unknown	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,7 @@
+&lt;h1&gt;Help Item Not Found&lt;/h1&gt;
+
+&lt;p&gt;&lt;i&gt;[% c.request.uri %]&lt;/i&gt; doesn't relate to a known
+page in the help system.&lt;/p&gt;
+
+&lt;p&gt;See if you can find what you want from the
+&lt;a href=&quot;help&quot;&gt;contents&lt;/a&gt; page.&lt;/p&gt;

Added: tags/parley-0.55/root/base/menu/left/main
===================================================================
--- tags/parley-0.55/root/base/menu/left/main	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/menu/left/main	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,22 @@
+&lt;p&gt;
+    &lt;!-- General Stuff --&gt;
+    &lt;a href=&quot;thread/recent&quot;&gt;Recent Threads&lt;/a&gt;
+&lt;/p&gt;
+
+&lt;p&gt;
+    &lt;!-- My --&gt;
+
+    &lt;!-- Preferences --&gt;
+    &lt;a href=&quot;my/preferences&quot;&gt;Preferences&lt;/a&gt;
+&lt;/p&gt;
+
+&lt;p&gt;
+    &lt;!-- Admin --&gt;
+    &lt;a href=&quot;admin&quot;&gt;Admin&lt;/a&gt;
+&lt;/p&gt;
+
+&lt;p&gt;
+    &lt;!-- Searching --&gt;
+    &lt;a href=&quot;javascript:;&quot; onclick=&quot;search_dialog.show(); return false;&quot;&gt;Search&lt;/a&gt;
+    [% INCLUDE shared/search_dialog %]
+&lt;/p&gt;

Added: tags/parley-0.55/root/base/menu/menubar
===================================================================
--- tags/parley-0.55/root/base/menu/menubar	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/menu/menubar	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,69 @@
+&lt;!-- start : menubar --&gt;
+[% IF NOT current_forum %][% SET forum_disabled='disabled=&quot;true&quot;' %][% END %]
+[% IF NOT current_thread %][% SET thread_disabled='disabled=&quot;true&quot;' %][% END %]
+
+&lt;div dojoType=&quot;PopupMenu2&quot; widgetId=&quot;menu_go&quot;&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Main Page&quot; onClick=&quot;document.location.href='[% c.request.base %]';&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Forum Summary&quot; onClick=&quot;document.location.href='forum/list';&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Recently Updated Threads&quot; onClick=&quot;document.location.href='thread/recent';&quot;&gt;&lt;/div&gt;
+
+    &lt;div dojoType=&quot;MenuSeparator2&quot;&gt;&lt;/div&gt;
+    [% WHILE (forum = available_forums.next) %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;[% forum.name %]&quot; onClick=&quot;document.location.href='forum/view?forum=[%forum.id%]';&quot;&gt;&lt;/div&gt;
+    [% END %]
+&lt;/div&gt;
+
+&lt;div dojoType=&quot;PopupMenu2&quot; widgetId=&quot;menu_forum&quot;&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; [%forum_disabled%] caption=&quot;View Threads&quot; onClick=&quot;document.location.href='forum/view?forum=[%current_forum.id%]';&quot;&gt;&lt;/div&gt;
+    &lt;div dojoType=&quot;MenuSeparator2&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; [%forum_disabled%] caption=&quot;Create New Thread&quot; onClick=&quot;document.location.href = 'thread/add?forum=[%current_forum.id%]';&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;
+
+&lt;div dojoType=&quot;PopupMenu2&quot; widgetId=&quot;menu_thread&quot;&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; [%thread_disabled%] caption=&quot;Add Reply&quot; onClick=&quot;document.location.href='thread/reply?thread=[%current_thread.id%]';&quot;&gt;&lt;/div&gt;
+    [%- IF watching_thread %]
+	&lt;div dojoType=&quot;MenuItem2&quot; [%thread_disabled%] caption=&quot;Remove Watch&quot; onClick=&quot;document.location.href='thread/watch?thread=[% current_thread.id %]&amp;page=[% page.current_page %]&amp;watch=0';&quot;&gt;&lt;/div&gt;
+    [%- ELSE %]
+	&lt;div dojoType=&quot;MenuItem2&quot; [%thread_disabled%] caption=&quot;Add Watch&quot; onClick=&quot;document.location.href='thread/watch?thread=[% current_thread.id %]&amp;page=[% page.current_page %]&amp;watch=1'&quot;&gt;&lt;/div&gt;
+    [%- END %]
+&lt;/div&gt;
+
+&lt;div dojoType=&quot;PopupMenu2&quot; widgetId=&quot;menu_my&quot;&gt;
+    [% IF authed_user %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;My Preferences&quot; onClick=&quot;document.location.href='my/preferences';&quot;&gt;&lt;/div&gt;
+    &lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;My Watched Threads&quot; onClick=&quot;document.location.href='thread/watches';&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;My Profile&quot; onClick=&quot;document.location.href='user/profile?user=[%authed_user.id%]';&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Logout&quot; onClick=&quot;document.location.href='user/logout';&quot;&gt;&lt;/div&gt;
+    [% ELSE %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Login&quot; onClick=&quot;login_dialog.show(); dojo.byId('username').focus(); return false;&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Register&quot; onClick=&quot;document.location.href='user/signup';&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Password Reminder&quot; onClick=&quot;document.location.href='user/password/forgotten';&quot;&gt;&lt;/div&gt;
+    [% END %]
+&lt;/div&gt;
+
+&lt;div dojoType=&quot;PopupMenu2&quot; widgetId=&quot;menu_moderate&quot;&gt;
+    [% IF current_thread.locked %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Unlock Thread&quot; onClick=&quot;document.location.href='admin/lock?thread=[%current_thread.id%]&amp;lock=0';&quot; [% thread_disabled %]&gt;&lt;/div&gt;
+    [% ELSE %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Lock Thread&quot; onClick=&quot;document.location.href='admin/lock?thread=[%current_thread.id%]';&quot; [% thread_disabled %]&gt;&lt;/div&gt;
+    [% END %]
+
+    [% IF current_thread.sticky %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Unstick Thread&quot; onClick=&quot;document.location.href='admin/sticky?thread=[%current_thread.id%]&amp;sticky=0';&quot; [% thread_disabled %]&gt;&lt;/div&gt;
+    [% ELSE %]
+	&lt;div dojoType=&quot;MenuItem2&quot; caption=&quot;Stick Thread&quot; onClick=&quot;document.location.href='admin/sticky?thread=[%current_thread.id%]';&quot; [% thread_disabled %]&gt;&lt;/div&gt;
+    [% END %]
+&lt;/div&gt;
+
+&lt;div dojoType=&quot;MenuBar2&quot;&gt;
+	&lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Go To ...&quot;    submenuId=&quot;menu_go&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Forum&quot;        submenuId=&quot;menu_forum&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Thread&quot;       submenuId=&quot;menu_thread&quot;&gt;&lt;/div&gt;
+    &lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Search&quot;       onClick=&quot;search_dialog.show();&quot;&gt;&lt;/div&gt;
+	&lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Me&quot;           submenuId=&quot;menu_my&quot;&gt;&lt;/div&gt;
+    [% IF moderator %]
+	&lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Moderate&quot;     submenuId=&quot;menu_moderate&quot;&gt;&lt;/div&gt;
+    [% END %]
+	&lt;div dojoType=&quot;MenuBarItem2&quot; caption=&quot;Help&quot; onClick=&quot;document.location.href='help';&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;
+&lt;!-- end :menubar --&gt;

Added: tags/parley-0.55/root/base/menu/statusbar
===================================================================
--- tags/parley-0.55/root/base/menu/statusbar	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/menu/statusbar	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,44 @@
+&lt;!-- status bar : start --&gt;
+
+&lt;table width=&quot;100%&quot;&gt;
+        &lt;tr&gt;
+                &lt;td width=&quot;60%&quot; class=&quot;left&quot;&gt;
+                    &lt;a href=&quot;forum/list&quot;&gt;Home&lt;/a&gt;
+                    [% IF current_forum %]
+                      &raquo;
+                      &lt;a href=&quot;forum/view?forum=[% current_forum.id %]&quot;&gt;[% current_forum.name %]&lt;/a&gt;
+                      [% IF current_thread %]
+                        &raquo;
+                        &lt;a href=&quot;thread/view?thread=[% current_thread.id %]&quot;&gt;[% ForumCode.escape(current_thread.subject) %]&lt;/a&gt;
+                      [% END %]
+                    [% END %]
+                &lt;/td&gt;
+
+                &lt;td width=&quot;40%&quot; class=&quot;right&quot;&gt;
+                        [% IF (authed_user) %]
+                        Logged in as &lt;b&gt;[% authed_user.first_name %] [% authed_user.last_name %]&lt;/b&gt;
+                        [% UNLESS authed_user.authentication.authenticated %]
+                        (&lt;b&gt;&lt;i&gt;Not Authenticated&lt;/i&gt;&lt;/b&gt;)
+                        [% END %]
+                        &lt;i&gt;[
+                                &lt;a href=&quot;user/logout&quot;&gt;Logout&lt;/a&gt;
+                        ]&lt;/i&gt;
+                        [% ELSE %]
+            &lt;i&gt;[
+            &lt;a href=&quot;javascript:;&quot; onclick=&quot;login_dialog.show(); return false;&quot;&gt;Login&lt;/a&gt;
+            |
+            &lt;a href=&quot;user/signup&quot;&gt;Signup&lt;/a&gt;
+            ]&lt;/i&gt;
+                        [% END %] [%# authed_user end %]
+
+
+                &lt;/td&gt;
+
+                &lt;td&gt;
+                &lt;/td&gt;
+        &lt;/tr&gt;
+&lt;/table&gt;
+
+[% INCLUDE shared/login_dialog %]
+
+&lt;!-- status bar : end --&gt;

Added: tags/parley-0.55/root/base/my/preferences
===================================================================
--- tags/parley-0.55/root/base/my/preferences	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/preferences	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,37 @@
+&lt;h1&gt;Your preferences&lt;/h1&gt;
+
+[% IF view.error.message %]
+    [% view.error.message %]
+    &lt;ul&gt;
+        [% FOREACH message IN view.error.messages %]
+            &lt;li&gt;[% message %]&lt;/li&gt;
+        [% END %]
+    &lt;/ul&gt;
+[% END %]
+
+&lt;p&gt;
+&lt;div id=&quot;mainTabContainer&quot; dojoType=&quot;TabContainer&quot; style=&quot;width: 100%; height: 300px&quot; selectedChild=&quot;[% c.flash.show_pref_tab || 'tab_you' %]&quot; &gt;
+    &lt;div id=&quot;tab_you&quot; dojoType=&quot;ContentPane&quot; label=&quot;Your Details&quot;&gt;
+        [% PROCESS my/tab_you %]
+    &lt;/div&gt;
+
+    &lt;div id=&quot;tab_time&quot; dojoType=&quot;ContentPane&quot; label=&quot;Time&quot;&gt;
+        [% PROCESS my/tab_time %]
+    &lt;/div&gt;
+
+    &lt;div id=&quot;tab_notify&quot; dojoType=&quot;ContentPane&quot; label=&quot;Notifications&quot;&gt;
+        [% PROCESS my/tab_notifications %]
+    &lt;/div&gt;
+
+    &lt;div id=&quot;tab_avatar&quot; dojoType=&quot;ContentPane&quot; label=&quot;Avatar&quot;&gt;
+        [% PROCESS my/tab_avatar %]
+    &lt;/div&gt;
+&lt;/div&gt;
+
+[% IF c.session.my_pref_came_from %]
+&lt;p&gt;
+&lt;a href=&quot;[% c.session.my_pref_came_from %]&quot;&gt;Return to the forum&lt;/a&gt;
+&lt;/p&gt;
+[% ELSE %]
+&lt;p&gt;&nbsp;&lt;/p&gt;
+[% END %]

Added: tags/parley-0.55/root/base/my/selectplace_ajaxresult
===================================================================
--- tags/parley-0.55/root/base/my/selectplace_ajaxresult	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/selectplace_ajaxresult	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,5 @@
+&lt;select id=&quot;[% select.id %]&quot; name=&quot;[% select.id %]&quot;&gt;
+  [% FOREACH item=select.items %]
+  &lt;option value=&quot;[% item %]&quot;&gt;[% item %]&lt;/option&gt;
+  [% END %]
+&lt;/select&gt;

Added: tags/parley-0.55/root/base/my/tab_avatar
===================================================================
--- tags/parley-0.55/root/base/my/tab_avatar	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/tab_avatar	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+&lt;!-- preferences : tab_you --&gt;
+
+&lt;form action=&quot;my/preferences/update&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;form_name&quot; value=&quot;user_avatar&quot;&gt;
+    &lt;table class=&quot;user_profile&quot;&gt;
+        &lt;thead&gt;
+            &lt;tr&gt;
+                &lt;td width=&quot;150&quot; align=&quot;center&quot;&gt;
+                    Current Avatar
+                &lt;/td&gt;
+                &lt;td&gt;
+                    &nbsp;
+                &lt;/td&gt;
+            &lt;/tr&gt;
+        &lt;/thead&gt;
+
+        &lt;tbody&gt;
+            &lt;tr&gt;
+                &lt;td width=&quot;150&quot; align=&quot;center&quot;&gt;
+                    [% INCLUDE shared/user_avatar person=authed_user %]
+                &lt;/td&gt;
+                &lt;td&gt;
+                    Change your avatar image by selecting a file and clicking
+                    the Upload button below:
+                    &lt;br /&gt;
+
+                    &lt;input type=&quot;file&quot; id=&quot;avatar_file&quot; name=&quot;avatar_file&quot; /&gt;
+
+                    &lt;input type=&quot;submit&quot; value=&quot;Upload&quot; style=&quot;float: right;&quot;/&gt;
+                &lt;/td&gt;
+            &lt;/tr&gt;
+        &lt;/tbody&gt;
+    &lt;/table&gt;
+&lt;/form&gt;
+
+&lt;!-- (end) preferences : tab_you --&gt;

Added: tags/parley-0.55/root/base/my/tab_notifications
===================================================================
--- tags/parley-0.55/root/base/my/tab_notifications	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/tab_notifications	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,30 @@
+&lt;!-- preferences : notification tab --&gt;
+
+&lt;form action=&quot;my/preferences/update&quot; method=&quot;POST&quot; name=&quot;notifications&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;form_name&quot; value=&quot;notifications&quot;&gt;
+    &lt;table class=&quot;prefs_notification&quot;&gt;
+        &lt;tbody&gt;
+            &lt;tr&gt;
+                &lt;td&gt;
+                    &lt;input type=&quot;checkbox&quot; name=&quot;watch_on_post&quot; value=&quot;1&quot; [% IF authed_user.preference.watch_on_post %]checked=&quot;checked&quot; [% END %] /&gt;
+                    Automatically add watches for new posts
+                &lt;/td&gt;
+            &lt;/tr&gt;
+            &lt;tr&gt;
+                &lt;td&gt;
+                    &lt;input type=&quot;checkbox&quot; name=&quot;notify_thread_watch&quot; value=&quot;1&quot; [% IF authed_user.preference.notify_thread_watch %]checked=&quot;checked&quot; [% END %] /&gt;
+                    Receive email notification for watched threads
+                &lt;/td&gt;
+            &lt;/tr&gt;
+
+            &lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;
+
+            &lt;tr&gt;
+                &lt;td colspan=&quot;2&quot; style=&quot;text-align: center;&quot;&gt;
+                &lt;input type=&quot;submit&quot; value=&quot;Update&quot; name=&quot;update&quot; class=&quot;input_button&quot; /&gt;
+                &lt;/td&gt;
+            &lt;/tr&gt;
+        &lt;/tbody&gt;
+    &lt;/table&gt;
+&lt;/form&gt;
+&lt;!-- (end) preferences : notification tab --&gt;

Added: tags/parley-0.55/root/base/my/tab_time
===================================================================
--- tags/parley-0.55/root/base/my/tab_time	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/tab_time	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,82 @@
+&lt;!-- preferences : time tab --&gt;
+&lt;p&gt;Select your desired location. This will be used to display times using your local timezone.&lt;/p&gt;
+
+&lt;form action=&quot;my/preferences/update&quot; method=&quot;POST&quot; name=&quot;time_format&quot;&gt;
+    &lt;input type=&quot;hidden&quot; name=&quot;form_name&quot; value=&quot;time_format&quot;&gt;
+    &lt;table width=&quot;550&quot; border=&quot;1&quot;&gt;
+        [% IF tz_message %]
+        &lt;!-- Message to user --&gt;
+        &lt;tr&gt;
+        &lt;td colspan=&quot;2&quot;&gt;&lt;b&gt;&lt;i&gt;[% tz_message %]&lt;/i&gt;&lt;/b&gt;&lt;/td&gt;
+        &lt;/tr&gt;
+        [% END %]
+
+        &lt;!-- TZ category list --&gt;
+        &lt;tr&gt;
+            &lt;td&gt;
+                &lt;select id=&quot;selectZone&quot; name=&quot;selectZone&quot;&gt;
+                    &lt;option value=&quot;&quot;&gt;[ Select Zone ]&lt;/option&gt;
+                    [% FOREACH item=tz_categories %]
+                    &lt;option value=&quot;[% item %]&quot;&gt;[% item %]&lt;/option&gt;
+                    [% END %]
+                &lt;/select&gt;
+            &lt;/td&gt;
+
+            &lt;td class=&quot;right_align&quot; /&gt;
+                &lt;label for=&quot;use_utc&quot;&gt;Use UTC&lt;/label&gt;
+                &lt;input type=&quot;checkbox&quot; id=&quot;use_utc&quot; name=&quot;use_utc&quot; value=&quot;1&quot; onChange=&quot;toggle_timezone_menus(this)&quot;/&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;!-- Time Format List --&gt;
+        &lt;tr&gt;
+            &lt;td&gt;
+                &lt;select id=&quot;time_format&quot; name=&quot;time_format&quot; style=&quot;text-align: center;&quot;&gt;
+                    &lt;option value=&quot;&quot;&gt;(Default)&lt;/option&gt;
+                    [% WHILE (tf = time_formats.next) %]
+                    &lt;option value=&quot;[% tf.id %]&quot;&gt;[% tf.sample %]&lt;/option&gt;
+                    [% END %]
+                &lt;/select&gt;
+            &lt;/td&gt;
+            &lt;td class=&quot;right_align&quot;&gt;
+                &lt;label for=&quot;show_tz&quot;&gt;Show timezone&lt;/label&gt;
+                &lt;input type=&quot;checkbox&quot; id=&quot;show_tz&quot; name=&quot;show_tz&quot; value=&quot;1&quot; /&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;!-- &lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt; --&gt;
+
+        &lt;tr&gt;
+            &lt;td&gt;Time formatting example:&lt;/td&gt;
+            &lt;td&gt;&lt;i&gt;[% nicedate(current_time) %]&lt;/i&gt;&lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;&nbsp;&lt;/td&gt;&lt;/tr&gt;
+
+
+        &lt;tr&gt;
+            &lt;td colspan=&quot;2&quot; style=&quot;text-align: center;&quot;&gt;
+            &lt;input type=&quot;submit&quot; value=&quot;Update&quot; name=&quot;update&quot; class=&quot;input_button&quot; /&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+    &lt;/table&gt;
+&lt;/form&gt;
+
+&lt;script language=&quot;JavaScript&quot;&gt;
+&lt;!-- Begin
+
+    function toggle_timezone_menus(checkbox) {
+        var zone_menu   = document.getElementById('selectZone');
+        //var place_menu  = document.getElementById('selectPlace');
+
+        zone_menu.disabled  = checkbox.checked;
+        //place_menu.disabled = checkbox.checked;
+    }
+
+    // we want to make sure the menus are disabled if they need to be
+    var use_utc_cbox = document.getElementById('use_utc');
+    toggle_timezone_menus(use_utc_cbox);
+    
+// End --&gt;
+&lt;/script&gt;
+&lt;!-- (end) preferences : time tab --&gt;

Added: tags/parley-0.55/root/base/my/tab_watch
===================================================================
--- tags/parley-0.55/root/base/my/tab_watch	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/tab_watch	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,56 @@
+[% IF thread_watches &gt; 0 %]
+    &lt;table class=&quot;thread_watches&quot;&gt;
+        &lt;tbody&gt;
+            &lt;tr&gt;
+                &lt;th style=&quot;width:14px;&quot;&gt;&nbsp;&lt;/th&gt;
+                &lt;th&gt;Subject&lt;/th&gt;
+                &lt;th&gt;Last Modified&lt;/th&gt;
+                &lt;th&gt;Last Viewed&lt;/th&gt;
+            [% WHILE (watch = thread_watches.next) %]
+            [% thread = watch.thread %]
+            &lt;tr&gt;
+                &lt;td style=&quot;width:14px;&quot;&gt;
+                    [% IF (thread.last_post.created &gt; watch.timestamp) %]
+                    &lt;img src=&quot;static/images/unread_posts.gif&quot; width=&quot;12&quot; height=&quot;12&quot; alt=&quot;Unread Posts&quot; title=&quot;Unread Posts&quot; /&gt;
+                    [% ELSE %]
+                    &nbsp;
+                    [% END %]
+                &lt;/td&gt;
+                &lt;td style=&quot;vertical-align: top;&quot;&gt;
+                    &lt;a href=&quot;thread/view?thread=[% thread.id %]&quot;&gt;
+                    [% ForumCode.escape(watch.thread.subject) %]
+                    &lt;/a&gt;
+                    &lt;br /&gt;
+                    &lt;span class=&quot;forum_mini_pager&quot;&gt;
+                        [%- IF authed_user || mini_pager %]
+                        [
+                            [%- IF authed_user %]
+                            &lt;a href=&quot;thread/next_post?thread=[% thread.id %]&quot;&gt;Continue&lt;/a&gt;
+                            [%- END %]
+                        ]
+                        [%- END %]
+                    &lt;/span&gt;
+                &lt;/td&gt;
+
+                &lt;td style=&quot;vertical-align: top;&quot;&gt;
+                    [% nicedate(thread.last_post.created) %]
+                    &lt;br /&gt;
+                    &lt;span class=&quot;topic_creator&quot;&gt;last post by
+                    &lt;span class=&quot;post_creator&quot;&gt;[% thread.last_post.creator.forum_name %]&lt;/span&gt;
+                    &lt;/span&gt;
+                &lt;/td&gt;
+
+                &lt;td style=&quot;vertical-align: top;&quot;&gt;
+                    [% nicedate(watch.timestamp) %]
+                    &lt;br /&gt;
+                    [% IF (thread.last_post.created &gt; watch.timestamp) %]
+                    &lt;span class=&quot;topic_creator&quot;&gt;Unread posts&lt;/span&gt;
+                    [% END %]
+                &lt;/td&gt;
+            &lt;/tr&gt;
+            [% END %]
+        &lt;/tbody&gt;
+    &lt;/table&gt;
+[% ELSE %]
+    &lt;p&gt;You are not watching any threads&lt;/p&gt;
+[% END %]

Added: tags/parley-0.55/root/base/my/tab_you
===================================================================
--- tags/parley-0.55/root/base/my/tab_you	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/my/tab_you	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,86 @@
+&lt;!-- preferences : tab_you --&gt;
+
+&lt;script type=&quot;text/javascript&quot;&gt;
+    function saveHandler(newVal, oldVal, fld) {
+        // do something
+        var kw = {
+            url:  &quot;[% base %]my/saveHandler&quot;,
+            method: &quot;post&quot;,
+            formNode: dojo.byId(&quot;form&quot;),
+            content: { value: newVal, ovalue: oldVal, fieldname: fld },
+            load: function(type, data) {
+                dojo.byId(&quot;result&quot;).innerHTML = data;
+            },
+            error: function(type, error){
+                document.getElementById(&quot;result&quot;).innerHTML = error.message;
+            },
+            mimetype: &quot;text/plain&quot;
+        };
+        dojo.io.bind(kw);
+    }
+    function init() {
+        var fields = new Array;
+        fields = [ 'FirstName', 'LastName', 'ForumName' ];
+        for(i = 0; i &lt; fields.length; i++){
+            var editable = dojo.widget.byId(fields[i]);
+            editable.onSave = saveHandler;
+        }
+    }
+    dojo.addOnLoad(init);
+&lt;/script&gt;
+
+&lt;div id=&quot;result&quot;&gt;&nbsp;&lt;/div&gt;
+
+&lt;table class=&quot;user_profile&quot;&gt;
+    &lt;tbody&gt;
+        &lt;tr&gt;
+            &lt;td width=&quot;25%&quot;&gt;
+                First Name:
+            &lt;/td&gt;
+
+            &lt;td&gt;
+                &lt;div id=&quot;FirstName&quot; name=&quot;First Name&quot; class=&quot;inlineEdit&quot; dojoType=&quot;inlineEditBox&quot; &gt;
+                [% authed_user.first_name %]
+                &lt;/div&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;
+            &lt;td width=&quot;25%&quot;&gt;
+                Last Name:
+            &lt;/td&gt;
+
+            &lt;td&gt;
+                &lt;div id=&quot;LastName&quot; name=&quot;Last Name&quot; class=&quot;inlineEdit&quot; dojoType=&quot;inlineEditBox&quot; &gt;
+                [% authed_user.last_name %]
+                &lt;/div&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;
+            &lt;td width=&quot;25%&quot;&gt;
+                Forum Name:
+            &lt;/td&gt;
+
+            &lt;td&gt;
+                &lt;div id=&quot;ForumName&quot; name=&quot;Forum Name&quot; class=&quot;inlineEdit&quot; dojoType=&quot;inlineEditBox&quot; &gt;
+                [% authed_user.forum_name %]
+                &lt;/div&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;
+            &lt;td width=&quot;25%&quot;&gt;
+                Email Address:
+            &lt;/td&gt;
+
+            &lt;td&gt;
+                &lt;div id=&quot;EmailAddress&quot; name=&quot;EmailAddress&quot;&gt;
+                [% authed_user.email %]
+                &lt;/div&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+    &lt;/tbody&gt;
+&lt;/table&gt;
+
+&lt;!-- (end) preferences : tab_you --&gt;

Added: tags/parley-0.55/root/base/post/edit
===================================================================
--- tags/parley-0.55/root/base/post/edit	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/post/edit	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,25 @@
+[% IF messages %]
+&lt;p&gt;
+    &lt;ul&gt;
+        [% FOREACH message IN messages %]
+            &lt;li&gt;[% message %]&lt;/li&gt;
+        [% END %]
+    &lt;/ul&gt;
+&lt;/p&gt;
+[% END %]
+
+&lt;form action=&quot;post/edit?post=[% current_post.id %]&quot; method=&quot;POST&quot; name=&quot;new_thread&quot;&gt;
+    &lt;table&gt;
+        &lt;tr&gt;
+            &lt;td&gt;
+                &lt;textarea name=&quot;post_message&quot; cols=&quot;60&quot; rows=&quot;10&quot; class=&quot;post_message&quot; /&gt;[% current_post.message %]&lt;/textarea&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;
+            &lt;td colspan=&quot;2&quot; style=&quot;text-align: center;&quot;&gt;
+                &lt;input type=&quot;submit&quot; value=&quot;Update Reply&quot; name=&quot;post_update&quot;    class=&quot;input_button&quot; /&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+    &lt;/table&gt;
+&lt;/form&gt;

Added: tags/parley-0.55/root/base/search/forum
===================================================================
--- tags/parley-0.55/root/base/search/forum	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/search/forum	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,43 @@
+&lt;h1&gt;Search Results&lt;/h1&gt;
+
+&lt;h2&gt;Searching for &lt;em&gt;[% search_terms.raw || '[nothing]' %]&lt;/em&gt; in &lt;em&gt;[% search_forum.name || 'all forums' %]&lt;/em&gt;&lt;/h2&gt;
+
+[% IF search_results %]
+
+    &lt;table class=&quot;search_results&quot;&gt;
+    &lt;tr&gt;
+        &lt;th&gt;Subject&lt;/th&gt;
+        &lt;th&gt;Snippet&lt;/th&gt;
+    &lt;/tr&gt;
+
+    [% WHILE (result = search_results.next) %]
+    &lt;tr&gt;
+        &lt;td&gt;
+            &lt;a href=&quot;/post/view?post=[% result.id %]&quot;&gt;[% ForumCode.escape(result.subject) || ForumCode.escape(result.thread.subject) %]&lt;/a&gt;
+        &lt;/td&gt;
+        &lt;td&gt;
+            &lt;em&gt;
+            [% context = result.match_context(search_terms.raw) %]
+            [% IF context %]
+            [% context %]
+            [% ELSE %]
+            [% FILTER truncate(60) %]
+            [% result.message %]
+            [% END %]
+            [% END %]
+            &lt;/em&gt;
+        &lt;/td&gt;
+    &lt;/tr&gt;
+    [% END %]
+
+    &lt;tr&gt;
+        &lt;td class=&quot;right_align&quot; valign=&quot;top&quot; colspan=&quot;2&quot;&gt;
+        &lt;small&gt;
+        [% INCLUDE shared/pager_advanced %]
+        &lt;/small&gt;
+        &lt;/td&gt;
+    &lt;/tr&gt;
+    &lt;/table&gt;
+[% ELSE %]
+No results found matching specified terms.
+[% END %]

Added: tags/parley-0.55/root/base/shared/autocomplete_style
===================================================================

Added: tags/parley-0.55/root/base/shared/focus_username_js
===================================================================
--- tags/parley-0.55/root/base/shared/focus_username_js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/focus_username_js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,27 @@
+&lt;!-- we don't easy have access to the body tag, so we have to put it after the form
+so that the form exists when we try to set focus --&gt;
+&lt;!--
+	MAKE SURE THE FORM HAS A NAME IF YOU WANT THIS TO WORK
+--&gt;
+&lt;script language=&quot;JavaScript&quot;&gt;
+	&lt;!-- Begin
+	function usernameFocus() {
+		// if we have any forms (we should)
+		if (document.forms.length &gt; 0) {
+			// loop through all forms on the page
+			for (i=0; i&lt;document.forms.length; i++) {
+				// store the form name
+				name = document.forms[i].name;
+				// if the form has a username field
+				if (document.forms[name].username) {
+					// give it focus and don't check any more forms
+					document.forms[name].elements['username'].focus();
+					break;
+				}
+			}
+		}
+	}
+	// End --&gt;
+
+	usernameFocus();
+&lt;/script&gt;

Added: tags/parley-0.55/root/base/shared/login_dialog
===================================================================
--- tags/parley-0.55/root/base/shared/login_dialog	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/login_dialog	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+&lt;!-- login dialog --&gt;
+
+&lt;!-- dojo dialog-setup --&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+    var login_dialog;
+    function init_login_dialog(e) {
+        login_dialog = dojo.widget.byId(&quot;login_dialog&quot;);
+        var timer = document.getElementById(&quot;login_dialog_timer&quot;);
+        login_dialog.setTimerNode(timer);
+        var btn = document.getElementById(&quot;login_dialog_hider&quot;);
+        login_dialog.setCloseControl(btn);
+    }
+    dojo.addOnLoad(init_login_dialog);
+&lt;/script&gt;
+
+&lt;div dojoType=&quot;dialog&quot; id=&quot;login_dialog&quot; bgColor=&quot;#606060&quot; bgOpacity=&quot;0.4&quot; toggle=&quot;fade&quot; toggleDuration=&quot;250&quot;&gt;
+    &lt;form action=&quot;user/login&quot; method=&quot;post&quot; name=&quot;login_form&quot; class=&quot;login_dialog_form&quot;&gt;
+        &lt;fieldset&gt;
+            &lt;label for=&quot;username&quot;&gt;&lt;b&gt;Username:&lt;/b&gt;&lt;/label&gt;
+            &lt;input type=&quot;text&quot; id=&quot;username&quot; name=&quot;username&quot; style=&quot;width: 15em;&quot; class=&quot;input_text&quot; /&gt;
+            &lt;br /&gt;
+            &lt;label for=&quot;password&quot;&gt;&lt;b&gt;Password:&lt;/b&gt;&lt;/label&gt;
+            &lt;input type=&quot;password&quot; id=&quot;password&quot; name=&quot;password&quot; style=&quot;width: 15em;&quot; class=&quot;input_text&quot; /&gt;
+            &lt;br /&gt;
+            &lt;button type=&quot;submit&quot; value=&quot;log in&quot; class=&quot;input_button&quot; style=&quot;margin-left: 170px;&quot;&gt;log in&lt;/button&gt;
+
+            &lt;p align=&quot;right&quot;&gt;
+            &lt;a href=&quot;user/password/forgotten&quot;&gt;Forgotten Password&lt;/a&gt;
+            |
+            &lt;a id=&quot;login_dialog_hider&quot; href=&quot;javascript:;&quot;&gt;Close&lt;/a&gt;&lt;br /&gt;
+            &lt;/p&gt;
+        &lt;/fieldset&gt;
+    &lt;/form&gt;
+&lt;/div&gt;
+&lt;!-- /login-dialog --&gt;

Added: tags/parley-0.55/root/base/shared/moderator_list
===================================================================
--- tags/parley-0.55/root/base/shared/moderator_list	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/moderator_list	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,12 @@
+[% IF current_forum %]
+    &lt;div class=&quot;moderator_list&quot;&gt;
+        &lt;strong&gt;Forum Moderators:&lt;/strong&gt;
+        [% IF current_forum.moderators.size &gt; 0 %]
+            [% FOR m IN current_forum.moderators %]
+            &lt;a href=&quot;user/profile?user=[%m.id%]&quot;&gt;[% m.forum_name %]&lt;/a&gt;[% UNLESS loop.last() %], [% END %]
+            [% END %]
+        [% ELSE %]
+            &lt;em&gt;None&lt;/em&gt;
+        [% END %]
+    &lt;/div&gt;
+[% END %]

Added: tags/parley-0.55/root/base/shared/navigation
===================================================================
--- tags/parley-0.55/root/base/shared/navigation	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/navigation	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,5 @@
+&lt;!-- shared/navigation --&gt;
+&lt;p&gt;
+    [% PROCESS shared/threadcrumbs %]
+&lt;p&gt;
+&lt;!-- end : shared/navigation --&gt;

Added: tags/parley-0.55/root/base/shared/pager_advanced
===================================================================
--- tags/parley-0.55/root/base/shared/pager_advanced	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/pager_advanced	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,46 @@
+[% IF page %]
+&lt;div class=&quot;pager_advanced&quot;&gt;
+    [% IF current_thread %]
+    [% url_extra_args = '&amp;thread=' _ current_thread.id %]
+    [% ELSIF current_forum %]
+    [% url_extra_args = '&amp;forum=' _ current_forum.id %]
+    [% END %]
+
+    Page [% page.current_page %] of [% page.last_page %]
+    [% IF page.last_page &gt; 1 %]
+    [
+        [% UNLESS page.current_page == page.first_page %]
+        &lt;a href=&quot;[% c.req.path %]?page=[% page.first_page %][% url_extra_args %]&quot;&gt;First&lt;/a&gt; |
+        [% END %]
+
+        [% IF page.previous_page %]
+        &lt;a href=&quot;[% c.req.path %]?page=[% page.previous_page %][% url_extra_args %]&quot;&gt;Previous&lt;/a&gt;
+        |
+        [% END %]
+
+        [%# pagination majick! %]
+        [% FOREACH jiffy = page_range_spread %]
+            [% IF jiffy %]
+                [% IF page.current_page == jiffy %]
+                &lt;b&gt;[% jiffy %]&lt;/b&gt;
+                [% ELSE %]
+                &lt;a href=&quot;[% c.req.path %]?page=[% jiffy %][% url_extra_args %]&quot;&gt;[% jiffy %]&lt;/a&gt;
+                [% END %]
+            [% ELSE %]
+                ...
+            [% END %]
+        [% END %]
+
+        [% IF page.next_page %]
+        |
+        &lt;a href=&quot;[% c.req.path %]?page=[% page.next_page %][% url_extra_args %]&quot;&gt;Next&lt;/a&gt;
+        [% END %]
+
+        [% UNLESS page.current_page == page.last_page %]
+        |
+        &lt;a href=&quot;[% c.req.path %]?page=[% page.last_page %][% url_extra_args %]&quot;&gt;Last&lt;/a&gt;
+        [% END %]
+    ]
+    [% END %]
+&lt;/div&gt;
+[% END %]

Added: tags/parley-0.55/root/base/shared/search_dialog
===================================================================
--- tags/parley-0.55/root/base/shared/search_dialog	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/search_dialog	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,49 @@
+&lt;!-- SEARCH DIALOG --&gt;
+&lt;!-- dojo dialog-setup --&gt;
+&lt;script type=&quot;text/javascript&quot;&gt;
+    var search_dialog;
+    function init_search_dialog(e) {
+        search_dialog = dojo.widget.byId(&quot;search_dialog&quot;);
+        var timer = document.getElementById(&quot;search_dialog_timer&quot;);
+        search_dialog.setTimerNode(timer);
+        var btn = document.getElementById(&quot;search_dialog_hider&quot;);
+        search_dialog.setCloseControl(btn);
+    }
+    dojo.addOnLoad(init_search_dialog);
+&lt;/script&gt;
+
+&lt;div dojoType=&quot;dialog&quot; id=&quot;search_dialog&quot; bgColor=&quot;#606060&quot; bgOpacity=&quot;0.4&quot; toggle=&quot;fade&quot; toggleDuration=&quot;250&quot;&gt;
+    &lt;form action=&quot;search/forum&quot; method=&quot;post&quot; name=&quot;search_form&quot; class=&quot;search_dialog_form&quot;&gt;
+        &lt;fieldset&gt;
+            &lt;label for=&quot;search_terms&quot;&gt;&lt;b&gt;Search For:&lt;/b&gt;&lt;/label&gt;
+            &lt;input type=&quot;text&quot; id=&quot;search_terms&quot; name=&quot;search_terms&quot; style=&quot;width: 25em;&quot; class=&quot;input_text&quot; /&gt;
+            &lt;br /&gt;
+        &lt;/fieldset&gt;
+
+        &lt;fieldset&gt;
+            &lt;label for=&quot;search_forum&quot;&gt;&lt;em&gt;in:&lt;/em&gt;&lt;/label&gt;
+            &lt;select id=&quot;search_forum&quot; name=&quot;search_forum&quot;&gt;
+                &lt;optgroup label=&quot;General&quot;&gt;
+                    [% IF current_forum %]&lt;option value=&quot;[% current_forum.id %]&quot;&gt;Current Forum&lt;/option&gt;[% END %]
+                    &lt;option value=&quot;&quot;&gt;All Forums&lt;/option&gt;
+                &lt;/optgroup&gt;
+                [% IF available_forums %]
+                [% SET dummy=available_forums.reset %]
+                &lt;optgroup label=&quot;Forums&quot;&gt;
+                [% WHILE (forum = available_forums.next) %]
+                &lt;option value=&quot;[% forum.id %]&quot;&gt;[% forum.name %]&lt;/option&gt;
+                [% END %]
+                &lt;/optgroup&gt;
+                [% END %]
+            &lt;/select&gt;
+            &lt;br /&gt;
+        &lt;/fieldset&gt;
+
+        &lt;input type=&quot;submit&quot; /&gt;
+
+        &lt;p align=&quot;right&quot;&gt;
+            &lt;a id=&quot;search_dialog_hider&quot; href=&quot;javascript:;&quot;&gt;Close&lt;/a&gt;&lt;br /&gt;
+        &lt;/p&gt;
+    &lt;/form&gt;
+&lt;/div&gt;
+&lt;!-- SEARCH DIALOG --&gt;

Added: tags/parley-0.55/root/base/shared/thread_watch
===================================================================
--- tags/parley-0.55/root/base/shared/thread_watch	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/thread_watch	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,17 @@
+&lt;!-- shared/thread_watch --&gt;
+[%- IF authed_user %]
+&lt;div class=&quot;thread_watch&quot;&gt;
+    &lt;strong&gt;[% watcher_count %] [% IF watcher_count == 1 %]person[% ELSE %]people[% END %] watching this thread.&lt;/strong&gt;
+    &lt;br /&gt;
+
+    [%- IF watching_thread %]
+        You are watching this thread.
+        (
+        &lt;a href=&quot;thread/watch?thread=[% current_thread.id %]&amp;page=[% page.current_page %]&amp;watch=0&quot;&gt;Remove Watch&lt;/a&gt;
+        )
+    [%- ELSE %]
+        &lt;a href=&quot;thread/watch?thread=[% current_thread.id %]&amp;page=[% page.current_page %]&quot;&gt;Watch this thread&lt;/a&gt;
+    [%- END%]
+&lt;/div&gt;
+[%- END %] [%# authed_user block %]
+&lt;!-- end : shared/thread_watch --&gt;

Added: tags/parley-0.55/root/base/shared/threadcrumbs
===================================================================
--- tags/parley-0.55/root/base/shared/threadcrumbs	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/threadcrumbs	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,9 @@
+    &lt;a href=&quot;forum/list&quot;&gt;Home&lt;/a&gt;
+    [% IF current_forum %]
+        &raquo;
+        &lt;a href=&quot;forum/view?forum=[% current_forum.id %]&quot;&gt;[% current_forum.name %]&lt;/a&gt;
+        [% IF current_thread %]
+            &raquo;
+            &lt;a href=&quot;thread/view?thread=[% current_thread.id %]&quot;&gt;[% ForumCode.escape(current_thread.subject) %]&lt;/a&gt;
+        [% END %]
+    [% END %]

Added: tags/parley-0.55/root/base/shared/useful_tt_stuff
===================================================================
--- tags/parley-0.55/root/base/shared/useful_tt_stuff	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/useful_tt_stuff	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+[% USE HTML %]
+[% USE ForumCode %]
+
+[%- MACRO nicedate(d) BLOCK %]
+    [%# if a person has preferences, and there's a timezone option set, use it to
+        set the TZ used to display the time in nicedate
+    %]
+    [% IF authed_user.preference.timezone %]
+        [% CALL d.set_time_zone(authed_user.preference.timezone) %]
+    [% ELSE %]
+        [% CALL d.set_time_zone('UTC') %]
+    [% END %]
+
+    [% IF authed_user.preference.time_format %]
+        [% d.strftime(authed_user.preference.time_format.time_string) %]
+        [% IF authed_user.preference.show_tz %]
+            [% d.time_zone_short_name() %]
+        [% END %]
+    [% ELSE %]
+        [% d.strftime('%c') %]
+        [% d.time_zone_short_name() %]
+    [% END %]
+[% END %]
+

Added: tags/parley-0.55/root/base/shared/user_avatar
===================================================================
--- tags/parley-0.55/root/base/shared/user_avatar	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/user_avatar	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,11 @@
+&lt;!-- user avatar --&gt;
+[% avatar_file = c.path_to('root') _ &quot;/static/user_file/${person.id}/avatar.jpg&quot; %]
+[% TRY %]
+    [% USE avatar = Image(avatar_file) %]
+    [% tmp = avatar.attr %]
+    &lt;img class=&quot;picborder&quot; src=&quot;/static/user_file/[% person.id %]/avatar.jpg&quot; border=&quot;0&quot; [% avatar.attr %] alt=&quot;Avatar&quot; /&gt;
+    &lt;br /&gt;
+[% CATCH %]
+    No User Avatar
+[% END %]
+&lt;!-- end : user avatar --&gt;

Added: tags/parley-0.55/root/base/shared/user_status
===================================================================
--- tags/parley-0.55/root/base/shared/user_status	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/shared/user_status	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+&lt;!-- shared/user_status --&gt;
+&lt;p&gt;
+    [% IF (authed_user) %]
+        Logged in as &lt;b&gt;[% authed_user.first_name %] [% authed_user.last_name %]&lt;/b&gt;
+        [% UNLESS authed_user.authentication.authenticated %]
+            (&lt;b&gt;&lt;i&gt;Not Authenticated&lt;/i&gt;&lt;/b&gt;)
+        [% END %]
+        &lt;i&gt;&lt;br /&gt;[
+        &lt;a href=&quot;user/logout&quot;&gt;Logout&lt;/a&gt;
+        ]&lt;/i&gt;
+    [% ELSE %]
+        &lt;i&gt;[
+        &lt;a href=&quot;javascript:;&quot; onclick=&quot;login_dialog.show(); dojo.byId('username').focus(); return false;&quot;&gt;Login&lt;/a&gt;
+        |
+        &lt;a href=&quot;user/signup&quot;&gt;Signup&lt;/a&gt;
+        ]&lt;/i&gt;
+    [% END %] [%# authed_user end %]
+&lt;/p&gt;
+&lt;!-- end : shared/user_status --&gt;

Added: tags/parley-0.55/root/base/thread/add
===================================================================
--- tags/parley-0.55/root/base/thread/add	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/thread/add	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,52 @@
+&lt;h1&gt;Start A New Topic&lt;/h1&gt;
+
+[% IF view.error.message %]
+    [% view.error.message %]
+    &lt;ul&gt;
+        [% FOREACH message IN view.error.messages %]
+            &lt;li&gt;[% message %]&lt;/li&gt;
+        [% END %]
+    &lt;/ul&gt;
+[% END %]
+
+
+&lt;form action=&quot;thread/add?forum=[% current_forum.id %]&quot; method=&quot;POST&quot; name=&quot;new_thread&quot;&gt;
+
+&lt;table&gt;
+
+  &lt;tr&gt;
+    &lt;td&gt; Topic &lt;/td&gt;
+    &lt;td&gt;
+      &lt;input type=&quot;text&quot; name=&quot;thread_subject&quot; size=&quot;60&quot; class=&quot;input_text&quot; /&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+
+  &lt;tr&gt;
+    &lt;td&gt; Message &lt;/td&gt;
+    &lt;td&gt;
+      &lt;textarea name=&quot;thread_message&quot; cols=&quot;60&quot; rows=&quot;20&quot; class=&quot;input_text&quot; /&gt;&lt;/textarea&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+
+  &lt;tr&gt;
+    &lt;td colspan=&quot;2&quot; style=&quot;text-align: center;&quot;&gt;
+      &lt;input type=&quot;submit&quot; value=&quot;Post New Topic&quot; name=&quot;post_topic&quot;         class=&quot;input_button&quot; /&gt;
+      &lt;!--
+      &lt;input type=&quot;submit&quot; value=&quot;Preview Topic&quot;  name=&quot;preview_topic&quot;      class=&quot;input_button&quot; /&gt;
+      --&gt;
+      &lt;!--
+      &lt;input type=&quot;reset&quot;  value=&quot;Reset Form&quot;     name=&quot;reset_topic&quot;        class=&quot;input_button&quot; /&gt;
+      &lt;input type=&quot;submit&quot; value=&quot;Cancel&quot;         name=&quot;cancel_new_topic&quot;   class=&quot;input_button&quot; /&gt;
+      --&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+
+  &lt;tr&gt;
+    &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;
+        &lt;input type=&quot;checkbox&quot; name=&quot;watch_on_post&quot; value=&quot;1&quot; [% IF authed_user.preference.watch_on_post %]checked=&quot;checked&quot; [% END %]/&gt;
+        Add a Thread Watch
+    &lt;/td&gt;
+  &lt;/tr&gt;
+&lt;/table&gt;
+
+&lt;/form&gt;

Added: tags/parley-0.55/root/base/thread/recent
===================================================================
--- tags/parley-0.55/root/base/thread/recent	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/thread/recent	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,79 @@
+&lt;h1&gt;Recently Updated Threads&lt;/h1&gt;
+
+[%- IF thread_list.count &gt; 0 %]
+[% PROCESS shared/pager_advanced %]
+&lt;table class=&quot;recently_updated&quot;&gt;
+[% WHILE (thread = thread_list.next) %]
+    &lt;tr&gt;
+        &lt;td width=&quot;36&quot;&gt;
+        &lt;!-- interesting things about the thread; sticky, locked, etc --&gt;
+        [%- IF thread.sticky %]
+        &lt;img src=&quot;static/images/sticky.png&quot; alt=&quot;Sticky&quot; title=&quot;Sticky Topic&quot; width=&quot;16&quot; height=&quot;16&quot; /&gt;
+        [%- END %]
+        [%- IF thread.locked %]
+        &lt;img src=&quot;static/images/locked.png&quot; alt=&quot;Locked&quot; title=&quot;Locked Topic&quot; width=&quot;16&quot; height=&quot;16&quot; /&gt;
+        [%- END %]
+        &lt;/td&gt;
+
+        &lt;td&gt;
+        &lt;a href=&quot;thread/view?thread=[% thread.id %]&quot; class=&quot;topic_link&quot;&gt;[% ForumCode.escape(thread.subject) %]&lt;/a&gt;
+        &lt;br /&gt;
+        &lt;span class=&quot;forum_mini_pager&quot;&gt;
+            [%- IF authed_user || mini_pager %]
+            [
+                [%- IF authed_user %]
+                &lt;a href=&quot;thread/next_post?thread=[% thread.id %]&quot;&gt;Continue&lt;/a&gt;
+                [%- END %]
+            ]
+            [%- END %]
+        &lt;/span&gt;
+        &lt;span class=&quot;topic_creator&quot;&gt;created by
+            &lt;span class=&quot;post_creator&quot;&gt;[% thread.creator.forum_name %]&lt;/span&gt;
+        &lt;/span&gt;
+        &lt;/td&gt;
+
+        &lt;td&gt;
+        [% nicedate(thread.last_post.created) %]
+        &lt;br /&gt;&lt;span class=&quot;interval_ago&quot;&gt;
+            [% thread.last_post.interval_ago %] ago
+            &lt;/span&gt;
+        &lt;br /&gt;
+        &lt;span class=&quot;topic_creator&quot;&gt;posted by
+            &lt;span class=&quot;post_creator&quot;&gt;[% thread.last_post.creator.forum_name %]&lt;/span&gt;
+        &lt;/span&gt;
+        &lt;/td&gt;
+
+        &lt;td&gt;
+        &lt;a href=&quot;forum/view?forum=[%thread.forum.id%]&quot;&gt;[% thread.forum.name %]&lt;/a&gt;
+        &lt;br /&gt;&nbsp;
+        &lt;/td&gt;
+
+        &lt;td&gt;
+            [% IF 0 &amp;&amp; thread.forum_moderators.can_moderate %]
+            &lt;!-- add/remove sticky --&gt;
+            [% IF thread.sticky %]
+            &lt;a href=&quot;admin/sticky?thread=[% thread.id %]&amp;sticky=0&quot;&gt;{S-}&lt;/a&gt;
+            [% ELSE %]
+            &lt;a href=&quot;admin/sticky?thread=[% thread.id %]&quot;&gt;{S+}&lt;/a&gt;
+            [% END %]
+
+            &lt;!-- add/remove locked --&gt;
+            [% IF thread.locked %]
+            &lt;a href=&quot;admin/lock?thread=[% thread.id %]&amp;lock=0&quot;&gt;{L-}&lt;/a&gt;
+            [% ELSE %]
+            &lt;a href=&quot;admin/lock?thread=[% thread.id %]&quot;&gt;{L+}&lt;/a&gt;
+            [% END %]
+
+            &lt;!-- add/removed active --&gt;
+            [% IF thread.active %]{A-}[% ELSE %]{A+}[% END %]
+            [% ELSE %]
+            &nbsp;
+            [% END %]
+            &lt;br /&gt;
+        &lt;/td&gt;
+    &lt;/tr&gt;
+[% END %]
+&lt;/table&gt;
+[% ELSE %]
+  No recent threads to display
+[% END %]

Added: tags/parley-0.55/root/base/thread/reply
===================================================================
--- tags/parley-0.55/root/base/thread/reply	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/thread/reply	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,100 @@
+&lt;!--
+&lt;h1&gt;Reply to: [% current_thread.subject %]&lt;/h1&gt;
+--&gt;
+
+[%# different action depending on whether we're adding to a thread or replying to a specific post %]
+[% IF current_post %]
+&lt;form action=&quot;thread/reply?post=[% current_post.id %]&quot; method=&quot;POST&quot; name=&quot;new_thread&quot;&gt;
+[% ELSE %]
+&lt;form action=&quot;thread/reply?thread=[% current_thread.id %]&quot; method=&quot;POST&quot; name=&quot;new_thread&quot;&gt;
+[% END %]
+
+&lt;!-- The post we're replying to --&gt;
+&lt;table&gt;
+  &lt;tr&gt;
+    &lt;td class=&quot;post_subject&quot;&gt;
+      [% responding_to_post.subject %]
+    &lt;/td&gt;
+    &lt;td class=&quot;post_creator&quot;&gt;
+      [% responding_to_post.creator.forum_name %]
+    &lt;/td&gt;
+    &lt;td class=&quot;post_created&quot;&gt;
+      [% nicedate(responding_to_post.created) %]
+    &lt;/td&gt;
+  &lt;/tr&gt;
+  
+  &lt;tr&gt;
+    &lt;td colspan=&quot;3&quot; class=&quot;reply_post_message&quot;&gt;
+      &lt;div class=&quot;innerpost&quot;&gt;
+      [% FILTER html_line_break %][% HTML.escape(responding_to_post.message) %][% END %]
+      &lt;/div&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+&lt;/table&gt;
+    
+&lt;p&gt;Please enter your reply in the form below:&lt;/p&gt;
+
+[% IF messages %]
+&lt;p&gt;
+    &lt;ul&gt;
+        [% FOREACH message IN messages %]
+            &lt;li&gt;[% message %]&lt;/li&gt;
+        [% END %]
+    &lt;/ul&gt;
+&lt;/p&gt;
+[% END %]
+
+
+&lt;table&gt;
+  [% IF c.config.replies_have_own_subject %]
+  &lt;tr&gt;
+    &lt;td&gt; Topic &lt;/td&gt;
+    &lt;td&gt;
+      &lt;input type=&quot;text&quot; name=&quot;thread_subject&quot; size=&quot;60&quot; class=&quot;input_text&quot; value=&quot;[% current_thread.subject %]&quot; /&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+  [% END %]
+
+  [% IF quote_post %]
+  &lt;input type=&quot;hidden&quot; name=&quot;have_quoted_post&quot; value=&quot;1&quot; /&gt;
+  &lt;input type=&quot;hidden&quot; name=&quot;__post&quot; value=&quot;[% quote_post.id %]&quot; /&gt;
+  &lt;tr&gt;
+  &lt;td&gt;&nbsp;&lt;/td&gt;
+  &lt;td&gt;
+    &lt;span class=&quot;post_creator&quot;&gt;
+      [% quote_post.creator.forum_name %] said:
+    &lt;/span&gt;
+    &lt;br /&gt;
+    &lt;textarea name=&quot;quote_message&quot; cols=&quot;60&quot; rows=&quot;10&quot; class=&quot;quoted_reply_textarea&quot; /&gt;[% quote_post.message %]&lt;/textarea&gt;
+  &lt;/td&gt;
+  &lt;/tr&gt;
+  [% END %]
+
+  &lt;tr&gt;
+    &lt;td&gt; Message &lt;/td&gt;
+    &lt;td&gt;
+      &lt;textarea name=&quot;thread_message&quot; cols=&quot;60&quot; rows=&quot;20&quot; class=&quot;input_text&quot; /&gt;&lt;/textarea&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+
+  &lt;tr&gt;
+    &lt;td colspan=&quot;2&quot; style=&quot;text-align: center;&quot;&gt;
+      &lt;input type=&quot;submit&quot; value=&quot;Add Reply&quot;      name=&quot;post_reply&quot;    class=&quot;input_button&quot; /&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;
+
+  [% IF moderator %]
+  &lt;tr&gt;
+    &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;
+        &lt;input type=&quot;checkbox&quot; name=&quot;lock_thread&quot; value=&quot;1&quot; /&gt; Lock thread after posting
+    &lt;/td&gt;
+  &lt;/tr&gt;
+  [% END %]
+  &lt;tr&gt;
+    &lt;td colspan=&quot;2&quot; align=&quot;right&quot;&gt;
+        &lt;input type=&quot;checkbox&quot; name=&quot;watch_on_post&quot; value=&quot;1&quot; [% IF authed_user.preference.watch_on_post %]checked=&quot;checked&quot; [% END %]/&gt;
+        Add a Thread Watch
+    &lt;/td&gt;
+  &lt;/tr&gt;
+&lt;/table&gt;
+&lt;/form&gt;

Added: tags/parley-0.55/root/base/thread/view
===================================================================
--- tags/parley-0.55/root/base/thread/view	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/thread/view	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,166 @@
+&lt;!-- thread/view --&gt;
+
+[% SET dummy_value = post_list.reset %]
+
+&lt;!-- thread contents --&gt;
+&lt;table class=&quot;thread_posts&quot;&gt;
+    &lt;tbody&gt;
+
+        &lt;tr&gt;
+            &lt;td colspan=&quot;2&quot; class=&quot;thread_header&quot;&gt;
+                [% ForumCode.escape(current_thread.subject) %]
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;!-- I'd really like to do this without a nested table --&gt;
+        &lt;tr&gt;
+            &lt;td colspan=&quot;2&quot;&gt;
+                &lt;table class=&quot;thread_info&quot;&gt;
+                    &lt;tbody&gt;
+                        &lt;tr&gt;
+                            &lt;td width=&quot;50%&quot;&gt;
+                                [% PROCESS shared/thread_watch %]
+                            &lt;/td&gt;
+                            &lt;td width=&quot;50%&quot; align=&quot;right&quot;&gt;
+                                [% PROCESS shared/pager_advanced %]
+                            &lt;/td&gt;
+                        &lt;/tr&gt;
+                        &lt;tr&gt;
+                            &lt;td width=&quot;50%&quot;&gt;
+                                &lt;small&gt;
+                                    [% current_thread.view_count %]
+                                    [% IF current_thread.view_count == 1 %]view[% ELSE %]views[% END %].
+                                &lt;/small&gt;
+                            &lt;/td&gt;
+                            &lt;td width=&quot;50%&quot; align=&quot;right&quot;&gt;
+                                &lt;small&gt;
+                                [% IF current_thread.locked %]
+                                    Thread Locked
+                                    &lt;img src=&quot;static/images/locked.png&quot; alt=&quot;Locked&quot; title=&quot;Locked Topic&quot; width=&quot;16&quot; height=&quot;16&quot; /&gt;
+                                [% ELSE %]
+                                    &lt;a class=&quot;button&quot; href=&quot;thread/reply?thread=[% current_thread.id %]&quot;&gt;Reply&lt;/a&gt;
+                                [% END %]
+                                &lt;/small&gt;
+                            &lt;/td&gt;
+                        &lt;/tr&gt;
+                    &lt;/tbody&gt;
+                &lt;/table&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+        &lt;!-- end : nested table evil --&gt;
+
+    &lt;!-- thread posts --&gt;
+    [% WHILE (post = post_list.next) %]
+        &lt;tr&gt;
+            &lt;td class=&quot;user_post_info&quot;&gt;
+                &lt;!-- user avatar --&gt;
+                [% avatar_file = c.path_to('root') _ &quot;/static/user_file/${post.creator.id}/avatar.jpg&quot; %]
+                [% TRY %]
+                    [% USE avatar = Image(avatar_file) %]
+                    [% tmp = avatar.attr %]
+                    &lt;img class=&quot;picborder&quot; src=&quot;/static/user_file/[% post.creator.id %]/avatar.jpg&quot; border=&quot;0&quot; [% avatar.attr %] alt=&quot;Avatar&quot; /&gt;
+                    &lt;br /&gt;
+                [% CATCH %]
+                    &lt;!-- No User Avatar --&gt;
+                [% END %]
+                &lt;!-- end : user avatar --&gt;
+
+                &lt;a href=&quot;user/profile?user=[% post.creator.id %]&quot;&gt;[% post.creator.forum_name %]&lt;/a&gt;
+
+                &lt;br /&gt;
+                    [% post.creator.post_count %]
+                    post[% IF (post.creator.post_count != 1) %]s[% END %]
+                
+            &lt;/td&gt;
+
+            &lt;td class=&quot;post&quot;&gt;
+                &lt;!-- the body of the post --&gt;
+                &lt;div class=&quot;innerpost&quot;&gt;
+                    [% IF post.quoted_post %]
+                    &lt;div class=&quot;quote&quot;&gt;
+                    &lt;strong&gt;[% post.quoted_post.creator.forum_name %] wrote:&lt;/strong&gt;&lt;br&gt;
+                    [% ForumCode.forumcode(post.quoted_text) %]&lt;br /&gt;
+                    &lt;/div&gt;
+                    &lt;br /&gt;
+                    [% END %]
+                    [% ForumCode.forumcode(post.message) %]&lt;br /&gt;
+                &lt;/div&gt;
+                &lt;!-- end : the body of the post --&gt;
+
+                &lt;div class=&quot;post_info&quot;&gt;
+                    [% nicedate(post.created) %]
+                    &lt;br /&gt;[% post.interval_ago %] ago
+                    [% IF post.edited %]
+                    &lt;br /&gt;&lt;span class=&quot;post_edited_alert&quot;&gt;Edited: [% nicedate(post.edited) %]&lt;/span&gt;
+                    [% END %]
+                    &lt;br /&gt;
+                    [% IF post.ip_addr %]
+                        [% IF moderator %]
+                            Posted from: [% post.ip_addr %]
+                        [% ELSE %]
+                            IP Logged
+                        [% END %]
+                    [% END %]
+                    [% UNLESS current_thread.locked %]
+                        &lt;br /&gt;
+                        &lt;br /&gt;
+                        [% IF authed_user.id == post.creator.id %]
+                        &lt;a class=&quot;button&quot; href=&quot;post/edit?post=[% post.id %]&quot;&gt;Edit&lt;/a&gt;
+                        [% END %]
+                        &lt;a class=&quot;button&quot; href=&quot;thread/reply?post=[% post.id %]&quot;&gt;Quote&lt;/a&gt;
+                        &lt;a class=&quot;button&quot; href=&quot;thread/reply?thread=[% current_thread.id %]&quot;&gt;Reply&lt;/a&gt;
+                    [% END %]
+                &lt;/div&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+    [% END %]
+    &lt;!-- end : thread posts --&gt;
+
+    &lt;!-- post thread info --&gt;
+        &lt;!-- I'd really like to do this without a nested table --&gt;
+        &lt;tr&gt;
+            &lt;td colspan=&quot;2&quot;&gt;
+                &lt;table class=&quot;thread_info&quot;&gt;
+                    &lt;tbody&gt;
+                        &lt;tr&gt;
+                            &lt;td width=&quot;50%&quot;&gt;
+                                [% PROCESS shared/thread_watch %]
+                            &lt;/td&gt;
+                            &lt;td width=&quot;50%&quot; align=&quot;right&quot;&gt;
+                                [% PROCESS shared/pager_advanced %]
+                            &lt;/td&gt;
+                        &lt;/tr&gt;
+                        &lt;tr&gt;
+                            &lt;td width=&quot;50%&quot;&gt;
+                                &lt;small&gt;
+                                    [% current_thread.view_count %]
+                                    [% IF current_thread.view_count == 1 %]view[% ELSE %]views[% END %].
+                                &lt;/small&gt;
+                            &lt;/td&gt;
+                            &lt;td width=&quot;50%&quot; align=&quot;right&quot;&gt;
+                                &lt;small&gt;
+                                [% IF current_thread.locked %]
+                                    Thread Locked
+                                    &lt;img src=&quot;static/images/locked.png&quot; alt=&quot;Locked&quot; title=&quot;Locked Topic&quot; width=&quot;16&quot; height=&quot;16&quot; /&gt;
+                                [% ELSE %]
+                                    &lt;a class=&quot;button&quot; href=&quot;thread/reply?thread=[% current_thread.id %]&quot;&gt;Reply&lt;/a&gt;
+                                [% END %]
+                                &lt;/small&gt;
+                            &lt;/td&gt;
+                        &lt;/tr&gt;
+                    &lt;/tbody&gt;
+                &lt;/table&gt;
+            &lt;/td&gt;
+        &lt;/tr&gt;
+        &lt;!-- end : nested table evil --&gt;
+    &lt;!-- end : post thread info --&gt;
+    &lt;tr&gt;
+        &lt;td colspan=&quot;2&quot;&gt;
+            [% PROCESS shared/moderator_list %]
+        &lt;/td&gt;
+    &lt;/tr&gt;
+
+    &lt;/tbody&gt;
+&lt;/table&gt;
+&lt;!-- end : thread contents --&gt;
+&lt;!-- end : thread/view --&gt;

Added: tags/parley-0.55/root/base/thread/watches
===================================================================
--- tags/parley-0.55/root/base/thread/watches	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/thread/watches	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,94 @@
+&lt;h1&gt;Watched Threads&lt;/h1&gt;
+
+[% IF thread_watches &gt; 0 %]
+&lt;form method=&quot;post&quot;&gt;
+    &lt;table class=&quot;thread_watches&quot;&gt;
+        &lt;tbody&gt;
+            &lt;tr&gt;
+                &lt;th style=&quot;width:14px;&quot;&gt;&nbsp;&lt;/th&gt;
+                &lt;th&gt;Subject&lt;/th&gt;
+                &lt;th&gt;Last Post Made&lt;/th&gt;
+                &lt;th&gt;Last Post Viewed&lt;/th&gt;
+            &lt;/tr&gt;
+            [% WHILE (watch = thread_watches.next) %]
+            [% thread = watch.thread %]
+            &lt;tr&gt;
+                &lt;td style=&quot;width:14px; vertical-align: middle;&quot;&gt;
+                    [% IF (thread.last_post.created &gt; watch.timestamp) %]
+                    &lt;img src=&quot;static/images/unread_posts.gif&quot; width=&quot;12&quot; height=&quot;12&quot; alt=&quot;Unread Posts&quot; title=&quot;Unread Posts&quot; /&gt;
+                    [% ELSE %]
+                    &nbsp;
+                    [% END %]
+                &lt;/td&gt;
+                &lt;td&gt;
+                    &lt;a href=&quot;thread/view?thread=[% thread.id %]&quot;&gt;
+                    [% ForumCode.escape(watch.thread.subject) %]
+                    &lt;/a&gt;
+                    &lt;br /&gt;
+                    &lt;span class=&quot;forum_mini_pager&quot;&gt;
+                        [%- IF authed_user || mini_pager %]
+                        [
+                            [%- IF authed_user %]
+                            &lt;a href=&quot;thread/next_post?thread=[% thread.id %]&quot;&gt;Continue&lt;/a&gt;
+                            [%- END %]
+                        ]
+                        [%- END %]
+                    &lt;/span&gt;
+                &lt;/td&gt;
+
+                &lt;td&gt;
+                    [% nicedate(thread.last_post.created) %]
+                    &lt;br /&gt;&lt;span class=&quot;interval_ago&quot;&gt;
+                        [% thread.last_post.interval_ago %] ago
+                        &lt;/span&gt;
+                    &lt;br /&gt;
+                    &lt;span class=&quot;topic_creator&quot;&gt;last post by
+                    &lt;span class=&quot;post_creator&quot;&gt;[% thread.last_post.creator.forum_name %]&lt;/span&gt;
+                    &lt;/span&gt;
+                &lt;/td&gt;
+
+                &lt;td&gt;
+                    [% nicedate(watch.timestamp) %]
+                    &lt;br /&gt;&lt;span class=&quot;interval_ago&quot;&gt;
+                        [% watch.interval_ago %] ago
+                        &lt;/span&gt;
+                    &lt;br /&gt;
+                    [% IF (thread.last_post.created &gt; watch.timestamp) %]
+                    &lt;span class=&quot;topic_creator&quot;&gt;Unread posts&lt;/span&gt;
+                    [% END %]
+                &lt;/td&gt;
+                &lt;td style=&quot;width:14px;&quot;&gt;
+                    &lt;input type=&quot;checkbox&quot; name=&quot;stop_watching&quot; value=&quot;[% thread.id %]&quot; /&gt;
+                &lt;/td&gt;
+            &lt;/tr&gt;
+            [% END %]
+            &lt;tr&gt;
+                &lt;td colspan=&quot;5&quot; class=&quot;right_align&quot;&gt;
+                    &lt;small&gt;
+                        &lt;a href=&quot;javascript:toggle_all('stop_watching',1);&quot;&gt;Select All&lt;/a&gt;
+                        &lt;a href=&quot;javascript:toggle_all('stop_watching',0);&quot;&gt;Deselect All&lt;/a&gt;
+                    &lt;/small&gt;
+                &lt;/td&gt;
+            &lt;/tr&gt;
+            &lt;tr&gt;
+                &lt;td colspan=&quot;5&quot; class=&quot;center_align&quot;&gt;
+                    &lt;input type=&quot;submit&quot; value=&quot;Stop Watching Selected Threads&quot; /&gt;
+                &lt;/td&gt;
+            &lt;/tr&gt;
+        &lt;/tbody&gt;
+    &lt;/table&gt;
+&lt;/form&gt;
+[% ELSE %]
+    &lt;p&gt;You are not watching any threads&lt;/p&gt;
+[% END %]
+
+&lt;script type=&quot;text/javascript&quot;&gt;
+    /* set the 'checked' value for all items matching 'name' to 'value' (0|1) */
+    function toggle_all(name,value) {
+        //alert( name );
+        var cboxes = document.getElementsByName( name );
+        for (var i=0;i&lt;cboxes.length;i++) {
+            cboxes[i].checked = value;
+        }
+    }
+&lt;/script&gt;

Added: tags/parley-0.55/root/base/user/auth_emailed
===================================================================
--- tags/parley-0.55/root/base/user/auth_emailed	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/auth_emailed	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,8 @@
+&lt;h1&gt;Almost there...&lt;/h1&gt;
+
+&lt;p&gt;Thanks for signing up [% newdata.first_name %]!&lt;/p&gt;
+
+&lt;p&gt;
+An email has been sent to &lt;i&gt;[% newdata.email %]&lt;/i&gt; which you should receive shortly.&lt;br /&gt;
+To activate your account click on the link in the email.
+&lt;/p&gt;

Added: tags/parley-0.55/root/base/user/auth_success
===================================================================
--- tags/parley-0.55/root/base/user/auth_success	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/auth_success	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,3 @@
+&lt;h1&gt;Registration Complete&lt;/h1&gt;
+
+&lt;p&gt;Your registration has been authenticated. Click on the login link to continue.&lt;/p&gt;

Added: tags/parley-0.55/root/base/user/login
===================================================================
--- tags/parley-0.55/root/base/user/login	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/login	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,33 @@
+&lt;form action=&quot;user/login&quot; method=&quot;post&quot; name=&quot;login_form&quot;&gt;
+    &lt;fieldset&gt;
+        &lt;p&gt;
+            [% IF login_message %]
+            [% login_message %]&lt;br /&gt;
+            [% ELSE %]
+            [% message %]&lt;br /&gt;
+            [% END %]
+        &lt;/p&gt;
+        &lt;label for=&quot;username&quot; accesskey=&quot;u&quot;&gt;&lt;b&gt;Username:&lt;/b&gt;&lt;/label&gt;
+        &lt;input type=&quot;text&quot; id=&quot;login_username&quot; name=&quot;username&quot; size=&quot;40&quot; class=&quot;input_text&quot; tabindex=&quot;1&quot; /&gt;
+
+        &lt;label for=&quot;login_password&quot; accesskey=&quot;p&quot;&gt;&lt;b&gt;Password:&lt;/b&gt;&lt;/label&gt;
+        &lt;input type=&quot;password&quot; id=&quot;login_password&quot; name=&quot;password&quot; size=&quot;40&quot; class=&quot;input_text&quot; tabindex=&quot;2&quot; /&gt;
+
+        &lt;br /&gt;
+        &lt;button type=&quot;submit&quot; class=&quot;input_button&quot; tabindex=&quot;3&quot; /&gt;log in&lt;/button&gt;
+
+            &lt;p align=&quot;right&quot;&gt;
+            &lt;a href=&quot;user/password/forgotten&quot;&gt;Forgotten Password&lt;/a&gt;
+            |
+            &lt;a href=&quot;user/signup&quot;&gt;Signup&lt;/a&gt;
+            &lt;/p&gt;
+    &lt;/fieldset&gt;
+&lt;/form&gt;
+
+&lt;!-- put focus into the username field on the form above --&gt;
+&lt;script language=&quot;JavaScript&quot;&gt;
+	&lt;!-- Begin
+    document.forms['login_form'].elements['username'].focus();
+	// End --&gt;
+&lt;/script&gt;
+

Added: tags/parley-0.55/root/base/user/lostpassword/lost_password
===================================================================
--- tags/parley-0.55/root/base/user/lostpassword/lost_password	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/lostpassword/lost_password	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+&lt;h1&gt;Password Reset&lt;/h1&gt;
+&lt;p&gt;[% name %] stores an encrypted copy of your password. This makes it
+impossible to remind you of your current password.&lt;/p&gt;
+
+&lt;p&gt;To gain access to your account your password can be re-set, and an
+authentication email re-sent. If you wish to proceed please enter the username
+or email address you signed up with.&lt;/p&gt;
+
+&lt;form method=&quot;post&quot; action=&quot;user/password/forgotten&quot; name=&quot;password_reset_form&quot;&gt;
+    &lt;fieldset&gt;
+        [%- IF view.error.messages %]
+        &lt;p&gt;
+            &lt;ul&gt;
+                 [% FOREACH message IN view.error.messages %]
+                    &lt;li&gt;[% message %]&lt;/li&gt;
+                [% END %]
+            &lt;/ul&gt;
+        &lt;/p&gt;
+        [% END %]
+
+        &lt;label for=&quot;pwd_reset_username&quot;&gt;Username:&lt;/a&gt;&lt;/label&gt;
+        &lt;input type=&quot;text&quot; id=&quot;pwd_reset_username&quot; name=&quot;username&quot; class=&quot;input_text&quot; tabindex=&quot;1&quot; size=&quot;40&quot; /&gt;
+
+        &lt;label for=&quot;pwd_reset_email&quot;&gt;Email:&lt;/a&gt;&lt;/label&gt;
+        &lt;input type=&quot;text&quot; id=&quot;pwd_reset_email&quot; name=&quot;email&quot; class=&quot;input_text&quot; tabindex=&quot;2&quot; size=&quot;40&quot; /&gt;
+
+        &lt;button name=&quot;pwd_reset_submit&quot; class=&quot;input_button&quot; tabindex=&quot;3&quot; /&gt;reset my password&lt;/button&gt;
+    &lt;/fieldset&gt;
+&lt;/form&gt;

Added: tags/parley-0.55/root/base/user/lostpassword/lost_password_details_sent
===================================================================
--- tags/parley-0.55/root/base/user/lostpassword/lost_password_details_sent	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/lostpassword/lost_password_details_sent	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1 @@
+&lt;p&gt;Details are in the post&lt;/p&gt;

Added: tags/parley-0.55/root/base/user/lostpassword/reset
===================================================================
--- tags/parley-0.55/root/base/user/lostpassword/reset	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/lostpassword/reset	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,41 @@
+&lt;form action=&quot;user/password/reset/[% reset_uid %]&quot; method=&quot;post&quot; name=&quot;password_reset_form&quot;&gt;
+
+To reset your password enter your username and your desired password in the
+fields below, then click the &lt;em&gt;reset my password&lt;/em&gt; button to proceed.
+
+    &lt;fieldset&gt;
+        [%- IF view.error.messages %]
+        &lt;p&gt;
+            &lt;ul&gt;
+                [% FOREACH message IN view.error.messages %]
+                    &lt;li&gt;[% message %]&lt;/li&gt;
+                [% END %]
+            &lt;/ul&gt;
+        &lt;/p&gt;
+        [% END %]
+
+        &lt;label&gt;Name:&lt;/label&gt;
+        &lt;input type=&quot;text&quot; value=&quot;[% reset_user.first_name %] [% reset_user.last_name %]&quot; tabindex=&quot;1&quot; readonly=&quot;readonly&quot; disabled=&quot;disabled&quot; size=&quot;40&quot; /&gt;
+
+        &lt;label for=&quot;reset_username&quot;&gt;Username:&lt;/label&gt;
+        &lt;input type=&quot;text&quot; name=&quot;reset_username&quot; id=&quot;reset_username&quot; size=&quot;40&quot; tabindex=&quot;2&quot; /&gt;
+
+        &lt;label for=&quot;new_password&quot;&gt;New password:&lt;/label&gt;
+        &lt;input type=&quot;password&quot; name=&quot;new_password&quot; id=&quot;new_password&quot; size=&quot;40&quot; tabindex=&quot;3&quot; /&gt;
+
+        &lt;label for=&quot;confirm_password&quot;&gt;Confirm password:&lt;/label&gt;
+        &lt;input type=&quot;password&quot; name=&quot;confirm_password&quot; id=&quot;confirm_password&quot; size=&quot;40&quot; tabindex=&quot;4&quot; /&gt;
+
+        &lt;br /&gt;
+        &lt;button type=&quot;submit&quot; class=&quot;input_button&quot; tabindex=&quot;5&quot; name=&quot;reset_password&quot; /&gt;reset my password&lt;/button&gt;
+
+    &lt;/fieldset&gt;
+&lt;/form&gt;
+
+&lt;!-- put focus into the username field on the form above --&gt;
+&lt;script language=&quot;JavaScript&quot;&gt;
+    &lt;!-- Begin
+    document.forms['password_reset_form'].elements['reset_username'].focus();
+    // End --&gt;
+&lt;/script&gt;
+

Added: tags/parley-0.55/root/base/user/lostpassword/reset_success
===================================================================
--- tags/parley-0.55/root/base/user/lostpassword/reset_success	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/lostpassword/reset_success	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,2 @@
+Your password has been set to the value you entered. You may now 
+&lt;a href=&quot;javascript:;&quot; onclick=&quot;login_dialog.show();&quot;&gt;login&lt;/a&gt;

Added: tags/parley-0.55/root/base/user/profile
===================================================================
--- tags/parley-0.55/root/base/user/profile	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/profile	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,58 @@
+&lt;!-- user/profile --&gt;
+&lt;h1&gt;User Profile&lt;/h1&gt;
+[% IF profiled_user %]
+
+&lt;table class=&quot;user_profile&quot;&gt;
+    &lt;tbody&gt;
+        &lt;tr&gt;
+            &lt;!-- user avatar --&gt;
+            [% avatar_file = c.path_to('root') _ &quot;/static/user_file/${profiled_user.id}/avatar.jpg&quot; %]
+            [% TRY %]
+                [% USE avatar = Image(avatar_file) %]
+                [% tmp = avatar.attr %]
+                &lt;td rowspan=&quot;4&quot;&gt;
+                    &lt;img class=&quot;picborder&quot; src=&quot;/static/user_file/[% profiled_user.id %]/avatar.jpg&quot; border=&quot;0&quot; [% avatar.attr %] alt=&quot;Avatar&quot; /&gt;
+                    &lt;br /&gt;
+                &lt;/td&gt;
+            [% CATCH %]
+                &lt;!-- No User Avatar --&gt;
+            [% END %]
+            &lt;!-- end : user avatar --&gt;
+            &lt;td class=&quot;user_profile_key&quot;&gt;
+                Nickname:
+            &lt;/td&gt;
+            &lt;td class=&quot;user_profile_value&quot;&gt;
+                [% profiled_user.forum_name %]
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;
+            &lt;td class=&quot;user_profile_key&quot;&gt;
+                Posts made:
+            &lt;/td&gt;
+            &lt;td class=&quot;user_profile_value&quot;&gt;
+                [% profiled_user.post_count %]
+            &lt;/td&gt;
+        &lt;/tr&gt;
+
+        &lt;tr&gt;
+            &lt;td class=&quot;user_profile_key&quot;&gt;
+                Last Post:
+            &lt;/td&gt;
+            &lt;td class=&quot;user_profile_value&quot;&gt;
+                [% IF profiled_user.last_post %]
+                &lt;a href=&quot;thread/view?thread=[% profiled_user.last_post.thread.id %]&quot;&gt;[% ForumCode.escape(profiled_user.last_post.thread.subject) %]&lt;/a&gt;
+                &lt;br /&gt;
+                [% nicedate(profiled_user.last_post.created) %]
+                [% ELSE %]
+                Never Posted
+                [% END %]
+            &lt;/td&gt;
+        &lt;/tr&gt;
+    &lt;/tbody&gt;
+&lt;/table&gt;
+
+[% ELSE %]
+&lt;p&gt;Can't locate a profile for requested user&lt;/p&gt;
+[% END %]
+&lt;!-- end : user/profile --&gt;

Added: tags/parley-0.55/root/base/user/signup/signup
===================================================================
--- tags/parley-0.55/root/base/user/signup/signup	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/base/user/signup/signup	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,140 @@
+&lt;h1&gt;User Signup&lt;/h1&gt;
+
+[% IF view.error.message %]
+    [% view.error.message %]
+    &lt;ul&gt;
+        [% FOREACH message IN view.error.messages %]
+            &lt;li&gt;[% message %]&lt;/li&gt;
+        [% END %]
+    &lt;/ul&gt;
+[% END %]
+
+&lt;form action=&quot;user/signup&quot; method=&quot;post&quot; name=&quot;signup_form&quot;&gt;
+    &lt;table class=&quot;signup&quot;&gt;
+		&lt;tr&gt;
+			&lt;td colspan=&quot;2&quot;&gt;
+				Complete the form below to create a new user account.
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		[% IF messages %]
+		&lt;tr&gt;
+			&lt;td colspan=&quot;2&quot;&gt;
+				The following errors were found in your submission:&lt;br /&gt;
+				&lt;ul&gt;
+                    &lt;ul&gt;
+                        [% FOREACH message IN messages %]
+                            &lt;li&gt;[% message %]&lt;/li&gt;
+                        [% END %]
+                    &lt;/ul&gt;
+				&lt;/ul&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		[% END %]
+
+		&lt;tr&gt;
+			&lt;td width=&quot;20%&quot;&gt;
+				&lt;label for=&quot;username&quot;&gt;Desired username:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;text&quot; id=&quot;new_username&quot; name=&quot;new_username&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_new_username %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;password&quot;&gt;Desired password:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;password&quot; id=&quot;new_password&quot; name=&quot;new_password&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_new_password %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;confirm_password&quot;&gt;Confirm password:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;password&quot; id=&quot;confirm_password&quot; name=&quot;confirm_password&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_confirm_password %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td colspan=&quot;2&quot;&gt;
+				Your email address will not be passed on to any third parties.
+				It will be used to send an activation link for the new account.
+                If you request thread update alerts this address will also be used
+                for the notification emails.
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;email&quot;&gt;Your email address:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;text&quot; id=&quot;email&quot; name=&quot;email&quot; size=&quot;40&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_email %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;confirm_email&quot;&gt;Confirm email address:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;text&quot; id=&quot;confirm_email&quot; name=&quot;confirm_email&quot; size=&quot;40&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_confirm_email %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;&lt;hr /&gt;&lt;/td&gt;&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;first_name&quot;&gt;First name:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;text&quot; id=&quot;first_name&quot; name=&quot;first_name&quot; size=&quot;40&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_first_name %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;first_name&quot;&gt;Last name:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;text&quot; id=&quot;last_name&quot; name=&quot;last_name&quot; size=&quot;40&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_last_name %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td&gt;
+				&lt;label for=&quot;first_name&quot;&gt;Forum name:&lt;/label&gt;
+			&lt;/td&gt;
+			&lt;td&gt;
+				&lt;input type=&quot;text&quot; id=&quot;forum_name&quot; name=&quot;forum_name&quot; size=&quot;40&quot; class=&quot;input_text&quot; /&gt;
+				[% form_error.field_error_forum_name %]
+			&lt;/td&gt;
+		&lt;/tr&gt;
+		&lt;tr&gt;
+            &lt;td&gt;&nbsp;&lt;/td&gt;
+			&lt;td style=&quot;text-align:justify;&quot;&gt;
+            Your &lt;em&gt;Forum Name&lt;/em&gt; will be displayed with all postings you make on the forums.
+            Forum names are all unique, so when two &quot;John Smith&quot;s register, only one will appear
+            as &quot;John Smith&quot; when posting. (Sorry other John Smith!)
+			&lt;/td&gt;
+		&lt;/tr&gt;
+
+		&lt;tr&gt;
+			&lt;td colspan=&quot;2&quot; style=&quot;text-align:center;&quot;&gt;
+				&lt;input type=&quot;submit&quot; name=&quot;form_submit&quot; value=&quot;Sign Up&quot; class=&quot;input_button&quot; /&gt;
+			&lt;/td&gt;
+		&lt;/tr&gt;
+    &lt;/table&gt;
+&lt;/form&gt;

Added: tags/parley-0.55/root/controls.js
===================================================================
--- tags/parley-0.55/root/controls.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/controls.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,446 @@
+// Copyright (c) 2005 Thomas Fuchs (<A HREF="http://script.aculo.us,">http://script.aculo.us,</A> <A HREF="http://mir.aculo.us">http://mir.aculo.us</A>)
+//           (c) 2005 Ivan Krstic (<A HREF="http://blogs.law.harvard.edu/ivan">http://blogs.law.harvard.edu/ivan</A>)
+// 
+// Permission is hereby granted, free of charge, to any person obtaining
+// a copy of this software and associated documentation files (the
+// &quot;Software&quot;), to deal in the Software without restriction, including
+// without limitation the rights to use, copy, modify, merge, publish,
+// distribute, sublicense, and/or sell copies of the Software, and to
+// permit persons to whom the Software is furnished to do so, subject to
+// the following conditions:
+// 
+// The above copyright notice and this permission notice shall be
+// included in all copies or substantial portions of the Software.
+// 
+// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
+// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
+// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
+// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
+// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+Element.collectTextNodesIgnoreClass = function(element, ignoreclass) {
+  var children = $(element).childNodes;
+  var text     = &quot;&quot;;
+  var classtest = new RegExp(&quot;^([^ ]+ )*&quot; + ignoreclass+ &quot;( [^ ]+)*$&quot;,&quot;i&quot;);
+  
+  for (var i = 0; i &lt; children.length; i++) {
+    if(children[i].nodeType==3) {
+      text+=children[i].nodeValue;
+    } else {
+      if((!children[i].className.match(classtest)) &amp;&amp; children[i].hasChildNodes())
+        text += Element.collectTextNodesIgnoreClass(children[i], ignoreclass);
+    }
+  }
+  
+  return text;
+}
+
+// Autocompleter.Base handles all the autocompletion functionality 
+// that's independent of the data source for autocompletion. This
+// includes drawing the autocompletion menu, observing keyboard
+// and mouse events, and similar.
+//
+// Specific autocompleters need to provide, at the very least, 
+// a getUpdatedChoices function that will be invoked every time
+// the text inside the monitored textbox changes. This method 
+// should get the text for which to provide autocompletion by
+// invoking this.getEntry(), NOT by directly accessing
+// this.element.value. This is to allow incremental tokenized
+// autocompletion. Specific auto-completion logic (AJAX, etc)
+// belongs in getUpdatedChoices.
+//
+// Tokenized incremental autocompletion is enabled automatically
+// when an autocompleter is instantiated with the 'tokens' option
+// in the options parameter, e.g.:
+// new Ajax.Autocompleter('id','upd', '/url/', { tokens: ',' });
+// will incrementally autocomplete with a comma as the token.
+// Additionally, ',' in the above example can be replaced with
+// a token array, e.g. { tokens: new Array (',', '\n') } which
+// enables autocompletion on multiple tokens. This is most 
+// useful when one of the tokens is \n (a newline), as it 
+// allows smart autocompletion after linebreaks.
+
+var Autocompleter = {}
+Autocompleter.Base = function() {};
+Autocompleter.Base.prototype = {
+  base_initialize: function(element, update, options) {
+    this.element     = $(element); 
+    this.update      = $(update);  
+    this.has_focus   = false; 
+    this.changed     = false; 
+    this.active      = false; 
+    this.index       = 0;     
+    this.entry_count = 0;
+
+    if (this.setOptions)
+      this.setOptions(options);
+    else
+      this.options = {}
+     
+    this.options.tokens       = this.options.tokens || new Array();
+    this.options.frequency    = this.options.frequency || 0.4;
+    this.options.min_chars    = this.options.min_chars || 1;
+    this.options.onShow       = this.options.onShow || 
+    function(element, update){ 
+      if(!update.style.position || update.style.position=='absolute') {
+        update.style.position = 'absolute';
+          var offsets = Position.cumulativeOffset(element);
+          update.style.left = offsets[0] + 'px';
+          update.style.top  = (offsets[1] + element.offsetHeight) + 'px';
+          update.style.width = element.offsetWidth + 'px';
+      }
+      new Effect.Appear(update,{duration:0.15});
+    };
+    this.options.onHide = this.options.onHide || 
+    function(element, update){ new Effect.Fade(update,{duration:0.15}) };
+    
+    if(this.options.indicator)
+      this.indicator = $(this.options.indicator);
+
+    if (typeof(this.options.tokens) == 'string') 
+      this.options.tokens = new Array(this.options.tokens);
+       
+    this.observer = null;
+    
+    Element.hide(this.update);
+    
+    Event.observe(this.element, &quot;blur&quot;, this.onBlur.bindAsEventListener(this));
+    Event.observe(this.element, &quot;keypress&quot;, this.onKeyPress.bindAsEventListener(this));
+  },
+
+  show: function() {
+    if(this.update.style.display=='none') this.options.onShow(this.element, this.update);
+    if(!this.iefix &amp;&amp; (navigator.appVersion.indexOf('MSIE')&gt;0) &amp;&amp; this.update.style.position=='absolute') {
+      new Insertion.After(this.update, 
+       '&lt;iframe id=&quot;' + this.update.id + '_iefix&quot; '+
+       'style=&quot;display:none;filter:progid:DXImageTransform.Microsoft.Alpha(opacity=0);&quot; ' +
+       'src=&quot;javascript:false;&quot; frameborder=&quot;0&quot; scrolling=&quot;no&quot;&gt;&lt;/iframe&gt;');
+      this.iefix = $(this.update.id+'_iefix');
+    }
+    if(this.iefix) {
+      Position.clone(this.update, this.iefix);
+      this.iefix.style.zIndex = 1;
+      this.update.style.zIndex = 2;
+      Element.show(this.iefix);
+    }
+  },
+  
+  hide: function() {
+    if(this.update.style.display=='') this.options.onHide(this.element, this.update);
+    if(this.iefix) Element.hide(this.iefix);
+  },
+  
+  startIndicator: function() {
+    if(this.indicator) Element.show(this.indicator);
+  },
+  
+  stopIndicator: function() {
+    if(this.indicator) Element.hide(this.indicator);
+  },
+
+  onKeyPress: function(event) {
+    if(this.active)
+      switch(event.keyCode) {
+       case Event.KEY_TAB:
+       case Event.KEY_RETURN:
+         this.select_entry();
+         Event.stop(event);
+       case Event.KEY_ESC:
+         this.hide();
+         this.active = false;
+         return;
+       case Event.KEY_LEFT:
+       case Event.KEY_RIGHT:
+         return;
+       case Event.KEY_UP:
+         this.mark_previous();
+         this.render();
+         if(navigator.appVersion.indexOf('AppleWebKit')&gt;0) Event.stop(event);
+         return;
+       case Event.KEY_DOWN:
+         this.mark_next();
+         this.render();
+         if(navigator.appVersion.indexOf('AppleWebKit')&gt;0) Event.stop(event);
+         return;
+      }
+     else 
+      if(event.keyCode==Event.KEY_TAB || event.keyCode==Event.KEY_RETURN) 
+        return;
+    
+    this.changed = true;
+    this.has_focus = true;
+    
+    if(this.observer) clearTimeout(this.observer);
+      this.observer = 
+        setTimeout(this.onObserverEvent.bind(this), this.options.frequency*1000);
+  },
+  
+  onHover: function(event) {
+    var element = Event.findElement(event, 'LI');
+    if(this.index != element.autocompleteIndex) 
+    {
+        this.index = element.autocompleteIndex;
+        this.render();
+    }
+    Event.stop(event);
+  },
+  
+  onClick: function(event) {
+    var element = Event.findElement(event, 'LI');
+    this.index = element.autocompleteIndex;
+    this.select_entry();
+    Event.stop(event);
+  },
+  
+  onBlur: function(event) {
+    // needed to make click events working
+    setTimeout(this.hide.bind(this), 250);
+    this.has_focus = false;
+    this.active = false;     
+  }, 
+  
+  render: function() {
+    if(this.entry_count &gt; 0) {
+      for (var i = 0; i &lt; this.entry_count; i++)
+        this.index==i ? 
+          Element.addClassName(this.get_entry(i),&quot;selected&quot;) : 
+          Element.removeClassName(this.get_entry(i),&quot;selected&quot;);
+        
+      if(this.has_focus) { 
+        if(this.get_current_entry().scrollIntoView) 
+          this.get_current_entry().scrollIntoView(false);
+        
+        this.show();
+        this.active = true;
+      }
+    } else this.hide();
+  },
+  
+  mark_previous: function() {
+    if(this.index &gt; 0) this.index--
+      else this.index = this.entry_count-1;
+  },
+  
+  mark_next: function() {
+    if(this.index &lt; this.entry_count-1) this.index++
+      else this.index = 0;
+  },
+  
+  get_entry: function(index) {
+    return this.update.firstChild.childNodes[index];
+  },
+  
+  get_current_entry: function() {
+    return this.get_entry(this.index);
+  },
+  
+  select_entry: function() {
+    this.active = false;
+    value = Element.collectTextNodesIgnoreClass(this.get_current_entry(), 'informal').unescapeHTML();
+    this.updateElement(value);
+    this.element.focus();
+  },
+
+  updateElement: function(value) {
+    var last_token_pos = this.findLastToken();
+    if (last_token_pos != -1) {
+      var new_value = this.element.value.substr(0, last_token_pos + 1);
+      var whitespace = this.element.value.substr(last_token_pos + 1).match(/^\s+/);
+      if (whitespace)
+        new_value += whitespace[0];
+      this.element.value = new_value + value;
+    } else {
+      this.element.value = value;
+    } 
+  },
+  
+  updateChoices: function(choices) {
+    if(!this.changed &amp;&amp; this.has_focus) {
+      this.update.innerHTML = choices;
+      Element.cleanWhitespace(this.update);
+      Element.cleanWhitespace(this.update.firstChild);
+
+      if(this.update.firstChild &amp;&amp; this.update.firstChild.childNodes) {
+        this.entry_count = 
+          this.update.firstChild.childNodes.length;
+        for (var i = 0; i &lt; this.entry_count; i++) {
+          entry = this.get_entry(i);
+          entry.autocompleteIndex = i;
+          this.addObservers(entry);
+        }
+      } else { 
+        this.entry_count = 0;
+      }
+      
+      this.stopIndicator();
+      
+      this.index = 0;
+      this.render();
+    }
+  },
+
+  addObservers: function(element) {
+    Event.observe(element, &quot;mouseover&quot;, this.onHover.bindAsEventListener(this));
+    Event.observe(element, &quot;click&quot;, this.onClick.bindAsEventListener(this));
+  },
+
+  onObserverEvent: function() {
+    this.changed = false;   
+    if(this.getEntry().length&gt;=this.options.min_chars) {
+      this.startIndicator();
+      this.getUpdatedChoices();
+    } else {
+      this.active = false;
+      this.hide();
+    }
+  },
+
+  getEntry: function() {
+    var token_pos = this.findLastToken();
+    if (token_pos != -1)
+      var ret = this.element.value.substr(token_pos + 1).replace(/^\s+/,'').replace(/\s+$/,'');
+    else
+      var ret = this.element.value;
+    
+    return /\n/.test(ret) ? '' : ret;
+  },
+
+  findLastToken: function() {
+    var last_token_pos = -1;
+
+    for (var i=0; i&lt;this.options.tokens.length; i++) {
+      var this_token_pos = this.element.value.lastIndexOf(this.options.tokens[i]);
+      if (this_token_pos &gt; last_token_pos)
+        last_token_pos = this_token_pos;
+    }
+    return last_token_pos;
+  }
+}
+
+Ajax.Autocompleter = Class.create();
+Ajax.Autocompleter.prototype = Object.extend(new Autocompleter.Base(), 
+Object.extend(new Ajax.Base(), {
+  initialize: function(element, update, url, options) {
+          this.base_initialize(element, update, options);
+    this.options.asynchronous  = true;
+    this.options.onComplete    = this.onComplete.bind(this)
+    this.options.method        = 'post';
+    this.options.defaultParams = this.options.parameters || null;
+    this.url                   = url;
+  },
+  
+  getUpdatedChoices: function() {
+    entry = encodeURIComponent(this.element.name) + '=' + 
+      encodeURIComponent(this.getEntry());
+      
+    this.options.parameters = this.options.callback ?
+      this.options.callback(this.element, entry) : entry;
+        
+    if(this.options.defaultParams) 
+      this.options.parameters += '&amp;' + this.options.defaultParams;
+    
+    new Ajax.Request(this.url, this.options);
+  },
+  
+  onComplete: function(request) {
+    this.updateChoices(request.responseText);
+  }
+
+}));
+
+// The local array autocompleter. Used when you'd prefer to
+// inject an array of autocompletion options into the page, rather
+// than sending out Ajax queries, which can be quite slow sometimes.
+//
+// The constructor takes four parameters. The first two are, as usual,
+// the id of the monitored textbox, and id of the autocompletion menu.
+// The third is the array you want to autocomplete from, and the fourth
+// is the options block.
+//
+// Extra local autocompletion options:
+// - choices - How many autocompletion choices to offer
+//
+// - partial_search - If false, the autocompleter will match entered
+//                    text only at the beginning of strings in the 
+//                    autocomplete array. Defaults to true, which will
+//                    match text at the beginning of any *word* in the
+//                    strings in the autocomplete array. If you want to
+//                    search anywhere in the string, additionally set
+//                    the option full_search to true (default: off).
+//
+// - full_search - Search anywhere in autocomplete array strings.
+//
+// - partial_chars - How many characters to enter before triggering
+//                   a partial match (unlike min_chars, which defines
+//                   how many characters are required to do any match
+//                   at all). Defaults to 2.
+//
+// - ignore_case - Whether to ignore case when autocompleting.
+//                 Defaults to true.
+//
+// It's possible to pass in a custom function as the 'selector' 
+// option, if you prefer to write your own autocompletion logic.
+// In that case, the other options above will not apply unless
+// you support them.
+
+Autocompleter.Local = Class.create();
+Autocompleter.Local.prototype = Object.extend(new Autocompleter.Base(), {
+  initialize: function(element, update, array, options) {
+    this.base_initialize(element, update, options);
+    this.options.array = array;
+  },
+
+  getUpdatedChoices: function() {
+    this.updateChoices(this.options.selector(this));
+  },
+
+  setOptions: function(options) {
+    this.options = Object.extend({
+      choices: 10,
+      partial_search: true,
+      partial_chars: 2,
+      ignore_case: true,
+      full_search: false,
+      selector: function(instance) {
+        var ret       = new Array(); // Beginning matches
+        var partial   = new Array(); // Inside matches
+        var entry     = instance.getEntry();
+        var count     = 0;
+        
+        for (var i = 0; i &lt; instance.options.array.length &amp;&amp;  
+            ret.length &lt; instance.options.choices ; i++) { 
+          var elem = instance.options.array[i];
+          var found_pos = instance.options.ignore_case ? 
+            elem.toLowerCase().indexOf(entry.toLowerCase()) : 
+            elem.indexOf(entry);
+
+          while (found_pos != -1) {
+            if (found_pos == 0 &amp;&amp; elem.length != entry.length) { 
+              ret.push(&quot;&lt;li&gt;&lt;strong&gt;&quot; + elem.substr(0, entry.length) + &quot;&lt;/strong&gt;&quot; + 
+                elem.substr(entry.length) + &quot;&lt;/li&gt;&quot;);
+              break;
+            } else if (entry.length &gt;= instance.options.partial_chars &amp;&amp; 
+              instance.options.partial_search &amp;&amp; found_pos != -1) {
+              if (instance.options.full_search || /\s/.test(elem.substr(found_pos-1,1))) {
+                partial.push(&quot;&lt;li&gt;&quot; + elem.substr(0, found_pos) + &quot;&lt;strong&gt;&quot; +
+                  elem.substr(found_pos, entry.length) + &quot;&lt;/strong&gt;&quot; + elem.substr(
+                  found_pos + entry.length) + &quot;&lt;/li&gt;&quot;);
+                break;
+              }
+            }
+
+            found_pos = instance.options.ignore_case ? 
+              elem.toLowerCase().indexOf(entry.toLowerCase(), found_pos + 1) : 
+              elem.indexOf(entry, found_pos + 1);
+
+          }
+        }
+        if (partial.length)
+          ret = ret.concat(partial.slice(0, instance.options.choices - ret.length))
+        return &quot;&lt;ul&gt;&quot; + ret.join('') + &quot;&lt;/ul&gt;&quot;;
+      }
+    }, options || {});
+  }
+});


Property changes on: tags/parley-0.55/root/controls.js
___________________________________________________________________
Name: svn:mime-type
   + text/cpp

Added: tags/parley-0.55/root/css/common.css
===================================================================
--- tags/parley-0.55/root/css/common.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/css/common.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,462 @@
+div#userinfo_box {
+    position:       absolute;
+    top:            0;
+    right:          0;
+    height:         70px;
+    width:          200px;
+    border:         none;
+    background:     #eee;
+    padding-top:    3px;
+    padding-right:  10px;
+    text-align:     right;
+}
+
+/* link styling */
+a.nav, a.nav:visited, a.nav:link, a.nav:active {
+    background:         #ccc;
+    border:             solid black 1px;
+    border-style:       outset;
+    display:            block;
+    font-size:          0.8em;
+    font-weight:        bold;
+    list-style-image:   none;
+    list-style-type:    none;
+    margin-left:        20px;
+    margin-top:         0px;
+    padding-bottom:     0.2em;
+    padding-left:       0.5em;
+    padding-top:        0.2em;
+    text-decoration:    none;
+    width:              120px;
+}
+
+h1 {
+    font-size: 1.1em;
+    font-weight: bold;
+}
+h2 {
+    font-size: 1em;
+    font-weight: bold;
+}
+h3 {
+    font-size: 1em;
+    font-weight: bold;
+    font-style:     italic;
+}
+
+
+a.nav:hover {
+    background:         #000;
+    color:              #fff;
+}
+
+a, a:link, a:visited, a:active {
+    background:         transparent;
+    color:              blue;
+    text-decoration:    none;
+}
+
+th {
+    text-align:         left;
+    font-weight:        bold;
+}
+
+td {
+    border:             1px solid #888;
+    padding:            3px;
+}
+
+/* start : dojo menu styling */
+.dojoMenuBar2 {
+    border-top:1px solid #d4d4d4;
+}
+.dojoPopupMenu2 td {
+    border: none;
+}
+/* end : dojo menu styling */
+
+.dojoTabPaneWrapper {
+  padding : 10px 10px 10px 10px;
+}
+
+/* dojo dialog styling - initially taken from dojo demo */
+.dojoDialog {
+    background : #eee;
+    border : 1px solid #999;
+    -moz-border-radius : 5px;
+    padding : 4px;
+}
+
+/* login dialog styling */
+#login_dialog form {  /* set width in form, not fieldset (still takes up more room w/ fieldset width */
+    margin: 0;
+    padding: 0;
+    min-width: 400px;
+    max-width: 600px;
+}
+#login_dialog form fieldset {
+    / * clear: both; note that this clear causes inputs to break to left in ie5.x mac, commented out */
+    border-color: #000;
+    border-width: 1px;
+    border-style: solid;
+    padding: 10px;        /* padding in fieldset support spotty in IE */
+    margin: 0;
+}
+#login_dialog form label { 
+    display: block;  /* block float the labels to left column, set a width */
+    float: left; 
+    width: 150px; 
+    padding: 0; 
+    margin: 5px 0 0; /* set top margin same as form input - textarea etc. elements */
+    text-align: right; 
+    font-weight: bold;
+    margin-bottom : 0;
+}
+#login_dialog form input, form textarea {
+    /* display: inline; inline display must not be set or will hide submit buttons in IE 5x mac */
+    width:auto;      /* set width of form elements to auto-size, otherwise watch for wrap on resize */
+    margin:5px 0 0 10px; /* set margin on left of form elements rather than right of
+                              label aligns textarea better in IE */
+}
+#login_dialog form p {
+    font-size: 0.8em;
+}
+
+/* style classes */
+
+.right_align {
+    text-align: right;
+}
+
+.center_align {
+    text-align: center;
+}
+
+
+.forum_link {
+    font-weight:    bold;
+}
+.forum_description {
+    font-size:      0.8em;
+}
+
+.topic_link {
+    font-weight:    bold;
+}
+.topic_creator {
+    display:        block;
+    font-size:      0.8em;
+    /*text-align:     right;*/
+    float: right;
+}
+.forum_mini_pager {
+    display:        block;
+    font-size:      0.8em;
+    /*text-align:     right;*/
+    float: left;
+}
+.topic_last_post {
+    font-size:      0.8em;
+}
+
+.post_subject {
+    font-weight:    bold;
+}
+
+.post_creator {
+    font-weight:    bold;
+    font-style:     italic;
+    font-size:      0.9em;
+}
+
+.post_created {
+    text-align:     right;
+    font-size:      0.8em;
+}
+
+.reply_post_message {
+    width: 100%;
+    background-color: rgb(251,215,194);
+    border: 2px inset #fff;
+}
+
+.post_message {
+    width: 100%;
+    background-color: rgb(251,215,194);
+    border: 2px inset #fff;
+    display: block;
+}
+
+.innerpost {
+    overflow:       auto;
+}
+
+.in_response_to {
+    margin-left:    20px;
+    font-weight:    bold;
+    font-style:     italic;
+    font-size:      0.8em;
+}
+
+.quoted_message {
+        border:         solid black 1pt;
+        background:     #ccc;
+        /*font-family:    &quot;courier new&quot;, courier, fixed;*/
+        color:          #000;
+        margin-left:    20px;
+        margin-right:   0px;
+        margin-top:     0px;
+        margin-bottom:  0px;
+        padding:        2px;
+        font-size:      0.9em;
+
+        display: block;
+        overflow: auto;
+}
+
+
+.no_table_border table {
+    border: none;
+}
+.no_table_border td {
+    border: none;
+}
+
+.thread_watch {
+    font-size:          x-small;
+}
+.pager_advanced {
+    font-size:          x-small;
+}
+.moderator_list {
+    font-size:          x-small;
+}
+
+.interval_ago {
+    display:            block;
+    text-align:         right;
+    font-size:          x-small;
+}
+
+.thread_header {
+    font-weight:        bold;
+    background:         #666;
+    padding:            4px;
+}
+
+.forum_list {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+.forum_list td {
+    vertical-align:     top;
+    border:             none;
+    border:             1px dashed #ddd;
+}
+
+.forum_view {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+.forum_view td {
+    vertical-align:     top;
+    border:             none;
+    border:             1px dashed #ddd;
+}
+
+.recently_updated {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+.recently_updated td {
+    vertical-align:     top;
+    border:             1px dashed #ddd;
+}
+
+.thread_watches {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+.thread_watches td {
+    vertical-align:     top;
+    border:             1px dashed #ddd;
+}
+
+.search_results {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+
+.signup {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+
+.user_profile {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+.user_profile td {
+    vertical-align:     top;
+}
+
+.prefs_notification {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+
+.user_profile_key {
+    font-weight:        bold;
+    text-align:         right;
+    vertical-align:     top;
+}
+
+td.user_profile_key {
+    width:              120px;
+}
+
+.user_profile_value {
+    font-weight:        none;
+    text-align:         left;
+    vertical-align:     top;
+}
+
+.thread_posts {
+    margin-left:        auto;
+    margin-right:       auto;
+    width:              80%;
+}
+
+.thread_info {
+    margin:             0px;
+    width:              100%;
+    border:             none;
+    padding:            0px;
+}
+
+.thread_info td {
+    border:             none;
+    padding:            0px;
+}
+
+.post {
+    padding-top:        5px;
+    vertical-align:     top;
+}
+
+.post_edited_alert {
+    font-weight:    bold;
+    font-style:     italic;
+    font-size:      0.8em;
+}
+
+.user_post_info {
+    background:         #ccc;
+    font-size:          85%;
+    margin-left:        auto;
+    margin-right:       auto;
+    text-align:         center;
+    vertical-align:     top;
+    width:              100px;
+}
+
+.quote {
+    background-color:   #F9FBFF;
+    border:             1px solid #333;
+    font-size:          95%;
+    margin:             0 0 2px 4px;
+    padding:            6px;
+    width:              85%;
+    overflow:           hidden;
+}
+
+.post_info {
+    font-size:          80%;
+    line-height:        1.1em;
+    margin-top:         10px;
+    margin-bottom:      2px;
+    text-align:         right;
+}
+
+a.button:visited, a.button:link, a.button:active, .button, a.button {
+    border:             2px solid;
+    border-color:       #FC9 #630 #330 #F96;
+    padding:            2px 7px 2px 7px;
+    font:               bold 0.9em verdana,sans-serif;
+    color:              #000;
+    background:         #ccc;
+    text-decoration:    none;
+    margin:             2px;
+}
+
+
+
+form {  /* set width in form, not fieldset (still takes up more room w/ fieldset width */
+  margin: 0;
+  margin-left: auto;
+  margin-right: auto;
+  padding: 0;
+  /*min-width: 500px;*/
+  max-width: 600px;
+  width: 560px;
+  /*background: red;*/
+}
+
+form input, form textarea {
+    /* display: inline; inline display must not be set or will hide submit buttons in IE 5x mac */
+    width:auto;      /* set width of form elements to auto-size, otherwise watch for wrap on resize */
+    margin:5px 0 0 10px; /* set margin on left of form elements rather than right of
+                              label aligns textarea better in IE */
+}
+
+form input#reset {
+    margin-left:0px; /* set margin-left back to zero on reset button (set above) */
+}
+
+form label { 
+    display: block;  /* block float the labels to left column, set a width */
+    float: left;
+    width: 150px;
+    padding: 0;
+    margin: 5px 0 0; /* set top margin same as form input - textarea etc. elements */
+    text-align: right;
+    font-weight: bold;
+}
+
+
+
+a[href $='.jpg']{
+    padding-left: 20px;
+    background:   transparent url(/static/images/filetypes/image.png) no-repeat center left;
+}
+
+a[href $='.pdf']{
+    padding-left: 20px;
+    background:   transparent url(/static/images/filetypes/pdf.png) no-repeat center left;
+}
+
+
+.help li {
+    margin-top:     5px;
+}
+
+.error_messages {
+    width:              80%;
+    margin-top:         10px;
+    margin-bottom:      10px;
+    margin-left:        auto;
+    margin-right:       auto;
+    border:             2px solid black;
+    color:              white;
+    background-color:   red;
+    font-weight:        bold;
+    padding:            5px;
+}

Added: tags/parley-0.55/root/css/default.css
===================================================================
--- tags/parley-0.55/root/css/default.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/css/default.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,1007 @@
+/* $Id$ */
+
+body {
+    background:  rgb(171,121,100);
+    background:  #fff;
+    color:       #000;
+    font-family: verdana, arial, helvetica, sans-serif;
+    margin:      0px 0px 0px 0px;
+    padding:     0px 0px 0px 0px;
+    font-size:   12px;
+}
+
+
+/* sections of the screen */
+#top {
+    background: url(&quot;images/logo.png&quot;) top left no-repeat rgb(171,121,100);
+    border:     0px;
+    margin:     0px 0px 0px 0px;
+    padding:    10px;
+    height:     70px; 
+}
+#left {
+    background: transparent;
+    border:     0px;
+    left:       0px;
+    margin:     0px;
+    padding-left:    10px;
+    padding-right:    10px;
+    position:   absolute;
+    top:        100px;
+    width:      150px; 
+    font-size: 0.9em;
+}
+#middle {
+    background: transparent;
+    border:      0px;
+    padding:     10px;
+    top:         90px;
+    margin-left: 170px;
+    margin-top:  20px;
+    margin-bottom: 0px;
+}
+
+#footer {
+    border: 0px;
+    background: transparent;
+    margin: 0px 0px 0px 150px;
+    clear: both;
+    text-align:     right;
+    padding-top: 1em;
+    padding-right: 1em;
+}
+
+#footer p {
+    color: #999;
+    font-size: 0.9em;
+    margin: 0;
+}
+
+
+#statusbar {
+    background-color: #97b3cf;
+    background-color: rgb(213,158,128);
+
+    border:        none;
+    border:        2px ridge #ccc;
+    
+    height:        1.6em;
+    left:          0px;
+    margin-left:   0px;
+    margin-right:  0px;
+    position:      absolute;
+    right:         0px;
+    text-align:    right;
+    top:           70px;
+    padding-top: 1px;
+    padding-bottom: 1px;
+    padding-right: 1em;
+
+    font-size: 0.9em;
+}
+
+#statusbar table {
+    margin-left: 5px;
+    border: 0px solid #999;
+    padding: 0px;
+}
+#statusbar td {
+    border: 0px solid #999;
+    text-align: left;
+    vertical-align: top;
+    border-collapse: collapse;
+    margin: 5px;
+    padding: 0px;
+}
+#statusbar td.left {
+    text-align: left;
+}
+#statusbar td.right {
+    text-align: right;
+}
+
+
+/* use dl/dt/dd to make left nav */
+dd {
+    /* hide dd from graphical browsers, they should appear for text-only
+    * browsers, giving a nice description of the link */
+    display: none;
+}
+
+dt.nav_header {
+    display:block;
+    width: 140px;
+    color: black;
+
+    background: #ccc;
+    border: solid black 1px;
+    border-style: outset;
+    font-weight: bold;
+    list-style-image: none;
+    list-style-type: none;
+    margin-top: 0.4em;
+    padding-left: 0.5em;
+    padding-top: 0.2em;
+    padding-bottom: 0.2em;
+    text-decoration: none;
+}
+
+/* class for nav stuff in left menu */
+a.nav, a.nav:visited, a.nav:link, a.nav:active {
+    display:block;
+    width: 120px;
+
+    background: #ccc;
+    border: solid black 1px;
+    border-style: outset;
+    font-weight: bold;
+    list-style-image: none;
+    list-style-type: none;
+    margin-top: 0px;
+    margin-left: 20px;
+    padding-left: 0.5em;
+    padding-top: 0.2em;
+    padding-bottom: 0.2em;
+    text-decoration: none;
+    font-size: 0.8em;
+}
+
+a.nav:hover {
+    background:#000;
+    color:#fff;
+}
+
+a, a:link, a:visited, a:active {
+    text-decoration: none;
+    color: blue;
+    /*border-bottom: 1px dotted #bbb;*/
+    background: transparent;
+}
+
+/*
+table {
+    border: 1px solid #999;
+    width:  100%;
+}
+
+td {
+    border: 1px solid #999;
+    text-align: left;
+    vertical-align: top;
+    border-collapse: collapse;
+    margin: 5px;
+    padding: 5px;
+}
+th {
+    padding-left: 0.4em;
+    text-align: left;
+    border: 1px solid #999;
+}
+*/
+h1 {
+    font-size: 1.1em;
+    font-weight: bold;
+}
+h2 {
+    font-size: 1em;
+    font-weight: bold;
+}
+
+/* colour things differently if they're deleted */
+.deleted, .deleted a {
+    background: #622;
+    color: #ff0;
+}
+
+/* colour users differently if they're not-active/usthenticated */
+.nonauth, .nonauth a {
+    background: orange;
+    color: #000;
+}
+
+.right_align {
+    text-align: right;
+    /*background: #f00;*/
+}
+
+.header_row {
+    background: #666;
+    color:      #ff0;
+}
+
+.codeblock {
+        border:         solid black 1pt;
+        background:     #ccc;
+        font-family:    &quot;courier new&quot;, courier, fixed;
+        color:          #000;
+        margin-left:    0px;
+        margin-right:   0px;
+        margin-top:     5px;
+        margin-bottom:  5px;
+        padding:        5px;
+        line-height:    1.5em;
+
+        display: block;
+        overflow: auto;
+        white-space: pre;
+}
+
+.codeblockhilite {
+        background:                     #ff6;
+        border:                         dashed black 1px;
+}
+
+
+.quoted_reply_textarea {
+    background-color: #ccc;
+    background-color: #c4cacf;
+    background-color: rgb(250,180,180);
+    border: 2px inset #fff;
+    font-family: verdana, arial, helvetica, sans-serif;
+    font-size:   0.8em;
+}
+
+.input_text {
+    background-color: #ccc;
+    background-color: #c4cacf;
+    background-color: rgb(251,215,194);
+    border: 2px inset #fff;
+    font-family: verdana, arial, helvetica, sans-serif;
+    font-size:   1em;
+}
+
+.input_button {
+    background-color: #97b3cf;
+    background-color: rgb(251,215,194);
+    font-family: verdana, arial, helvetica, sans-serif;
+    font-size:   1em;
+    border: 2px ridge #000;
+}
+
+.small_input_button {
+    background-color: #97b3cf;
+    background-color: rgb(251,215,194);
+    font-family: verdana, arial, helvetica, sans-serif;
+    font-size:   0.8em;
+    border: 2px ridge #000;
+}
+
+.niceform {
+    background-color: #369;
+    color: #fff;
+    font-family: verdana, arial, helvetica, sans-serif;
+    font-size:   1em;
+}
+
+.forum_link {
+    font-weight:    bold;
+}
+.forum_description {
+    font-size:      0.8em;
+}
+
+.topic_link {
+    font-weight:    bold;
+}
+.topic_creator {
+    display:        block;
+    font-size:      0.8em;
+    /*text-align:     right;*/
+    float: right;
+}
+.forum_mini_pager {
+    display:        block;
+    font-size:      0.8em;
+    /*text-align:     right;*/
+    float: left;
+}
+.topic_last_post {
+    font-size:      0.8em;
+}
+
+.post_subject {
+    font-weight:    bold;
+}
+
+.post_creator {
+    font-weight:    bold;
+    font-style:     italic;
+    font-size:      0.9em;
+}
+
+.post_created {
+    text-align:     right;
+    font-size:      0.8em;
+}
+
+.reply_post_message {
+    width: 100%;
+    background-color: rgb(251,215,194);
+    border: 2px inset #fff;
+}
+
+.post_message {
+    width: 100%;
+    background-color: rgb(251,215,194);
+    border: 2px inset #fff;
+    display: block;
+}
+
+.in_response_to {
+    margin-left:    20px;
+    font-weight:    bold;
+    font-style:     italic;
+    font-size:      0.8em;
+}
+
+.quoted_message {
+        border:         solid black 1pt;
+        background:     #ccc;
+        /*font-family:    &quot;courier new&quot;, courier, fixed;*/
+        color:          #000;
+        margin-left:    20px;
+        margin-right:   0px;
+        margin-top:     0px;
+        margin-bottom:  0px;
+        padding:        2px;
+        font-size:      0.9em;
+
+        display: block;
+        overflow: auto;
+}
+
+
+.no_table_border table {
+    border: none;
+}
+.no_table_border td {
+    border: none;
+}
+
+.inline_form {
+    display: inline;
+}
+
+.post_edited_alert {
+    font-weight:    bold;
+    font-style:     italic;
+    font-size:      0.8em;
+}
+
+
+a.button:visited, a.button:link, a.button:active, .button, a.button {
+    border:             2px solid;
+    border-color:       #FC9 #630 #330 #F96;
+    padding:            2px 7px 2px 7px;
+    font:               bold 0.8em verdana,sans-serif;
+    color:              #000;
+    background:         #ccc;
+    text-decoration:    none;
+    margin:             0;
+}
+
+
+/* login dialog styling */
+#login_dialog form {  /* set width in form, not fieldset (still takes up more room w/ fieldset width */
+    margin: 0;
+    padding: 0;
+    min-width: 400px;
+    max-width: 600px;
+}
+#login_dialog form fieldset {
+    / * clear: both; note that this clear causes inputs to break to left in ie5.x mac, commented out */
+    border-color: #000;
+    border-width: 1px;
+    border-style: solid;
+    padding: 10px;        /* padding in fieldset support spotty in IE */
+    margin: 0;
+}
+#login_dialog form label { 
+    display: block;  /* block float the labels to left column, set a width */
+    float: left; 
+    width: 150px; 
+    padding: 0; 
+    margin: 5px 0 0; /* set top margin same as form input - textarea etc. elements */
+    text-align: right; 
+    font-weight: bold;
+    margin-bottom : 0;
+}
+#login_dialog form input, form textarea {
+    /* display: inline; inline display must not be set or will hide submit buttons in IE 5x mac */
+    width:auto;      /* set width of form elements to auto-size, otherwise watch for wrap on resize */
+    margin:5px 0 0 10px; /* set margin on left of form elements rather than right of
+                              label aligns textarea better in IE */
+}
+#login_dialog form p {
+    font-size: 0.8em;
+}
+
+ 
+
+/* search dialog styling */
+#search_dialog form {  /* set width in form, not fieldset (still takes up more room w/ fieldset width */
+    margin: 0;
+    padding: 0;
+    min-width: 400px;
+    max-width: 600px;
+}
+#search_dialog form fieldset {
+    / * clear: both; note that this clear causes inputs to break to left in ie5.x mac, commented out */
+    border-color: #000;
+    border-width: 1px;
+    border-style: solid;
+    padding: 10px;        /* padding in fieldset support spotty in IE */
+    margin: 0;
+}
+#search_dialog form label { 
+    display: block;  /* block float the labels to left column, set a width */
+    float: left; 
+    width: 150px; 
+    padding: 0; 
+    margin: 5px 0 0; /* set top margin same as form input - textarea etc. elements */
+    text-align: right; 
+    font-weight: bold;
+    margin-bottom : 0;
+}
+#search_dialog form input, form textarea {
+    /* display: inline; inline display must not be set or will hide submit buttons in IE 5x mac */
+    width:auto;      /* set width of form elements to auto-size, otherwise watch for wrap on resize */
+    margin:5px 0 0 10px; /* set margin on left of form elements rather than right of
+                              label aligns textarea better in IE */
+}
+#search_dialog form p {
+    font-size: 0.8em;
+}
+
+
+
+
+/* dojo dialog styling - initially taken from dojo demo */
+.dojoDialog {
+    background : #eee;
+    border : 1px solid #999;
+    -moz-border-radius : 5px;
+    padding : 4px;
+}
+
+form {
+    margin-bottom : 0;
+}
+
+
+
+/* Borrowed from ModelMayhem */
+body {
+font-family:Trebuchet, Verdana, Lucida Grande, Sapir Sans, Tahoma, Sans-Serif;
+font-size:80%;
+/*background-color:#E7E7E7;*/
+color:#000;
+letter-spacing:2%;
+line-height:1.3em;
+margin:0;
+padding:0;
+}
+
+#pic_wrapper {
+margin-bottom:6px;
+}
+
+.forum_title {
+font-size:110%;
+font-weight:700;
+}
+
+
+.ribbon {
+background-color:#F9FBFF;
+padding: 3px;
+border:1px solid #EBEEF2;
+
+}
+
+.g1 {
+border-bottom:1px solid red;
+}
+
+.g2 {
+border-bottom:1px solid blue;
+}
+
+.light {
+color:#666;
+}
+
+.small {
+font-size:85%;
+line-height:1.1em;
+}
+
+#navbox,#navbox a {
+height:20px;
+background-color:#000;
+text-align:center;
+font-weight:700;
+color:#FFF;
+font-size:105%;
+margin:0;
+}
+
+.searchhead {
+width:120px;
+text-align:right;
+font-weight:700;
+font-size:90%;
+background-color:#E1E4EA;
+}
+
+.linkbar {
+background-color:#F5F5F5;
+border:1px solid #E5E4E4;
+padding: 4px;
+margin-bottom: 8px;
+}
+
+.linkbar2 {
+width: 90%;
+background-color:#F5F5F5;
+border:1px solid #9CA0AD;
+padding: 4px;
+margin-bottom: 8px;
+}
+
+#searchtable {
+background-color:#F5F5F5;
+}
+
+#searchtable td {
+padding:3px;
+}
+
+.menubox {
+background-color:#F9FBFF;
+border:1px solid #9CA0AD;
+clear:both;
+width:150px;
+white-space:nowrap;
+vertical-align:middle;
+margin:2px 0;
+padding:2px;
+}
+
+.mycoms {
+border-bottom:1px solid #333333;
+}
+
+.menubox2 {
+background-color:#F9FBFF;
+border:1px solid red;
+clear:both;
+width:150px;
+white-space:nowrap;
+vertical-align:middle;
+margin:2px 0;
+padding:2px;
+}
+
+.headerbar {
+background-color:#666;
+color:#FFF;
+padding:4px;
+}
+
+.thepagenums {
+font-size:92%;
+}
+
+.thepagenums b {
+font-style:normal;
+font-weight:700;
+font-size:120%;
+padding:2px;
+}
+
+.thepagenums a {
+font-weight:400;
+margin:0;
+padding:3px 2px;
+}
+
+.googlead {
+background-color:#333;
+width:728px;
+margin:4px auto;
+}
+
+.forumtop {
+background-color:#999;
+border: none;
+padding: 0;
+margin: 0;
+border-bottom:1px solid #9CA0AD;
+}
+
+.forumtop2 {
+background-color:#333;
+color:#FFF;
+font-size:85%;
+padding:2px;
+}
+
+.postwrap {
+margin: 0;
+padding: 0;
+border-bottom:1px dashed #9CA0AD;
+background-color: transparent;
+}
+
+.postbit {
+margin: 0;
+padding: 0;
+padding:6px 0 8px 9px;
+}
+
+.post {
+border: none;
+margin: 0;
+padding: 0;
+padding:10px 6px 8px 8px;
+}
+
+.labelpicpage {
+width: 150px;
+font-size: 90%;
+font-weight: bold;
+background-color:#EBEEF2;
+text-align: right;
+}
+
+.post_b {
+background-color:#f9f9fb;
+border-bottom:1px solid #999;
+padding:2px;
+}
+
+.quote {
+width:90%;
+border:1px solid #333;
+font-size:95%;
+background-color:#F9FBFF;
+margin:0 0 2px 14px;
+padding:6px;
+}
+
+.last_post {
+font-family:Tahoma, Sans-Serif;
+font-size:95%;
+color:#7C879D;
+text-align:justify;
+}
+
+.caption {
+margin-bottom:14px;
+margin-left:auto;
+margin-right:auto;
+width:400px;
+font-weight:700;
+text-align:center;
+padding:0 9px 6px 24px;
+}
+
+textarea,.bginput {
+font:10pt verdana, geneva, lucida, 'lucida grande', arial, helvetica, sans-serif;
+}
+
+img.leftie {
+border:none;
+margin-right:9px;
+margin-bottom:6px;
+}
+
+.logobar {
+background:#FFF;
+width:800px;
+margin-left:auto;
+margin-right:auto;
+padding:0;
+}
+
+table.navbarwrap {
+width:800px;
+font-weight:700;
+background:#000;
+margin-left:auto;
+border-top:1px solid #000;
+border-bottom:1px solid #000;
+margin-right:auto;
+}
+
+table.navbar {
+margin:0;
+}
+
+.lineit {
+color:#000;
+border-right:1px solid #666;
+}
+
+.lineit a {
+color:#333;
+display:block;
+position:relative;
+text-decoration:none;
+padding:2px 10px;
+}
+
+.lineit a:hover {
+background-color:#292B2C;
+}
+
+table.maintable {
+width:100%;
+background-color:#FFF;
+margin-left:auto;
+margin-right:auto;
+padding:15px 24px 16px;
+border: none;
+}
+
+td, th, tr {
+    border: none;
+    margin: none;
+    padding: none;
+}
+
+.footerbox {
+width:100%;
+color:#333;
+background-color:#F4F4F5;
+font-size:90%;
+text-align:right;
+border-top:1px solid #ccc;
+margin-botom:16px;
+margin-left:auto;
+margin-right:auto;
+padding:5px;
+}
+
+.footerbox a:990000 {
+color:#FFF;
+}
+
+hr {
+border-top:1px solid #ddd;
+color:#fff;
+background-color:#fff;
+height:1px;
+width:90%;
+margin-top:22px;
+margin-bottom:12px;
+}
+
+#bg_wrap {
+width:800px;
+margin-left:auto;
+margin-right:auto;
+padding:0;
+}
+
+.head {
+background:url(/images/head.gif) #F4F4F5 repeat-x;
+border:1px solid #CCC;
+clear:both;
+color:#333;
+font-weight:700;
+text-align:left;
+white-space:nowrap;
+margin:16px 2px 4px 0;
+padding:2px 5px;
+}
+
+.head_thin {
+background:url(/images/head.gif) #F4F4F5 repeat-x;
+border:1px solid #CCC;
+clear:both;
+color:#333;
+font-weight:700;
+text-align:left;
+white-space:nowrap;
+margin:4px 2px 4px 0;
+padding:2px 5px 2px 0;
+}
+
+.dotline {
+border:1px dashed #CCC;
+clear:both;
+text-align:left;
+white-space:nowrap;
+margin:4px 2px 4px 0;
+padding:2px 5px 2px 0;
+}
+
+.head_top {
+background:url(/images/head.gif) #F4F4F5 repeat-x;
+border:1px solid #CCC;
+clear:both;
+color:#333;
+font-weight:700;
+text-align:left;
+white-space:nowrap;
+margin:0 2px 4px 0;
+padding:2px 5px;
+}
+
+.head_forums {
+background:url(/images/head.gif) #F4F4F5 repeat-x;
+border:1px solid #CCC;
+clear:both;
+font-size:90%;
+color:#666;
+font-weight:700;
+text-align:center;
+white-space:nowrap;
+margin:0 0 4px;
+padding:1px 5px 1px 2px;
+}
+
+.big_image {
+border:1px solid #CCC;
+background-color:#fff;
+padding:5px;
+}
+
+form {
+margin:0;
+padding:0;
+}
+
+ul {
+margin:2px 0 0 15px;
+padding:0;
+}
+
+.number {
+border-right:1px solid #666;
+padding:0 4px;
+}
+
+.numbers {
+line-height:1.1em;
+margin-top:5px;
+margin-bottom:3px;
+}
+
+.number_no {
+font-weight:700;
+color:#000;
+background-color:#F0F1F4;
+border-right:1px solid #666;
+padding:0 4px;
+}
+
+.number_wrap {
+background-color:#fff;
+border-top:1px solid #666;
+border-bottom:1px solid #666;
+border-left:1px solid #666;
+}
+
+.alert {
+width:90%;
+color:red;
+text-align:center;
+font-size:100%;
+border:3px solid red;
+margin-botom:16px;
+margin-left:auto;
+margin-right:auto;
+padding:5px;
+}
+
+.mm_input {
+width:100px;
+border:1px solid #999;
+background:#333;
+color:#fff;
+font-size:9px;
+}
+
+.mm_button {
+font-size:9px;
+}
+
+.dots {
+color:#000;
+background:#F5F5F5;
+border:2px dotted orange;
+margin-left:auto;
+margin-right:auto;
+margin-bottom:5px;
+padding:5px;
+}
+
+.dots2 {
+color:#000;
+background:#E1E4EA;
+border-bottom:2px dashed #ccc;
+margin:0 auto 5px;
+padding:10px;
+}
+
+.foo {
+color:#599CB3;
+}
+
+#tab {
+margin-top:0.5em;
+width:100%;
+margin-bottom:0;
+}
+
+#tab a {
+text-align:center;
+border:0;
+text-decoration:none;
+padding:0.5em 0.5em 0;
+}
+
+#tab .button {
+background:#F5F5F5;
+color:#000;
+}
+
+#tab .active {
+background:#E1E4EA;
+color:#000;
+font-weight:700;
+border-bottom:2px solid #E1E4EA;
+}
+
+a:link,a:visited,a:active {
+color:#22229C;
+}
+
+a:hover,.red {
+color:#C00;
+}
+
+h1,.big {
+font-size:110%;
+font-weight:700;
+color:#900;
+margin:0;
+padding:0;
+}
+
+h2 {
+font-size: 120%;
+font-weight: bold;
+color:#666666;
+margin-bottom:4px;
+}
+
+.g3,.g4 {
+color:green;
+}
+
+.light a:link,.light a:visited,.light a:active,.light a:hover {
+color:#ccc;
+}
+
+.headerbar a:link,.headerbar a:visited,.headerbar a:active,.headerbar a:hover {
+color:#FFF;
+text-decoration:none;
+}
+
+.navbar a:link,.navbar a:visited,.navbar a:active {
+color:#fff;
+}
+
+.navbar a:hover,.numbers a:link,.numbers a:visited,.numbers a:active,.numbers a:hover {
+text-decoration:none;
+}
+
+.footerbox a:visited,.footerbox a:link {
+color:#900;
+}
+/* Borrowed from ModelMayhem (end) */
+

Added: tags/parley-0.55/root/css/images/bg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/css/images/bg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/css/images/client_logo.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/css/images/client_logo.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/css/images/logo.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/css/images/logo.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/css/layout23.css
===================================================================
--- tags/parley-0.55/root/css/layout23.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/css/layout23.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,67 @@
+html,body{
+    margin:             0;
+    padding:            0;
+}
+body{
+    font:               76% tahoma,verdana,arial,sans-serif;
+}
+p{
+    margin:             0 10px 10px
+}
+/* NOT USED
+a{
+    display:            block;
+    color:              #981793;
+    padding:            10px;
+}
+    */
+div#header h1{
+    height:             80px;
+    line-height:        80px;
+    margin:             0;
+    padding-left:       10px;
+    background:         #EEE;
+    color:              #79B30B;
+}
+div#content p{
+    line-height:        1.4;
+}
+div#navigation{
+    background:         #B9CAFF;
+    background:         #FFF;
+}
+div#extra{
+    background:         #FF8539;
+    background:         #FFF;
+}
+div#footer{
+    background:         #AAA;
+    color:              #FFF;
+}
+div#footer p{
+    margin:             0;
+    padding:            5px 10px;
+    text-align:         right;
+}
+
+div#wrapper{
+    float:              left;
+    width:              100%;
+    margin-left:        -200px;
+}
+div#content{
+    margin-left:        200px;
+}
+div#navigation{
+    float:              right;
+    width:              200px;
+}
+div#extra{
+    float:              right;
+    clear:              right;
+    width:              200px;
+}
+div#footer{
+    clear:              both;
+    width:              100%
+}

Added: tags/parley-0.55/root/css/layout27.css
===================================================================
--- tags/parley-0.55/root/css/layout27.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/css/layout27.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+html,body{margin:0;padding:0}
+body{font: 76% arial,sans-serif}
+p{margin:0 10px 10px}
+/*a{display:block;color: #981793;padding:10px}*/
+div#header h1{height:80px;line-height:80px;margin:0;
+  padding-left:10px;background: #EEE;color: #79B30B}
+div#content { margin-top: 20px; margin-left: 20px; }
+div#content p{line-height:1.4}
+div#navigation{background:transparent}
+div#extra{background:transparent}
+div#footer{background: #333;color: #FFF}
+div#footer p{margin:0;padding:5px 10px}
+
+div#navigation{float:left;width:50%}
+div#extra{float:left;width:49.9%}
+div#footer{clear:left;width:100%}

Added: tags/parley-0.55/root/css/layout33.css
===================================================================
--- tags/parley-0.55/root/css/layout33.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/css/layout33.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,18 @@
+html,body{margin:0;padding:0}
+body{font: 76% arial,sans-serif;text-align:center}
+p{margin:0 10px 10px}
+a{display:block;color: #981793;padding:10px}
+div#header h1{height:80px;line-height:80px;margin:0;
+  padding-left:10px;background: #EEE;color: #79B30B}
+div#container{text-align:left}
+div#content p{line-height:1.4}
+div#navigation{background:#B9CAFF}
+div#extra{background:#FF8539}
+div#footer{background: #333;color: #FFF}
+div#footer p{margin:0;padding:5px 10px}
+
+div#container{width:700px;margin:0 auto}
+div#content{float:left;width:500px}
+div#navigation{float:right;width:200px}
+div#extra{float:right;clear:right;width:200px}
+div#footer{clear:both;width:100%}

Added: tags/parley-0.55/root/dragdrop.js
===================================================================
--- tags/parley-0.55/root/dragdrop.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/dragdrop.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,537 @@
+// Copyright (c) 2005 Thomas Fuchs (<A HREF="http://script.aculo.us,">http://script.aculo.us,</A> <A HREF="http://mir.aculo.us">http://mir.aculo.us</A>)
+// 
+// Element.Class part Copyright (c) 2005 by Rick Olson
+// 
+// Permission is hereby granted, free of charge, to any person obtaining
+// a copy of this software and associated documentation files (the
+// &quot;Software&quot;), to deal in the Software without restriction, including
+// without limitation the rights to use, copy, modify, merge, publish,
+// distribute, sublicense, and/or sell copies of the Software, and to
+// permit persons to whom the Software is furnished to do so, subject to
+// the following conditions:
+// 
+// The above copyright notice and this permission notice shall be
+// included in all copies or substantial portions of the Software.
+// 
+// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
+// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
+// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
+// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
+// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+Element.Class = {
+    // Element.toggleClass(element, className) toggles the class being on/off
+    // Element.toggleClass(element, className1, className2) toggles between both classes,
+    //   defaulting to className1 if neither exist
+    toggle: function(element, className) {
+      if(Element.Class.has(element, className)) {
+        Element.Class.remove(element, className);
+        if(arguments.length == 3) Element.Class.add(element, arguments[2]);
+      } else {
+        Element.Class.add(element, className);
+        if(arguments.length == 3) Element.Class.remove(element, arguments[2]);
+      }
+    },
+
+    // gets space-delimited classnames of an element as an array
+    get: function(element) {
+      element = $(element);
+      return element.className.split(' ');
+    },
+
+    // functions adapted from original functions by Gavin Kistner
+    remove: function(element) {
+      element = $(element);
+      var regEx;
+      for(var i = 1; i &lt; arguments.length; i++) {
+        regEx = new RegExp(&quot;^&quot; + arguments[i] + &quot;\\b\\s*|\\s*\\b&quot; + arguments[i] + &quot;\\b&quot;, 'g');
+        element.className = element.className.replace(regEx, '')
+      }
+    },
+
+    add: function(element) {
+      element = $(element);
+      for(var i = 1; i &lt; arguments.length; i++) {
+        Element.Class.remove(element, arguments[i]);
+        element.className += (element.className.length &gt; 0 ? ' ' : '') + arguments[i];
+      }
+    },
+
+    // returns true if all given classes exist in said element
+    has: function(element) {
+      element = $(element);
+      if(!element || !element.className) return false;
+      var regEx;
+      for(var i = 1; i &lt; arguments.length; i++) {
+        regEx = new RegExp(&quot;\\b&quot; + arguments[i] + &quot;\\b&quot;);
+        if(!regEx.test(element.className)) return false;
+      }
+      return true;
+    },
+    
+    // expects arrays of strings and/or strings as optional paramters
+    // Element.Class.has_any(element, ['classA','classB','classC'], 'classD')
+    has_any: function(element) {
+      element = $(element);
+      if(!element || !element.className) return false;
+      var regEx;
+      for(var i = 1; i &lt; arguments.length; i++) {
+        if((typeof arguments[i] == 'object') &amp;&amp; 
+          (arguments[i].constructor == Array)) {
+          for(var j = 0; j &lt; arguments[i].length; j++) {
+            regEx = new RegExp(&quot;\\b&quot; + arguments[i][j] + &quot;\\b&quot;);
+            if(regEx.test(element.className)) return true;
+          }
+        } else {
+          regEx = new RegExp(&quot;\\b&quot; + arguments[i] + &quot;\\b&quot;);
+          if(regEx.test(element.className)) return true;
+        }
+      }
+      return false;
+    },
+    
+    childrenWith: function(element, className) {
+      var children = $(element).getElementsByTagName('*');
+      var elements = new Array();
+      
+      for (var i = 0; i &lt; children.length; i++) {
+        if (Element.Class.has(children[i], className)) {
+          elements.push(children[i]);
+          break;
+        }
+      }
+      
+      return elements;
+    }
+}
+
+/*--------------------------------------------------------------------------*/
+
+var Droppables = {
+  drops: false,
+  
+  remove: function(element) {
+    for(var i = 0; i &lt; this.drops.length; i++)
+      if(this.drops[i].element == element)
+        this.drops.splice(i,1);
+  },
+  
+  add: function(element) {
+    var element = $(element);
+    var options = Object.extend({
+      greedy:     true,
+      hoverclass: null  
+    }, arguments[1] || {});
+    
+    // cache containers
+    if(options.containment) {
+      options._containers = new Array();
+      var containment = options.containment;
+      if((typeof containment == 'object') &amp;&amp; 
+        (containment.constructor == Array)) {
+        for(var i=0; i&lt;containment.length; i++)
+          options._containers.push($(containment[i]));
+      } else {
+        options._containers.push($(containment));
+      }
+      options._containers_length = 
+        options._containers.length-1;
+    }
+    
+    Element.makePositioned(element); // fix IE
+    
+    options.element = element;
+    
+    // activate the droppable    
+    if(!this.drops) this.drops = [];
+    this.drops.push(options);
+  },
+  
+  is_contained: function(element, drop) {
+    var containers = drop._containers;
+    var parentNode = element.parentNode;
+    var i = drop._containers_length;
+    do { if(parentNode==containers[i]) return true; } while (i--);
+    return false;
+  },
+  
+  is_affected: function(pX, pY, element, drop) {
+    return (
+      (drop.element!=element) &amp;&amp;
+      ((!drop._containers) ||
+        this.is_contained(element, drop)) &amp;&amp;
+      ((!drop.accept) ||
+        (Element.Class.has_any(element, drop.accept))) &amp;&amp;
+      Position.within(drop.element, pX, pY) );
+  },
+  
+  deactivate: function(drop) {
+    Element.Class.remove(drop.element, drop.hoverclass);
+    this.last_active = null;
+  },
+  
+  activate: function(drop) {
+    if(this.last_active) this.deactivate(this.last_active);
+    if(drop.hoverclass) {
+      Element.Class.add(drop.element, drop.hoverclass);
+      this.last_active = drop;
+    }
+  },
+  
+  show: function(event, element) {
+    if(!this.drops) return;
+    var pX = Event.pointerX(event);
+    var pY = Event.pointerY(event);
+    Position.prepare();
+    
+    var i = this.drops.length-1; do {
+      var drop = this.drops[i];
+      if(this.is_affected(pX, pY, element, drop)) {
+        if(drop.onHover)
+           drop.onHover(element, drop.element, Position.overlap(drop.overlap, drop.element));
+        if(drop.greedy) { 
+          this.activate(drop);
+          return;
+        }
+      }
+    } while (i--);
+  },
+  
+  fire: function(event, element) {
+    if(!this.last_active) return;
+    Position.prepare();
+    
+    if (this.is_affected(Event.pointerX(event), Event.pointerY(event), element, this.last_active))
+      if (this.last_active.onDrop) 
+        this.last_active.onDrop(element, this.last_active);
+    
+  },
+  
+  reset: function() {
+    if(this.last_active)
+      this.deactivate(this.last_active);
+  }
+}
+
+Draggables = {
+  observers: new Array(),
+  addObserver: function(observer) {
+    this.observers.push(observer);    
+  },
+  removeObserver: function(element) {  // element instead of obsever fixes mem leaks
+    for(var i = 0; i &lt; this.observers.length; i++)
+      if(this.observers[i].element &amp;&amp; (this.observers[i].element == element))
+        this.observers.splice(i,1);
+  },
+  notify: function(eventName, draggable) {  // 'onStart', 'onEnd'
+    for(var i = 0; i &lt; this.observers.length; i++)
+      this.observers[i][eventName](draggable);
+  }
+}
+
+/*--------------------------------------------------------------------------*/
+
+Draggable = Class.create();
+Draggable.prototype = {
+  initialize: function(element) {
+    var options = Object.extend({
+      handle: false,
+      starteffect: function(element) { 
+        new Effect.Opacity(element, {duration:0.2, from:1.0, to:0.7}); 
+      },
+      reverteffect: function(element, top_offset, left_offset) {
+        new Effect.MoveBy(element, -top_offset, -left_offset, {duration:0.4});
+      },
+      endeffect: function(element) { 
+         new Effect.Opacity(element, {duration:0.2, from:0.7, to:1.0}); 
+      },
+      zindex: 1000,
+      revert: false
+    }, arguments[1] || {});
+    
+    this.element      = $(element);
+    this.handle       = options.handle ? $(options.handle) : this.element;
+    
+    Element.makePositioned(this.element); // fix IE
+    
+    this.offsetX      = 0;
+    this.offsetY      = 0;
+    this.originalLeft = this.currentLeft();
+    this.originalTop  = this.currentTop();
+    this.originalX    = this.element.offsetLeft;
+    this.originalY    = this.element.offsetTop;
+    this.originalZ    = parseInt(this.element.style.zIndex || &quot;0&quot;);
+    
+    this.options      = options;
+    
+    this.active       = false;
+    this.dragging     = false;   
+    
+    this.eventMouseDown = this.startDrag.bindAsEventListener(this);
+    this.eventMouseUp   = this.endDrag.bindAsEventListener(this);
+    this.eventMouseMove = this.update.bindAsEventListener(this);
+    this.eventKeypress  = this.keyPress.bindAsEventListener(this);
+    
+    Event.observe(this.handle, &quot;mousedown&quot;, this.eventMouseDown);
+    Event.observe(document, &quot;mouseup&quot;, this.eventMouseUp);
+    Event.observe(document, &quot;mousemove&quot;, this.eventMouseMove);
+    Event.observe(document, &quot;keypress&quot;, this.eventKeypress);
+  },
+  destroy: function() {
+    Event.stopObserving(this.handle, &quot;mousedown&quot;, this.eventMouseDown);
+    Event.stopObserving(document, &quot;mouseup&quot;, this.eventMouseUp);
+    Event.stopObserving(document, &quot;mousemove&quot;, this.eventMouseMove);
+    Event.stopObserving(document, &quot;keypress&quot;, this.eventKeypress);
+  },
+  currentLeft: function() {
+    return parseInt(this.element.style.left || '0');
+  },
+  currentTop: function() {
+    return parseInt(this.element.style.top || '0')
+  },
+  startDrag: function(event) {
+    if(Event.isLeftClick(event)) {
+      this.active = true;
+      
+      var style = this.element.style;
+      this.originalY = this.element.offsetTop  - this.currentTop()  - this.originalTop;
+      this.originalX = this.element.offsetLeft - this.currentLeft() - this.originalLeft;
+      this.offsetY =  event.clientY - this.originalY - this.originalTop;
+      this.offsetX =  event.clientX - this.originalX - this.originalLeft;
+      
+      Event.stop(event);
+    }
+  },
+  finishDrag: function(event, success) {
+    this.active = false;
+    this.dragging = false;
+    
+    if(success) Droppables.fire(event, this.element);
+    Draggables.notify('onEnd', this);
+    
+    var revert = this.options.revert;
+    if(revert &amp;&amp; typeof revert == 'function') revert = revert(this.element);
+      
+    if(revert &amp;&amp; this.options.reverteffect) {
+      this.options.reverteffect(this.element, 
+      this.currentTop()-this.originalTop,
+      this.currentLeft()-this.originalLeft);
+    } else {
+      this.originalLeft = this.currentLeft();
+      this.originalTop  = this.currentTop();
+    }
+    
+    this.element.style.zIndex = this.originalZ;
+      
+    if(this.options.endeffect) 
+      this.options.endeffect(this.element);
+      
+    Droppables.reset();
+  },
+  keyPress: function(event) {
+    if(this.active) {
+      if(event.keyCode==Event.KEY_ESC) {
+        this.finishDrag(event, false);
+        Event.stop(event);
+      }
+    }
+  },
+  endDrag: function(event) {
+    if(this.active &amp;&amp; this.dragging) {
+      this.finishDrag(event, true);
+      Event.stop(event);
+    }
+    this.active = false;
+    this.dragging = false;
+  },
+  draw: function(event) {
+    var style = this.element.style;
+    this.originalX = this.element.offsetLeft - this.currentLeft() - this.originalLeft;
+    this.originalY = this.element.offsetTop  - this.currentTop()  - this.originalTop;
+    if((!this.options.constraint) || (this.options.constraint=='horizontal'))
+      style.left = ((event.clientX - this.originalX) - this.offsetX) + &quot;px&quot;;
+    if((!this.options.constraint) || (this.options.constraint=='vertical'))
+      style.top  = ((event.clientY - this.originalY) - this.offsetY) + &quot;px&quot;;
+    if(style.visibility==&quot;hidden&quot;) style.visibility = &quot;&quot;; // fix gecko rendering
+  },
+  update: function(event) {
+   if(this.active) {
+      if(!this.dragging) {
+        var style = this.element.style;
+        this.dragging = true;
+        if(style.position==&quot;&quot;) style.position = &quot;relative&quot;;
+        style.zIndex = this.options.zindex;
+        Draggables.notify('onStart', this);
+        if(this.options.starteffect) this.options.starteffect(this.element);
+      }
+      
+      Droppables.show(event, this.element);
+      this.draw(event);
+      if(this.options.change) this.options.change(this);
+      
+      // fix AppleWebKit rendering
+      if(navigator.appVersion.indexOf('AppleWebKit')&gt;0) window.scrollBy(0,0); 
+      
+      Event.stop(event);
+   }
+  }
+}
+
+/*--------------------------------------------------------------------------*/
+
+SortableObserver = Class.create();
+SortableObserver.prototype = {
+  initialize: function(element, observer) {
+    this.element   = $(element);
+    this.observer  = observer;
+    this.lastValue = Sortable.serialize(this.element);
+  },
+  onStart: function() {
+    this.lastValue = Sortable.serialize(this.element);
+  },
+  onEnd: function() {    
+    if(this.lastValue != Sortable.serialize(this.element))
+      this.observer(this.element)
+  }
+}
+
+Sortable = {
+  sortables: new Array(),
+  options: function(element){
+    var element = $(element);
+    for(var i=0;i&lt;this.sortables.length;i++)
+      if(this.sortables[i].element == element)
+        return this.sortables[i];
+    return null;        
+  },
+  destroy: function(element){
+    var element = $(element);
+    for(var i=0;i&lt;this.sortables.length;i++) {
+      if(this.sortables[i].element == element) {
+        var s = this.sortables[i];
+        Draggables.removeObserver(s.element);
+        for(var j=0;j&lt;s.droppables.length;j++)
+          Droppables.remove(s.droppables[j]);
+        for(var j=0;j&lt;s.draggables.length;j++)
+          s.draggables[j].destroy();
+        this.sortables.splice(i,1);
+      }
+    }
+  },
+  create: function(element) {
+    var element = $(element);
+    var options = Object.extend({ 
+      element:     element,
+      tag:         'li',       // assumes li children, override with tag: 'tagname'
+      overlap:     'vertical', // one of 'vertical', 'horizontal'
+      constraint:  'vertical', // one of 'vertical', 'horizontal', false
+      containment: element,    // also takes array of elements (or id's); or false
+      handle:      false,      // or a CSS class
+      only:        false,
+      hoverclass:  null,
+      onChange:    function() {},
+      onUpdate:    function() {}
+    }, arguments[1] || {});
+    
+    // clear any old sortable with same element
+    this.destroy(element);
+    
+    // build options for the draggables
+    var options_for_draggable = {
+      revert:      true,
+      constraint:  options.constraint,
+      handle:      handle };
+    if(options.starteffect)
+      options_for_draggable.starteffect = options.starteffect;
+    if(options.reverteffect)
+      options_for_draggable.reverteffect = options.reverteffect;
+    if(options.endeffect)
+      options_for_draggable.endeffect = options.endeffect;
+    if(options.zindex)
+      options_for_draggable.zindex = options.zindex;
+    
+    // build options for the droppables  
+    var options_for_droppable = {
+      overlap:     options.overlap,
+      containment: options.containment,
+      hoverclass:  options.hoverclass,
+      onHover: function(element, dropon, overlap) { 
+        if(overlap&gt;0.5) {
+          if(dropon.previousSibling != element) {
+            var oldParentNode = element.parentNode;
+            element.style.visibility = &quot;hidden&quot;; // fix gecko rendering
+            dropon.parentNode.insertBefore(element, dropon);
+            if(dropon.parentNode!=oldParentNode &amp;&amp; oldParentNode.sortable) 
+              oldParentNode.sortable.onChange(element);
+            if(dropon.parentNode.sortable)
+              dropon.parentNode.sortable.onChange(element);
+          }
+        } else {                
+          var nextElement = dropon.nextSibling || null;
+          if(nextElement != element) {
+            var oldParentNode = element.parentNode;
+            element.style.visibility = &quot;hidden&quot;; // fix gecko rendering
+            dropon.parentNode.insertBefore(element, nextElement);
+            if(dropon.parentNode!=oldParentNode &amp;&amp; oldParentNode.sortable) 
+              oldParentNode.sortable.onChange(element);
+            if(dropon.parentNode.sortable)
+              dropon.parentNode.sortable.onChange(element);
+          }
+        }
+      }
+    }
+
+    // fix for gecko engine
+    Element.cleanWhitespace(element); 
+    
+    options.draggables = [];
+    options.droppables = [];
+    
+    // make it so 
+    var elements = element.childNodes;
+    for (var i = 0; i &lt; elements.length; i++) 
+      if(elements[i].tagName &amp;&amp; elements[i].tagName==options.tag.toUpperCase() &amp;&amp;
+        (!options.only || (Element.Class.has(elements[i], options.only)))) {
+        
+        // handles are per-draggable
+        var handle = options.handle ? 
+          Element.Class.childrenWith(elements[i], options.handle)[0] : elements[i];
+        
+        options.draggables.push(new Draggable(elements[i], Object.extend(options_for_draggable, { handle: handle })));
+        
+        Droppables.add(elements[i], options_for_droppable);
+        options.droppables.push(elements[i]);
+        
+      }
+      
+    // keep reference
+    this.sortables.push(options);
+    
+    // for onupdate
+    Draggables.addObserver(new SortableObserver(element, options.onUpdate));
+
+  },
+  serialize: function(element) {
+    var element = $(element);
+    var sortableOptions = this.options(element);
+    var options = Object.extend({
+      tag:  sortableOptions.tag,
+      only: sortableOptions.only,
+      name: element.id
+    }, arguments[1] || {});
+    
+    var items = $(element).childNodes;
+    var queryComponents = new Array();
+ 
+    for(var i=0; i&lt;items.length; i++)
+      if(items[i].tagName &amp;&amp; items[i].tagName==options.tag.toUpperCase() &amp;&amp;
+        (!options.only || (Element.Class.has(items[i], options.only))))
+        queryComponents.push(
+          encodeURIComponent(options.name) + &quot;[]=&quot; + 
+          encodeURIComponent(items[i].id.split(&quot;_&quot;)[1]));
+
+    return queryComponents.join(&quot;&amp;&quot;);
+  }
+}


Property changes on: tags/parley-0.55/root/dragdrop.js
___________________________________________________________________
Name: svn:mime-type
   + text/cpp

Added: tags/parley-0.55/root/effects.js
===================================================================
--- tags/parley-0.55/root/effects.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/effects.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,612 @@
+// Copyright (c) 2005 Thomas Fuchs (<A HREF="http://script.aculo.us,">http://script.aculo.us,</A> <A HREF="http://mir.aculo.us">http://mir.aculo.us</A>)
+//
+// Parts (c) 2005 Justin Palmer (<A HREF="http://encytemedia.com/">http://encytemedia.com/</A>)
+// Parts (c) 2005 Mark Pilgrim (<A HREF="http://diveintomark.org/">http://diveintomark.org/</A>)
+// 
+// Permission is hereby granted, free of charge, to any person obtaining
+// a copy of this software and associated documentation files (the
+// &quot;Software&quot;), to deal in the Software without restriction, including
+// without limitation the rights to use, copy, modify, merge, publish,
+// distribute, sublicense, and/or sell copies of the Software, and to
+// permit persons to whom the Software is furnished to do so, subject to
+// the following conditions:
+// 
+// The above copyright notice and this permission notice shall be
+// included in all copies or substantial portions of the Software.
+// 
+// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
+// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
+// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
+// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
+// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
+// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
+// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
+
+
+Effect = {}
+Effect2 = Effect; // deprecated
+
+/* ------------- transitions ------------- */
+
+Effect.Transitions = {}
+
+Effect.Transitions.linear = function(pos) {
+  return pos;
+}
+Effect.Transitions.sinoidal = function(pos) {
+  return (-Math.cos(pos*Math.PI)/2) + 0.5;
+}
+Effect.Transitions.reverse  = function(pos) {
+  return 1-pos;
+}
+Effect.Transitions.flicker = function(pos) {
+  return ((-Math.cos(pos*Math.PI)/4) + 0.75) + Math.random(0.25);
+}
+Effect.Transitions.wobble = function(pos) {
+  return (-Math.cos(pos*Math.PI*(9*pos))/2) + 0.5;
+}
+Effect.Transitions.pulse = function(pos) {
+  return (Math.floor(pos*10) % 2 == 0 ? 
+    (pos*10-Math.floor(pos*10)) : 1-(pos*10-Math.floor(pos*10)));
+}
+Effect.Transitions.none = function(pos) {
+  return 0;
+}
+Effect.Transitions.full = function(pos) {
+  return 1;
+}
+
+/* ------------- element ext -------------- */
+
+Element.makePositioned = function(element) {
+  element = $(element);
+  if(element.style.position == &quot;&quot;)
+    element.style.position = &quot;relative&quot;;
+}
+
+Element.makeClipping = function(element) {
+  element = $(element);
+  element._overflow = element.style.overflow || 'visible';
+  if(element._overflow!='hidden') element.style.overflow = 'hidden';
+}
+
+Element.undoClipping = function(element) {
+  element = $(element);
+  if(element._overflow!='hidden') element.style.overflow = element._overflow;
+}
+
+/* ------------- core effects ------------- */
+
+Effect.Base = function() {};
+Effect.Base.prototype = {
+  setOptions: function(options) {
+    this.options = Object.extend({
+      transition: Effect.Transitions.sinoidal,
+      duration:   1.0,   // seconds
+      fps:        25.0,  // max. 100fps
+      sync:       false, // true for combining
+      from:       0.0,
+      to:         1.0
+    }, options || {});
+  },
+  start: function(options) {
+    this.setOptions(options || {});
+    this.currentFrame = 0;
+    this.startOn      = new Date().getTime();
+    this.finishOn     = this.startOn + (this.options.duration*1000);
+    if(this.options.beforeStart) this.options.beforeStart(this);
+    if(!this.options.sync) this.loop();  
+  },
+  loop: function() {
+    var timePos = new Date().getTime();
+    if(timePos &gt;= this.finishOn) {
+      this.render(this.options.to);
+      if(this.finish) this.finish(); 
+      if(this.options.afterFinish) this.options.afterFinish(this);
+      return;  
+    }
+    var pos   = (timePos - this.startOn) / (this.finishOn - this.startOn);
+    var frame = Math.round(pos * this.options.fps * this.options.duration);
+    if(frame &gt; this.currentFrame) {
+      this.render(pos);
+      this.currentFrame = frame;
+    }
+    this.timeout = setTimeout(this.loop.bind(this), 10);
+  },
+  render: function(pos) {
+    if(this.options.transition) pos = this.options.transition(pos);
+    pos *= (this.options.to-this.options.from);
+    pos += this.options.from; 
+    if(this.options.beforeUpdate) this.options.beforeUpdate(this);
+    if(this.update) this.update(pos);
+    if(this.options.afterUpdate) this.options.afterUpdate(this);  
+  },
+  cancel: function() {
+    if(this.timeout) clearTimeout(this.timeout);
+  }
+}
+
+Effect.Parallel = Class.create();
+Object.extend(Object.extend(Effect.Parallel.prototype, Effect.Base.prototype), {
+  initialize: function(effects) {
+    this.effects = effects || [];
+    this.start(arguments[1]);
+  },
+  update: function(position) {
+    for (var i = 0; i &lt; this.effects.length; i++)
+      this.effects[i].render(position);  
+  },
+  finish: function(position) {
+    for (var i = 0; i &lt; this.effects.length; i++)
+      if(this.effects[i].finish) this.effects[i].finish(position);
+  }
+});
+
+// Internet Explorer caveat: works only on elements the have
+// a 'layout', meaning having a given width or height. 
+// There is no way to safely set this automatically.
+Effect.Opacity = Class.create();
+Object.extend(Object.extend(Effect.Opacity.prototype, Effect.Base.prototype), {
+  initialize: function(element) {
+    this.element = $(element);
+    options = Object.extend({
+      from: 0.0,
+      to:   1.0
+    }, arguments[1] || {});
+    this.start(options);
+  },
+  update: function(position) {
+    this.setOpacity(position);
+  }, 
+  setOpacity: function(opacity) {
+    opacity = (opacity == 1) ? 0.99999 : opacity;
+    this.element.style.opacity = opacity;
+    this.element.style.filter = &quot;alpha(opacity:&quot;+opacity*100+&quot;)&quot;;
+  }
+});
+
+Effect.MoveBy = Class.create();
+Object.extend(Object.extend(Effect.MoveBy.prototype, Effect.Base.prototype), {
+  initialize: function(element, toTop, toLeft) {
+    this.element      = $(element);
+    this.originalTop  = parseFloat(this.element.style.top || '0');
+    this.originalLeft = parseFloat(this.element.style.left || '0');
+    this.toTop        = toTop;
+    this.toLeft       = toLeft;
+    Element.makePositioned(this.element);
+    this.start(arguments[3]);
+  },
+  update: function(position) {
+    topd  = this.toTop  * position + this.originalTop;
+    leftd = this.toLeft * position + this.originalLeft;
+    this.setPosition(topd, leftd);
+  },
+  setPosition: function(topd, leftd) {
+    this.element.style.top  = topd  + &quot;px&quot;;
+    this.element.style.left = leftd + &quot;px&quot;;
+  }
+});
+
+Effect.Scale = Class.create();
+Object.extend(Object.extend(Effect.Scale.prototype, Effect.Base.prototype), {
+  initialize: function(element, percent) {
+    this.element = $(element)
+    options = Object.extend({
+      scaleX: true,
+      scaleY: true,
+      scaleContent: true,
+      scaleFromCenter: false,
+      scaleMode: 'box',        // 'box' or 'contents' or {} with provided values
+      scaleFrom: 100.0
+    }, arguments[2] || {});
+    this.originalTop    = this.element.offsetTop;
+    this.originalLeft   = this.element.offsetLeft;
+    if(this.element.style.fontSize==&quot;&quot;) this.sizeEm = 1.0;
+    if(this.element.style.fontSize &amp;&amp; this.element.style.fontSize.indexOf(&quot;em&quot;)&gt;0)
+      this.sizeEm      = parseFloat(this.element.style.fontSize);
+    this.factor = (percent/100.0) - (options.scaleFrom/100.0);
+    if(options.scaleMode=='box') {
+      this.originalHeight = this.element.clientHeight;
+      this.originalWidth  = this.element.clientWidth; 
+    } else 
+    if(options.scaleMode=='contents') {
+      this.originalHeight = this.element.scrollHeight;
+      this.originalWidth  = this.element.scrollWidth;
+    } else {
+      this.originalHeight = options.scaleMode.originalHeight;
+      this.originalWidth  = options.scaleMode.originalWidth;
+    }
+    this.start(options);
+  },
+
+  update: function(position) {
+    currentScale = (this.options.scaleFrom/100.0) + (this.factor * position);
+    if(this.options.scaleContent &amp;&amp; this.sizeEm) 
+      this.element.style.fontSize = this.sizeEm*currentScale + &quot;em&quot;;
+    this.setDimensions(
+      this.originalWidth * currentScale, 
+      this.originalHeight * currentScale);
+  },
+
+  setDimensions: function(width, height) {
+    if(this.options.scaleX) this.element.style.width = width + 'px';
+    if(this.options.scaleY) this.element.style.height = height + 'px';
+    if(this.options.scaleFromCenter) {
+      topd  = (height - this.originalHeight)/2;
+      leftd = (width  - this.originalWidth)/2;
+      if(this.element.style.position=='absolute') {
+        if(this.options.scaleY) this.element.style.top = this.originalTop-topd + &quot;px&quot;;
+        if(this.options.scaleX) this.element.style.left = this.originalLeft-leftd + &quot;px&quot;;
+      } else {
+        if(this.options.scaleY) this.element.style.top = -topd + &quot;px&quot;;
+        if(this.options.scaleX) this.element.style.left = -leftd + &quot;px&quot;;
+      }
+    }
+  }
+});
+
+Effect.Highlight = Class.create();
+Object.extend(Object.extend(Effect.Highlight.prototype, Effect.Base.prototype), {
+  initialize: function(element) {
+    this.element = $(element);
+    
+    // try to parse current background color as default for endcolor
+    // browser stores this as: &quot;rgb(255, 255, 255)&quot;, convert to &quot;#ffffff&quot; format
+    var endcolor = &quot;#ffffff&quot;;
+    var current = this.element.style.backgroundColor;
+    if(current &amp;&amp; current.slice(0,4) == &quot;rgb(&quot;) {
+      endcolor = &quot;#&quot;;
+      var cols = current.slice(4,current.length-1).split(',');
+      var i=0; do { endcolor += parseInt(cols[i]).toColorPart() } while (++i&lt;3); }
+      
+    var options = Object.extend({
+      startcolor:   &quot;#ffff99&quot;,
+      endcolor:     endcolor,
+      restorecolor: current 
+    }, arguments[1] || {});
+    
+    // init color calculations
+    this.colors_base = [
+      parseInt(options.startcolor.slice(1,3),16),
+      parseInt(options.startcolor.slice(3,5),16),
+      parseInt(options.startcolor.slice(5),16) ];
+    this.colors_delta = [
+      parseInt(options.endcolor.slice(1,3),16)-this.colors_base[0],
+      parseInt(options.endcolor.slice(3,5),16)-this.colors_base[1],
+      parseInt(options.endcolor.slice(5),16)-this.colors_base[2] ];
+
+    this.start(options);
+  },
+  update: function(position) {
+    var colors = [
+      Math.round(this.colors_base[0]+(this.colors_delta[0]*position)),
+      Math.round(this.colors_base[1]+(this.colors_delta[1]*position)),
+      Math.round(this.colors_base[2]+(this.colors_delta[2]*position)) ];
+    this.element.style.backgroundColor = &quot;#&quot; +
+      colors[0].toColorPart() + colors[1].toColorPart() + colors[2].toColorPart();
+  },
+  finish: function() {
+    this.element.style.backgroundColor = this.options.restorecolor;
+  }
+});
+
+Effect.ScrollTo = Class.create();
+Object.extend(Object.extend(Effect.ScrollTo.prototype, Effect.Base.prototype), {
+  initialize: function(element) {
+    this.element = $(element);
+    Position.prepare();
+    var offsets = Position.cumulativeOffset(this.element);
+    var max = window.innerHeight ? 
+      window.height - window.innerHeight :
+      document.body.scrollHeight - 
+        (document.documentElement.clientHeight ? 
+          document.documentElement.clientHeight : document.body.clientHeight);
+    this.scrollStart = Position.deltaY;
+    this.delta  = (offsets[1] &gt; max ? max : offsets[1]) - this.scrollStart;
+    this.start(arguments[1] || {});
+  },
+  update: function(position) {
+    Position.prepare();
+    window.scrollTo(Position.deltaX, 
+      this.scrollStart + (position*this.delta));
+  }
+});
+
+/* ------------- prepackaged effects ------------- */
+
+Effect.Fade = function(element) {
+  options = Object.extend({
+  from: 1.0,
+  to:   0.0,
+  afterFinish: function(effect) 
+    { Element.hide(effect.element);
+      effect.setOpacity(1); } 
+  }, arguments[1] || {});
+  new Effect.Opacity(element,options);
+}
+
+Effect.Appear = function(element) {
+  options = Object.extend({
+  from: 0.0,
+  to:   1.0,
+  beforeStart: function(effect)  
+    { effect.setOpacity(0);
+      Element.show(effect.element); },
+  afterUpdate: function(effect)  
+    { Element.show(effect.element); }
+  }, arguments[1] || {});
+  new Effect.Opacity(element,options);
+}
+
+Effect.Puff = function(element) {
+  new Effect.Parallel(
+   [ new Effect.Scale(element, 200, { sync: true, scaleFromCenter: true }), 
+     new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0 } ) ], 
+     { duration: 1.0, 
+      afterUpdate: function(effect) 
+       { effect.effects[0].element.style.position = 'absolute'; },
+      afterFinish: function(effect)
+       { Element.hide(effect.effects[0].element); }
+     }
+   );
+}
+
+Effect.BlindUp = function(element) {
+  Element.makeClipping(element);
+  new Effect.Scale(element, 0, 
+    Object.extend({ scaleContent: false, 
+      scaleX: false, 
+      afterFinish: function(effect) 
+        { 
+          Element.hide(effect.element);
+          Element.undoClipping(effect.element);
+        } 
+    }, arguments[1] || {})
+  );
+}
+
+Effect.BlindDown = function(element) {
+  $(element).style.height   = '0px';
+  Element.makeClipping(element);
+  Element.show(element);
+  new Effect.Scale(element, 100, 
+    Object.extend({ scaleContent: false, 
+      scaleX: false, 
+      scaleMode: 'contents',
+      scaleFrom: 0,
+      afterFinish: function(effect) {
+        Element.undoClipping(effect.element);
+      }
+    }, arguments[1] || {})
+  );
+}
+
+Effect.SwitchOff = function(element) {
+  new Effect.Appear(element,
+    { duration: 0.4,
+     transition: Effect.Transitions.flicker,
+     afterFinish: function(effect)
+      { effect.element.style.overflow = 'hidden';
+        new Effect.Scale(effect.element, 1, 
+         { duration: 0.3, scaleFromCenter: true,
+          scaleX: false, scaleContent: false,
+          afterUpdate: function(effect) { 
+           if(effect.element.style.position==&quot;&quot;)
+             effect.element.style.position = 'relative'; },
+          afterFinish: function(effect) { Element.hide(effect.element); }
+         } )
+      }
+    } );
+}
+
+Effect.DropOut = function(element) {
+  new Effect.Parallel(
+    [ new Effect.MoveBy(element, 100, 0, { sync: true }), 
+      new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0 } ) ], 
+    { duration: 0.5, 
+     afterFinish: function(effect)
+       { Element.hide(effect.effects[0].element); } 
+    });
+}
+
+Effect.Shake = function(element) {
+  new Effect.MoveBy(element, 0, 20, 
+    { duration: 0.05, afterFinish: function(effect) {
+  new Effect.MoveBy(effect.element, 0, -40, 
+    { duration: 0.1, afterFinish: function(effect) { 
+  new Effect.MoveBy(effect.element, 0, 40, 
+    { duration: 0.1, afterFinish: function(effect) {  
+  new Effect.MoveBy(effect.element, 0, -40, 
+    { duration: 0.1, afterFinish: function(effect) {  
+  new Effect.MoveBy(effect.element, 0, 40, 
+    { duration: 0.1, afterFinish: function(effect) {  
+  new Effect.MoveBy(effect.element, 0, -20, 
+    { duration: 0.05, afterFinish: function(effect) {  
+  }}) }}) }}) }}) }}) }});
+}
+
+Effect.SlideDown = function(element) {
+  element = $(element);
+  element.style.height   = '0px';
+  Element.makeClipping(element);
+  Element.cleanWhitespace(element);
+  Element.makePositioned(element.firstChild);
+  Element.show(element);
+  new Effect.Scale(element, 100, 
+   Object.extend({ scaleContent: false, 
+    scaleX: false, 
+    scaleMode: 'contents',
+    scaleFrom: 0,
+    afterUpdate: function(effect) 
+      { effect.element.firstChild.style.bottom = 
+          (effect.originalHeight - effect.element.clientHeight) + 'px'; },
+    afterFinish: function(effect) 
+      {  Element.undoClipping(effect.element); }
+    }, arguments[1] || {})
+  );
+}
+  
+Effect.SlideUp = function(element) {
+  element = $(element);
+  Element.makeClipping(element);
+  Element.cleanWhitespace(element);
+  Element.makePositioned(element.firstChild);
+  Element.show(element);
+  new Effect.Scale(element, 0, 
+   Object.extend({ scaleContent: false, 
+    scaleX: false, 
+    afterUpdate: function(effect) 
+      { effect.element.firstChild.style.bottom = 
+          (effect.originalHeight - effect.element.clientHeight) + 'px'; },
+    afterFinish: function(effect)
+      { 
+        Element.hide(effect.element);
+        Element.undoClipping(effect.element);
+      }
+   }, arguments[1] || {})
+  );
+}
+
+Effect.Squish = function(element) {
+ new Effect.Scale(element, 0, 
+   { afterFinish: function(effect) { Element.hide(effect.element); } });
+}
+
+Effect.Grow = function(element) {
+  element = $(element);
+  var options = arguments[1] || {};
+  
+  var originalWidth = element.clientWidth;
+  var originalHeight = element.clientHeight;
+  element.style.overflow = 'hidden';
+  Element.show(element);
+  
+  var direction = options.direction || 'center';
+  var moveTransition = options.moveTransition || Effect.Transitions.sinoidal;
+  var scaleTransition = options.scaleTransition || Effect.Transitions.sinoidal;
+  var opacityTransition = options.opacityTransition || Effect.Transitions.full;
+  
+  var initialMoveX, initialMoveY;
+  var moveX, moveY;
+  
+  switch (direction) {
+    case 'top-left':
+      initialMoveX = initialMoveY = moveX = moveY = 0; 
+      break;
+    case 'top-right':
+      initialMoveX = originalWidth;
+      initialMoveY = moveY = 0;
+      moveX = -originalWidth;
+      break;
+    case 'bottom-left':
+      initialMoveX = moveX = 0;
+      initialMoveY = originalHeight;
+      moveY = -originalHeight;
+      break;
+    case 'bottom-right':
+      initialMoveX = originalWidth;
+      initialMoveY = originalHeight;
+      moveX = -originalWidth;
+      moveY = -originalHeight;
+      break;
+    case 'center':
+      initialMoveX = originalWidth / 2;
+      initialMoveY = originalHeight / 2;
+      moveX = -originalWidth / 2;
+      moveY = -originalHeight / 2;
+      break;
+  }
+  
+  new Effect.MoveBy(element, initialMoveY, initialMoveX, { 
+    duration: 0.01, 
+    beforeUpdate: function(effect) { $(element).style.height = '0px'; },
+    afterFinish: function(effect) {
+      new Effect.Parallel(
+        [ new Effect.Opacity(element, { sync: true, to: 1.0, from: 0.0, transition: opacityTransition }),
+          new Effect.MoveBy(element, moveY, moveX, { sync: true, transition: moveTransition }),
+          new Effect.Scale(element, 100, { 
+            scaleMode: { originalHeight: originalHeight, originalWidth: originalWidth }, 
+            sync: true, scaleFrom: 0, scaleTo: 100, transition: scaleTransition })],
+        options); }
+    });
+}
+
+Effect.Shrink = function(element) {
+  element = $(element);
+  var options = arguments[1] || {};
+  
+  var originalWidth = element.clientWidth;
+  var originalHeight = element.clientHeight;
+  element.style.overflow = 'hidden';
+  Element.show(element);
+
+  var direction = options.direction || 'center';
+  var moveTransition = options.moveTransition || Effect.Transitions.sinoidal;
+  var scaleTransition = options.scaleTransition || Effect.Transitions.sinoidal;
+  var opacityTransition = options.opacityTransition || Effect.Transitions.none;
+  
+  var moveX, moveY;
+  
+  switch (direction) {
+    case 'top-left':
+      moveX = moveY = 0;
+      break;
+    case 'top-right':
+      moveX = originalWidth;
+      moveY = 0;
+      break;
+    case 'bottom-left':
+      moveX = 0;
+      moveY = originalHeight;
+      break;
+    case 'bottom-right':
+      moveX = originalWidth;
+      moveY = originalHeight;
+      break;
+    case 'center':  
+      moveX = originalWidth / 2;
+      moveY = originalHeight / 2;
+      break;
+  }
+  
+  new Effect.Parallel(
+    [ new Effect.Opacity(element, { sync: true, to: 0.0, from: 1.0, transition: opacityTransition }),
+      new Effect.Scale(element, 0, { sync: true, transition: moveTransition }),
+      new Effect.MoveBy(element, moveY, moveX, { sync: true, transition: scaleTransition }) ],
+    options);
+}
+
+Effect.Pulsate = function(element) {
+  var options    = arguments[1] || {};
+  var transition = options.transition || Effect.Transitions.sinoidal;
+  var reverser   = function(pos){ return transition(1-Effect.Transitions.pulse(pos)) };
+  reverser.bind(transition);
+  new Effect.Opacity(element, 
+    Object.extend(Object.extend({  duration: 3.0,
+       afterFinish: function(effect) { Element.show(effect.element); }
+    }, options), {transition: reverser}));
+}
+
+Effect.Fold = function(element) {
+ $(element).style.overflow = 'hidden';
+ new Effect.Scale(element, 5, Object.extend({   
+   scaleContent: false,
+   scaleTo: 100,
+   scaleX: false,
+   afterFinish: function(effect) {
+   new Effect.Scale(element, 1, { 
+     scaleContent: false, 
+     scaleTo: 0,
+     scaleY: false,
+     afterFinish: function(effect) { Element.hide(effect.element) } });
+ }}, arguments[1] || {}));
+}
+
+// old: new Effect.ContentZoom(element, percent)
+// new: Element.setContentZoom(element, percent) 
+
+Element.setContentZoom = function(element, percent) {
+  var element = $(element);
+  element.style.fontSize = (percent/100) + &quot;em&quot;;  
+  if(navigator.appVersion.indexOf('AppleWebKit')&gt;0) window.scrollBy(0,0);
+}


Property changes on: tags/parley-0.55/root/effects.js
___________________________________________________________________
Name: svn:mime-type
   + text/cpp

Added: tags/parley-0.55/root/email_templates/authentication_email.eml
===================================================================
--- tags/parley-0.55/root/email_templates/authentication_email.eml	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/email_templates/authentication_email.eml	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,12 @@
+[% person.first_name %],
+
+Thanks for registering with [% c.config.name %]
+To complete your registration please click on the link below.
+
+  [% c.request.base %]user/authenticate/[% regauth.id %]
+
+and follow the on-screen instructions.
+
+Regards,
+
+The [% c.config.name %] team.

Added: tags/parley-0.55/root/email_templates/password_reset.eml
===================================================================
--- tags/parley-0.55/root/email_templates/password_reset.eml	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/email_templates/password_reset.eml	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,11 @@
+[% person.first_name %],
+
+To reset your account password please click on the link below.
+
+  [% c.request.base %]user/password/reset/[% pwd_reset.id %]
+
+and follow the on-screen instructions.
+
+Regards,
+
+The [% c.config.name %] team.

Added: tags/parley-0.55/root/email_templates/thread_update_notify.eml
===================================================================
--- tags/parley-0.55/root/email_templates/thread_update_notify.eml	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/email_templates/thread_update_notify.eml	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+[% person.first_name %],
+
+The thread &quot;[% post.thread.subject %]&quot;
+has received a new reply by [% post.creator.forum_name %].
+
+Click here to continue reading the thread:
+
+ [% c.req.base %]thread/next_post?thread=[% post.thread.id %]
+
+Click here to view the latest post in the thread:
+
+ [% c.req.base %]post/view?post=[% post.id %]
+
+Please note: You will not receive any further notifications for this
+thread until you view the post above or any posts created after it.
+
+Regards,
+
+The [% c.config.name %] team.

Added: tags/parley-0.55/root/email_templates/thread_update_notify.html
===================================================================
--- tags/parley-0.55/root/email_templates/thread_update_notify.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/email_templates/thread_update_notify.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,30 @@
+&lt;html&gt;
+    &lt;head&gt;
+        &lt;title&gt;Thread Update Notification&lt;/title&gt;
+    &lt;/head&gt;
+
+    &lt;body&gt;
+        &lt;p&gt;[% person.first_name %],&lt;/p&gt;
+
+        &lt;p&gt;The thread &quot;[% post.thread.subject %]&quot;
+        has received a new reply by [% post.creator.forum_name %].&lt;/p&gt;
+
+        &lt;p&gt;Choose one of the following actions:
+        &lt;ul&gt;
+            &lt;li&gt;
+            &lt;a href=&quot;[% c.req.base %]thread/next_post?thread=[% post.thread.id %]&quot;&gt;Continue reading &quot;[% post.thread.subject %]&quot; from your last position&lt;/a&gt;
+            &lt;/li&gt;
+            &lt;li&gt;
+            &lt;a href=&quot;[% c.req.base %]post/view?post=[% post.id %]&quot;&gt;View &quot;[% post.thread.subject %]&quot; from the new post&lt;/a&gt;
+            &lt;/li&gt;
+        &lt;/ul&gt;
+        &lt;/p&gt;
+
+        &lt;p&gt;Please note: You &lt;b&gt;will not&lt;/b&gt; receive any further notifications for this thread until you view the post above
+        or any posts created after it.&lt;/p&gt;
+
+        &lt;p&gt;Regards,&lt;/p&gt;
+
+        &lt;p&gt;The [% c.config.name %] team.&lt;/p&gt;
+    &lt;/body&gt;
+&lt;/html&gt;

Added: tags/parley-0.55/root/email_templates/username_reminder.eml
===================================================================
--- tags/parley-0.55/root/email_templates/username_reminder.eml	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/email_templates/username_reminder.eml	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+[% person.first_name %],
+
+Your username for [% c.config.name %] is:
+
+  [% person.authentication.username %]
+
+You can visit [% c.config.name %] at:
+
+  [% c.request.base %]
+
+Regards,
+
+The [% c.config.name %] team.

Added: tags/parley-0.55/root/favicon.ico
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/favicon.ico
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: tags/parley-0.55/root/prototype.js
===================================================================
--- tags/parley-0.55/root/prototype.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/prototype.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,1038 @@
+/*  Prototype JavaScript framework, version 1.3.1
+ *  (c) 2005 Sam Stephenson &lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">sam at conio.net</A>&gt;
+ *
+ *  THIS FILE IS AUTOMATICALLY GENERATED. When sending patches, please diff
+ *  against the source tree, available from the Prototype darcs repository. 
+ *
+ *  Prototype is freely distributable under the terms of an MIT-style license.
+ *
+ *  For details, see the Prototype web site: <A HREF="http://prototype.conio.net/">http://prototype.conio.net/</A>
+ *
+/*--------------------------------------------------------------------------*/
+
+var Prototype = {
+  Version: '1.3.1',
+  emptyFunction: function() {}
+}
+
+var Class = {
+  create: function() {
+    return function() { 
+      this.initialize.apply(this, arguments);
+    }
+  }
+}
+
+var Abstract = new Object();
+
+Object.extend = function(destination, source) {
+  for (property in source) {
+    destination[property] = source[property];
+  }
+  return destination;
+}
+
+Object.prototype.extend = function(object) {
+  return Object.extend.apply(this, [this, object]);
+}
+
+Function.prototype.bind = function(object) {
+  var __method = this;
+  return function() {
+    __method.apply(object, arguments);
+  }
+}
+
+Function.prototype.bindAsEventListener = function(object) {
+  var __method = this;
+  return function(event) {
+    __method.call(object, event || window.event);
+  }
+}
+
+Number.prototype.toColorPart = function() {
+  var digits = this.toString(16);
+  if (this &lt; 16) return '0' + digits;
+  return digits;
+}
+
+var Try = {
+  these: function() {
+    var returnValue;
+
+    for (var i = 0; i &lt; arguments.length; i++) {
+      var lambda = arguments[i];
+      try {
+        returnValue = lambda();
+        break;
+      } catch (e) {}
+    }
+
+    return returnValue;
+  }
+}
+
+/*--------------------------------------------------------------------------*/
+
+var PeriodicalExecuter = Class.create();
+PeriodicalExecuter.prototype = {
+  initialize: function(callback, frequency) {
+    this.callback = callback;
+    this.frequency = frequency;
+    this.currentlyExecuting = false;
+
+    this.registerCallback();
+  },
+
+  registerCallback: function() {
+    setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
+  },
+
+  onTimerEvent: function() {
+    if (!this.currentlyExecuting) {
+      try { 
+        this.currentlyExecuting = true;
+        this.callback(); 
+      } finally { 
+        this.currentlyExecuting = false;
+      }
+    }
+  }
+}
+
+/*--------------------------------------------------------------------------*/
+
+function $() {
+  var elements = new Array();
+
+  for (var i = 0; i &lt; arguments.length; i++) {
+    var element = arguments[i];
+    if (typeof element == 'string')
+      element = document.getElementById(element);
+
+    if (arguments.length == 1) 
+      return element;
+
+    elements.push(element);
+  }
+
+  return elements;
+}
+
+if (!Array.prototype.push) {
+  Array.prototype.push = function() {
+                var startLength = this.length;
+                for (var i = 0; i &lt; arguments.length; i++)
+      this[startLength + i] = arguments[i];
+          return this.length;
+  }
+}
+
+if (!Function.prototype.apply) {
+  // Based on code from <A HREF="http://www.youngpup.net/">http://www.youngpup.net/</A>
+  Function.prototype.apply = function(object, parameters) {
+    var parameterStrings = new Array();
+    if (!object)     object = window;
+    if (!parameters) parameters = new Array();
+    
+    for (var i = 0; i &lt; parameters.length; i++)
+      parameterStrings[i] = 'parameters[' + i + ']';
+    
+    object.__apply__ = this;
+    var result = eval('object.__apply__(' + 
+      parameterStrings[i].join(', ') + ')');
+    object.__apply__ = null;
+    
+    return result;
+  }
+}
+
+String.prototype.extend({
+  stripTags: function() {
+    return this.replace(/&lt;\/?[^&gt;]+&gt;/gi, '');
+  },
+
+  escapeHTML: function() {
+    var div = document.createElement('div');
+    var text = document.createTextNode(this);
+    div.appendChild(text);
+    return div.innerHTML;
+  },
+
+  unescapeHTML: function() {
+    var div = document.createElement('div');
+    div.innerHTML = this.stripTags();
+    return div.childNodes[0].nodeValue;
+  }
+});
+
+var Ajax = {
+  getTransport: function() {
+    return Try.these(
+      function() {return new ActiveXObject('Msxml2.XMLHTTP')},
+      function() {return new ActiveXObject('Microsoft.XMLHTTP')},
+      function() {return new XMLHttpRequest()}
+    ) || false;
+  }
+}
+
+Ajax.Base = function() {};
+Ajax.Base.prototype = {
+  setOptions: function(options) {
+    this.options = {
+      method:       'post',
+      asynchronous: true,
+      parameters:   ''
+    }.extend(options || {});
+  },
+
+  responseIsSuccess: function() {
+    return this.transport.status == undefined
+        || this.transport.status == 0 
+        || (this.transport.status &gt;= 200 &amp;&amp; this.transport.status &lt; 300);
+  },
+
+  responseIsFailure: function() {
+    return !this.responseIsSuccess();
+  }
+}
+
+Ajax.Request = Class.create();
+Ajax.Request.Events = 
+  ['Uninitialized', 'Loading', 'Loaded', 'Interactive', 'Complete'];
+
+Ajax.Request.prototype = (new Ajax.Base()).extend({
+  initialize: function(url, options) {
+    this.transport = Ajax.getTransport();
+    this.setOptions(options);
+    this.request(url);
+  },
+
+  request: function(url) {
+    var parameters = this.options.parameters || '';
+    if (parameters.length &gt; 0) parameters += '&amp;_=';
+
+    try {
+      if (this.options.method == 'get')
+        url += '?' + parameters;
+
+      this.transport.open(this.options.method, url,
+        this.options.asynchronous);
+
+      if (this.options.asynchronous) {
+        this.transport.onreadystatechange = this.onStateChange.bind(this);
+        setTimeout((function() {this.respondToReadyState(1)}).bind(this), 10);
+      }
+
+      this.setRequestHeaders();
+
+      var body = this.options.postBody ? this.options.postBody : parameters;
+      this.transport.send(this.options.method == 'post' ? body : null);
+
+    } catch (e) {
+    }
+  },
+
+  setRequestHeaders: function() {
+    var requestHeaders = 
+      ['X-Requested-With', 'XMLHttpRequest',
+       'X-Prototype-Version', Prototype.Version];
+
+    if (this.options.method == 'post') {
+      requestHeaders.push('Content-type', 
+        'application/x-www-form-urlencoded');
+
+      /* Force &quot;Connection: close&quot; for Mozilla browsers to work around
+       * a bug where XMLHttpReqeuest sends an incorrect Content-length
+       * header. See Mozilla Bugzilla #246651. 
+       */
+      if (this.transport.overrideMimeType)
+        requestHeaders.push('Connection', 'close');
+    }
+
+    if (this.options.requestHeaders)
+      requestHeaders.push.apply(requestHeaders, this.options.requestHeaders);
+
+    for (var i = 0; i &lt; requestHeaders.length; i += 2)
+      this.transport.setRequestHeader(requestHeaders[i], requestHeaders[i+1]);
+  },
+
+  onStateChange: function() {
+    var readyState = this.transport.readyState;
+    if (readyState != 1)
+      this.respondToReadyState(this.transport.readyState);
+  },
+
+  respondToReadyState: function(readyState) {
+    var event = Ajax.Request.Events[readyState];
+
+    if (event == 'Complete')
+      (this.options['on' + this.transport.status]
+       || this.options['on' + this.responseIsSuccess() ? 'Success' : 'Failure']
+       || Prototype.emptyFunction)(this.transport);
+
+    (this.options['on' + event] || Prototype.emptyFunction)(this.transport);
+
+    /* Avoid memory leak in MSIE: clean up the oncomplete event handler */
+    if (event == 'Complete')
+      this.transport.onreadystatechange = Prototype.emptyFunction;
+  }
+});
+
+Ajax.Updater = Class.create();
+Ajax.Updater.ScriptFragment = '(?:&lt;script.*?&gt;)((\n|.)*?)(?:&lt;\/script&gt;)';
+
+Ajax.Updater.prototype.extend(Ajax.Request.prototype).extend({
+  initialize: function(container, url, options) {
+    this.containers = {
+      success: container.success ? $(container.success) : $(container),
+      failure: container.failure ? $(container.failure) :
+        (container.success ? null : $(container))
+    }
+
+    this.transport = Ajax.getTransport();
+    this.setOptions(options);
+
+    var onComplete = this.options.onComplete || Prototype.emptyFunction;
+    this.options.onComplete = (function() {
+      this.updateContent();
+      onComplete(this.transport);
+    }).bind(this);
+
+    this.request(url);
+  },
+
+  updateContent: function() {
+    var receiver = this.responseIsSuccess() ?
+      this.containers.success : this.containers.failure;
+
+    var match    = new RegExp(Ajax.Updater.ScriptFragment, 'img');
+    var response = this.transport.responseText.replace(match, '');
+    var scripts  = this.transport.responseText.match(match);
+
+    if (receiver) {
+      if (this.options.insertion) {
+        new this.options.insertion(receiver, response);
+      } else {
+        receiver.innerHTML = response;
+      }
+    }
+
+    if (this.responseIsSuccess()) {
+      if (this.onComplete)
+        setTimeout((function() {this.onComplete(
+          this.transport)}).bind(this), 10);
+    }
+
+    if (this.options.evalScripts &amp;&amp; scripts) {
+      match = new RegExp(Ajax.Updater.ScriptFragment, 'im');
+      setTimeout((function() {
+        for (var i = 0; i &lt; scripts.length; i++)
+          eval(scripts[i].match(match)[1]);
+      }).bind(this), 10);
+    }
+  }
+});
+
+Ajax.PeriodicalUpdater = Class.create();
+Ajax.PeriodicalUpdater.prototype = (new Ajax.Base()).extend({
+  initialize: function(container, url, options) {
+    this.setOptions(options);
+    this.onComplete = this.options.onComplete;
+
+    this.frequency = (this.options.frequency || 2);
+    this.decay = 1;
+
+    this.updater = {};
+    this.container = container;
+    this.url = url;
+
+    this.start();
+  },
+
+  start: function() {
+    this.options.onComplete = this.updateComplete.bind(this);
+    this.onTimerEvent();
+  },
+
+  stop: function() {
+    this.updater.onComplete = undefined;
+    clearTimeout(this.timer);
+    (this.onComplete || Ajax.emptyFunction).apply(this, arguments);
+  },
+
+  updateComplete: function(request) {
+    if (this.options.decay) {
+      this.decay = (request.responseText == this.lastText ? 
+        this.decay * this.options.decay : 1);
+
+      this.lastText = request.responseText;
+    }
+    this.timer = setTimeout(this.onTimerEvent.bind(this), 
+      this.decay * this.frequency * 1000);
+  },
+
+  onTimerEvent: function() {
+    this.updater = new Ajax.Updater(this.container, this.url, this.options);
+  }
+});
+
+document.getElementsByClassName = function(className) {
+  var children = document.getElementsByTagName('*') || document.all;
+  var elements = new Array();
+  
+  for (var i = 0; i &lt; children.length; i++) {
+    var child = children[i];
+    var classNames = child.className.split(' ');
+    for (var j = 0; j &lt; classNames.length; j++) {
+      if (classNames[j] == className) {
+        elements.push(child);
+        break;
+      }
+    }
+  }
+  
+  return elements;
+}
+
+/*--------------------------------------------------------------------------*/
+
+if (!window.Element) {
+  var Element = new Object();
+}
+
+Object.extend(Element, {
+  toggle: function() {
+    for (var i = 0; i &lt; arguments.length; i++) {
+      var element = $(arguments[i]);
+      element.style.display = 
+        (element.style.display == 'none' ? '' : 'none');
+    }
+  },
+
+  hide: function() {
+    for (var i = 0; i &lt; arguments.length; i++) {
+      var element = $(arguments[i]);
+      element.style.display = 'none';
+    }
+  },
+
+  show: function() {
+    for (var i = 0; i &lt; arguments.length; i++) {
+      var element = $(arguments[i]);
+      element.style.display = '';
+    }
+  },
+
+  remove: function(element) {
+    element = $(element);
+    element.parentNode.removeChild(element);
+  },
+   
+  getHeight: function(element) {
+    element = $(element);
+    return element.offsetHeight; 
+  },
+
+  hasClassName: function(element, className) {
+    element = $(element);
+    if (!element)
+      return;
+    var a = element.className.split(' ');
+    for (var i = 0; i &lt; a.length; i++) {
+      if (a[i] == className)
+        return true;
+    }
+    return false;
+  },
+
+  addClassName: function(element, className) {
+    element = $(element);
+    Element.removeClassName(element, className);
+    element.className += ' ' + className;
+  },
+
+  removeClassName: function(element, className) {
+    element = $(element);
+    if (!element)
+      return;
+    var newClassName = '';
+    var a = element.className.split(' ');
+    for (var i = 0; i &lt; a.length; i++) {
+      if (a[i] != className) {
+        if (i &gt; 0)
+          newClassName += ' ';
+        newClassName += a[i];
+      }
+    }
+    element.className = newClassName;
+  },
+  
+  // removes whitespace-only text node children
+  cleanWhitespace: function(element) {
+    var element = $(element);
+    for (var i = 0; i &lt; element.childNodes.length; i++) {
+      var node = element.childNodes[i];
+      if (node.nodeType == 3 &amp;&amp; !/\S/.test(node.nodeValue)) 
+        Element.remove(node);
+    }
+  }
+});
+
+var Toggle = new Object();
+Toggle.display = Element.toggle;
+
+/*--------------------------------------------------------------------------*/
+
+Abstract.Insertion = function(adjacency) {
+  this.adjacency = adjacency;
+}
+
+Abstract.Insertion.prototype = {
+  initialize: function(element, content) {
+    this.element = $(element);
+    this.content = content;
+    
+    if (this.adjacency &amp;&amp; this.element.insertAdjacentHTML) {
+      this.element.insertAdjacentHTML(this.adjacency, this.content);
+    } else {
+      this.range = this.element.ownerDocument.createRange();
+      if (this.initializeRange) this.initializeRange();
+      this.fragment = this.range.createContextualFragment(this.content);
+      this.insertContent();
+    }
+  }
+}
+
+var Insertion = new Object();
+
+Insertion.Before = Class.create();
+Insertion.Before.prototype = (new Abstract.Insertion('beforeBegin')).extend({
+  initializeRange: function() {
+    this.range.setStartBefore(this.element);
+  },
+  
+  insertContent: function() {
+    this.element.parentNode.insertBefore(this.fragment, this.element);
+  }
+});
+
+Insertion.Top = Class.create();
+Insertion.Top.prototype = (new Abstract.Insertion('afterBegin')).extend({
+  initializeRange: function() {
+    this.range.selectNodeContents(this.element);
+    this.range.collapse(true);
+  },
+  
+  insertContent: function() {  
+    this.element.insertBefore(this.fragment, this.element.firstChild);
+  }
+});
+
+Insertion.Bottom = Class.create();
+Insertion.Bottom.prototype = (new Abstract.Insertion('beforeEnd')).extend({
+  initializeRange: function() {
+    this.range.selectNodeContents(this.element);
+    this.range.collapse(this.element);
+  },
+  
+  insertContent: function() {
+    this.element.appendChild(this.fragment);
+  }
+});
+
+Insertion.After = Class.create();
+Insertion.After.prototype = (new Abstract.Insertion('afterEnd')).extend({
+  initializeRange: function() {
+    this.range.setStartAfter(this.element);
+  },
+  
+  insertContent: function() {
+    this.element.parentNode.insertBefore(this.fragment, 
+      this.element.nextSibling);
+  }
+});
+
+var Field = {
+  clear: function() {
+    for (var i = 0; i &lt; arguments.length; i++)
+      $(arguments[i]).value = '';
+  },
+
+  focus: function(element) {
+    $(element).focus();
+  },
+  
+  present: function() {
+    for (var i = 0; i &lt; arguments.length; i++)
+      if ($(arguments[i]).value == '') return false;
+    return true;
+  },
+  
+  select: function(element) {
+    $(element).select();
+  },
+   
+  activate: function(element) {
+    $(element).focus();
+    $(element).select();
+  }
+}
+
+/*--------------------------------------------------------------------------*/
+
+var Form = {
+  serialize: function(form) {
+    var elements = Form.getElements($(form));
+    var queryComponents = new Array();
+    
+    for (var i = 0; i &lt; elements.length; i++) {
+      var queryComponent = Form.Element.serialize(elements[i]);
+      if (queryComponent)
+        queryComponents.push(queryComponent);
+    }
+    
+    return queryComponents.join('&amp;');
+  },
+  
+  getElements: function(form) {
+    var form = $(form);
+    var elements = new Array();
+
+    for (tagName in Form.Element.Serializers) {
+      var tagElements = form.getElementsByTagName(tagName);
+      for (var j = 0; j &lt; tagElements.length; j++)
+        elements.push(tagElements[j]);
+    }
+    return elements;
+  },
+  
+  getInputs: function(form, typeName, name) {
+    var form = $(form);
+    var inputs = form.getElementsByTagName('input');
+    
+    if (!typeName &amp;&amp; !name)
+      return inputs;
+      
+    var matchingInputs = new Array();
+    for (var i = 0; i &lt; inputs.length; i++) {
+      var input = inputs[i];
+      if ((typeName &amp;&amp; input.type != typeName) ||
+          (name &amp;&amp; input.name != name)) 
+        continue;
+      matchingInputs.push(input);
+    }
+
+    return matchingInputs;
+  },
+
+  disable: function(form) {
+    var elements = Form.getElements(form);
+    for (var i = 0; i &lt; elements.length; i++) {
+      var element = elements[i];
+      element.blur();
+      element.disabled = 'true';
+    }
+  },
+
+  enable: function(form) {
+    var elements = Form.getElements(form);
+    for (var i = 0; i &lt; elements.length; i++) {
+      var element = elements[i];
+      element.disabled = '';
+    }
+  },
+
+  focusFirstElement: function(form) {
+    var form = $(form);
+    var elements = Form.getElements(form);
+    for (var i = 0; i &lt; elements.length; i++) {
+      var element = elements[i];
+      if (element.type != 'hidden' &amp;&amp; !element.disabled) {
+        Field.activate(element);
+        break;
+      }
+    }
+  },
+
+  reset: function(form) {
+    $(form).reset();
+  }
+}
+
+Form.Element = {
+  serialize: function(element) {
+    var element = $(element);
+    var method = element.tagName.toLowerCase();
+    var parameter = Form.Element.Serializers[method](element);
+    
+    if (parameter)
+      return encodeURIComponent(parameter[0]) + '=' + 
+        encodeURIComponent(parameter[1]);                   
+  },
+  
+  getValue: function(element) {
+    var element = $(element);
+    var method = element.tagName.toLowerCase();
+    var parameter = Form.Element.Serializers[method](element);
+    
+    if (parameter) 
+      return parameter[1];
+  }
+}
+
+Form.Element.Serializers = {
+  input: function(element) {
+    switch (element.type.toLowerCase()) {
+      case 'submit':
+      case 'hidden':
+      case 'password':
+      case 'text':
+        return Form.Element.Serializers.textarea(element);
+      case 'checkbox':  
+      case 'radio':
+        return Form.Element.Serializers.inputSelector(element);
+    }
+    return false;
+  },
+
+  inputSelector: function(element) {
+    if (element.checked)
+      return [element.name, element.value];
+  },
+
+  textarea: function(element) {
+    return [element.name, element.value];
+  },
+
+  select: function(element) {
+    var value = '';
+    if (element.type == 'select-one') {
+      var index = element.selectedIndex;
+      if (index &gt;= 0)
+        value = element.options[index].value || element.options[index].text;
+    } else {
+      value = new Array();
+      for (var i = 0; i &lt; element.length; i++) {
+        var opt = element.options[i];
+        if (opt.selected)
+          value.push(opt.value || opt.text);
+      }
+    }
+    return [element.name, value];
+  }
+}
+
+/*--------------------------------------------------------------------------*/
+
+var $F = Form.Element.getValue;
+
+/*--------------------------------------------------------------------------*/
+
+Abstract.TimedObserver = function() {}
+Abstract.TimedObserver.prototype = {
+  initialize: function(element, frequency, callback) {
+    this.frequency = frequency;
+    this.element   = $(element);
+    this.callback  = callback;
+    
+    this.lastValue = this.getValue();
+    this.registerCallback();
+  },
+  
+  registerCallback: function() {
+    setInterval(this.onTimerEvent.bind(this), this.frequency * 1000);
+  },
+  
+  onTimerEvent: function() {
+    var value = this.getValue();
+    if (this.lastValue != value) {
+      this.callback(this.element, value);
+      this.lastValue = value;
+    }
+  }
+}
+
+Form.Element.Observer = Class.create();
+Form.Element.Observer.prototype = (new Abstract.TimedObserver()).extend({
+  getValue: function() {
+    return Form.Element.getValue(this.element);
+  }
+});
+
+Form.Observer = Class.create();
+Form.Observer.prototype = (new Abstract.TimedObserver()).extend({
+  getValue: function() {
+    return Form.serialize(this.element);
+  }
+});
+
+/*--------------------------------------------------------------------------*/
+
+Abstract.EventObserver = function() {}
+Abstract.EventObserver.prototype = {
+  initialize: function(element, callback) {
+    this.element  = $(element);
+    this.callback = callback;
+    
+    this.lastValue = this.getValue();
+    if (this.element.tagName.toLowerCase() == 'form')
+      this.registerFormCallbacks();
+    else
+      this.registerCallback(this.element);
+  },
+  
+  onElementEvent: function() {
+    var value = this.getValue();
+    if (this.lastValue != value) {
+      this.callback(this.element, value);
+      this.lastValue = value;
+    }
+  },
+  
+  registerFormCallbacks: function() {
+    var elements = Form.getElements(this.element);
+    for (var i = 0; i &lt; elements.length; i++)
+      this.registerCallback(elements[i]);
+  },
+  
+  registerCallback: function(element) {
+    if (element.type) {
+      switch (element.type.toLowerCase()) {
+        case 'checkbox':  
+        case 'radio':
+          element.target = this;
+          element.prev_onclick = element.onclick || Prototype.emptyFunction;
+          element.onclick = function() {
+            this.prev_onclick(); 
+            this.target.onElementEvent();
+          }
+          break;
+        case 'password':
+        case 'text':
+        case 'textarea':
+        case 'select-one':
+        case 'select-multiple':
+          element.target = this;
+          element.prev_onchange = element.onchange || Prototype.emptyFunction;
+          element.onchange = function() {
+            this.prev_onchange(); 
+            this.target.onElementEvent();
+          }
+          break;
+      }
+    }    
+  }
+}
+
+Form.Element.EventObserver = Class.create();
+Form.Element.EventObserver.prototype = (new Abstract.EventObserver()).extend({
+  getValue: function() {
+    return Form.Element.getValue(this.element);
+  }
+});
+
+Form.EventObserver = Class.create();
+Form.EventObserver.prototype = (new Abstract.EventObserver()).extend({
+  getValue: function() {
+    return Form.serialize(this.element);
+  }
+});
+
+
+if (!window.Event) {
+  var Event = new Object();
+}
+
+Object.extend(Event, {
+  KEY_BACKSPACE: 8,
+  KEY_TAB:       9,
+  KEY_RETURN:   13,
+  KEY_ESC:      27,
+  KEY_LEFT:     37,
+  KEY_UP:       38,
+  KEY_RIGHT:    39,
+  KEY_DOWN:     40,
+  KEY_DELETE:   46,
+
+  element: function(event) {
+    return event.target || event.srcElement;
+  },
+
+  isLeftClick: function(event) {
+    return (((event.which) &amp;&amp; (event.which == 1)) ||
+            ((event.button) &amp;&amp; (event.button == 1)));
+  },
+
+  pointerX: function(event) {
+    return event.pageX || (event.clientX + 
+      (document.documentElement.scrollLeft || document.body.scrollLeft));
+  },
+
+  pointerY: function(event) {
+    return event.pageY || (event.clientY + 
+      (document.documentElement.scrollTop || document.body.scrollTop));
+  },
+
+  stop: function(event) {
+    if (event.preventDefault) { 
+      event.preventDefault(); 
+      event.stopPropagation(); 
+    } else {
+      event.returnValue = false;
+    }
+  },
+
+  // find the first node with the given tagName, starting from the
+  // node the event was triggered on; traverses the DOM upwards
+  findElement: function(event, tagName) {
+    var element = Event.element(event);
+    while (element.parentNode &amp;&amp; (!element.tagName ||
+        (element.tagName.toUpperCase() != tagName.toUpperCase())))
+      element = element.parentNode;
+    return element;
+  },
+
+  observers: false,
+  
+  _observeAndCache: function(element, name, observer, useCapture) {
+    if (!this.observers) this.observers = [];
+    if (element.addEventListener) {
+      this.observers.push([element, name, observer, useCapture]);
+      element.addEventListener(name, observer, useCapture);
+    } else if (element.attachEvent) {
+      this.observers.push([element, name, observer, useCapture]);
+      element.attachEvent('on' + name, observer);
+    }
+  },
+  
+  unloadCache: function() {
+    if (!Event.observers) return;
+    for (var i = 0; i &lt; Event.observers.length; i++) {
+      Event.stopObserving.apply(this, Event.observers[i]);
+      Event.observers[i][0] = null;
+    }
+    Event.observers = false;
+  },
+
+  observe: function(element, name, observer, useCapture) {
+    var element = $(element);
+    useCapture = useCapture || false;
+    
+    if (name == 'keypress' &amp;&amp;
+        ((navigator.appVersion.indexOf('AppleWebKit') &gt; 0) 
+        || element.attachEvent))
+      name = 'keydown';
+    
+    this._observeAndCache(element, name, observer, useCapture);
+  },
+
+  stopObserving: function(element, name, observer, useCapture) {
+    var element = $(element);
+    useCapture = useCapture || false;
+    
+    if (name == 'keypress' &amp;&amp;
+        ((navigator.appVersion.indexOf('AppleWebKit') &gt; 0) 
+        || element.detachEvent))
+      name = 'keydown';
+    
+    if (element.removeEventListener) {
+      element.removeEventListener(name, observer, useCapture);
+    } else if (element.detachEvent) {
+      element.detachEvent('on' + name, observer);
+    }
+  }
+});
+
+/* prevent memory leaks in IE */
+Event.observe(window, 'unload', Event.unloadCache, false);
+
+var Position = {
+
+  // set to true if needed, warning: firefox performance problems
+  // NOT neeeded for page scrolling, only if draggable contained in
+  // scrollable elements
+  includeScrollOffsets: false, 
+
+  // must be called before calling withinIncludingScrolloffset, every time the
+  // page is scrolled
+  prepare: function() {
+    this.deltaX =  window.pageXOffset 
+                || document.documentElement.scrollLeft 
+                || document.body.scrollLeft 
+                || 0;
+    this.deltaY =  window.pageYOffset 
+                || document.documentElement.scrollTop 
+                || document.body.scrollTop 
+                || 0;
+  },
+
+  realOffset: function(element) {
+    var valueT = 0, valueL = 0;
+    do {
+      valueT += element.scrollTop  || 0;
+      valueL += element.scrollLeft || 0; 
+      element = element.parentNode;
+    } while (element);
+    return [valueL, valueT];
+  },
+
+  cumulativeOffset: function(element) {
+    var valueT = 0, valueL = 0;
+    do {
+      valueT += element.offsetTop  || 0;
+      valueL += element.offsetLeft || 0;
+      element = element.offsetParent;
+    } while (element);
+    return [valueL, valueT];
+  },
+
+  // caches x/y coordinate pair to use with overlap
+  within: function(element, x, y) {
+    if (this.includeScrollOffsets)
+      return this.withinIncludingScrolloffsets(element, x, y);
+    this.xcomp = x;
+    this.ycomp = y;
+    this.offset = this.cumulativeOffset(element);
+
+    return (y &gt;= this.offset[1] &amp;&amp;
+            y &lt;  this.offset[1] + element.offsetHeight &amp;&amp;
+            x &gt;= this.offset[0] &amp;&amp; 
+            x &lt;  this.offset[0] + element.offsetWidth);
+  },
+
+  withinIncludingScrolloffsets: function(element, x, y) {
+    var offsetcache = this.realOffset(element);
+
+    this.xcomp = x + offsetcache[0] - this.deltaX;
+    this.ycomp = y + offsetcache[1] - this.deltaY;
+    this.offset = this.cumulativeOffset(element);
+
+    return (this.ycomp &gt;= this.offset[1] &amp;&amp;
+            this.ycomp &lt;  this.offset[1] + element.offsetHeight &amp;&amp;
+            this.xcomp &gt;= this.offset[0] &amp;&amp; 
+            this.xcomp &lt;  this.offset[0] + element.offsetWidth);
+  },
+
+  // within must be called directly before
+  overlap: function(mode, element) {  
+    if (!mode) return 0;  
+    if (mode == 'vertical') 
+      return ((this.offset[1] + element.offsetHeight) - this.ycomp) / 
+        element.offsetHeight;
+    if (mode == 'horizontal')
+      return ((this.offset[0] + element.offsetWidth) - this.xcomp) / 
+        element.offsetWidth;
+  },
+
+  clone: function(source, target) {
+    source = $(source);
+    target = $(target);
+    target.style.position = 'absolute';
+    var offsets = this.cumulativeOffset(source);
+    target.style.top    = offsets[1] + 'px';
+    target.style.left   = offsets[0] + 'px';
+    target.style.width  = source.offsetWidth + 'px';
+    target.style.height = source.offsetHeight + 'px';
+  }
+}

Added: tags/parley-0.55/root/static/images/btn_120x50_built.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_120x50_built.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_120x50_built_shadow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_120x50_built_shadow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_120x50_powered.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_120x50_powered.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_120x50_powered_shadow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_120x50_powered_shadow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_88x31_built.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_88x31_built.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_88x31_built_shadow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_88x31_built_shadow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_88x31_powered.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_88x31_powered.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/btn_88x31_powered_shadow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/btn_88x31_powered_shadow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/catalyst_logo.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/catalyst_logo.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/filetypes/image.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/filetypes/image.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/filetypes/pdf.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/filetypes/pdf.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/locked.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/locked.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/sticky.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/sticky.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/images/unread_posts.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/images/unread_posts.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/dojo.js
===================================================================
--- tags/parley-0.55/root/static/magic/dojo.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/dojo.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6441 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+/*
+	This is a compiled version of Dojo, built for deployment and not for
+	development. To get an editable version, please visit:
+
+		<A HREF="http://dojotoolkit.org">http://dojotoolkit.org</A>
+
+	for documentation and information on getting the source.
+*/
+
+if(typeof dojo==&quot;undefined&quot;){
+var dj_global=this;
+var dj_currentContext=this;
+function dj_undef(_1,_2){
+return (typeof (_2||dj_currentContext)[_1]==&quot;undefined&quot;);
+}
+if(dj_undef(&quot;djConfig&quot;,this)){
+var djConfig={};
+}
+if(dj_undef(&quot;dojo&quot;,this)){
+var dojo={};
+}
+dojo.global=function(){
+return dj_currentContext;
+};
+dojo.locale=djConfig.locale;
+dojo.version={major:0,minor:4,patch:3,flag:&quot;&quot;,revision:Number(&quot;$Rev: 8617 $&quot;.match(/[0-9]+/)[0]),toString:function(){
+with(dojo.version){
+return major+&quot;.&quot;+minor+&quot;.&quot;+patch+flag+&quot; (&quot;+revision+&quot;)&quot;;
+}
+}};
+dojo.evalProp=function(_3,_4,_5){
+if((!_4)||(!_3)){
+return undefined;
+}
+if(!dj_undef(_3,_4)){
+return _4[_3];
+}
+return (_5?(_4[_3]={}):undefined);
+};
+dojo.parseObjPath=function(_6,_7,_8){
+var _9=(_7||dojo.global());
+var _a=_6.split(&quot;.&quot;);
+var _b=_a.pop();
+for(var i=0,l=_a.length;i&lt;l&amp;&amp;_9;i++){
+_9=dojo.evalProp(_a[i],_9,_8);
+}
+return {obj:_9,prop:_b};
+};
+dojo.evalObjPath=function(_e,_f){
+if(typeof _e!=&quot;string&quot;){
+return dojo.global();
+}
+if(_e.indexOf(&quot;.&quot;)==-1){
+return dojo.evalProp(_e,dojo.global(),_f);
+}
+var ref=dojo.parseObjPath(_e,dojo.global(),_f);
+if(ref){
+return dojo.evalProp(ref.prop,ref.obj,_f);
+}
+return null;
+};
+dojo.errorToString=function(_11){
+if(!dj_undef(&quot;message&quot;,_11)){
+return _11.message;
+}else{
+if(!dj_undef(&quot;description&quot;,_11)){
+return _11.description;
+}else{
+return _11;
+}
+}
+};
+dojo.raise=function(_12,_13){
+if(_13){
+_12=_12+&quot;: &quot;+dojo.errorToString(_13);
+}else{
+_12=dojo.errorToString(_12);
+}
+try{
+if(djConfig.isDebug){
+dojo.hostenv.println(&quot;FATAL exception raised: &quot;+_12);
+}
+}
+catch(e){
+}
+throw _13||Error(_12);
+};
+dojo.debug=function(){
+};
+dojo.debugShallow=function(obj){
+};
+dojo.profile={start:function(){
+},end:function(){
+},stop:function(){
+},dump:function(){
+}};
+function dj_eval(_15){
+return dj_global.eval?dj_global.eval(_15):eval(_15);
+}
+dojo.unimplemented=function(_16,_17){
+var _18=&quot;'&quot;+_16+&quot;' not implemented&quot;;
+if(_17!=null){
+_18+=&quot; &quot;+_17;
+}
+dojo.raise(_18);
+};
+dojo.deprecated=function(_19,_1a,_1b){
+var _1c=&quot;DEPRECATED: &quot;+_19;
+if(_1a){
+_1c+=&quot; &quot;+_1a;
+}
+if(_1b){
+_1c+=&quot; -- will be removed in version: &quot;+_1b;
+}
+dojo.debug(_1c);
+};
+dojo.render=(function(){
+function vscaffold(_1d,_1e){
+var tmp={capable:false,support:{builtin:false,plugin:false},prefixes:_1d};
+for(var i=0;i&lt;_1e.length;i++){
+tmp[_1e[i]]=false;
+}
+return tmp;
+}
+return {name:&quot;&quot;,ver:dojo.version,os:{win:false,linux:false,osx:false},html:vscaffold([&quot;html&quot;],[&quot;ie&quot;,&quot;opera&quot;,&quot;khtml&quot;,&quot;safari&quot;,&quot;moz&quot;]),svg:vscaffold([&quot;svg&quot;],[&quot;corel&quot;,&quot;adobe&quot;,&quot;batik&quot;]),vml:vscaffold([&quot;vml&quot;],[&quot;ie&quot;]),swf:vscaffold([&quot;Swf&quot;,&quot;Flash&quot;,&quot;Mm&quot;],[&quot;mm&quot;]),swt:vscaffold([&quot;Swt&quot;],[&quot;ibm&quot;])};
+})();
+dojo.hostenv=(function(){
+var _21={isDebug:false,allowQueryConfig:false,baseScriptUri:&quot;&quot;,baseRelativePath:&quot;&quot;,libraryScriptUri:&quot;&quot;,iePreventClobber:false,ieClobberMinimal:true,preventBackButtonFix:true,delayMozLoadingFix:false,searchIds:[],parseWidgets:true};
+if(typeof djConfig==&quot;undefined&quot;){
+djConfig=_21;
+}else{
+for(var _22 in _21){
+if(typeof djConfig[_22]==&quot;undefined&quot;){
+djConfig[_22]=_21[_22];
+}
+}
+}
+return {name_:&quot;(unset)&quot;,version_:&quot;(unset)&quot;,getName:function(){
+return this.name_;
+},getVersion:function(){
+return this.version_;
+},getText:function(uri){
+dojo.unimplemented(&quot;getText&quot;,&quot;uri=&quot;+uri);
+}};
+})();
+dojo.hostenv.getBaseScriptUri=function(){
+if(djConfig.baseScriptUri.length){
+return djConfig.baseScriptUri;
+}
+var uri=new String(djConfig.libraryScriptUri||djConfig.baseRelativePath);
+if(!uri){
+dojo.raise(&quot;Nothing returned by getLibraryScriptUri(): &quot;+uri);
+}
+var _25=uri.lastIndexOf(&quot;/&quot;);
+djConfig.baseScriptUri=djConfig.baseRelativePath;
+return djConfig.baseScriptUri;
+};
+(function(){
+var _26={pkgFileName:&quot;__package__&quot;,loading_modules_:{},loaded_modules_:{},addedToLoadingCount:[],removedFromLoadingCount:[],inFlightCount:0,modulePrefixes_:{dojo:{name:&quot;dojo&quot;,value:&quot;src&quot;}},setModulePrefix:function(_27,_28){
+this.modulePrefixes_[_27]={name:_27,value:_28};
+},moduleHasPrefix:function(_29){
+var mp=this.modulePrefixes_;
+return Boolean(mp[_29]&amp;&amp;mp[_29].value);
+},getModulePrefix:function(_2b){
+if(this.moduleHasPrefix(_2b)){
+return this.modulePrefixes_[_2b].value;
+}
+return _2b;
+},getTextStack:[],loadUriStack:[],loadedUris:[],post_load_:false,modulesLoadedListeners:[],unloadListeners:[],loadNotifying:false};
+for(var _2c in _26){
+dojo.hostenv[_2c]=_26[_2c];
+}
+})();
+dojo.hostenv.loadPath=function(_2d,_2e,cb){
+var uri;
+if(_2d.charAt(0)==&quot;/&quot;||_2d.match(/^\w+:/)){
+uri=_2d;
+}else{
+uri=this.getBaseScriptUri()+_2d;
+}
+if(djConfig.cacheBust&amp;&amp;dojo.render.html.capable){
+uri+=&quot;?&quot;+String(djConfig.cacheBust).replace(/\W+/g,&quot;&quot;);
+}
+try{
+return !_2e?this.loadUri(uri,cb):this.loadUriAndCheck(uri,_2e,cb);
+}
+catch(e){
+dojo.debug(e);
+return false;
+}
+};
+dojo.hostenv.loadUri=function(uri,cb){
+if(this.loadedUris[uri]){
+return true;
+}
+var _33=this.getText(uri,null,true);
+if(!_33){
+return false;
+}
+this.loadedUris[uri]=true;
+if(cb){
+_33=&quot;(&quot;+_33+&quot;)&quot;;
+}
+var _34=dj_eval(_33);
+if(cb){
+cb(_34);
+}
+return true;
+};
+dojo.hostenv.loadUriAndCheck=function(uri,_36,cb){
+var ok=true;
+try{
+ok=this.loadUri(uri,cb);
+}
+catch(e){
+dojo.debug(&quot;failed loading &quot;,uri,&quot; with error: &quot;,e);
+}
+return Boolean(ok&amp;&amp;this.findModule(_36,false));
+};
+dojo.loaded=function(){
+};
+dojo.unloaded=function(){
+};
+dojo.hostenv.loaded=function(){
+this.loadNotifying=true;
+this.post_load_=true;
+var mll=this.modulesLoadedListeners;
+for(var x=0;x&lt;mll.length;x++){
+mll[x]();
+}
+this.modulesLoadedListeners=[];
+this.loadNotifying=false;
+dojo.loaded();
+};
+dojo.hostenv.unloaded=function(){
+var mll=this.unloadListeners;
+while(mll.length){
+(mll.pop())();
+}
+dojo.unloaded();
+};
+dojo.addOnLoad=function(obj,_3d){
+var dh=dojo.hostenv;
+if(arguments.length==1){
+dh.modulesLoadedListeners.push(obj);
+}else{
+if(arguments.length&gt;1){
+dh.modulesLoadedListeners.push(function(){
+obj[_3d]();
+});
+}
+}
+if(dh.post_load_&amp;&amp;dh.inFlightCount==0&amp;&amp;!dh.loadNotifying){
+dh.callLoaded();
+}
+};
+dojo.addOnUnload=function(obj,_40){
+var dh=dojo.hostenv;
+if(arguments.length==1){
+dh.unloadListeners.push(obj);
+}else{
+if(arguments.length&gt;1){
+dh.unloadListeners.push(function(){
+obj[_40]();
+});
+}
+}
+};
+dojo.hostenv.modulesLoaded=function(){
+if(this.post_load_){
+return;
+}
+if(this.loadUriStack.length==0&amp;&amp;this.getTextStack.length==0){
+if(this.inFlightCount&gt;0){
+dojo.debug(&quot;files still in flight!&quot;);
+return;
+}
+dojo.hostenv.callLoaded();
+}
+};
+dojo.hostenv.callLoaded=function(){
+if(typeof setTimeout==&quot;object&quot;||(djConfig[&quot;useXDomain&quot;]&amp;&amp;dojo.render.html.opera)){
+setTimeout(&quot;dojo.hostenv.loaded();&quot;,0);
+}else{
+dojo.hostenv.loaded();
+}
+};
+dojo.hostenv.getModuleSymbols=function(_42){
+var _43=_42.split(&quot;.&quot;);
+for(var i=_43.length;i&gt;0;i--){
+var _45=_43.slice(0,i).join(&quot;.&quot;);
+if((i==1)&amp;&amp;!this.moduleHasPrefix(_45)){
+_43[0]=&quot;../&quot;+_43[0];
+}else{
+var _46=this.getModulePrefix(_45);
+if(_46!=_45){
+_43.splice(0,i,_46);
+break;
+}
+}
+}
+return _43;
+};
+dojo.hostenv._global_omit_module_check=false;
+dojo.hostenv.loadModule=function(_47,_48,_49){
+if(!_47){
+return;
+}
+_49=this._global_omit_module_check||_49;
+var _4a=this.findModule(_47,false);
+if(_4a){
+return _4a;
+}
+if(dj_undef(_47,this.loading_modules_)){
+this.addedToLoadingCount.push(_47);
+}
+this.loading_modules_[_47]=1;
+var _4b=_47.replace(/\./g,&quot;/&quot;)+&quot;.js&quot;;
+var _4c=_47.split(&quot;.&quot;);
+var _4d=this.getModuleSymbols(_47);
+var _4e=((_4d[0].charAt(0)!=&quot;/&quot;)&amp;&amp;!_4d[0].match(/^\w+:/));
+var _4f=_4d[_4d.length-1];
+var ok;
+if(_4f==&quot;*&quot;){
+_47=_4c.slice(0,-1).join(&quot;.&quot;);
+while(_4d.length){
+_4d.pop();
+_4d.push(this.pkgFileName);
+_4b=_4d.join(&quot;/&quot;)+&quot;.js&quot;;
+if(_4e&amp;&amp;_4b.charAt(0)==&quot;/&quot;){
+_4b=_4b.slice(1);
+}
+ok=this.loadPath(_4b,!_49?_47:null);
+if(ok){
+break;
+}
+_4d.pop();
+}
+}else{
+_4b=_4d.join(&quot;/&quot;)+&quot;.js&quot;;
+_47=_4c.join(&quot;.&quot;);
+var _51=!_49?_47:null;
+ok=this.loadPath(_4b,_51);
+if(!ok&amp;&amp;!_48){
+_4d.pop();
+while(_4d.length){
+_4b=_4d.join(&quot;/&quot;)+&quot;.js&quot;;
+ok=this.loadPath(_4b,_51);
+if(ok){
+break;
+}
+_4d.pop();
+_4b=_4d.join(&quot;/&quot;)+&quot;/&quot;+this.pkgFileName+&quot;.js&quot;;
+if(_4e&amp;&amp;_4b.charAt(0)==&quot;/&quot;){
+_4b=_4b.slice(1);
+}
+ok=this.loadPath(_4b,_51);
+if(ok){
+break;
+}
+}
+}
+if(!ok&amp;&amp;!_49){
+dojo.raise(&quot;Could not load '&quot;+_47+&quot;'; last tried '&quot;+_4b+&quot;'&quot;);
+}
+}
+if(!_49&amp;&amp;!this[&quot;isXDomain&quot;]){
+_4a=this.findModule(_47,false);
+if(!_4a){
+dojo.raise(&quot;symbol '&quot;+_47+&quot;' is not defined after loading '&quot;+_4b+&quot;'&quot;);
+}
+}
+return _4a;
+};
+dojo.hostenv.startPackage=function(_52){
+var _53=String(_52);
+var _54=_53;
+var _55=_52.split(/\./);
+if(_55[_55.length-1]==&quot;*&quot;){
+_55.pop();
+_54=_55.join(&quot;.&quot;);
+}
+var _56=dojo.evalObjPath(_54,true);
+this.loaded_modules_[_53]=_56;
+this.loaded_modules_[_54]=_56;
+return _56;
+};
+dojo.hostenv.findModule=function(_57,_58){
+var lmn=String(_57);
+if(this.loaded_modules_[lmn]){
+return this.loaded_modules_[lmn];
+}
+if(_58){
+dojo.raise(&quot;no loaded module named '&quot;+_57+&quot;'&quot;);
+}
+return null;
+};
+dojo.kwCompoundRequire=function(_5a){
+var _5b=_5a[&quot;common&quot;]||[];
+var _5c=_5a[dojo.hostenv.name_]?_5b.concat(_5a[dojo.hostenv.name_]||[]):_5b.concat(_5a[&quot;default&quot;]||[]);
+for(var x=0;x&lt;_5c.length;x++){
+var _5e=_5c[x];
+if(_5e.constructor==Array){
+dojo.hostenv.loadModule.apply(dojo.hostenv,_5e);
+}else{
+dojo.hostenv.loadModule(_5e);
+}
+}
+};
+dojo.require=function(_5f){
+dojo.hostenv.loadModule.apply(dojo.hostenv,arguments);
+};
+dojo.requireIf=function(_60,_61){
+var _62=arguments[0];
+if((_62===true)||(_62==&quot;common&quot;)||(_62&amp;&amp;dojo.render[_62].capable)){
+var _63=[];
+for(var i=1;i&lt;arguments.length;i++){
+_63.push(arguments[i]);
+}
+dojo.require.apply(dojo,_63);
+}
+};
+dojo.requireAfterIf=dojo.requireIf;
+dojo.provide=function(_65){
+return dojo.hostenv.startPackage.apply(dojo.hostenv,arguments);
+};
+dojo.registerModulePath=function(_66,_67){
+return dojo.hostenv.setModulePrefix(_66,_67);
+};
+if(djConfig[&quot;modulePaths&quot;]){
+for(var param in djConfig[&quot;modulePaths&quot;]){
+dojo.registerModulePath(param,djConfig[&quot;modulePaths&quot;][param]);
+}
+}
+dojo.setModulePrefix=function(_68,_69){
+dojo.deprecated(&quot;dojo.setModulePrefix(\&quot;&quot;+_68+&quot;\&quot;, \&quot;&quot;+_69+&quot;\&quot;)&quot;,&quot;replaced by dojo.registerModulePath&quot;,&quot;0.5&quot;);
+return dojo.registerModulePath(_68,_69);
+};
+dojo.exists=function(obj,_6b){
+var p=_6b.split(&quot;.&quot;);
+for(var i=0;i&lt;p.length;i++){
+if(!obj[p[i]]){
+return false;
+}
+obj=obj[p[i]];
+}
+return true;
+};
+dojo.hostenv.normalizeLocale=function(_6e){
+var _6f=_6e?_6e.toLowerCase():dojo.locale;
+if(_6f==&quot;root&quot;){
+_6f=&quot;ROOT&quot;;
+}
+return _6f;
+};
+dojo.hostenv.searchLocalePath=function(_70,_71,_72){
+_70=dojo.hostenv.normalizeLocale(_70);
+var _73=_70.split(&quot;-&quot;);
+var _74=[];
+for(var i=_73.length;i&gt;0;i--){
+_74.push(_73.slice(0,i).join(&quot;-&quot;));
+}
+_74.push(false);
+if(_71){
+_74.reverse();
+}
+for(var j=_74.length-1;j&gt;=0;j--){
+var loc=_74[j]||&quot;ROOT&quot;;
+var _78=_72(loc);
+if(_78){
+break;
+}
+}
+};
+dojo.hostenv.localesGenerated;
+dojo.hostenv.registerNlsPrefix=function(){
+dojo.registerModulePath(&quot;nls&quot;,&quot;nls&quot;);
+};
+dojo.hostenv.preloadLocalizations=function(){
+if(dojo.hostenv.localesGenerated){
+dojo.hostenv.registerNlsPrefix();
+function preload(_79){
+_79=dojo.hostenv.normalizeLocale(_79);
+dojo.hostenv.searchLocalePath(_79,true,function(loc){
+for(var i=0;i&lt;dojo.hostenv.localesGenerated.length;i++){
+if(dojo.hostenv.localesGenerated[i]==loc){
+dojo[&quot;require&quot;](&quot;nls.dojo_&quot;+loc);
+return true;
+}
+}
+return false;
+});
+}
+preload();
+var _7c=djConfig.extraLocale||[];
+for(var i=0;i&lt;_7c.length;i++){
+preload(_7c[i]);
+}
+}
+dojo.hostenv.preloadLocalizations=function(){
+};
+};
+dojo.requireLocalization=function(_7e,_7f,_80,_81){
+dojo.hostenv.preloadLocalizations();
+var _82=dojo.hostenv.normalizeLocale(_80);
+var _83=[_7e,&quot;nls&quot;,_7f].join(&quot;.&quot;);
+var _84=&quot;&quot;;
+if(_81){
+var _85=_81.split(&quot;,&quot;);
+for(var i=0;i&lt;_85.length;i++){
+if(_82.indexOf(_85[i])==0){
+if(_85[i].length&gt;_84.length){
+_84=_85[i];
+}
+}
+}
+if(!_84){
+_84=&quot;ROOT&quot;;
+}
+}
+var _87=_81?_84:_82;
+var _88=dojo.hostenv.findModule(_83);
+var _89=null;
+if(_88){
+if(djConfig.localizationComplete&amp;&amp;_88._built){
+return;
+}
+var _8a=_87.replace(&quot;-&quot;,&quot;_&quot;);
+var _8b=_83+&quot;.&quot;+_8a;
+_89=dojo.hostenv.findModule(_8b);
+}
+if(!_89){
+_88=dojo.hostenv.startPackage(_83);
+var _8c=dojo.hostenv.getModuleSymbols(_7e);
+var _8d=_8c.concat(&quot;nls&quot;).join(&quot;/&quot;);
+var _8e;
+dojo.hostenv.searchLocalePath(_87,_81,function(loc){
+var _90=loc.replace(&quot;-&quot;,&quot;_&quot;);
+var _91=_83+&quot;.&quot;+_90;
+var _92=false;
+if(!dojo.hostenv.findModule(_91)){
+dojo.hostenv.startPackage(_91);
+var _93=[_8d];
+if(loc!=&quot;ROOT&quot;){
+_93.push(loc);
+}
+_93.push(_7f);
+var _94=_93.join(&quot;/&quot;)+&quot;.js&quot;;
+_92=dojo.hostenv.loadPath(_94,null,function(_95){
+var _96=function(){
+};
+_96.prototype=_8e;
+_88[_90]=new _96();
+for(var j in _95){
+_88[_90][j]=_95[j];
+}
+});
+}else{
+_92=true;
+}
+if(_92&amp;&amp;_88[_90]){
+_8e=_88[_90];
+}else{
+_88[_90]=_8e;
+}
+if(_81){
+return true;
+}
+});
+}
+if(_81&amp;&amp;_82!=_84){
+_88[_82.replace(&quot;-&quot;,&quot;_&quot;)]=_88[_84.replace(&quot;-&quot;,&quot;_&quot;)];
+}
+};
+(function(){
+var _98=djConfig.extraLocale;
+if(_98){
+if(!_98 instanceof Array){
+_98=[_98];
+}
+var req=dojo.requireLocalization;
+dojo.requireLocalization=function(m,b,_9c,_9d){
+req(m,b,_9c,_9d);
+if(_9c){
+return;
+}
+for(var i=0;i&lt;_98.length;i++){
+req(m,b,_98[i],_9d);
+}
+};
+}
+})();
+}
+if(typeof window!=&quot;undefined&quot;){
+(function(){
+if(djConfig.allowQueryConfig){
+var _9f=document.location.toString();
+var _a0=_9f.split(&quot;?&quot;,2);
+if(_a0.length&gt;1){
+var _a1=_a0[1];
+var _a2=_a1.split(&quot;&amp;&quot;);
+for(var x in _a2){
+var sp=_a2[x].split(&quot;=&quot;);
+if((sp[0].length&gt;9)&amp;&amp;(sp[0].substr(0,9)==&quot;djConfig.&quot;)){
+var opt=sp[0].substr(9);
+try{
+djConfig[opt]=eval(sp[1]);
+}
+catch(e){
+djConfig[opt]=sp[1];
+}
+}
+}
+}
+}
+if(((djConfig[&quot;baseScriptUri&quot;]==&quot;&quot;)||(djConfig[&quot;baseRelativePath&quot;]==&quot;&quot;))&amp;&amp;(document&amp;&amp;document.getElementsByTagName)){
+var _a6=document.getElementsByTagName(&quot;script&quot;);
+var _a7=/(__package__|dojo|bootstrap1)\.js([\?\.]|$)/i;
+for(var i=0;i&lt;_a6.length;i++){
+var src=_a6[i].getAttribute(&quot;src&quot;);
+if(!src){
+continue;
+}
+var m=src.match(_a7);
+if(m){
+var _ab=src.substring(0,m.index);
+if(src.indexOf(&quot;bootstrap1&quot;)&gt;-1){
+_ab+=&quot;../&quot;;
+}
+if(!this[&quot;djConfig&quot;]){
+djConfig={};
+}
+if(djConfig[&quot;baseScriptUri&quot;]==&quot;&quot;){
+djConfig[&quot;baseScriptUri&quot;]=_ab;
+}
+if(djConfig[&quot;baseRelativePath&quot;]==&quot;&quot;){
+djConfig[&quot;baseRelativePath&quot;]=_ab;
+}
+break;
+}
+}
+}
+var dr=dojo.render;
+var drh=dojo.render.html;
+var drs=dojo.render.svg;
+var dua=(drh.UA=navigator.userAgent);
+var dav=(drh.AV=navigator.appVersion);
+var t=true;
+var f=false;
+drh.capable=t;
+drh.support.builtin=t;
+dr.ver=parseFloat(drh.AV);
+dr.os.mac=dav.indexOf(&quot;Macintosh&quot;)&gt;=0;
+dr.os.win=dav.indexOf(&quot;Windows&quot;)&gt;=0;
+dr.os.linux=dav.indexOf(&quot;X11&quot;)&gt;=0;
+drh.opera=dua.indexOf(&quot;Opera&quot;)&gt;=0;
+drh.khtml=(dav.indexOf(&quot;Konqueror&quot;)&gt;=0)||(dav.indexOf(&quot;Safari&quot;)&gt;=0);
+drh.safari=dav.indexOf(&quot;Safari&quot;)&gt;=0;
+var _b3=dua.indexOf(&quot;Gecko&quot;);
+drh.mozilla=drh.moz=(_b3&gt;=0)&amp;&amp;(!drh.khtml);
+if(drh.mozilla){
+drh.geckoVersion=dua.substring(_b3+6,_b3+14);
+}
+drh.ie=(document.all)&amp;&amp;(!drh.opera);
+drh.ie50=drh.ie&amp;&amp;dav.indexOf(&quot;MSIE 5.0&quot;)&gt;=0;
+drh.ie55=drh.ie&amp;&amp;dav.indexOf(&quot;MSIE 5.5&quot;)&gt;=0;
+drh.ie60=drh.ie&amp;&amp;dav.indexOf(&quot;MSIE 6.0&quot;)&gt;=0;
+drh.ie70=drh.ie&amp;&amp;dav.indexOf(&quot;MSIE 7.0&quot;)&gt;=0;
+var cm=document[&quot;compatMode&quot;];
+drh.quirks=(cm==&quot;BackCompat&quot;)||(cm==&quot;QuirksMode&quot;)||drh.ie55||drh.ie50;
+dojo.locale=dojo.locale||(drh.ie?navigator.userLanguage:navigator.language).toLowerCase();
+dr.vml.capable=drh.ie;
+drs.capable=f;
+drs.support.plugin=f;
+drs.support.builtin=f;
+var _b5=window[&quot;document&quot;];
+var tdi=_b5[&quot;implementation&quot;];
+if((tdi)&amp;&amp;(tdi[&quot;hasFeature&quot;])&amp;&amp;(tdi.hasFeature(&quot;org.w3c.dom.svg&quot;,&quot;1.0&quot;))){
+drs.capable=t;
+drs.support.builtin=t;
+drs.support.plugin=f;
+}
+if(drh.safari){
+var tmp=dua.split(&quot;AppleWebKit/&quot;)[1];
+var ver=parseFloat(tmp.split(&quot; &quot;)[0]);
+if(ver&gt;=420){
+drs.capable=t;
+drs.support.builtin=t;
+drs.support.plugin=f;
+}
+}else{
+}
+})();
+dojo.hostenv.startPackage(&quot;dojo.hostenv&quot;);
+dojo.render.name=dojo.hostenv.name_=&quot;browser&quot;;
+dojo.hostenv.searchIds=[];
+dojo.hostenv._XMLHTTP_PROGIDS=[&quot;Msxml2.XMLHTTP&quot;,&quot;Microsoft.XMLHTTP&quot;,&quot;Msxml2.XMLHTTP.4.0&quot;];
+dojo.hostenv.getXmlhttpObject=function(){
+var _b9=null;
+var _ba=null;
+try{
+_b9=new XMLHttpRequest();
+}
+catch(e){
+}
+if(!_b9){
+for(var i=0;i&lt;3;++i){
+var _bc=dojo.hostenv._XMLHTTP_PROGIDS[i];
+try{
+_b9=new ActiveXObject(_bc);
+}
+catch(e){
+_ba=e;
+}
+if(_b9){
+dojo.hostenv._XMLHTTP_PROGIDS=[_bc];
+break;
+}
+}
+}
+if(!_b9){
+return dojo.raise(&quot;XMLHTTP not available&quot;,_ba);
+}
+return _b9;
+};
+dojo.hostenv._blockAsync=false;
+dojo.hostenv.getText=function(uri,_be,_bf){
+if(!_be){
+this._blockAsync=true;
+}
+var _c0=this.getXmlhttpObject();
+function isDocumentOk(_c1){
+var _c2=_c1[&quot;status&quot;];
+return Boolean((!_c2)||((200&lt;=_c2)&amp;&amp;(300&gt;_c2))||(_c2==304));
+}
+if(_be){
+var _c3=this,_c4=null,gbl=dojo.global();
+var xhr=dojo.evalObjPath(&quot;dojo.io.XMLHTTPTransport&quot;);
+_c0.onreadystatechange=function(){
+if(_c4){
+gbl.clearTimeout(_c4);
+_c4=null;
+}
+if(_c3._blockAsync||(xhr&amp;&amp;xhr._blockAsync)){
+_c4=gbl.setTimeout(function(){
+_c0.onreadystatechange.apply(this);
+},10);
+}else{
+if(4==_c0.readyState){
+if(isDocumentOk(_c0)){
+_be(_c0.responseText);
+}
+}
+}
+};
+}
+_c0.open(&quot;GET&quot;,uri,_be?true:false);
+try{
+_c0.send(null);
+if(_be){
+return null;
+}
+if(!isDocumentOk(_c0)){
+var err=Error(&quot;Unable to load &quot;+uri+&quot; status:&quot;+_c0.status);
+err.status=_c0.status;
+err.responseText=_c0.responseText;
+throw err;
+}
+}
+catch(e){
+this._blockAsync=false;
+if((_bf)&amp;&amp;(!_be)){
+return null;
+}else{
+throw e;
+}
+}
+this._blockAsync=false;
+return _c0.responseText;
+};
+dojo.hostenv.defaultDebugContainerId=&quot;dojoDebug&quot;;
+dojo.hostenv._println_buffer=[];
+dojo.hostenv._println_safe=false;
+dojo.hostenv.println=function(_c8){
+if(!dojo.hostenv._println_safe){
+dojo.hostenv._println_buffer.push(_c8);
+}else{
+try{
+var _c9=document.getElementById(djConfig.debugContainerId?djConfig.debugContainerId:dojo.hostenv.defaultDebugContainerId);
+if(!_c9){
+_c9=dojo.body();
+}
+var div=document.createElement(&quot;div&quot;);
+div.appendChild(document.createTextNode(_c8));
+_c9.appendChild(div);
+}
+catch(e){
+try{
+document.write(&quot;&lt;div&gt;&quot;+_c8+&quot;&lt;/div&gt;&quot;);
+}
+catch(e2){
+window.status=_c8;
+}
+}
+}
+};
+dojo.addOnLoad(function(){
+dojo.hostenv._println_safe=true;
+while(dojo.hostenv._println_buffer.length&gt;0){
+dojo.hostenv.println(dojo.hostenv._println_buffer.shift());
+}
+});
+function dj_addNodeEvtHdlr(_cb,_cc,fp){
+var _ce=_cb[&quot;on&quot;+_cc]||function(){
+};
+_cb[&quot;on&quot;+_cc]=function(){
+fp.apply(_cb,arguments);
+_ce.apply(_cb,arguments);
+};
+return true;
+}
+dojo.hostenv._djInitFired=false;
+function dj_load_init(e){
+dojo.hostenv._djInitFired=true;
+var _d0=(e&amp;&amp;e.type)?e.type.toLowerCase():&quot;load&quot;;
+if(arguments.callee.initialized||(_d0!=&quot;domcontentloaded&quot;&amp;&amp;_d0!=&quot;load&quot;)){
+return;
+}
+arguments.callee.initialized=true;
+if(typeof (_timer)!=&quot;undefined&quot;){
+clearInterval(_timer);
+delete _timer;
+}
+var _d1=function(){
+if(dojo.render.html.ie){
+dojo.hostenv.makeWidgets();
+}
+};
+if(dojo.hostenv.inFlightCount==0){
+_d1();
+dojo.hostenv.modulesLoaded();
+}else{
+dojo.hostenv.modulesLoadedListeners.unshift(_d1);
+}
+}
+if(document.addEventListener){
+if(dojo.render.html.opera||(dojo.render.html.moz&amp;&amp;(djConfig[&quot;enableMozDomContentLoaded&quot;]===true))){
+document.addEventListener(&quot;DOMContentLoaded&quot;,dj_load_init,null);
+}
+window.addEventListener(&quot;load&quot;,dj_load_init,null);
+}
+if(dojo.render.html.ie&amp;&amp;dojo.render.os.win){
+document.attachEvent(&quot;onreadystatechange&quot;,function(e){
+if(document.readyState==&quot;complete&quot;){
+dj_load_init();
+}
+});
+}
+if(/(WebKit|khtml)/i.test(navigator.userAgent)){
+var _timer=setInterval(function(){
+if(/loaded|complete/.test(document.readyState)){
+dj_load_init();
+}
+},10);
+}
+if(dojo.render.html.ie){
+dj_addNodeEvtHdlr(window,&quot;beforeunload&quot;,function(){
+dojo.hostenv._unloading=true;
+window.setTimeout(function(){
+dojo.hostenv._unloading=false;
+},0);
+});
+}
+dj_addNodeEvtHdlr(window,&quot;unload&quot;,function(){
+dojo.hostenv.unloaded();
+if((!dojo.render.html.ie)||(dojo.render.html.ie&amp;&amp;dojo.hostenv._unloading)){
+dojo.hostenv.unloaded();
+}
+});
+dojo.hostenv.makeWidgets=function(){
+var _d3=[];
+if(djConfig.searchIds&amp;&amp;djConfig.searchIds.length&gt;0){
+_d3=_d3.concat(djConfig.searchIds);
+}
+if(dojo.hostenv.searchIds&amp;&amp;dojo.hostenv.searchIds.length&gt;0){
+_d3=_d3.concat(dojo.hostenv.searchIds);
+}
+if((djConfig.parseWidgets)||(_d3.length&gt;0)){
+if(dojo.evalObjPath(&quot;dojo.widget.Parse&quot;)){
+var _d4=new dojo.xml.Parse();
+if(_d3.length&gt;0){
+for(var x=0;x&lt;_d3.length;x++){
+var _d6=document.getElementById(_d3[x]);
+if(!_d6){
+continue;
+}
+var _d7=_d4.parseElement(_d6,null,true);
+dojo.widget.getParser().createComponents(_d7);
+}
+}else{
+if(djConfig.parseWidgets){
+var _d7=_d4.parseElement(dojo.body(),null,true);
+dojo.widget.getParser().createComponents(_d7);
+}
+}
+}
+}
+};
+dojo.addOnLoad(function(){
+if(!dojo.render.html.ie){
+dojo.hostenv.makeWidgets();
+}
+});
+try{
+if(dojo.render.html.ie){
+document.namespaces.add(&quot;v&quot;,&quot;urn:schemas-microsoft-com:vml&quot;);
+document.createStyleSheet().addRule(&quot;v\\:*&quot;,&quot;behavior:url(#default#VML)&quot;);
+}
+}
+catch(e){
+}
+dojo.hostenv.writeIncludes=function(){
+};
+if(!dj_undef(&quot;document&quot;,this)){
+dj_currentDocument=this.document;
+}
+dojo.doc=function(){
+return dj_currentDocument;
+};
+dojo.body=function(){
+return dojo.doc().body||dojo.doc().getElementsByTagName(&quot;body&quot;)[0];
+};
+dojo.byId=function(id,doc){
+if((id)&amp;&amp;((typeof id==&quot;string&quot;)||(id instanceof String))){
+if(!doc){
+doc=dj_currentDocument;
+}
+var ele=doc.getElementById(id);
+if(ele&amp;&amp;(ele.id!=id)&amp;&amp;doc.all){
+ele=null;
+eles=doc.all[id];
+if(eles){
+if(eles.length){
+for(var i=0;i&lt;eles.length;i++){
+if(eles[i].id==id){
+ele=eles[i];
+break;
+}
+}
+}else{
+ele=eles;
+}
+}
+}
+return ele;
+}
+return id;
+};
+dojo.setContext=function(_dc,_dd){
+dj_currentContext=_dc;
+dj_currentDocument=_dd;
+};
+dojo._fireCallback=function(_de,_df,_e0){
+if((_df)&amp;&amp;((typeof _de==&quot;string&quot;)||(_de instanceof String))){
+_de=_df[_de];
+}
+return (_df?_de.apply(_df,_e0||[]):_de());
+};
+dojo.withGlobal=function(_e1,_e2,_e3,_e4){
+var _e5;
+var _e6=dj_currentContext;
+var _e7=dj_currentDocument;
+try{
+dojo.setContext(_e1,_e1.document);
+_e5=dojo._fireCallback(_e2,_e3,_e4);
+}
+finally{
+dojo.setContext(_e6,_e7);
+}
+return _e5;
+};
+dojo.withDoc=function(_e8,_e9,_ea,_eb){
+var _ec;
+var _ed=dj_currentDocument;
+try{
+dj_currentDocument=_e8;
+_ec=dojo._fireCallback(_e9,_ea,_eb);
+}
+finally{
+dj_currentDocument=_ed;
+}
+return _ec;
+};
+}
+dojo.requireIf((djConfig[&quot;isDebug&quot;]||djConfig[&quot;debugAtAllCosts&quot;]),&quot;dojo.debug&quot;);
+dojo.requireIf(djConfig[&quot;debugAtAllCosts&quot;]&amp;&amp;!window.widget&amp;&amp;!djConfig[&quot;useXDomain&quot;],&quot;dojo.browser_debug&quot;);
+dojo.requireIf(djConfig[&quot;debugAtAllCosts&quot;]&amp;&amp;!window.widget&amp;&amp;djConfig[&quot;useXDomain&quot;],&quot;dojo.browser_debug_xd&quot;);
+dojo.provide(&quot;dojo.string.common&quot;);
+dojo.string.trim=function(str,wh){
+if(!str.replace){
+return str;
+}
+if(!str.length){
+return str;
+}
+var re=(wh&gt;0)?(/^\s+/):(wh&lt;0)?(/\s+$/):(/^\s+|\s+$/g);
+return str.replace(re,&quot;&quot;);
+};
+dojo.string.trimStart=function(str){
+return dojo.string.trim(str,1);
+};
+dojo.string.trimEnd=function(str){
+return dojo.string.trim(str,-1);
+};
+dojo.string.repeat=function(str,_f4,_f5){
+var out=&quot;&quot;;
+for(var i=0;i&lt;_f4;i++){
+out+=str;
+if(_f5&amp;&amp;i&lt;_f4-1){
+out+=_f5;
+}
+}
+return out;
+};
+dojo.string.pad=function(str,len,c,dir){
+var out=String(str);
+if(!c){
+c=&quot;0&quot;;
+}
+if(!dir){
+dir=1;
+}
+while(out.length&lt;len){
+if(dir&gt;0){
+out=c+out;
+}else{
+out+=c;
+}
+}
+return out;
+};
+dojo.string.padLeft=function(str,len,c){
+return dojo.string.pad(str,len,c,1);
+};
+dojo.string.padRight=function(str,len,c){
+return dojo.string.pad(str,len,c,-1);
+};
+dojo.provide(&quot;dojo.string&quot;);
+dojo.provide(&quot;dojo.lang.common&quot;);
+dojo.lang.inherits=function(_103,_104){
+if(!dojo.lang.isFunction(_104)){
+dojo.raise(&quot;dojo.inherits: superclass argument [&quot;+_104+&quot;] must be a function (subclass: [&quot;+_103+&quot;']&quot;);
+}
+_103.prototype=new _104();
+_103.prototype.constructor=_103;
+_103.superclass=_104.prototype;
+_103[&quot;super&quot;]=_104.prototype;
+};
+dojo.lang._mixin=function(obj,_106){
+var tobj={};
+for(var x in _106){
+if((typeof tobj[x]==&quot;undefined&quot;)||(tobj[x]!=_106[x])){
+obj[x]=_106[x];
+}
+}
+if(dojo.render.html.ie&amp;&amp;(typeof (_106[&quot;toString&quot;])==&quot;function&quot;)&amp;&amp;(_106[&quot;toString&quot;]!=obj[&quot;toString&quot;])&amp;&amp;(_106[&quot;toString&quot;]!=tobj[&quot;toString&quot;])){
+obj.toString=_106.toString;
+}
+return obj;
+};
+dojo.lang.mixin=function(obj,_10a){
+for(var i=1,l=arguments.length;i&lt;l;i++){
+dojo.lang._mixin(obj,arguments[i]);
+}
+return obj;
+};
+dojo.lang.extend=function(_10d,_10e){
+for(var i=1,l=arguments.length;i&lt;l;i++){
+dojo.lang._mixin(_10d.prototype,arguments[i]);
+}
+return _10d;
+};
+dojo.inherits=dojo.lang.inherits;
+dojo.mixin=dojo.lang.mixin;
+dojo.extend=dojo.lang.extend;
+dojo.lang.find=function(_111,_112,_113,_114){
+if(!dojo.lang.isArrayLike(_111)&amp;&amp;dojo.lang.isArrayLike(_112)){
+dojo.deprecated(&quot;dojo.lang.find(value, array)&quot;,&quot;use dojo.lang.find(array, value) instead&quot;,&quot;0.5&quot;);
+var temp=_111;
+_111=_112;
+_112=temp;
+}
+var _116=dojo.lang.isString(_111);
+if(_116){
+_111=_111.split(&quot;&quot;);
+}
+if(_114){
+var step=-1;
+var i=_111.length-1;
+var end=-1;
+}else{
+var step=1;
+var i=0;
+var end=_111.length;
+}
+if(_113){
+while(i!=end){
+if(_111[i]===_112){
+return i;
+}
+i+=step;
+}
+}else{
+while(i!=end){
+if(_111[i]==_112){
+return i;
+}
+i+=step;
+}
+}
+return -1;
+};
+dojo.lang.indexOf=dojo.lang.find;
+dojo.lang.findLast=function(_11a,_11b,_11c){
+return dojo.lang.find(_11a,_11b,_11c,true);
+};
+dojo.lang.lastIndexOf=dojo.lang.findLast;
+dojo.lang.inArray=function(_11d,_11e){
+return dojo.lang.find(_11d,_11e)&gt;-1;
+};
+dojo.lang.isObject=function(it){
+if(typeof it==&quot;undefined&quot;){
+return false;
+}
+return (typeof it==&quot;object&quot;||it===null||dojo.lang.isArray(it)||dojo.lang.isFunction(it));
+};
+dojo.lang.isArray=function(it){
+return (it&amp;&amp;it instanceof Array||typeof it==&quot;array&quot;);
+};
+dojo.lang.isArrayLike=function(it){
+if((!it)||(dojo.lang.isUndefined(it))){
+return false;
+}
+if(dojo.lang.isString(it)){
+return false;
+}
+if(dojo.lang.isFunction(it)){
+return false;
+}
+if(dojo.lang.isArray(it)){
+return true;
+}
+if((it.tagName)&amp;&amp;(it.tagName.toLowerCase()==&quot;form&quot;)){
+return false;
+}
+if(dojo.lang.isNumber(it.length)&amp;&amp;isFinite(it.length)){
+return true;
+}
+return false;
+};
+dojo.lang.isFunction=function(it){
+return (it instanceof Function||typeof it==&quot;function&quot;);
+};
+(function(){
+if((dojo.render.html.capable)&amp;&amp;(dojo.render.html[&quot;safari&quot;])){
+dojo.lang.isFunction=function(it){
+if((typeof (it)==&quot;function&quot;)&amp;&amp;(it==&quot;[object NodeList]&quot;)){
+return false;
+}
+return (it instanceof Function||typeof it==&quot;function&quot;);
+};
+}
+})();
+dojo.lang.isString=function(it){
+return (typeof it==&quot;string&quot;||it instanceof String);
+};
+dojo.lang.isAlien=function(it){
+if(!it){
+return false;
+}
+return !dojo.lang.isFunction(it)&amp;&amp;/\{\s*\[native code\]\s*\}/.test(String(it));
+};
+dojo.lang.isBoolean=function(it){
+return (it instanceof Boolean||typeof it==&quot;boolean&quot;);
+};
+dojo.lang.isNumber=function(it){
+return (it instanceof Number||typeof it==&quot;number&quot;);
+};
+dojo.lang.isUndefined=function(it){
+return ((typeof (it)==&quot;undefined&quot;)&amp;&amp;(it==undefined));
+};
+dojo.provide(&quot;dojo.lang.extras&quot;);
+dojo.lang.setTimeout=function(func,_12a){
+var _12b=window,_12c=2;
+if(!dojo.lang.isFunction(func)){
+_12b=func;
+func=_12a;
+_12a=arguments[2];
+_12c++;
+}
+if(dojo.lang.isString(func)){
+func=_12b[func];
+}
+var args=[];
+for(var i=_12c;i&lt;arguments.length;i++){
+args.push(arguments[i]);
+}
+return dojo.global().setTimeout(function(){
+func.apply(_12b,args);
+},_12a);
+};
+dojo.lang.clearTimeout=function(_12f){
+dojo.global().clearTimeout(_12f);
+};
+dojo.lang.getNameInObj=function(ns,item){
+if(!ns){
+ns=dj_global;
+}
+for(var x in ns){
+if(ns[x]===item){
+return new String(x);
+}
+}
+return null;
+};
+dojo.lang.shallowCopy=function(obj,deep){
+var i,ret;
+if(obj===null){
+return null;
+}
+if(dojo.lang.isObject(obj)){
+ret=new obj.constructor();
+for(i in obj){
+if(dojo.lang.isUndefined(ret[i])){
+ret[i]=deep?dojo.lang.shallowCopy(obj[i],deep):obj[i];
+}
+}
+}else{
+if(dojo.lang.isArray(obj)){
+ret=[];
+for(i=0;i&lt;obj.length;i++){
+ret[i]=deep?dojo.lang.shallowCopy(obj[i],deep):obj[i];
+}
+}else{
+ret=obj;
+}
+}
+return ret;
+};
+dojo.lang.firstValued=function(){
+for(var i=0;i&lt;arguments.length;i++){
+if(typeof arguments[i]!=&quot;undefined&quot;){
+return arguments[i];
+}
+}
+return undefined;
+};
+dojo.lang.getObjPathValue=function(_138,_139,_13a){
+with(dojo.parseObjPath(_138,_139,_13a)){
+return dojo.evalProp(prop,obj,_13a);
+}
+};
+dojo.lang.setObjPathValue=function(_13b,_13c,_13d,_13e){
+dojo.deprecated(&quot;dojo.lang.setObjPathValue&quot;,&quot;use dojo.parseObjPath and the '=' operator&quot;,&quot;0.6&quot;);
+if(arguments.length&lt;4){
+_13e=true;
+}
+with(dojo.parseObjPath(_13b,_13d,_13e)){
+if(obj&amp;&amp;(_13e||(prop in obj))){
+obj[prop]=_13c;
+}
+}
+};
+dojo.provide(&quot;dojo.io.common&quot;);
+dojo.io.transports=[];
+dojo.io.hdlrFuncNames=[&quot;load&quot;,&quot;error&quot;,&quot;timeout&quot;];
+dojo.io.Request=function(url,_140,_141,_142){
+if((arguments.length==1)&amp;&amp;(arguments[0].constructor==Object)){
+this.fromKwArgs(arguments[0]);
+}else{
+this.url=url;
+if(_140){
+this.mimetype=_140;
+}
+if(_141){
+this.transport=_141;
+}
+if(arguments.length&gt;=4){
+this.changeUrl=_142;
+}
+}
+};
+dojo.lang.extend(dojo.io.Request,{url:&quot;&quot;,mimetype:&quot;text/plain&quot;,method:&quot;GET&quot;,content:undefined,transport:undefined,changeUrl:undefined,formNode:undefined,sync:false,bindSuccess:false,useCache:false,preventCache:false,jsonFilter:function(_143){
+if((this.mimetype==&quot;text/json-comment-filtered&quot;)||(this.mimetype==&quot;application/json-comment-filtered&quot;)){
+var _144=_143.indexOf(&quot;/*&quot;);
+var _145=_143.lastIndexOf(&quot;*/&quot;);
+if((_144==-1)||(_145==-1)){
+dojo.debug(&quot;your JSON wasn't comment filtered!&quot;);
+return &quot;&quot;;
+}
+return _143.substring(_144+2,_145);
+}
+dojo.debug(&quot;please consider using a mimetype of text/json-comment-filtered to avoid potential security issues with JSON endpoints&quot;);
+return _143;
+},load:function(type,data,_148,_149){
+},error:function(type,_14b,_14c,_14d){
+},timeout:function(type,_14f,_150,_151){
+},handle:function(type,data,_154,_155){
+},timeoutSeconds:0,abort:function(){
+},fromKwArgs:function(_156){
+if(_156[&quot;url&quot;]){
+_156.url=_156.url.toString();
+}
+if(_156[&quot;formNode&quot;]){
+_156.formNode=dojo.byId(_156.formNode);
+}
+if(!_156[&quot;method&quot;]&amp;&amp;_156[&quot;formNode&quot;]&amp;&amp;_156[&quot;formNode&quot;].method){
+_156.method=_156[&quot;formNode&quot;].method;
+}
+if(!_156[&quot;handle&quot;]&amp;&amp;_156[&quot;handler&quot;]){
+_156.handle=_156.handler;
+}
+if(!_156[&quot;load&quot;]&amp;&amp;_156[&quot;loaded&quot;]){
+_156.load=_156.loaded;
+}
+if(!_156[&quot;changeUrl&quot;]&amp;&amp;_156[&quot;changeURL&quot;]){
+_156.changeUrl=_156.changeURL;
+}
+_156.encoding=dojo.lang.firstValued(_156[&quot;encoding&quot;],djConfig[&quot;bindEncoding&quot;],&quot;&quot;);
+_156.sendTransport=dojo.lang.firstValued(_156[&quot;sendTransport&quot;],djConfig[&quot;ioSendTransport&quot;],false);
+var _157=dojo.lang.isFunction;
+for(var x=0;x&lt;dojo.io.hdlrFuncNames.length;x++){
+var fn=dojo.io.hdlrFuncNames[x];
+if(_156[fn]&amp;&amp;_157(_156[fn])){
+continue;
+}
+if(_156[&quot;handle&quot;]&amp;&amp;_157(_156[&quot;handle&quot;])){
+_156[fn]=_156.handle;
+}
+}
+dojo.lang.mixin(this,_156);
+}});
+dojo.io.Error=function(msg,type,num){
+this.message=msg;
+this.type=type||&quot;unknown&quot;;
+this.number=num||0;
+};
+dojo.io.transports.addTransport=function(name){
+this.push(name);
+this[name]=dojo.io[name];
+};
+dojo.io.bind=function(_15e){
+if(!(_15e instanceof dojo.io.Request)){
+try{
+_15e=new dojo.io.Request(_15e);
+}
+catch(e){
+dojo.debug(e);
+}
+}
+var _15f=&quot;&quot;;
+if(_15e[&quot;transport&quot;]){
+_15f=_15e[&quot;transport&quot;];
+if(!this[_15f]){
+dojo.io.sendBindError(_15e,&quot;No dojo.io.bind() transport with name '&quot;+_15e[&quot;transport&quot;]+&quot;'.&quot;);
+return _15e;
+}
+if(!this[_15f].canHandle(_15e)){
+dojo.io.sendBindError(_15e,&quot;dojo.io.bind() transport with name '&quot;+_15e[&quot;transport&quot;]+&quot;' cannot handle this type of request.&quot;);
+return _15e;
+}
+}else{
+for(var x=0;x&lt;dojo.io.transports.length;x++){
+var tmp=dojo.io.transports[x];
+if((this[tmp])&amp;&amp;(this[tmp].canHandle(_15e))){
+_15f=tmp;
+break;
+}
+}
+if(_15f==&quot;&quot;){
+dojo.io.sendBindError(_15e,&quot;None of the loaded transports for dojo.io.bind()&quot;+&quot; can handle the request.&quot;);
+return _15e;
+}
+}
+this[_15f].bind(_15e);
+_15e.bindSuccess=true;
+return _15e;
+};
+dojo.io.sendBindError=function(_162,_163){
+if((typeof _162.error==&quot;function&quot;||typeof _162.handle==&quot;function&quot;)&amp;&amp;(typeof setTimeout==&quot;function&quot;||typeof setTimeout==&quot;object&quot;)){
+var _164=new dojo.io.Error(_163);
+setTimeout(function(){
+_162[(typeof _162.error==&quot;function&quot;)?&quot;error&quot;:&quot;handle&quot;](&quot;error&quot;,_164,null,_162);
+},50);
+}else{
+dojo.raise(_163);
+}
+};
+dojo.io.queueBind=function(_165){
+if(!(_165 instanceof dojo.io.Request)){
+try{
+_165=new dojo.io.Request(_165);
+}
+catch(e){
+dojo.debug(e);
+}
+}
+var _166=_165.load;
+_165.load=function(){
+dojo.io._queueBindInFlight=false;
+var ret=_166.apply(this,arguments);
+dojo.io._dispatchNextQueueBind();
+return ret;
+};
+var _168=_165.error;
+_165.error=function(){
+dojo.io._queueBindInFlight=false;
+var ret=_168.apply(this,arguments);
+dojo.io._dispatchNextQueueBind();
+return ret;
+};
+dojo.io._bindQueue.push(_165);
+dojo.io._dispatchNextQueueBind();
+return _165;
+};
+dojo.io._dispatchNextQueueBind=function(){
+if(!dojo.io._queueBindInFlight){
+dojo.io._queueBindInFlight=true;
+if(dojo.io._bindQueue.length&gt;0){
+dojo.io.bind(dojo.io._bindQueue.shift());
+}else{
+dojo.io._queueBindInFlight=false;
+}
+}
+};
+dojo.io._bindQueue=[];
+dojo.io._queueBindInFlight=false;
+dojo.io.argsFromMap=function(map,_16b,last){
+var enc=/utf/i.test(_16b||&quot;&quot;)?encodeURIComponent:dojo.string.encodeAscii;
+var _16e=[];
+var _16f=new Object();
+for(var name in map){
+var _171=function(elt){
+var val=enc(name)+&quot;=&quot;+enc(elt);
+_16e[(last==name)?&quot;push&quot;:&quot;unshift&quot;](val);
+};
+if(!_16f[name]){
+var _174=map[name];
+if(dojo.lang.isArray(_174)){
+dojo.lang.forEach(_174,_171);
+}else{
+_171(_174);
+}
+}
+}
+return _16e.join(&quot;&amp;&quot;);
+};
+dojo.io.setIFrameSrc=function(_175,src,_177){
+try{
+var r=dojo.render.html;
+if(!_177){
+if(r.safari){
+_175.location=src;
+}else{
+frames[_175.name].location=src;
+}
+}else{
+var idoc;
+if(r.ie){
+idoc=_175.contentWindow.document;
+}else{
+if(r.safari){
+idoc=_175.document;
+}else{
+idoc=_175.contentWindow;
+}
+}
+if(!idoc){
+_175.location=src;
+return;
+}else{
+idoc.location.replace(src);
+}
+}
+}
+catch(e){
+dojo.debug(e);
+dojo.debug(&quot;setIFrameSrc: &quot;+e);
+}
+};
+dojo.provide(&quot;dojo.lang.array&quot;);
+dojo.lang.mixin(dojo.lang,{has:function(obj,name){
+try{
+return typeof obj[name]!=&quot;undefined&quot;;
+}
+catch(e){
+return false;
+}
+},isEmpty:function(obj){
+if(dojo.lang.isObject(obj)){
+var tmp={};
+var _17e=0;
+for(var x in obj){
+if(obj[x]&amp;&amp;(!tmp[x])){
+_17e++;
+break;
+}
+}
+return _17e==0;
+}else{
+if(dojo.lang.isArrayLike(obj)||dojo.lang.isString(obj)){
+return obj.length==0;
+}
+}
+},map:function(arr,obj,_182){
+var _183=dojo.lang.isString(arr);
+if(_183){
+arr=arr.split(&quot;&quot;);
+}
+if(dojo.lang.isFunction(obj)&amp;&amp;(!_182)){
+_182=obj;
+obj=dj_global;
+}else{
+if(dojo.lang.isFunction(obj)&amp;&amp;_182){
+var _184=obj;
+obj=_182;
+_182=_184;
+}
+}
+if(Array.map){
+var _185=Array.map(arr,_182,obj);
+}else{
+var _185=[];
+for(var i=0;i&lt;arr.length;++i){
+_185.push(_182.call(obj,arr[i]));
+}
+}
+if(_183){
+return _185.join(&quot;&quot;);
+}else{
+return _185;
+}
+},reduce:function(arr,_188,obj,_18a){
+var _18b=_188;
+if(arguments.length==2){
+_18a=_188;
+_18b=arr[0];
+arr=arr.slice(1);
+}else{
+if(arguments.length==3){
+if(dojo.lang.isFunction(obj)){
+_18a=obj;
+obj=null;
+}
+}else{
+if(dojo.lang.isFunction(obj)){
+var tmp=_18a;
+_18a=obj;
+obj=tmp;
+}
+}
+}
+var ob=obj||dj_global;
+dojo.lang.map(arr,function(val){
+_18b=_18a.call(ob,_18b,val);
+});
+return _18b;
+},forEach:function(_18f,_190,_191){
+if(dojo.lang.isString(_18f)){
+_18f=_18f.split(&quot;&quot;);
+}
+if(Array.forEach){
+Array.forEach(_18f,_190,_191);
+}else{
+if(!_191){
+_191=dj_global;
+}
+for(var i=0,l=_18f.length;i&lt;l;i++){
+_190.call(_191,_18f[i],i,_18f);
+}
+}
+},_everyOrSome:function(_194,arr,_196,_197){
+if(dojo.lang.isString(arr)){
+arr=arr.split(&quot;&quot;);
+}
+if(Array.every){
+return Array[_194?&quot;every&quot;:&quot;some&quot;](arr,_196,_197);
+}else{
+if(!_197){
+_197=dj_global;
+}
+for(var i=0,l=arr.length;i&lt;l;i++){
+var _19a=_196.call(_197,arr[i],i,arr);
+if(_194&amp;&amp;!_19a){
+return false;
+}else{
+if((!_194)&amp;&amp;(_19a)){
+return true;
+}
+}
+}
+return Boolean(_194);
+}
+},every:function(arr,_19c,_19d){
+return this._everyOrSome(true,arr,_19c,_19d);
+},some:function(arr,_19f,_1a0){
+return this._everyOrSome(false,arr,_19f,_1a0);
+},filter:function(arr,_1a2,_1a3){
+var _1a4=dojo.lang.isString(arr);
+if(_1a4){
+arr=arr.split(&quot;&quot;);
+}
+var _1a5;
+if(Array.filter){
+_1a5=Array.filter(arr,_1a2,_1a3);
+}else{
+if(!_1a3){
+if(arguments.length&gt;=3){
+dojo.raise(&quot;thisObject doesn't exist!&quot;);
+}
+_1a3=dj_global;
+}
+_1a5=[];
+for(var i=0;i&lt;arr.length;i++){
+if(_1a2.call(_1a3,arr[i],i,arr)){
+_1a5.push(arr[i]);
+}
+}
+}
+if(_1a4){
+return _1a5.join(&quot;&quot;);
+}else{
+return _1a5;
+}
+},unnest:function(){
+var out=[];
+for(var i=0;i&lt;arguments.length;i++){
+if(dojo.lang.isArrayLike(arguments[i])){
+var add=dojo.lang.unnest.apply(this,arguments[i]);
+out=out.concat(add);
+}else{
+out.push(arguments[i]);
+}
+}
+return out;
+},toArray:function(_1aa,_1ab){
+var _1ac=[];
+for(var i=_1ab||0;i&lt;_1aa.length;i++){
+_1ac.push(_1aa[i]);
+}
+return _1ac;
+}});
+dojo.provide(&quot;dojo.lang.func&quot;);
+dojo.lang.hitch=function(_1ae,_1af){
+var args=[];
+for(var x=2;x&lt;arguments.length;x++){
+args.push(arguments[x]);
+}
+var fcn=(dojo.lang.isString(_1af)?_1ae[_1af]:_1af)||function(){
+};
+return function(){
+var ta=args.concat([]);
+for(var x=0;x&lt;arguments.length;x++){
+ta.push(arguments[x]);
+}
+return fcn.apply(_1ae,ta);
+};
+};
+dojo.lang.anonCtr=0;
+dojo.lang.anon={};
+dojo.lang.nameAnonFunc=function(_1b5,_1b6,_1b7){
+var nso=(_1b6||dojo.lang.anon);
+if((_1b7)||((dj_global[&quot;djConfig&quot;])&amp;&amp;(djConfig[&quot;slowAnonFuncLookups&quot;]==true))){
+for(var x in nso){
+try{
+if(nso[x]===_1b5){
+return x;
+}
+}
+catch(e){
+}
+}
+}
+var ret=&quot;__&quot;+dojo.lang.anonCtr++;
+while(typeof nso[ret]!=&quot;undefined&quot;){
+ret=&quot;__&quot;+dojo.lang.anonCtr++;
+}
+nso[ret]=_1b5;
+return ret;
+};
+dojo.lang.forward=function(_1bb){
+return function(){
+return this[_1bb].apply(this,arguments);
+};
+};
+dojo.lang.curry=function(_1bc,func){
+var _1be=[];
+_1bc=_1bc||dj_global;
+if(dojo.lang.isString(func)){
+func=_1bc[func];
+}
+for(var x=2;x&lt;arguments.length;x++){
+_1be.push(arguments[x]);
+}
+var _1c0=(func[&quot;__preJoinArity&quot;]||func.length)-_1be.length;
+function gather(_1c1,_1c2,_1c3){
+var _1c4=_1c3;
+var _1c5=_1c2.slice(0);
+for(var x=0;x&lt;_1c1.length;x++){
+_1c5.push(_1c1[x]);
+}
+_1c3=_1c3-_1c1.length;
+if(_1c3&lt;=0){
+var res=func.apply(_1bc,_1c5);
+_1c3=_1c4;
+return res;
+}else{
+return function(){
+return gather(arguments,_1c5,_1c3);
+};
+}
+}
+return gather([],_1be,_1c0);
+};
+dojo.lang.curryArguments=function(_1c8,func,args,_1cb){
+var _1cc=[];
+var x=_1cb||0;
+for(x=_1cb;x&lt;args.length;x++){
+_1cc.push(args[x]);
+}
+return dojo.lang.curry.apply(dojo.lang,[_1c8,func].concat(_1cc));
+};
+dojo.lang.tryThese=function(){
+for(var x=0;x&lt;arguments.length;x++){
+try{
+if(typeof arguments[x]==&quot;function&quot;){
+var ret=(arguments[x]());
+if(ret){
+return ret;
+}
+}
+}
+catch(e){
+dojo.debug(e);
+}
+}
+};
+dojo.lang.delayThese=function(farr,cb,_1d2,_1d3){
+if(!farr.length){
+if(typeof _1d3==&quot;function&quot;){
+_1d3();
+}
+return;
+}
+if((typeof _1d2==&quot;undefined&quot;)&amp;&amp;(typeof cb==&quot;number&quot;)){
+_1d2=cb;
+cb=function(){
+};
+}else{
+if(!cb){
+cb=function(){
+};
+if(!_1d2){
+_1d2=0;
+}
+}
+}
+setTimeout(function(){
+(farr.shift())();
+cb();
+dojo.lang.delayThese(farr,cb,_1d2,_1d3);
+},_1d2);
+};
+dojo.provide(&quot;dojo.string.extras&quot;);
+dojo.string.substituteParams=function(_1d4,hash){
+var map=(typeof hash==&quot;object&quot;)?hash:dojo.lang.toArray(arguments,1);
+return _1d4.replace(/\%\{(\w+)\}/g,function(_1d7,key){
+if(typeof (map[key])!=&quot;undefined&quot;&amp;&amp;map[key]!=null){
+return map[key];
+}
+dojo.raise(&quot;Substitution not found: &quot;+key);
+});
+};
+dojo.string.capitalize=function(str){
+if(!dojo.lang.isString(str)){
+return &quot;&quot;;
+}
+if(arguments.length==0){
+str=this;
+}
+var _1da=str.split(&quot; &quot;);
+for(var i=0;i&lt;_1da.length;i++){
+_1da[i]=_1da[i].charAt(0).toUpperCase()+_1da[i].substring(1);
+}
+return _1da.join(&quot; &quot;);
+};
+dojo.string.isBlank=function(str){
+if(!dojo.lang.isString(str)){
+return true;
+}
+return (dojo.string.trim(str).length==0);
+};
+dojo.string.encodeAscii=function(str){
+if(!dojo.lang.isString(str)){
+return str;
+}
+var ret=&quot;&quot;;
+var _1df=escape(str);
+var _1e0,re=/%u([0-9A-F]{4})/i;
+while((_1e0=_1df.match(re))){
+var num=Number(&quot;0x&quot;+_1e0[1]);
+var _1e3=escape(&quot;&amp;#&quot;+num+&quot;;&quot;);
+ret+=_1df.substring(0,_1e0.index)+_1e3;
+_1df=_1df.substring(_1e0.index+_1e0[0].length);
+}
+ret+=_1df.replace(/\+/g,&quot;%2B&quot;);
+return ret;
+};
+dojo.string.escape=function(type,str){
+var args=dojo.lang.toArray(arguments,1);
+switch(type.toLowerCase()){
+case &quot;xml&quot;:
+case &quot;html&quot;:
+case &quot;xhtml&quot;:
+return dojo.string.escapeXml.apply(this,args);
+case &quot;sql&quot;:
+return dojo.string.escapeSql.apply(this,args);
+case &quot;regexp&quot;:
+case &quot;regex&quot;:
+return dojo.string.escapeRegExp.apply(this,args);
+case &quot;javascript&quot;:
+case &quot;jscript&quot;:
+case &quot;js&quot;:
+return dojo.string.escapeJavaScript.apply(this,args);
+case &quot;ascii&quot;:
+return dojo.string.encodeAscii.apply(this,args);
+default:
+return str;
+}
+};
+dojo.string.escapeXml=function(str,_1e8){
+str=str.replace(/&amp;/gm,&quot;&amp;&quot;).replace(/&lt;/gm,&quot;&lt;&quot;).replace(/&gt;/gm,&quot;&gt;&quot;).replace(/&quot;/gm,&quot;&quot;&quot;);
+if(!_1e8){
+str=str.replace(/'/gm,&quot;&#39;&quot;);
+}
+return str;
+};
+dojo.string.escapeSql=function(str){
+return str.replace(/'/gm,&quot;''&quot;);
+};
+dojo.string.escapeRegExp=function(str){
+return str.replace(/\\/gm,&quot;\\\\&quot;).replace(/([\f\b\n\t\r[\^$|?*+(){}])/gm,&quot;\\$1&quot;);
+};
+dojo.string.escapeJavaScript=function(str){
+return str.replace(/([&quot;'\f\b\n\t\r])/gm,&quot;\\$1&quot;);
+};
+dojo.string.escapeString=function(str){
+return (&quot;\&quot;&quot;+str.replace(/([&quot;\\])/g,&quot;\\$1&quot;)+&quot;\&quot;&quot;).replace(/[\f]/g,&quot;\\f&quot;).replace(/[\b]/g,&quot;\\b&quot;).replace(/[\n]/g,&quot;\\n&quot;).replace(/[\t]/g,&quot;\\t&quot;).replace(/[\r]/g,&quot;\\r&quot;);
+};
+dojo.string.summary=function(str,len){
+if(!len||str.length&lt;=len){
+return str;
+}
+return str.substring(0,len).replace(/\.+$/,&quot;&quot;)+&quot;...&quot;;
+};
+dojo.string.endsWith=function(str,end,_1f1){
+if(_1f1){
+str=str.toLowerCase();
+end=end.toLowerCase();
+}
+if((str.length-end.length)&lt;0){
+return false;
+}
+return str.lastIndexOf(end)==str.length-end.length;
+};
+dojo.string.endsWithAny=function(str){
+for(var i=1;i&lt;arguments.length;i++){
+if(dojo.string.endsWith(str,arguments[i])){
+return true;
+}
+}
+return false;
+};
+dojo.string.startsWith=function(str,_1f5,_1f6){
+if(_1f6){
+str=str.toLowerCase();
+_1f5=_1f5.toLowerCase();
+}
+return str.indexOf(_1f5)==0;
+};
+dojo.string.startsWithAny=function(str){
+for(var i=1;i&lt;arguments.length;i++){
+if(dojo.string.startsWith(str,arguments[i])){
+return true;
+}
+}
+return false;
+};
+dojo.string.has=function(str){
+for(var i=1;i&lt;arguments.length;i++){
+if(str.indexOf(arguments[i])&gt;-1){
+return true;
+}
+}
+return false;
+};
+dojo.string.normalizeNewlines=function(text,_1fc){
+if(_1fc==&quot;\n&quot;){
+text=text.replace(/\r\n/g,&quot;\n&quot;);
+text=text.replace(/\r/g,&quot;\n&quot;);
+}else{
+if(_1fc==&quot;\r&quot;){
+text=text.replace(/\r\n/g,&quot;\r&quot;);
+text=text.replace(/\n/g,&quot;\r&quot;);
+}else{
+text=text.replace(/([^\r])\n/g,&quot;$1\r\n&quot;).replace(/\r([^\n])/g,&quot;\r\n$1&quot;);
+}
+}
+return text;
+};
+dojo.string.splitEscaped=function(str,_1fe){
+var _1ff=[];
+for(var i=0,_201=0;i&lt;str.length;i++){
+if(str.charAt(i)==&quot;\\&quot;){
+i++;
+continue;
+}
+if(str.charAt(i)==_1fe){
+_1ff.push(str.substring(_201,i));
+_201=i+1;
+}
+}
+_1ff.push(str.substr(_201));
+return _1ff;
+};
+dojo.provide(&quot;dojo.dom&quot;);
+dojo.dom.ELEMENT_NODE=1;
+dojo.dom.ATTRIBUTE_NODE=2;
+dojo.dom.TEXT_NODE=3;
+dojo.dom.CDATA_SECTION_NODE=4;
+dojo.dom.ENTITY_REFERENCE_NODE=5;
+dojo.dom.ENTITY_NODE=6;
+dojo.dom.PROCESSING_INSTRUCTION_NODE=7;
+dojo.dom.COMMENT_NODE=8;
+dojo.dom.DOCUMENT_NODE=9;
+dojo.dom.DOCUMENT_TYPE_NODE=10;
+dojo.dom.DOCUMENT_FRAGMENT_NODE=11;
+dojo.dom.NOTATION_NODE=12;
+dojo.dom.dojoml=&quot;<A HREF="http://www.dojotoolkit.org/2004/dojoml">http://www.dojotoolkit.org/2004/dojoml</A>&quot;;
+dojo.dom.xmlns={svg:&quot;<A HREF="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</A>&quot;,smil:&quot;<A HREF="http://www.w3.org/2001/SMIL20/">http://www.w3.org/2001/SMIL20/</A>&quot;,mml:&quot;<A HREF="http://www.w3.org/1998/Math/MathML">http://www.w3.org/1998/Math/MathML</A>&quot;,cml:&quot;<A HREF="http://www.xml-cml.org">http://www.xml-cml.org</A>&quot;,xlink:&quot;<A HREF="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</A>&quot;,xhtml:&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;,xul:&quot;<A HREF="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul</A>&quot;,xbl:&quot;<A HREF="http://www.mozilla.org/xbl">http://www.mozilla.org/xbl</A>&quot;,fo:&quot;<A HREF="http://www.w3.org/1999/XSL/Format">http://www.w3.org/1999/XSL/Format</A>&quot;,xsl:&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot;,xslt:&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot;,xi:&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot;,xforms:&quot;<A HREF="http://www.w3.org/2002/01/xforms">http://www.w3.org/2002/01/xforms</A>&quot;,saxon:&quot;<A HREF="http://icl.com/saxon">http://icl.com/saxon</A>&quot;,xalan:&quot;<A HREF="http://xml.apache.org/xslt">http://xml.apache.org/xslt</A>&quot;,xsd:&quot;<A HREF="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</A>&quot;,dt:&quot;<A HREF="http://www.w3.org/2001/XMLSchema-datatypes">http://www.w3.org/2001/XMLSchema-datatypes</A>&quot;,xsi:&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;,rdf:&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;,rdfs:&quot;<A HREF="http://www.w3.org/2000/01/rdf-schema#">http://www.w3.org/2000/01/rdf-schema#</A>&quot;,dc:&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;,dcq:&quot;<A HREF="http://purl.org/dc/qualifiers/1.0">http://purl.org/dc/qualifiers/1.0</A>&quot;,&quot;soap-env&quot;:&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</A>&quot;,wsdl:&quot;<A HREF="http://schemas.xml!">http://schemas.xml!</A>
 soap.org/wsdl/&quot;,AdobeExtensions:&quot;<A HREF="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/">http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/</A>&quot;};
+dojo.dom.isNode=function(wh){
+if(typeof Element==&quot;function&quot;){
+try{
+return wh instanceof Element;
+}
+catch(e){
+}
+}else{
+return wh&amp;&amp;!isNaN(wh.nodeType);
+}
+};
+dojo.dom.getUniqueId=function(){
+var _203=dojo.doc();
+do{
+var id=&quot;dj_unique_&quot;+(++arguments.callee._idIncrement);
+}while(_203.getElementById(id));
+return id;
+};
+dojo.dom.getUniqueId._idIncrement=0;
+dojo.dom.firstElement=dojo.dom.getFirstChildElement=function(_205,_206){
+var node=_205.firstChild;
+while(node&amp;&amp;node.nodeType!=dojo.dom.ELEMENT_NODE){
+node=node.nextSibling;
+}
+if(_206&amp;&amp;node&amp;&amp;node.tagName&amp;&amp;node.tagName.toLowerCase()!=_206.toLowerCase()){
+node=dojo.dom.nextElement(node,_206);
+}
+return node;
+};
+dojo.dom.lastElement=dojo.dom.getLastChildElement=function(_208,_209){
+var node=_208.lastChild;
+while(node&amp;&amp;node.nodeType!=dojo.dom.ELEMENT_NODE){
+node=node.previousSibling;
+}
+if(_209&amp;&amp;node&amp;&amp;node.tagName&amp;&amp;node.tagName.toLowerCase()!=_209.toLowerCase()){
+node=dojo.dom.prevElement(node,_209);
+}
+return node;
+};
+dojo.dom.nextElement=dojo.dom.getNextSiblingElement=function(node,_20c){
+if(!node){
+return null;
+}
+do{
+node=node.nextSibling;
+}while(node&amp;&amp;node.nodeType!=dojo.dom.ELEMENT_NODE);
+if(node&amp;&amp;_20c&amp;&amp;_20c.toLowerCase()!=node.tagName.toLowerCase()){
+return dojo.dom.nextElement(node,_20c);
+}
+return node;
+};
+dojo.dom.prevElement=dojo.dom.getPreviousSiblingElement=function(node,_20e){
+if(!node){
+return null;
+}
+if(_20e){
+_20e=_20e.toLowerCase();
+}
+do{
+node=node.previousSibling;
+}while(node&amp;&amp;node.nodeType!=dojo.dom.ELEMENT_NODE);
+if(node&amp;&amp;_20e&amp;&amp;_20e.toLowerCase()!=node.tagName.toLowerCase()){
+return dojo.dom.prevElement(node,_20e);
+}
+return node;
+};
+dojo.dom.moveChildren=function(_20f,_210,trim){
+var _212=0;
+if(trim){
+while(_20f.hasChildNodes()&amp;&amp;_20f.firstChild.nodeType==dojo.dom.TEXT_NODE){
+_20f.removeChild(_20f.firstChild);
+}
+while(_20f.hasChildNodes()&amp;&amp;_20f.lastChild.nodeType==dojo.dom.TEXT_NODE){
+_20f.removeChild(_20f.lastChild);
+}
+}
+while(_20f.hasChildNodes()){
+_210.appendChild(_20f.firstChild);
+_212++;
+}
+return _212;
+};
+dojo.dom.copyChildren=function(_213,_214,trim){
+var _216=_213.cloneNode(true);
+return this.moveChildren(_216,_214,trim);
+};
+dojo.dom.replaceChildren=function(node,_218){
+var _219=[];
+if(dojo.render.html.ie){
+for(var i=0;i&lt;node.childNodes.length;i++){
+_219.push(node.childNodes[i]);
+}
+}
+dojo.dom.removeChildren(node);
+node.appendChild(_218);
+for(var i=0;i&lt;_219.length;i++){
+dojo.dom.destroyNode(_219[i]);
+}
+};
+dojo.dom.removeChildren=function(node){
+var _21c=node.childNodes.length;
+while(node.hasChildNodes()){
+dojo.dom.removeNode(node.firstChild);
+}
+return _21c;
+};
+dojo.dom.replaceNode=function(node,_21e){
+return node.parentNode.replaceChild(_21e,node);
+};
+dojo.dom.destroyNode=function(node){
+if(node.parentNode){
+node=dojo.dom.removeNode(node);
+}
+if(node.nodeType!=3){
+if(dojo.evalObjPath(&quot;dojo.event.browser.clean&quot;,false)){
+dojo.event.browser.clean(node);
+}
+if(dojo.render.html.ie){
+node.outerHTML=&quot;&quot;;
+}
+}
+};
+dojo.dom.removeNode=function(node){
+if(node&amp;&amp;node.parentNode){
+return node.parentNode.removeChild(node);
+}
+};
+dojo.dom.getAncestors=function(node,_222,_223){
+var _224=[];
+var _225=(_222&amp;&amp;(_222 instanceof Function||typeof _222==&quot;function&quot;));
+while(node){
+if(!_225||_222(node)){
+_224.push(node);
+}
+if(_223&amp;&amp;_224.length&gt;0){
+return _224[0];
+}
+node=node.parentNode;
+}
+if(_223){
+return null;
+}
+return _224;
+};
+dojo.dom.getAncestorsByTag=function(node,tag,_228){
+tag=tag.toLowerCase();
+return dojo.dom.getAncestors(node,function(el){
+return ((el.tagName)&amp;&amp;(el.tagName.toLowerCase()==tag));
+},_228);
+};
+dojo.dom.getFirstAncestorByTag=function(node,tag){
+return dojo.dom.getAncestorsByTag(node,tag,true);
+};
+dojo.dom.isDescendantOf=function(node,_22d,_22e){
+if(_22e&amp;&amp;node){
+node=node.parentNode;
+}
+while(node){
+if(node==_22d){
+return true;
+}
+node=node.parentNode;
+}
+return false;
+};
+dojo.dom.innerXML=function(node){
+if(node.innerXML){
+return node.innerXML;
+}else{
+if(node.xml){
+return node.xml;
+}else{
+if(typeof XMLSerializer!=&quot;undefined&quot;){
+return (new XMLSerializer()).serializeToString(node);
+}
+}
+}
+};
+dojo.dom.createDocument=function(){
+var doc=null;
+var _231=dojo.doc();
+if(!dj_undef(&quot;ActiveXObject&quot;)){
+var _232=[&quot;MSXML2&quot;,&quot;Microsoft&quot;,&quot;MSXML&quot;,&quot;MSXML3&quot;];
+for(var i=0;i&lt;_232.length;i++){
+try{
+doc=new ActiveXObject(_232[i]+&quot;.XMLDOM&quot;);
+}
+catch(e){
+}
+if(doc){
+break;
+}
+}
+}else{
+if((_231.implementation)&amp;&amp;(_231.implementation.createDocument)){
+doc=_231.implementation.createDocument(&quot;&quot;,&quot;&quot;,null);
+}
+}
+return doc;
+};
+dojo.dom.createDocumentFromText=function(str,_235){
+if(!_235){
+_235=&quot;text/xml&quot;;
+}
+if(!dj_undef(&quot;DOMParser&quot;)){
+var _236=new DOMParser();
+return _236.parseFromString(str,_235);
+}else{
+if(!dj_undef(&quot;ActiveXObject&quot;)){
+var _237=dojo.dom.createDocument();
+if(_237){
+_237.async=false;
+_237.loadXML(str);
+return _237;
+}else{
+dojo.debug(&quot;toXml didn't work?&quot;);
+}
+}else{
+var _238=dojo.doc();
+if(_238.createElement){
+var tmp=_238.createElement(&quot;xml&quot;);
+tmp.innerHTML=str;
+if(_238.implementation&amp;&amp;_238.implementation.createDocument){
+var _23a=_238.implementation.createDocument(&quot;foo&quot;,&quot;&quot;,null);
+for(var i=0;i&lt;tmp.childNodes.length;i++){
+_23a.importNode(tmp.childNodes.item(i),true);
+}
+return _23a;
+}
+return ((tmp.document)&amp;&amp;(tmp.document.firstChild?tmp.document.firstChild:tmp));
+}
+}
+}
+return null;
+};
+dojo.dom.prependChild=function(node,_23d){
+if(_23d.firstChild){
+_23d.insertBefore(node,_23d.firstChild);
+}else{
+_23d.appendChild(node);
+}
+return true;
+};
+dojo.dom.insertBefore=function(node,ref,_240){
+if((_240!=true)&amp;&amp;(node===ref||node.nextSibling===ref)){
+return false;
+}
+var _241=ref.parentNode;
+_241.insertBefore(node,ref);
+return true;
+};
+dojo.dom.insertAfter=function(node,ref,_244){
+var pn=ref.parentNode;
+if(ref==pn.lastChild){
+if((_244!=true)&amp;&amp;(node===ref)){
+return false;
+}
+pn.appendChild(node);
+}else{
+return this.insertBefore(node,ref.nextSibling,_244);
+}
+return true;
+};
+dojo.dom.insertAtPosition=function(node,ref,_248){
+if((!node)||(!ref)||(!_248)){
+return false;
+}
+switch(_248.toLowerCase()){
+case &quot;before&quot;:
+return dojo.dom.insertBefore(node,ref);
+case &quot;after&quot;:
+return dojo.dom.insertAfter(node,ref);
+case &quot;first&quot;:
+if(ref.firstChild){
+return dojo.dom.insertBefore(node,ref.firstChild);
+}else{
+ref.appendChild(node);
+return true;
+}
+break;
+default:
+ref.appendChild(node);
+return true;
+}
+};
+dojo.dom.insertAtIndex=function(node,_24a,_24b){
+var _24c=_24a.childNodes;
+if(!_24c.length||_24c.length==_24b){
+_24a.appendChild(node);
+return true;
+}
+if(_24b==0){
+return dojo.dom.prependChild(node,_24a);
+}
+return dojo.dom.insertAfter(node,_24c[_24b-1]);
+};
+dojo.dom.textContent=function(node,text){
+if(arguments.length&gt;1){
+var _24f=dojo.doc();
+dojo.dom.replaceChildren(node,_24f.createTextNode(text));
+return text;
+}else{
+if(node.textContent!=undefined){
+return node.textContent;
+}
+var _250=&quot;&quot;;
+if(node==null){
+return _250;
+}
+for(var i=0;i&lt;node.childNodes.length;i++){
+switch(node.childNodes[i].nodeType){
+case 1:
+case 5:
+_250+=dojo.dom.textContent(node.childNodes[i]);
+break;
+case 3:
+case 2:
+case 4:
+_250+=node.childNodes[i].nodeValue;
+break;
+default:
+break;
+}
+}
+return _250;
+}
+};
+dojo.dom.hasParent=function(node){
+return Boolean(node&amp;&amp;node.parentNode&amp;&amp;dojo.dom.isNode(node.parentNode));
+};
+dojo.dom.isTag=function(node){
+if(node&amp;&amp;node.tagName){
+for(var i=1;i&lt;arguments.length;i++){
+if(node.tagName==String(arguments[i])){
+return String(arguments[i]);
+}
+}
+}
+return &quot;&quot;;
+};
+dojo.dom.setAttributeNS=function(elem,_256,_257,_258){
+if(elem==null||((elem==undefined)&amp;&amp;(typeof elem==&quot;undefined&quot;))){
+dojo.raise(&quot;No element given to dojo.dom.setAttributeNS&quot;);
+}
+if(!((elem.setAttributeNS==undefined)&amp;&amp;(typeof elem.setAttributeNS==&quot;undefined&quot;))){
+elem.setAttributeNS(_256,_257,_258);
+}else{
+var _259=elem.ownerDocument;
+var _25a=_259.createNode(2,_257,_256);
+_25a.nodeValue=_258;
+elem.setAttributeNode(_25a);
+}
+};
+dojo.provide(&quot;dojo.undo.browser&quot;);
+try{
+if((!djConfig[&quot;preventBackButtonFix&quot;])&amp;&amp;(!dojo.hostenv.post_load_)){
+document.write(&quot;&lt;iframe style='border: 0px; width: 1px; height: 1px; position: absolute; bottom: 0px; right: 0px; visibility: visible;' name='djhistory' id='djhistory' src='&quot;+(djConfig[&quot;dojoIframeHistoryUrl&quot;]||dojo.hostenv.getBaseScriptUri()+&quot;iframe_history.html&quot;)+&quot;'&gt;&lt;/iframe&gt;&quot;);
+}
+}
+catch(e){
+}
+if(dojo.render.html.opera){
+dojo.debug(&quot;Opera is not supported with dojo.undo.browser, so back/forward detection will not work.&quot;);
+}
+dojo.undo.browser={initialHref:(!dj_undef(&quot;window&quot;))?window.location.href:&quot;&quot;,initialHash:(!dj_undef(&quot;window&quot;))?window.location.hash:&quot;&quot;,moveForward:false,historyStack:[],forwardStack:[],historyIframe:null,bookmarkAnchor:null,locationTimer:null,setInitialState:function(args){
+this.initialState=this._createState(this.initialHref,args,this.initialHash);
+},addToHistory:function(args){
+this.forwardStack=[];
+var hash=null;
+var url=null;
+if(!this.historyIframe){
+if(djConfig[&quot;useXDomain&quot;]&amp;&amp;!djConfig[&quot;dojoIframeHistoryUrl&quot;]){
+dojo.debug(&quot;dojo.undo.browser: When using cross-domain Dojo builds,&quot;+&quot; please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl&quot;+&quot; to the path on your domain to iframe_history.html&quot;);
+}
+this.historyIframe=window.frames[&quot;djhistory&quot;];
+}
+if(!this.bookmarkAnchor){
+this.bookmarkAnchor=document.createElement(&quot;a&quot;);
+dojo.body().appendChild(this.bookmarkAnchor);
+this.bookmarkAnchor.style.display=&quot;none&quot;;
+}
+if(args[&quot;changeUrl&quot;]){
+hash=&quot;#&quot;+((args[&quot;changeUrl&quot;]!==true)?args[&quot;changeUrl&quot;]:(new Date()).getTime());
+if(this.historyStack.length==0&amp;&amp;this.initialState.urlHash==hash){
+this.initialState=this._createState(url,args,hash);
+return;
+}else{
+if(this.historyStack.length&gt;0&amp;&amp;this.historyStack[this.historyStack.length-1].urlHash==hash){
+this.historyStack[this.historyStack.length-1]=this._createState(url,args,hash);
+return;
+}
+}
+this.changingUrl=true;
+setTimeout(&quot;window.location.href = '&quot;+hash+&quot;'; dojo.undo.browser.changingUrl = false;&quot;,1);
+this.bookmarkAnchor.href=hash;
+if(dojo.render.html.ie){
+url=this._loadIframeHistory();
+var _25f=args[&quot;back&quot;]||args[&quot;backButton&quot;]||args[&quot;handle&quot;];
+var tcb=function(_261){
+if(window.location.hash!=&quot;&quot;){
+setTimeout(&quot;window.location.href = '&quot;+hash+&quot;';&quot;,1);
+}
+_25f.apply(this,[_261]);
+};
+if(args[&quot;back&quot;]){
+args.back=tcb;
+}else{
+if(args[&quot;backButton&quot;]){
+args.backButton=tcb;
+}else{
+if(args[&quot;handle&quot;]){
+args.handle=tcb;
+}
+}
+}
+var _262=args[&quot;forward&quot;]||args[&quot;forwardButton&quot;]||args[&quot;handle&quot;];
+var tfw=function(_264){
+if(window.location.hash!=&quot;&quot;){
+window.location.href=hash;
+}
+if(_262){
+_262.apply(this,[_264]);
+}
+};
+if(args[&quot;forward&quot;]){
+args.forward=tfw;
+}else{
+if(args[&quot;forwardButton&quot;]){
+args.forwardButton=tfw;
+}else{
+if(args[&quot;handle&quot;]){
+args.handle=tfw;
+}
+}
+}
+}else{
+if(dojo.render.html.moz){
+if(!this.locationTimer){
+this.locationTimer=setInterval(&quot;dojo.undo.browser.checkLocation();&quot;,200);
+}
+}
+}
+}else{
+url=this._loadIframeHistory();
+}
+this.historyStack.push(this._createState(url,args,hash));
+},checkLocation:function(){
+if(!this.changingUrl){
+var hsl=this.historyStack.length;
+if((window.location.hash==this.initialHash||window.location.href==this.initialHref)&amp;&amp;(hsl==1)){
+this.handleBackButton();
+return;
+}
+if(this.forwardStack.length&gt;0){
+if(this.forwardStack[this.forwardStack.length-1].urlHash==window.location.hash){
+this.handleForwardButton();
+return;
+}
+}
+if((hsl&gt;=2)&amp;&amp;(this.historyStack[hsl-2])){
+if(this.historyStack[hsl-2].urlHash==window.location.hash){
+this.handleBackButton();
+return;
+}
+}
+}
+},iframeLoaded:function(evt,_267){
+if(!dojo.render.html.opera){
+var _268=this._getUrlQuery(_267.href);
+if(_268==null){
+if(this.historyStack.length==1){
+this.handleBackButton();
+}
+return;
+}
+if(this.moveForward){
+this.moveForward=false;
+return;
+}
+if(this.historyStack.length&gt;=2&amp;&amp;_268==this._getUrlQuery(this.historyStack[this.historyStack.length-2].url)){
+this.handleBackButton();
+}else{
+if(this.forwardStack.length&gt;0&amp;&amp;_268==this._getUrlQuery(this.forwardStack[this.forwardStack.length-1].url)){
+this.handleForwardButton();
+}
+}
+}
+},handleBackButton:function(){
+var _269=this.historyStack.pop();
+if(!_269){
+return;
+}
+var last=this.historyStack[this.historyStack.length-1];
+if(!last&amp;&amp;this.historyStack.length==0){
+last=this.initialState;
+}
+if(last){
+if(last.kwArgs[&quot;back&quot;]){
+last.kwArgs[&quot;back&quot;]();
+}else{
+if(last.kwArgs[&quot;backButton&quot;]){
+last.kwArgs[&quot;backButton&quot;]();
+}else{
+if(last.kwArgs[&quot;handle&quot;]){
+last.kwArgs.handle(&quot;back&quot;);
+}
+}
+}
+}
+this.forwardStack.push(_269);
+},handleForwardButton:function(){
+var last=this.forwardStack.pop();
+if(!last){
+return;
+}
+if(last.kwArgs[&quot;forward&quot;]){
+last.kwArgs.forward();
+}else{
+if(last.kwArgs[&quot;forwardButton&quot;]){
+last.kwArgs.forwardButton();
+}else{
+if(last.kwArgs[&quot;handle&quot;]){
+last.kwArgs.handle(&quot;forward&quot;);
+}
+}
+}
+this.historyStack.push(last);
+},_createState:function(url,args,hash){
+return {&quot;url&quot;:url,&quot;kwArgs&quot;:args,&quot;urlHash&quot;:hash};
+},_getUrlQuery:function(url){
+var _270=url.split(&quot;?&quot;);
+if(_270.length&lt;2){
+return null;
+}else{
+return _270[1];
+}
+},_loadIframeHistory:function(){
+var url=(djConfig[&quot;dojoIframeHistoryUrl&quot;]||dojo.hostenv.getBaseScriptUri()+&quot;iframe_history.html&quot;)+&quot;?&quot;+(new Date()).getTime();
+this.moveForward=true;
+dojo.io.setIFrameSrc(this.historyIframe,url,false);
+return url;
+}};
+dojo.provide(&quot;dojo.io.BrowserIO&quot;);
+if(!dj_undef(&quot;window&quot;)){
+dojo.io.checkChildrenForFile=function(node){
+var _273=false;
+var _274=node.getElementsByTagName(&quot;input&quot;);
+dojo.lang.forEach(_274,function(_275){
+if(_273){
+return;
+}
+if(_275.getAttribute(&quot;type&quot;)==&quot;file&quot;){
+_273=true;
+}
+});
+return _273;
+};
+dojo.io.formHasFile=function(_276){
+return dojo.io.checkChildrenForFile(_276);
+};
+dojo.io.updateNode=function(node,_278){
+node=dojo.byId(node);
+var args=_278;
+if(dojo.lang.isString(_278)){
+args={url:_278};
+}
+args.mimetype=&quot;text/html&quot;;
+args.load=function(t,d,e){
+while(node.firstChild){
+dojo.dom.destroyNode(node.firstChild);
+}
+node.innerHTML=d;
+};
+dojo.io.bind(args);
+};
+dojo.io.formFilter=function(node){
+var type=(node.type||&quot;&quot;).toLowerCase();
+return !node.disabled&amp;&amp;node.name&amp;&amp;!dojo.lang.inArray([&quot;file&quot;,&quot;submit&quot;,&quot;image&quot;,&quot;reset&quot;,&quot;button&quot;],type);
+};
+dojo.io.encodeForm=function(_27f,_280,_281){
+if((!_27f)||(!_27f.tagName)||(!_27f.tagName.toLowerCase()==&quot;form&quot;)){
+dojo.raise(&quot;Attempted to encode a non-form element.&quot;);
+}
+if(!_281){
+_281=dojo.io.formFilter;
+}
+var enc=/utf/i.test(_280||&quot;&quot;)?encodeURIComponent:dojo.string.encodeAscii;
+var _283=[];
+for(var i=0;i&lt;_27f.elements.length;i++){
+var elm=_27f.elements[i];
+if(!elm||elm.tagName.toLowerCase()==&quot;fieldset&quot;||!_281(elm)){
+continue;
+}
+var name=enc(elm.name);
+var type=elm.type.toLowerCase();
+if(type==&quot;select-multiple&quot;){
+for(var j=0;j&lt;elm.options.length;j++){
+if(elm.options[j].selected){
+_283.push(name+&quot;=&quot;+enc(elm.options[j].value));
+}
+}
+}else{
+if(dojo.lang.inArray([&quot;radio&quot;,&quot;checkbox&quot;],type)){
+if(elm.checked){
+_283.push(name+&quot;=&quot;+enc(elm.value));
+}
+}else{
+_283.push(name+&quot;=&quot;+enc(elm.value));
+}
+}
+}
+var _289=_27f.getElementsByTagName(&quot;input&quot;);
+for(var i=0;i&lt;_289.length;i++){
+var _28a=_289[i];
+if(_28a.type.toLowerCase()==&quot;image&quot;&amp;&amp;_28a.form==_27f&amp;&amp;_281(_28a)){
+var name=enc(_28a.name);
+_283.push(name+&quot;=&quot;+enc(_28a.value));
+_283.push(name+&quot;.x=0&quot;);
+_283.push(name+&quot;.y=0&quot;);
+}
+}
+return _283.join(&quot;&amp;&quot;)+&quot;&amp;&quot;;
+};
+dojo.io.FormBind=function(args){
+this.bindArgs={};
+if(args&amp;&amp;args.formNode){
+this.init(args);
+}else{
+if(args){
+this.init({formNode:args});
+}
+}
+};
+dojo.lang.extend(dojo.io.FormBind,{form:null,bindArgs:null,clickedButton:null,init:function(args){
+var form=dojo.byId(args.formNode);
+if(!form||!form.tagName||form.tagName.toLowerCase()!=&quot;form&quot;){
+throw new Error(&quot;FormBind: Couldn't apply, invalid form&quot;);
+}else{
+if(this.form==form){
+return;
+}else{
+if(this.form){
+throw new Error(&quot;FormBind: Already applied to a form&quot;);
+}
+}
+}
+dojo.lang.mixin(this.bindArgs,args);
+this.form=form;
+this.connect(form,&quot;onsubmit&quot;,&quot;submit&quot;);
+for(var i=0;i&lt;form.elements.length;i++){
+var node=form.elements[i];
+if(node&amp;&amp;node.type&amp;&amp;dojo.lang.inArray([&quot;submit&quot;,&quot;button&quot;],node.type.toLowerCase())){
+this.connect(node,&quot;onclick&quot;,&quot;click&quot;);
+}
+}
+var _290=form.getElementsByTagName(&quot;input&quot;);
+for(var i=0;i&lt;_290.length;i++){
+var _291=_290[i];
+if(_291.type.toLowerCase()==&quot;image&quot;&amp;&amp;_291.form==form){
+this.connect(_291,&quot;onclick&quot;,&quot;click&quot;);
+}
+}
+},onSubmit:function(form){
+return true;
+},submit:function(e){
+e.preventDefault();
+if(this.onSubmit(this.form)){
+dojo.io.bind(dojo.lang.mixin(this.bindArgs,{formFilter:dojo.lang.hitch(this,&quot;formFilter&quot;)}));
+}
+},click:function(e){
+var node=e.currentTarget;
+if(node.disabled){
+return;
+}
+this.clickedButton=node;
+},formFilter:function(node){
+var type=(node.type||&quot;&quot;).toLowerCase();
+var _298=false;
+if(node.disabled||!node.name){
+_298=false;
+}else{
+if(dojo.lang.inArray([&quot;submit&quot;,&quot;button&quot;,&quot;image&quot;],type)){
+if(!this.clickedButton){
+this.clickedButton=node;
+}
+_298=node==this.clickedButton;
+}else{
+_298=!dojo.lang.inArray([&quot;file&quot;,&quot;submit&quot;,&quot;reset&quot;,&quot;button&quot;],type);
+}
+}
+return _298;
+},connect:function(_299,_29a,_29b){
+if(dojo.evalObjPath(&quot;dojo.event.connect&quot;)){
+dojo.event.connect(_299,_29a,this,_29b);
+}else{
+var fcn=dojo.lang.hitch(this,_29b);
+_299[_29a]=function(e){
+if(!e){
+e=window.event;
+}
+if(!e.currentTarget){
+e.currentTarget=e.srcElement;
+}
+if(!e.preventDefault){
+e.preventDefault=function(){
+window.event.returnValue=false;
+};
+}
+fcn(e);
+};
+}
+}});
+dojo.io.XMLHTTPTransport=new function(){
+var _29e=this;
+var _29f={};
+this.useCache=false;
+this.preventCache=false;
+function getCacheKey(url,_2a1,_2a2){
+return url+&quot;|&quot;+_2a1+&quot;|&quot;+_2a2.toLowerCase();
+}
+function addToCache(url,_2a4,_2a5,http){
+_29f[getCacheKey(url,_2a4,_2a5)]=http;
+}
+function getFromCache(url,_2a8,_2a9){
+return _29f[getCacheKey(url,_2a8,_2a9)];
+}
+this.clearCache=function(){
+_29f={};
+};
+function doLoad(_2aa,http,url,_2ad,_2ae){
+if(((http.status&gt;=200)&amp;&amp;(http.status&lt;300))||(http.status==304)||(http.status==1223)||(location.protocol==&quot;file:&quot;&amp;&amp;(http.status==0||http.status==undefined))||(location.protocol==&quot;chrome:&quot;&amp;&amp;(http.status==0||http.status==undefined))){
+var ret;
+if(_2aa.method.toLowerCase()==&quot;head&quot;){
+var _2b0=http.getAllResponseHeaders();
+ret={};
+ret.toString=function(){
+return _2b0;
+};
+var _2b1=_2b0.split(/[\r\n]+/g);
+for(var i=0;i&lt;_2b1.length;i++){
+var pair=_2b1[i].match(/^([^:]+)\s*:\s*(.+)$/i);
+if(pair){
+ret[pair[1]]=pair[2];
+}
+}
+}else{
+if(_2aa.mimetype==&quot;text/javascript&quot;){
+try{
+ret=dj_eval(http.responseText);
+}
+catch(e){
+dojo.debug(e);
+dojo.debug(http.responseText);
+ret=null;
+}
+}else{
+if(_2aa.mimetype.substr(0,9)==&quot;text/json&quot;||_2aa.mimetype.substr(0,16)==&quot;application/json&quot;){
+try{
+ret=dj_eval(&quot;(&quot;+_2aa.jsonFilter(http.responseText)+&quot;)&quot;);
+}
+catch(e){
+dojo.debug(e);
+dojo.debug(http.responseText);
+ret=false;
+}
+}else{
+if((_2aa.mimetype==&quot;application/xml&quot;)||(_2aa.mimetype==&quot;text/xml&quot;)){
+ret=http.responseXML;
+if(!ret||typeof ret==&quot;string&quot;||!http.getResponseHeader(&quot;Content-Type&quot;)){
+ret=dojo.dom.createDocumentFromText(http.responseText);
+}
+}else{
+ret=http.responseText;
+}
+}
+}
+}
+if(_2ae){
+addToCache(url,_2ad,_2aa.method,http);
+}
+_2aa[(typeof _2aa.load==&quot;function&quot;)?&quot;load&quot;:&quot;handle&quot;](&quot;load&quot;,ret,http,_2aa);
+}else{
+var _2b4=new dojo.io.Error(&quot;XMLHttpTransport Error: &quot;+http.status+&quot; &quot;+http.statusText);
+_2aa[(typeof _2aa.error==&quot;function&quot;)?&quot;error&quot;:&quot;handle&quot;](&quot;error&quot;,_2b4,http,_2aa);
+}
+}
+function setHeaders(http,_2b6){
+if(_2b6[&quot;headers&quot;]){
+for(var _2b7 in _2b6[&quot;headers&quot;]){
+if(_2b7.toLowerCase()==&quot;content-type&quot;&amp;&amp;!_2b6[&quot;contentType&quot;]){
+_2b6[&quot;contentType&quot;]=_2b6[&quot;headers&quot;][_2b7];
+}else{
+http.setRequestHeader(_2b7,_2b6[&quot;headers&quot;][_2b7]);
+}
+}
+}
+}
+this.inFlight=[];
+this.inFlightTimer=null;
+this.startWatchingInFlight=function(){
+if(!this.inFlightTimer){
+this.inFlightTimer=setTimeout(&quot;dojo.io.XMLHTTPTransport.watchInFlight();&quot;,10);
+}
+};
+this.watchInFlight=function(){
+var now=null;
+if(!dojo.hostenv._blockAsync&amp;&amp;!_29e._blockAsync){
+for(var x=this.inFlight.length-1;x&gt;=0;x--){
+try{
+var tif=this.inFlight[x];
+if(!tif||tif.http._aborted||!tif.http.readyState){
+this.inFlight.splice(x,1);
+continue;
+}
+if(4==tif.http.readyState){
+this.inFlight.splice(x,1);
+doLoad(tif.req,tif.http,tif.url,tif.query,tif.useCache);
+}else{
+if(tif.startTime){
+if(!now){
+now=(new Date()).getTime();
+}
+if(tif.startTime+(tif.req.timeoutSeconds*1000)&lt;now){
+if(typeof tif.http.abort==&quot;function&quot;){
+tif.http.abort();
+}
+this.inFlight.splice(x,1);
+tif.req[(typeof tif.req.timeout==&quot;function&quot;)?&quot;timeout&quot;:&quot;handle&quot;](&quot;timeout&quot;,null,tif.http,tif.req);
+}
+}
+}
+}
+catch(e){
+try{
+var _2bb=new dojo.io.Error(&quot;XMLHttpTransport.watchInFlight Error: &quot;+e);
+tif.req[(typeof tif.req.error==&quot;function&quot;)?&quot;error&quot;:&quot;handle&quot;](&quot;error&quot;,_2bb,tif.http,tif.req);
+}
+catch(e2){
+dojo.debug(&quot;XMLHttpTransport error callback failed: &quot;+e2);
+}
+}
+}
+}
+clearTimeout(this.inFlightTimer);
+if(this.inFlight.length==0){
+this.inFlightTimer=null;
+return;
+}
+this.inFlightTimer=setTimeout(&quot;dojo.io.XMLHTTPTransport.watchInFlight();&quot;,10);
+};
+var _2bc=dojo.hostenv.getXmlhttpObject()?true:false;
+this.canHandle=function(_2bd){
+var mlc=_2bd[&quot;mimetype&quot;].toLowerCase()||&quot;&quot;;
+return _2bc&amp;&amp;((dojo.lang.inArray([&quot;text/plain&quot;,&quot;text/html&quot;,&quot;application/xml&quot;,&quot;text/xml&quot;,&quot;text/javascript&quot;],mlc))||(mlc.substr(0,9)==&quot;text/json&quot;||mlc.substr(0,16)==&quot;application/json&quot;))&amp;&amp;!(_2bd[&quot;formNode&quot;]&amp;&amp;dojo.io.formHasFile(_2bd[&quot;formNode&quot;]));
+};
+this.multipartBoundary=&quot;45309FFF-BD65-4d50-99C9-36986896A96F&quot;;
+this.bind=function(_2bf){
+if(!_2bf[&quot;url&quot;]){
+if(!_2bf[&quot;formNode&quot;]&amp;&amp;(_2bf[&quot;backButton&quot;]||_2bf[&quot;back&quot;]||_2bf[&quot;changeUrl&quot;]||_2bf[&quot;watchForURL&quot;])&amp;&amp;(!djConfig.preventBackButtonFix)){
+dojo.deprecated(&quot;Using dojo.io.XMLHTTPTransport.bind() to add to browser history without doing an IO request&quot;,&quot;Use dojo.undo.browser.addToHistory() instead.&quot;,&quot;0.4&quot;);
+dojo.undo.browser.addToHistory(_2bf);
+return true;
+}
+}
+var url=_2bf.url;
+var _2c1=&quot;&quot;;
+if(_2bf[&quot;formNode&quot;]){
+var ta=_2bf.formNode.getAttribute(&quot;action&quot;);
+if((ta)&amp;&amp;(!_2bf[&quot;url&quot;])){
+url=ta;
+}
+var tp=_2bf.formNode.getAttribute(&quot;method&quot;);
+if((tp)&amp;&amp;(!_2bf[&quot;method&quot;])){
+_2bf.method=tp;
+}
+_2c1+=dojo.io.encodeForm(_2bf.formNode,_2bf.encoding,_2bf[&quot;formFilter&quot;]);
+}
+if(url.indexOf(&quot;#&quot;)&gt;-1){
+dojo.debug(&quot;Warning: dojo.io.bind: stripping hash values from url:&quot;,url);
+url=url.split(&quot;#&quot;)[0];
+}
+if(_2bf[&quot;file&quot;]){
+_2bf.method=&quot;post&quot;;
+}
+if(!_2bf[&quot;method&quot;]){
+_2bf.method=&quot;get&quot;;
+}
+if(_2bf.method.toLowerCase()==&quot;get&quot;){
+_2bf.multipart=false;
+}else{
+if(_2bf[&quot;file&quot;]){
+_2bf.multipart=true;
+}else{
+if(!_2bf[&quot;multipart&quot;]){
+_2bf.multipart=false;
+}
+}
+}
+if(_2bf[&quot;backButton&quot;]||_2bf[&quot;back&quot;]||_2bf[&quot;changeUrl&quot;]){
+dojo.undo.browser.addToHistory(_2bf);
+}
+var _2c4=_2bf[&quot;content&quot;]||{};
+if(_2bf.sendTransport){
+_2c4[&quot;dojo.transport&quot;]=&quot;xmlhttp&quot;;
+}
+do{
+if(_2bf.postContent){
+_2c1=_2bf.postContent;
+break;
+}
+if(_2c4){
+_2c1+=dojo.io.argsFromMap(_2c4,_2bf.encoding);
+}
+if(_2bf.method.toLowerCase()==&quot;get&quot;||!_2bf.multipart){
+break;
+}
+var t=[];
+if(_2c1.length){
+var q=_2c1.split(&quot;&amp;&quot;);
+for(var i=0;i&lt;q.length;++i){
+if(q[i].length){
+var p=q[i].split(&quot;=&quot;);
+t.push(&quot;--&quot;+this.multipartBoundary,&quot;Content-Disposition: form-data; name=\&quot;&quot;+p[0]+&quot;\&quot;&quot;,&quot;&quot;,p[1]);
+}
+}
+}
+if(_2bf.file){
+if(dojo.lang.isArray(_2bf.file)){
+for(var i=0;i&lt;_2bf.file.length;++i){
+var o=_2bf.file[i];
+t.push(&quot;--&quot;+this.multipartBoundary,&quot;Content-Disposition: form-data; name=\&quot;&quot;+o.name+&quot;\&quot;; filename=\&quot;&quot;+(&quot;fileName&quot; in o?o.fileName:o.name)+&quot;\&quot;&quot;,&quot;Content-Type: &quot;+(&quot;contentType&quot; in o?o.contentType:&quot;application/octet-stream&quot;),&quot;&quot;,o.content);
+}
+}else{
+var o=_2bf.file;
+t.push(&quot;--&quot;+this.multipartBoundary,&quot;Content-Disposition: form-data; name=\&quot;&quot;+o.name+&quot;\&quot;; filename=\&quot;&quot;+(&quot;fileName&quot; in o?o.fileName:o.name)+&quot;\&quot;&quot;,&quot;Content-Type: &quot;+(&quot;contentType&quot; in o?o.contentType:&quot;application/octet-stream&quot;),&quot;&quot;,o.content);
+}
+}
+if(t.length){
+t.push(&quot;--&quot;+this.multipartBoundary+&quot;--&quot;,&quot;&quot;);
+_2c1=t.join(&quot;\r\n&quot;);
+}
+}while(false);
+var _2ca=_2bf[&quot;sync&quot;]?false:true;
+var _2cb=_2bf[&quot;preventCache&quot;]||(this.preventCache==true&amp;&amp;_2bf[&quot;preventCache&quot;]!=false);
+var _2cc=_2bf[&quot;useCache&quot;]==true||(this.useCache==true&amp;&amp;_2bf[&quot;useCache&quot;]!=false);
+if(!_2cb&amp;&amp;_2cc){
+var _2cd=getFromCache(url,_2c1,_2bf.method);
+if(_2cd){
+doLoad(_2bf,_2cd,url,_2c1,false);
+return;
+}
+}
+var http=dojo.hostenv.getXmlhttpObject(_2bf);
+var _2cf=false;
+if(_2ca){
+var _2d0=this.inFlight.push({&quot;req&quot;:_2bf,&quot;http&quot;:http,&quot;url&quot;:url,&quot;query&quot;:_2c1,&quot;useCache&quot;:_2cc,&quot;startTime&quot;:_2bf.timeoutSeconds?(new Date()).getTime():0});
+this.startWatchingInFlight();
+}else{
+_29e._blockAsync=true;
+}
+if(_2bf.method.toLowerCase()==&quot;post&quot;){
+if(!_2bf.user){
+http.open(&quot;POST&quot;,url,_2ca);
+}else{
+http.open(&quot;POST&quot;,url,_2ca,_2bf.user,_2bf.password);
+}
+setHeaders(http,_2bf);
+http.setRequestHeader(&quot;Content-Type&quot;,_2bf.multipart?(&quot;multipart/form-data; boundary=&quot;+this.multipartBoundary):(_2bf.contentType||&quot;application/x-www-form-urlencoded&quot;));
+try{
+http.send(_2c1);
+}
+catch(e){
+if(typeof http.abort==&quot;function&quot;){
+http.abort();
+}
+doLoad(_2bf,{status:404},url,_2c1,_2cc);
+}
+}else{
+var _2d1=url;
+if(_2c1!=&quot;&quot;){
+_2d1+=(_2d1.indexOf(&quot;?&quot;)&gt;-1?&quot;&amp;&quot;:&quot;?&quot;)+_2c1;
+}
+if(_2cb){
+_2d1+=(dojo.string.endsWithAny(_2d1,&quot;?&quot;,&quot;&amp;&quot;)?&quot;&quot;:(_2d1.indexOf(&quot;?&quot;)&gt;-1?&quot;&amp;&quot;:&quot;?&quot;))+&quot;dojo.preventCache=&quot;+new Date().valueOf();
+}
+if(!_2bf.user){
+http.open(_2bf.method.toUpperCase(),_2d1,_2ca);
+}else{
+http.open(_2bf.method.toUpperCase(),_2d1,_2ca,_2bf.user,_2bf.password);
+}
+setHeaders(http,_2bf);
+try{
+http.send(null);
+}
+catch(e){
+if(typeof http.abort==&quot;function&quot;){
+http.abort();
+}
+doLoad(_2bf,{status:404},url,_2c1,_2cc);
+}
+}
+if(!_2ca){
+doLoad(_2bf,http,url,_2c1,_2cc);
+_29e._blockAsync=false;
+}
+_2bf.abort=function(){
+try{
+http._aborted=true;
+}
+catch(e){
+}
+return http.abort();
+};
+return;
+};
+dojo.io.transports.addTransport(&quot;XMLHTTPTransport&quot;);
+};
+}
+dojo.provide(&quot;dojo.io.cookie&quot;);
+dojo.io.cookie.setCookie=function(name,_2d3,days,path,_2d6,_2d7){
+var _2d8=-1;
+if((typeof days==&quot;number&quot;)&amp;&amp;(days&gt;=0)){
+var d=new Date();
+d.setTime(d.getTime()+(days*24*60*60*1000));
+_2d8=d.toGMTString();
+}
+_2d3=escape(_2d3);
+document.cookie=name+&quot;=&quot;+_2d3+&quot;;&quot;+(_2d8!=-1?&quot; expires=&quot;+_2d8+&quot;;&quot;:&quot;&quot;)+(path?&quot;path=&quot;+path:&quot;&quot;)+(_2d6?&quot;; domain=&quot;+_2d6:&quot;&quot;)+(_2d7?&quot;; secure&quot;:&quot;&quot;);
+};
+dojo.io.cookie.set=dojo.io.cookie.setCookie;
+dojo.io.cookie.getCookie=function(name){
+var idx=document.cookie.lastIndexOf(name+&quot;=&quot;);
+if(idx==-1){
+return null;
+}
+var _2dc=document.cookie.substring(idx+name.length+1);
+var end=_2dc.indexOf(&quot;;&quot;);
+if(end==-1){
+end=_2dc.length;
+}
+_2dc=_2dc.substring(0,end);
+_2dc=unescape(_2dc);
+return _2dc;
+};
+dojo.io.cookie.get=dojo.io.cookie.getCookie;
+dojo.io.cookie.deleteCookie=function(name){
+dojo.io.cookie.setCookie(name,&quot;-&quot;,0);
+};
+dojo.io.cookie.setObjectCookie=function(name,obj,days,path,_2e3,_2e4,_2e5){
+if(arguments.length==5){
+_2e5=_2e3;
+_2e3=null;
+_2e4=null;
+}
+var _2e6=[],_2e7,_2e8=&quot;&quot;;
+if(!_2e5){
+_2e7=dojo.io.cookie.getObjectCookie(name);
+}
+if(days&gt;=0){
+if(!_2e7){
+_2e7={};
+}
+for(var prop in obj){
+if(obj[prop]==null){
+delete _2e7[prop];
+}else{
+if((typeof obj[prop]==&quot;string&quot;)||(typeof obj[prop]==&quot;number&quot;)){
+_2e7[prop]=obj[prop];
+}
+}
+}
+prop=null;
+for(var prop in _2e7){
+_2e6.push(escape(prop)+&quot;=&quot;+escape(_2e7[prop]));
+}
+_2e8=_2e6.join(&quot;&amp;&quot;);
+}
+dojo.io.cookie.setCookie(name,_2e8,days,path,_2e3,_2e4);
+};
+dojo.io.cookie.getObjectCookie=function(name){
+var _2eb=null,_2ec=dojo.io.cookie.getCookie(name);
+if(_2ec){
+_2eb={};
+var _2ed=_2ec.split(&quot;&amp;&quot;);
+for(var i=0;i&lt;_2ed.length;i++){
+var pair=_2ed[i].split(&quot;=&quot;);
+var _2f0=pair[1];
+if(isNaN(_2f0)){
+_2f0=unescape(pair[1]);
+}
+_2eb[unescape(pair[0])]=_2f0;
+}
+}
+return _2eb;
+};
+dojo.io.cookie.isSupported=function(){
+if(typeof navigator.cookieEnabled!=&quot;boolean&quot;){
+dojo.io.cookie.setCookie(&quot;__TestingYourBrowserForCookieSupport__&quot;,&quot;CookiesAllowed&quot;,90,null);
+var _2f1=dojo.io.cookie.getCookie(&quot;__TestingYourBrowserForCookieSupport__&quot;);
+navigator.cookieEnabled=(_2f1==&quot;CookiesAllowed&quot;);
+if(navigator.cookieEnabled){
+this.deleteCookie(&quot;__TestingYourBrowserForCookieSupport__&quot;);
+}
+}
+return navigator.cookieEnabled;
+};
+if(!dojo.io.cookies){
+dojo.io.cookies=dojo.io.cookie;
+}
+dojo.kwCompoundRequire({common:[&quot;dojo.io.common&quot;],rhino:[&quot;dojo.io.RhinoIO&quot;],browser:[&quot;dojo.io.BrowserIO&quot;,&quot;dojo.io.cookie&quot;],dashboard:[&quot;dojo.io.BrowserIO&quot;,&quot;dojo.io.cookie&quot;]});
+dojo.provide(&quot;dojo.io.*&quot;);
+dojo.provide(&quot;dojo.event.common&quot;);
+dojo.event=new function(){
+this._canTimeout=dojo.lang.isFunction(dj_global[&quot;setTimeout&quot;])||dojo.lang.isAlien(dj_global[&quot;setTimeout&quot;]);
+function interpolateArgs(args,_2f3){
+var dl=dojo.lang;
+var ao={srcObj:dj_global,srcFunc:null,adviceObj:dj_global,adviceFunc:null,aroundObj:null,aroundFunc:null,adviceType:(args.length&gt;2)?args[0]:&quot;after&quot;,precedence:&quot;last&quot;,once:false,delay:null,rate:0,adviceMsg:false,maxCalls:-1};
+switch(args.length){
+case 0:
+return;
+case 1:
+return;
+case 2:
+ao.srcFunc=args[0];
+ao.adviceFunc=args[1];
+break;
+case 3:
+if((dl.isObject(args[0]))&amp;&amp;(dl.isString(args[1]))&amp;&amp;(dl.isString(args[2]))){
+ao.adviceType=&quot;after&quot;;
+ao.srcObj=args[0];
+ao.srcFunc=args[1];
+ao.adviceFunc=args[2];
+}else{
+if((dl.isString(args[1]))&amp;&amp;(dl.isString(args[2]))){
+ao.srcFunc=args[1];
+ao.adviceFunc=args[2];
+}else{
+if((dl.isObject(args[0]))&amp;&amp;(dl.isString(args[1]))&amp;&amp;(dl.isFunction(args[2]))){
+ao.adviceType=&quot;after&quot;;
+ao.srcObj=args[0];
+ao.srcFunc=args[1];
+var _2f6=dl.nameAnonFunc(args[2],ao.adviceObj,_2f3);
+ao.adviceFunc=_2f6;
+}else{
+if((dl.isFunction(args[0]))&amp;&amp;(dl.isObject(args[1]))&amp;&amp;(dl.isString(args[2]))){
+ao.adviceType=&quot;after&quot;;
+ao.srcObj=dj_global;
+var _2f6=dl.nameAnonFunc(args[0],ao.srcObj,_2f3);
+ao.srcFunc=_2f6;
+ao.adviceObj=args[1];
+ao.adviceFunc=args[2];
+}
+}
+}
+}
+break;
+case 4:
+if((dl.isObject(args[0]))&amp;&amp;(dl.isObject(args[2]))){
+ao.adviceType=&quot;after&quot;;
+ao.srcObj=args[0];
+ao.srcFunc=args[1];
+ao.adviceObj=args[2];
+ao.adviceFunc=args[3];
+}else{
+if((dl.isString(args[0]))&amp;&amp;(dl.isString(args[1]))&amp;&amp;(dl.isObject(args[2]))){
+ao.adviceType=args[0];
+ao.srcObj=dj_global;
+ao.srcFunc=args[1];
+ao.adviceObj=args[2];
+ao.adviceFunc=args[3];
+}else{
+if((dl.isString(args[0]))&amp;&amp;(dl.isFunction(args[1]))&amp;&amp;(dl.isObject(args[2]))){
+ao.adviceType=args[0];
+ao.srcObj=dj_global;
+var _2f6=dl.nameAnonFunc(args[1],dj_global,_2f3);
+ao.srcFunc=_2f6;
+ao.adviceObj=args[2];
+ao.adviceFunc=args[3];
+}else{
+if((dl.isString(args[0]))&amp;&amp;(dl.isObject(args[1]))&amp;&amp;(dl.isString(args[2]))&amp;&amp;(dl.isFunction(args[3]))){
+ao.srcObj=args[1];
+ao.srcFunc=args[2];
+var _2f6=dl.nameAnonFunc(args[3],dj_global,_2f3);
+ao.adviceObj=dj_global;
+ao.adviceFunc=_2f6;
+}else{
+if(dl.isObject(args[1])){
+ao.srcObj=args[1];
+ao.srcFunc=args[2];
+ao.adviceObj=dj_global;
+ao.adviceFunc=args[3];
+}else{
+if(dl.isObject(args[2])){
+ao.srcObj=dj_global;
+ao.srcFunc=args[1];
+ao.adviceObj=args[2];
+ao.adviceFunc=args[3];
+}else{
+ao.srcObj=ao.adviceObj=ao.aroundObj=dj_global;
+ao.srcFunc=args[1];
+ao.adviceFunc=args[2];
+ao.aroundFunc=args[3];
+}
+}
+}
+}
+}
+}
+break;
+case 6:
+ao.srcObj=args[1];
+ao.srcFunc=args[2];
+ao.adviceObj=args[3];
+ao.adviceFunc=args[4];
+ao.aroundFunc=args[5];
+ao.aroundObj=dj_global;
+break;
+default:
+ao.srcObj=args[1];
+ao.srcFunc=args[2];
+ao.adviceObj=args[3];
+ao.adviceFunc=args[4];
+ao.aroundObj=args[5];
+ao.aroundFunc=args[6];
+ao.once=args[7];
+ao.delay=args[8];
+ao.rate=args[9];
+ao.adviceMsg=args[10];
+ao.maxCalls=(!isNaN(parseInt(args[11])))?args[11]:-1;
+break;
+}
+if(dl.isFunction(ao.aroundFunc)){
+var _2f6=dl.nameAnonFunc(ao.aroundFunc,ao.aroundObj,_2f3);
+ao.aroundFunc=_2f6;
+}
+if(dl.isFunction(ao.srcFunc)){
+ao.srcFunc=dl.getNameInObj(ao.srcObj,ao.srcFunc);
+}
+if(dl.isFunction(ao.adviceFunc)){
+ao.adviceFunc=dl.getNameInObj(ao.adviceObj,ao.adviceFunc);
+}
+if((ao.aroundObj)&amp;&amp;(dl.isFunction(ao.aroundFunc))){
+ao.aroundFunc=dl.getNameInObj(ao.aroundObj,ao.aroundFunc);
+}
+if(!ao.srcObj){
+dojo.raise(&quot;bad srcObj for srcFunc: &quot;+ao.srcFunc);
+}
+if(!ao.adviceObj){
+dojo.raise(&quot;bad adviceObj for adviceFunc: &quot;+ao.adviceFunc);
+}
+if(!ao.adviceFunc){
+dojo.debug(&quot;bad adviceFunc for srcFunc: &quot;+ao.srcFunc);
+dojo.debugShallow(ao);
+}
+return ao;
+}
+this.connect=function(){
+if(arguments.length==1){
+var ao=arguments[0];
+}else{
+var ao=interpolateArgs(arguments,true);
+}
+if(dojo.lang.isString(ao.srcFunc)&amp;&amp;(ao.srcFunc.toLowerCase()==&quot;onkey&quot;)){
+if(dojo.render.html.ie){
+ao.srcFunc=&quot;onkeydown&quot;;
+this.connect(ao);
+}
+ao.srcFunc=&quot;onkeypress&quot;;
+}
+if(dojo.lang.isArray(ao.srcObj)&amp;&amp;ao.srcObj!=&quot;&quot;){
+var _2f8={};
+for(var x in ao){
+_2f8[x]=ao[x];
+}
+var mjps=[];
+dojo.lang.forEach(ao.srcObj,function(src){
+if((dojo.render.html.capable)&amp;&amp;(dojo.lang.isString(src))){
+src=dojo.byId(src);
+}
+_2f8.srcObj=src;
+mjps.push(dojo.event.connect.call(dojo.event,_2f8));
+});
+return mjps;
+}
+var mjp=dojo.event.MethodJoinPoint.getForMethod(ao.srcObj,ao.srcFunc);
+if(ao.adviceFunc){
+var mjp2=dojo.event.MethodJoinPoint.getForMethod(ao.adviceObj,ao.adviceFunc);
+}
+mjp.kwAddAdvice(ao);
+return mjp;
+};
+this.log=function(a1,a2){
+var _300;
+if((arguments.length==1)&amp;&amp;(typeof a1==&quot;object&quot;)){
+_300=a1;
+}else{
+_300={srcObj:a1,srcFunc:a2};
+}
+_300.adviceFunc=function(){
+var _301=[];
+for(var x=0;x&lt;arguments.length;x++){
+_301.push(arguments[x]);
+}
+dojo.debug(&quot;(&quot;+_300.srcObj+&quot;).&quot;+_300.srcFunc,&quot;:&quot;,_301.join(&quot;, &quot;));
+};
+this.kwConnect(_300);
+};
+this.connectBefore=function(){
+var args=[&quot;before&quot;];
+for(var i=0;i&lt;arguments.length;i++){
+args.push(arguments[i]);
+}
+return this.connect.apply(this,args);
+};
+this.connectAround=function(){
+var args=[&quot;around&quot;];
+for(var i=0;i&lt;arguments.length;i++){
+args.push(arguments[i]);
+}
+return this.connect.apply(this,args);
+};
+this.connectOnce=function(){
+var ao=interpolateArgs(arguments,true);
+ao.once=true;
+return this.connect(ao);
+};
+this.connectRunOnce=function(){
+var ao=interpolateArgs(arguments,true);
+ao.maxCalls=1;
+return this.connect(ao);
+};
+this._kwConnectImpl=function(_309,_30a){
+var fn=(_30a)?&quot;disconnect&quot;:&quot;connect&quot;;
+if(typeof _309[&quot;srcFunc&quot;]==&quot;function&quot;){
+_309.srcObj=_309[&quot;srcObj&quot;]||dj_global;
+var _30c=dojo.lang.nameAnonFunc(_309.srcFunc,_309.srcObj,true);
+_309.srcFunc=_30c;
+}
+if(typeof _309[&quot;adviceFunc&quot;]==&quot;function&quot;){
+_309.adviceObj=_309[&quot;adviceObj&quot;]||dj_global;
+var _30c=dojo.lang.nameAnonFunc(_309.adviceFunc,_309.adviceObj,true);
+_309.adviceFunc=_30c;
+}
+_309.srcObj=_309[&quot;srcObj&quot;]||dj_global;
+_309.adviceObj=_309[&quot;adviceObj&quot;]||_309[&quot;targetObj&quot;]||dj_global;
+_309.adviceFunc=_309[&quot;adviceFunc&quot;]||_309[&quot;targetFunc&quot;];
+return dojo.event[fn](_309);
+};
+this.kwConnect=function(_30d){
+return this._kwConnectImpl(_30d,false);
+};
+this.disconnect=function(){
+if(arguments.length==1){
+var ao=arguments[0];
+}else{
+var ao=interpolateArgs(arguments,true);
+}
+if(!ao.adviceFunc){
+return;
+}
+if(dojo.lang.isString(ao.srcFunc)&amp;&amp;(ao.srcFunc.toLowerCase()==&quot;onkey&quot;)){
+if(dojo.render.html.ie){
+ao.srcFunc=&quot;onkeydown&quot;;
+this.disconnect(ao);
+}
+ao.srcFunc=&quot;onkeypress&quot;;
+}
+if(!ao.srcObj[ao.srcFunc]){
+return null;
+}
+var mjp=dojo.event.MethodJoinPoint.getForMethod(ao.srcObj,ao.srcFunc,true);
+mjp.removeAdvice(ao.adviceObj,ao.adviceFunc,ao.adviceType,ao.once);
+return mjp;
+};
+this.kwDisconnect=function(_310){
+return this._kwConnectImpl(_310,true);
+};
+};
+dojo.event.MethodInvocation=function(_311,obj,args){
+this.jp_=_311;
+this.object=obj;
+this.args=[];
+for(var x=0;x&lt;args.length;x++){
+this.args[x]=args[x];
+}
+this.around_index=-1;
+};
+dojo.event.MethodInvocation.prototype.proceed=function(){
+this.around_index++;
+if(this.around_index&gt;=this.jp_.around.length){
+return this.jp_.object[this.jp_.methodname].apply(this.jp_.object,this.args);
+}else{
+var ti=this.jp_.around[this.around_index];
+var mobj=ti[0]||dj_global;
+var meth=ti[1];
+return mobj[meth].call(mobj,this);
+}
+};
+dojo.event.MethodJoinPoint=function(obj,_319){
+this.object=obj||dj_global;
+this.methodname=_319;
+this.methodfunc=this.object[_319];
+this.squelch=false;
+};
+dojo.event.MethodJoinPoint.getForMethod=function(obj,_31b){
+if(!obj){
+obj=dj_global;
+}
+var ofn=obj[_31b];
+if(!ofn){
+ofn=obj[_31b]=function(){
+};
+if(!obj[_31b]){
+dojo.raise(&quot;Cannot set do-nothing method on that object &quot;+_31b);
+}
+}else{
+if((typeof ofn!=&quot;function&quot;)&amp;&amp;(!dojo.lang.isFunction(ofn))&amp;&amp;(!dojo.lang.isAlien(ofn))){
+return null;
+}
+}
+var _31d=_31b+&quot;$joinpoint&quot;;
+var _31e=_31b+&quot;$joinpoint$method&quot;;
+var _31f=obj[_31d];
+if(!_31f){
+var _320=false;
+if(dojo.event[&quot;browser&quot;]){
+if((obj[&quot;attachEvent&quot;])||(obj[&quot;nodeType&quot;])||(obj[&quot;addEventListener&quot;])){
+_320=true;
+dojo.event.browser.addClobberNodeAttrs(obj,[_31d,_31e,_31b]);
+}
+}
+var _321=ofn.length;
+obj[_31e]=ofn;
+_31f=obj[_31d]=new dojo.event.MethodJoinPoint(obj,_31e);
+if(!_320){
+obj[_31b]=function(){
+return _31f.run.apply(_31f,arguments);
+};
+}else{
+obj[_31b]=function(){
+var args=[];
+if(!arguments.length){
+var evt=null;
+try{
+if(obj.ownerDocument){
+evt=obj.ownerDocument.parentWindow.event;
+}else{
+if(obj.documentElement){
+evt=obj.documentElement.ownerDocument.parentWindow.event;
+}else{
+if(obj.event){
+evt=obj.event;
+}else{
+evt=window.event;
+}
+}
+}
+}
+catch(e){
+evt=window.event;
+}
+if(evt){
+args.push(dojo.event.browser.fixEvent(evt,this));
+}
+}else{
+for(var x=0;x&lt;arguments.length;x++){
+if((x==0)&amp;&amp;(dojo.event.browser.isEvent(arguments[x]))){
+args.push(dojo.event.browser.fixEvent(arguments[x],this));
+}else{
+args.push(arguments[x]);
+}
+}
+}
+return _31f.run.apply(_31f,args);
+};
+}
+obj[_31b].__preJoinArity=_321;
+}
+return _31f;
+};
+dojo.lang.extend(dojo.event.MethodJoinPoint,{squelch:false,unintercept:function(){
+this.object[this.methodname]=this.methodfunc;
+this.before=[];
+this.after=[];
+this.around=[];
+},disconnect:dojo.lang.forward(&quot;unintercept&quot;),run:function(){
+var obj=this.object||dj_global;
+var args=arguments;
+var _327=[];
+for(var x=0;x&lt;args.length;x++){
+_327[x]=args[x];
+}
+var _329=function(marr){
+if(!marr){
+dojo.debug(&quot;Null argument to unrollAdvice()&quot;);
+return;
+}
+var _32b=marr[0]||dj_global;
+var _32c=marr[1];
+if(!_32b[_32c]){
+dojo.raise(&quot;function \&quot;&quot;+_32c+&quot;\&quot; does not exist on \&quot;&quot;+_32b+&quot;\&quot;&quot;);
+}
+var _32d=marr[2]||dj_global;
+var _32e=marr[3];
+var msg=marr[6];
+var _330=marr[7];
+if(_330&gt;-1){
+if(_330==0){
+return;
+}
+marr[7]--;
+}
+var _331;
+var to={args:[],jp_:this,object:obj,proceed:function(){
+return _32b[_32c].apply(_32b,to.args);
+}};
+to.args=_327;
+var _333=parseInt(marr[4]);
+var _334=((!isNaN(_333))&amp;&amp;(marr[4]!==null)&amp;&amp;(typeof marr[4]!=&quot;undefined&quot;));
+if(marr[5]){
+var rate=parseInt(marr[5]);
+var cur=new Date();
+var _337=false;
+if((marr[&quot;last&quot;])&amp;&amp;((cur-marr.last)&lt;=rate)){
+if(dojo.event._canTimeout){
+if(marr[&quot;delayTimer&quot;]){
+clearTimeout(marr.delayTimer);
+}
+var tod=parseInt(rate*2);
+var mcpy=dojo.lang.shallowCopy(marr);
+marr.delayTimer=setTimeout(function(){
+mcpy[5]=0;
+_329(mcpy);
+},tod);
+}
+return;
+}else{
+marr.last=cur;
+}
+}
+if(_32e){
+_32d[_32e].call(_32d,to);
+}else{
+if((_334)&amp;&amp;((dojo.render.html)||(dojo.render.svg))){
+dj_global[&quot;setTimeout&quot;](function(){
+if(msg){
+_32b[_32c].call(_32b,to);
+}else{
+_32b[_32c].apply(_32b,args);
+}
+},_333);
+}else{
+if(msg){
+_32b[_32c].call(_32b,to);
+}else{
+_32b[_32c].apply(_32b,args);
+}
+}
+}
+};
+var _33a=function(){
+if(this.squelch){
+try{
+return _329.apply(this,arguments);
+}
+catch(e){
+dojo.debug(e);
+}
+}else{
+return _329.apply(this,arguments);
+}
+};
+if((this[&quot;before&quot;])&amp;&amp;(this.before.length&gt;0)){
+dojo.lang.forEach(this.before.concat(new Array()),_33a);
+}
+var _33b;
+try{
+if((this[&quot;around&quot;])&amp;&amp;(this.around.length&gt;0)){
+var mi=new dojo.event.MethodInvocation(this,obj,args);
+_33b=mi.proceed();
+}else{
+if(this.methodfunc){
+_33b=this.object[this.methodname].apply(this.object,args);
+}
+}
+}
+catch(e){
+if(!this.squelch){
+dojo.debug(e,&quot;when calling&quot;,this.methodname,&quot;on&quot;,this.object,&quot;with arguments&quot;,args);
+dojo.raise(e);
+}
+}
+if((this[&quot;after&quot;])&amp;&amp;(this.after.length&gt;0)){
+dojo.lang.forEach(this.after.concat(new Array()),_33a);
+}
+return (this.methodfunc)?_33b:null;
+},getArr:function(kind){
+var type=&quot;after&quot;;
+if((typeof kind==&quot;string&quot;)&amp;&amp;(kind.indexOf(&quot;before&quot;)!=-1)){
+type=&quot;before&quot;;
+}else{
+if(kind==&quot;around&quot;){
+type=&quot;around&quot;;
+}
+}
+if(!this[type]){
+this[type]=[];
+}
+return this[type];
+},kwAddAdvice:function(args){
+this.addAdvice(args[&quot;adviceObj&quot;],args[&quot;adviceFunc&quot;],args[&quot;aroundObj&quot;],args[&quot;aroundFunc&quot;],args[&quot;adviceType&quot;],args[&quot;precedence&quot;],args[&quot;once&quot;],args[&quot;delay&quot;],args[&quot;rate&quot;],args[&quot;adviceMsg&quot;],args[&quot;maxCalls&quot;]);
+},addAdvice:function(_340,_341,_342,_343,_344,_345,once,_347,rate,_349,_34a){
+var arr=this.getArr(_344);
+if(!arr){
+dojo.raise(&quot;bad this: &quot;+this);
+}
+var ao=[_340,_341,_342,_343,_347,rate,_349,_34a];
+if(once){
+if(this.hasAdvice(_340,_341,_344,arr)&gt;=0){
+return;
+}
+}
+if(_345==&quot;first&quot;){
+arr.unshift(ao);
+}else{
+arr.push(ao);
+}
+},hasAdvice:function(_34d,_34e,_34f,arr){
+if(!arr){
+arr=this.getArr(_34f);
+}
+var ind=-1;
+for(var x=0;x&lt;arr.length;x++){
+var aao=(typeof _34e==&quot;object&quot;)?(new String(_34e)).toString():_34e;
+var a1o=(typeof arr[x][1]==&quot;object&quot;)?(new String(arr[x][1])).toString():arr[x][1];
+if((arr[x][0]==_34d)&amp;&amp;(a1o==aao)){
+ind=x;
+}
+}
+return ind;
+},removeAdvice:function(_355,_356,_357,once){
+var arr=this.getArr(_357);
+var ind=this.hasAdvice(_355,_356,_357,arr);
+if(ind==-1){
+return false;
+}
+while(ind!=-1){
+arr.splice(ind,1);
+if(once){
+break;
+}
+ind=this.hasAdvice(_355,_356,_357,arr);
+}
+return true;
+}});
+dojo.provide(&quot;dojo.event.topic&quot;);
+dojo.event.topic=new function(){
+this.topics={};
+this.getTopic=function(_35b){
+if(!this.topics[_35b]){
+this.topics[_35b]=new this.TopicImpl(_35b);
+}
+return this.topics[_35b];
+};
+this.registerPublisher=function(_35c,obj,_35e){
+var _35c=this.getTopic(_35c);
+_35c.registerPublisher(obj,_35e);
+};
+this.subscribe=function(_35f,obj,_361){
+var _35f=this.getTopic(_35f);
+_35f.subscribe(obj,_361);
+};
+this.unsubscribe=function(_362,obj,_364){
+var _362=this.getTopic(_362);
+_362.unsubscribe(obj,_364);
+};
+this.destroy=function(_365){
+this.getTopic(_365).destroy();
+delete this.topics[_365];
+};
+this.publishApply=function(_366,args){
+var _366=this.getTopic(_366);
+_366.sendMessage.apply(_366,args);
+};
+this.publish=function(_368,_369){
+var _368=this.getTopic(_368);
+var args=[];
+for(var x=1;x&lt;arguments.length;x++){
+args.push(arguments[x]);
+}
+_368.sendMessage.apply(_368,args);
+};
+};
+dojo.event.topic.TopicImpl=function(_36c){
+this.topicName=_36c;
+this.subscribe=function(_36d,_36e){
+var tf=_36e||_36d;
+var to=(!_36e)?dj_global:_36d;
+return dojo.event.kwConnect({srcObj:this,srcFunc:&quot;sendMessage&quot;,adviceObj:to,adviceFunc:tf});
+};
+this.unsubscribe=function(_371,_372){
+var tf=(!_372)?_371:_372;
+var to=(!_372)?null:_371;
+return dojo.event.kwDisconnect({srcObj:this,srcFunc:&quot;sendMessage&quot;,adviceObj:to,adviceFunc:tf});
+};
+this._getJoinPoint=function(){
+return dojo.event.MethodJoinPoint.getForMethod(this,&quot;sendMessage&quot;);
+};
+this.setSquelch=function(_375){
+this._getJoinPoint().squelch=_375;
+};
+this.destroy=function(){
+this._getJoinPoint().disconnect();
+};
+this.registerPublisher=function(_376,_377){
+dojo.event.connect(_376,_377,this,&quot;sendMessage&quot;);
+};
+this.sendMessage=function(_378){
+};
+};
+dojo.provide(&quot;dojo.event.browser&quot;);
+dojo._ie_clobber=new function(){
+this.clobberNodes=[];
+function nukeProp(node,prop){
+try{
+node[prop]=null;
+}
+catch(e){
+}
+try{
+delete node[prop];
+}
+catch(e){
+}
+try{
+node.removeAttribute(prop);
+}
+catch(e){
+}
+}
+this.clobber=function(_37b){
+var na;
+var tna;
+if(_37b){
+tna=_37b.all||_37b.getElementsByTagName(&quot;*&quot;);
+na=[_37b];
+for(var x=0;x&lt;tna.length;x++){
+if(tna[x][&quot;__doClobber__&quot;]){
+na.push(tna[x]);
+}
+}
+}else{
+try{
+window.onload=null;
+}
+catch(e){
+}
+na=(this.clobberNodes.length)?this.clobberNodes:document.all;
+}
+tna=null;
+var _37f={};
+for(var i=na.length-1;i&gt;=0;i=i-1){
+var el=na[i];
+try{
+if(el&amp;&amp;el[&quot;__clobberAttrs__&quot;]){
+for(var j=0;j&lt;el.__clobberAttrs__.length;j++){
+nukeProp(el,el.__clobberAttrs__[j]);
+}
+nukeProp(el,&quot;__clobberAttrs__&quot;);
+nukeProp(el,&quot;__doClobber__&quot;);
+}
+}
+catch(e){
+}
+}
+na=null;
+};
+};
+if(dojo.render.html.ie){
+dojo.addOnUnload(function(){
+dojo._ie_clobber.clobber();
+try{
+if((dojo[&quot;widget&quot;])&amp;&amp;(dojo.widget[&quot;manager&quot;])){
+dojo.widget.manager.destroyAll();
+}
+}
+catch(e){
+}
+if(dojo.widget){
+for(var name in dojo.widget._templateCache){
+if(dojo.widget._templateCache[name].node){
+dojo.dom.destroyNode(dojo.widget._templateCache[name].node);
+dojo.widget._templateCache[name].node=null;
+delete dojo.widget._templateCache[name].node;
+}
+}
+}
+try{
+window.onload=null;
+}
+catch(e){
+}
+try{
+window.onunload=null;
+}
+catch(e){
+}
+dojo._ie_clobber.clobberNodes=[];
+});
+}
+dojo.event.browser=new function(){
+var _384=0;
+this.normalizedEventName=function(_385){
+switch(_385){
+case &quot;CheckboxStateChange&quot;:
+case &quot;DOMAttrModified&quot;:
+case &quot;DOMMenuItemActive&quot;:
+case &quot;DOMMenuItemInactive&quot;:
+case &quot;DOMMouseScroll&quot;:
+case &quot;DOMNodeInserted&quot;:
+case &quot;DOMNodeRemoved&quot;:
+case &quot;RadioStateChange&quot;:
+return _385;
+break;
+default:
+var lcn=_385.toLowerCase();
+return (lcn.indexOf(&quot;on&quot;)==0)?lcn.substr(2):lcn;
+break;
+}
+};
+this.clean=function(node){
+if(dojo.render.html.ie){
+dojo._ie_clobber.clobber(node);
+}
+};
+this.addClobberNode=function(node){
+if(!dojo.render.html.ie){
+return;
+}
+if(!node[&quot;__doClobber__&quot;]){
+node.__doClobber__=true;
+dojo._ie_clobber.clobberNodes.push(node);
+node.__clobberAttrs__=[];
+}
+};
+this.addClobberNodeAttrs=function(node,_38a){
+if(!dojo.render.html.ie){
+return;
+}
+this.addClobberNode(node);
+for(var x=0;x&lt;_38a.length;x++){
+node.__clobberAttrs__.push(_38a[x]);
+}
+};
+this.removeListener=function(node,_38d,fp,_38f){
+if(!_38f){
+var _38f=false;
+}
+_38d=dojo.event.browser.normalizedEventName(_38d);
+if(_38d==&quot;key&quot;){
+if(dojo.render.html.ie){
+this.removeListener(node,&quot;onkeydown&quot;,fp,_38f);
+}
+_38d=&quot;keypress&quot;;
+}
+if(node.removeEventListener){
+node.removeEventListener(_38d,fp,_38f);
+}
+};
+this.addListener=function(node,_391,fp,_393,_394){
+if(!node){
+return;
+}
+if(!_393){
+var _393=false;
+}
+_391=dojo.event.browser.normalizedEventName(_391);
+if(_391==&quot;key&quot;){
+if(dojo.render.html.ie){
+this.addListener(node,&quot;onkeydown&quot;,fp,_393,_394);
+}
+_391=&quot;keypress&quot;;
+}
+if(!_394){
+var _395=function(evt){
+if(!evt){
+evt=window.event;
+}
+var ret=fp(dojo.event.browser.fixEvent(evt,this));
+if(_393){
+dojo.event.browser.stopEvent(evt);
+}
+return ret;
+};
+}else{
+_395=fp;
+}
+if(node.addEventListener){
+node.addEventListener(_391,_395,_393);
+return _395;
+}else{
+_391=&quot;on&quot;+_391;
+if(typeof node[_391]==&quot;function&quot;){
+var _398=node[_391];
+node[_391]=function(e){
+_398(e);
+return _395(e);
+};
+}else{
+node[_391]=_395;
+}
+if(dojo.render.html.ie){
+this.addClobberNodeAttrs(node,[_391]);
+}
+return _395;
+}
+};
+this.isEvent=function(obj){
+return (typeof obj!=&quot;undefined&quot;)&amp;&amp;(obj)&amp;&amp;(typeof Event!=&quot;undefined&quot;)&amp;&amp;(obj.eventPhase);
+};
+this.currentEvent=null;
+this.callListener=function(_39b,_39c){
+if(typeof _39b!=&quot;function&quot;){
+dojo.raise(&quot;listener not a function: &quot;+_39b);
+}
+dojo.event.browser.currentEvent.currentTarget=_39c;
+return _39b.call(_39c,dojo.event.browser.currentEvent);
+};
+this._stopPropagation=function(){
+dojo.event.browser.currentEvent.cancelBubble=true;
+};
+this._preventDefault=function(){
+dojo.event.browser.currentEvent.returnValue=false;
+};
+this.keys={KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_HELP:47,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_NUMPAD_MULTIPLY:106,KEY_NUMPAD_PLUS:107,KEY_NUMPAD_ENTER:108,KEY_NUMPAD_MINUS:109,KEY_NUMPAD_PERIOD:110,KEY_NUMPAD_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145};
+this.revKeys=[];
+for(var key in this.keys){
+this.revKeys[this.keys[key]]=key;
+}
+this.fixEvent=function(evt,_39f){
+if(!evt){
+if(window[&quot;event&quot;]){
+evt=window.event;
+}
+}
+if((evt[&quot;type&quot;])&amp;&amp;(evt[&quot;type&quot;].indexOf(&quot;key&quot;)==0)){
+evt.keys=this.revKeys;
+for(var key in this.keys){
+evt[key]=this.keys[key];
+}
+if(evt[&quot;type&quot;]==&quot;keydown&quot;&amp;&amp;dojo.render.html.ie){
+switch(evt.keyCode){
+case evt.KEY_SHIFT:
+case evt.KEY_CTRL:
+case evt.KEY_ALT:
+case evt.KEY_CAPS_LOCK:
+case evt.KEY_LEFT_WINDOW:
+case evt.KEY_RIGHT_WINDOW:
+case evt.KEY_SELECT:
+case evt.KEY_NUM_LOCK:
+case evt.KEY_SCROLL_LOCK:
+case evt.KEY_NUMPAD_0:
+case evt.KEY_NUMPAD_1:
+case evt.KEY_NUMPAD_2:
+case evt.KEY_NUMPAD_3:
+case evt.KEY_NUMPAD_4:
+case evt.KEY_NUMPAD_5:
+case evt.KEY_NUMPAD_6:
+case evt.KEY_NUMPAD_7:
+case evt.KEY_NUMPAD_8:
+case evt.KEY_NUMPAD_9:
+case evt.KEY_NUMPAD_PERIOD:
+break;
+case evt.KEY_NUMPAD_MULTIPLY:
+case evt.KEY_NUMPAD_PLUS:
+case evt.KEY_NUMPAD_ENTER:
+case evt.KEY_NUMPAD_MINUS:
+case evt.KEY_NUMPAD_DIVIDE:
+break;
+case evt.KEY_PAUSE:
+case evt.KEY_TAB:
+case evt.KEY_BACKSPACE:
+case evt.KEY_ENTER:
+case evt.KEY_ESCAPE:
+case evt.KEY_PAGE_UP:
+case evt.KEY_PAGE_DOWN:
+case evt.KEY_END:
+case evt.KEY_HOME:
+case evt.KEY_LEFT_ARROW:
+case evt.KEY_UP_ARROW:
+case evt.KEY_RIGHT_ARROW:
+case evt.KEY_DOWN_ARROW:
+case evt.KEY_INSERT:
+case evt.KEY_DELETE:
+case evt.KEY_F1:
+case evt.KEY_F2:
+case evt.KEY_F3:
+case evt.KEY_F4:
+case evt.KEY_F5:
+case evt.KEY_F6:
+case evt.KEY_F7:
+case evt.KEY_F8:
+case evt.KEY_F9:
+case evt.KEY_F10:
+case evt.KEY_F11:
+case evt.KEY_F12:
+case evt.KEY_F12:
+case evt.KEY_F13:
+case evt.KEY_F14:
+case evt.KEY_F15:
+case evt.KEY_CLEAR:
+case evt.KEY_HELP:
+evt.key=evt.keyCode;
+break;
+default:
+if(evt.ctrlKey||evt.altKey){
+var _3a1=evt.keyCode;
+if(_3a1&gt;=65&amp;&amp;_3a1&lt;=90&amp;&amp;evt.shiftKey==false){
+_3a1+=32;
+}
+if(_3a1&gt;=1&amp;&amp;_3a1&lt;=26&amp;&amp;evt.ctrlKey){
+_3a1+=96;
+}
+evt.key=String.fromCharCode(_3a1);
+}
+}
+}else{
+if(evt[&quot;type&quot;]==&quot;keypress&quot;){
+if(dojo.render.html.opera){
+if(evt.which==0){
+evt.key=evt.keyCode;
+}else{
+if(evt.which&gt;0){
+switch(evt.which){
+case evt.KEY_SHIFT:
+case evt.KEY_CTRL:
+case evt.KEY_ALT:
+case evt.KEY_CAPS_LOCK:
+case evt.KEY_NUM_LOCK:
+case evt.KEY_SCROLL_LOCK:
+break;
+case evt.KEY_PAUSE:
+case evt.KEY_TAB:
+case evt.KEY_BACKSPACE:
+case evt.KEY_ENTER:
+case evt.KEY_ESCAPE:
+evt.key=evt.which;
+break;
+default:
+var _3a1=evt.which;
+if((evt.ctrlKey||evt.altKey||evt.metaKey)&amp;&amp;(evt.which&gt;=65&amp;&amp;evt.which&lt;=90&amp;&amp;evt.shiftKey==false)){
+_3a1+=32;
+}
+evt.key=String.fromCharCode(_3a1);
+}
+}
+}
+}else{
+if(dojo.render.html.ie){
+if(!evt.ctrlKey&amp;&amp;!evt.altKey&amp;&amp;evt.keyCode&gt;=evt.KEY_SPACE){
+evt.key=String.fromCharCode(evt.keyCode);
+}
+}else{
+if(dojo.render.html.safari){
+switch(evt.keyCode){
+case 25:
+evt.key=evt.KEY_TAB;
+evt.shift=true;
+break;
+case 63232:
+evt.key=evt.KEY_UP_ARROW;
+break;
+case 63233:
+evt.key=evt.KEY_DOWN_ARROW;
+break;
+case 63234:
+evt.key=evt.KEY_LEFT_ARROW;
+break;
+case 63235:
+evt.key=evt.KEY_RIGHT_ARROW;
+break;
+case 63236:
+evt.key=evt.KEY_F1;
+break;
+case 63237:
+evt.key=evt.KEY_F2;
+break;
+case 63238:
+evt.key=evt.KEY_F3;
+break;
+case 63239:
+evt.key=evt.KEY_F4;
+break;
+case 63240:
+evt.key=evt.KEY_F5;
+break;
+case 63241:
+evt.key=evt.KEY_F6;
+break;
+case 63242:
+evt.key=evt.KEY_F7;
+break;
+case 63243:
+evt.key=evt.KEY_F8;
+break;
+case 63244:
+evt.key=evt.KEY_F9;
+break;
+case 63245:
+evt.key=evt.KEY_F10;
+break;
+case 63246:
+evt.key=evt.KEY_F11;
+break;
+case 63247:
+evt.key=evt.KEY_F12;
+break;
+case 63250:
+evt.key=evt.KEY_PAUSE;
+break;
+case 63272:
+evt.key=evt.KEY_DELETE;
+break;
+case 63273:
+evt.key=evt.KEY_HOME;
+break;
+case 63275:
+evt.key=evt.KEY_END;
+break;
+case 63276:
+evt.key=evt.KEY_PAGE_UP;
+break;
+case 63277:
+evt.key=evt.KEY_PAGE_DOWN;
+break;
+case 63302:
+evt.key=evt.KEY_INSERT;
+break;
+case 63248:
+case 63249:
+case 63289:
+break;
+default:
+evt.key=evt.charCode&gt;=evt.KEY_SPACE?String.fromCharCode(evt.charCode):evt.keyCode;
+}
+}else{
+evt.key=evt.charCode&gt;0?String.fromCharCode(evt.charCode):evt.keyCode;
+}
+}
+}
+}
+}
+}
+if(dojo.render.html.ie){
+if(!evt.target){
+evt.target=evt.srcElement;
+}
+if(!evt.currentTarget){
+evt.currentTarget=(_39f?_39f:evt.srcElement);
+}
+if(!evt.layerX){
+evt.layerX=evt.offsetX;
+}
+if(!evt.layerY){
+evt.layerY=evt.offsetY;
+}
+var doc=(evt.srcElement&amp;&amp;evt.srcElement.ownerDocument)?evt.srcElement.ownerDocument:document;
+var _3a3=((dojo.render.html.ie55)||(doc[&quot;compatMode&quot;]==&quot;BackCompat&quot;))?doc.body:doc.documentElement;
+if(!evt.pageX){
+evt.pageX=evt.clientX+(_3a3.scrollLeft||0);
+}
+if(!evt.pageY){
+evt.pageY=evt.clientY+(_3a3.scrollTop||0);
+}
+if(evt.type==&quot;mouseover&quot;){
+evt.relatedTarget=evt.fromElement;
+}
+if(evt.type==&quot;mouseout&quot;){
+evt.relatedTarget=evt.toElement;
+}
+this.currentEvent=evt;
+evt.callListener=this.callListener;
+evt.stopPropagation=this._stopPropagation;
+evt.preventDefault=this._preventDefault;
+}
+return evt;
+};
+this.stopEvent=function(evt){
+if(window.event){
+evt.cancelBubble=true;
+evt.returnValue=false;
+}else{
+evt.preventDefault();
+evt.stopPropagation();
+}
+};
+};
+dojo.kwCompoundRequire({common:[&quot;dojo.event.common&quot;,&quot;dojo.event.topic&quot;],browser:[&quot;dojo.event.browser&quot;],dashboard:[&quot;dojo.event.browser&quot;]});
+dojo.provide(&quot;dojo.event.*&quot;);
+dojo.provide(&quot;dojo.gfx.color&quot;);
+dojo.gfx.color.Color=function(r,g,b,a){
+if(dojo.lang.isArray(r)){
+this.r=r[0];
+this.g=r[1];
+this.b=r[2];
+this.a=r[3]||1;
+}else{
+if(dojo.lang.isString(r)){
+var rgb=dojo.gfx.color.extractRGB(r);
+this.r=rgb[0];
+this.g=rgb[1];
+this.b=rgb[2];
+this.a=g||1;
+}else{
+if(r instanceof dojo.gfx.color.Color){
+this.r=r.r;
+this.b=r.b;
+this.g=r.g;
+this.a=r.a;
+}else{
+this.r=r;
+this.g=g;
+this.b=b;
+this.a=a;
+}
+}
+}
+};
+dojo.gfx.color.Color.fromArray=function(arr){
+return new dojo.gfx.color.Color(arr[0],arr[1],arr[2],arr[3]);
+};
+dojo.extend(dojo.gfx.color.Color,{toRgb:function(_3ab){
+if(_3ab){
+return this.toRgba();
+}else{
+return [this.r,this.g,this.b];
+}
+},toRgba:function(){
+return [this.r,this.g,this.b,this.a];
+},toHex:function(){
+return dojo.gfx.color.rgb2hex(this.toRgb());
+},toCss:function(){
+return &quot;rgb(&quot;+this.toRgb().join()+&quot;)&quot;;
+},toString:function(){
+return this.toHex();
+},blend:function(_3ac,_3ad){
+var rgb=null;
+if(dojo.lang.isArray(_3ac)){
+rgb=_3ac;
+}else{
+if(_3ac instanceof dojo.gfx.color.Color){
+rgb=_3ac.toRgb();
+}else{
+rgb=new dojo.gfx.color.Color(_3ac).toRgb();
+}
+}
+return dojo.gfx.color.blend(this.toRgb(),rgb,_3ad);
+}});
+dojo.gfx.color.named={white:[255,255,255],black:[0,0,0],red:[255,0,0],green:[0,255,0],lime:[0,255,0],blue:[0,0,255],navy:[0,0,128],gray:[128,128,128],silver:[192,192,192]};
+dojo.gfx.color.blend=function(a,b,_3b1){
+if(typeof a==&quot;string&quot;){
+return dojo.gfx.color.blendHex(a,b,_3b1);
+}
+if(!_3b1){
+_3b1=0;
+}
+_3b1=Math.min(Math.max(-1,_3b1),1);
+_3b1=((_3b1+1)/2);
+var c=[];
+for(var x=0;x&lt;3;x++){
+c[x]=parseInt(b[x]+((a[x]-b[x])*_3b1));
+}
+return c;
+};
+dojo.gfx.color.blendHex=function(a,b,_3b6){
+return dojo.gfx.color.rgb2hex(dojo.gfx.color.blend(dojo.gfx.color.hex2rgb(a),dojo.gfx.color.hex2rgb(b),_3b6));
+};
+dojo.gfx.color.extractRGB=function(_3b7){
+var hex=&quot;0123456789abcdef&quot;;
+_3b7=_3b7.toLowerCase();
+if(_3b7.indexOf(&quot;rgb&quot;)==0){
+var _3b9=_3b7.match(/rgba*\((\d+), *(\d+), *(\d+)/i);
+var ret=_3b9.splice(1,3);
+return ret;
+}else{
+var _3bb=dojo.gfx.color.hex2rgb(_3b7);
+if(_3bb){
+return _3bb;
+}else{
+return dojo.gfx.color.named[_3b7]||[255,255,255];
+}
+}
+};
+dojo.gfx.color.hex2rgb=function(hex){
+var _3bd=&quot;0123456789ABCDEF&quot;;
+var rgb=new Array(3);
+if(hex.indexOf(&quot;#&quot;)==0){
+hex=hex.substring(1);
+}
+hex=hex.toUpperCase();
+if(hex.replace(new RegExp(&quot;[&quot;+_3bd+&quot;]&quot;,&quot;g&quot;),&quot;&quot;)!=&quot;&quot;){
+return null;
+}
+if(hex.length==3){
+rgb[0]=hex.charAt(0)+hex.charAt(0);
+rgb[1]=hex.charAt(1)+hex.charAt(1);
+rgb[2]=hex.charAt(2)+hex.charAt(2);
+}else{
+rgb[0]=hex.substring(0,2);
+rgb[1]=hex.substring(2,4);
+rgb[2]=hex.substring(4);
+}
+for(var i=0;i&lt;rgb.length;i++){
+rgb[i]=_3bd.indexOf(rgb[i].charAt(0))*16+_3bd.indexOf(rgb[i].charAt(1));
+}
+return rgb;
+};
+dojo.gfx.color.rgb2hex=function(r,g,b){
+if(dojo.lang.isArray(r)){
+g=r[1]||0;
+b=r[2]||0;
+r=r[0]||0;
+}
+var ret=dojo.lang.map([r,g,b],function(x){
+x=new Number(x);
+var s=x.toString(16);
+while(s.length&lt;2){
+s=&quot;0&quot;+s;
+}
+return s;
+});
+ret.unshift(&quot;#&quot;);
+return ret.join(&quot;&quot;);
+};
+dojo.provide(&quot;dojo.lfx.Animation&quot;);
+dojo.lfx.Line=function(_3c6,end){
+this.start=_3c6;
+this.end=end;
+if(dojo.lang.isArray(_3c6)){
+var diff=[];
+dojo.lang.forEach(this.start,function(s,i){
+diff[i]=this.end[i]-s;
+},this);
+this.getValue=function(n){
+var res=[];
+dojo.lang.forEach(this.start,function(s,i){
+res[i]=(diff[i]*n)+s;
+},this);
+return res;
+};
+}else{
+var diff=end-_3c6;
+this.getValue=function(n){
+return (diff*n)+this.start;
+};
+}
+};
+if((dojo.render.html.khtml)&amp;&amp;(!dojo.render.html.safari)){
+dojo.lfx.easeDefault=function(n){
+return (parseFloat(&quot;0.5&quot;)+((Math.sin((n+parseFloat(&quot;1.5&quot;))*Math.PI))/2));
+};
+}else{
+dojo.lfx.easeDefault=function(n){
+return (0.5+((Math.sin((n+1.5)*Math.PI))/2));
+};
+}
+dojo.lfx.easeIn=function(n){
+return Math.pow(n,3);
+};
+dojo.lfx.easeOut=function(n){
+return (1-Math.pow(1-n,3));
+};
+dojo.lfx.easeInOut=function(n){
+return ((3*Math.pow(n,2))-(2*Math.pow(n,3)));
+};
+dojo.lfx.IAnimation=function(){
+};
+dojo.lang.extend(dojo.lfx.IAnimation,{curve:null,duration:1000,easing:null,repeatCount:0,rate:10,handler:null,beforeBegin:null,onBegin:null,onAnimate:null,onEnd:null,onPlay:null,onPause:null,onStop:null,play:null,pause:null,stop:null,connect:function(evt,_3d6,_3d7){
+if(!_3d7){
+_3d7=_3d6;
+_3d6=this;
+}
+_3d7=dojo.lang.hitch(_3d6,_3d7);
+var _3d8=this[evt]||function(){
+};
+this[evt]=function(){
+var ret=_3d8.apply(this,arguments);
+_3d7.apply(this,arguments);
+return ret;
+};
+return this;
+},fire:function(evt,args){
+if(this[evt]){
+this[evt].apply(this,(args||[]));
+}
+return this;
+},repeat:function(_3dc){
+this.repeatCount=_3dc;
+return this;
+},_active:false,_paused:false});
+dojo.lfx.Animation=function(_3dd,_3de,_3df,_3e0,_3e1,rate){
+dojo.lfx.IAnimation.call(this);
+if(dojo.lang.isNumber(_3dd)||(!_3dd&amp;&amp;_3de.getValue)){
+rate=_3e1;
+_3e1=_3e0;
+_3e0=_3df;
+_3df=_3de;
+_3de=_3dd;
+_3dd=null;
+}else{
+if(_3dd.getValue||dojo.lang.isArray(_3dd)){
+rate=_3e0;
+_3e1=_3df;
+_3e0=_3de;
+_3df=_3dd;
+_3de=null;
+_3dd=null;
+}
+}
+if(dojo.lang.isArray(_3df)){
+this.curve=new dojo.lfx.Line(_3df[0],_3df[1]);
+}else{
+this.curve=_3df;
+}
+if(_3de!=null&amp;&amp;_3de&gt;0){
+this.duration=_3de;
+}
+if(_3e1){
+this.repeatCount=_3e1;
+}
+if(rate){
+this.rate=rate;
+}
+if(_3dd){
+dojo.lang.forEach([&quot;handler&quot;,&quot;beforeBegin&quot;,&quot;onBegin&quot;,&quot;onEnd&quot;,&quot;onPlay&quot;,&quot;onStop&quot;,&quot;onAnimate&quot;],function(item){
+if(_3dd[item]){
+this.connect(item,_3dd[item]);
+}
+},this);
+}
+if(_3e0&amp;&amp;dojo.lang.isFunction(_3e0)){
+this.easing=_3e0;
+}
+};
+dojo.inherits(dojo.lfx.Animation,dojo.lfx.IAnimation);
+dojo.lang.extend(dojo.lfx.Animation,{_startTime:null,_endTime:null,_timer:null,_percent:0,_startRepeatCount:0,play:function(_3e4,_3e5){
+if(_3e5){
+clearTimeout(this._timer);
+this._active=false;
+this._paused=false;
+this._percent=0;
+}else{
+if(this._active&amp;&amp;!this._paused){
+return this;
+}
+}
+this.fire(&quot;handler&quot;,[&quot;beforeBegin&quot;]);
+this.fire(&quot;beforeBegin&quot;);
+if(_3e4&gt;0){
+setTimeout(dojo.lang.hitch(this,function(){
+this.play(null,_3e5);
+}),_3e4);
+return this;
+}
+this._startTime=new Date().valueOf();
+if(this._paused){
+this._startTime-=(this.duration*this._percent/100);
+}
+this._endTime=this._startTime+this.duration;
+this._active=true;
+this._paused=false;
+var step=this._percent/100;
+var _3e7=this.curve.getValue(step);
+if(this._percent==0){
+if(!this._startRepeatCount){
+this._startRepeatCount=this.repeatCount;
+}
+this.fire(&quot;handler&quot;,[&quot;begin&quot;,_3e7]);
+this.fire(&quot;onBegin&quot;,[_3e7]);
+}
+this.fire(&quot;handler&quot;,[&quot;play&quot;,_3e7]);
+this.fire(&quot;onPlay&quot;,[_3e7]);
+this._cycle();
+return this;
+},pause:function(){
+clearTimeout(this._timer);
+if(!this._active){
+return this;
+}
+this._paused=true;
+var _3e8=this.curve.getValue(this._percent/100);
+this.fire(&quot;handler&quot;,[&quot;pause&quot;,_3e8]);
+this.fire(&quot;onPause&quot;,[_3e8]);
+return this;
+},gotoPercent:function(pct,_3ea){
+clearTimeout(this._timer);
+this._active=true;
+this._paused=true;
+this._percent=pct;
+if(_3ea){
+this.play();
+}
+return this;
+},stop:function(_3eb){
+clearTimeout(this._timer);
+var step=this._percent/100;
+if(_3eb){
+step=1;
+}
+var _3ed=this.curve.getValue(step);
+this.fire(&quot;handler&quot;,[&quot;stop&quot;,_3ed]);
+this.fire(&quot;onStop&quot;,[_3ed]);
+this._active=false;
+this._paused=false;
+return this;
+},status:function(){
+if(this._active){
+return this._paused?&quot;paused&quot;:&quot;playing&quot;;
+}else{
+return &quot;stopped&quot;;
+}
+return this;
+},_cycle:function(){
+clearTimeout(this._timer);
+if(this._active){
+var curr=new Date().valueOf();
+var step=(curr-this._startTime)/(this._endTime-this._startTime);
+if(step&gt;=1){
+step=1;
+this._percent=100;
+}else{
+this._percent=step*100;
+}
+if((this.easing)&amp;&amp;(dojo.lang.isFunction(this.easing))){
+step=this.easing(step);
+}
+var _3f0=this.curve.getValue(step);
+this.fire(&quot;handler&quot;,[&quot;animate&quot;,_3f0]);
+this.fire(&quot;onAnimate&quot;,[_3f0]);
+if(step&lt;1){
+this._timer=setTimeout(dojo.lang.hitch(this,&quot;_cycle&quot;),this.rate);
+}else{
+this._active=false;
+this.fire(&quot;handler&quot;,[&quot;end&quot;]);
+this.fire(&quot;onEnd&quot;);
+if(this.repeatCount&gt;0){
+this.repeatCount--;
+this.play(null,true);
+}else{
+if(this.repeatCount==-1){
+this.play(null,true);
+}else{
+if(this._startRepeatCount){
+this.repeatCount=this._startRepeatCount;
+this._startRepeatCount=0;
+}
+}
+}
+}
+}
+return this;
+}});
+dojo.lfx.Combine=function(_3f1){
+dojo.lfx.IAnimation.call(this);
+this._anims=[];
+this._animsEnded=0;
+var _3f2=arguments;
+if(_3f2.length==1&amp;&amp;(dojo.lang.isArray(_3f2[0])||dojo.lang.isArrayLike(_3f2[0]))){
+_3f2=_3f2[0];
+}
+dojo.lang.forEach(_3f2,function(anim){
+this._anims.push(anim);
+anim.connect(&quot;onEnd&quot;,dojo.lang.hitch(this,&quot;_onAnimsEnded&quot;));
+},this);
+};
+dojo.inherits(dojo.lfx.Combine,dojo.lfx.IAnimation);
+dojo.lang.extend(dojo.lfx.Combine,{_animsEnded:0,play:function(_3f4,_3f5){
+if(!this._anims.length){
+return this;
+}
+this.fire(&quot;beforeBegin&quot;);
+if(_3f4&gt;0){
+setTimeout(dojo.lang.hitch(this,function(){
+this.play(null,_3f5);
+}),_3f4);
+return this;
+}
+if(_3f5||this._anims[0].percent==0){
+this.fire(&quot;onBegin&quot;);
+}
+this.fire(&quot;onPlay&quot;);
+this._animsCall(&quot;play&quot;,null,_3f5);
+return this;
+},pause:function(){
+this.fire(&quot;onPause&quot;);
+this._animsCall(&quot;pause&quot;);
+return this;
+},stop:function(_3f6){
+this.fire(&quot;onStop&quot;);
+this._animsCall(&quot;stop&quot;,_3f6);
+return this;
+},_onAnimsEnded:function(){
+this._animsEnded++;
+if(this._animsEnded&gt;=this._anims.length){
+this.fire(&quot;onEnd&quot;);
+}
+return this;
+},_animsCall:function(_3f7){
+var args=[];
+if(arguments.length&gt;1){
+for(var i=1;i&lt;arguments.length;i++){
+args.push(arguments[i]);
+}
+}
+var _3fa=this;
+dojo.lang.forEach(this._anims,function(anim){
+anim[_3f7](args);
+},_3fa);
+return this;
+}});
+dojo.lfx.Chain=function(_3fc){
+dojo.lfx.IAnimation.call(this);
+this._anims=[];
+this._currAnim=-1;
+var _3fd=arguments;
+if(_3fd.length==1&amp;&amp;(dojo.lang.isArray(_3fd[0])||dojo.lang.isArrayLike(_3fd[0]))){
+_3fd=_3fd[0];
+}
+var _3fe=this;
+dojo.lang.forEach(_3fd,function(anim,i,_401){
+this._anims.push(anim);
+if(i&lt;_401.length-1){
+anim.connect(&quot;onEnd&quot;,dojo.lang.hitch(this,&quot;_playNext&quot;));
+}else{
+anim.connect(&quot;onEnd&quot;,dojo.lang.hitch(this,function(){
+this.fire(&quot;onEnd&quot;);
+}));
+}
+},this);
+};
+dojo.inherits(dojo.lfx.Chain,dojo.lfx.IAnimation);
+dojo.lang.extend(dojo.lfx.Chain,{_currAnim:-1,play:function(_402,_403){
+if(!this._anims.length){
+return this;
+}
+if(_403||!this._anims[this._currAnim]){
+this._currAnim=0;
+}
+var _404=this._anims[this._currAnim];
+this.fire(&quot;beforeBegin&quot;);
+if(_402&gt;0){
+setTimeout(dojo.lang.hitch(this,function(){
+this.play(null,_403);
+}),_402);
+return this;
+}
+if(_404){
+if(this._currAnim==0){
+this.fire(&quot;handler&quot;,[&quot;begin&quot;,this._currAnim]);
+this.fire(&quot;onBegin&quot;,[this._currAnim]);
+}
+this.fire(&quot;onPlay&quot;,[this._currAnim]);
+_404.play(null,_403);
+}
+return this;
+},pause:function(){
+if(this._anims[this._currAnim]){
+this._anims[this._currAnim].pause();
+this.fire(&quot;onPause&quot;,[this._currAnim]);
+}
+return this;
+},playPause:function(){
+if(this._anims.length==0){
+return this;
+}
+if(this._currAnim==-1){
+this._currAnim=0;
+}
+var _405=this._anims[this._currAnim];
+if(_405){
+if(!_405._active||_405._paused){
+this.play();
+}else{
+this.pause();
+}
+}
+return this;
+},stop:function(){
+var _406=this._anims[this._currAnim];
+if(_406){
+_406.stop();
+this.fire(&quot;onStop&quot;,[this._currAnim]);
+}
+return _406;
+},_playNext:function(){
+if(this._currAnim==-1||this._anims.length==0){
+return this;
+}
+this._currAnim++;
+if(this._anims[this._currAnim]){
+this._anims[this._currAnim].play(null,true);
+}
+return this;
+}});
+dojo.lfx.combine=function(_407){
+var _408=arguments;
+if(dojo.lang.isArray(arguments[0])){
+_408=arguments[0];
+}
+if(_408.length==1){
+return _408[0];
+}
+return new dojo.lfx.Combine(_408);
+};
+dojo.lfx.chain=function(_409){
+var _40a=arguments;
+if(dojo.lang.isArray(arguments[0])){
+_40a=arguments[0];
+}
+if(_40a.length==1){
+return _40a[0];
+}
+return new dojo.lfx.Chain(_40a);
+};
+dojo.provide(&quot;dojo.html.common&quot;);
+dojo.lang.mixin(dojo.html,dojo.dom);
+dojo.html.body=function(){
+dojo.deprecated(&quot;dojo.html.body() moved to dojo.body()&quot;,&quot;0.5&quot;);
+return dojo.body();
+};
+dojo.html.getEventTarget=function(evt){
+if(!evt){
+evt=dojo.global().event||{};
+}
+var t=(evt.srcElement?evt.srcElement:(evt.target?evt.target:null));
+while((t)&amp;&amp;(t.nodeType!=1)){
+t=t.parentNode;
+}
+return t;
+};
+dojo.html.getViewport=function(){
+var _40d=dojo.global();
+var _40e=dojo.doc();
+var w=0;
+var h=0;
+if(dojo.render.html.mozilla){
+w=_40e.documentElement.clientWidth;
+h=_40d.innerHeight;
+}else{
+if(!dojo.render.html.opera&amp;&amp;_40d.innerWidth){
+w=_40d.innerWidth;
+h=_40d.innerHeight;
+}else{
+if(!dojo.render.html.opera&amp;&amp;dojo.exists(_40e,&quot;documentElement.clientWidth&quot;)){
+var w2=_40e.documentElement.clientWidth;
+if(!w||w2&amp;&amp;w2&lt;w){
+w=w2;
+}
+h=_40e.documentElement.clientHeight;
+}else{
+if(dojo.body().clientWidth){
+w=dojo.body().clientWidth;
+h=dojo.body().clientHeight;
+}
+}
+}
+}
+return {width:w,height:h};
+};
+dojo.html.getScroll=function(){
+var _412=dojo.global();
+var _413=dojo.doc();
+var top=_412.pageYOffset||_413.documentElement.scrollTop||dojo.body().scrollTop||0;
+var left=_412.pageXOffset||_413.documentElement.scrollLeft||dojo.body().scrollLeft||0;
+return {top:top,left:left,offset:{x:left,y:top}};
+};
+dojo.html.getParentByType=function(node,type){
+var _418=dojo.doc();
+var _419=dojo.byId(node);
+type=type.toLowerCase();
+while((_419)&amp;&amp;(_419.nodeName.toLowerCase()!=type)){
+if(_419==(_418[&quot;body&quot;]||_418[&quot;documentElement&quot;])){
+return null;
+}
+_419=_419.parentNode;
+}
+return _419;
+};
+dojo.html.getAttribute=function(node,attr){
+node=dojo.byId(node);
+if((!node)||(!node.getAttribute)){
+return null;
+}
+var ta=typeof attr==&quot;string&quot;?attr:new String(attr);
+var v=node.getAttribute(ta.toUpperCase());
+if((v)&amp;&amp;(typeof v==&quot;string&quot;)&amp;&amp;(v!=&quot;&quot;)){
+return v;
+}
+if(v&amp;&amp;v.value){
+return v.value;
+}
+if((node.getAttributeNode)&amp;&amp;(node.getAttributeNode(ta))){
+return (node.getAttributeNode(ta)).value;
+}else{
+if(node.getAttribute(ta)){
+return node.getAttribute(ta);
+}else{
+if(node.getAttribute(ta.toLowerCase())){
+return node.getAttribute(ta.toLowerCase());
+}
+}
+}
+return null;
+};
+dojo.html.hasAttribute=function(node,attr){
+return dojo.html.getAttribute(dojo.byId(node),attr)?true:false;
+};
+dojo.html.getCursorPosition=function(e){
+e=e||dojo.global().event;
+var _421={x:0,y:0};
+if(e.pageX||e.pageY){
+_421.x=e.pageX;
+_421.y=e.pageY;
+}else{
+var de=dojo.doc().documentElement;
+var db=dojo.body();
+_421.x=e.clientX+((de||db)[&quot;scrollLeft&quot;])-((de||db)[&quot;clientLeft&quot;]);
+_421.y=e.clientY+((de||db)[&quot;scrollTop&quot;])-((de||db)[&quot;clientTop&quot;]);
+}
+return _421;
+};
+dojo.html.isTag=function(node){
+node=dojo.byId(node);
+if(node&amp;&amp;node.tagName){
+for(var i=1;i&lt;arguments.length;i++){
+if(node.tagName.toLowerCase()==String(arguments[i]).toLowerCase()){
+return String(arguments[i]).toLowerCase();
+}
+}
+}
+return &quot;&quot;;
+};
+if(dojo.render.html.ie&amp;&amp;!dojo.render.html.ie70){
+if(window.location.href.substr(0,6).toLowerCase()!=&quot;https:&quot;){
+(function(){
+var _426=dojo.doc().createElement(&quot;script&quot;);
+_426.src=&quot;javascript:'dojo.html.createExternalElement=function(doc, tag){ return doc.createElement(tag); }'&quot;;
+dojo.doc().getElementsByTagName(&quot;head&quot;)[0].appendChild(_426);
+})();
+}
+}else{
+dojo.html.createExternalElement=function(doc,tag){
+return doc.createElement(tag);
+};
+}
+dojo.html._callDeprecated=function(_429,_42a,args,_42c,_42d){
+dojo.deprecated(&quot;dojo.html.&quot;+_429,&quot;replaced by dojo.html.&quot;+_42a+&quot;(&quot;+(_42c?&quot;node, {&quot;+_42c+&quot;: &quot;+_42c+&quot;}&quot;:&quot;&quot;)+&quot;)&quot;+(_42d?&quot;.&quot;+_42d:&quot;&quot;),&quot;0.5&quot;);
+var _42e=[];
+if(_42c){
+var _42f={};
+_42f[_42c]=args[1];
+_42e.push(args[0]);
+_42e.push(_42f);
+}else{
+_42e=args;
+}
+var ret=dojo.html[_42a].apply(dojo.html,args);
+if(_42d){
+return ret[_42d];
+}else{
+return ret;
+}
+};
+dojo.html.getViewportWidth=function(){
+return dojo.html._callDeprecated(&quot;getViewportWidth&quot;,&quot;getViewport&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getViewportHeight=function(){
+return dojo.html._callDeprecated(&quot;getViewportHeight&quot;,&quot;getViewport&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getViewportSize=function(){
+return dojo.html._callDeprecated(&quot;getViewportSize&quot;,&quot;getViewport&quot;,arguments);
+};
+dojo.html.getScrollTop=function(){
+return dojo.html._callDeprecated(&quot;getScrollTop&quot;,&quot;getScroll&quot;,arguments,null,&quot;top&quot;);
+};
+dojo.html.getScrollLeft=function(){
+return dojo.html._callDeprecated(&quot;getScrollLeft&quot;,&quot;getScroll&quot;,arguments,null,&quot;left&quot;);
+};
+dojo.html.getScrollOffset=function(){
+return dojo.html._callDeprecated(&quot;getScrollOffset&quot;,&quot;getScroll&quot;,arguments,null,&quot;offset&quot;);
+};
+dojo.provide(&quot;dojo.uri.Uri&quot;);
+dojo.uri=new function(){
+this.dojoUri=function(uri){
+return new dojo.uri.Uri(dojo.hostenv.getBaseScriptUri(),uri);
+};
+this.moduleUri=function(_432,uri){
+var loc=dojo.hostenv.getModuleSymbols(_432).join(&quot;/&quot;);
+if(!loc){
+return null;
+}
+if(loc.lastIndexOf(&quot;/&quot;)!=loc.length-1){
+loc+=&quot;/&quot;;
+}
+var _435=loc.indexOf(&quot;:&quot;);
+var _436=loc.indexOf(&quot;/&quot;);
+if(loc.charAt(0)!=&quot;/&quot;&amp;&amp;(_435==-1||_435&gt;_436)){
+loc=dojo.hostenv.getBaseScriptUri()+loc;
+}
+return new dojo.uri.Uri(loc,uri);
+};
+this.Uri=function(){
+var uri=arguments[0];
+for(var i=1;i&lt;arguments.length;i++){
+if(!arguments[i]){
+continue;
+}
+var _439=new dojo.uri.Uri(arguments[i].toString());
+var _43a=new dojo.uri.Uri(uri.toString());
+if((_439.path==&quot;&quot;)&amp;&amp;(_439.scheme==null)&amp;&amp;(_439.authority==null)&amp;&amp;(_439.query==null)){
+if(_439.fragment!=null){
+_43a.fragment=_439.fragment;
+}
+_439=_43a;
+}else{
+if(_439.scheme==null){
+_439.scheme=_43a.scheme;
+if(_439.authority==null){
+_439.authority=_43a.authority;
+if(_439.path.charAt(0)!=&quot;/&quot;){
+var path=_43a.path.substring(0,_43a.path.lastIndexOf(&quot;/&quot;)+1)+_439.path;
+var segs=path.split(&quot;/&quot;);
+for(var j=0;j&lt;segs.length;j++){
+if(segs[j]==&quot;.&quot;){
+if(j==segs.length-1){
+segs[j]=&quot;&quot;;
+}else{
+segs.splice(j,1);
+j--;
+}
+}else{
+if(j&gt;0&amp;&amp;!(j==1&amp;&amp;segs[0]==&quot;&quot;)&amp;&amp;segs[j]==&quot;..&quot;&amp;&amp;segs[j-1]!=&quot;..&quot;){
+if(j==segs.length-1){
+segs.splice(j,1);
+segs[j-1]=&quot;&quot;;
+}else{
+segs.splice(j-1,2);
+j-=2;
+}
+}
+}
+}
+_439.path=segs.join(&quot;/&quot;);
+}
+}
+}
+}
+uri=&quot;&quot;;
+if(_439.scheme!=null){
+uri+=_439.scheme+&quot;:&quot;;
+}
+if(_439.authority!=null){
+uri+=&quot;//&quot;+_439.authority;
+}
+uri+=_439.path;
+if(_439.query!=null){
+uri+=&quot;?&quot;+_439.query;
+}
+if(_439.fragment!=null){
+uri+=&quot;#&quot;+_439.fragment;
+}
+}
+this.uri=uri.toString();
+var _43e=&quot;^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$&quot;;
+var r=this.uri.match(new RegExp(_43e));
+this.scheme=r[2]||(r[1]?&quot;&quot;:null);
+this.authority=r[4]||(r[3]?&quot;&quot;:null);
+this.path=r[5];
+this.query=r[7]||(r[6]?&quot;&quot;:null);
+this.fragment=r[9]||(r[8]?&quot;&quot;:null);
+if(this.authority!=null){
+_43e=&quot;^((([^:]+:)?([^@]+))@)?([^:]*)(:([0-9]+))?$&quot;;
+r=this.authority.match(new RegExp(_43e));
+this.user=r[3]||null;
+this.password=r[4]||null;
+this.host=r[5];
+this.port=r[7]||null;
+}
+this.toString=function(){
+return this.uri;
+};
+};
+};
+dojo.provide(&quot;dojo.html.style&quot;);
+dojo.html.getClass=function(node){
+node=dojo.byId(node);
+if(!node){
+return &quot;&quot;;
+}
+var cs=&quot;&quot;;
+if(node.className){
+cs=node.className;
+}else{
+if(dojo.html.hasAttribute(node,&quot;class&quot;)){
+cs=dojo.html.getAttribute(node,&quot;class&quot;);
+}
+}
+return cs.replace(/^\s+|\s+$/g,&quot;&quot;);
+};
+dojo.html.getClasses=function(node){
+var c=dojo.html.getClass(node);
+return (c==&quot;&quot;)?[]:c.split(/\s+/g);
+};
+dojo.html.hasClass=function(node,_445){
+return (new RegExp(&quot;(^|\\s+)&quot;+_445+&quot;(\\s+|$)&quot;)).test(dojo.html.getClass(node));
+};
+dojo.html.prependClass=function(node,_447){
+_447+=&quot; &quot;+dojo.html.getClass(node);
+return dojo.html.setClass(node,_447);
+};
+dojo.html.addClass=function(node,_449){
+if(dojo.html.hasClass(node,_449)){
+return false;
+}
+_449=(dojo.html.getClass(node)+&quot; &quot;+_449).replace(/^\s+|\s+$/g,&quot;&quot;);
+return dojo.html.setClass(node,_449);
+};
+dojo.html.setClass=function(node,_44b){
+node=dojo.byId(node);
+var cs=new String(_44b);
+try{
+if(typeof node.className==&quot;string&quot;){
+node.className=cs;
+}else{
+if(node.setAttribute){
+node.setAttribute(&quot;class&quot;,_44b);
+node.className=cs;
+}else{
+return false;
+}
+}
+}
+catch(e){
+dojo.debug(&quot;dojo.html.setClass() failed&quot;,e);
+}
+return true;
+};
+dojo.html.removeClass=function(node,_44e,_44f){
+try{
+if(!_44f){
+var _450=dojo.html.getClass(node).replace(new RegExp(&quot;(^|\\s+)&quot;+_44e+&quot;(\\s+|$)&quot;),&quot;$1$2&quot;);
+}else{
+var _450=dojo.html.getClass(node).replace(_44e,&quot;&quot;);
+}
+dojo.html.setClass(node,_450);
+}
+catch(e){
+dojo.debug(&quot;dojo.html.removeClass() failed&quot;,e);
+}
+return true;
+};
+dojo.html.replaceClass=function(node,_452,_453){
+dojo.html.removeClass(node,_453);
+dojo.html.addClass(node,_452);
+};
+dojo.html.classMatchType={ContainsAll:0,ContainsAny:1,IsOnly:2};
+dojo.html.getElementsByClass=function(_454,_455,_456,_457,_458){
+_458=false;
+var _459=dojo.doc();
+_455=dojo.byId(_455)||_459;
+var _45a=_454.split(/\s+/g);
+var _45b=[];
+if(_457!=1&amp;&amp;_457!=2){
+_457=0;
+}
+var _45c=new RegExp(&quot;(\\s|^)((&quot;+_45a.join(&quot;)|(&quot;)+&quot;))(\\s|$)&quot;);
+var _45d=_45a.join(&quot; &quot;).length;
+var _45e=[];
+if(!_458&amp;&amp;_459.evaluate){
+var _45f=&quot;.//&quot;+(_456||&quot;*&quot;)+&quot;[contains(&quot;;
+if(_457!=dojo.html.classMatchType.ContainsAny){
+_45f+=&quot;concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot;+_45a.join(&quot; ') and contains(concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot;)+&quot; ')&quot;;
+if(_457==2){
+_45f+=&quot; and string-length(@class)=&quot;+_45d+&quot;]&quot;;
+}else{
+_45f+=&quot;]&quot;;
+}
+}else{
+_45f+=&quot;concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot;+_45a.join(&quot; ') or contains(concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot;)+&quot; ')]&quot;;
+}
+var _460=_459.evaluate(_45f,_455,null,XPathResult.ANY_TYPE,null);
+var _461=_460.iterateNext();
+while(_461){
+try{
+_45e.push(_461);
+_461=_460.iterateNext();
+}
+catch(e){
+break;
+}
+}
+return _45e;
+}else{
+if(!_456){
+_456=&quot;*&quot;;
+}
+_45e=_455.getElementsByTagName(_456);
+var node,i=0;
+outer:
+while(node=_45e[i++]){
+var _464=dojo.html.getClasses(node);
+if(_464.length==0){
+continue outer;
+}
+var _465=0;
+for(var j=0;j&lt;_464.length;j++){
+if(_45c.test(_464[j])){
+if(_457==dojo.html.classMatchType.ContainsAny){
+_45b.push(node);
+continue outer;
+}else{
+_465++;
+}
+}else{
+if(_457==dojo.html.classMatchType.IsOnly){
+continue outer;
+}
+}
+}
+if(_465==_45a.length){
+if((_457==dojo.html.classMatchType.IsOnly)&amp;&amp;(_465==_464.length)){
+_45b.push(node);
+}else{
+if(_457==dojo.html.classMatchType.ContainsAll){
+_45b.push(node);
+}
+}
+}
+}
+return _45b;
+}
+};
+dojo.html.getElementsByClassName=dojo.html.getElementsByClass;
+dojo.html.toCamelCase=function(_467){
+var arr=_467.split(&quot;-&quot;),cc=arr[0];
+for(var i=1;i&lt;arr.length;i++){
+cc+=arr[i].charAt(0).toUpperCase()+arr[i].substring(1);
+}
+return cc;
+};
+dojo.html.toSelectorCase=function(_46b){
+return _46b.replace(/([A-Z])/g,&quot;-$1&quot;).toLowerCase();
+};
+if(dojo.render.html.ie){
+dojo.html.getComputedStyle=function(node,_46d,_46e){
+node=dojo.byId(node);
+if(!node||!node.currentStyle){
+return _46e;
+}
+return node.currentStyle[dojo.html.toCamelCase(_46d)];
+};
+dojo.html.getComputedStyles=function(node){
+return node.currentStyle;
+};
+}else{
+dojo.html.getComputedStyle=function(node,_471,_472){
+node=dojo.byId(node);
+if(!node||!node.style){
+return _472;
+}
+var s=document.defaultView.getComputedStyle(node,null);
+return (s&amp;&amp;s[dojo.html.toCamelCase(_471)])||&quot;&quot;;
+};
+dojo.html.getComputedStyles=function(node){
+return document.defaultView.getComputedStyle(node,null);
+};
+}
+dojo.html.getStyleProperty=function(node,_476){
+node=dojo.byId(node);
+return (node&amp;&amp;node.style?node.style[dojo.html.toCamelCase(_476)]:undefined);
+};
+dojo.html.getStyle=function(node,_478){
+var _479=dojo.html.getStyleProperty(node,_478);
+return (_479?_479:dojo.html.getComputedStyle(node,_478));
+};
+dojo.html.setStyle=function(node,_47b,_47c){
+node=dojo.byId(node);
+if(node&amp;&amp;node.style){
+var _47d=dojo.html.toCamelCase(_47b);
+node.style[_47d]=_47c;
+}
+};
+dojo.html.setStyleText=function(_47e,text){
+try{
+_47e.style.cssText=text;
+}
+catch(e){
+_47e.setAttribute(&quot;style&quot;,text);
+}
+};
+dojo.html.copyStyle=function(_480,_481){
+if(!_481.style.cssText){
+_480.setAttribute(&quot;style&quot;,_481.getAttribute(&quot;style&quot;));
+}else{
+_480.style.cssText=_481.style.cssText;
+}
+dojo.html.addClass(_480,dojo.html.getClass(_481));
+};
+dojo.html.getUnitValue=function(node,_483,_484){
+var s=dojo.html.getComputedStyle(node,_483);
+if((!s)||((s==&quot;auto&quot;)&amp;&amp;(_484))){
+return {value:0,units:&quot;px&quot;};
+}
+var _486=s.match(/(\-?[\d.]+)([a-z%]*)/i);
+if(!_486){
+return dojo.html.getUnitValue.bad;
+}
+return {value:Number(_486[1]),units:_486[2].toLowerCase()};
+};
+dojo.html.getUnitValue.bad={value:NaN,units:&quot;&quot;};
+if(dojo.render.html.ie){
+dojo.html.toPixelValue=function(_487,_488){
+if(!_488){
+return 0;
+}
+if(_488.slice(-2)==&quot;px&quot;){
+return parseFloat(_488);
+}
+var _489=0;
+with(_487){
+var _48a=style.left;
+var _48b=runtimeStyle.left;
+runtimeStyle.left=currentStyle.left;
+try{
+style.left=_488||0;
+_489=style.pixelLeft;
+style.left=_48a;
+runtimeStyle.left=_48b;
+}
+catch(e){
+}
+}
+return _489;
+};
+}else{
+dojo.html.toPixelValue=function(_48c,_48d){
+return (_48d&amp;&amp;(_48d.slice(-2)==&quot;px&quot;)?parseFloat(_48d):0);
+};
+}
+dojo.html.getPixelValue=function(node,_48f,_490){
+return dojo.html.toPixelValue(node,dojo.html.getComputedStyle(node,_48f));
+};
+dojo.html.setPositivePixelValue=function(node,_492,_493){
+if(isNaN(_493)){
+return false;
+}
+node.style[_492]=Math.max(0,_493)+&quot;px&quot;;
+return true;
+};
+dojo.html.styleSheet=null;
+dojo.html.insertCssRule=function(_494,_495,_496){
+if(!dojo.html.styleSheet){
+if(document.createStyleSheet){
+dojo.html.styleSheet=document.createStyleSheet();
+}else{
+if(document.styleSheets[0]){
+dojo.html.styleSheet=document.styleSheets[0];
+}else{
+return null;
+}
+}
+}
+if(arguments.length&lt;3){
+if(dojo.html.styleSheet.cssRules){
+_496=dojo.html.styleSheet.cssRules.length;
+}else{
+if(dojo.html.styleSheet.rules){
+_496=dojo.html.styleSheet.rules.length;
+}else{
+return null;
+}
+}
+}
+if(dojo.html.styleSheet.insertRule){
+var rule=_494+&quot; { &quot;+_495+&quot; }&quot;;
+return dojo.html.styleSheet.insertRule(rule,_496);
+}else{
+if(dojo.html.styleSheet.addRule){
+return dojo.html.styleSheet.addRule(_494,_495,_496);
+}else{
+return null;
+}
+}
+};
+dojo.html.removeCssRule=function(_498){
+if(!dojo.html.styleSheet){
+dojo.debug(&quot;no stylesheet defined for removing rules&quot;);
+return false;
+}
+if(dojo.render.html.ie){
+if(!_498){
+_498=dojo.html.styleSheet.rules.length;
+dojo.html.styleSheet.removeRule(_498);
+}
+}else{
+if(document.styleSheets[0]){
+if(!_498){
+_498=dojo.html.styleSheet.cssRules.length;
+}
+dojo.html.styleSheet.deleteRule(_498);
+}
+}
+return true;
+};
+dojo.html._insertedCssFiles=[];
+dojo.html.insertCssFile=function(URI,doc,_49b,_49c){
+if(!URI){
+return;
+}
+if(!doc){
+doc=document;
+}
+var _49d=dojo.hostenv.getText(URI,false,_49c);
+if(_49d===null){
+return;
+}
+_49d=dojo.html.fixPathsInCssText(_49d,URI);
+if(_49b){
+var idx=-1,node,ent=dojo.html._insertedCssFiles;
+for(var i=0;i&lt;ent.length;i++){
+if((ent[i].doc==doc)&amp;&amp;(ent[i].cssText==_49d)){
+idx=i;
+node=ent[i].nodeRef;
+break;
+}
+}
+if(node){
+var _4a2=doc.getElementsByTagName(&quot;style&quot;);
+for(var i=0;i&lt;_4a2.length;i++){
+if(_4a2[i]==node){
+return;
+}
+}
+dojo.html._insertedCssFiles.shift(idx,1);
+}
+}
+var _4a3=dojo.html.insertCssText(_49d,doc);
+dojo.html._insertedCssFiles.push({&quot;doc&quot;:doc,&quot;cssText&quot;:_49d,&quot;nodeRef&quot;:_4a3});
+if(_4a3&amp;&amp;djConfig.isDebug){
+_4a3.setAttribute(&quot;dbgHref&quot;,URI);
+}
+return _4a3;
+};
+dojo.html.insertCssText=function(_4a4,doc,URI){
+if(!_4a4){
+return;
+}
+if(!doc){
+doc=document;
+}
+if(URI){
+_4a4=dojo.html.fixPathsInCssText(_4a4,URI);
+}
+var _4a7=doc.createElement(&quot;style&quot;);
+_4a7.setAttribute(&quot;type&quot;,&quot;text/css&quot;);
+var head=doc.getElementsByTagName(&quot;head&quot;)[0];
+if(!head){
+dojo.debug(&quot;No head tag in document, aborting styles&quot;);
+return;
+}else{
+head.appendChild(_4a7);
+}
+if(_4a7.styleSheet){
+var _4a9=function(){
+try{
+_4a7.styleSheet.cssText=_4a4;
+}
+catch(e){
+dojo.debug(e);
+}
+};
+if(_4a7.styleSheet.disabled){
+setTimeout(_4a9,10);
+}else{
+_4a9();
+}
+}else{
+var _4aa=doc.createTextNode(_4a4);
+_4a7.appendChild(_4aa);
+}
+return _4a7;
+};
+dojo.html.fixPathsInCssText=function(_4ab,URI){
+if(!_4ab||!URI){
+return;
+}
+var _4ad,str=&quot;&quot;,url=&quot;&quot;,_4b0=&quot;[\\t\\s\\w\\(\\)\\/\\.\\\\'\&quot;-:#=&amp;?~]+&quot;;
+var _4b1=new RegExp(&quot;url\\(\\s*(&quot;+_4b0+&quot;)\\s*\\)&quot;);
+var _4b2=/(file|https?|ftps?):\/\//;
+regexTrim=new RegExp(&quot;^[\\s]*(['\&quot;]?)(&quot;+_4b0+&quot;)\\1[\\s]*?$&quot;);
+if(dojo.render.html.ie55||dojo.render.html.ie60){
+var _4b3=new RegExp(&quot;AlphaImageLoader\\((.*)src=['\&quot;](&quot;+_4b0+&quot;)['\&quot;]&quot;);
+while(_4ad=_4b3.exec(_4ab)){
+url=_4ad[2].replace(regexTrim,&quot;$2&quot;);
+if(!_4b2.exec(url)){
+url=(new dojo.uri.Uri(URI,url).toString());
+}
+str+=_4ab.substring(0,_4ad.index)+&quot;AlphaImageLoader(&quot;+_4ad[1]+&quot;src='&quot;+url+&quot;'&quot;;
+_4ab=_4ab.substr(_4ad.index+_4ad[0].length);
+}
+_4ab=str+_4ab;
+str=&quot;&quot;;
+}
+while(_4ad=_4b1.exec(_4ab)){
+url=_4ad[1].replace(regexTrim,&quot;$2&quot;);
+if(!_4b2.exec(url)){
+url=(new dojo.uri.Uri(URI,url).toString());
+}
+str+=_4ab.substring(0,_4ad.index)+&quot;url(&quot;+url+&quot;)&quot;;
+_4ab=_4ab.substr(_4ad.index+_4ad[0].length);
+}
+return str+_4ab;
+};
+dojo.html.setActiveStyleSheet=function(_4b4){
+var i=0,a,els=dojo.doc().getElementsByTagName(&quot;link&quot;);
+while(a=els[i++]){
+if(a.getAttribute(&quot;rel&quot;).indexOf(&quot;style&quot;)!=-1&amp;&amp;a.getAttribute(&quot;title&quot;)){
+a.disabled=true;
+if(a.getAttribute(&quot;title&quot;)==_4b4){
+a.disabled=false;
+}
+}
+}
+};
+dojo.html.getActiveStyleSheet=function(){
+var i=0,a,els=dojo.doc().getElementsByTagName(&quot;link&quot;);
+while(a=els[i++]){
+if(a.getAttribute(&quot;rel&quot;).indexOf(&quot;style&quot;)!=-1&amp;&amp;a.getAttribute(&quot;title&quot;)&amp;&amp;!a.disabled){
+return a.getAttribute(&quot;title&quot;);
+}
+}
+return null;
+};
+dojo.html.getPreferredStyleSheet=function(){
+var i=0,a,els=dojo.doc().getElementsByTagName(&quot;link&quot;);
+while(a=els[i++]){
+if(a.getAttribute(&quot;rel&quot;).indexOf(&quot;style&quot;)!=-1&amp;&amp;a.getAttribute(&quot;rel&quot;).indexOf(&quot;alt&quot;)==-1&amp;&amp;a.getAttribute(&quot;title&quot;)){
+return a.getAttribute(&quot;title&quot;);
+}
+}
+return null;
+};
+dojo.html.applyBrowserClass=function(node){
+var drh=dojo.render.html;
+var _4c0={dj_ie:drh.ie,dj_ie55:drh.ie55,dj_ie6:drh.ie60,dj_ie7:drh.ie70,dj_iequirks:drh.ie&amp;&amp;drh.quirks,dj_opera:drh.opera,dj_opera8:drh.opera&amp;&amp;(Math.floor(dojo.render.version)==8),dj_opera9:drh.opera&amp;&amp;(Math.floor(dojo.render.version)==9),dj_khtml:drh.khtml,dj_safari:drh.safari,dj_gecko:drh.mozilla};
+for(var p in _4c0){
+if(_4c0[p]){
+dojo.html.addClass(node,p);
+}
+}
+};
+dojo.provide(&quot;dojo.html.display&quot;);
+dojo.html._toggle=function(node,_4c3,_4c4){
+node=dojo.byId(node);
+_4c4(node,!_4c3(node));
+return _4c3(node);
+};
+dojo.html.show=function(node){
+node=dojo.byId(node);
+if(dojo.html.getStyleProperty(node,&quot;display&quot;)==&quot;none&quot;){
+dojo.html.setStyle(node,&quot;display&quot;,(node.dojoDisplayCache||&quot;&quot;));
+node.dojoDisplayCache=undefined;
+}
+};
+dojo.html.hide=function(node){
+node=dojo.byId(node);
+if(typeof node[&quot;dojoDisplayCache&quot;]==&quot;undefined&quot;){
+var d=dojo.html.getStyleProperty(node,&quot;display&quot;);
+if(d!=&quot;none&quot;){
+node.dojoDisplayCache=d;
+}
+}
+dojo.html.setStyle(node,&quot;display&quot;,&quot;none&quot;);
+};
+dojo.html.setShowing=function(node,_4c9){
+dojo.html[(_4c9?&quot;show&quot;:&quot;hide&quot;)](node);
+};
+dojo.html.isShowing=function(node){
+return (dojo.html.getStyleProperty(node,&quot;display&quot;)!=&quot;none&quot;);
+};
+dojo.html.toggleShowing=function(node){
+return dojo.html._toggle(node,dojo.html.isShowing,dojo.html.setShowing);
+};
+dojo.html.displayMap={tr:&quot;&quot;,td:&quot;&quot;,th:&quot;&quot;,img:&quot;inline&quot;,span:&quot;inline&quot;,input:&quot;inline&quot;,button:&quot;inline&quot;};
+dojo.html.suggestDisplayByTagName=function(node){
+node=dojo.byId(node);
+if(node&amp;&amp;node.tagName){
+var tag=node.tagName.toLowerCase();
+return (tag in dojo.html.displayMap?dojo.html.displayMap[tag]:&quot;block&quot;);
+}
+};
+dojo.html.setDisplay=function(node,_4cf){
+dojo.html.setStyle(node,&quot;display&quot;,((_4cf instanceof String||typeof _4cf==&quot;string&quot;)?_4cf:(_4cf?dojo.html.suggestDisplayByTagName(node):&quot;none&quot;)));
+};
+dojo.html.isDisplayed=function(node){
+return (dojo.html.getComputedStyle(node,&quot;display&quot;)!=&quot;none&quot;);
+};
+dojo.html.toggleDisplay=function(node){
+return dojo.html._toggle(node,dojo.html.isDisplayed,dojo.html.setDisplay);
+};
+dojo.html.setVisibility=function(node,_4d3){
+dojo.html.setStyle(node,&quot;visibility&quot;,((_4d3 instanceof String||typeof _4d3==&quot;string&quot;)?_4d3:(_4d3?&quot;visible&quot;:&quot;hidden&quot;)));
+};
+dojo.html.isVisible=function(node){
+return (dojo.html.getComputedStyle(node,&quot;visibility&quot;)!=&quot;hidden&quot;);
+};
+dojo.html.toggleVisibility=function(node){
+return dojo.html._toggle(node,dojo.html.isVisible,dojo.html.setVisibility);
+};
+dojo.html.setOpacity=function(node,_4d7,_4d8){
+node=dojo.byId(node);
+var h=dojo.render.html;
+if(!_4d8){
+if(_4d7&gt;=1){
+if(h.ie){
+dojo.html.clearOpacity(node);
+return;
+}else{
+_4d7=0.999999;
+}
+}else{
+if(_4d7&lt;0){
+_4d7=0;
+}
+}
+}
+if(h.ie){
+if(node.nodeName.toLowerCase()==&quot;tr&quot;){
+var tds=node.getElementsByTagName(&quot;td&quot;);
+for(var x=0;x&lt;tds.length;x++){
+tds[x].style.filter=&quot;Alpha(Opacity=&quot;+_4d7*100+&quot;)&quot;;
+}
+}
+node.style.filter=&quot;Alpha(Opacity=&quot;+_4d7*100+&quot;)&quot;;
+}else{
+if(h.moz){
+node.style.opacity=_4d7;
+node.style.MozOpacity=_4d7;
+}else{
+if(h.safari){
+node.style.opacity=_4d7;
+node.style.KhtmlOpacity=_4d7;
+}else{
+node.style.opacity=_4d7;
+}
+}
+}
+};
+dojo.html.clearOpacity=function(node){
+node=dojo.byId(node);
+var ns=node.style;
+var h=dojo.render.html;
+if(h.ie){
+try{
+if(node.filters&amp;&amp;node.filters.alpha){
+ns.filter=&quot;&quot;;
+}
+}
+catch(e){
+}
+}else{
+if(h.moz){
+ns.opacity=1;
+ns.MozOpacity=1;
+}else{
+if(h.safari){
+ns.opacity=1;
+ns.KhtmlOpacity=1;
+}else{
+ns.opacity=1;
+}
+}
+}
+};
+dojo.html.getOpacity=function(node){
+node=dojo.byId(node);
+var h=dojo.render.html;
+if(h.ie){
+var opac=(node.filters&amp;&amp;node.filters.alpha&amp;&amp;typeof node.filters.alpha.opacity==&quot;number&quot;?node.filters.alpha.opacity:100)/100;
+}else{
+var opac=node.style.opacity||node.style.MozOpacity||node.style.KhtmlOpacity||1;
+}
+return opac&gt;=0.999999?1:Number(opac);
+};
+dojo.provide(&quot;dojo.html.color&quot;);
+dojo.html.getBackgroundColor=function(node){
+node=dojo.byId(node);
+var _4e3;
+do{
+_4e3=dojo.html.getStyle(node,&quot;background-color&quot;);
+if(_4e3.toLowerCase()==&quot;rgba(0, 0, 0, 0)&quot;){
+_4e3=&quot;transparent&quot;;
+}
+if(node==document.getElementsByTagName(&quot;body&quot;)[0]){
+node=null;
+break;
+}
+node=node.parentNode;
+}while(node&amp;&amp;dojo.lang.inArray([&quot;transparent&quot;,&quot;&quot;],_4e3));
+if(_4e3==&quot;transparent&quot;){
+_4e3=[255,255,255,0];
+}else{
+_4e3=dojo.gfx.color.extractRGB(_4e3);
+}
+return _4e3;
+};
+dojo.provide(&quot;dojo.html.layout&quot;);
+dojo.html.sumAncestorProperties=function(node,prop){
+node=dojo.byId(node);
+if(!node){
+return 0;
+}
+var _4e6=0;
+while(node){
+if(dojo.html.getComputedStyle(node,&quot;position&quot;)==&quot;fixed&quot;){
+return 0;
+}
+var val=node[prop];
+if(val){
+_4e6+=val-0;
+if(node==dojo.body()){
+break;
+}
+}
+node=node.parentNode;
+}
+return _4e6;
+};
+dojo.html.setStyleAttributes=function(node,_4e9){
+node=dojo.byId(node);
+var _4ea=_4e9.replace(/(;)?\s*$/,&quot;&quot;).split(&quot;;&quot;);
+for(var i=0;i&lt;_4ea.length;i++){
+var _4ec=_4ea[i].split(&quot;:&quot;);
+var name=_4ec[0].replace(/\s*$/,&quot;&quot;).replace(/^\s*/,&quot;&quot;).toLowerCase();
+var _4ee=_4ec[1].replace(/\s*$/,&quot;&quot;).replace(/^\s*/,&quot;&quot;);
+switch(name){
+case &quot;opacity&quot;:
+dojo.html.setOpacity(node,_4ee);
+break;
+case &quot;content-height&quot;:
+dojo.html.setContentBox(node,{height:_4ee});
+break;
+case &quot;content-width&quot;:
+dojo.html.setContentBox(node,{width:_4ee});
+break;
+case &quot;outer-height&quot;:
+dojo.html.setMarginBox(node,{height:_4ee});
+break;
+case &quot;outer-width&quot;:
+dojo.html.setMarginBox(node,{width:_4ee});
+break;
+default:
+node.style[dojo.html.toCamelCase(name)]=_4ee;
+}
+}
+};
+dojo.html.boxSizing={MARGIN_BOX:&quot;margin-box&quot;,BORDER_BOX:&quot;border-box&quot;,PADDING_BOX:&quot;padding-box&quot;,CONTENT_BOX:&quot;content-box&quot;};
+dojo.html.getAbsolutePosition=dojo.html.abs=function(node,_4f0,_4f1){
+node=dojo.byId(node,node.ownerDocument);
+var ret={x:0,y:0};
+var bs=dojo.html.boxSizing;
+if(!_4f1){
+_4f1=bs.CONTENT_BOX;
+}
+var _4f4=2;
+var _4f5;
+switch(_4f1){
+case bs.MARGIN_BOX:
+_4f5=3;
+break;
+case bs.BORDER_BOX:
+_4f5=2;
+break;
+case bs.PADDING_BOX:
+default:
+_4f5=1;
+break;
+case bs.CONTENT_BOX:
+_4f5=0;
+break;
+}
+var h=dojo.render.html;
+var db=document[&quot;body&quot;]||document[&quot;documentElement&quot;];
+if(h.ie){
+with(node.getBoundingClientRect()){
+ret.x=left-2;
+ret.y=top-2;
+}
+}else{
+if(document.getBoxObjectFor){
+_4f4=1;
+try{
+var bo=document.getBoxObjectFor(node);
+ret.x=bo.x-dojo.html.sumAncestorProperties(node,&quot;scrollLeft&quot;);
+ret.y=bo.y-dojo.html.sumAncestorProperties(node,&quot;scrollTop&quot;);
+}
+catch(e){
+}
+}else{
+if(node[&quot;offsetParent&quot;]){
+var _4f9;
+if((h.safari)&amp;&amp;(node.style.getPropertyValue(&quot;position&quot;)==&quot;absolute&quot;)&amp;&amp;(node.parentNode==db)){
+_4f9=db;
+}else{
+_4f9=db.parentNode;
+}
+if(node.parentNode!=db){
+var nd=node;
+if(dojo.render.html.opera){
+nd=db;
+}
+ret.x-=dojo.html.sumAncestorProperties(nd,&quot;scrollLeft&quot;);
+ret.y-=dojo.html.sumAncestorProperties(nd,&quot;scrollTop&quot;);
+}
+var _4fb=node;
+do{
+var n=_4fb[&quot;offsetLeft&quot;];
+if(!h.opera||n&gt;0){
+ret.x+=isNaN(n)?0:n;
+}
+var m=_4fb[&quot;offsetTop&quot;];
+ret.y+=isNaN(m)?0:m;
+_4fb=_4fb.offsetParent;
+}while((_4fb!=_4f9)&amp;&amp;(_4fb!=null));
+}else{
+if(node[&quot;x&quot;]&amp;&amp;node[&quot;y&quot;]){
+ret.x+=isNaN(node.x)?0:node.x;
+ret.y+=isNaN(node.y)?0:node.y;
+}
+}
+}
+}
+if(_4f0){
+var _4fe=dojo.html.getScroll();
+ret.y+=_4fe.top;
+ret.x+=_4fe.left;
+}
+var _4ff=[dojo.html.getPaddingExtent,dojo.html.getBorderExtent,dojo.html.getMarginExtent];
+if(_4f4&gt;_4f5){
+for(var i=_4f5;i&lt;_4f4;++i){
+ret.y+=_4ff[i](node,&quot;top&quot;);
+ret.x+=_4ff[i](node,&quot;left&quot;);
+}
+}else{
+if(_4f4&lt;_4f5){
+for(var i=_4f5;i&gt;_4f4;--i){
+ret.y-=_4ff[i-1](node,&quot;top&quot;);
+ret.x-=_4ff[i-1](node,&quot;left&quot;);
+}
+}
+}
+ret.top=ret.y;
+ret.left=ret.x;
+return ret;
+};
+dojo.html.isPositionAbsolute=function(node){
+return (dojo.html.getComputedStyle(node,&quot;position&quot;)==&quot;absolute&quot;);
+};
+dojo.html._sumPixelValues=function(node,_503,_504){
+var _505=0;
+for(var x=0;x&lt;_503.length;x++){
+_505+=dojo.html.getPixelValue(node,_503[x],_504);
+}
+return _505;
+};
+dojo.html.getMargin=function(node){
+return {width:dojo.html._sumPixelValues(node,[&quot;margin-left&quot;,&quot;margin-right&quot;],(dojo.html.getComputedStyle(node,&quot;position&quot;)==&quot;absolute&quot;)),height:dojo.html._sumPixelValues(node,[&quot;margin-top&quot;,&quot;margin-bottom&quot;],(dojo.html.getComputedStyle(node,&quot;position&quot;)==&quot;absolute&quot;))};
+};
+dojo.html.getBorder=function(node){
+return {width:dojo.html.getBorderExtent(node,&quot;left&quot;)+dojo.html.getBorderExtent(node,&quot;right&quot;),height:dojo.html.getBorderExtent(node,&quot;top&quot;)+dojo.html.getBorderExtent(node,&quot;bottom&quot;)};
+};
+dojo.html.getBorderExtent=function(node,side){
+return (dojo.html.getStyle(node,&quot;border-&quot;+side+&quot;-style&quot;)==&quot;none&quot;?0:dojo.html.getPixelValue(node,&quot;border-&quot;+side+&quot;-width&quot;));
+};
+dojo.html.getMarginExtent=function(node,side){
+return dojo.html._sumPixelValues(node,[&quot;margin-&quot;+side],dojo.html.isPositionAbsolute(node));
+};
+dojo.html.getPaddingExtent=function(node,side){
+return dojo.html._sumPixelValues(node,[&quot;padding-&quot;+side],true);
+};
+dojo.html.getPadding=function(node){
+return {width:dojo.html._sumPixelValues(node,[&quot;padding-left&quot;,&quot;padding-right&quot;],true),height:dojo.html._sumPixelValues(node,[&quot;padding-top&quot;,&quot;padding-bottom&quot;],true)};
+};
+dojo.html.getPadBorder=function(node){
+var pad=dojo.html.getPadding(node);
+var _512=dojo.html.getBorder(node);
+return {width:pad.width+_512.width,height:pad.height+_512.height};
+};
+dojo.html.getBoxSizing=function(node){
+var h=dojo.render.html;
+var bs=dojo.html.boxSizing;
+if(((h.ie)||(h.opera))&amp;&amp;node.nodeName.toLowerCase()!=&quot;img&quot;){
+var cm=document[&quot;compatMode&quot;];
+if((cm==&quot;BackCompat&quot;)||(cm==&quot;QuirksMode&quot;)){
+return bs.BORDER_BOX;
+}else{
+return bs.CONTENT_BOX;
+}
+}else{
+if(arguments.length==0){
+node=document.documentElement;
+}
+var _517;
+if(!h.ie){
+_517=dojo.html.getStyle(node,&quot;-moz-box-sizing&quot;);
+if(!_517){
+_517=dojo.html.getStyle(node,&quot;box-sizing&quot;);
+}
+}
+return (_517?_517:bs.CONTENT_BOX);
+}
+};
+dojo.html.isBorderBox=function(node){
+return (dojo.html.getBoxSizing(node)==dojo.html.boxSizing.BORDER_BOX);
+};
+dojo.html.getBorderBox=function(node){
+node=dojo.byId(node);
+return {width:node.offsetWidth,height:node.offsetHeight};
+};
+dojo.html.getPaddingBox=function(node){
+var box=dojo.html.getBorderBox(node);
+var _51c=dojo.html.getBorder(node);
+return {width:box.width-_51c.width,height:box.height-_51c.height};
+};
+dojo.html.getContentBox=function(node){
+node=dojo.byId(node);
+var _51e=dojo.html.getPadBorder(node);
+return {width:node.offsetWidth-_51e.width,height:node.offsetHeight-_51e.height};
+};
+dojo.html.setContentBox=function(node,args){
+node=dojo.byId(node);
+var _521=0;
+var _522=0;
+var isbb=dojo.html.isBorderBox(node);
+var _524=(isbb?dojo.html.getPadBorder(node):{width:0,height:0});
+var ret={};
+if(typeof args.width!=&quot;undefined&quot;){
+_521=args.width+_524.width;
+ret.width=dojo.html.setPositivePixelValue(node,&quot;width&quot;,_521);
+}
+if(typeof args.height!=&quot;undefined&quot;){
+_522=args.height+_524.height;
+ret.height=dojo.html.setPositivePixelValue(node,&quot;height&quot;,_522);
+}
+return ret;
+};
+dojo.html.getMarginBox=function(node){
+var _527=dojo.html.getBorderBox(node);
+var _528=dojo.html.getMargin(node);
+return {width:_527.width+_528.width,height:_527.height+_528.height};
+};
+dojo.html.setMarginBox=function(node,args){
+node=dojo.byId(node);
+var _52b=0;
+var _52c=0;
+var isbb=dojo.html.isBorderBox(node);
+var _52e=(!isbb?dojo.html.getPadBorder(node):{width:0,height:0});
+var _52f=dojo.html.getMargin(node);
+var ret={};
+if(typeof args.width!=&quot;undefined&quot;){
+_52b=args.width-_52e.width;
+_52b-=_52f.width;
+ret.width=dojo.html.setPositivePixelValue(node,&quot;width&quot;,_52b);
+}
+if(typeof args.height!=&quot;undefined&quot;){
+_52c=args.height-_52e.height;
+_52c-=_52f.height;
+ret.height=dojo.html.setPositivePixelValue(node,&quot;height&quot;,_52c);
+}
+return ret;
+};
+dojo.html.getElementBox=function(node,type){
+var bs=dojo.html.boxSizing;
+switch(type){
+case bs.MARGIN_BOX:
+return dojo.html.getMarginBox(node);
+case bs.BORDER_BOX:
+return dojo.html.getBorderBox(node);
+case bs.PADDING_BOX:
+return dojo.html.getPaddingBox(node);
+case bs.CONTENT_BOX:
+default:
+return dojo.html.getContentBox(node);
+}
+};
+dojo.html.toCoordinateObject=dojo.html.toCoordinateArray=function(_534,_535,_536){
+if(_534 instanceof Array||typeof _534==&quot;array&quot;){
+dojo.deprecated(&quot;dojo.html.toCoordinateArray&quot;,&quot;use dojo.html.toCoordinateObject({left: , top: , width: , height: }) instead&quot;,&quot;0.5&quot;);
+while(_534.length&lt;4){
+_534.push(0);
+}
+while(_534.length&gt;4){
+_534.pop();
+}
+var ret={left:_534[0],top:_534[1],width:_534[2],height:_534[3]};
+}else{
+if(!_534.nodeType&amp;&amp;!(_534 instanceof String||typeof _534==&quot;string&quot;)&amp;&amp;(&quot;width&quot; in _534||&quot;height&quot; in _534||&quot;left&quot; in _534||&quot;x&quot; in _534||&quot;top&quot; in _534||&quot;y&quot; in _534)){
+var ret={left:_534.left||_534.x||0,top:_534.top||_534.y||0,width:_534.width||0,height:_534.height||0};
+}else{
+var node=dojo.byId(_534);
+var pos=dojo.html.abs(node,_535,_536);
+var _53a=dojo.html.getMarginBox(node);
+var ret={left:pos.left,top:pos.top,width:_53a.width,height:_53a.height};
+}
+}
+ret.x=ret.left;
+ret.y=ret.top;
+return ret;
+};
+dojo.html.setMarginBoxWidth=dojo.html.setOuterWidth=function(node,_53c){
+return dojo.html._callDeprecated(&quot;setMarginBoxWidth&quot;,&quot;setMarginBox&quot;,arguments,&quot;width&quot;);
+};
+dojo.html.setMarginBoxHeight=dojo.html.setOuterHeight=function(){
+return dojo.html._callDeprecated(&quot;setMarginBoxHeight&quot;,&quot;setMarginBox&quot;,arguments,&quot;height&quot;);
+};
+dojo.html.getMarginBoxWidth=dojo.html.getOuterWidth=function(){
+return dojo.html._callDeprecated(&quot;getMarginBoxWidth&quot;,&quot;getMarginBox&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getMarginBoxHeight=dojo.html.getOuterHeight=function(){
+return dojo.html._callDeprecated(&quot;getMarginBoxHeight&quot;,&quot;getMarginBox&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getTotalOffset=function(node,type,_53f){
+return dojo.html._callDeprecated(&quot;getTotalOffset&quot;,&quot;getAbsolutePosition&quot;,arguments,null,type);
+};
+dojo.html.getAbsoluteX=function(node,_541){
+return dojo.html._callDeprecated(&quot;getAbsoluteX&quot;,&quot;getAbsolutePosition&quot;,arguments,null,&quot;x&quot;);
+};
+dojo.html.getAbsoluteY=function(node,_543){
+return dojo.html._callDeprecated(&quot;getAbsoluteY&quot;,&quot;getAbsolutePosition&quot;,arguments,null,&quot;y&quot;);
+};
+dojo.html.totalOffsetLeft=function(node,_545){
+return dojo.html._callDeprecated(&quot;totalOffsetLeft&quot;,&quot;getAbsolutePosition&quot;,arguments,null,&quot;left&quot;);
+};
+dojo.html.totalOffsetTop=function(node,_547){
+return dojo.html._callDeprecated(&quot;totalOffsetTop&quot;,&quot;getAbsolutePosition&quot;,arguments,null,&quot;top&quot;);
+};
+dojo.html.getMarginWidth=function(node){
+return dojo.html._callDeprecated(&quot;getMarginWidth&quot;,&quot;getMargin&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getMarginHeight=function(node){
+return dojo.html._callDeprecated(&quot;getMarginHeight&quot;,&quot;getMargin&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getBorderWidth=function(node){
+return dojo.html._callDeprecated(&quot;getBorderWidth&quot;,&quot;getBorder&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getBorderHeight=function(node){
+return dojo.html._callDeprecated(&quot;getBorderHeight&quot;,&quot;getBorder&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getPaddingWidth=function(node){
+return dojo.html._callDeprecated(&quot;getPaddingWidth&quot;,&quot;getPadding&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getPaddingHeight=function(node){
+return dojo.html._callDeprecated(&quot;getPaddingHeight&quot;,&quot;getPadding&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getPadBorderWidth=function(node){
+return dojo.html._callDeprecated(&quot;getPadBorderWidth&quot;,&quot;getPadBorder&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getPadBorderHeight=function(node){
+return dojo.html._callDeprecated(&quot;getPadBorderHeight&quot;,&quot;getPadBorder&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getBorderBoxWidth=dojo.html.getInnerWidth=function(){
+return dojo.html._callDeprecated(&quot;getBorderBoxWidth&quot;,&quot;getBorderBox&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getBorderBoxHeight=dojo.html.getInnerHeight=function(){
+return dojo.html._callDeprecated(&quot;getBorderBoxHeight&quot;,&quot;getBorderBox&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.getContentBoxWidth=dojo.html.getContentWidth=function(){
+return dojo.html._callDeprecated(&quot;getContentBoxWidth&quot;,&quot;getContentBox&quot;,arguments,null,&quot;width&quot;);
+};
+dojo.html.getContentBoxHeight=dojo.html.getContentHeight=function(){
+return dojo.html._callDeprecated(&quot;getContentBoxHeight&quot;,&quot;getContentBox&quot;,arguments,null,&quot;height&quot;);
+};
+dojo.html.setContentBoxWidth=dojo.html.setContentWidth=function(node,_551){
+return dojo.html._callDeprecated(&quot;setContentBoxWidth&quot;,&quot;setContentBox&quot;,arguments,&quot;width&quot;);
+};
+dojo.html.setContentBoxHeight=dojo.html.setContentHeight=function(node,_553){
+return dojo.html._callDeprecated(&quot;setContentBoxHeight&quot;,&quot;setContentBox&quot;,arguments,&quot;height&quot;);
+};
+dojo.provide(&quot;dojo.lfx.html&quot;);
+dojo.lfx.html._byId=function(_554){
+if(!_554){
+return [];
+}
+if(dojo.lang.isArrayLike(_554)){
+if(!_554.alreadyChecked){
+var n=[];
+dojo.lang.forEach(_554,function(node){
+n.push(dojo.byId(node));
+});
+n.alreadyChecked=true;
+return n;
+}else{
+return _554;
+}
+}else{
+var n=[];
+n.push(dojo.byId(_554));
+n.alreadyChecked=true;
+return n;
+}
+};
+dojo.lfx.html.propertyAnimation=function(_557,_558,_559,_55a,_55b){
+_557=dojo.lfx.html._byId(_557);
+var _55c={&quot;propertyMap&quot;:_558,&quot;nodes&quot;:_557,&quot;duration&quot;:_559,&quot;easing&quot;:_55a||dojo.lfx.easeDefault};
+var _55d=function(args){
+if(args.nodes.length==1){
+var pm=args.propertyMap;
+if(!dojo.lang.isArray(args.propertyMap)){
+var parr=[];
+for(var _561 in pm){
+pm[_561].property=_561;
+parr.push(pm[_561]);
+}
+pm=args.propertyMap=parr;
+}
+dojo.lang.forEach(pm,function(prop){
+if(dj_undef(&quot;start&quot;,prop)){
+if(prop.property!=&quot;opacity&quot;){
+prop.start=parseInt(dojo.html.getComputedStyle(args.nodes[0],prop.property));
+}else{
+prop.start=dojo.html.getOpacity(args.nodes[0]);
+}
+}
+});
+}
+};
+var _563=function(_564){
+var _565=[];
+dojo.lang.forEach(_564,function(c){
+_565.push(Math.round(c));
+});
+return _565;
+};
+var _567=function(n,_569){
+n=dojo.byId(n);
+if(!n||!n.style){
+return;
+}
+for(var s in _569){
+try{
+if(s==&quot;opacity&quot;){
+dojo.html.setOpacity(n,_569[s]);
+}else{
+n.style[s]=_569[s];
+}
+}
+catch(e){
+dojo.debug(e);
+}
+}
+};
+var _56b=function(_56c){
+this._properties=_56c;
+this.diffs=new Array(_56c.length);
+dojo.lang.forEach(_56c,function(prop,i){
+if(dojo.lang.isFunction(prop.start)){
+prop.start=prop.start(prop,i);
+}
+if(dojo.lang.isFunction(prop.end)){
+prop.end=prop.end(prop,i);
+}
+if(dojo.lang.isArray(prop.start)){
+this.diffs[i]=null;
+}else{
+if(prop.start instanceof dojo.gfx.color.Color){
+prop.startRgb=prop.start.toRgb();
+prop.endRgb=prop.end.toRgb();
+}else{
+this.diffs[i]=prop.end-prop.start;
+}
+}
+},this);
+this.getValue=function(n){
+var ret={};
+dojo.lang.forEach(this._properties,function(prop,i){
+var _573=null;
+if(dojo.lang.isArray(prop.start)){
+}else{
+if(prop.start instanceof dojo.gfx.color.Color){
+_573=(prop.units||&quot;rgb&quot;)+&quot;(&quot;;
+for(var j=0;j&lt;prop.startRgb.length;j++){
+_573+=Math.round(((prop.endRgb[j]-prop.startRgb[j])*n)+prop.startRgb[j])+(j&lt;prop.startRgb.length-1?&quot;,&quot;:&quot;&quot;);
+}
+_573+=&quot;)&quot;;
+}else{
+_573=((this.diffs[i])*n)+prop.start+(prop.property!=&quot;opacity&quot;?prop.units||&quot;px&quot;:&quot;&quot;);
+}
+}
+ret[dojo.html.toCamelCase(prop.property)]=_573;
+},this);
+return ret;
+};
+};
+var anim=new dojo.lfx.Animation({beforeBegin:function(){
+_55d(_55c);
+anim.curve=new _56b(_55c.propertyMap);
+},onAnimate:function(_576){
+dojo.lang.forEach(_55c.nodes,function(node){
+_567(node,_576);
+});
+}},_55c.duration,null,_55c.easing);
+if(_55b){
+for(var x in _55b){
+if(dojo.lang.isFunction(_55b[x])){
+anim.connect(x,anim,_55b[x]);
+}
+}
+}
+return anim;
+};
+dojo.lfx.html._makeFadeable=function(_579){
+var _57a=function(node){
+if(dojo.render.html.ie){
+if((node.style.zoom.length==0)&amp;&amp;(dojo.html.getStyle(node,&quot;zoom&quot;)==&quot;normal&quot;)){
+node.style.zoom=&quot;1&quot;;
+}
+if((node.style.width.length==0)&amp;&amp;(dojo.html.getStyle(node,&quot;width&quot;)==&quot;auto&quot;)){
+node.style.width=&quot;auto&quot;;
+}
+}
+};
+if(dojo.lang.isArrayLike(_579)){
+dojo.lang.forEach(_579,_57a);
+}else{
+_57a(_579);
+}
+};
+dojo.lfx.html.fade=function(_57c,_57d,_57e,_57f,_580){
+_57c=dojo.lfx.html._byId(_57c);
+var _581={property:&quot;opacity&quot;};
+if(!dj_undef(&quot;start&quot;,_57d)){
+_581.start=_57d.start;
+}else{
+_581.start=function(){
+return dojo.html.getOpacity(_57c[0]);
+};
+}
+if(!dj_undef(&quot;end&quot;,_57d)){
+_581.end=_57d.end;
+}else{
+dojo.raise(&quot;dojo.lfx.html.fade needs an end value&quot;);
+}
+var anim=dojo.lfx.propertyAnimation(_57c,[_581],_57e,_57f);
+anim.connect(&quot;beforeBegin&quot;,function(){
+dojo.lfx.html._makeFadeable(_57c);
+});
+if(_580){
+anim.connect(&quot;onEnd&quot;,function(){
+_580(_57c,anim);
+});
+}
+return anim;
+};
+dojo.lfx.html.fadeIn=function(_583,_584,_585,_586){
+return dojo.lfx.html.fade(_583,{end:1},_584,_585,_586);
+};
+dojo.lfx.html.fadeOut=function(_587,_588,_589,_58a){
+return dojo.lfx.html.fade(_587,{end:0},_588,_589,_58a);
+};
+dojo.lfx.html.fadeShow=function(_58b,_58c,_58d,_58e){
+_58b=dojo.lfx.html._byId(_58b);
+dojo.lang.forEach(_58b,function(node){
+dojo.html.setOpacity(node,0);
+});
+var anim=dojo.lfx.html.fadeIn(_58b,_58c,_58d,_58e);
+anim.connect(&quot;beforeBegin&quot;,function(){
+if(dojo.lang.isArrayLike(_58b)){
+dojo.lang.forEach(_58b,dojo.html.show);
+}else{
+dojo.html.show(_58b);
+}
+});
+return anim;
+};
+dojo.lfx.html.fadeHide=function(_591,_592,_593,_594){
+var anim=dojo.lfx.html.fadeOut(_591,_592,_593,function(){
+if(dojo.lang.isArrayLike(_591)){
+dojo.lang.forEach(_591,dojo.html.hide);
+}else{
+dojo.html.hide(_591);
+}
+if(_594){
+_594(_591,anim);
+}
+});
+return anim;
+};
+dojo.lfx.html.wipeIn=function(_596,_597,_598,_599){
+_596=dojo.lfx.html._byId(_596);
+var _59a=[];
+dojo.lang.forEach(_596,function(node){
+var _59c={};
+var _59d,_59e,_59f;
+with(node.style){
+_59d=top;
+_59e=left;
+_59f=position;
+top=&quot;-9999px&quot;;
+left=&quot;-9999px&quot;;
+position=&quot;absolute&quot;;
+display=&quot;&quot;;
+}
+var _5a0=dojo.html.getBorderBox(node).height;
+with(node.style){
+top=_59d;
+left=_59e;
+position=_59f;
+display=&quot;none&quot;;
+}
+var anim=dojo.lfx.propertyAnimation(node,{&quot;height&quot;:{start:1,end:function(){
+return _5a0;
+}}},_597,_598);
+anim.connect(&quot;beforeBegin&quot;,function(){
+_59c.overflow=node.style.overflow;
+_59c.height=node.style.height;
+with(node.style){
+overflow=&quot;hidden&quot;;
+height=&quot;1px&quot;;
+}
+dojo.html.show(node);
+});
+anim.connect(&quot;onEnd&quot;,function(){
+with(node.style){
+overflow=_59c.overflow;
+height=_59c.height;
+}
+if(_599){
+_599(node,anim);
+}
+});
+_59a.push(anim);
+});
+return dojo.lfx.combine(_59a);
+};
+dojo.lfx.html.wipeOut=function(_5a2,_5a3,_5a4,_5a5){
+_5a2=dojo.lfx.html._byId(_5a2);
+var _5a6=[];
+dojo.lang.forEach(_5a2,function(node){
+var _5a8={};
+var anim=dojo.lfx.propertyAnimation(node,{&quot;height&quot;:{start:function(){
+return dojo.html.getContentBox(node).height;
+},end:1}},_5a3,_5a4,{&quot;beforeBegin&quot;:function(){
+_5a8.overflow=node.style.overflow;
+_5a8.height=node.style.height;
+with(node.style){
+overflow=&quot;hidden&quot;;
+}
+dojo.html.show(node);
+},&quot;onEnd&quot;:function(){
+dojo.html.hide(node);
+with(node.style){
+overflow=_5a8.overflow;
+height=_5a8.height;
+}
+if(_5a5){
+_5a5(node,anim);
+}
+}});
+_5a6.push(anim);
+});
+return dojo.lfx.combine(_5a6);
+};
+dojo.lfx.html.slideTo=function(_5aa,_5ab,_5ac,_5ad,_5ae){
+_5aa=dojo.lfx.html._byId(_5aa);
+var _5af=[];
+var _5b0=dojo.html.getComputedStyle;
+if(dojo.lang.isArray(_5ab)){
+dojo.deprecated(&quot;dojo.lfx.html.slideTo(node, array)&quot;,&quot;use dojo.lfx.html.slideTo(node, {top: value, left: value});&quot;,&quot;0.5&quot;);
+_5ab={top:_5ab[0],left:_5ab[1]};
+}
+dojo.lang.forEach(_5aa,function(node){
+var top=null;
+var left=null;
+var init=(function(){
+var _5b5=node;
+return function(){
+var pos=_5b0(_5b5,&quot;position&quot;);
+top=(pos==&quot;absolute&quot;?node.offsetTop:parseInt(_5b0(node,&quot;top&quot;))||0);
+left=(pos==&quot;absolute&quot;?node.offsetLeft:parseInt(_5b0(node,&quot;left&quot;))||0);
+if(!dojo.lang.inArray([&quot;absolute&quot;,&quot;relative&quot;],pos)){
+var ret=dojo.html.abs(_5b5,true);
+dojo.html.setStyleAttributes(_5b5,&quot;position:absolute;top:&quot;+ret.y+&quot;px;left:&quot;+ret.x+&quot;px;&quot;);
+top=ret.y;
+left=ret.x;
+}
+};
+})();
+init();
+var anim=dojo.lfx.propertyAnimation(node,{&quot;top&quot;:{start:top,end:(_5ab.top||0)},&quot;left&quot;:{start:left,end:(_5ab.left||0)}},_5ac,_5ad,{&quot;beforeBegin&quot;:init});
+if(_5ae){
+anim.connect(&quot;onEnd&quot;,function(){
+_5ae(_5aa,anim);
+});
+}
+_5af.push(anim);
+});
+return dojo.lfx.combine(_5af);
+};
+dojo.lfx.html.slideBy=function(_5b9,_5ba,_5bb,_5bc,_5bd){
+_5b9=dojo.lfx.html._byId(_5b9);
+var _5be=[];
+var _5bf=dojo.html.getComputedStyle;
+if(dojo.lang.isArray(_5ba)){
+dojo.deprecated(&quot;dojo.lfx.html.slideBy(node, array)&quot;,&quot;use dojo.lfx.html.slideBy(node, {top: value, left: value});&quot;,&quot;0.5&quot;);
+_5ba={top:_5ba[0],left:_5ba[1]};
+}
+dojo.lang.forEach(_5b9,function(node){
+var top=null;
+var left=null;
+var init=(function(){
+var _5c4=node;
+return function(){
+var pos=_5bf(_5c4,&quot;position&quot;);
+top=(pos==&quot;absolute&quot;?node.offsetTop:parseInt(_5bf(node,&quot;top&quot;))||0);
+left=(pos==&quot;absolute&quot;?node.offsetLeft:parseInt(_5bf(node,&quot;left&quot;))||0);
+if(!dojo.lang.inArray([&quot;absolute&quot;,&quot;relative&quot;],pos)){
+var ret=dojo.html.abs(_5c4,true);
+dojo.html.setStyleAttributes(_5c4,&quot;position:absolute;top:&quot;+ret.y+&quot;px;left:&quot;+ret.x+&quot;px;&quot;);
+top=ret.y;
+left=ret.x;
+}
+};
+})();
+init();
+var anim=dojo.lfx.propertyAnimation(node,{&quot;top&quot;:{start:top,end:top+(_5ba.top||0)},&quot;left&quot;:{start:left,end:left+(_5ba.left||0)}},_5bb,_5bc).connect(&quot;beforeBegin&quot;,init);
+if(_5bd){
+anim.connect(&quot;onEnd&quot;,function(){
+_5bd(_5b9,anim);
+});
+}
+_5be.push(anim);
+});
+return dojo.lfx.combine(_5be);
+};
+dojo.lfx.html.explode=function(_5c8,_5c9,_5ca,_5cb,_5cc){
+var h=dojo.html;
+_5c8=dojo.byId(_5c8);
+_5c9=dojo.byId(_5c9);
+var _5ce=h.toCoordinateObject(_5c8,true);
+var _5cf=document.createElement(&quot;div&quot;);
+h.copyStyle(_5cf,_5c9);
+if(_5c9.explodeClassName){
+_5cf.className=_5c9.explodeClassName;
+}
+with(_5cf.style){
+position=&quot;absolute&quot;;
+display=&quot;none&quot;;
+var _5d0=h.getStyle(_5c8,&quot;background-color&quot;);
+backgroundColor=_5d0?_5d0.toLowerCase():&quot;transparent&quot;;
+backgroundColor=(backgroundColor==&quot;transparent&quot;)?&quot;rgb(221, 221, 221)&quot;:backgroundColor;
+}
+dojo.body().appendChild(_5cf);
+with(_5c9.style){
+visibility=&quot;hidden&quot;;
+display=&quot;block&quot;;
+}
+var _5d1=h.toCoordinateObject(_5c9,true);
+with(_5c9.style){
+display=&quot;none&quot;;
+visibility=&quot;visible&quot;;
+}
+var _5d2={opacity:{start:0.5,end:1}};
+dojo.lang.forEach([&quot;height&quot;,&quot;width&quot;,&quot;top&quot;,&quot;left&quot;],function(type){
+_5d2[type]={start:_5ce[type],end:_5d1[type]};
+});
+var anim=new dojo.lfx.propertyAnimation(_5cf,_5d2,_5ca,_5cb,{&quot;beforeBegin&quot;:function(){
+h.setDisplay(_5cf,&quot;block&quot;);
+},&quot;onEnd&quot;:function(){
+h.setDisplay(_5c9,&quot;block&quot;);
+_5cf.parentNode.removeChild(_5cf);
+}});
+if(_5cc){
+anim.connect(&quot;onEnd&quot;,function(){
+_5cc(_5c9,anim);
+});
+}
+return anim;
+};
+dojo.lfx.html.implode=function(_5d5,end,_5d7,_5d8,_5d9){
+var h=dojo.html;
+_5d5=dojo.byId(_5d5);
+end=dojo.byId(end);
+var _5db=dojo.html.toCoordinateObject(_5d5,true);
+var _5dc=dojo.html.toCoordinateObject(end,true);
+var _5dd=document.createElement(&quot;div&quot;);
+dojo.html.copyStyle(_5dd,_5d5);
+if(_5d5.explodeClassName){
+_5dd.className=_5d5.explodeClassName;
+}
+dojo.html.setOpacity(_5dd,0.3);
+with(_5dd.style){
+position=&quot;absolute&quot;;
+display=&quot;none&quot;;
+backgroundColor=h.getStyle(_5d5,&quot;background-color&quot;).toLowerCase();
+}
+dojo.body().appendChild(_5dd);
+var _5de={opacity:{start:1,end:0.5}};
+dojo.lang.forEach([&quot;height&quot;,&quot;width&quot;,&quot;top&quot;,&quot;left&quot;],function(type){
+_5de[type]={start:_5db[type],end:_5dc[type]};
+});
+var anim=new dojo.lfx.propertyAnimation(_5dd,_5de,_5d7,_5d8,{&quot;beforeBegin&quot;:function(){
+dojo.html.hide(_5d5);
+dojo.html.show(_5dd);
+},&quot;onEnd&quot;:function(){
+_5dd.parentNode.removeChild(_5dd);
+}});
+if(_5d9){
+anim.connect(&quot;onEnd&quot;,function(){
+_5d9(_5d5,anim);
+});
+}
+return anim;
+};
+dojo.lfx.html.highlight=function(_5e1,_5e2,_5e3,_5e4,_5e5){
+_5e1=dojo.lfx.html._byId(_5e1);
+var _5e6=[];
+dojo.lang.forEach(_5e1,function(node){
+var _5e8=dojo.html.getBackgroundColor(node);
+var bg=dojo.html.getStyle(node,&quot;background-color&quot;).toLowerCase();
+var _5ea=dojo.html.getStyle(node,&quot;background-image&quot;);
+var _5eb=(bg==&quot;transparent&quot;||bg==&quot;rgba(0, 0, 0, 0)&quot;);
+while(_5e8.length&gt;3){
+_5e8.pop();
+}
+var rgb=new dojo.gfx.color.Color(_5e2);
+var _5ed=new dojo.gfx.color.Color(_5e8);
+var anim=dojo.lfx.propertyAnimation(node,{&quot;background-color&quot;:{start:rgb,end:_5ed}},_5e3,_5e4,{&quot;beforeBegin&quot;:function(){
+if(_5ea){
+node.style.backgroundImage=&quot;none&quot;;
+}
+node.style.backgroundColor=&quot;rgb(&quot;+rgb.toRgb().join(&quot;,&quot;)+&quot;)&quot;;
+},&quot;onEnd&quot;:function(){
+if(_5ea){
+node.style.backgroundImage=_5ea;
+}
+if(_5eb){
+node.style.backgroundColor=&quot;transparent&quot;;
+}
+if(_5e5){
+_5e5(node,anim);
+}
+}});
+_5e6.push(anim);
+});
+return dojo.lfx.combine(_5e6);
+};
+dojo.lfx.html.unhighlight=function(_5ef,_5f0,_5f1,_5f2,_5f3){
+_5ef=dojo.lfx.html._byId(_5ef);
+var _5f4=[];
+dojo.lang.forEach(_5ef,function(node){
+var _5f6=new dojo.gfx.color.Color(dojo.html.getBackgroundColor(node));
+var rgb=new dojo.gfx.color.Color(_5f0);
+var _5f8=dojo.html.getStyle(node,&quot;background-image&quot;);
+var anim=dojo.lfx.propertyAnimation(node,{&quot;background-color&quot;:{start:_5f6,end:rgb}},_5f1,_5f2,{&quot;beforeBegin&quot;:function(){
+if(_5f8){
+node.style.backgroundImage=&quot;none&quot;;
+}
+node.style.backgroundColor=&quot;rgb(&quot;+_5f6.toRgb().join(&quot;,&quot;)+&quot;)&quot;;
+},&quot;onEnd&quot;:function(){
+if(_5f3){
+_5f3(node,anim);
+}
+}});
+_5f4.push(anim);
+});
+return dojo.lfx.combine(_5f4);
+};
+dojo.lang.mixin(dojo.lfx,dojo.lfx.html);
+dojo.kwCompoundRequire({browser:[&quot;dojo.lfx.html&quot;],dashboard:[&quot;dojo.lfx.html&quot;]});
+dojo.provide(&quot;dojo.lfx.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/iframe_history.html
===================================================================
--- tags/parley-0.55/root/static/magic/iframe_history.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/iframe_history.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,84 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+	&quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+&lt;head&gt;
+	&lt;title&gt;&lt;/title&gt;
+	&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;/meta&gt;
+	&lt;script type=&quot;text/javascript&quot;&gt;
+	// &lt;!--
+	var noInit = false;
+	var domain = &quot;&quot;;
+	// document.domain = &quot;localhost&quot;;
+	
+	function defineParams(sparams){
+		if(sparams){
+			var ss = (sparams.indexOf(&quot;&amp;&quot;) &gt;= 0) ? &quot;&amp;&quot; : &quot;&amp;&quot;;
+			sparams = sparams.split(ss);
+			for(var x=0; x&lt;sparams.length; x++){
+				var tp = sparams[x].split(&quot;=&quot;);
+				if(typeof window[tp[0]] != &quot;undefined&quot;){
+					window[tp[0]] = ((tp[1]==&quot;true&quot;)||(tp[1]==&quot;false&quot;)) ? eval(tp[1]) : tp[1];
+				}
+			}
+		}
+	}
+	
+	function init(){
+		// parse the query string if there is one to try to get params that
+		// we can act on. Also allow params to be in a fragment identifier.
+		var query = null;
+		var frag = null;
+		var url = document.location.href;
+		var hashIndex = url.indexOf(&quot;#&quot;);
+		
+		//Extract fragment identifier
+		if(hashIndex != -1){
+			frag = url.substring(hashIndex + 1, url.length);
+			url = url.substring(0, hashIndex);
+		}
+
+		//Extract querystring
+		var parts = url.split(&quot;?&quot;);
+		if(parts.length == 2){
+			query = parts[1];
+		}
+
+		defineParams(query);
+		defineParams(frag);
+
+		if(noInit){ return; }
+		if(domain.length &gt; 0){
+			document.domain = domain;
+		}
+		var hasParentDojo = false;
+		try{
+			hasParentDojo = window.parent != window &amp;&amp; window.parent[&quot;dojo&quot;];
+		}catch(e){
+			alert(&quot;Initializing iframe_history.html failed. If you are using a cross-domain Dojo build,&quot;
+				+ &quot; please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl&quot;
+				+ &quot; to the path on your domain to iframe_history.html&quot;);
+			throw e;
+		}
+
+		if(hasParentDojo){
+			//Set the page title so IE history shows up with a somewhat correct name.
+			document.title = window.parent.document.title;
+			
+			//Notify parent that we are loaded.
+			var pdj = window.parent.dojo;
+			if(pdj[&quot;undo&quot;] &amp;&amp; pdj[&quot;undo&quot;][&quot;browser&quot;]){
+				pdj.undo.browser.iframeLoaded(null, window.location);
+			}
+		}
+
+	}
+	// --&gt;
+	&lt;/script&gt;
+&lt;/head&gt;
+&lt;body onload=&quot;try{ init(); }catch(e){ alert(e); }&quot;&gt;
+	&lt;h4&gt;The Dojo Toolkit -- iframe_history.html&lt;/h4&gt;
+
+	&lt;p&gt;This file is used in Dojo's back/fwd button management.&lt;/p&gt;
+&lt;/body&gt;
+&lt;/html&gt;

Added: tags/parley-0.55/root/static/magic/src/AdapterRegistry.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/AdapterRegistry.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/AdapterRegistry.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,44 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.AdapterRegistry&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.AdapterRegistry = function (returnWrappers) {
+	this.pairs = [];
+	this.returnWrappers = returnWrappers || false;
+};
+dojo.lang.extend(dojo.AdapterRegistry, {register:function (name, check, wrap, directReturn, override) {
+	var type = (override) ? &quot;unshift&quot; : &quot;push&quot;;
+	this.pairs[type]([name, check, wrap, directReturn]);
+}, match:function () {
+	for (var i = 0; i &lt; this.pairs.length; i++) {
+		var pair = this.pairs[i];
+		if (pair[1].apply(this, arguments)) {
+			if ((pair[3]) || (this.returnWrappers)) {
+				return pair[2];
+			} else {
+				return pair[2].apply(this, arguments);
+			}
+		}
+	}
+	throw new Error(&quot;No match found&quot;);
+}, unregister:function (name) {
+	for (var i = 0; i &lt; this.pairs.length; i++) {
+		var pair = this.pairs[i];
+		if (pair[0] == name) {
+			this.pairs.splice(i, 1);
+			return true;
+		}
+	}
+	return false;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/Deferred.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/Deferred.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/Deferred.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,165 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.Deferred&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.Deferred = function (canceller) {
+	this.chain = [];
+	this.id = this._nextId();
+	this.fired = -1;
+	this.paused = 0;
+	this.results = [null, null];
+	this.canceller = canceller;
+	this.silentlyCancelled = false;
+};
+dojo.lang.extend(dojo.Deferred, {getFunctionFromArgs:function () {
+	var a = arguments;
+	if ((a[0]) &amp;&amp; (!a[1])) {
+		if (dojo.lang.isFunction(a[0])) {
+			return a[0];
+		} else {
+			if (dojo.lang.isString(a[0])) {
+				return dj_global[a[0]];
+			}
+		}
+	} else {
+		if ((a[0]) &amp;&amp; (a[1])) {
+			return dojo.lang.hitch(a[0], a[1]);
+		}
+	}
+	return null;
+}, makeCalled:function () {
+	var deferred = new dojo.Deferred();
+	deferred.callback();
+	return deferred;
+}, repr:function () {
+	var state;
+	if (this.fired == -1) {
+		state = &quot;unfired&quot;;
+	} else {
+		if (this.fired == 0) {
+			state = &quot;success&quot;;
+		} else {
+			state = &quot;error&quot;;
+		}
+	}
+	return &quot;Deferred(&quot; + this.id + &quot;, &quot; + state + &quot;)&quot;;
+}, toString:dojo.lang.forward(&quot;repr&quot;), _nextId:(function () {
+	var n = 1;
+	return function () {
+		return n++;
+	};
+})(), cancel:function () {
+	if (this.fired == -1) {
+		if (this.canceller) {
+			this.canceller(this);
+		} else {
+			this.silentlyCancelled = true;
+		}
+		if (this.fired == -1) {
+			this.errback(new Error(this.repr()));
+		}
+	} else {
+		if ((this.fired == 0) &amp;&amp; (this.results[0] instanceof dojo.Deferred)) {
+			this.results[0].cancel();
+		}
+	}
+}, _pause:function () {
+	this.paused++;
+}, _unpause:function () {
+	this.paused--;
+	if ((this.paused == 0) &amp;&amp; (this.fired &gt;= 0)) {
+		this._fire();
+	}
+}, _continue:function (res) {
+	this._resback(res);
+	this._unpause();
+}, _resback:function (res) {
+	this.fired = ((res instanceof Error) ? 1 : 0);
+	this.results[this.fired] = res;
+	this._fire();
+}, _check:function () {
+	if (this.fired != -1) {
+		if (!this.silentlyCancelled) {
+			dojo.raise(&quot;already called!&quot;);
+		}
+		this.silentlyCancelled = false;
+		return;
+	}
+}, callback:function (res) {
+	this._check();
+	this._resback(res);
+}, errback:function (res) {
+	this._check();
+	if (!(res instanceof Error)) {
+		res = new Error(res);
+	}
+	this._resback(res);
+}, addBoth:function (cb, cbfn) {
+	var enclosed = this.getFunctionFromArgs(cb, cbfn);
+	if (arguments.length &gt; 2) {
+		enclosed = dojo.lang.curryArguments(null, enclosed, arguments, 2);
+	}
+	return this.addCallbacks(enclosed, enclosed);
+}, addCallback:function (cb, cbfn) {
+	var enclosed = this.getFunctionFromArgs(cb, cbfn);
+	if (arguments.length &gt; 2) {
+		enclosed = dojo.lang.curryArguments(null, enclosed, arguments, 2);
+	}
+	return this.addCallbacks(enclosed, null);
+}, addErrback:function (cb, cbfn) {
+	var enclosed = this.getFunctionFromArgs(cb, cbfn);
+	if (arguments.length &gt; 2) {
+		enclosed = dojo.lang.curryArguments(null, enclosed, arguments, 2);
+	}
+	return this.addCallbacks(null, enclosed);
+	return this.addCallbacks(null, cbfn);
+}, addCallbacks:function (cb, eb) {
+	this.chain.push([cb, eb]);
+	if (this.fired &gt;= 0) {
+		this._fire();
+	}
+	return this;
+}, _fire:function () {
+	var chain = this.chain;
+	var fired = this.fired;
+	var res = this.results[fired];
+	var self = this;
+	var cb = null;
+	while (chain.length &gt; 0 &amp;&amp; this.paused == 0) {
+		var pair = chain.shift();
+		var f = pair[fired];
+		if (f == null) {
+			continue;
+		}
+		try {
+			res = f(res);
+			fired = ((res instanceof Error) ? 1 : 0);
+			if (res instanceof dojo.Deferred) {
+				cb = function (res) {
+					self._continue(res);
+				};
+				this._pause();
+			}
+		}
+		catch (err) {
+			fired = 1;
+			res = err;
+		}
+	}
+	this.fired = fired;
+	this.results[fired] = res;
+	if ((cb) &amp;&amp; (this.paused)) {
+		res.addBoth(cb);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/DeferredList.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/DeferredList.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/DeferredList.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,77 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.provide(&quot;dojo.DeferredList&quot;);
+dojo.DeferredList = function (list, fireOnOneCallback, fireOnOneErrback, consumeErrors, canceller) {
+	this.list = list;
+	this.resultList = new Array(this.list.length);
+	this.chain = [];
+	this.id = this._nextId();
+	this.fired = -1;
+	this.paused = 0;
+	this.results = [null, null];
+	this.canceller = canceller;
+	this.silentlyCancelled = false;
+	if (this.list.length === 0 &amp;&amp; !fireOnOneCallback) {
+		this.callback(this.resultList);
+	}
+	this.finishedCount = 0;
+	this.fireOnOneCallback = fireOnOneCallback;
+	this.fireOnOneErrback = fireOnOneErrback;
+	this.consumeErrors = consumeErrors;
+	var index = 0;
+	var _this = this;
+	dojo.lang.forEach(this.list, function (d) {
+		var _index = index;
+		d.addCallback(function (r) {
+			_this._cbDeferred(_index, true, r);
+		});
+		d.addErrback(function (r) {
+			_this._cbDeferred(_index, false, r);
+		});
+		index++;
+	});
+};
+dojo.inherits(dojo.DeferredList, dojo.Deferred);
+dojo.lang.extend(dojo.DeferredList, {_cbDeferred:function (index, succeeded, result) {
+	this.resultList[index] = [succeeded, result];
+	this.finishedCount += 1;
+	if (this.fired !== 0) {
+		if (succeeded &amp;&amp; this.fireOnOneCallback) {
+			this.callback([index, result]);
+		} else {
+			if (!succeeded &amp;&amp; this.fireOnOneErrback) {
+				this.errback(result);
+			} else {
+				if (this.finishedCount == this.list.length) {
+					this.callback(this.resultList);
+				}
+			}
+		}
+	}
+	if (!succeeded &amp;&amp; this.consumeErrors) {
+		result = null;
+	}
+	return result;
+}, gatherResults:function (deferredList) {
+	var d = new dojo.DeferredList(deferredList, false, true, false);
+	d.addCallback(function (results) {
+		var ret = [];
+		for (var i = 0; i &lt; results.length; i++) {
+			ret.push(results[i][1]);
+		}
+		return ret;
+	});
+	return d;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/a11y.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/a11y.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/a11y.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.a11y&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.a11y = {imgPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images&quot;), doAccessibleCheck:true, accessible:null, checkAccessible:function () {
+	if (this.accessible === null) {
+		this.accessible = false;
+		if (this.doAccessibleCheck == true) {
+			this.accessible = this.testAccessible();
+		}
+	}
+	return this.accessible;
+}, testAccessible:function () {
+	this.accessible = false;
+	if (dojo.render.html.ie || dojo.render.html.mozilla) {
+		var div = document.createElement(&quot;div&quot;);
+		div.style.backgroundImage = &quot;url(\&quot;&quot; + this.imgPath + &quot;/tab_close.gif\&quot;)&quot;;
+		dojo.body().appendChild(div);
+		var bkImg = null;
+		if (window.getComputedStyle) {
+			var cStyle = getComputedStyle(div, &quot;&quot;);
+			bkImg = cStyle.getPropertyValue(&quot;background-image&quot;);
+		} else {
+			bkImg = div.currentStyle.backgroundImage;
+		}
+		var bUseImgElem = false;
+		if (bkImg != null &amp;&amp; (bkImg == &quot;none&quot; || bkImg == &quot;url(invalid-url:)&quot;)) {
+			this.accessible = true;
+		}
+		dojo.body().removeChild(div);
+	}
+	return this.accessible;
+}, setCheckAccessible:function (bTest) {
+	this.doAccessibleCheck = bTest;
+}, setAccessibleMode:function () {
+	if (this.accessible === null) {
+		if (this.checkAccessible()) {
+			dojo.render.html.prefixes.unshift(&quot;a11y&quot;);
+		}
+	}
+	return this.accessible;
+}};
+

Added: tags/parley-0.55/root/static/magic/src/animation/Animation.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/animation/Animation.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/animation/Animation.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,180 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.animation.Animation&quot;);
+dojo.require(&quot;dojo.animation.AnimationEvent&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.math.curves&quot;);
+dojo.deprecated(&quot;dojo.animation.Animation is slated for removal in 0.5; use dojo.lfx.* instead.&quot;, &quot;0.5&quot;);
+dojo.animation.Animation = function (curve, duration, accel, repeatCount, rate) {
+	if (dojo.lang.isArray(curve)) {
+		curve = new dojo.math.curves.Line(curve[0], curve[1]);
+	}
+	this.curve = curve;
+	this.duration = duration;
+	this.repeatCount = repeatCount || 0;
+	this.rate = rate || 25;
+	if (accel) {
+		if (dojo.lang.isFunction(accel.getValue)) {
+			this.accel = accel;
+		} else {
+			var i = 0.35 * accel + 0.5;
+			this.accel = new dojo.math.curves.CatmullRom([[0], [i], [1]], 0.45);
+		}
+	}
+};
+dojo.lang.extend(dojo.animation.Animation, {curve:null, duration:0, repeatCount:0, accel:null, onBegin:null, onAnimate:null, onEnd:null, onPlay:null, onPause:null, onStop:null, handler:null, _animSequence:null, _startTime:null, _endTime:null, _lastFrame:null, _timer:null, _percent:0, _active:false, _paused:false, _startRepeatCount:0, play:function (gotoStart) {
+	if (gotoStart) {
+		clearTimeout(this._timer);
+		this._active = false;
+		this._paused = false;
+		this._percent = 0;
+	} else {
+		if (this._active &amp;&amp; !this._paused) {
+			return;
+		}
+	}
+	this._startTime = new Date().valueOf();
+	if (this._paused) {
+		this._startTime -= (this.duration * this._percent / 100);
+	}
+	this._endTime = this._startTime + this.duration;
+	this._lastFrame = this._startTime;
+	var e = new dojo.animation.AnimationEvent(this, null, this.curve.getValue(this._percent), this._startTime, this._startTime, this._endTime, this.duration, this._percent, 0);
+	this._active = true;
+	this._paused = false;
+	if (this._percent == 0) {
+		if (!this._startRepeatCount) {
+			this._startRepeatCount = this.repeatCount;
+		}
+		e.type = &quot;begin&quot;;
+		if (typeof this.handler == &quot;function&quot;) {
+			this.handler(e);
+		}
+		if (typeof this.onBegin == &quot;function&quot;) {
+			this.onBegin(e);
+		}
+	}
+	e.type = &quot;play&quot;;
+	if (typeof this.handler == &quot;function&quot;) {
+		this.handler(e);
+	}
+	if (typeof this.onPlay == &quot;function&quot;) {
+		this.onPlay(e);
+	}
+	if (this._animSequence) {
+		this._animSequence._setCurrent(this);
+	}
+	this._cycle();
+}, pause:function () {
+	clearTimeout(this._timer);
+	if (!this._active) {
+		return;
+	}
+	this._paused = true;
+	var e = new dojo.animation.AnimationEvent(this, &quot;pause&quot;, this.curve.getValue(this._percent), this._startTime, new Date().valueOf(), this._endTime, this.duration, this._percent, 0);
+	if (typeof this.handler == &quot;function&quot;) {
+		this.handler(e);
+	}
+	if (typeof this.onPause == &quot;function&quot;) {
+		this.onPause(e);
+	}
+}, playPause:function () {
+	if (!this._active || this._paused) {
+		this.play();
+	} else {
+		this.pause();
+	}
+}, gotoPercent:function (pct, andPlay) {
+	clearTimeout(this._timer);
+	this._active = true;
+	this._paused = true;
+	this._percent = pct;
+	if (andPlay) {
+		this.play();
+	}
+}, stop:function (gotoEnd) {
+	clearTimeout(this._timer);
+	var step = this._percent / 100;
+	if (gotoEnd) {
+		step = 1;
+	}
+	var e = new dojo.animation.AnimationEvent(this, &quot;stop&quot;, this.curve.getValue(step), this._startTime, new Date().valueOf(), this._endTime, this.duration, this._percent);
+	if (typeof this.handler == &quot;function&quot;) {
+		this.handler(e);
+	}
+	if (typeof this.onStop == &quot;function&quot;) {
+		this.onStop(e);
+	}
+	this._active = false;
+	this._paused = false;
+}, status:function () {
+	if (this._active) {
+		return this._paused ? &quot;paused&quot; : &quot;playing&quot;;
+	} else {
+		return &quot;stopped&quot;;
+	}
+}, _cycle:function () {
+	clearTimeout(this._timer);
+	if (this._active) {
+		var curr = new Date().valueOf();
+		var step = (curr - this._startTime) / (this._endTime - this._startTime);
+		var fps = 1000 / (curr - this._lastFrame);
+		this._lastFrame = curr;
+		if (step &gt;= 1) {
+			step = 1;
+			this._percent = 100;
+		} else {
+			this._percent = step * 100;
+		}
+		if (this.accel &amp;&amp; this.accel.getValue) {
+			step = this.accel.getValue(step);
+		}
+		var e = new dojo.animation.AnimationEvent(this, &quot;animate&quot;, this.curve.getValue(step), this._startTime, curr, this._endTime, this.duration, this._percent, Math.round(fps));
+		if (typeof this.handler == &quot;function&quot;) {
+			this.handler(e);
+		}
+		if (typeof this.onAnimate == &quot;function&quot;) {
+			this.onAnimate(e);
+		}
+		if (step &lt; 1) {
+			this._timer = setTimeout(dojo.lang.hitch(this, &quot;_cycle&quot;), this.rate);
+		} else {
+			e.type = &quot;end&quot;;
+			this._active = false;
+			if (typeof this.handler == &quot;function&quot;) {
+				this.handler(e);
+			}
+			if (typeof this.onEnd == &quot;function&quot;) {
+				this.onEnd(e);
+			}
+			if (this.repeatCount &gt; 0) {
+				this.repeatCount--;
+				this.play(true);
+			} else {
+				if (this.repeatCount == -1) {
+					this.play(true);
+				} else {
+					if (this._startRepeatCount) {
+						this.repeatCount = this._startRepeatCount;
+						this._startRepeatCount = 0;
+					}
+					if (this._animSequence) {
+						this._animSequence._playNext();
+					}
+				}
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/animation/AnimationEvent.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/animation/AnimationEvent.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/animation/AnimationEvent.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,37 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.animation.AnimationEvent&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.deprecated(&quot;dojo.animation.AnimationEvent is slated for removal in 0.5; use dojo.lfx.* instead.&quot;, &quot;0.5&quot;);
+dojo.animation.AnimationEvent = function (animation, type, coords, startTime, currentTime, endTime, duration, percent, fps) {
+	this.type = type;
+	this.animation = animation;
+	this.coords = coords;
+	this.x = coords[0];
+	this.y = coords[1];
+	this.z = coords[2];
+	this.startTime = startTime;
+	this.currentTime = currentTime;
+	this.endTime = endTime;
+	this.duration = duration;
+	this.percent = percent;
+	this.fps = fps;
+};
+dojo.extend(dojo.animation.AnimationEvent, {coordsAsInts:function () {
+	var cints = new Array(this.coords.length);
+	for (var i = 0; i &lt; this.coords.length; i++) {
+		cints[i] = Math.round(this.coords[i]);
+	}
+	return cints;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/animation/AnimationSequence.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/animation/AnimationSequence.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/animation/AnimationSequence.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,128 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.animation.AnimationSequence&quot;);
+dojo.require(&quot;dojo.animation.AnimationEvent&quot;);
+dojo.require(&quot;dojo.animation.Animation&quot;);
+dojo.deprecated(&quot;dojo.animation.AnimationSequence is slated for removal in 0.5; use dojo.lfx.* instead.&quot;, &quot;0.5&quot;);
+dojo.animation.AnimationSequence = function (repeatCount) {
+	this._anims = [];
+	this.repeatCount = repeatCount || 0;
+};
+dojo.lang.extend(dojo.animation.AnimationSequence, {repeatCount:0, _anims:[], _currAnim:-1, onBegin:null, onEnd:null, onNext:null, handler:null, add:function () {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		this._anims.push(arguments[i]);
+		arguments[i]._animSequence = this;
+	}
+}, remove:function (anim) {
+	for (var i = 0; i &lt; this._anims.length; i++) {
+		if (this._anims[i] == anim) {
+			this._anims[i]._animSequence = null;
+			this._anims.splice(i, 1);
+			break;
+		}
+	}
+}, removeAll:function () {
+	for (var i = 0; i &lt; this._anims.length; i++) {
+		this._anims[i]._animSequence = null;
+	}
+	this._anims = [];
+	this._currAnim = -1;
+}, clear:function () {
+	this.removeAll();
+}, play:function (gotoStart) {
+	if (this._anims.length == 0) {
+		return;
+	}
+	if (gotoStart || !this._anims[this._currAnim]) {
+		this._currAnim = 0;
+	}
+	if (this._anims[this._currAnim]) {
+		if (this._currAnim == 0) {
+			var e = {type:&quot;begin&quot;, animation:this._anims[this._currAnim]};
+			if (typeof this.handler == &quot;function&quot;) {
+				this.handler(e);
+			}
+			if (typeof this.onBegin == &quot;function&quot;) {
+				this.onBegin(e);
+			}
+		}
+		this._anims[this._currAnim].play(gotoStart);
+	}
+}, pause:function () {
+	if (this._anims[this._currAnim]) {
+		this._anims[this._currAnim].pause();
+	}
+}, playPause:function () {
+	if (this._anims.length == 0) {
+		return;
+	}
+	if (this._currAnim == -1) {
+		this._currAnim = 0;
+	}
+	if (this._anims[this._currAnim]) {
+		this._anims[this._currAnim].playPause();
+	}
+}, stop:function () {
+	if (this._anims[this._currAnim]) {
+		this._anims[this._currAnim].stop();
+	}
+}, status:function () {
+	if (this._anims[this._currAnim]) {
+		return this._anims[this._currAnim].status();
+	} else {
+		return &quot;stopped&quot;;
+	}
+}, _setCurrent:function (anim) {
+	for (var i = 0; i &lt; this._anims.length; i++) {
+		if (this._anims[i] == anim) {
+			this._currAnim = i;
+			break;
+		}
+	}
+}, _playNext:function () {
+	if (this._currAnim == -1 || this._anims.length == 0) {
+		return;
+	}
+	this._currAnim++;
+	if (this._anims[this._currAnim]) {
+		var e = {type:&quot;next&quot;, animation:this._anims[this._currAnim]};
+		if (typeof this.handler == &quot;function&quot;) {
+			this.handler(e);
+		}
+		if (typeof this.onNext == &quot;function&quot;) {
+			this.onNext(e);
+		}
+		this._anims[this._currAnim].play(true);
+	} else {
+		var e = {type:&quot;end&quot;, animation:this._anims[this._anims.length - 1]};
+		if (typeof this.handler == &quot;function&quot;) {
+			this.handler(e);
+		}
+		if (typeof this.onEnd == &quot;function&quot;) {
+			this.onEnd(e);
+		}
+		if (this.repeatCount &gt; 0) {
+			this._currAnim = 0;
+			this.repeatCount--;
+			this._anims[this._currAnim].play(true);
+		} else {
+			if (this.repeatCount == -1) {
+				this._currAnim = 0;
+				this._anims[this._currAnim].play(true);
+			} else {
+				this._currAnim = -1;
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/animation/Timer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/animation/Timer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/animation/Timer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,17 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.animation.Timer&quot;);
+dojo.require(&quot;dojo.lang.timing.Timer&quot;);
+dojo.deprecated(&quot;dojo.animation.Timer is now dojo.lang.timing.Timer&quot;, &quot;0.5&quot;);
+dojo.animation.Timer = dojo.lang.timing.Timer;
+

Added: tags/parley-0.55/root/static/magic/src/animation/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/animation/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/animation/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.animation.AnimationEvent&quot;, &quot;dojo.animation.Animation&quot;, &quot;dojo.animation.AnimationSequence&quot;]});
+dojo.provide(&quot;dojo.animation.*&quot;);
+dojo.deprecated(&quot;dojo.Animation.* is slated for removal in 0.5; use dojo.lfx.* instead.&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/animation.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/animation.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/animation.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.animation&quot;);
+dojo.require(&quot;dojo.animation.Animation&quot;);
+dojo.deprecated(&quot;dojo.animation is slated for removal in 0.5; use dojo.lfx instead.&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/behavior.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/behavior.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/behavior.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,150 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.behavior&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.behavior&quot;);
+dojo.behavior = new function () {
+	function arrIn(obj, name) {
+		if (!obj[name]) {
+			obj[name] = [];
+		}
+		return obj[name];
+	}
+	function forIn(obj, scope, func) {
+		var tmpObj = {};
+		for (var x in obj) {
+			if (typeof tmpObj[x] == &quot;undefined&quot;) {
+				if (!func) {
+					scope(obj[x], x);
+				} else {
+					func.call(scope, obj[x], x);
+				}
+			}
+		}
+	}
+	this.behaviors = {};
+	this.add = function (behaviorObj) {
+		var tmpObj = {};
+		forIn(behaviorObj, this, function (behavior, name) {
+			var tBehavior = arrIn(this.behaviors, name);
+			if ((dojo.lang.isString(behavior)) || (dojo.lang.isFunction(behavior))) {
+				behavior = {found:behavior};
+			}
+			forIn(behavior, function (rule, ruleName) {
+				arrIn(tBehavior, ruleName).push(rule);
+			});
+		});
+	};
+	this.apply = function () {
+		dojo.profile.start(&quot;dojo.behavior.apply&quot;);
+		var r = dojo.render.html;
+		var safariGoodEnough = (!r.safari);
+		if (r.safari) {
+			var uas = r.UA.split(&quot;AppleWebKit/&quot;)[1];
+			if (parseInt(uas.match(/[0-9.]{3,}/)) &gt;= 420) {
+				safariGoodEnough = true;
+			}
+		}
+		if ((dj_undef(&quot;behaviorFastParse&quot;, djConfig) ? (safariGoodEnough) : djConfig[&quot;behaviorFastParse&quot;])) {
+			this.applyFast();
+		} else {
+			this.applySlow();
+		}
+		dojo.profile.end(&quot;dojo.behavior.apply&quot;);
+	};
+	this.matchCache = {};
+	this.elementsById = function (id, handleRemoved) {
+		var removed = [];
+		var added = [];
+		arrIn(this.matchCache, id);
+		if (handleRemoved) {
+			var nodes = this.matchCache[id];
+			for (var x = 0; x &lt; nodes.length; x++) {
+				if (nodes[x].id != &quot;&quot;) {
+					removed.push(nodes[x]);
+					nodes.splice(x, 1);
+					x--;
+				}
+			}
+		}
+		var tElem = dojo.byId(id);
+		while (tElem) {
+			if (!tElem[&quot;idcached&quot;]) {
+				added.push(tElem);
+			}
+			tElem.id = &quot;&quot;;
+			tElem = dojo.byId(id);
+		}
+		this.matchCache[id] = this.matchCache[id].concat(added);
+		dojo.lang.forEach(this.matchCache[id], function (node) {
+			node.id = id;
+			node.idcached = true;
+		});
+		return {&quot;removed&quot;:removed, &quot;added&quot;:added, &quot;match&quot;:this.matchCache[id]};
+	};
+	this.applyToNode = function (node, action, ruleSetName) {
+		if (typeof action == &quot;string&quot;) {
+			dojo.event.topic.registerPublisher(action, node, ruleSetName);
+		} else {
+			if (typeof action == &quot;function&quot;) {
+				if (ruleSetName == &quot;found&quot;) {
+					action(node);
+				} else {
+					dojo.event.connect(node, ruleSetName, action);
+				}
+			} else {
+				action.srcObj = node;
+				action.srcFunc = ruleSetName;
+				dojo.event.kwConnect(action);
+			}
+		}
+	};
+	this.applyFast = function () {
+		dojo.profile.start(&quot;dojo.behavior.applyFast&quot;);
+		forIn(this.behaviors, function (tBehavior, id) {
+			var elems = dojo.behavior.elementsById(id);
+			dojo.lang.forEach(elems.added, function (elem) {
+				forIn(tBehavior, function (ruleSet, ruleSetName) {
+					if (dojo.lang.isArray(ruleSet)) {
+						dojo.lang.forEach(ruleSet, function (action) {
+							dojo.behavior.applyToNode(elem, action, ruleSetName);
+						});
+					}
+				});
+			});
+		});
+		dojo.profile.end(&quot;dojo.behavior.applyFast&quot;);
+	};
+	this.applySlow = function () {
+		dojo.profile.start(&quot;dojo.behavior.applySlow&quot;);
+		var all = document.getElementsByTagName(&quot;*&quot;);
+		var allLen = all.length;
+		for (var x = 0; x &lt; allLen; x++) {
+			var elem = all[x];
+			if ((elem.id) &amp;&amp; (!elem[&quot;behaviorAdded&quot;]) &amp;&amp; (this.behaviors[elem.id])) {
+				elem[&quot;behaviorAdded&quot;] = true;
+				forIn(this.behaviors[elem.id], function (ruleSet, ruleSetName) {
+					if (dojo.lang.isArray(ruleSet)) {
+						dojo.lang.forEach(ruleSet, function (action) {
+							dojo.behavior.applyToNode(elem, action, ruleSetName);
+						});
+					}
+				});
+			}
+		}
+		dojo.profile.end(&quot;dojo.behavior.applySlow&quot;);
+	};
+};
+dojo.addOnLoad(dojo.behavior, &quot;apply&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/bootstrap1.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/bootstrap1.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/bootstrap1.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,160 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+var dj_global = this;
+var dj_currentContext = this;
+function dj_undef(name, object) {
+	return (typeof (object || dj_currentContext)[name] == &quot;undefined&quot;);
+}
+if (dj_undef(&quot;djConfig&quot;, this)) {
+	var djConfig = {};
+}
+if (dj_undef(&quot;dojo&quot;, this)) {
+	var dojo = {};
+}
+dojo.global = function () {
+	return dj_currentContext;
+};
+dojo.locale = djConfig.locale;
+dojo.version = {major:0, minor:4, patch:3, flag:&quot;&quot;, revision:Number(&quot;$Rev: 8617 $&quot;.match(/[0-9]+/)[0]), toString:function () {
+	with (dojo.version) {
+		return major + &quot;.&quot; + minor + &quot;.&quot; + patch + flag + &quot; (&quot; + revision + &quot;)&quot;;
+	}
+}};
+dojo.evalProp = function (name, object, create) {
+	if ((!object) || (!name)) {
+		return undefined;
+	}
+	if (!dj_undef(name, object)) {
+		return object[name];
+	}
+	return (create ? (object[name] = {}) : undefined);
+};
+dojo.parseObjPath = function (path, context, create) {
+	var object = (context || dojo.global());
+	var names = path.split(&quot;.&quot;);
+	var prop = names.pop();
+	for (var i = 0, l = names.length; i &lt; l &amp;&amp; object; i++) {
+		object = dojo.evalProp(names[i], object, create);
+	}
+	return {obj:object, prop:prop};
+};
+dojo.evalObjPath = function (path, create) {
+	if (typeof path != &quot;string&quot;) {
+		return dojo.global();
+	}
+	if (path.indexOf(&quot;.&quot;) == -1) {
+		return dojo.evalProp(path, dojo.global(), create);
+	}
+	var ref = dojo.parseObjPath(path, dojo.global(), create);
+	if (ref) {
+		return dojo.evalProp(ref.prop, ref.obj, create);
+	}
+	return null;
+};
+dojo.errorToString = function (exception) {
+	if (!dj_undef(&quot;message&quot;, exception)) {
+		return exception.message;
+	} else {
+		if (!dj_undef(&quot;description&quot;, exception)) {
+			return exception.description;
+		} else {
+			return exception;
+		}
+	}
+};
+dojo.raise = function (message, exception) {
+	if (exception) {
+		message = message + &quot;: &quot; + dojo.errorToString(exception);
+	} else {
+		message = dojo.errorToString(message);
+	}
+	try {
+		if (djConfig.isDebug) {
+			dojo.hostenv.println(&quot;FATAL exception raised: &quot; + message);
+		}
+	}
+	catch (e) {
+	}
+	throw exception || Error(message);
+};
+dojo.debug = function () {
+};
+dojo.debugShallow = function (obj) {
+};
+dojo.profile = {start:function () {
+}, end:function () {
+}, stop:function () {
+}, dump:function () {
+}};
+function dj_eval(scriptFragment) {
+	return dj_global.eval ? dj_global.eval(scriptFragment) : eval(scriptFragment);
+}
+dojo.unimplemented = function (funcname, extra) {
+	var message = &quot;'&quot; + funcname + &quot;' not implemented&quot;;
+	if (extra != null) {
+		message += &quot; &quot; + extra;
+	}
+	dojo.raise(message);
+};
+dojo.deprecated = function (behaviour, extra, removal) {
+	var message = &quot;DEPRECATED: &quot; + behaviour;
+	if (extra) {
+		message += &quot; &quot; + extra;
+	}
+	if (removal) {
+		message += &quot; -- will be removed in version: &quot; + removal;
+	}
+	dojo.debug(message);
+};
+dojo.render = (function () {
+	function vscaffold(prefs, names) {
+		var tmp = {capable:false, support:{builtin:false, plugin:false}, prefixes:prefs};
+		for (var i = 0; i &lt; names.length; i++) {
+			tmp[names[i]] = false;
+		}
+		return tmp;
+	}
+	return {name:&quot;&quot;, ver:dojo.version, os:{win:false, linux:false, osx:false}, html:vscaffold([&quot;html&quot;], [&quot;ie&quot;, &quot;opera&quot;, &quot;khtml&quot;, &quot;safari&quot;, &quot;moz&quot;]), svg:vscaffold([&quot;svg&quot;], [&quot;corel&quot;, &quot;adobe&quot;, &quot;batik&quot;]), vml:vscaffold([&quot;vml&quot;], [&quot;ie&quot;]), swf:vscaffold([&quot;Swf&quot;, &quot;Flash&quot;, &quot;Mm&quot;], [&quot;mm&quot;]), swt:vscaffold([&quot;Swt&quot;], [&quot;ibm&quot;])};
+})();
+dojo.hostenv = (function () {
+	var config = {isDebug:false, allowQueryConfig:false, baseScriptUri:&quot;&quot;, baseRelativePath:&quot;&quot;, libraryScriptUri:&quot;&quot;, iePreventClobber:false, ieClobberMinimal:true, preventBackButtonFix:true, delayMozLoadingFix:false, searchIds:[], parseWidgets:true};
+	if (typeof djConfig == &quot;undefined&quot;) {
+		djConfig = config;
+	} else {
+		for (var option in config) {
+			if (typeof djConfig[option] == &quot;undefined&quot;) {
+				djConfig[option] = config[option];
+			}
+		}
+	}
+	return {name_:&quot;(unset)&quot;, version_:&quot;(unset)&quot;, getName:function () {
+		return this.name_;
+	}, getVersion:function () {
+		return this.version_;
+	}, getText:function (uri) {
+		dojo.unimplemented(&quot;getText&quot;, &quot;uri=&quot; + uri);
+	}};
+})();
+dojo.hostenv.getBaseScriptUri = function () {
+	if (djConfig.baseScriptUri.length) {
+		return djConfig.baseScriptUri;
+	}
+	var uri = new String(djConfig.libraryScriptUri || djConfig.baseRelativePath);
+	if (!uri) {
+		dojo.raise(&quot;Nothing returned by getLibraryScriptUri(): &quot; + uri);
+	}
+	var lastslash = uri.lastIndexOf(&quot;/&quot;);
+	djConfig.baseScriptUri = djConfig.baseRelativePath;
+	return djConfig.baseScriptUri;
+};
+

Added: tags/parley-0.55/root/static/magic/src/browser_debug.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/browser_debug.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/browser_debug.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,135 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.browser_debug&quot;);
+dojo.hostenv.loadedUris.push(&quot;../src/bootstrap1.js&quot;);
+dojo.hostenv.loadedUris.push(&quot;../src/loader.js&quot;);
+dojo.hostenv.loadedUris.push(&quot;../src/hostenv_browser.js&quot;);
+dojo.hostenv._loadedUrisListStart = dojo.hostenv.loadedUris.length;
+function removeComments(contents) {
+	contents = new String((!contents) ? &quot;&quot; : contents);
+	contents = contents.replace(/^(.*?)\/\/(.*)$/mg, &quot;$1&quot;);
+	contents = contents.replace(/(\n)/mg, &quot;__DOJONEWLINE&quot;);
+	contents = contents.replace(/\/\*(.*?)\*\//g, &quot;&quot;);
+	return contents.replace(/__DOJONEWLINE/mg, &quot;\n&quot;);
+}
+dojo.hostenv.getRequiresAndProvides = function (contents) {
+	if (!contents) {
+		return [];
+	}
+	var deps = [];
+	var tmp;
+	RegExp.lastIndex = 0;
+	var testExp = /dojo.(hostenv.loadModule|hostenv.require|require|requireIf|kwCompoundRequire|hostenv.conditionalLoadModule|hostenv.startPackage|provide)\([\w\W]*?\)/mg;
+	while ((tmp = testExp.exec(contents)) != null) {
+		deps.push(tmp[0]);
+	}
+	return deps;
+};
+dojo.hostenv.getDelayRequiresAndProvides = function (contents) {
+	if (!contents) {
+		return [];
+	}
+	var deps = [];
+	var tmp;
+	RegExp.lastIndex = 0;
+	var testExp = /dojo.(requireAfterIf)\([\w\W]*?\)/mg;
+	while ((tmp = testExp.exec(contents)) != null) {
+		deps.push(tmp[0]);
+	}
+	return deps;
+};
+dojo.clobberLastObject = function (objpath) {
+	if (objpath.indexOf(&quot;.&quot;) == -1) {
+		if (!dj_undef(objpath, dj_global)) {
+			delete dj_global[objpath];
+		}
+		return true;
+	}
+	var syms = objpath.split(/\./);
+	var base = dojo.evalObjPath(syms.slice(0, -1).join(&quot;.&quot;), false);
+	var child = syms[syms.length - 1];
+	if (!dj_undef(child, base)) {
+		delete base[child];
+		return true;
+	}
+	return false;
+};
+var removals = [];
+function zip(arr) {
+	var ret = [];
+	var seen = {};
+	for (var x = 0; x &lt; arr.length; x++) {
+		if (!seen[arr[x]]) {
+			ret.push(arr[x]);
+			seen[arr[x]] = true;
+		}
+	}
+	return ret;
+}
+var old_dj_eval = dj_eval;
+dj_eval = function () {
+	return true;
+};
+dojo.hostenv.oldLoadUri = dojo.hostenv.loadUri;
+dojo.hostenv.loadUri = function (uri, cb) {
+	if (dojo.hostenv.loadedUris[uri]) {
+		return true;
+	}
+	try {
+		var text = this.getText(uri, null, true);
+		if (!text) {
+			return false;
+		}
+		if (cb) {
+			var expr = old_dj_eval(&quot;(&quot; + text + &quot;)&quot;);
+			cb(expr);
+		} else {
+			var requires = dojo.hostenv.getRequiresAndProvides(text);
+			eval(requires.join(&quot;;&quot;));
+			dojo.hostenv.loadedUris.push(uri);
+			dojo.hostenv.loadedUris[uri] = true;
+			var delayRequires = dojo.hostenv.getDelayRequiresAndProvides(text);
+			eval(delayRequires.join(&quot;;&quot;));
+		}
+	}
+	catch (e) {
+		alert(e);
+	}
+	return true;
+};
+dojo.hostenv._writtenIncludes = {};
+dojo.hostenv.writeIncludes = function (willCallAgain) {
+	for (var x = removals.length - 1; x &gt;= 0; x--) {
+		dojo.clobberLastObject(removals[x]);
+	}
+	var depList = [];
+	var seen = dojo.hostenv._writtenIncludes;
+	for (var x = 0; x &lt; dojo.hostenv.loadedUris.length; x++) {
+		var curi = dojo.hostenv.loadedUris[x];
+		if (!seen[curi]) {
+			seen[curi] = true;
+			depList.push(curi);
+		}
+	}
+	dojo.hostenv._global_omit_module_check = true;
+	for (var x = dojo.hostenv._loadedUrisListStart; x &lt; depList.length; x++) {
+		document.write(&quot;&lt;script type='text/javascript' src='&quot; + depList[x] + &quot;'&gt;&lt;/script&gt;&quot;);
+	}
+	document.write(&quot;&lt;script type='text/javascript'&gt;dojo.hostenv._global_omit_module_check = false;&lt;/script&gt;&quot;);
+	dojo.hostenv._loadedUrisListStart = 0;
+	if (!willCallAgain) {
+		dj_eval = old_dj_eval;
+		dojo.hostenv.loadUri = dojo.hostenv.oldLoadUri;
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/browser_debug_xd.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/browser_debug_xd.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/browser_debug_xd.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,38 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.browser_debug_xd&quot;);
+dojo.nonDebugProvide = dojo.provide;
+dojo.provide = function (resourceName) {
+	var dbgQueue = dojo.hostenv[&quot;xdDebugQueue&quot;];
+	if (dbgQueue &amp;&amp; dbgQueue.length &gt; 0 &amp;&amp; resourceName == dbgQueue[&quot;currentResourceName&quot;]) {
+		window.setTimeout(&quot;dojo.hostenv.xdDebugFileLoaded('&quot; + resourceName + &quot;')&quot;, 1);
+	}
+	dojo.nonDebugProvide.apply(dojo, arguments);
+};
+dojo.hostenv.xdDebugFileLoaded = function (resourceName) {
+	var dbgQueue = this.xdDebugQueue;
+	if (resourceName &amp;&amp; resourceName == dbgQueue.currentResourceName) {
+		dbgQueue.shift();
+	}
+	if (dbgQueue.length == 0) {
+		dbgQueue.currentResourceName = null;
+		this.xdNotifyLoaded();
+	} else {
+		dbgQueue.currentResourceName = dbgQueue[0].resourceName;
+		var element = document.createElement(&quot;script&quot;);
+		element.type = &quot;text/javascript&quot;;
+		element.src = dbgQueue[0].resourcePath;
+		document.getElementsByTagName(&quot;head&quot;)[0].appendChild(element);
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/cal/iCalendar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/cal/iCalendar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/cal/iCalendar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,567 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.cal.iCalendar&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.cal.textDirectory&quot;);
+dojo.require(&quot;dojo.date.common&quot;);
+dojo.require(&quot;dojo.date.serialize&quot;);
+dojo.cal.iCalendar.fromText = function (text) {
+	var properties = dojo.cal.textDirectory.tokenise(text);
+	var calendars = [];
+	for (var i = 0, begun = false; i &lt; properties.length; i++) {
+		var prop = properties[i];
+		if (!begun) {
+			if (prop.name == &quot;BEGIN&quot; &amp;&amp; prop.value == &quot;VCALENDAR&quot;) {
+				begun = true;
+				var calbody = [];
+			}
+		} else {
+			if (prop.name == &quot;END&quot; &amp;&amp; prop.value == &quot;VCALENDAR&quot;) {
+				calendars.push(new dojo.cal.iCalendar.VCalendar(calbody));
+				begun = false;
+			} else {
+				calbody.push(prop);
+			}
+		}
+	}
+	return calendars;
+};
+dojo.cal.iCalendar.Component = function (body) {
+	if (!this.name) {
+		this.name = &quot;COMPONENT&quot;;
+	}
+	this.properties = [];
+	this.components = [];
+	if (body) {
+		for (var i = 0, context = &quot;&quot;; i &lt; body.length; i++) {
+			if (context == &quot;&quot;) {
+				if (body[i].name == &quot;BEGIN&quot;) {
+					context = body[i].value;
+					var childprops = [];
+				} else {
+					this.addProperty(new dojo.cal.iCalendar.Property(body[i]));
+				}
+			} else {
+				if (body[i].name == &quot;END&quot; &amp;&amp; body[i].value == context) {
+					if (context == &quot;VEVENT&quot;) {
+						this.addComponent(new dojo.cal.iCalendar.VEvent(childprops));
+					} else {
+						if (context == &quot;VTIMEZONE&quot;) {
+							this.addComponent(new dojo.cal.iCalendar.VTimeZone(childprops));
+						} else {
+							if (context == &quot;VTODO&quot;) {
+								this.addComponent(new dojo.cal.iCalendar.VTodo(childprops));
+							} else {
+								if (context == &quot;VJOURNAL&quot;) {
+									this.addComponent(new dojo.cal.iCalendar.VJournal(childprops));
+								} else {
+									if (context == &quot;VFREEBUSY&quot;) {
+										this.addComponent(new dojo.cal.iCalendar.VFreeBusy(childprops));
+									} else {
+										if (context == &quot;STANDARD&quot;) {
+											this.addComponent(new dojo.cal.iCalendar.Standard(childprops));
+										} else {
+											if (context == &quot;DAYLIGHT&quot;) {
+												this.addComponent(new dojo.cal.iCalendar.Daylight(childprops));
+											} else {
+												if (context == &quot;VALARM&quot;) {
+													this.addComponent(new dojo.cal.iCalendar.VAlarm(childprops));
+												} else {
+													dojo.unimplemented(&quot;dojo.cal.iCalendar.&quot; + context);
+												}
+											}
+										}
+									}
+								}
+							}
+						}
+					}
+					context = &quot;&quot;;
+				} else {
+					childprops.push(body[i]);
+				}
+			}
+		}
+		if (this._ValidProperties) {
+			this.postCreate();
+		}
+	}
+};
+dojo.extend(dojo.cal.iCalendar.Component, {addProperty:function (prop) {
+	this.properties.push(prop);
+	this[prop.name.toLowerCase()] = prop;
+}, addComponent:function (prop) {
+	this.components.push(prop);
+}, postCreate:function () {
+	for (var x = 0; x &lt; this._ValidProperties.length; x++) {
+		var evtProperty = this._ValidProperties[x];
+		var found = false;
+		for (var y = 0; y &lt; this.properties.length; y++) {
+			var prop = this.properties[y];
+			var propName = prop.name.toLowerCase();
+			if (dojo.lang.isArray(evtProperty)) {
+				var alreadySet = false;
+				for (var z = 0; z &lt; evtProperty.length; z++) {
+					var evtPropertyName = evtProperty[z].name.toLowerCase();
+					if ((this[evtPropertyName]) &amp;&amp; (evtPropertyName != propName)) {
+						alreadySet = true;
+					}
+				}
+				if (!alreadySet) {
+					this[propName] = prop;
+				}
+			} else {
+				if (propName == evtProperty.name.toLowerCase()) {
+					found = true;
+					if (evtProperty.occurance == 1) {
+						this[propName] = prop;
+					} else {
+						found = true;
+						if (!dojo.lang.isArray(this[propName])) {
+							this[propName] = [];
+						}
+						this[propName].push(prop);
+					}
+				}
+			}
+		}
+		if (evtProperty.required &amp;&amp; !found) {
+			dojo.debug(&quot;iCalendar - &quot; + this.name + &quot;: Required Property not found: &quot; + evtProperty.name);
+		}
+	}
+	if (dojo.lang.isArray(this.rrule)) {
+		for (var x = 0; x &lt; this.rrule.length; x++) {
+			var rule = this.rrule[x].value;
+			this.rrule[x].cache = function () {
+			};
+			var temp = rule.split(&quot;;&quot;);
+			for (var y = 0; y &lt; temp.length; y++) {
+				var pair = temp[y].split(&quot;=&quot;);
+				var key = pair[0].toLowerCase();
+				var val = pair[1];
+				if ((key == &quot;freq&quot;) || (key == &quot;interval&quot;) || (key == &quot;until&quot;)) {
+					this.rrule[x][key] = val;
+				} else {
+					var valArray = val.split(&quot;,&quot;);
+					this.rrule[x][key] = valArray;
+				}
+			}
+		}
+		this.recurring = true;
+	}
+}, toString:function () {
+	return &quot;[iCalendar.Component; &quot; + this.name + &quot;, &quot; + this.properties.length + &quot; properties, &quot; + this.components.length + &quot; components]&quot;;
+}});
+dojo.cal.iCalendar.Property = function (prop) {
+	this.name = prop.name;
+	this.group = prop.group;
+	this.params = prop.params;
+	this.value = prop.value;
+};
+dojo.extend(dojo.cal.iCalendar.Property, {toString:function () {
+	return &quot;[iCalenday.Property; &quot; + this.name + &quot;: &quot; + this.value + &quot;]&quot;;
+}});
+var _P = function (n, oc, req) {
+	return {name:n, required:(req) ? true : false, occurance:(oc == &quot;*&quot; || !oc) ? -1 : oc};
+};
+dojo.cal.iCalendar.VCalendar = function (calbody) {
+	this.name = &quot;VCALENDAR&quot;;
+	this.recurring = [];
+	this.nonRecurringEvents = function () {
+	};
+	dojo.cal.iCalendar.Component.call(this, calbody);
+};
+dojo.inherits(dojo.cal.iCalendar.VCalendar, dojo.cal.iCalendar.Component);
+dojo.extend(dojo.cal.iCalendar.VCalendar, {addComponent:function (prop) {
+	this.components.push(prop);
+	if (prop.name.toLowerCase() == &quot;vevent&quot;) {
+		if (prop.rrule) {
+			this.recurring.push(prop);
+		} else {
+			var startDate = prop.getDate();
+			var month = startDate.getMonth() + 1;
+			var dateString = month + &quot;-&quot; + startDate.getDate() + &quot;-&quot; + startDate.getFullYear();
+			if (!dojo.lang.isArray(this[dateString])) {
+				this.nonRecurringEvents[dateString] = [];
+			}
+			this.nonRecurringEvents[dateString].push(prop);
+		}
+	}
+}, preComputeRecurringEvents:function (until) {
+	var calculatedEvents = function () {
+	};
+	for (var x = 0; x &lt; this.recurring.length; x++) {
+		var dates = this.recurring[x].getDates(until);
+		for (var y = 0; y &lt; dates.length; y++) {
+			var month = dates[y].getMonth() + 1;
+			var dateStr = month + &quot;-&quot; + dates[y].getDate() + &quot;-&quot; + dates[y].getFullYear();
+			if (!dojo.lang.isArray(calculatedEvents[dateStr])) {
+				calculatedEvents[dateStr] = [];
+			}
+			if (!dojo.lang.inArray(calculatedEvents[dateStr], this.recurring[x])) {
+				calculatedEvents[dateStr].push(this.recurring[x]);
+			}
+		}
+	}
+	this.recurringEvents = calculatedEvents;
+}, getEvents:function (date) {
+	var events = [];
+	var recur = [];
+	var nonRecur = [];
+	var month = date.getMonth() + 1;
+	var dateStr = month + &quot;-&quot; + date.getDate() + &quot;-&quot; + date.getFullYear();
+	if (dojo.lang.isArray(this.nonRecurringEvents[dateStr])) {
+		nonRecur = this.nonRecurringEvents[dateStr];
+		dojo.debug(&quot;Number of nonRecurring Events: &quot; + nonRecur.length);
+	}
+	if (dojo.lang.isArray(this.recurringEvents[dateStr])) {
+		recur = this.recurringEvents[dateStr];
+	}
+	events = recur.concat(nonRecur);
+	if (events.length &gt; 0) {
+		return events;
+	}
+	return null;
+}});
+var StandardProperties = [_P(&quot;dtstart&quot;, 1, true), _P(&quot;tzoffsetto&quot;, 1, true), _P(&quot;tzoffsetfrom&quot;, 1, true), _P(&quot;comment&quot;), _P(&quot;rdate&quot;), _P(&quot;rrule&quot;), _P(&quot;tzname&quot;)];
+dojo.cal.iCalendar.Standard = function (body) {
+	this.name = &quot;STANDARD&quot;;
+	this._ValidProperties = StandardProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.Standard, dojo.cal.iCalendar.Component);
+var DaylightProperties = [_P(&quot;dtstart&quot;, 1, true), _P(&quot;tzoffsetto&quot;, 1, true), _P(&quot;tzoffsetfrom&quot;, 1, true), _P(&quot;comment&quot;), _P(&quot;rdate&quot;), _P(&quot;rrule&quot;), _P(&quot;tzname&quot;)];
+dojo.cal.iCalendar.Daylight = function (body) {
+	this.name = &quot;DAYLIGHT&quot;;
+	this._ValidProperties = DaylightProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.Daylight, dojo.cal.iCalendar.Component);
+var VEventProperties = [_P(&quot;class&quot;, 1), _P(&quot;created&quot;, 1), _P(&quot;description&quot;, 1), _P(&quot;dtstart&quot;, 1), _P(&quot;geo&quot;, 1), _P(&quot;last-mod&quot;, 1), _P(&quot;location&quot;, 1), _P(&quot;organizer&quot;, 1), _P(&quot;priority&quot;, 1), _P(&quot;dtstamp&quot;, 1), _P(&quot;seq&quot;, 1), _P(&quot;status&quot;, 1), _P(&quot;summary&quot;, 1), _P(&quot;transp&quot;, 1), _P(&quot;uid&quot;, 1), _P(&quot;url&quot;, 1), _P(&quot;recurid&quot;, 1), [_P(&quot;dtend&quot;, 1), _P(&quot;duration&quot;, 1)], _P(&quot;attach&quot;), _P(&quot;attendee&quot;), _P(&quot;categories&quot;), _P(&quot;comment&quot;), _P(&quot;contact&quot;), _P(&quot;exdate&quot;), _P(&quot;exrule&quot;), _P(&quot;rstatus&quot;), _P(&quot;related&quot;), _P(&quot;resources&quot;), _P(&quot;rdate&quot;), _P(&quot;rrule&quot;)];
+dojo.cal.iCalendar.VEvent = function (body) {
+	this._ValidProperties = VEventProperties;
+	this.name = &quot;VEVENT&quot;;
+	dojo.cal.iCalendar.Component.call(this, body);
+	this.recurring = false;
+	this.startDate = dojo.date.fromIso8601(this.dtstart.value);
+};
+dojo.inherits(dojo.cal.iCalendar.VEvent, dojo.cal.iCalendar.Component);
+dojo.extend(dojo.cal.iCalendar.VEvent, {getDates:function (until) {
+	var dtstart = this.getDate();
+	var recurranceSet = [];
+	var weekdays = [&quot;su&quot;, &quot;mo&quot;, &quot;tu&quot;, &quot;we&quot;, &quot;th&quot;, &quot;fr&quot;, &quot;sa&quot;];
+	var order = {&quot;daily&quot;:1, &quot;weekly&quot;:2, &quot;monthly&quot;:3, &quot;yearly&quot;:4, &quot;byday&quot;:1, &quot;bymonthday&quot;:1, &quot;byweekno&quot;:2, &quot;bymonth&quot;:3, &quot;byyearday&quot;:4};
+	for (var x = 0; x &lt; this.rrule.length; x++) {
+		var rrule = this.rrule[x];
+		var freq = rrule.freq.toLowerCase();
+		var interval = 1;
+		if (rrule.interval &gt; interval) {
+			interval = rrule.interval;
+		}
+		var set = [];
+		var freqInt = order[freq];
+		if (rrule.until) {
+			var tmpUntil = dojo.date.fromIso8601(rrule.until);
+		} else {
+			var tmpUntil = until;
+		}
+		if (tmpUntil &gt; until) {
+			tmpUntil = until;
+		}
+		if (dtstart &lt; tmpUntil) {
+			var expandingRules = function () {
+			};
+			var cullingRules = function () {
+			};
+			expandingRules.length = 0;
+			cullingRules.length = 0;
+			switch (freq) {
+			  case &quot;yearly&quot;:
+				var nextDate = new Date(dtstart);
+				set.push(nextDate);
+				while (nextDate &lt; tmpUntil) {
+					nextDate.setYear(nextDate.getFullYear() + interval);
+					tmpDate = new Date(nextDate);
+					if (tmpDate &lt; tmpUntil) {
+						set.push(tmpDate);
+					}
+				}
+				break;
+			  case &quot;monthly&quot;:
+				nextDate = new Date(dtstart);
+				set.push(nextDate);
+				while (nextDate &lt; tmpUntil) {
+					nextDate.setMonth(nextDate.getMonth() + interval);
+					var tmpDate = new Date(nextDate);
+					if (tmpDate &lt; tmpUntil) {
+						set.push(tmpDate);
+					}
+				}
+				break;
+			  case &quot;weekly&quot;:
+				nextDate = new Date(dtstart);
+				set.push(nextDate);
+				while (nextDate &lt; tmpUntil) {
+					nextDate.setDate(nextDate.getDate() + (7 * interval));
+					var tmpDate = new Date(nextDate);
+					if (tmpDate &lt; tmpUntil) {
+						set.push(tmpDate);
+					}
+				}
+				break;
+			  case &quot;daily&quot;:
+				nextDate = new Date(dtstart);
+				set.push(nextDate);
+				while (nextDate &lt; tmpUntil) {
+					nextDate.setDate(nextDate.getDate() + interval);
+					var tmpDate = new Date(nextDate);
+					if (tmpDate &lt; tmpUntil) {
+						set.push(tmpDate);
+					}
+				}
+				break;
+			}
+			if ((rrule[&quot;bymonth&quot;]) &amp;&amp; (order[&quot;bymonth&quot;] &lt; freqInt)) {
+				for (var z = 0; z &lt; rrule[&quot;bymonth&quot;].length; z++) {
+					if (z == 0) {
+						for (var zz = 0; zz &lt; set.length; zz++) {
+							set[zz].setMonth(rrule[&quot;bymonth&quot;][z] - 1);
+						}
+					} else {
+						var subset = [];
+						for (var zz = 0; zz &lt; set.length; zz++) {
+							var newDate = new Date(set[zz]);
+							newDate.setMonth(rrule[z]);
+							subset.push(newDate);
+						}
+						tmp = set.concat(subset);
+						set = tmp;
+					}
+				}
+			}
+			if (rrule[&quot;byweekno&quot;] &amp;&amp; !rrule[&quot;bymonth&quot;]) {
+				dojo.debug(&quot;TODO: no support for byweekno yet&quot;);
+			}
+			if (rrule[&quot;byyearday&quot;] &amp;&amp; !rrule[&quot;bymonth&quot;] &amp;&amp; !rrule[&quot;byweekno&quot;]) {
+				if (rrule[&quot;byyearday&quot;].length &gt; 1) {
+					var regex = &quot;([+-]?)([0-9]{1,3})&quot;;
+					for (var z = 1; x &lt; rrule[&quot;byyearday&quot;].length; z++) {
+						var regexResult = rrule[&quot;byyearday&quot;][z].match(regex);
+						if (z == 1) {
+							for (var zz = 0; zz &lt; set.length; zz++) {
+								if (regexResult[1] == &quot;-&quot;) {
+									dojo.date.setDayOfYear(set[zz], 366 - regexResult[2]);
+								} else {
+									dojo.date.setDayOfYear(set[zz], regexResult[2]);
+								}
+							}
+						} else {
+							var subset = [];
+							for (var zz = 0; zz &lt; set.length; zz++) {
+								var newDate = new Date(set[zz]);
+								if (regexResult[1] == &quot;-&quot;) {
+									dojo.date.setDayOfYear(newDate, 366 - regexResult[2]);
+								} else {
+									dojo.date.setDayOfYear(newDate, regexResult[2]);
+								}
+								subset.push(newDate);
+							}
+							tmp = set.concat(subset);
+							set = tmp;
+						}
+					}
+				}
+			}
+			if (rrule[&quot;bymonthday&quot;] &amp;&amp; (order[&quot;bymonthday&quot;] &lt; freqInt)) {
+				if (rrule[&quot;bymonthday&quot;].length &gt; 0) {
+					var regex = &quot;([+-]?)([0-9]{1,3})&quot;;
+					for (var z = 0; z &lt; rrule[&quot;bymonthday&quot;].length; z++) {
+						var regexResult = rrule[&quot;bymonthday&quot;][z].match(regex);
+						if (z == 0) {
+							for (var zz = 0; zz &lt; set.length; zz++) {
+								if (regexResult[1] == &quot;-&quot;) {
+									if (regexResult[2] &lt; dojo.date.getDaysInMonth(set[zz])) {
+										set[zz].setDate(dojo.date.getDaysInMonth(set[zz]) - regexResult[2]);
+									}
+								} else {
+									if (regexResult[2] &lt; dojo.date.getDaysInMonth(set[zz])) {
+										set[zz].setDate(regexResult[2]);
+									}
+								}
+							}
+						} else {
+							var subset = [];
+							for (var zz = 0; zz &lt; set.length; zz++) {
+								var newDate = new Date(set[zz]);
+								if (regexResult[1] == &quot;-&quot;) {
+									if (regexResult[2] &lt; dojo.date.getDaysInMonth(set[zz])) {
+										newDate.setDate(dojo.date.getDaysInMonth(set[zz]) - regexResult[2]);
+									}
+								} else {
+									if (regexResult[2] &lt; dojo.date.getDaysInMonth(set[zz])) {
+										newDate.setDate(regexResult[2]);
+									}
+								}
+								subset.push(newDate);
+							}
+							tmp = set.concat(subset);
+							set = tmp;
+						}
+					}
+				}
+			}
+			if (rrule[&quot;byday&quot;] &amp;&amp; (order[&quot;byday&quot;] &lt; freqInt)) {
+				if (rrule[&quot;bymonth&quot;]) {
+					if (rrule[&quot;byday&quot;].length &gt; 0) {
+						var regex = &quot;([+-]?)([0-9]{0,1}?)([A-Za-z]{1,2})&quot;;
+						for (var z = 0; z &lt; rrule[&quot;byday&quot;].length; z++) {
+							var regexResult = rrule[&quot;byday&quot;][z].match(regex);
+							var occurance = regexResult[2];
+							var day = regexResult[3].toLowerCase();
+							if (z == 0) {
+								for (var zz = 0; zz &lt; set.length; zz++) {
+									if (regexResult[1] == &quot;-&quot;) {
+										var numDaysFound = 0;
+										var lastDayOfMonth = dojo.date.getDaysInMonth(set[zz]);
+										var daysToSubtract = 1;
+										set[zz].setDate(lastDayOfMonth);
+										if (weekdays[set[zz].getDay()] == day) {
+											numDaysFound++;
+											daysToSubtract = 7;
+										}
+										daysToSubtract = 1;
+										while (numDaysFound &lt; occurance) {
+											set[zz].setDate(set[zz].getDate() - daysToSubtract);
+											if (weekdays[set[zz].getDay()] == day) {
+												numDaysFound++;
+												daysToSubtract = 7;
+											}
+										}
+									} else {
+										if (occurance) {
+											var numDaysFound = 0;
+											set[zz].setDate(1);
+											var daysToAdd = 1;
+											if (weekdays[set[zz].getDay()] == day) {
+												numDaysFound++;
+												daysToAdd = 7;
+											}
+											while (numDaysFound &lt; occurance) {
+												set[zz].setDate(set[zz].getDate() + daysToAdd);
+												if (weekdays[set[zz].getDay()] == day) {
+													numDaysFound++;
+													daysToAdd = 7;
+												}
+											}
+										} else {
+											var numDaysFound = 0;
+											var subset = [];
+											lastDayOfMonth = new Date(set[zz]);
+											var daysInMonth = dojo.date.getDaysInMonth(set[zz]);
+											lastDayOfMonth.setDate(daysInMonth);
+											set[zz].setDate(1);
+											if (weekdays[set[zz].getDay()] == day) {
+												numDaysFound++;
+											}
+											var tmpDate = new Date(set[zz]);
+											daysToAdd = 1;
+											while (tmpDate.getDate() &lt; lastDayOfMonth) {
+												if (weekdays[tmpDate.getDay()] == day) {
+													numDaysFound++;
+													if (numDaysFound == 1) {
+														set[zz] = tmpDate;
+													} else {
+														subset.push(tmpDate);
+														tmpDate = new Date(tmpDate);
+														daysToAdd = 7;
+														tmpDate.setDate(tmpDate.getDate() + daysToAdd);
+													}
+												} else {
+													tmpDate.setDate(tmpDate.getDate() + daysToAdd);
+												}
+											}
+											var t = set.concat(subset);
+											set = t;
+										}
+									}
+								}
+							} else {
+								var subset = [];
+								for (var zz = 0; zz &lt; set.length; zz++) {
+									var newDate = new Date(set[zz]);
+									if (regexResult[1] == &quot;-&quot;) {
+										if (regexResult[2] &lt; dojo.date.getDaysInMonth(set[zz])) {
+											newDate.setDate(dojo.date.getDaysInMonth(set[zz]) - regexResult[2]);
+										}
+									} else {
+										if (regexResult[2] &lt; dojo.date.getDaysInMonth(set[zz])) {
+											newDate.setDate(regexResult[2]);
+										}
+									}
+									subset.push(newDate);
+								}
+								tmp = set.concat(subset);
+								set = tmp;
+							}
+						}
+					}
+				} else {
+					dojo.debug(&quot;TODO: byday within a yearly rule without a bymonth&quot;);
+				}
+			}
+			dojo.debug(&quot;TODO: Process BYrules for units larger than frequency&quot;);
+			var tmp = recurranceSet.concat(set);
+			recurranceSet = tmp;
+		}
+	}
+	recurranceSet.push(dtstart);
+	return recurranceSet;
+}, getDate:function () {
+	return dojo.date.fromIso8601(this.dtstart.value);
+}});
+var VTimeZoneProperties = [_P(&quot;tzid&quot;, 1, true), _P(&quot;last-mod&quot;, 1), _P(&quot;tzurl&quot;, 1)];
+dojo.cal.iCalendar.VTimeZone = function (body) {
+	this.name = &quot;VTIMEZONE&quot;;
+	this._ValidProperties = VTimeZoneProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.VTimeZone, dojo.cal.iCalendar.Component);
+var VTodoProperties = [_P(&quot;class&quot;, 1), _P(&quot;completed&quot;, 1), _P(&quot;created&quot;, 1), _P(&quot;description&quot;, 1), _P(&quot;dtstart&quot;, 1), _P(&quot;geo&quot;, 1), _P(&quot;last-mod&quot;, 1), _P(&quot;location&quot;, 1), _P(&quot;organizer&quot;, 1), _P(&quot;percent&quot;, 1), _P(&quot;priority&quot;, 1), _P(&quot;dtstamp&quot;, 1), _P(&quot;seq&quot;, 1), _P(&quot;status&quot;, 1), _P(&quot;summary&quot;, 1), _P(&quot;uid&quot;, 1), _P(&quot;url&quot;, 1), _P(&quot;recurid&quot;, 1), [_P(&quot;due&quot;, 1), _P(&quot;duration&quot;, 1)], _P(&quot;attach&quot;), _P(&quot;attendee&quot;), _P(&quot;categories&quot;), _P(&quot;comment&quot;), _P(&quot;contact&quot;), _P(&quot;exdate&quot;), _P(&quot;exrule&quot;), _P(&quot;rstatus&quot;), _P(&quot;related&quot;), _P(&quot;resources&quot;), _P(&quot;rdate&quot;), _P(&quot;rrule&quot;)];
+dojo.cal.iCalendar.VTodo = function (body) {
+	this.name = &quot;VTODO&quot;;
+	this._ValidProperties = VTodoProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.VTodo, dojo.cal.iCalendar.Component);
+var VJournalProperties = [_P(&quot;class&quot;, 1), _P(&quot;created&quot;, 1), _P(&quot;description&quot;, 1), _P(&quot;dtstart&quot;, 1), _P(&quot;last-mod&quot;, 1), _P(&quot;organizer&quot;, 1), _P(&quot;dtstamp&quot;, 1), _P(&quot;seq&quot;, 1), _P(&quot;status&quot;, 1), _P(&quot;summary&quot;, 1), _P(&quot;uid&quot;, 1), _P(&quot;url&quot;, 1), _P(&quot;recurid&quot;, 1), _P(&quot;attach&quot;), _P(&quot;attendee&quot;), _P(&quot;categories&quot;), _P(&quot;comment&quot;), _P(&quot;contact&quot;), _P(&quot;exdate&quot;), _P(&quot;exrule&quot;), _P(&quot;related&quot;), _P(&quot;rstatus&quot;), _P(&quot;rdate&quot;), _P(&quot;rrule&quot;)];
+dojo.cal.iCalendar.VJournal = function (body) {
+	this.name = &quot;VJOURNAL&quot;;
+	this._ValidProperties = VJournalProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.VJournal, dojo.cal.iCalendar.Component);
+var VFreeBusyProperties = [_P(&quot;contact&quot;), _P(&quot;dtstart&quot;, 1), _P(&quot;dtend&quot;), _P(&quot;duration&quot;), _P(&quot;organizer&quot;, 1), _P(&quot;dtstamp&quot;, 1), _P(&quot;uid&quot;, 1), _P(&quot;url&quot;, 1), _P(&quot;attendee&quot;), _P(&quot;comment&quot;), _P(&quot;freebusy&quot;), _P(&quot;rstatus&quot;)];
+dojo.cal.iCalendar.VFreeBusy = function (body) {
+	this.name = &quot;VFREEBUSY&quot;;
+	this._ValidProperties = VFreeBusyProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.VFreeBusy, dojo.cal.iCalendar.Component);
+var VAlarmProperties = [[_P(&quot;action&quot;, 1, true), _P(&quot;trigger&quot;, 1, true), [_P(&quot;duration&quot;, 1), _P(&quot;repeat&quot;, 1)], _P(&quot;attach&quot;, 1)], [_P(&quot;action&quot;, 1, true), _P(&quot;description&quot;, 1, true), _P(&quot;trigger&quot;, 1, true), [_P(&quot;duration&quot;, 1), _P(&quot;repeat&quot;, 1)]], [_P(&quot;action&quot;, 1, true), _P(&quot;description&quot;, 1, true), _P(&quot;trigger&quot;, 1, true), _P(&quot;summary&quot;, 1, true), _P(&quot;attendee&quot;, &quot;*&quot;, true), [_P(&quot;duration&quot;, 1), _P(&quot;repeat&quot;, 1)], _P(&quot;attach&quot;, 1)], [_P(&quot;action&quot;, 1, true), _P(&quot;attach&quot;, 1, true), _P(&quot;trigger&quot;, 1, true), [_P(&quot;duration&quot;, 1), _P(&quot;repeat&quot;, 1)], _P(&quot;description&quot;, 1)]];
+dojo.cal.iCalendar.VAlarm = function (body) {
+	this.name = &quot;VALARM&quot;;
+	this._ValidProperties = VAlarmProperties;
+	dojo.cal.iCalendar.Component.call(this, body);
+};
+dojo.inherits(dojo.cal.iCalendar.VAlarm, dojo.cal.iCalendar.Component);
+

Added: tags/parley-0.55/root/static/magic/src/cal/textDirectory.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/cal/textDirectory.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/cal/textDirectory.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,57 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.cal.textDirectory&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.cal.textDirectory.Property = function (line) {
+	var left = dojo.string.trim(line.substring(0, line.indexOf(&quot;:&quot;)));
+	var right = dojo.string.trim(line.substr(line.indexOf(&quot;:&quot;) + 1));
+	var parameters = dojo.string.splitEscaped(left, &quot;;&quot;);
+	this.name = parameters[0];
+	parameters.splice(0, 1);
+	this.params = [];
+	var arr;
+	for (var i = 0; i &lt; parameters.length; i++) {
+		arr = parameters[i].split(&quot;=&quot;);
+		var key = dojo.string.trim(arr[0].toUpperCase());
+		if (arr.length == 1) {
+			this.params.push([key]);
+			continue;
+		}
+		var values = dojo.string.splitEscaped(arr[1], &quot;,&quot;);
+		for (var j = 0; j &lt; values.length; j++) {
+			if (dojo.string.trim(values[j]) != &quot;&quot;) {
+				this.params.push([key, dojo.string.trim(values[j])]);
+			}
+		}
+	}
+	if (this.name.indexOf(&quot;.&quot;) &gt; 0) {
+		arr = this.name.split(&quot;.&quot;);
+		this.group = arr[0];
+		this.name = arr[1];
+	}
+	this.value = right;
+};
+dojo.cal.textDirectory.tokenise = function (text) {
+	var nText = dojo.string.normalizeNewlines(text, &quot;\n&quot;).replace(/\n[ \t]/g, &quot;&quot;).replace(/\x00/g, &quot;&quot;);
+	var lines = nText.split(&quot;\n&quot;);
+	var properties = [];
+	for (var i = 0; i &lt; lines.length; i++) {
+		if (dojo.string.trim(lines[i]) == &quot;&quot;) {
+			continue;
+		}
+		var prop = new dojo.cal.textDirectory.Property(lines[i]);
+		properties.push(prop);
+	}
+	return properties;
+};
+

Added: tags/parley-0.55/root/static/magic/src/charting/Axis.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/Axis.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/Axis.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,132 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.Axis&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.charting.Axis = function (label, scale, labels) {
+	var id = &quot;dojo-charting-axis-&quot; + dojo.charting.Axis.count++;
+	this.getId = function () {
+		return id;
+	};
+	this.setId = function (key) {
+		id = key;
+	};
+	this.scale = scale || &quot;linear&quot;;
+	this.label = label || &quot;&quot;;
+	this.showLabel = true;
+	this.showLabels = true;
+	this.showLines = false;
+	this.showTicks = false;
+	this.range = {upper:100, lower:0};
+	this.origin = &quot;min&quot;;
+	this._origin = null;
+	this.labels = labels || [];
+	this._labels = [];
+	this.nodes = {main:null, axis:null, label:null, labels:null, lines:null, ticks:null};
+	this._rerender = false;
+};
+dojo.charting.Axis.count = 0;
+dojo.extend(dojo.charting.Axis, {getCoord:function (val, plotArea, plot) {
+	val = parseFloat(val, 10);
+	var area = plotArea.getArea();
+	if (plot.axisX == this) {
+		var offset = 0 - this.range.lower;
+		var min = this.range.lower + offset;
+		var max = this.range.upper + offset;
+		val += offset;
+		return (val * ((area.right - area.left) / max)) + area.left;
+	} else {
+		var max = this.range.upper;
+		var min = this.range.lower;
+		var offset = 0;
+		if (min &lt; 0) {
+			offset += Math.abs(min);
+		}
+		max += offset;
+		min += offset;
+		val += offset;
+		var pmin = area.bottom;
+		var pmax = area.top;
+		return (((pmin - pmax) / (max - min)) * (max - val)) + pmax;
+	}
+}, initializeOrigin:function (drawAgainst, plane) {
+	if (this._origin == null) {
+		this._origin = this.origin;
+	}
+	if (isNaN(this._origin)) {
+		if (this._origin.toLowerCase() == &quot;max&quot;) {
+			this.origin = drawAgainst.range[(plane == &quot;y&quot;) ? &quot;upper&quot; : &quot;lower&quot;];
+		} else {
+			if (this._origin.toLowerCase() == &quot;min&quot;) {
+				this.origin = drawAgainst.range[(plane == &quot;y&quot;) ? &quot;lower&quot; : &quot;upper&quot;];
+			} else {
+				this.origin = 0;
+			}
+		}
+	}
+}, initializeLabels:function () {
+	this._labels = [];
+	if (this.labels.length == 0) {
+		this.showLabels = false;
+		this.showLines = false;
+		this.showTicks = false;
+	} else {
+		if (this.labels[0].label &amp;&amp; this.labels[0].value != null) {
+			for (var i = 0; i &lt; this.labels.length; i++) {
+				this._labels.push(this.labels[i]);
+			}
+		} else {
+			if (!isNaN(this.labels[0])) {
+				for (var i = 0; i &lt; this.labels.length; i++) {
+					this._labels.push({label:this.labels[i], value:this.labels[i]});
+				}
+			} else {
+				var a = [];
+				for (var i = 0; i &lt; this.labels.length; i++) {
+					a.push(this.labels[i]);
+				}
+				var s = a.shift();
+				this._labels.push({label:s, value:this.range.lower});
+				if (a.length &gt; 0) {
+					var s = a.pop();
+					this._labels.push({label:s, value:this.range.upper});
+				}
+				if (a.length &gt; 0) {
+					var range = this.range.upper - this.range.lower;
+					var step = range / (this.labels.length - 1);
+					for (var i = 1; i &lt;= a.length; i++) {
+						this._labels.push({label:a[i - 1], value:this.range.lower + (step * i)});
+					}
+				}
+			}
+		}
+	}
+}, initialize:function (plotArea, plot, drawAgainst, plane) {
+	this.destroy();
+	this.initializeOrigin(drawAgainst, plane);
+	this.initializeLabels();
+	var node = this.render(plotArea, plot, drawAgainst, plane);
+	return node;
+}, destroy:function () {
+	for (var p in this.nodes) {
+		while (this.nodes[p] &amp;&amp; this.nodes[p].childNodes.length &gt; 0) {
+			this.nodes[p].removeChild(this.nodes[p].childNodes[0]);
+		}
+		if (this.nodes[p] &amp;&amp; this.nodes[p].parentNode) {
+			this.nodes[p].parentNode.removeChild(this.nodes[p]);
+		}
+		this.nodes[p] = null;
+	}
+}});
+dojo.requireIf(dojo.render.svg.capable, &quot;dojo.charting.svg.Axis&quot;);
+dojo.requireIf(dojo.render.vml.capable, &quot;dojo.charting.vml.Axis&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/charting/Chart.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/Chart.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/Chart.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,64 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.Chart&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.charting.PlotArea&quot;);
+dojo.charting.Chart = function (node, title, description) {
+	this.node = node || null;
+	this.title = title || &quot;Chart&quot;;
+	this.description = description || &quot;&quot;;
+	this.plotAreas = [];
+};
+dojo.extend(dojo.charting.Chart, {addPlotArea:function (obj, doRender) {
+	if (obj.x != null &amp;&amp; obj.left == null) {
+		obj.left = obj.x;
+	}
+	if (obj.y != null &amp;&amp; obj.top == null) {
+		obj.top = obj.y;
+	}
+	this.plotAreas.push(obj);
+	if (doRender) {
+		this.render();
+	}
+}, onInitialize:function (chart) {
+}, onRender:function (chart) {
+}, onDestroy:function (chart) {
+}, initialize:function () {
+	if (!this.node) {
+		dojo.raise(&quot;dojo.charting.Chart.initialize: there must be a root node defined for the Chart.&quot;);
+	}
+	this.destroy();
+	this.render();
+	this.onInitialize(this);
+}, render:function () {
+	if (this.node.style.position != &quot;absolute&quot;) {
+		this.node.style.position = &quot;relative&quot;;
+	}
+	for (var i = 0; i &lt; this.plotAreas.length; i++) {
+		var area = this.plotAreas[i].plotArea;
+		var node = area.initialize();
+		node.style.position = &quot;absolute&quot;;
+		node.style.top = this.plotAreas[i].top + &quot;px&quot;;
+		node.style.left = this.plotAreas[i].left + &quot;px&quot;;
+		this.node.appendChild(node);
+		area.render();
+	}
+}, destroy:function () {
+	for (var i = 0; i &lt; this.plotAreas.length; i++) {
+		this.plotAreas[i].plotArea.destroy();
+	}
+	while (this.node &amp;&amp; this.node.childNodes &amp;&amp; this.node.childNodes.length &gt; 0) {
+		this.node.removeChild(this.node.childNodes[0]);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/charting/Plot.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/Plot.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/Plot.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,82 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.Plot&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.charting.Axis&quot;);
+dojo.require(&quot;dojo.charting.Series&quot;);
+dojo.charting.RenderPlotSeries = {Singly:&quot;single&quot;, Grouped:&quot;grouped&quot;};
+dojo.charting.Plot = function (xaxis, yaxis, series) {
+	var id = &quot;dojo-charting-plot-&quot; + dojo.charting.Plot.count++;
+	this.getId = function () {
+		return id;
+	};
+	this.setId = function (key) {
+		id = key;
+	};
+	this.axisX = null;
+	this.axisY = null;
+	this.series = [];
+	this.dataNode = null;
+	this.renderType = dojo.charting.RenderPlotSeries.Singly;
+	if (xaxis) {
+		this.setAxis(xaxis, &quot;x&quot;);
+	}
+	if (yaxis) {
+		this.setAxis(yaxis, &quot;y&quot;);
+	}
+	if (series) {
+		for (var i = 0; i &lt; series.length; i++) {
+			this.addSeries(series[i]);
+		}
+	}
+};
+dojo.charting.Plot.count = 0;
+dojo.extend(dojo.charting.Plot, {addSeries:function (series, plotter) {
+	if (series.plotter) {
+		this.series.push(series);
+	} else {
+		this.series.push({data:series, plotter:plotter || dojo.charting.Plotters[&quot;Default&quot;]});
+	}
+}, setAxis:function (axis, which) {
+	if (which.toLowerCase() == &quot;x&quot;) {
+		this.axisX = axis;
+	} else {
+		if (which.toLowerCase() == &quot;y&quot;) {
+			this.axisY = axis;
+		}
+	}
+}, getRanges:function () {
+	var xmin, xmax, ymin, ymax;
+	xmin = ymin = Number.MAX_VALUE;
+	xmax = ymax = Number.MIN_VALUE;
+	for (var i = 0; i &lt; this.series.length; i++) {
+		var values = this.series[i].data.evaluate();
+		for (var j = 0; j &lt; values.length; j++) {
+			var comp = values[j];
+			xmin = Math.min(comp.x, xmin);
+			ymin = Math.min(comp.y, ymin);
+			xmax = Math.max(comp.x, xmax);
+			ymax = Math.max(comp.y, ymax);
+		}
+	}
+	return {x:{upper:xmax, lower:xmin}, y:{upper:ymax, lower:ymin}, toString:function () {
+		return &quot;[ x:&quot; + xmax + &quot; - &quot; + xmin + &quot;, y:&quot; + ymax + &quot; - &quot; + ymin + &quot;]&quot;;
+	}};
+}, destroy:function () {
+	var node = this.dataNode;
+	while (node &amp;&amp; node.childNodes &amp;&amp; node.childNodes.length &gt; 0) {
+		node.removeChild(node.childNodes[0]);
+	}
+	this.dataNode = null;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/charting/PlotArea.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/PlotArea.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/PlotArea.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,137 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.PlotArea&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.gfx.color.hsl&quot;);
+dojo.require(&quot;dojo.charting.Plot&quot;);
+dojo.charting.PlotArea = function () {
+	var id = &quot;dojo-charting-plotarea-&quot; + dojo.charting.PlotArea.count++;
+	this.getId = function () {
+		return id;
+	};
+	this.setId = function (key) {
+		id = key;
+	};
+	this.areaType = &quot;standard&quot;;
+	this.plots = [];
+	this.size = {width:600, height:400};
+	this.padding = {top:10, right:10, bottom:20, left:20};
+	this.nodes = {main:null, area:null, background:null, axes:null, plots:null};
+	this._color = {h:140, s:120, l:120, step:27};
+};
+dojo.charting.PlotArea.count = 0;
+dojo.extend(dojo.charting.PlotArea, {nextColor:function () {
+	var rgb = dojo.gfx.color.hsl2rgb(this._color.h, this._color.s, this._color.l);
+	this._color.h = (this._color.h + this._color.step) % 360;
+	while (this._color.h &lt; 140) {
+		this._color.h += this._color.step;
+	}
+	return dojo.gfx.color.rgb2hex(rgb[0], rgb[1], rgb[2]);
+}, getArea:function () {
+	return {left:this.padding.left, right:this.size.width - this.padding.right, top:this.padding.top, bottom:this.size.height - this.padding.bottom, toString:function () {
+		var a = [this.top, this.right, this.bottom, this.left];
+		return &quot;[&quot; + a.join() + &quot;]&quot;;
+	}};
+}, getAxes:function () {
+	var axes = {};
+	for (var i = 0; i &lt; this.plots.length; i++) {
+		var plot = this.plots[i];
+		axes[plot.axisX.getId()] = {axis:plot.axisX, drawAgainst:plot.axisY, plot:plot, plane:&quot;x&quot;};
+		axes[plot.axisY.getId()] = {axis:plot.axisY, drawAgainst:plot.axisX, plot:plot, plane:&quot;y&quot;};
+	}
+	return axes;
+}, getLegendInfo:function () {
+	var a = [];
+	for (var i = 0; i &lt; this.plots.length; i++) {
+		for (var j = 0; j &lt; this.plots[i].series.length; j++) {
+			var data = this.plots[i].series[j].data;
+			a.push({label:data.label, color:data.color});
+		}
+	}
+	return a;
+}, setAxesRanges:function () {
+	var ranges = {};
+	var axes = {};
+	for (var i = 0; i &lt; this.plots.length; i++) {
+		var plot = this.plots[i];
+		var ranges = plot.getRanges();
+		var x = ranges.x;
+		var y = ranges.y;
+		var ax, ay;
+		if (!axes[plot.axisX.getId()]) {
+			axes[plot.axisX.getId()] = plot.axisX;
+			ranges[plot.axisX.getId()] = {upper:x.upper, lower:x.lower};
+		}
+		ax = ranges[plot.axisX.getId()];
+		ax.upper = Math.max(ax.upper, x.upper);
+		ax.lower = Math.min(ax.lower, x.lower);
+		if (!axes[plot.axisY.getId()]) {
+			axes[plot.axisY.getId()] = plot.axisY;
+			ranges[plot.axisY.getId()] = {upper:y.upper, lower:y.lower};
+		}
+		ay = ranges[plot.axisY.getId()];
+		ay.upper = Math.max(ay.upper, y.upper);
+		ay.lower = Math.min(ay.lower, y.lower);
+	}
+	for (var p in axes) {
+		axes[p].range = ranges[p];
+	}
+}, render:function (kwArgs, applyToData) {
+	if (!this.nodes.main || !this.nodes.area || !this.nodes.background || !this.nodes.plots || !this.nodes.axes) {
+		this.initialize();
+	}
+	this.resize();
+	for (var i = 0; i &lt; this.plots.length; i++) {
+		var plot = this.plots[i];
+		if (plot.dataNode) {
+			this.nodes.plots.removeChild(plot.dataNode);
+		}
+		var target = this.initializePlot(plot);
+		switch (plot.renderType) {
+		  case dojo.charting.RenderPlotSeries.Grouped:
+			if (plot.series[0]) {
+				target.appendChild(plot.series[0].plotter(this, plot, kwArgs, applyToData));
+			}
+			break;
+		  case dojo.charting.RenderPlotSeries.Singly:
+		  default:
+			for (var j = 0; j &lt; plot.series.length; j++) {
+				var series = plot.series[j];
+				var data = series.data.evaluate(kwArgs);
+				target.appendChild(series.plotter(data, this, plot, applyToData));
+			}
+		}
+		this.nodes.plots.appendChild(target);
+	}
+}, destroy:function () {
+	for (var i = 0; i &lt; this.plots.length; i++) {
+		this.plots[i].destroy();
+	}
+	for (var p in this.nodes) {
+		var node = this.nodes[p];
+		if (!node) {
+			continue;
+		}
+		if (!node.childNodes) {
+			continue;
+		}
+		while (node.childNodes.length &gt; 0) {
+			node.removeChild(node.childNodes[0]);
+		}
+		this.nodes[p] = null;
+	}
+}});
+dojo.requireIf(dojo.render.svg.capable, &quot;dojo.charting.svg.PlotArea&quot;);
+dojo.requireIf(dojo.render.vml.capable, &quot;dojo.charting.vml.PlotArea&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/charting/Plotters.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/Plotters.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/Plotters.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.Plotters&quot;);
+dojo.requireIf(dojo.render.svg.capable, &quot;dojo.charting.svg.Plotters&quot;);
+dojo.requireIf(dojo.render.vml.capable, &quot;dojo.charting.vml.Plotters&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/charting/README.txt
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/README.txt	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/README.txt	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,46 @@
+Dojo Charting Engine
+=========================================================================
+The Dojo Charting Engine is a (fairly) complex object structure, designed
+to provide as much flexibility as possible in terms of chart construction.
+To this end, the engine details the following structure:
+
+Chart
+---PlotArea[]
+------Plot[]
+---------Axis (axisX)
+---------Axis (axisY)
+---------Series[]
+
+
+A Chart object is the main entity; it is the entire graphic.  A Chart may
+have any number of PlotArea objects, which are the basic canvas against 
+which data is plotted.  A PlotArea may have any number of Plot objects,
+which is a container representing up to 2 axes and any number of series
+to be plotted against those axes; a Series represents a binding against
+two fields from a data source (initial rev, this data source is always of
+type dojo.collections.Store but this will probably change once dojo.data
+is in production).
+
+The point of this structure is to allow for as much flexibility as possible
+in terms of what kinds of charts can be represented by the engine.  The
+current plan is to accomodate up to analytical financial charts, which tend
+to have 3 plot areas and any number of different types of axes on each one.
+
+The main exception to this is the pie chart, which will have it's own
+custom codebase.  Also, 3D charts are not accounted for at this time,
+although the only thing that will probably need to be altered to make
+that work would be Plot and Series (to accomodate the additional Z axis).
+
+Finally, a Plot will render its series[] through the use of Plotters, which
+are custom methods to render specific types of charts.
+-------------------------------------------------------------------------
+In terms of widgets, the basic concept is that there is a central, super-
+flexible Chart widget (Chart, oddly enough), and then any number of preset
+chart type widgets, that are basically built to serve a simple, easy 
+purpose.  For instance, if someone just needs to plot a series of lines,
+they would be better off using the LineChart widget; but if someone needed
+to plot a combo chart, that has 2 Y Axes (one linear, one log) against the
+same X Axis, using lines and areas, then they will want to use a Chart widget.
+Note also that unlike other widgets, the Charting engine *can* be called
+directly from script *without* the need for the actual widget engine to be
+loaded; the Chart widgets are thin wrappers around the charting engine.
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/charting/Series.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/Series.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/Series.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,194 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.Series&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.charting.Plotters&quot;);
+dojo.charting.Series = function (kwArgs) {
+	var args = kwArgs || {length:1};
+	this.dataSource = args.dataSource || null;
+	this.bindings = {};
+	this.color = args.color;
+	this.label = args.label;
+	if (args.bindings) {
+		for (var p in args.bindings) {
+			this.addBinding(p, args.bindings[p]);
+		}
+	}
+};
+dojo.extend(dojo.charting.Series, {bind:function (src, bindings) {
+	this.dataSource = src;
+	this.bindings = bindings;
+}, addBinding:function (name, binding) {
+	this.bindings[name] = binding;
+}, evaluate:function (kwArgs) {
+	var ret = [];
+	var a = this.dataSource.getData();
+	var l = a.length;
+	var start = 0;
+	var end = l;
+	if (kwArgs) {
+		if (kwArgs.between) {
+			for (var i = 0; i &lt; l; i++) {
+				var fld = this.dataSource.getField(a[i], kwArgs.between.field);
+				if (fld &gt;= kwArgs.between.low &amp;&amp; fld &lt;= kwArgs.between.high) {
+					var o = {src:a[i], series:this};
+					for (var p in this.bindings) {
+						o[p] = this.dataSource.getField(a[i], this.bindings[p]);
+					}
+					ret.push(o);
+				}
+			}
+		} else {
+			if (kwArgs.from || kwArgs.length) {
+				if (kwArgs.from) {
+					start = Math.max(kwArgs.from, 0);
+					if (kwArgs.to) {
+						end = Math.min(kwArgs.to, end);
+					}
+				} else {
+					if (kwArgs.length &lt; 0) {
+						start = Math.max((end + length), 0);
+					} else {
+						end = Math.min((start + length), end);
+					}
+				}
+				for (var i = start; i &lt; end; i++) {
+					var o = {src:a[i], series:this};
+					for (var p in this.bindings) {
+						o[p] = this.dataSource.getField(a[i], this.bindings[p]);
+					}
+					ret.push(o);
+				}
+			}
+		}
+	} else {
+		for (var i = start; i &lt; end; i++) {
+			var o = {src:a[i], series:this};
+			for (var p in this.bindings) {
+				o[p] = this.dataSource.getField(a[i], this.bindings[p]);
+			}
+			ret.push(o);
+		}
+	}
+	if (ret.length &gt; 0 &amp;&amp; typeof (ret[0].x) != &quot;undefined&quot;) {
+		ret.sort(function (a, b) {
+			if (a.x &gt; b.x) {
+				return 1;
+			}
+			if (a.x &lt; b.x) {
+				return -1;
+			}
+			return 0;
+		});
+	}
+	return ret;
+}, trends:{createRange:function (values, len) {
+	var idx = values.length - 1;
+	var length = (len || values.length);
+	return {&quot;index&quot;:idx, &quot;length&quot;:length, &quot;start&quot;:Math.max(idx - length, 0)};
+}, mean:function (values, len) {
+	var range = this.createRange(values, len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var total = 0;
+	var count = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		total += values[i].y;
+		count++;
+	}
+	total /= Math.max(count, 1);
+	return total;
+}, variance:function (values, len) {
+	var range = this.createRange(values, len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var total = 0;
+	var square = 0;
+	var count = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		total += values[i].y;
+		square += Math.pow(values[i].y, 2);
+		count++;
+	}
+	return (square / count) - Math.pow(total / count, 2);
+}, standardDeviation:function (values, len) {
+	return Math.sqrt(this.getVariance(values, len));
+}, max:function (values, len) {
+	var range = this.createRange(values, len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var max = Number.MIN_VALUE;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		max = Math.max(values[i].y, max);
+	}
+	return max;
+}, min:function (values, len) {
+	var range = this.createRange(values, len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var min = Number.MAX_VALUE;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		min = Math.min(values[i].y, min);
+	}
+	return min;
+}, median:function (values, len) {
+	var range = this.createRange(values, len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var a = [];
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var b = false;
+		for (var j = 0; j &lt; a.length; j++) {
+			if (values[i].y == a[j]) {
+				b = true;
+				break;
+			}
+		}
+		if (!b) {
+			a.push(values[i].y);
+		}
+	}
+	a.sort();
+	if (a.length &gt; 0) {
+		return a[Math.ceil(a.length / 2)];
+	}
+	return 0;
+}, mode:function (values, len) {
+	var range = this.createRange(values, len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var o = {};
+	var ret = 0;
+	var median = Number.MIN_VALUE;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		if (!o[values[i].y]) {
+			o[values[i].y] = 1;
+		} else {
+			o[values[i].y]++;
+		}
+	}
+	for (var p in o) {
+		if (median &lt; o[p]) {
+			median = o[p];
+			ret = p;
+		}
+	}
+	return ret;
+}}});
+

Added: tags/parley-0.55/root/static/magic/src/charting/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,14 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/charting/svg/Axis.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/svg/Axis.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/svg/Axis.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,188 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.svg.Axis&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+if (dojo.render.svg.capable) {
+	dojo.extend(dojo.charting.Axis, {renderLines:function (plotArea, plot, plane) {
+		if (this.nodes.lines) {
+			while (this.nodes.lines.childNodes.length &gt; 0) {
+				this.nodes.lines.removeChild(this.nodes.lines.childNodes[0]);
+			}
+			if (this.nodes.lines.parentNode) {
+				this.nodes.lines.parentNode.removeChild(this.nodes.lines);
+				this.nodes.lines = null;
+			}
+		}
+		var area = plotArea.getArea();
+		var g = this.nodes.lines = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId() + &quot;-lines&quot;);
+		for (var i = 0; i &lt; this._labels.length; i++) {
+			if (this._labels[i].value == this.origin) {
+				continue;
+			}
+			var v = this.getCoord(this._labels[i].value, plotArea, plot);
+			var l = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+			l.setAttribute(&quot;style&quot;, &quot;stroke:#999;stroke-width:1px;stroke-dasharray:1,4;&quot;);
+			if (plane == &quot;x&quot;) {
+				l.setAttribute(&quot;y1&quot;, area.top);
+				l.setAttribute(&quot;y2&quot;, area.bottom);
+				l.setAttribute(&quot;x1&quot;, v);
+				l.setAttribute(&quot;x2&quot;, v);
+			} else {
+				if (plane == &quot;y&quot;) {
+					l.setAttribute(&quot;y1&quot;, v);
+					l.setAttribute(&quot;y2&quot;, v);
+					l.setAttribute(&quot;x1&quot;, area.left);
+					l.setAttribute(&quot;x2&quot;, area.right);
+				}
+			}
+			g.appendChild(l);
+		}
+		return g;
+	}, renderTicks:function (plotArea, plot, plane, coord) {
+		if (this.nodes.ticks) {
+			while (this.nodes.ticks.childNodes.length &gt; 0) {
+				this.nodes.ticks.removeChild(this.nodes.ticks.childNodes[0]);
+			}
+			if (this.nodes.ticks.parentNode) {
+				this.nodes.ticks.parentNode.removeChild(this.nodes.ticks);
+				this.nodes.ticks = null;
+			}
+		}
+		var g = this.nodes.ticks = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId() + &quot;-ticks&quot;);
+		for (var i = 0; i &lt; this._labels.length; i++) {
+			var v = this.getCoord(this._labels[i].value, plotArea, plot);
+			var l = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+			l.setAttribute(&quot;style&quot;, &quot;stroke:#000;stroke-width:1pt;&quot;);
+			if (plane == &quot;x&quot;) {
+				l.setAttribute(&quot;y1&quot;, coord);
+				l.setAttribute(&quot;y2&quot;, coord + 3);
+				l.setAttribute(&quot;x1&quot;, v);
+				l.setAttribute(&quot;x2&quot;, v);
+			} else {
+				if (plane == &quot;y&quot;) {
+					l.setAttribute(&quot;y1&quot;, v);
+					l.setAttribute(&quot;y2&quot;, v);
+					l.setAttribute(&quot;x1&quot;, coord - 2);
+					l.setAttribute(&quot;x2&quot;, coord + 2);
+				}
+			}
+			g.appendChild(l);
+		}
+		return g;
+	}, renderLabels:function (plotArea, plot, plane, coord, textSize, anchor) {
+		function createLabel(label, x, y, textSize, anchor) {
+			var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+			text.setAttribute(&quot;x&quot;, x);
+			text.setAttribute(&quot;y&quot;, (plane == &quot;x&quot; ? y : y + 2));
+			text.setAttribute(&quot;style&quot;, &quot;text-anchor:&quot; + anchor + &quot;;font-family:sans-serif;font-size:&quot; + textSize + &quot;px;fill:#000;&quot;);
+			text.appendChild(document.createTextNode(label));
+			return text;
+		}
+		if (this.nodes.labels) {
+			while (this.nodes.labels.childNodes.length &gt; 0) {
+				this.nodes.labels.removeChild(this.nodes.labels.childNodes[0]);
+			}
+			if (this.nodes.labels.parentNode) {
+				this.nodes.labels.parentNode.removeChild(this.nodes.labels);
+				this.nodes.labels = null;
+			}
+		}
+		var g = this.nodes.labels = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId() + &quot;-labels&quot;);
+		for (var i = 0; i &lt; this._labels.length; i++) {
+			var v = this.getCoord(this._labels[i].value, plotArea, plot);
+			if (plane == &quot;x&quot;) {
+				g.appendChild(createLabel(this._labels[i].label, v, coord, textSize, anchor));
+			} else {
+				if (plane == &quot;y&quot;) {
+					g.appendChild(createLabel(this._labels[i].label, coord, v, textSize, anchor));
+				}
+			}
+		}
+		return g;
+	}, render:function (plotArea, plot, drawAgainst, plane) {
+		if (!this._rerender &amp;&amp; this.nodes.main) {
+			return this.nodes.main;
+		}
+		this._rerender = false;
+		var area = plotArea.getArea();
+		var stroke = 1;
+		var style = &quot;stroke:#000;stroke-width:&quot; + stroke + &quot;px;&quot;;
+		var textSize = 10;
+		var coord = drawAgainst.getCoord(this.origin, plotArea, plot);
+		this.nodes.main = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var g = this.nodes.main;
+		g.setAttribute(&quot;id&quot;, this.getId());
+		var line = this.nodes.axis = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+		if (plane == &quot;x&quot;) {
+			line.setAttribute(&quot;y1&quot;, coord);
+			line.setAttribute(&quot;y2&quot;, coord);
+			line.setAttribute(&quot;x1&quot;, area.left - stroke);
+			line.setAttribute(&quot;x2&quot;, area.right + stroke);
+			line.setAttribute(&quot;style&quot;, style);
+			var y = coord + textSize + 2;
+			if (this.showLines) {
+				g.appendChild(this.renderLines(plotArea, plot, plane, y));
+			}
+			if (this.showTicks) {
+				g.appendChild(this.renderTicks(plotArea, plot, plane, coord));
+			}
+			if (this.showLabels) {
+				g.appendChild(this.renderLabels(plotArea, plot, plane, y, textSize, &quot;middle&quot;));
+			}
+			if (this.showLabel &amp;&amp; this.label) {
+				var x = plotArea.size.width / 2;
+				var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+				text.setAttribute(&quot;x&quot;, x);
+				text.setAttribute(&quot;y&quot;, (coord + (textSize * 2) + (textSize / 2)));
+				text.setAttribute(&quot;style&quot;, &quot;text-anchor:middle;font-family:sans-serif;font-weight:bold;font-size:&quot; + (textSize + 2) + &quot;px;fill:#000;&quot;);
+				text.appendChild(document.createTextNode(this.label));
+				g.appendChild(text);
+			}
+		} else {
+			line.setAttribute(&quot;x1&quot;, coord);
+			line.setAttribute(&quot;x2&quot;, coord);
+			line.setAttribute(&quot;y1&quot;, area.top);
+			line.setAttribute(&quot;y2&quot;, area.bottom);
+			line.setAttribute(&quot;style&quot;, style);
+			var isMax = this.origin == drawAgainst.range.upper;
+			var x = coord + (isMax ? 4 : -4);
+			var anchor = isMax ? &quot;start&quot; : &quot;end&quot;;
+			if (this.showLines) {
+				g.appendChild(this.renderLines(plotArea, plot, plane, x));
+			}
+			if (this.showTicks) {
+				g.appendChild(this.renderTicks(plotArea, plot, plane, coord));
+			}
+			if (this.showLabels) {
+				g.appendChild(this.renderLabels(plotArea, plot, plane, x, textSize, anchor));
+			}
+			if (this.showLabel &amp;&amp; this.label) {
+				var x = isMax ? (coord + (textSize * 2) + (textSize / 2)) : (coord - (textSize * 4));
+				var y = plotArea.size.height / 2;
+				var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+				text.setAttribute(&quot;x&quot;, x);
+				text.setAttribute(&quot;y&quot;, y);
+				text.setAttribute(&quot;transform&quot;, &quot;rotate(90, &quot; + x + &quot;, &quot; + y + &quot;)&quot;);
+				text.setAttribute(&quot;style&quot;, &quot;text-anchor:middle;font-family:sans-serif;font-weight:bold;font-size:&quot; + (textSize + 2) + &quot;px;fill:#000;&quot;);
+				text.appendChild(document.createTextNode(this.label));
+				g.appendChild(text);
+			}
+		}
+		g.appendChild(line);
+		return g;
+	}});
+}
+

Added: tags/parley-0.55/root/static/magic/src/charting/svg/PlotArea.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/svg/PlotArea.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/svg/PlotArea.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,77 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.svg.PlotArea&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+if (dojo.render.svg.capable) {
+	dojo.require(&quot;dojo.svg&quot;);
+	dojo.extend(dojo.charting.PlotArea, {resize:function () {
+		var area = this.getArea();
+		this.nodes.area.setAttribute(&quot;width&quot;, this.size.width);
+		this.nodes.area.setAttribute(&quot;height&quot;, this.size.height);
+		var rect = this.nodes.area.getElementsByTagName(&quot;rect&quot;)[0];
+		rect.setAttribute(&quot;x&quot;, area.left);
+		rect.setAttribute(&quot;y&quot;, area.top);
+		rect.setAttribute(&quot;width&quot;, area.right - area.left);
+		rect.setAttribute(&quot;height&quot;, area.bottom - area.top);
+		this.nodes.background.setAttribute(&quot;width&quot;, this.size.width);
+		this.nodes.background.setAttribute(&quot;height&quot;, this.size.height);
+		if (this.nodes.plots) {
+			this.nodes.area.removeChild(this.nodes.plots);
+			this.nodes.plots = null;
+		}
+		this.nodes.plots = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		this.nodes.plots.setAttribute(&quot;id&quot;, this.getId() + &quot;-plots&quot;);
+		this.nodes.plots.setAttribute(&quot;style&quot;, &quot;clip-path:url(#&quot; + this.getId() + &quot;-clip);&quot;);
+		this.nodes.area.appendChild(this.nodes.plots);
+		for (var i = 0; i &lt; this.plots.length; i++) {
+			this.nodes.plots.appendChild(this.initializePlot(this.plots[i]));
+		}
+		if (this.nodes.axes) {
+			this.nodes.area.removeChild(this.nodes.axes);
+			this.nodes.axes = null;
+		}
+		this.nodes.axes = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		this.nodes.axes.setAttribute(&quot;id&quot;, this.getId() + &quot;-axes&quot;);
+		this.nodes.area.appendChild(this.nodes.axes);
+		var axes = this.getAxes();
+		for (var p in axes) {
+			var obj = axes[p];
+			this.nodes.axes.appendChild(obj.axis.initialize(this, obj.plot, obj.drawAgainst, obj.plane));
+		}
+	}, initializePlot:function (plot) {
+		plot.destroy();
+		plot.dataNode = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		plot.dataNode.setAttribute(&quot;id&quot;, plot.getId());
+		return plot.dataNode;
+	}, initialize:function () {
+		this.destroy();
+		this.nodes.main = document.createElement(&quot;div&quot;);
+		this.nodes.area = document.createElementNS(dojo.svg.xmlns.svg, &quot;svg&quot;);
+		this.nodes.area.setAttribute(&quot;id&quot;, this.getId());
+		this.nodes.main.appendChild(this.nodes.area);
+		var defs = document.createElementNS(dojo.svg.xmlns.svg, &quot;defs&quot;);
+		var clip = document.createElementNS(dojo.svg.xmlns.svg, &quot;clipPath&quot;);
+		clip.setAttribute(&quot;id&quot;, this.getId() + &quot;-clip&quot;);
+		var rect = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+		clip.appendChild(rect);
+		defs.appendChild(clip);
+		this.nodes.area.appendChild(defs);
+		this.nodes.background = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+		this.nodes.background.setAttribute(&quot;id&quot;, this.getId() + &quot;-background&quot;);
+		this.nodes.background.setAttribute(&quot;fill&quot;, &quot;#fff&quot;);
+		this.nodes.area.appendChild(this.nodes.background);
+		this.resize();
+		return this.nodes.main;
+	}});
+}
+

Added: tags/parley-0.55/root/static/magic/src/charting/svg/Plotters.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/svg/Plotters.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/svg/Plotters.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,702 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.svg.Plotters&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+if (dojo.render.svg.capable) {
+	dojo.require(&quot;dojo.svg&quot;);
+	dojo.mixin(dojo.charting.Plotters, {Bar:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = plot.series.length;
+		var data = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			data.push(tmp);
+		}
+		var space = 8;
+		var nPoints = data[0].length;
+		if (nPoints == 0) {
+			return group;
+		}
+		var width = ((area.right - area.left) - (space * (nPoints - 1))) / nPoints;
+		var barWidth = width / n;
+		var yOrigin = plot.axisY.getCoord(plot.axisX.origin, plotarea, plot);
+		for (var i = 0; i &lt; nPoints; i++) {
+			var xStart = area.left + (width * i) + (space * i);
+			for (var j = 0; j &lt; n; j++) {
+				var value = data[j][i].y;
+				var yA = yOrigin;
+				var x = xStart + (barWidth * j);
+				var y = plot.axisY.getCoord(value, plotarea, plot);
+				var h = Math.abs(yA - y);
+				if (value &lt; plot.axisX.origin) {
+					yA = y;
+					y = yOrigin;
+				}
+				var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+				bar.setAttribute(&quot;fill&quot;, data[j][i].series.color);
+				bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+				bar.setAttribute(&quot;x&quot;, x);
+				bar.setAttribute(&quot;y&quot;, y);
+				bar.setAttribute(&quot;width&quot;, barWidth);
+				bar.setAttribute(&quot;height&quot;, h);
+				bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+				if (applyTo) {
+					applyTo(bar, data[j][i].src);
+				}
+				group.appendChild(bar);
+			}
+		}
+		return group;
+	}, HorizontalBar:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = plot.series.length;
+		var data = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			data.push(tmp);
+		}
+		var space = 6;
+		var nPoints = data[0].length;
+		if (nPoints == 0) {
+			return group;
+		}
+		var h = ((area.bottom - area.top) - (space * (nPoints - 1))) / nPoints;
+		var barH = h / n;
+		var xOrigin = plot.axisX.getCoord(0, plotarea, plot);
+		for (var i = 0; i &lt; nPoints; i++) {
+			var yStart = area.top + (h * i) + (space * i);
+			for (var j = 0; j &lt; n; j++) {
+				var value = data[j][i].y;
+				var y = yStart + (barH * j);
+				var xA = xOrigin;
+				var x = plot.axisX.getCoord(value, plotarea, plot);
+				var w = Math.abs(x - xA);
+				if (value &gt; 0) {
+					x = xOrigin;
+				}
+				var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+				bar.setAttribute(&quot;fill&quot;, data[j][i].series.color);
+				bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+				bar.setAttribute(&quot;x&quot;, xA);
+				bar.setAttribute(&quot;y&quot;, y);
+				bar.setAttribute(&quot;width&quot;, w);
+				bar.setAttribute(&quot;height&quot;, barH);
+				bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+				if (applyTo) {
+					applyTo(bar, data[j][i].src);
+				}
+				group.appendChild(bar);
+			}
+		}
+		return group;
+	}, Gantt:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = plot.series.length;
+		var data = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			data.push(tmp);
+		}
+		var space = 2;
+		var nPoints = data[0].length;
+		if (nPoints == 0) {
+			return group;
+		}
+		var h = ((area.bottom - area.top) - (space * (nPoints - 1))) / nPoints;
+		var barH = h / n;
+		for (var i = 0; i &lt; nPoints; i++) {
+			var yStart = area.top + (h * i) + (space * i);
+			for (var j = 0; j &lt; n; j++) {
+				var high = data[j][i].high;
+				var low = data[j][i].low;
+				if (low &gt; high) {
+					var t = high;
+					high = low;
+					low = t;
+				}
+				var x = plot.axisX.getCoord(low, plotarea, plot);
+				var w = plot.axisX.getCoord(high, plotarea, plot) - x;
+				var y = yStart + (barH * j);
+				var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+				bar.setAttribute(&quot;fill&quot;, data[j][i].series.color);
+				bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+				bar.setAttribute(&quot;x&quot;, x);
+				bar.setAttribute(&quot;y&quot;, y);
+				bar.setAttribute(&quot;width&quot;, w);
+				bar.setAttribute(&quot;height&quot;, barH);
+				bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+				if (applyTo) {
+					applyTo(bar, data[j][i].src);
+				}
+				group.appendChild(bar);
+			}
+		}
+		return group;
+	}, StackedArea:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = plot.series.length;
+		var data = [];
+		var totals = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			for (var j = 0; j &lt; tmp.length; j++) {
+				if (i == 0) {
+					totals.push(tmp[j].y);
+				} else {
+					totals[j] += tmp[j].y;
+				}
+				tmp[j].y = totals[j];
+			}
+			data.push(tmp);
+		}
+		for (var i = n - 1; i &gt;= 0; i--) {
+			var path = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+			path.setAttribute(&quot;fill&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;fill-opacity&quot;, &quot;0.4&quot;);
+			path.setAttribute(&quot;stroke&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			path.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+			var cmd = [];
+			var r = 3;
+			for (var j = 0; j &lt; data[i].length; j++) {
+				var values = data[i];
+				var x = plot.axisX.getCoord(values[j].x, plotarea, plot);
+				var y = plot.axisY.getCoord(values[j].y, plotarea, plot);
+				if (j == 0) {
+					cmd.push(&quot;M&quot;);
+				} else {
+					cmd.push(&quot;L&quot;);
+				}
+				cmd.push(x + &quot;,&quot; + y);
+				var c = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+				c.setAttribute(&quot;cx&quot;, x);
+				c.setAttribute(&quot;cy&quot;, y);
+				c.setAttribute(&quot;r&quot;, &quot;3&quot;);
+				c.setAttribute(&quot;fill&quot;, values[j].series.color);
+				c.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+				c.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+				c.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+				group.appendChild(c);
+				if (applyTo) {
+					applyTo(c, data[i].src);
+				}
+			}
+			if (i == 0) {
+				cmd.push(&quot;L&quot;);
+				cmd.push(x + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+				cmd.push(&quot;L&quot;);
+				cmd.push(plot.axisX.getCoord(data[0][0].x, plotarea, plot) + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+				cmd.push(&quot;Z&quot;);
+			} else {
+				var values = data[i - 1];
+				cmd.push(&quot;L&quot;);
+				cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(values[values.length - 1].y, plotarea, plot)));
+				for (var j = values.length - 2; j &gt;= 0; j--) {
+					var x = plot.axisX.getCoord(values[j].x, plotarea, plot);
+					var y = plot.axisY.getCoord(values[j].y, plotarea, plot);
+					cmd.push(&quot;L&quot;);
+					cmd.push(x + &quot;,&quot; + y);
+				}
+			}
+			path.setAttribute(&quot;d&quot;, cmd.join(&quot; &quot;) + &quot; Z&quot;);
+			group.appendChild(path);
+		}
+		return group;
+	}, StackedCurvedArea:function (plotarea, plot, kwArgs, applyTo) {
+		var tension = 3;
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = plot.series.length;
+		var data = [];
+		var totals = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			for (var j = 0; j &lt; tmp.length; j++) {
+				if (i == 0) {
+					totals.push(tmp[j].y);
+				} else {
+					totals[j] += tmp[j].y;
+				}
+				tmp[j].y = totals[j];
+			}
+			data.push(tmp);
+		}
+		for (var i = n - 1; i &gt;= 0; i--) {
+			var path = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+			path.setAttribute(&quot;fill&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;fill-opacity&quot;, &quot;0.4&quot;);
+			path.setAttribute(&quot;stroke&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			path.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+			var cmd = [];
+			var r = 3;
+			for (var j = 0; j &lt; data[i].length; j++) {
+				var values = data[i];
+				var x = plot.axisX.getCoord(values[j].x, plotarea, plot);
+				var y = plot.axisY.getCoord(values[j].y, plotarea, plot);
+				var dx = area.left + 1;
+				var dy = area.bottom;
+				if (j &gt; 0) {
+					dx = x - plot.axisX.getCoord(values[j - 1].x, plotarea, plot);
+					dy = plot.axisY.getCoord(values[j - 1].y, plotarea, plot);
+				}
+				if (j == 0) {
+					cmd.push(&quot;M&quot;);
+				} else {
+					cmd.push(&quot;C&quot;);
+					var cx = x - (tension - 1) * (dx / tension);
+					cmd.push(cx + &quot;,&quot; + dy);
+					cx = x - (dx / tension);
+					cmd.push(cx + &quot;,&quot; + y);
+				}
+				cmd.push(x + &quot;,&quot; + y);
+				var c = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+				c.setAttribute(&quot;cx&quot;, x);
+				c.setAttribute(&quot;cy&quot;, y);
+				c.setAttribute(&quot;r&quot;, &quot;3&quot;);
+				c.setAttribute(&quot;fill&quot;, values[j].series.color);
+				c.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+				c.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+				c.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+				group.appendChild(c);
+				if (applyTo) {
+					applyTo(c, data[i].src);
+				}
+			}
+			if (i == 0) {
+				cmd.push(&quot;L&quot;);
+				cmd.push(x + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+				cmd.push(&quot;L&quot;);
+				cmd.push(plot.axisX.getCoord(data[0][0].x, plotarea, plot) + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+				cmd.push(&quot;Z&quot;);
+			} else {
+				var values = data[i - 1];
+				cmd.push(&quot;L&quot;);
+				cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(values[values.length - 1].y, plotarea, plot)));
+				for (var j = values.length - 2; j &gt;= 0; j--) {
+					var x = plot.axisX.getCoord(values[j].x, plotarea, plot);
+					var y = plot.axisY.getCoord(values[j].y, plotarea, plot);
+					var dx = x - plot.axisX.getCoord(values[j + 1].x, plotarea, plot);
+					var dy = plot.axisY.getCoord(values[j + 1].y, plotarea, plot);
+					cmd.push(&quot;C&quot;);
+					var cx = x - (tension - 1) * (dx / tension);
+					cmd.push(cx + &quot;,&quot; + dy);
+					cx = x - (dx / tension);
+					cmd.push(cx + &quot;,&quot; + y);
+					cmd.push(x + &quot;,&quot; + y);
+				}
+			}
+			path.setAttribute(&quot;d&quot;, cmd.join(&quot; &quot;) + &quot; Z&quot;);
+			group.appendChild(path);
+		}
+		return group;
+	}, DataBar:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = data.length;
+		var w = (area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower);
+		var yOrigin = plot.axisY.getCoord(plot.axisX.origin, plotarea, plot);
+		for (var i = 0; i &lt; n; i++) {
+			var value = data[i].y;
+			var yA = yOrigin;
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(value, plotarea, plot);
+			var h = Math.abs(yA - y);
+			if (value &lt; plot.axisX.origin) {
+				yA = y;
+				y = yOrigin;
+			}
+			var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+			bar.setAttribute(&quot;fill&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			bar.setAttribute(&quot;x&quot;, x);
+			bar.setAttribute(&quot;y&quot;, y);
+			bar.setAttribute(&quot;width&quot;, w);
+			bar.setAttribute(&quot;height&quot;, h);
+			bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			if (applyTo) {
+				applyTo(bar, data[i].src);
+			}
+			group.appendChild(bar);
+		}
+		return group;
+	}, Line:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		if (data.length == 0) {
+			return line;
+		}
+		var path = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+		line.appendChild(path);
+		path.setAttribute(&quot;fill&quot;, &quot;none&quot;);
+		path.setAttribute(&quot;stroke&quot;, data[0].series.color);
+		path.setAttribute(&quot;stroke-width&quot;, &quot;2&quot;);
+		path.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+		if (data[0].series.label != null) {
+			path.setAttribute(&quot;title&quot;, data[0].series.label);
+		}
+		var cmd = [];
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot);
+			var y = plot.axisY.getCoord(data[i].y, plotarea, plot);
+			if (i == 0) {
+				cmd.push(&quot;M&quot;);
+			} else {
+				cmd.push(&quot;L&quot;);
+			}
+			cmd.push(x + &quot;,&quot; + y);
+			var c = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+			c.setAttribute(&quot;cx&quot;, x);
+			c.setAttribute(&quot;cy&quot;, y);
+			c.setAttribute(&quot;r&quot;, &quot;3&quot;);
+			c.setAttribute(&quot;fill&quot;, data[i].series.color);
+			c.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			c.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			c.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+			line.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		path.setAttribute(&quot;d&quot;, cmd.join(&quot; &quot;));
+		return line;
+	}, CurvedLine:function (data, plotarea, plot, applyTo) {
+		var tension = 3;
+		var area = plotarea.getArea();
+		var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		if (data.length == 0) {
+			return line;
+		}
+		var path = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+		line.appendChild(path);
+		path.setAttribute(&quot;fill&quot;, &quot;none&quot;);
+		path.setAttribute(&quot;stroke&quot;, data[0].series.color);
+		path.setAttribute(&quot;stroke-width&quot;, &quot;2&quot;);
+		path.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+		if (data[0].series.label != null) {
+			path.setAttribute(&quot;title&quot;, data[0].series.label);
+		}
+		var cmd = [];
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot);
+			var y = plot.axisY.getCoord(data[i].y, plotarea, plot);
+			var dx = area.left + 1;
+			var dy = area.bottom;
+			if (i &gt; 0) {
+				dx = x - plot.axisX.getCoord(data[i - 1].x, plotarea, plot);
+				dy = plot.axisY.getCoord(data[i - 1].y, plotarea, plot);
+			}
+			if (i == 0) {
+				cmd.push(&quot;M&quot;);
+			} else {
+				cmd.push(&quot;C&quot;);
+				var cx = x - (tension - 1) * (dx / tension);
+				cmd.push(cx + &quot;,&quot; + dy);
+				cx = x - (dx / tension);
+				cmd.push(cx + &quot;,&quot; + y);
+			}
+			cmd.push(x + &quot;,&quot; + y);
+			var c = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+			c.setAttribute(&quot;cx&quot;, x);
+			c.setAttribute(&quot;cy&quot;, y);
+			c.setAttribute(&quot;r&quot;, &quot;3&quot;);
+			c.setAttribute(&quot;fill&quot;, data[i].series.color);
+			c.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			c.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			c.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+			line.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		path.setAttribute(&quot;d&quot;, cmd.join(&quot; &quot;));
+		return line;
+	}, Area:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		if (data.length == 0) {
+			return line;
+		}
+		var path = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+		line.appendChild(path);
+		path.setAttribute(&quot;fill&quot;, data[0].series.color);
+		path.setAttribute(&quot;fill-opacity&quot;, &quot;0.4&quot;);
+		path.setAttribute(&quot;stroke&quot;, data[0].series.color);
+		path.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+		path.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+		if (data[0].series.label != null) {
+			path.setAttribute(&quot;title&quot;, data[0].series.label);
+		}
+		var cmd = [];
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot);
+			var y = plot.axisY.getCoord(data[i].y, plotarea, plot);
+			if (i == 0) {
+				cmd.push(&quot;M&quot;);
+			} else {
+				cmd.push(&quot;L&quot;);
+			}
+			cmd.push(x + &quot;,&quot; + y);
+			var c = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+			c.setAttribute(&quot;cx&quot;, x);
+			c.setAttribute(&quot;cy&quot;, y);
+			c.setAttribute(&quot;r&quot;, &quot;3&quot;);
+			c.setAttribute(&quot;fill&quot;, data[i].series.color);
+			c.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			c.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			c.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+			line.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		cmd.push(&quot;L&quot;);
+		cmd.push(x + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+		cmd.push(&quot;L&quot;);
+		cmd.push(plot.axisX.getCoord(data[0].x, plotarea, plot) + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+		cmd.push(&quot;Z&quot;);
+		path.setAttribute(&quot;d&quot;, cmd.join(&quot; &quot;));
+		return line;
+	}, CurvedArea:function (data, plotarea, plot, applyTo) {
+		var tension = 3;
+		var area = plotarea.getArea();
+		var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		if (data.length == 0) {
+			return line;
+		}
+		var path = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+		line.appendChild(path);
+		path.setAttribute(&quot;fill&quot;, data[0].series.color);
+		path.setAttribute(&quot;fill-opacity&quot;, &quot;0.4&quot;);
+		path.setAttribute(&quot;stroke&quot;, data[0].series.color);
+		path.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+		path.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+		if (data[0].series.label != null) {
+			path.setAttribute(&quot;title&quot;, data[0].series.label);
+		}
+		var cmd = [];
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot);
+			var y = plot.axisY.getCoord(data[i].y, plotarea, plot);
+			var dx = area.left + 1;
+			var dy = area.bottom;
+			if (i &gt; 0) {
+				dx = x - plot.axisX.getCoord(data[i - 1].x, plotarea, plot);
+				dy = plot.axisY.getCoord(data[i - 1].y, plotarea, plot);
+			}
+			if (i == 0) {
+				cmd.push(&quot;M&quot;);
+			} else {
+				cmd.push(&quot;C&quot;);
+				var cx = x - (tension - 1) * (dx / tension);
+				cmd.push(cx + &quot;,&quot; + dy);
+				cx = x - (dx / tension);
+				cmd.push(cx + &quot;,&quot; + y);
+			}
+			cmd.push(x + &quot;,&quot; + y);
+			var c = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+			c.setAttribute(&quot;cx&quot;, x);
+			c.setAttribute(&quot;cy&quot;, y);
+			c.setAttribute(&quot;r&quot;, &quot;3&quot;);
+			c.setAttribute(&quot;fill&quot;, data[i].series.color);
+			c.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			c.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			c.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+			line.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		cmd.push(&quot;L&quot;);
+		cmd.push(x + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+		cmd.push(&quot;L&quot;);
+		cmd.push(plot.axisX.getCoord(data[0].x, plotarea, plot) + &quot;,&quot; + plot.axisY.getCoord(plot.axisX.origin, plotarea, plot));
+		cmd.push(&quot;Z&quot;);
+		path.setAttribute(&quot;d&quot;, cmd.join(&quot; &quot;));
+		return line;
+	}, HighLow:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = data.length;
+		var part = ((area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower)) / 4;
+		var w = part * 2;
+		for (var i = 0; i &lt; n; i++) {
+			var high = data[i].high;
+			var low = data[i].low;
+			if (low &gt; high) {
+				var t = low;
+				low = high;
+				high = t;
+			}
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(high, plotarea, plot);
+			var h = plot.axisY.getCoord(low, plotarea, plot) - y;
+			var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+			bar.setAttribute(&quot;fill&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			bar.setAttribute(&quot;x&quot;, x);
+			bar.setAttribute(&quot;y&quot;, y);
+			bar.setAttribute(&quot;width&quot;, w);
+			bar.setAttribute(&quot;height&quot;, h);
+			bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			if (applyTo) {
+				applyTo(bar, data[i].src);
+			}
+			group.appendChild(bar);
+		}
+		return group;
+	}, HighLowClose:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = data.length;
+		var part = ((area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower)) / 4;
+		var w = part * 2;
+		for (var i = 0; i &lt; n; i++) {
+			var high = data[i].high;
+			var low = data[i].low;
+			if (low &gt; high) {
+				var t = low;
+				low = high;
+				high = t;
+			}
+			var c = data[i].close;
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(high, plotarea, plot);
+			var h = plot.axisY.getCoord(low, plotarea, plot) - y;
+			var close = plot.axisY.getCoord(c, plotarea, plot);
+			var g = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+			var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+			bar.setAttribute(&quot;fill&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			bar.setAttribute(&quot;x&quot;, x);
+			bar.setAttribute(&quot;y&quot;, y);
+			bar.setAttribute(&quot;width&quot;, w);
+			bar.setAttribute(&quot;height&quot;, h);
+			bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			g.appendChild(bar);
+			var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+			line.setAttribute(&quot;x1&quot;, x);
+			line.setAttribute(&quot;x2&quot;, x + w + (part * 2));
+			line.setAttribute(&quot;y1&quot;, close);
+			line.setAttribute(&quot;y2&quot;, close);
+			line.setAttribute(&quot;style&quot;, &quot;stroke:&quot; + data[i].series.color + &quot;;stroke-width:1px;stroke-opacity:0.6;&quot;);
+			g.appendChild(line);
+			if (applyTo) {
+				applyTo(g, data[i].src);
+			}
+			group.appendChild(g);
+		}
+		return group;
+	}, HighLowOpenClose:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var n = data.length;
+		var part = ((area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower)) / 4;
+		var w = part * 2;
+		for (var i = 0; i &lt; n; i++) {
+			var high = data[i].high;
+			var low = data[i].low;
+			if (low &gt; high) {
+				var t = low;
+				low = high;
+				high = t;
+			}
+			var o = data[i].open;
+			var c = data[i].close;
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(high, plotarea, plot);
+			var h = plot.axisY.getCoord(low, plotarea, plot) - y;
+			var open = plot.axisY.getCoord(o, plotarea, plot);
+			var close = plot.axisY.getCoord(c, plotarea, plot);
+			var g = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+			var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+			bar.setAttribute(&quot;fill&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			bar.setAttribute(&quot;x&quot;, x);
+			bar.setAttribute(&quot;y&quot;, y);
+			bar.setAttribute(&quot;width&quot;, w);
+			bar.setAttribute(&quot;height&quot;, h);
+			bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.6&quot;);
+			g.appendChild(bar);
+			var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+			line.setAttribute(&quot;x1&quot;, x - (part * 2));
+			line.setAttribute(&quot;x2&quot;, x + w);
+			line.setAttribute(&quot;y1&quot;, open);
+			line.setAttribute(&quot;y2&quot;, open);
+			line.setAttribute(&quot;style&quot;, &quot;stroke:&quot; + data[i].series.color + &quot;;stroke-width:1px;stroke-opacity:0.6;&quot;);
+			g.appendChild(line);
+			var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+			line.setAttribute(&quot;x1&quot;, x);
+			line.setAttribute(&quot;x2&quot;, x + w + (part * 2));
+			line.setAttribute(&quot;y1&quot;, close);
+			line.setAttribute(&quot;y2&quot;, close);
+			line.setAttribute(&quot;style&quot;, &quot;stroke:&quot; + data[i].series.color + &quot;;stroke-width:1px;stroke-opacity:0.6;&quot;);
+			g.appendChild(line);
+			if (applyTo) {
+				applyTo(g, data[i].src);
+			}
+			group.appendChild(g);
+		}
+		return group;
+	}, Scatter:function (data, plotarea, plot, applyTo) {
+		var r = 7;
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot);
+			var y = plot.axisY.getCoord(data[i].y, plotarea, plot);
+			var point = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+			point.setAttribute(&quot;fill&quot;, data[i].series.color);
+			point.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			point.setAttribute(&quot;d&quot;, &quot;M &quot; + x + &quot;,&quot; + (y - r) + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + (x + r) + &quot;,&quot; + y + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + x + &quot;,&quot; + (y + r) + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + (x - r) + &quot;,&quot; + y + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + x + &quot;,&quot; + (y - r) + &quot; &quot; + &quot;Z&quot;);
+			if (applyTo) {
+				applyTo(point, data[i].src);
+			}
+			group.appendChild(point);
+		}
+		return group;
+	}, Bubble:function (data, plotarea, plot, applyTo) {
+		var group = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+		var sizeFactor = 1;
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot);
+			var y = plot.axisY.getCoord(data[i].y, plotarea, plot);
+			if (i == 0) {
+				var raw = data[i].size;
+				var dy = plot.axisY.getCoord(data[i].y + raw, plotarea, plot) - y;
+				sizeFactor = dy / raw;
+			}
+			if (sizeFactor &lt; 1) {
+				sizeFactor = 1;
+			}
+			var point = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+			point.setAttribute(&quot;fill&quot;, data[i].series.color);
+			point.setAttribute(&quot;fill-opacity&quot;, &quot;0.8&quot;);
+			point.setAttribute(&quot;stroke&quot;, data[i].series.color);
+			point.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+			point.setAttribute(&quot;cx&quot;, x);
+			point.setAttribute(&quot;cy&quot;, y);
+			point.setAttribute(&quot;r&quot;, (data[i].size / 2) * sizeFactor);
+			if (applyTo) {
+				applyTo(point, data[i].src);
+			}
+			group.appendChild(point);
+		}
+		return group;
+	}});
+	dojo.charting.Plotters[&quot;Default&quot;] = dojo.charting.Plotters.Line;
+}
+

Added: tags/parley-0.55/root/static/magic/src/charting/vml/Axis.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/vml/Axis.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/vml/Axis.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,239 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.vml.Axis&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+if (dojo.render.vml.capable) {
+	dojo.extend(dojo.charting.Axis, {renderLines:function (plotArea, plot, plane) {
+		if (this.nodes.lines) {
+			while (this.nodes.lines.childNodes.length &gt; 0) {
+				this.nodes.lines.removeChild(this.nodes.lines.childNodes[0]);
+			}
+			if (this.nodes.lines.parentNode) {
+				this.nodes.lines.parentNode.removeChild(this.nodes.lines);
+				this.nodes.lines = null;
+			}
+		}
+		var area = plotArea.getArea();
+		var g = this.nodes.lines = document.createElement(&quot;div&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId() + &quot;-lines&quot;);
+		for (var i = 0; i &lt; this._labels.length; i++) {
+			if (this._labels[i].value == this.origin) {
+				continue;
+			}
+			var v = this.getCoord(this._labels[i].value, plotArea, plot);
+			var l = document.createElement(&quot;v:line&quot;);
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.dashstyle = &quot;dot&quot;;
+			l.appendChild(str);
+			l.setAttribute(&quot;strokecolor&quot;, &quot;#666&quot;);
+			l.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			var s = l.style;
+			s.position = &quot;absolute&quot;;
+			s.top = &quot;0px&quot;;
+			s.left = &quot;0px&quot;;
+			s.antialias = &quot;false&quot;;
+			if (plane == &quot;x&quot;) {
+				l.setAttribute(&quot;from&quot;, v + &quot;px,&quot; + area.top + &quot;px&quot;);
+				l.setAttribute(&quot;to&quot;, v + &quot;px,&quot; + area.bottom + &quot;px&quot;);
+			} else {
+				if (plane == &quot;y&quot;) {
+					l.setAttribute(&quot;from&quot;, area.left + &quot;px,&quot; + v + &quot;px&quot;);
+					l.setAttribute(&quot;to&quot;, area.right + &quot;px,&quot; + v + &quot;px&quot;);
+				}
+			}
+			g.appendChild(l);
+		}
+		return g;
+	}, renderTicks:function (plotArea, plot, plane, coord) {
+		if (this.nodes.ticks) {
+			while (this.nodes.ticks.childNodes.length &gt; 0) {
+				this.nodes.ticks.removeChild(this.nodes.ticks.childNodes[0]);
+			}
+			if (this.nodes.ticks.parentNode) {
+				this.nodes.ticks.parentNode.removeChild(this.nodes.ticks);
+				this.nodes.ticks = null;
+			}
+		}
+		var g = this.nodes.ticks = document.createElement(&quot;div&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId() + &quot;-ticks&quot;);
+		for (var i = 0; i &lt; this._labels.length; i++) {
+			var v = this.getCoord(this._labels[i].value, plotArea, plot);
+			var l = document.createElement(&quot;v:line&quot;);
+			l.setAttribute(&quot;strokecolor&quot;, &quot;#000&quot;);
+			l.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			var s = l.style;
+			s.position = &quot;absolute&quot;;
+			s.top = &quot;0px&quot;;
+			s.left = &quot;0px&quot;;
+			s.antialias = &quot;false&quot;;
+			if (plane == &quot;x&quot;) {
+				l.setAttribute(&quot;from&quot;, v + &quot;px,&quot; + coord + &quot;px&quot;);
+				l.setAttribute(&quot;to&quot;, v + &quot;px,&quot; + (coord + 3) + &quot;px&quot;);
+			} else {
+				if (plane == &quot;y&quot;) {
+					l.setAttribute(&quot;from&quot;, (coord - 2) + &quot;px,&quot; + v + &quot;px&quot;);
+					l.setAttribute(&quot;to&quot;, (coord + 2) + &quot;px,&quot; + v + &quot;px&quot;);
+				}
+			}
+			g.appendChild(l);
+		}
+		return g;
+	}, renderLabels:function (plotArea, plot, plane, coord, textSize, anchor) {
+		function createLabel(label, x, y, textSize, anchor) {
+			var text = document.createElement(&quot;div&quot;);
+			var s = text.style;
+			text.innerHTML = label;
+			s.fontSize = textSize + &quot;px&quot;;
+			s.fontFamily = &quot;sans-serif&quot;;
+			s.position = &quot;absolute&quot;;
+			s.top = y + &quot;px&quot;;
+			if (anchor == &quot;center&quot;) {
+				s.left = x + &quot;px&quot;;
+				s.textAlign = &quot;center&quot;;
+			} else {
+				if (anchor == &quot;left&quot;) {
+					s.left = x + &quot;px&quot;;
+					s.textAlign = &quot;left&quot;;
+				} else {
+					if (anchor == &quot;right&quot;) {
+						s.right = x + &quot;px&quot;;
+						s.textAlign = &quot;right&quot;;
+					}
+				}
+			}
+			return text;
+		}
+		if (this.nodes.labels) {
+			while (this.nodes.labels.childNodes.length &gt; 0) {
+				this.nodes.labels.removeChild(this.nodes.labels.childNodes[0]);
+			}
+			if (this.nodes.labels.parentNode) {
+				this.nodes.labels.parentNode.removeChild(this.nodes.labels);
+				this.nodes.labels = null;
+			}
+		}
+		var g = this.nodes.labels = document.createElement(&quot;div&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId() + &quot;-labels&quot;);
+		for (var i = 0; i &lt; this._labels.length; i++) {
+			var v = this.getCoord(this._labels[i].value, plotArea, plot);
+			if (plane == &quot;x&quot;) {
+				var node = createLabel(this._labels[i].label, v, coord, textSize, anchor);
+				document.body.appendChild(node);
+				node.style.left = v - (node.offsetWidth / 2) + &quot;px&quot;;
+				g.appendChild(node);
+			} else {
+				if (plane == &quot;y&quot;) {
+					var node = createLabel(this._labels[i].label, coord, v, textSize, anchor);
+					document.body.appendChild(node);
+					node.style.top = v - (node.offsetHeight / 2) + &quot;px&quot;;
+					g.appendChild(node);
+				}
+			}
+		}
+		return g;
+	}, render:function (plotArea, plot, drawAgainst, plane) {
+		if (!this._rerender &amp;&amp; this.nodes.main) {
+			return this.nodes.main;
+		}
+		this._rerender = false;
+		var area = plotArea.getArea();
+		var stroke = 1;
+		var style = &quot;stroke:#000;stroke-width:&quot; + stroke + &quot;px;&quot;;
+		var textSize = 10;
+		var coord = drawAgainst.getCoord(this.origin, plotArea, plot);
+		var g = this.nodes.main = document.createElement(&quot;div&quot;);
+		g.setAttribute(&quot;id&quot;, this.getId());
+		var line = this.nodes.axis = document.createElement(&quot;v:line&quot;);
+		line.setAttribute(&quot;strokecolor&quot;, &quot;#000&quot;);
+		line.setAttribute(&quot;strokeweight&quot;, stroke + &quot;px&quot;);
+		var s = line.style;
+		s.position = &quot;absolute&quot;;
+		s.top = &quot;0px&quot;;
+		s.left = &quot;0px&quot;;
+		s.antialias = &quot;false&quot;;
+		if (plane == &quot;x&quot;) {
+			line.setAttribute(&quot;from&quot;, area.left + &quot;px,&quot; + coord + &quot;px&quot;);
+			line.setAttribute(&quot;to&quot;, area.right + &quot;px,&quot; + coord + &quot;px&quot;);
+			var y = coord + Math.floor(textSize / 2);
+			if (this.showLines) {
+				g.appendChild(this.renderLines(plotArea, plot, plane, y));
+			}
+			if (this.showTicks) {
+				g.appendChild(this.renderTicks(plotArea, plot, plane, coord));
+			}
+			if (this.showLabels) {
+				g.appendChild(this.renderLabels(plotArea, plot, plane, y, textSize, &quot;center&quot;));
+			}
+			if (this.showLabel &amp;&amp; this.label) {
+				var x = plotArea.size.width / 2;
+				var y = coord + Math.round(textSize * 1.5);
+				var text = document.createElement(&quot;div&quot;);
+				var s = text.style;
+				text.innerHTML = this.label;
+				s.fontSize = (textSize + 2) + &quot;px&quot;;
+				s.fontFamily = &quot;sans-serif&quot;;
+				s.fontWeight = &quot;bold&quot;;
+				s.position = &quot;absolute&quot;;
+				s.top = y + &quot;px&quot;;
+				s.left = x + &quot;px&quot;;
+				s.textAlign = &quot;center&quot;;
+				document.body.appendChild(text);
+				text.style.left = x - (text.offsetWidth / 2) + &quot;px&quot;;
+				g.appendChild(text);
+			}
+		} else {
+			line.setAttribute(&quot;from&quot;, coord + &quot;px,&quot; + area.top + &quot;px&quot;);
+			line.setAttribute(&quot;to&quot;, coord + &quot;px,&quot; + area.bottom + &quot;px&quot;);
+			var isMax = this.origin == drawAgainst.range.upper;
+			var x = coord + 4;
+			var anchor = &quot;left&quot;;
+			if (!isMax) {
+				x = area.right - coord + textSize + 4;
+				anchor = &quot;right&quot;;
+				if (coord == area.left) {
+					x += (textSize * 2) - (textSize / 2);
+				}
+			}
+			if (this.showLines) {
+				g.appendChild(this.renderLines(plotArea, plot, plane, x));
+			}
+			if (this.showTicks) {
+				g.appendChild(this.renderTicks(plotArea, plot, plane, coord));
+			}
+			if (this.showLabels) {
+				g.appendChild(this.renderLabels(plotArea, plot, plane, x, textSize, anchor));
+			}
+			if (this.showLabel &amp;&amp; this.label) {
+				x += (textSize * 2) - 2;
+				var y = plotArea.size.height / 2;
+				var text = document.createElement(&quot;div&quot;);
+				var s = text.style;
+				text.innerHTML = this.label;
+				s.fontSize = (textSize + 2) + &quot;px&quot;;
+				s.fontFamily = &quot;sans-serif&quot;;
+				s.fontWeight = &quot;bold&quot;;
+				s.position = &quot;absolute&quot;;
+				s.height = plotArea.size.height + &quot;px&quot;;
+				s.writingMode = &quot;tb-rl&quot;;
+				s.textAlign = &quot;center&quot;;
+				s[anchor] = x + &quot;px&quot;;
+				document.body.appendChild(text);
+				s.top = y - (text.offsetHeight / 2) + &quot;px&quot;;
+				g.appendChild(text);
+			}
+		}
+		g.appendChild(line);
+		return g;
+	}});
+}
+

Added: tags/parley-0.55/root/static/magic/src/charting/vml/PlotArea.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/vml/PlotArea.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/vml/PlotArea.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,69 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.vml.PlotArea&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+if (dojo.render.vml.capable) {
+	dojo.extend(dojo.charting.PlotArea, {resize:function () {
+		var a = this.getArea();
+		this.nodes.area.style.width = this.size.width + &quot;px&quot;;
+		this.nodes.area.style.height = this.size.height + &quot;px&quot;;
+		this.nodes.background.style.width = this.size.width + &quot;px&quot;;
+		this.nodes.background.style.height = this.size.height + &quot;px&quot;;
+		this.nodes.plots.width = this.size.width + &quot;px&quot;;
+		this.nodes.plots.height = this.size.height + &quot;px&quot;;
+		this.nodes.plots.style.clip = &quot;rect(&quot; + a.top + &quot; &quot; + a.right + &quot; &quot; + a.bottom + &quot; &quot; + a.left + &quot;)&quot;;
+		if (this.nodes.axes) {
+			this.nodes.area.removeChild(this.nodes.axes);
+		}
+		var axes = this.nodes.axes = document.createElement(&quot;div&quot;);
+		axes.id = this.getId() + &quot;-axes&quot;;
+		this.nodes.area.appendChild(axes);
+		var ax = this.getAxes();
+		for (var p in ax) {
+			var obj = ax[p];
+			axes.appendChild(obj.axis.initialize(this, obj.plot, obj.drawAgainst, obj.plane));
+		}
+	}, initializePlot:function (plot) {
+		plot.destroy();
+		plot.dataNode = document.createElement(&quot;div&quot;);
+		plot.dataNode.id = plot.getId();
+		return plot.dataNode;
+	}, initialize:function () {
+		this.destroy();
+		var main = this.nodes.main = document.createElement(&quot;div&quot;);
+		var area = this.nodes.area = document.createElement(&quot;div&quot;);
+		area.id = this.getId();
+		area.style.position = &quot;absolute&quot;;
+		main.appendChild(area);
+		var bg = this.nodes.background = document.createElement(&quot;div&quot;);
+		bg.id = this.getId() + &quot;-background&quot;;
+		bg.style.position = &quot;absolute&quot;;
+		bg.style.top = &quot;0px&quot;;
+		bg.style.left = &quot;0px&quot;;
+		bg.style.backgroundColor = &quot;#fff&quot;;
+		area.appendChild(bg);
+		var a = this.getArea();
+		var plots = this.nodes.plots = document.createElement(&quot;div&quot;);
+		plots.id = this.getId() + &quot;-plots&quot;;
+		plots.style.position = &quot;absolute&quot;;
+		plots.style.top = &quot;0px&quot;;
+		plots.style.left = &quot;0px&quot;;
+		area.appendChild(plots);
+		for (var i = 0; i &lt; this.plots.length; i++) {
+			plots.appendChild(this.initializePlot(this.plots[i]));
+		}
+		this.resize();
+		return main;
+	}});
+}
+

Added: tags/parley-0.55/root/static/magic/src/charting/vml/Plotters.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/charting/vml/Plotters.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/charting/vml/Plotters.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,889 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.charting.vml.Plotters&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+if (dojo.render.vml.capable) {
+	dojo.mixin(dojo.charting.Plotters, {_group:function (plotarea) {
+		var group = document.createElement(&quot;div&quot;);
+		group.style.position = &quot;absolute&quot;;
+		group.style.top = &quot;0px&quot;;
+		group.style.left = &quot;0px&quot;;
+		group.style.width = plotarea.size.width + &quot;px&quot;;
+		group.style.height = plotarea.size.height + &quot;px&quot;;
+		return group;
+	}, Bar:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = plot.series.length;
+		var data = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			data.push(tmp);
+		}
+		var space = 8;
+		var nPoints = data[0].length;
+		if (nPoints == 0) {
+			return group;
+		}
+		var width = ((area.right - area.left) - (space * (nPoints - 1))) / nPoints;
+		var barWidth = Math.round(width / n);
+		var yOrigin = plot.axisY.getCoord(plot.axisX.origin, plotarea, plot);
+		for (var i = 0; i &lt; nPoints; i++) {
+			var xStart = area.left + (width * i) + (space * i);
+			for (var j = 0; j &lt; n; j++) {
+				var value = data[j][i].y;
+				var yA = yOrigin;
+				var x = xStart + (barWidth * j);
+				var y = plot.axisY.getCoord(value, plotarea, plot);
+				var h = Math.abs(yA - y);
+				if (value &lt; plot.axisX.origin) {
+					yA = y;
+					y = yOrigin;
+				}
+				var bar = document.createElement(&quot;v:rect&quot;);
+				bar.style.position = &quot;absolute&quot;;
+				bar.style.top = y + 1 + &quot;px&quot;;
+				bar.style.left = x + &quot;px&quot;;
+				bar.style.width = barWidth + &quot;px&quot;;
+				bar.style.height = h + &quot;px&quot;;
+				bar.setAttribute(&quot;fillColor&quot;, data[j][i].series.color);
+				bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+				bar.style.antialias = &quot;false&quot;;
+				var fill = document.createElement(&quot;v:fill&quot;);
+				fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+				bar.appendChild(fill);
+				if (applyTo) {
+					applyTo(bar, data[j][i].src);
+				}
+				group.appendChild(bar);
+			}
+		}
+		return group;
+	}, HorizontalBar:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = plot.series.length;
+		var data = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			data.push(tmp);
+		}
+		var space = 6;
+		var nPoints = data[0].length;
+		if (nPoints == 0) {
+			return group;
+		}
+		var h = ((area.bottom - area.top) - (space * (nPoints - 1))) / nPoints;
+		var barH = h / n;
+		var xOrigin = plot.axisX.getCoord(0, plotarea, plot);
+		for (var i = 0; i &lt; nPoints; i++) {
+			var yStart = area.top + (h * i) + (space * i);
+			for (var j = 0; j &lt; n; j++) {
+				var value = data[j][i].y;
+				var y = yStart + (barH * j);
+				var xA = xOrigin;
+				var x = plot.axisX.getCoord(value, plotarea, plot);
+				var w = Math.abs(x - xA);
+				if (value &gt; 0) {
+					x = xOrigin;
+				}
+				var bar = document.createElement(&quot;v:rect&quot;);
+				bar.style.position = &quot;absolute&quot;;
+				bar.style.top = y + 1 + &quot;px&quot;;
+				bar.style.left = xA + &quot;px&quot;;
+				bar.style.width = w + &quot;px&quot;;
+				bar.style.height = barH + &quot;px&quot;;
+				bar.setAttribute(&quot;fillColor&quot;, data[j][i].series.color);
+				bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+				bar.style.antialias = &quot;false&quot;;
+				var fill = document.createElement(&quot;v:fill&quot;);
+				fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+				bar.appendChild(fill);
+				if (applyTo) {
+					applyTo(bar, data[j][i].src);
+				}
+				group.appendChild(bar);
+			}
+		}
+		var space = 4;
+		var n = plot.series.length;
+		var h = ((area.bottom - area.top) - (space * (n - 1))) / n;
+		var xOrigin = plot.axisX.getCoord(0, plotarea, plot);
+		for (var i = 0; i &lt; n; i++) {
+			var series = plot.series[i];
+			var data = series.data.evaluate(kwArgs);
+			var y = area.top + (h * i) + (space * i);
+			var value = data[data.length - 1].y;
+			var xA = xOrigin;
+			var x = plot.axisX.getCoord(value, plotarea, plot);
+			var w = Math.abs(xA - x);
+			if (value &gt; 0) {
+				xA = x;
+				x = xOrigin;
+			}
+		}
+		return group;
+	}, Gantt:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = plot.series.length;
+		var data = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			data.push(tmp);
+		}
+		var space = 2;
+		var nPoints = data[0].length;
+		if (nPoints == 0) {
+			return group;
+		}
+		var h = ((area.bottom - area.top) - (space * (nPoints - 1))) / nPoints;
+		var barH = h / n;
+		for (var i = 0; i &lt; nPoints; i++) {
+			var yStart = area.top + (h * i) + (space * i);
+			for (var j = 0; j &lt; n; j++) {
+				var high = data[j][i].high;
+				var low = data[j][i].low;
+				if (low &gt; high) {
+					var t = high;
+					high = low;
+					low = t;
+				}
+				var x = plot.axisX.getCoord(low, plotarea, plot);
+				var w = plot.axisX.getCoord(high, plotarea, plot) - x;
+				var y = yStart + (barH * j);
+				var bar = document.createElement(&quot;v:rect&quot;);
+				bar.style.position = &quot;absolute&quot;;
+				bar.style.top = y + 1 + &quot;px&quot;;
+				bar.style.left = x + &quot;px&quot;;
+				bar.style.width = w + &quot;px&quot;;
+				bar.style.height = barH + &quot;px&quot;;
+				bar.setAttribute(&quot;fillColor&quot;, data[j][i].series.color);
+				bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+				bar.style.antialias = &quot;false&quot;;
+				var fill = document.createElement(&quot;v:fill&quot;);
+				fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+				bar.appendChild(fill);
+				if (applyTo) {
+					applyTo(bar, data[j][i].src);
+				}
+				group.appendChild(bar);
+			}
+		}
+		return group;
+	}, StackedArea:function (plotarea, plot, kwArgs, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = plot.series.length;
+		var data = [];
+		var totals = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			for (var j = 0; j &lt; tmp.length; j++) {
+				if (i == 0) {
+					totals.push(tmp[j].y);
+				} else {
+					totals[j] += tmp[j].y;
+				}
+				tmp[j].y = totals[j];
+			}
+			data.push(tmp);
+		}
+		for (var i = n - 1; i &gt;= 0; i--) {
+			var path = document.createElement(&quot;v:shape&quot;);
+			path.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			path.setAttribute(&quot;strokecolor&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;fillcolor&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;coordsize&quot;, (area.right - area.left) + &quot;,&quot; + (area.bottom - area.top));
+			path.style.position = &quot;absolute&quot;;
+			path.style.top = &quot;0px&quot;;
+			path.style.left = &quot;0px&quot;;
+			path.style.width = area.right - area.left + &quot;px&quot;;
+			path.style.height = area.bottom - area.top + &quot;px&quot;;
+			var stroke = document.createElement(&quot;v:stroke&quot;);
+			stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			path.appendChild(stroke);
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.4&quot;);
+			path.appendChild(fill);
+			var cmd = [];
+			var r = 3;
+			for (var j = 0; j &lt; data[i].length; j++) {
+				var values = data[i];
+				var x = Math.round(plot.axisX.getCoord(values[j].x, plotarea, plot));
+				var y = Math.round(plot.axisY.getCoord(values[j].y, plotarea, plot));
+				if (j == 0) {
+					cmd.push(&quot;m&quot;);
+					cmd.push(x + &quot;,&quot; + y);
+				} else {
+					cmd.push(&quot;l&quot;);
+					cmd.push(x + &quot;,&quot; + y);
+				}
+				var c = document.createElement(&quot;v:oval&quot;);
+				c.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+				c.setAttribute(&quot;strokecolor&quot;, values[j].series.color);
+				c.setAttribute(&quot;fillcolor&quot;, values[j].series.color);
+				var str = document.createElement(&quot;v:stroke&quot;);
+				str.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+				c.appendChild(str);
+				str = document.createElement(&quot;v:fill&quot;);
+				str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+				c.appendChild(str);
+				var s = c.style;
+				s.position = &quot;absolute&quot;;
+				s.top = (y - r) + &quot;px&quot;;
+				s.left = (x - r) + &quot;px&quot;;
+				s.width = (r * 2) + &quot;px&quot;;
+				s.height = (r * 2) + &quot;px&quot;;
+				group.appendChild(c);
+				if (applyTo) {
+					applyTo(c, data[j].src);
+				}
+			}
+			if (i == 0) {
+				cmd.push(&quot;l&quot;);
+				cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+				cmd.push(&quot;l&quot;);
+				cmd.push(Math.round(plot.axisX.getCoord(data[0][0].x, plotarea, plot)) + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+			} else {
+				var values = data[i - 1];
+				cmd.push(&quot;l&quot;);
+				cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(values[values.length - 1].y, plotarea, plot)));
+				for (var j = values.length - 2; j &gt;= 0; j--) {
+					var x = Math.round(plot.axisX.getCoord(values[j].x, plotarea, plot));
+					var y = Math.round(plot.axisY.getCoord(values[j].y, plotarea, plot));
+					cmd.push(&quot;l&quot;);
+					cmd.push(x + &quot;,&quot; + y);
+				}
+			}
+			path.setAttribute(&quot;path&quot;, cmd.join(&quot; &quot;) + &quot; x e&quot;);
+			group.appendChild(path);
+		}
+		return group;
+	}, StackedCurvedArea:function (plotarea, plot, kwArgs, applyTo) {
+		var tension = 3;
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = plot.series.length;
+		var data = [];
+		var totals = [];
+		for (var i = 0; i &lt; n; i++) {
+			var tmp = plot.series[i].data.evaluate(kwArgs);
+			for (var j = 0; j &lt; tmp.length; j++) {
+				if (i == 0) {
+					totals.push(tmp[j].y);
+				} else {
+					totals[j] += tmp[j].y;
+				}
+				tmp[j].y = totals[j];
+			}
+			data.push(tmp);
+		}
+		for (var i = n - 1; i &gt;= 0; i--) {
+			var path = document.createElement(&quot;v:shape&quot;);
+			path.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			path.setAttribute(&quot;strokecolor&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;fillcolor&quot;, data[i][0].series.color);
+			path.setAttribute(&quot;coordsize&quot;, (area.right - area.left) + &quot;,&quot; + (area.bottom - area.top));
+			path.style.position = &quot;absolute&quot;;
+			path.style.top = &quot;0px&quot;;
+			path.style.left = &quot;0px&quot;;
+			path.style.width = area.right - area.left + &quot;px&quot;;
+			path.style.height = area.bottom - area.top + &quot;px&quot;;
+			var stroke = document.createElement(&quot;v:stroke&quot;);
+			stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			path.appendChild(stroke);
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.4&quot;);
+			path.appendChild(fill);
+			var cmd = [];
+			var r = 3;
+			for (var j = 0; j &lt; data[i].length; j++) {
+				var values = data[i];
+				var x = Math.round(plot.axisX.getCoord(values[j].x, plotarea, plot));
+				var y = Math.round(plot.axisY.getCoord(values[j].y, plotarea, plot));
+				if (j == 0) {
+					cmd.push(&quot;m&quot;);
+					cmd.push(x + &quot;,&quot; + y);
+				} else {
+					var lastx = Math.round(plot.axisX.getCoord(values[j - 1].x, plotarea, plot));
+					var lasty = Math.round(plot.axisY.getCoord(values[j - 1].y, plotarea, plot));
+					var dx = x - lastx;
+					var dy = y - lasty;
+					cmd.push(&quot;c&quot;);
+					var cx = Math.round((x - (tension - 1) * (dx / tension)));
+					cmd.push(cx + &quot;,&quot; + lasty);
+					cx = Math.round((x - (dx / tension)));
+					cmd.push(cx + &quot;,&quot; + y);
+					cmd.push(x + &quot;,&quot; + y);
+				}
+				var c = document.createElement(&quot;v:oval&quot;);
+				c.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+				c.setAttribute(&quot;strokecolor&quot;, values[j].series.color);
+				c.setAttribute(&quot;fillcolor&quot;, values[j].series.color);
+				var str = document.createElement(&quot;v:stroke&quot;);
+				str.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+				c.appendChild(str);
+				str = document.createElement(&quot;v:fill&quot;);
+				str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+				c.appendChild(str);
+				var s = c.style;
+				s.position = &quot;absolute&quot;;
+				s.top = (y - r) + &quot;px&quot;;
+				s.left = (x - r) + &quot;px&quot;;
+				s.width = (r * 2) + &quot;px&quot;;
+				s.height = (r * 2) + &quot;px&quot;;
+				group.appendChild(c);
+				if (applyTo) {
+					applyTo(c, data[j].src);
+				}
+			}
+			if (i == 0) {
+				cmd.push(&quot;l&quot;);
+				cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+				cmd.push(&quot;l&quot;);
+				cmd.push(Math.round(plot.axisX.getCoord(data[0][0].x, plotarea, plot)) + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+			} else {
+				var values = data[i - 1];
+				cmd.push(&quot;l&quot;);
+				cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(values[values.length - 1].y, plotarea, plot)));
+				for (var j = values.length - 2; j &gt;= 0; j--) {
+					var x = Math.round(plot.axisX.getCoord(values[j].x, plotarea, plot));
+					var y = Math.round(plot.axisY.getCoord(values[j].y, plotarea, plot));
+					var lastx = Math.round(plot.axisX.getCoord(values[j + 1].x, plotarea, plot));
+					var lasty = Math.round(plot.axisY.getCoord(values[j + 1].y, plotarea, plot));
+					var dx = x - lastx;
+					var dy = y - lasty;
+					cmd.push(&quot;c&quot;);
+					var cx = Math.round((x - (tension - 1) * (dx / tension)));
+					cmd.push(cx + &quot;,&quot; + lasty);
+					cx = Math.round((x - (dx / tension)));
+					cmd.push(cx + &quot;,&quot; + y);
+					cmd.push(x + &quot;,&quot; + y);
+				}
+			}
+			path.setAttribute(&quot;path&quot;, cmd.join(&quot; &quot;) + &quot; x e&quot;);
+			group.appendChild(path);
+		}
+		return group;
+	}, DataBar:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = data.length;
+		var w = (area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower);
+		var yOrigin = plot.axisY.getCoord(plot.axisX.origin, plotarea, plot);
+		for (var i = 0; i &lt; n; i++) {
+			var value = data[i].y;
+			var yA = yOrigin;
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2) + 1;
+			var y = plot.axisY.getCoord(value, plotarea, plot);
+			var h = Math.abs(yA - y);
+			if (value &lt; plot.axisX.origin) {
+				yA = y;
+				y = yOrigin;
+			}
+			var bar = document.createElement(&quot;v:rect&quot;);
+			bar.style.position = &quot;absolute&quot;;
+			bar.style.top = y + 1 + &quot;px&quot;;
+			bar.style.left = x + &quot;px&quot;;
+			bar.style.width = w + &quot;px&quot;;
+			bar.style.height = h + &quot;px&quot;;
+			bar.setAttribute(&quot;fillColor&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+			bar.style.antialias = &quot;false&quot;;
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			bar.appendChild(fill);
+			if (applyTo) {
+				applyTo(bar, data[i].src);
+			}
+			group.appendChild(bar);
+		}
+		return group;
+	}, Line:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		if (data.length == 0) {
+			return group;
+		}
+		var path = document.createElement(&quot;v:shape&quot;);
+		path.setAttribute(&quot;strokeweight&quot;, &quot;2px&quot;);
+		path.setAttribute(&quot;strokecolor&quot;, data[0].series.color);
+		path.setAttribute(&quot;fillcolor&quot;, &quot;none&quot;);
+		path.setAttribute(&quot;filled&quot;, &quot;false&quot;);
+		path.setAttribute(&quot;coordsize&quot;, (area.right - area.left) + &quot;,&quot; + (area.bottom - area.top));
+		path.style.position = &quot;absolute&quot;;
+		path.style.top = &quot;0px&quot;;
+		path.style.left = &quot;0px&quot;;
+		path.style.width = area.right - area.left + &quot;px&quot;;
+		path.style.height = area.bottom - area.top + &quot;px&quot;;
+		var stroke = document.createElement(&quot;v:stroke&quot;);
+		stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+		path.appendChild(stroke);
+		var cmd = [];
+		var r = 3;
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = Math.round(plot.axisX.getCoord(data[i].x, plotarea, plot));
+			var y = Math.round(plot.axisY.getCoord(data[i].y, plotarea, plot));
+			if (i == 0) {
+				cmd.push(&quot;m&quot;);
+				cmd.push(x + &quot;,&quot; + y);
+			} else {
+				cmd.push(&quot;l&quot;);
+				cmd.push(x + &quot;,&quot; + y);
+			}
+			var c = document.createElement(&quot;v:oval&quot;);
+			c.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			c.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			c.setAttribute(&quot;fillcolor&quot;, data[i].series.color);
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			c.appendChild(str);
+			str = document.createElement(&quot;v:fill&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			c.appendChild(str);
+			var s = c.style;
+			s.position = &quot;absolute&quot;;
+			s.top = (y - r) + &quot;px&quot;;
+			s.left = (x - r) + &quot;px&quot;;
+			s.width = (r * 2) + &quot;px&quot;;
+			s.height = (r * 2) + &quot;px&quot;;
+			group.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		path.setAttribute(&quot;path&quot;, cmd.join(&quot; &quot;) + &quot; e&quot;);
+		group.appendChild(path);
+		return group;
+	}, CurvedLine:function (data, plotarea, plot, applyTo) {
+		var tension = 3;
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		if (data.length == 0) {
+			return group;
+		}
+		var path = document.createElement(&quot;v:shape&quot;);
+		path.setAttribute(&quot;strokeweight&quot;, &quot;2px&quot;);
+		path.setAttribute(&quot;strokecolor&quot;, data[0].series.color);
+		path.setAttribute(&quot;fillcolor&quot;, &quot;none&quot;);
+		path.setAttribute(&quot;filled&quot;, &quot;false&quot;);
+		path.setAttribute(&quot;coordsize&quot;, (area.right - area.left) + &quot;,&quot; + (area.bottom - area.top));
+		path.style.position = &quot;absolute&quot;;
+		path.style.top = &quot;0px&quot;;
+		path.style.left = &quot;0px&quot;;
+		path.style.width = area.right - area.left + &quot;px&quot;;
+		path.style.height = area.bottom - area.top + &quot;px&quot;;
+		var stroke = document.createElement(&quot;v:stroke&quot;);
+		stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+		path.appendChild(stroke);
+		var cmd = [];
+		var r = 3;
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = Math.round(plot.axisX.getCoord(data[i].x, plotarea, plot));
+			var y = Math.round(plot.axisY.getCoord(data[i].y, plotarea, plot));
+			if (i == 0) {
+				cmd.push(&quot;m&quot;);
+				cmd.push(x + &quot;,&quot; + y);
+			} else {
+				var lastx = Math.round(plot.axisX.getCoord(data[i - 1].x, plotarea, plot));
+				var lasty = Math.round(plot.axisY.getCoord(data[i - 1].y, plotarea, plot));
+				var dx = x - lastx;
+				var dy = y - lasty;
+				cmd.push(&quot;c&quot;);
+				var cx = Math.round((x - (tension - 1) * (dx / tension)));
+				cmd.push(cx + &quot;,&quot; + lasty);
+				cx = Math.round((x - (dx / tension)));
+				cmd.push(cx + &quot;,&quot; + y);
+				cmd.push(x + &quot;,&quot; + y);
+			}
+			var c = document.createElement(&quot;v:oval&quot;);
+			c.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			c.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			c.setAttribute(&quot;fillcolor&quot;, data[i].series.color);
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			c.appendChild(str);
+			str = document.createElement(&quot;v:fill&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			c.appendChild(str);
+			var s = c.style;
+			s.position = &quot;absolute&quot;;
+			s.top = (y - r) + &quot;px&quot;;
+			s.left = (x - r) + &quot;px&quot;;
+			s.width = (r * 2) + &quot;px&quot;;
+			s.height = (r * 2) + &quot;px&quot;;
+			group.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		path.setAttribute(&quot;path&quot;, cmd.join(&quot; &quot;) + &quot; e&quot;);
+		group.appendChild(path);
+		return group;
+	}, Area:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		if (data.length == 0) {
+			return group;
+		}
+		var path = document.createElement(&quot;v:shape&quot;);
+		path.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+		path.setAttribute(&quot;strokecolor&quot;, data[0].series.color);
+		path.setAttribute(&quot;fillcolor&quot;, data[0].series.color);
+		path.setAttribute(&quot;coordsize&quot;, (area.right - area.left) + &quot;,&quot; + (area.bottom - area.top));
+		path.style.position = &quot;absolute&quot;;
+		path.style.top = &quot;0px&quot;;
+		path.style.left = &quot;0px&quot;;
+		path.style.width = area.right - area.left + &quot;px&quot;;
+		path.style.height = area.bottom - area.top + &quot;px&quot;;
+		var stroke = document.createElement(&quot;v:stroke&quot;);
+		stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+		path.appendChild(stroke);
+		var fill = document.createElement(&quot;v:fill&quot;);
+		fill.setAttribute(&quot;opacity&quot;, &quot;0.4&quot;);
+		path.appendChild(fill);
+		var cmd = [];
+		var r = 3;
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = Math.round(plot.axisX.getCoord(data[i].x, plotarea, plot));
+			var y = Math.round(plot.axisY.getCoord(data[i].y, plotarea, plot));
+			if (i == 0) {
+				cmd.push(&quot;m&quot;);
+				cmd.push(x + &quot;,&quot; + y);
+			} else {
+				cmd.push(&quot;l&quot;);
+				cmd.push(x + &quot;,&quot; + y);
+			}
+			var c = document.createElement(&quot;v:oval&quot;);
+			c.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			c.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			c.setAttribute(&quot;fillcolor&quot;, data[i].series.color);
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			c.appendChild(str);
+			str = document.createElement(&quot;v:fill&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			c.appendChild(str);
+			var s = c.style;
+			s.position = &quot;absolute&quot;;
+			s.top = (y - r) + &quot;px&quot;;
+			s.left = (x - r) + &quot;px&quot;;
+			s.width = (r * 2) + &quot;px&quot;;
+			s.height = (r * 2) + &quot;px&quot;;
+			group.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		cmd.push(&quot;l&quot;);
+		cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+		cmd.push(&quot;l&quot;);
+		cmd.push(Math.round(plot.axisX.getCoord(data[0].x, plotarea, plot)) + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+		path.setAttribute(&quot;path&quot;, cmd.join(&quot; &quot;) + &quot; x e&quot;);
+		group.appendChild(path);
+		return group;
+	}, CurvedArea:function (data, plotarea, plot, applyTo) {
+		var tension = 3;
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		if (data.length == 0) {
+			return group;
+		}
+		var path = document.createElement(&quot;v:shape&quot;);
+		path.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+		path.setAttribute(&quot;strokecolor&quot;, data[0].series.color);
+		path.setAttribute(&quot;fillcolor&quot;, data[0].series.color);
+		path.setAttribute(&quot;coordsize&quot;, (area.right - area.left) + &quot;,&quot; + (area.bottom - area.top));
+		path.style.position = &quot;absolute&quot;;
+		path.style.top = &quot;0px&quot;;
+		path.style.left = &quot;0px&quot;;
+		path.style.width = area.right - area.left + &quot;px&quot;;
+		path.style.height = area.bottom - area.top + &quot;px&quot;;
+		var stroke = document.createElement(&quot;v:stroke&quot;);
+		stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+		path.appendChild(stroke);
+		var fill = document.createElement(&quot;v:fill&quot;);
+		fill.setAttribute(&quot;opacity&quot;, &quot;0.4&quot;);
+		path.appendChild(fill);
+		var cmd = [];
+		var r = 3;
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = Math.round(plot.axisX.getCoord(data[i].x, plotarea, plot));
+			var y = Math.round(plot.axisY.getCoord(data[i].y, plotarea, plot));
+			if (i == 0) {
+				cmd.push(&quot;m&quot;);
+				cmd.push(x + &quot;,&quot; + y);
+			} else {
+				var lastx = Math.round(plot.axisX.getCoord(data[i - 1].x, plotarea, plot));
+				var lasty = Math.round(plot.axisY.getCoord(data[i - 1].y, plotarea, plot));
+				var dx = x - lastx;
+				var dy = y - lasty;
+				cmd.push(&quot;c&quot;);
+				var cx = Math.round((x - (tension - 1) * (dx / tension)));
+				cmd.push(cx + &quot;,&quot; + lasty);
+				cx = Math.round((x - (dx / tension)));
+				cmd.push(cx + &quot;,&quot; + y);
+				cmd.push(x + &quot;,&quot; + y);
+			}
+			var c = document.createElement(&quot;v:oval&quot;);
+			c.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			c.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			c.setAttribute(&quot;fillcolor&quot;, data[i].series.color);
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			c.appendChild(str);
+			str = document.createElement(&quot;v:fill&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			c.appendChild(str);
+			var s = c.style;
+			s.position = &quot;absolute&quot;;
+			s.top = (y - r) + &quot;px&quot;;
+			s.left = (x - r) + &quot;px&quot;;
+			s.width = (r * 2) + &quot;px&quot;;
+			s.height = (r * 2) + &quot;px&quot;;
+			group.appendChild(c);
+			if (applyTo) {
+				applyTo(c, data[i].src);
+			}
+		}
+		cmd.push(&quot;l&quot;);
+		cmd.push(x + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+		cmd.push(&quot;l&quot;);
+		cmd.push(Math.round(plot.axisX.getCoord(data[0].x, plotarea, plot)) + &quot;,&quot; + Math.round(plot.axisY.getCoord(plot.axisX.origin, plotarea, plot)));
+		path.setAttribute(&quot;path&quot;, cmd.join(&quot; &quot;) + &quot; x e&quot;);
+		group.appendChild(path);
+		return group;
+	}, HighLow:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = data.length;
+		var part = ((area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower)) / 4;
+		var w = part * 2;
+		for (var i = 0; i &lt; n; i++) {
+			var high = data[i].high;
+			var low = data[i].low;
+			if (low &gt; high) {
+				var t = low;
+				low = high;
+				high = t;
+			}
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(high, plotarea, plot);
+			var h = plot.axisY.getCoord(low, plotarea, plot) - y;
+			var bar = document.createElement(&quot;v:rect&quot;);
+			bar.style.position = &quot;absolute&quot;;
+			bar.style.top = y + 1 + &quot;px&quot;;
+			bar.style.left = x + &quot;px&quot;;
+			bar.style.width = w + &quot;px&quot;;
+			bar.style.height = h + &quot;px&quot;;
+			bar.setAttribute(&quot;fillColor&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+			bar.style.antialias = &quot;false&quot;;
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			bar.appendChild(fill);
+			if (applyTo) {
+				applyTo(bar, data[i].src);
+			}
+			group.appendChild(bar);
+		}
+		return group;
+	}, HighLowClose:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = data.length;
+		var part = ((area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower)) / 4;
+		var w = part * 2;
+		for (var i = 0; i &lt; n; i++) {
+			var high = data[i].high;
+			var low = data[i].low;
+			if (low &gt; high) {
+				var t = low;
+				low = high;
+				high = t;
+			}
+			var c = data[i].close;
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(high, plotarea, plot);
+			var h = plot.axisY.getCoord(low, plotarea, plot) - y;
+			var close = plot.axisY.getCoord(c, plotarea, plot);
+			var g = document.createElement(&quot;div&quot;);
+			var bar = document.createElement(&quot;v:rect&quot;);
+			bar.style.position = &quot;absolute&quot;;
+			bar.style.top = y + 1 + &quot;px&quot;;
+			bar.style.left = x + &quot;px&quot;;
+			bar.style.width = w + &quot;px&quot;;
+			bar.style.height = h + &quot;px&quot;;
+			bar.setAttribute(&quot;fillColor&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+			bar.style.antialias = &quot;false&quot;;
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			bar.appendChild(fill);
+			g.appendChild(bar);
+			var line = document.createElement(&quot;v:line&quot;);
+			line.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			line.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			line.setAttribute(&quot;from&quot;, x + &quot;px,&quot; + close + &quot;px&quot;);
+			line.setAttribute(&quot;to&quot;, (x + w + (part * 2) - 2) + &quot;px,&quot; + close + &quot;px&quot;);
+			var s = line.style;
+			s.position = &quot;absolute&quot;;
+			s.top = &quot;0px&quot;;
+			s.left = &quot;0px&quot;;
+			s.antialias = &quot;false&quot;;
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			line.appendChild(str);
+			g.appendChild(line);
+			if (applyTo) {
+				applyTo(g, data[i].src);
+			}
+			group.appendChild(g);
+		}
+		return group;
+	}, HighLowOpenClose:function (data, plotarea, plot, applyTo) {
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		var n = data.length;
+		var part = ((area.right - area.left) / (plot.axisX.range.upper - plot.axisX.range.lower)) / 4;
+		var w = part * 2;
+		for (var i = 0; i &lt; n; i++) {
+			var high = data[i].high;
+			var low = data[i].low;
+			if (low &gt; high) {
+				var t = low;
+				low = high;
+				high = t;
+			}
+			var o = data[i].open;
+			var c = data[i].close;
+			var x = plot.axisX.getCoord(data[i].x, plotarea, plot) - (w / 2);
+			var y = plot.axisY.getCoord(high, plotarea, plot);
+			var h = plot.axisY.getCoord(low, plotarea, plot) - y;
+			var open = plot.axisY.getCoord(o, plotarea, plot);
+			var close = plot.axisY.getCoord(c, plotarea, plot);
+			var g = document.createElement(&quot;div&quot;);
+			var bar = document.createElement(&quot;v:rect&quot;);
+			bar.style.position = &quot;absolute&quot;;
+			bar.style.top = y + 1 + &quot;px&quot;;
+			bar.style.left = x + &quot;px&quot;;
+			bar.style.width = w + &quot;px&quot;;
+			bar.style.height = h + &quot;px&quot;;
+			bar.setAttribute(&quot;fillColor&quot;, data[i].series.color);
+			bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+			bar.style.antialias = &quot;false&quot;;
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			bar.appendChild(fill);
+			g.appendChild(bar);
+			var line = document.createElement(&quot;v:line&quot;);
+			line.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			line.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			line.setAttribute(&quot;from&quot;, (x - (part * 2)) + &quot;px,&quot; + open + &quot;px&quot;);
+			line.setAttribute(&quot;to&quot;, (x + w - 2) + &quot;px,&quot; + open + &quot;px&quot;);
+			var s = line.style;
+			s.position = &quot;absolute&quot;;
+			s.top = &quot;0px&quot;;
+			s.left = &quot;0px&quot;;
+			s.antialias = &quot;false&quot;;
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			line.appendChild(str);
+			g.appendChild(line);
+			var line = document.createElement(&quot;v:line&quot;);
+			line.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			line.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+			line.setAttribute(&quot;from&quot;, x + &quot;px,&quot; + close + &quot;px&quot;);
+			line.setAttribute(&quot;to&quot;, (x + w + (part * 2) - 2) + &quot;px,&quot; + close + &quot;px&quot;);
+			var s = line.style;
+			s.position = &quot;absolute&quot;;
+			s.top = &quot;0px&quot;;
+			s.left = &quot;0px&quot;;
+			s.antialias = &quot;false&quot;;
+			var str = document.createElement(&quot;v:stroke&quot;);
+			str.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			line.appendChild(str);
+			g.appendChild(line);
+			if (applyTo) {
+				applyTo(g, data[i].src);
+			}
+			group.appendChild(g);
+		}
+		return group;
+	}, Scatter:function (data, plotarea, plot, applyTo) {
+		var r = 6;
+		var mod = r / 2;
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = Math.round(plot.axisX.getCoord(data[i].x, plotarea, plot));
+			var y = Math.round(plot.axisY.getCoord(data[i].y, plotarea, plot));
+			var point = document.createElement(&quot;v:rect&quot;);
+			point.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			point.setAttribute(&quot;fillcolor&quot;, data[i].series.color);
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			point.appendChild(fill);
+			var s = point.style;
+			s.position = &quot;absolute&quot;;
+			s.rotation = &quot;45&quot;;
+			s.top = (y - mod) + &quot;px&quot;;
+			s.left = (x - mod) + &quot;px&quot;;
+			s.width = r + &quot;px&quot;;
+			s.height = r + &quot;px&quot;;
+			group.appendChild(point);
+			if (applyTo) {
+				applyTo(point, data[i].src);
+			}
+		}
+		return group;
+	}, Bubble:function (data, plotarea, plot, applyTo) {
+		var sizeFactor = 1;
+		var area = plotarea.getArea();
+		var group = dojo.charting.Plotters._group(plotarea);
+		for (var i = 0; i &lt; data.length; i++) {
+			var x = Math.round(plot.axisX.getCoord(data[i].x, plotarea, plot));
+			var y = Math.round(plot.axisY.getCoord(data[i].y, plotarea, plot));
+			if (i == 0) {
+				var raw = data[i].size;
+				var dy = plot.axisY.getCoord(data[i].y + raw, plotarea, plot) - y;
+				sizeFactor = dy / raw;
+			}
+			if (sizeFactor &lt; 1) {
+				sizeFactor = 1;
+			}
+			var r = (data[i].size / 2) * sizeFactor;
+			var point = document.createElement(&quot;v:oval&quot;);
+			point.setAttribute(&quot;strokecolor&quot;, data[i].series.color);
+			point.setAttribute(&quot;fillcolor&quot;, data[i].series.color);
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			point.appendChild(fill);
+			var s = point.style;
+			s.position = &quot;absolute&quot;;
+			s.rotation = &quot;45&quot;;
+			s.top = (y - r) + &quot;px&quot;;
+			s.left = (x - r) + &quot;px&quot;;
+			s.width = (r * 2) + &quot;px&quot;;
+			s.height = (r * 2) + &quot;px&quot;;
+			group.appendChild(point);
+			if (applyTo) {
+				applyTo(point, data[i].src);
+			}
+		}
+		return group;
+	}});
+	dojo.charting.Plotters[&quot;Default&quot;] = dojo.charting.Plotters.Line;
+}
+

Added: tags/parley-0.55/root/static/magic/src/collections/ArrayList.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/ArrayList.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/ArrayList.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,114 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.ArrayList&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.collections.ArrayList = function (arr) {
+	var items = [];
+	if (arr) {
+		items = items.concat(arr);
+	}
+	this.count = items.length;
+	this.add = function (obj) {
+		items.push(obj);
+		this.count = items.length;
+	};
+	this.addRange = function (a) {
+		if (a.getIterator) {
+			var e = a.getIterator();
+			while (!e.atEnd()) {
+				this.add(e.get());
+			}
+			this.count = items.length;
+		} else {
+			for (var i = 0; i &lt; a.length; i++) {
+				items.push(a[i]);
+			}
+			this.count = items.length;
+		}
+	};
+	this.clear = function () {
+		items.splice(0, items.length);
+		this.count = 0;
+	};
+	this.clone = function () {
+		return new dojo.collections.ArrayList(items);
+	};
+	this.contains = function (obj) {
+		for (var i = 0; i &lt; items.length; i++) {
+			if (items[i] == obj) {
+				return true;
+			}
+		}
+		return false;
+	};
+	this.forEach = function (fn, scope) {
+		var s = scope || dj_global;
+		if (Array.forEach) {
+			Array.forEach(items, fn, s);
+		} else {
+			for (var i = 0; i &lt; items.length; i++) {
+				fn.call(s, items[i], i, items);
+			}
+		}
+	};
+	this.getIterator = function () {
+		return new dojo.collections.Iterator(items);
+	};
+	this.indexOf = function (obj) {
+		for (var i = 0; i &lt; items.length; i++) {
+			if (items[i] == obj) {
+				return i;
+			}
+		}
+		return -1;
+	};
+	this.insert = function (i, obj) {
+		items.splice(i, 0, obj);
+		this.count = items.length;
+	};
+	this.item = function (i) {
+		return items[i];
+	};
+	this.remove = function (obj) {
+		var i = this.indexOf(obj);
+		if (i &gt;= 0) {
+			items.splice(i, 1);
+		}
+		this.count = items.length;
+	};
+	this.removeAt = function (i) {
+		items.splice(i, 1);
+		this.count = items.length;
+	};
+	this.reverse = function () {
+		items.reverse();
+	};
+	this.sort = function (fn) {
+		if (fn) {
+			items.sort(fn);
+		} else {
+			items.sort();
+		}
+	};
+	this.setByIndex = function (i, obj) {
+		items[i] = obj;
+		this.count = items.length;
+	};
+	this.toArray = function () {
+		return [].concat(items);
+	};
+	this.toString = function (delim) {
+		return items.join((delim || &quot;,&quot;));
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/BinaryTree.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/BinaryTree.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/BinaryTree.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,257 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.BinaryTree&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.collections.BinaryTree&quot;);
+dojo.collections.BinaryTree = function (data) {
+	function node(data, rnode, lnode) {
+		this.value = data || null;
+		this.right = rnode || null;
+		this.left = lnode || null;
+		this.clone = function () {
+			var c = new node();
+			if (this.value.value) {
+				c.value = this.value.clone();
+			} else {
+				c.value = this.value;
+			}
+			if (this.left) {
+				c.left = this.left.clone();
+			}
+			if (this.right) {
+				c.right = this.right.clone();
+			}
+		};
+		this.compare = function (n) {
+			if (this.value &gt; n.value) {
+				return 1;
+			}
+			if (this.value &lt; n.value) {
+				return -1;
+			}
+			return 0;
+		};
+		this.compareData = function (d) {
+			if (this.value &gt; d) {
+				return 1;
+			}
+			if (this.value &lt; d) {
+				return -1;
+			}
+			return 0;
+		};
+	}
+	function inorderTraversalBuildup(current, a) {
+		if (current) {
+			inorderTraversalBuildup(current.left, a);
+			a.add(current);
+			inorderTraversalBuildup(current.right, a);
+		}
+	}
+	function preorderTraversal(current, sep) {
+		var s = &quot;&quot;;
+		if (current) {
+			s = current.value.toString() + sep;
+			s += preorderTraversal(current.left, sep);
+			s += preorderTraversal(current.right, sep);
+		}
+		return s;
+	}
+	function inorderTraversal(current, sep) {
+		var s = &quot;&quot;;
+		if (current) {
+			s = inorderTraversal(current.left, sep);
+			s += current.value.toString() + sep;
+			s += inorderTraversal(current.right, sep);
+		}
+		return s;
+	}
+	function postorderTraversal(current, sep) {
+		var s = &quot;&quot;;
+		if (current) {
+			s = postorderTraversal(current.left, sep);
+			s += postorderTraversal(current.right, sep);
+			s += current.value.toString() + sep;
+		}
+		return s;
+	}
+	function searchHelper(current, data) {
+		if (!current) {
+			return null;
+		}
+		var i = current.compareData(data);
+		if (i == 0) {
+			return current;
+		}
+		if (i &gt; 0) {
+			return searchHelper(current.left, data);
+		} else {
+			return searchHelper(current.right, data);
+		}
+	}
+	this.add = function (data) {
+		var n = new node(data);
+		var i;
+		var current = root;
+		var parent = null;
+		while (current) {
+			i = current.compare(n);
+			if (i == 0) {
+				return;
+			}
+			parent = current;
+			if (i &gt; 0) {
+				current = current.left;
+			} else {
+				current = current.right;
+			}
+		}
+		this.count++;
+		if (!parent) {
+			root = n;
+		} else {
+			i = parent.compare(n);
+			if (i &gt; 0) {
+				parent.left = n;
+			} else {
+				parent.right = n;
+			}
+		}
+	};
+	this.clear = function () {
+		root = null;
+		this.count = 0;
+	};
+	this.clone = function () {
+		var c = new dojo.collections.BinaryTree();
+		c.root = root.clone();
+		c.count = this.count;
+		return c;
+	};
+	this.contains = function (data) {
+		return this.search(data) != null;
+	};
+	this.deleteData = function (data) {
+		var current = root;
+		var parent = null;
+		var i = current.compareData(data);
+		while (i != 0 &amp;&amp; current != null) {
+			if (i &gt; 0) {
+				parent = current;
+				current = current.left;
+			} else {
+				if (i &lt; 0) {
+					parent = current;
+					current = current.right;
+				}
+			}
+			i = current.compareData(data);
+		}
+		if (!current) {
+			return;
+		}
+		this.count--;
+		if (!current.right) {
+			if (!parent) {
+				root = current.left;
+			} else {
+				i = parent.compare(current);
+				if (i &gt; 0) {
+					parent.left = current.left;
+				} else {
+					if (i &lt; 0) {
+						parent.right = current.left;
+					}
+				}
+			}
+		} else {
+			if (!current.right.left) {
+				if (!parent) {
+					root = current.right;
+				} else {
+					i = parent.compare(current);
+					if (i &gt; 0) {
+						parent.left = current.right;
+					} else {
+						if (i &lt; 0) {
+							parent.right = current.right;
+						}
+					}
+				}
+			} else {
+				var leftmost = current.right.left;
+				var lmParent = current.right;
+				while (leftmost.left != null) {
+					lmParent = leftmost;
+					leftmost = leftmost.left;
+				}
+				lmParent.left = leftmost.right;
+				leftmost.left = current.left;
+				leftmost.right = current.right;
+				if (!parent) {
+					root = leftmost;
+				} else {
+					i = parent.compare(current);
+					if (i &gt; 0) {
+						parent.left = leftmost;
+					} else {
+						if (i &lt; 0) {
+							parent.right = leftmost;
+						}
+					}
+				}
+			}
+		}
+	};
+	this.getIterator = function () {
+		var a = [];
+		inorderTraversalBuildup(root, a);
+		return new dojo.collections.Iterator(a);
+	};
+	this.search = function (data) {
+		return searchHelper(root, data);
+	};
+	this.toString = function (order, sep) {
+		if (!order) {
+			var order = dojo.collections.BinaryTree.TraversalMethods.Inorder;
+		}
+		if (!sep) {
+			var sep = &quot; &quot;;
+		}
+		var s = &quot;&quot;;
+		switch (order) {
+		  case dojo.collections.BinaryTree.TraversalMethods.Preorder:
+			s = preorderTraversal(root, sep);
+			break;
+		  case dojo.collections.BinaryTree.TraversalMethods.Inorder:
+			s = inorderTraversal(root, sep);
+			break;
+		  case dojo.collections.BinaryTree.TraversalMethods.Postorder:
+			s = postorderTraversal(root, sep);
+			break;
+		}
+		if (s.length == 0) {
+			return &quot;&quot;;
+		} else {
+			return s.substring(0, s.length - sep.length);
+		}
+	};
+	this.count = 0;
+	var root = this.root = null;
+	if (data) {
+		this.add(data);
+	}
+};
+dojo.collections.BinaryTree.TraversalMethods = {Preorder:1, Inorder:2, Postorder:3};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Collections.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Collections.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Collections.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,92 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Collections&quot;);
+dojo.collections.DictionaryEntry = function (k, v) {
+	this.key = k;
+	this.value = v;
+	this.valueOf = function () {
+		return this.value;
+	};
+	this.toString = function () {
+		return String(this.value);
+	};
+};
+dojo.collections.Iterator = function (arr) {
+	var a = arr;
+	var position = 0;
+	this.element = a[position] || null;
+	this.atEnd = function () {
+		return (position &gt;= a.length);
+	};
+	this.get = function () {
+		if (this.atEnd()) {
+			return null;
+		}
+		this.element = a[position++];
+		return this.element;
+	};
+	this.map = function (fn, scope) {
+		var s = scope || dj_global;
+		if (Array.map) {
+			return Array.map(a, fn, s);
+		} else {
+			var arr = [];
+			for (var i = 0; i &lt; a.length; i++) {
+				arr.push(fn.call(s, a[i]));
+			}
+			return arr;
+		}
+	};
+	this.reset = function () {
+		position = 0;
+		this.element = a[position];
+	};
+};
+dojo.collections.DictionaryIterator = function (obj) {
+	var a = [];
+	var testObject = {};
+	for (var p in obj) {
+		if (!testObject[p]) {
+			a.push(obj[p]);
+		}
+	}
+	var position = 0;
+	this.element = a[position] || null;
+	this.atEnd = function () {
+		return (position &gt;= a.length);
+	};
+	this.get = function () {
+		if (this.atEnd()) {
+			return null;
+		}
+		this.element = a[position++];
+		return this.element;
+	};
+	this.map = function (fn, scope) {
+		var s = scope || dj_global;
+		if (Array.map) {
+			return Array.map(a, fn, s);
+		} else {
+			var arr = [];
+			for (var i = 0; i &lt; a.length; i++) {
+				arr.push(fn.call(s, a[i]));
+			}
+			return arr;
+		}
+	};
+	this.reset = function () {
+		position = 0;
+		this.element = a[position];
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Dictionary.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Dictionary.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Dictionary.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,101 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Dictionary&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.collections.Dictionary = function (dictionary) {
+	var items = {};
+	this.count = 0;
+	var testObject = {};
+	this.add = function (k, v) {
+		var b = (k in items);
+		items[k] = new dojo.collections.DictionaryEntry(k, v);
+		if (!b) {
+			this.count++;
+		}
+	};
+	this.clear = function () {
+		items = {};
+		this.count = 0;
+	};
+	this.clone = function () {
+		return new dojo.collections.Dictionary(this);
+	};
+	this.contains = this.containsKey = function (k) {
+		if (testObject[k]) {
+			return false;
+		}
+		return (items[k] != null);
+	};
+	this.containsValue = function (v) {
+		var e = this.getIterator();
+		while (e.get()) {
+			if (e.element.value == v) {
+				return true;
+			}
+		}
+		return false;
+	};
+	this.entry = function (k) {
+		return items[k];
+	};
+	this.forEach = function (fn, scope) {
+		var a = [];
+		for (var p in items) {
+			if (!testObject[p]) {
+				a.push(items[p]);
+			}
+		}
+		var s = scope || dj_global;
+		if (Array.forEach) {
+			Array.forEach(a, fn, s);
+		} else {
+			for (var i = 0; i &lt; a.length; i++) {
+				fn.call(s, a[i], i, a);
+			}
+		}
+	};
+	this.getKeyList = function () {
+		return (this.getIterator()).map(function (entry) {
+			return entry.key;
+		});
+	};
+	this.getValueList = function () {
+		return (this.getIterator()).map(function (entry) {
+			return entry.value;
+		});
+	};
+	this.item = function (k) {
+		if (k in items) {
+			return items[k].valueOf();
+		}
+		return undefined;
+	};
+	this.getIterator = function () {
+		return new dojo.collections.DictionaryIterator(items);
+	};
+	this.remove = function (k) {
+		if (k in items &amp;&amp; !testObject[k]) {
+			delete items[k];
+			this.count--;
+			return true;
+		}
+		return false;
+	};
+	if (dictionary) {
+		var e = dictionary.getIterator();
+		while (e.get()) {
+			this.add(e.element.key, e.element.value);
+		}
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Graph.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Graph.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Graph.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,151 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Graph&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.experimental(&quot;dojo.collections.Graph&quot;);
+dojo.collections.Graph = function (nodes) {
+	function node(key, data, neighbors) {
+		this.key = key;
+		this.data = data;
+		this.neighbors = neighbors || new adjacencyList();
+		this.addDirected = function () {
+			if (arguments[0].constructor == edgeToNeighbor) {
+				this.neighbors.add(arguments[0]);
+			} else {
+				var n = arguments[0];
+				var cost = arguments[1] || 0;
+				this.neighbors.add(new edgeToNeighbor(n, cost));
+			}
+		};
+	}
+	function nodeList() {
+		var d = new dojo.collections.Dictionary();
+		function nodelistiterator() {
+			var o = [];
+			var e = d.getIterator();
+			while (e.get()) {
+				o[o.length] = e.element;
+			}
+			var position = 0;
+			this.element = o[position] || null;
+			this.atEnd = function () {
+				return (position &gt;= o.length);
+			};
+			this.get = function () {
+				if (this.atEnd()) {
+					return null;
+				}
+				this.element = o[position++];
+				return this.element;
+			};
+			this.map = function (fn, scope) {
+				var s = scope || dj_global;
+				if (Array.map) {
+					return Array.map(o, fn, s);
+				} else {
+					var arr = [];
+					for (var i = 0; i &lt; o.length; i++) {
+						arr.push(fn.call(s, o[i]));
+					}
+					return arr;
+				}
+			};
+			this.reset = function () {
+				position = 0;
+				this.element = o[position];
+			};
+		}
+		this.add = function (node) {
+			d.add(node.key, node);
+		};
+		this.clear = function () {
+			d.clear();
+		};
+		this.containsKey = function (key) {
+			return d.containsKey(key);
+		};
+		this.getIterator = function () {
+			return new nodelistiterator(this);
+		};
+		this.item = function (key) {
+			return d.item(key);
+		};
+		this.remove = function (node) {
+			d.remove(node.key);
+		};
+	}
+	function edgeToNeighbor(node, cost) {
+		this.neighbor = node;
+		this.cost = cost;
+	}
+	function adjacencyList() {
+		var d = [];
+		this.add = function (o) {
+			d.push(o);
+		};
+		this.item = function (i) {
+			return d[i];
+		};
+		this.getIterator = function () {
+			return new dojo.collections.Iterator([].concat(d));
+		};
+	}
+	this.nodes = nodes || new nodeList();
+	this.count = this.nodes.count;
+	this.clear = function () {
+		this.nodes.clear();
+		this.count = 0;
+	};
+	this.addNode = function () {
+		var n = arguments[0];
+		if (arguments.length &gt; 1) {
+			n = new node(arguments[0], arguments[1]);
+		}
+		if (!this.nodes.containsKey(n.key)) {
+			this.nodes.add(n);
+			this.count++;
+		}
+	};
+	this.addDirectedEdge = function (uKey, vKey, cost) {
+		var uNode, vNode;
+		if (uKey.constructor != node) {
+			uNode = this.nodes.item(uKey);
+			vNode = this.nodes.item(vKey);
+		} else {
+			uNode = uKey;
+			vNode = vKey;
+		}
+		var c = cost || 0;
+		uNode.addDirected(vNode, c);
+	};
+	this.addUndirectedEdge = function (uKey, vKey, cost) {
+		var uNode, vNode;
+		if (uKey.constructor != node) {
+			uNode = this.nodes.item(uKey);
+			vNode = this.nodes.item(vKey);
+		} else {
+			uNode = uKey;
+			vNode = vKey;
+		}
+		var c = cost || 0;
+		uNode.addDirected(vNode, c);
+		vNode.addDirected(uNode, c);
+	};
+	this.contains = function (n) {
+		return this.nodes.containsKey(n.key);
+	};
+	this.containsKey = function (k) {
+		return this.nodes.containsKey(k);
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Queue.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Queue.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Queue.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,67 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Queue&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.collections.Queue = function (arr) {
+	var q = [];
+	if (arr) {
+		q = q.concat(arr);
+	}
+	this.count = q.length;
+	this.clear = function () {
+		q = [];
+		this.count = q.length;
+	};
+	this.clone = function () {
+		return new dojo.collections.Queue(q);
+	};
+	this.contains = function (o) {
+		for (var i = 0; i &lt; q.length; i++) {
+			if (q[i] == o) {
+				return true;
+			}
+		}
+		return false;
+	};
+	this.copyTo = function (arr, i) {
+		arr.splice(i, 0, q);
+	};
+	this.dequeue = function () {
+		var r = q.shift();
+		this.count = q.length;
+		return r;
+	};
+	this.enqueue = function (o) {
+		this.count = q.push(o);
+	};
+	this.forEach = function (fn, scope) {
+		var s = scope || dj_global;
+		if (Array.forEach) {
+			Array.forEach(q, fn, s);
+		} else {
+			for (var i = 0; i &lt; q.length; i++) {
+				fn.call(s, q[i], i, q);
+			}
+		}
+	};
+	this.getIterator = function () {
+		return new dojo.collections.Iterator(q);
+	};
+	this.peek = function () {
+		return q[0];
+	};
+	this.toArray = function () {
+		return [].concat(q);
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Set.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Set.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Set.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,114 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Set&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.require(&quot;dojo.collections.ArrayList&quot;);
+dojo.collections.Set = new function () {
+	this.union = function (setA, setB) {
+		if (setA.constructor == Array) {
+			var setA = new dojo.collections.ArrayList(setA);
+		}
+		if (setB.constructor == Array) {
+			var setB = new dojo.collections.ArrayList(setB);
+		}
+		if (!setA.toArray || !setB.toArray) {
+			dojo.raise(&quot;Set operations can only be performed on array-based collections.&quot;);
+		}
+		var result = new dojo.collections.ArrayList(setA.toArray());
+		var e = setB.getIterator();
+		while (!e.atEnd()) {
+			var item = e.get();
+			if (!result.contains(item)) {
+				result.add(item);
+			}
+		}
+		return result;
+	};
+	this.intersection = function (setA, setB) {
+		if (setA.constructor == Array) {
+			var setA = new dojo.collections.ArrayList(setA);
+		}
+		if (setB.constructor == Array) {
+			var setB = new dojo.collections.ArrayList(setB);
+		}
+		if (!setA.toArray || !setB.toArray) {
+			dojo.raise(&quot;Set operations can only be performed on array-based collections.&quot;);
+		}
+		var result = new dojo.collections.ArrayList();
+		var e = setB.getIterator();
+		while (!e.atEnd()) {
+			var item = e.get();
+			if (setA.contains(item)) {
+				result.add(item);
+			}
+		}
+		return result;
+	};
+	this.difference = function (setA, setB) {
+		if (setA.constructor == Array) {
+			var setA = new dojo.collections.ArrayList(setA);
+		}
+		if (setB.constructor == Array) {
+			var setB = new dojo.collections.ArrayList(setB);
+		}
+		if (!setA.toArray || !setB.toArray) {
+			dojo.raise(&quot;Set operations can only be performed on array-based collections.&quot;);
+		}
+		var result = new dojo.collections.ArrayList();
+		var e = setA.getIterator();
+		while (!e.atEnd()) {
+			var item = e.get();
+			if (!setB.contains(item)) {
+				result.add(item);
+			}
+		}
+		return result;
+	};
+	this.isSubSet = function (setA, setB) {
+		if (setA.constructor == Array) {
+			var setA = new dojo.collections.ArrayList(setA);
+		}
+		if (setB.constructor == Array) {
+			var setB = new dojo.collections.ArrayList(setB);
+		}
+		if (!setA.toArray || !setB.toArray) {
+			dojo.raise(&quot;Set operations can only be performed on array-based collections.&quot;);
+		}
+		var e = setA.getIterator();
+		while (!e.atEnd()) {
+			if (!setB.contains(e.get())) {
+				return false;
+			}
+		}
+		return true;
+	};
+	this.isSuperSet = function (setA, setB) {
+		if (setA.constructor == Array) {
+			var setA = new dojo.collections.ArrayList(setA);
+		}
+		if (setB.constructor == Array) {
+			var setB = new dojo.collections.ArrayList(setB);
+		}
+		if (!setA.toArray || !setB.toArray) {
+			dojo.raise(&quot;Set operations can only be performed on array-based collections.&quot;);
+		}
+		var e = setB.getIterator();
+		while (!e.atEnd()) {
+			if (!setA.contains(e.get())) {
+				return false;
+			}
+		}
+		return true;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/collections/SkipList.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/SkipList.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/SkipList.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,169 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.SkipList&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.collections.SkipList&quot;);
+dojo.collections.SkipList = function () {
+	function node(height, val) {
+		this.value = val;
+		this.height = height;
+		this.nodes = new nodeList(height);
+		this.compare = function (val) {
+			if (this.value &gt; val) {
+				return 1;
+			}
+			if (this.value &lt; val) {
+				return -1;
+			}
+			return 0;
+		};
+		this.incrementHeight = function () {
+			this.nodes.incrementHeight();
+			this.height++;
+		};
+		this.decrementHeight = function () {
+			this.nodes.decrementHeight();
+			this.height--;
+		};
+	}
+	function nodeList(height) {
+		var arr = [];
+		this.height = height;
+		for (var i = 0; i &lt; height; i++) {
+			arr[i] = null;
+		}
+		this.item = function (i) {
+			return arr[i];
+		};
+		this.incrementHeight = function () {
+			this.height++;
+			arr[this.height] = null;
+		};
+		this.decrementHeight = function () {
+			arr.splice(arr.length - 1, 1);
+			this.height--;
+		};
+	}
+	function iterator(list) {
+		this.element = list.head;
+		this.atEnd = function () {
+			return (this.element == null);
+		};
+		this.get = function () {
+			if (this.atEnd()) {
+				return null;
+			}
+			this.element = this.element.nodes[0];
+			return this.element;
+		};
+		this.reset = function () {
+			this.element = list.head;
+		};
+	}
+	function chooseRandomHeight(max) {
+		var level = 1;
+		while (Math.random() &lt; PROB &amp;&amp; level &lt; max) {
+			level++;
+		}
+		return level;
+	}
+	var PROB = 0.5;
+	var comparisons = 0;
+	this.head = new node(1);
+	this.count = 0;
+	this.add = function (val) {
+		var updates = [];
+		var current = this.head;
+		for (var i = this.head.height; i &gt;= 0; i--) {
+			if (!(current.nodes[i] != null &amp;&amp; current.nodes[i].compare(val) &lt; 0)) {
+				comparisons++;
+			}
+			while (current.nodes[i] != null &amp;&amp; current.nodes[i].compare(val) &lt; 0) {
+				current = current.nodes[i];
+				comparisons++;
+			}
+			updates[i] = current;
+		}
+		if (current.nodes[0] != null &amp;&amp; current.nodes[0].compare(val) == 0) {
+			return;
+		}
+		var n = new node(val, chooseRandomHeight(this.head.height + 1));
+		this.count++;
+		if (n.height &gt; this.head.height) {
+			this.head.incrementHeight();
+			this.head.nodes[this.head.height - 1] = n;
+		}
+		for (i = 0; i &lt; n.height; i++) {
+			if (i &lt; updates.length) {
+				n.nodes[i] = updates[i].nodes[i];
+				updates[i].nodes[i] = n;
+			}
+		}
+	};
+	this.contains = function (val) {
+		var current = this.head;
+		var i;
+		for (i = this.head.height - 1; i &gt;= 0; i--) {
+			while (current.item(i) != null) {
+				comparisons++;
+				var result = current.nodes[i].compare(val);
+				if (result == 0) {
+					return true;
+				} else {
+					if (result &lt; 0) {
+						current = current.nodes[i];
+					} else {
+						break;
+					}
+				}
+			}
+		}
+		return false;
+	};
+	this.getIterator = function () {
+		return new iterator(this);
+	};
+	this.remove = function (val) {
+		var updates = [];
+		var current = this.head;
+		for (var i = this.head.height - 1; i &gt;= 0; i--) {
+			if (!(current.nodes[i] != null &amp;&amp; current.nodes[i].compare(val) &lt; 0)) {
+				comparisons++;
+			}
+			while (current.nodes[i] != null &amp;&amp; current.nodes[i].compare(val) &lt; 0) {
+				current = current.nodes[i];
+				comparisons++;
+			}
+			updates[i] = current;
+		}
+		current = current.nodes[0];
+		if (current != null &amp;&amp; current.compare(val) == 0) {
+			this.count--;
+			for (var i = 0; i &lt; this.head.height; i++) {
+				if (updates[i].nodes[i] != current) {
+					break;
+				} else {
+					updates[i].nodes[i] = current.nodes[i];
+				}
+			}
+			if (this.head.nodes[this.head.height - 1] == null) {
+				this.head.decrementHeight();
+			}
+		}
+	};
+	this.resetComparisons = function () {
+		comparisons = 0;
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/SortedList.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/SortedList.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/SortedList.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,171 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.SortedList&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.collections.SortedList = function (dictionary) {
+	var _this = this;
+	var items = {};
+	var q = [];
+	var sorter = function (a, b) {
+		if (a.key &gt; b.key) {
+			return 1;
+		}
+		if (a.key &lt; b.key) {
+			return -1;
+		}
+		return 0;
+	};
+	var build = function () {
+		q = [];
+		var e = _this.getIterator();
+		while (!e.atEnd()) {
+			q.push(e.get());
+		}
+		q.sort(sorter);
+	};
+	var testObject = {};
+	this.count = q.length;
+	this.add = function (k, v) {
+		if (!items[k]) {
+			items[k] = new dojo.collections.DictionaryEntry(k, v);
+			this.count = q.push(items[k]);
+			q.sort(sorter);
+		}
+	};
+	this.clear = function () {
+		items = {};
+		q = [];
+		this.count = q.length;
+	};
+	this.clone = function () {
+		return new dojo.collections.SortedList(this);
+	};
+	this.contains = this.containsKey = function (k) {
+		if (testObject[k]) {
+			return false;
+		}
+		return (items[k] != null);
+	};
+	this.containsValue = function (o) {
+		var e = this.getIterator();
+		while (!e.atEnd()) {
+			var item = e.get();
+			if (item.value == o) {
+				return true;
+			}
+		}
+		return false;
+	};
+	this.copyTo = function (arr, i) {
+		var e = this.getIterator();
+		var idx = i;
+		while (!e.atEnd()) {
+			arr.splice(idx, 0, e.get());
+			idx++;
+		}
+	};
+	this.entry = function (k) {
+		return items[k];
+	};
+	this.forEach = function (fn, scope) {
+		var s = scope || dj_global;
+		if (Array.forEach) {
+			Array.forEach(q, fn, s);
+		} else {
+			for (var i = 0; i &lt; q.length; i++) {
+				fn.call(s, q[i], i, q);
+			}
+		}
+	};
+	this.getByIndex = function (i) {
+		return q[i].valueOf();
+	};
+	this.getIterator = function () {
+		return new dojo.collections.DictionaryIterator(items);
+	};
+	this.getKey = function (i) {
+		return q[i].key;
+	};
+	this.getKeyList = function () {
+		var arr = [];
+		var e = this.getIterator();
+		while (!e.atEnd()) {
+			arr.push(e.get().key);
+		}
+		return arr;
+	};
+	this.getValueList = function () {
+		var arr = [];
+		var e = this.getIterator();
+		while (!e.atEnd()) {
+			arr.push(e.get().value);
+		}
+		return arr;
+	};
+	this.indexOfKey = function (k) {
+		for (var i = 0; i &lt; q.length; i++) {
+			if (q[i].key == k) {
+				return i;
+			}
+		}
+		return -1;
+	};
+	this.indexOfValue = function (o) {
+		for (var i = 0; i &lt; q.length; i++) {
+			if (q[i].value == o) {
+				return i;
+			}
+		}
+		return -1;
+	};
+	this.item = function (k) {
+		if (k in items &amp;&amp; !testObject[k]) {
+			return items[k].valueOf();
+		}
+		return undefined;
+	};
+	this.remove = function (k) {
+		delete items[k];
+		build();
+		this.count = q.length;
+	};
+	this.removeAt = function (i) {
+		delete items[q[i].key];
+		build();
+		this.count = q.length;
+	};
+	this.replace = function (k, v) {
+		if (!items[k]) {
+			this.add(k, v);
+			return false;
+		} else {
+			items[k] = new dojo.collections.DictionaryEntry(k, v);
+			q.sort(sorter);
+			return true;
+		}
+	};
+	this.setByIndex = function (i, o) {
+		items[q[i].key].value = o;
+		build();
+		this.count = q.length;
+	};
+	if (dictionary) {
+		var e = dictionary.getIterator();
+		while (!e.atEnd()) {
+			var item = e.get();
+			q[q.length] = items[item.key] = new dojo.collections.DictionaryEntry(item.key, item.value);
+		}
+		q.sort(sorter);
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Stack.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Stack.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Stack.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,67 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Stack&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.collections.Stack = function (arr) {
+	var q = [];
+	if (arr) {
+		q = q.concat(arr);
+	}
+	this.count = q.length;
+	this.clear = function () {
+		q = [];
+		this.count = q.length;
+	};
+	this.clone = function () {
+		return new dojo.collections.Stack(q);
+	};
+	this.contains = function (o) {
+		for (var i = 0; i &lt; q.length; i++) {
+			if (q[i] == o) {
+				return true;
+			}
+		}
+		return false;
+	};
+	this.copyTo = function (arr, i) {
+		arr.splice(i, 0, q);
+	};
+	this.forEach = function (fn, scope) {
+		var s = scope || dj_global;
+		if (Array.forEach) {
+			Array.forEach(q, fn, s);
+		} else {
+			for (var i = 0; i &lt; q.length; i++) {
+				fn.call(s, q[i], i, q);
+			}
+		}
+	};
+	this.getIterator = function () {
+		return new dojo.collections.Iterator(q);
+	};
+	this.peek = function () {
+		return q[(q.length - 1)];
+	};
+	this.pop = function () {
+		var r = q.pop();
+		this.count = q.length;
+		return r;
+	};
+	this.push = function (o) {
+		this.count = q.push(o);
+	};
+	this.toArray = function () {
+		return [].concat(q);
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/collections/Store.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/Store.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/Store.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,293 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.collections.Store&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.collections.Store = function (jsonArray) {
+	var data = [];
+	var items = {};
+	this.keyField = &quot;Id&quot;;
+	this.get = function () {
+		return data;
+	};
+	this.getByKey = function (key) {
+		return items[key];
+	};
+	this.getByIndex = function (idx) {
+		return data[idx];
+	};
+	this.getIndexOf = function (key) {
+		for (var i = 0; i &lt; data.length; i++) {
+			if (data[i].key == key) {
+				return i;
+			}
+		}
+		return -1;
+	};
+	this.getData = function () {
+		var arr = [];
+		for (var i = 0; i &lt; data.length; i++) {
+			arr.push(data[i].src);
+		}
+		return arr;
+	};
+	this.getDataByKey = function (key) {
+		if (items[key] != null) {
+			return items[key].src;
+		}
+		return null;
+	};
+	this.getIndexOfData = function (obj) {
+		for (var i = 0; i &lt; data.length; i++) {
+			if (data[i].src == obj) {
+				return i;
+			}
+		}
+		return -1;
+	};
+	this.getDataByIndex = function (idx) {
+		if (data[idx]) {
+			return data[idx].src;
+		}
+		return null;
+	};
+	this.update = function (obj, fieldPath, val, bDontFire) {
+		var parts = fieldPath.split(&quot;.&quot;), i = 0, o = obj, field;
+		if (parts.length &gt; 1) {
+			field = parts.pop();
+			do {
+				if (parts[i].indexOf(&quot;()&quot;) &gt; -1) {
+					var temp = parts[i++].split(&quot;()&quot;)[0];
+					if (!o[temp]) {
+						dojo.raise(&quot;dojo.collections.Store.getField(obj, '&quot; + field + &quot;'): '&quot; + temp + &quot;' is not a property of the passed object.&quot;);
+					} else {
+						o = o[temp]();
+					}
+				} else {
+					o = o[parts[i++]];
+				}
+			} while (i &lt; parts.length &amp;&amp; o != null);
+		} else {
+			field = parts[0];
+		}
+		obj[field] = val;
+		if (!bDontFire) {
+			this.onUpdateField(obj, fieldPath, val);
+		}
+	};
+	this.forEach = function (fn) {
+		if (Array.forEach) {
+			Array.forEach(data, fn, this);
+		} else {
+			for (var i = 0; i &lt; data.length; i++) {
+				fn.call(this, data[i]);
+			}
+		}
+	};
+	this.forEachData = function (fn) {
+		if (Array.forEach) {
+			Array.forEach(this.getData(), fn, this);
+		} else {
+			var a = this.getData();
+			for (var i = 0; i &lt; a.length; i++) {
+				fn.call(this, a[i]);
+			}
+		}
+	};
+	this.setData = function (arr, bDontFire) {
+		data = [];
+		for (var i = 0; i &lt; arr.length; i++) {
+			var o = {key:arr[i][this.keyField], src:arr[i]};
+			data.push(o);
+			items[o.key] = o;
+		}
+		if (!bDontFire) {
+			this.onSetData();
+		}
+	};
+	this.clearData = function (bDontFire) {
+		data = [];
+		items = {};
+		if (!bDontFire) {
+			this.onClearData();
+		}
+	};
+	this.addData = function (obj, key, bDontFire) {
+		var k = key || obj[this.keyField];
+		if (items[k] != null) {
+			var o = items[k];
+			o.src = obj;
+		} else {
+			var o = {key:k, src:obj};
+			data.push(o);
+			items[o.key] = o;
+		}
+		if (!bDontFire) {
+			this.onAddData(o);
+		}
+	};
+	this.addDataRange = function (arr, bDontFire) {
+		var objects = [];
+		for (var i = 0; i &lt; arr.length; i++) {
+			var k = arr[i][this.keyField];
+			if (items[k] != null) {
+				var o = items[k];
+				o.src = arr[i];
+			} else {
+				var o = {key:k, src:arr[i]};
+				data.push(o);
+				items[k] = o;
+			}
+			objects.push(o);
+		}
+		if (!bDontFire) {
+			this.onAddDataRange(objects);
+		}
+	};
+	this.addDataByIndex = function (obj, idx, key, bDontFire) {
+		var k = key || obj[this.keyField];
+		if (items[k] != null) {
+			var i = this.getIndexOf(k);
+			var o = data.splice(i, 1);
+			o.src = obj;
+		} else {
+			var o = {key:k, src:obj};
+			items[k] = o;
+		}
+		data.splice(idx, 0, o);
+		if (!bDontFire) {
+			this.onAddData(o);
+		}
+	};
+	this.addDataRangeByIndex = function (arr, idx, bDontFire) {
+		var objects = [];
+		for (var i = 0; i &lt; arr.length; i++) {
+			var k = arr[i][this.keyField];
+			if (items[k] != null) {
+				var j = this.getIndexOf(k);
+				var o = data.splice(j, 1);
+				o.src = arr[i];
+			} else {
+				var o = {key:k, src:arr[i]};
+				items[k] = o;
+			}
+			objects.push(o);
+		}
+		data.splice(idx, 0, objects);
+		if (!bDontFire) {
+			this.onAddDataRange(objects);
+		}
+	};
+	this.removeData = function (obj, bDontFire) {
+		var idx = -1;
+		var o = null;
+		for (var i = 0; i &lt; data.length; i++) {
+			if (data[i].src == obj) {
+				idx = i;
+				o = data[i];
+				break;
+			}
+		}
+		if (!bDontFire) {
+			this.onRemoveData(o);
+		}
+		if (idx &gt; -1) {
+			data.splice(idx, 1);
+			delete items[o.key];
+		}
+	};
+	this.removeDataRange = function (idx, range, bDontFire) {
+		var ret = data.splice(idx, range);
+		for (var i = 0; i &lt; ret.length; i++) {
+			delete items[ret[i].key];
+		}
+		if (!bDontFire) {
+			this.onRemoveDataRange(ret);
+		}
+		return ret;
+	};
+	this.removeDataByKey = function (key, bDontFire) {
+		this.removeData(this.getDataByKey(key), bDontFire);
+	};
+	this.removeDataByIndex = function (idx, bDontFire) {
+		this.removeData(this.getDataByIndex(idx), bDontFire);
+	};
+	if (jsonArray &amp;&amp; jsonArray.length &amp;&amp; jsonArray[0]) {
+		this.setData(jsonArray, true);
+	}
+};
+dojo.extend(dojo.collections.Store, {getField:function (obj, field) {
+	var parts = field.split(&quot;.&quot;), i = 0, o = obj;
+	do {
+		if (parts[i].indexOf(&quot;()&quot;) &gt; -1) {
+			var temp = parts[i++].split(&quot;()&quot;)[0];
+			if (!o[temp]) {
+				dojo.raise(&quot;dojo.collections.Store.getField(obj, '&quot; + field + &quot;'): '&quot; + temp + &quot;' is not a property of the passed object.&quot;);
+			} else {
+				o = o[temp]();
+			}
+		} else {
+			o = o[parts[i++]];
+		}
+	} while (i &lt; parts.length &amp;&amp; o != null);
+	if (i &lt; parts.length) {
+		dojo.raise(&quot;dojo.collections.Store.getField(obj, '&quot; + field + &quot;'): '&quot; + field + &quot;' is not a property of the passed object.&quot;);
+	}
+	return o;
+}, getFromHtml:function (meta, body, fnMod) {
+	var rows = body.rows;
+	var ctor = function (row) {
+		var obj = {};
+		for (var i = 0; i &lt; meta.length; i++) {
+			var o = obj;
+			var data = row.cells[i].innerHTML;
+			var p = meta[i].getField();
+			if (p.indexOf(&quot;.&quot;) &gt; -1) {
+				p = p.split(&quot;.&quot;);
+				while (p.length &gt; 1) {
+					var pr = p.shift();
+					o[pr] = {};
+					o = o[pr];
+				}
+				p = p[0];
+			}
+			var type = meta[i].getType();
+			if (type == String) {
+				o[p] = data;
+			} else {
+				if (data) {
+					o[p] = new type(data);
+				} else {
+					o[p] = new type();
+				}
+			}
+		}
+		return obj;
+	};
+	var arr = [];
+	for (var i = 0; i &lt; rows.length; i++) {
+		var o = ctor(rows[i]);
+		if (fnMod) {
+			fnMod(o, rows[i]);
+		}
+		arr.push(o);
+	}
+	return arr;
+}, onSetData:function () {
+}, onClearData:function () {
+}, onAddData:function (obj) {
+}, onAddDataRange:function (arr) {
+}, onRemoveData:function (obj) {
+}, onRemoveDataRange:function (arr) {
+}, onUpdateField:function (obj, field, val) {
+}});
+

Added: tags/parley-0.55/root/static/magic/src/collections/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/collections/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/collections/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.collections.Collections&quot;, &quot;dojo.collections.SortedList&quot;, &quot;dojo.collections.Dictionary&quot;, &quot;dojo.collections.Queue&quot;, &quot;dojo.collections.ArrayList&quot;, &quot;dojo.collections.Stack&quot;, &quot;dojo.collections.Set&quot;]});
+dojo.provide(&quot;dojo.collections.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/crypto/Blowfish.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/Blowfish.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/Blowfish.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,384 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.crypto&quot;);
+dojo.provide(&quot;dojo.crypto.Blowfish&quot;);
+dojo.crypto.Blowfish = new function () {
+	var POW2 = Math.pow(2, 2);
+	var POW3 = Math.pow(2, 3);
+	var POW4 = Math.pow(2, 4);
+	var POW8 = Math.pow(2, 8);
+	var POW16 = Math.pow(2, 16);
+	var POW24 = Math.pow(2, 24);
+	var iv = null;
+	var boxes = {p:[608135816, 2242054355, 320440878, 57701188, 2752067618, 698298832, 137296536, 3964562569, 1160258022, 953160567, 3193202383, 887688300, 3232508343, 3380367581, 1065670069, 3041331479, 2450970073, 2306472731], s0:[3509652390, 2564797868, 805139163, 3491422135, 3101798381, 1780907670, 3128725573, 4046225305, 614570311, 3012652279, 134345442, 2240740374, 1667834072, 1901547113, 2757295779, 4103290238, 227898511, 1921955416, 1904987480, 2182433518, 2069144605, 3260701109, 2620446009, 720527379, 3318853667, 677414384, 3393288472, 3101374703, 2390351024, 1614419982, 1822297739, 2954791486, 3608508353, 3174124327, 2024746970, 1432378464, 3864339955, 2857741204, 1464375394, 1676153920, 1439316330, 715854006, 3033291828, 289532110, 2706671279, 2087905683, 3018724369, 1668267050, 732546397, 1947742710, 3462151702, 2609353502, 2950085171, 1814351708, 2050118529, 680887927, 999245976, 1800124847, 3300911131, 1713906067, 1641548236, 4213287313, 1216130144, 1575780402, 4!
 018429277, 3917837745, 3693486850, 3949271944, 596196993, 3549867205, 258830323, 2213823033, 772490370, 2760122372, 1774776394, 2652871518, 566650946, 4142492826, 1728879713, 2882767088, 1783734482, 3629395816, 2517608232, 2874225571, 1861159788, 326777828, 3124490320, 2130389656, 2716951837, 967770486, 1724537150, 2185432712, 2364442137, 1164943284, 2105845187, 998989502, 3765401048, 2244026483, 1075463327, 1455516326, 1322494562, 910128902, 469688178, 1117454909, 936433444, 3490320968, 3675253459, 1240580251, 122909385, 2157517691, 634681816, 4142456567, 3825094682, 3061402683, 2540495037, 79693498, 3249098678, 1084186820, 1583128258, 426386531, 1761308591, 1047286709, 322548459, 995290223, 1845252383, 2603652396, 3431023940, 2942221577, 3202600964, 3727903485, 1712269319, 422464435, 3234572375, 1170764815, 3523960633, 3117677531, 1434042557, 442511882, 3600875718, 1076654713, 1738483198, 4213154764, 2393238008, 3677496056, 1014306527, 4251020053, 793779912, 2902807211, 8!
 42905082, 4246964064, 1395751752, 1040244610, 2656851899, 3396!
 308128, 
445077038, 3742853595, 3577915638, 679411651, 2892444358, 2354009459, 1767581616, 3150600392, 3791627101, 3102740896, 284835224, 4246832056, 1258075500, 768725851, 2589189241, 3069724005, 3532540348, 1274779536, 3789419226, 2764799539, 1660621633, 3471099624, 4011903706, 913787905, 3497959166, 737222580, 2514213453, 2928710040, 3937242737, 1804850592, 3499020752, 2949064160, 2386320175, 2390070455, 2415321851, 4061277028, 2290661394, 2416832540, 1336762016, 1754252060, 3520065937, 3014181293, 791618072, 3188594551, 3933548030, 2332172193, 3852520463, 3043980520, 413987798, 3465142937, 3030929376, 4245938359, 2093235073, 3534596313, 375366246, 2157278981, 2479649556, 555357303, 3870105701, 2008414854, 3344188149, 4221384143, 3956125452, 2067696032, 3594591187, 2921233993, 2428461, 544322398, 577241275, 1471733935, 610547355, 4027169054, 1432588573, 1507829418, 2025931657, 3646575487, 545086370, 48609733, 2200306550, 1653985193, 298326376, 1316178497, 3007786442, 2064951626, 4!
 58293330, 2589141269, 3591329599, 3164325604, 727753846, 2179363840, 146436021, 1461446943, 4069977195, 705550613, 3059967265, 3887724982, 4281599278, 3313849956, 1404054877, 2845806497, 146425753, 1854211946], s1:[1266315497, 3048417604, 3681880366, 3289982499, 2909710000, 1235738493, 2632868024, 2414719590, 3970600049, 1771706367, 1449415276, 3266420449, 422970021, 1963543593, 2690192192, 3826793022, 1062508698, 1531092325, 1804592342, 2583117782, 2714934279, 4024971509, 1294809318, 4028980673, 1289560198, 2221992742, 1669523910, 35572830, 157838143, 1052438473, 1016535060, 1802137761, 1753167236, 1386275462, 3080475397, 2857371447, 1040679964, 2145300060, 2390574316, 1461121720, 2956646967, 4031777805, 4028374788, 33600511, 2920084762, 1018524850, 629373528, 3691585981, 3515945977, 2091462646, 2486323059, 586499841, 988145025, 935516892, 3367335476, 2599673255, 2839830854, 265290510, 3972581182, 2759138881, 3795373465, 1005194799, 847297441, 406762289, 1314163512, 133259!
 0856, 1866599683, 4127851711, 750260880, 613907577, 1450815602!
 , 316562
0655, 3734664991, 3650291728, 3012275730, 3704569646, 1427272223, 778793252, 1343938022, 2676280711, 2052605720, 1946737175, 3164576444, 3914038668, 3967478842, 3682934266, 1661551462, 3294938066, 4011595847, 840292616, 3712170807, 616741398, 312560963, 711312465, 1351876610, 322626781, 1910503582, 271666773, 2175563734, 1594956187, 70604529, 3617834859, 1007753275, 1495573769, 4069517037, 2549218298, 2663038764, 504708206, 2263041392, 3941167025, 2249088522, 1514023603, 1998579484, 1312622330, 694541497, 2582060303, 2151582166, 1382467621, 776784248, 2618340202, 3323268794, 2497899128, 2784771155, 503983604, 4076293799, 907881277, 423175695, 432175456, 1378068232, 4145222326, 3954048622, 3938656102, 3820766613, 2793130115, 2977904593, 26017576, 3274890735, 3194772133, 1700274565, 1756076034, 4006520079, 3677328699, 720338349, 1533947780, 354530856, 688349552, 3973924725, 1637815568, 332179504, 3949051286, 53804574, 2852348879, 3044236432, 1282449977, 3583942155, 3416972820,!
  4006381244, 1617046695, 2628476075, 3002303598, 1686838959, 431878346, 2686675385, 1700445008, 1080580658, 1009431731, 832498133, 3223435511, 2605976345, 2271191193, 2516031870, 1648197032, 4164389018, 2548247927, 300782431, 375919233, 238389289, 3353747414, 2531188641, 2019080857, 1475708069, 455242339, 2609103871, 448939670, 3451063019, 1395535956, 2413381860, 1841049896, 1491858159, 885456874, 4264095073, 4001119347, 1565136089, 3898914787, 1108368660, 540939232, 1173283510, 2745871338, 3681308437, 4207628240, 3343053890, 4016749493, 1699691293, 1103962373, 3625875870, 2256883143, 3830138730, 1031889488, 3479347698, 1535977030, 4236805024, 3251091107, 2132092099, 1774941330, 1199868427, 1452454533, 157007616, 2904115357, 342012276, 595725824, 1480756522, 206960106, 497939518, 591360097, 863170706, 2375253569, 3596610801, 1814182875, 2094937945, 3421402208, 1082520231, 3463918190, 2785509508, 435703966, 3908032597, 1641649973, 2842273706, 3305899714, 1510255612, 21482564!
 76, 2655287854, 3276092548, 4258621189, 236887753, 3681803219,!
  2740410
37, 1734335097, 3815195456, 3317970021, 1899903192, 1026095262, 4050517792, 356393447, 2410691914, 3873677099, 3682840055], s2:[3913112168, 2491498743, 4132185628, 2489919796, 1091903735, 1979897079, 3170134830, 3567386728, 3557303409, 857797738, 1136121015, 1342202287, 507115054, 2535736646, 337727348, 3213592640, 1301675037, 2528481711, 1895095763, 1721773893, 3216771564, 62756741, 2142006736, 835421444, 2531993523, 1442658625, 3659876326, 2882144922, 676362277, 1392781812, 170690266, 3921047035, 1759253602, 3611846912, 1745797284, 664899054, 1329594018, 3901205900, 3045908486, 2062866102, 2865634940, 3543621612, 3464012697, 1080764994, 553557557, 3656615353, 3996768171, 991055499, 499776247, 1265440854, 648242737, 3940784050, 980351604, 3713745714, 1749149687, 3396870395, 4211799374, 3640570775, 1161844396, 3125318951, 1431517754, 545492359, 4268468663, 3499529547, 1437099964, 2702547544, 3433638243, 2581715763, 2787789398, 1060185593, 1593081372, 2418618748, 4260947970, !
 69676912, 2159744348, 86519011, 2512459080, 3838209314, 1220612927, 3339683548, 133810670, 1090789135, 1078426020, 1569222167, 845107691, 3583754449, 4072456591, 1091646820, 628848692, 1613405280, 3757631651, 526609435, 236106946, 48312990, 2942717905, 3402727701, 1797494240, 859738849, 992217954, 4005476642, 2243076622, 3870952857, 3732016268, 765654824, 3490871365, 2511836413, 1685915746, 3888969200, 1414112111, 2273134842, 3281911079, 4080962846, 172450625, 2569994100, 980381355, 4109958455, 2819808352, 2716589560, 2568741196, 3681446669, 3329971472, 1835478071, 660984891, 3704678404, 4045999559, 3422617507, 3040415634, 1762651403, 1719377915, 3470491036, 2693910283, 3642056355, 3138596744, 1364962596, 2073328063, 1983633131, 926494387, 3423689081, 2150032023, 4096667949, 1749200295, 3328846651, 309677260, 2016342300, 1779581495, 3079819751, 111262694, 1274766160, 443224088, 298511866, 1025883608, 3806446537, 1145181785, 168956806, 3641502830, 3584813610, 1689216846, 366!
 6258015, 3200248200, 1692713982, 2646376535, 4042768518, 16185!
 08792, 1
610833997, 3523052358, 4130873264, 2001055236, 3610705100, 2202168115, 4028541809, 2961195399, 1006657119, 2006996926, 3186142756, 1430667929, 3210227297, 1314452623, 4074634658, 4101304120, 2273951170, 1399257539, 3367210612, 3027628629, 1190975929, 2062231137, 2333990788, 2221543033, 2438960610, 1181637006, 548689776, 2362791313, 3372408396, 3104550113, 3145860560, 296247880, 1970579870, 3078560182, 3769228297, 1714227617, 3291629107, 3898220290, 166772364, 1251581989, 493813264, 448347421, 195405023, 2709975567, 677966185, 3703036547, 1463355134, 2715995803, 1338867538, 1343315457, 2802222074, 2684532164, 233230375, 2599980071, 2000651841, 3277868038, 1638401717, 4028070440, 3237316320, 6314154, 819756386, 300326615, 590932579, 1405279636, 3267499572, 3150704214, 2428286686, 3959192993, 3461946742, 1862657033, 1266418056, 963775037, 2089974820, 2263052895, 1917689273, 448879540, 3550394620, 3981727096, 150775221, 3627908307, 1303187396, 508620638, 2975983352, 2726630617, !
 1817252668, 1876281319, 1457606340, 908771278, 3720792119, 3617206836, 2455994898, 1729034894, 1080033504], s3:[976866871, 3556439503, 2881648439, 1522871579, 1555064734, 1336096578, 3548522304, 2579274686, 3574697629, 3205460757, 3593280638, 3338716283, 3079412587, 564236357, 2993598910, 1781952180, 1464380207, 3163844217, 3332601554, 1699332808, 1393555694, 1183702653, 3581086237, 1288719814, 691649499, 2847557200, 2895455976, 3193889540, 2717570544, 1781354906, 1676643554, 2592534050, 3230253752, 1126444790, 2770207658, 2633158820, 2210423226, 2615765581, 2414155088, 3127139286, 673620729, 2805611233, 1269405062, 4015350505, 3341807571, 4149409754, 1057255273, 2012875353, 2162469141, 2276492801, 2601117357, 993977747, 3918593370, 2654263191, 753973209, 36408145, 2530585658, 25011837, 3520020182, 2088578344, 530523599, 2918365339, 1524020338, 1518925132, 3760827505, 3759777254, 1202760957, 3985898139, 3906192525, 674977740, 4174734889, 2031300136, 2019492241, 3983892565, !
 4153806404, 3822280332, 352677332, 2297720250, 60907813, 90501!
 309, 328
6998549, 1016092578, 2535922412, 2839152426, 457141659, 509813237, 4120667899, 652014361, 1966332200, 2975202805, 55981186, 2327461051, 676427537, 3255491064, 2882294119, 3433927263, 1307055953, 942726286, 933058658, 2468411793, 3933900994, 4215176142, 1361170020, 2001714738, 2830558078, 3274259782, 1222529897, 1679025792, 2729314320, 3714953764, 1770335741, 151462246, 3013232138, 1682292957, 1483529935, 471910574, 1539241949, 458788160, 3436315007, 1807016891, 3718408830, 978976581, 1043663428, 3165965781, 1927990952, 4200891579, 2372276910, 3208408903, 3533431907, 1412390302, 2931980059, 4132332400, 1947078029, 3881505623, 4168226417, 2941484381, 1077988104, 1320477388, 886195818, 18198404, 3786409000, 2509781533, 112762804, 3463356488, 1866414978, 891333506, 18488651, 661792760, 1628790961, 3885187036, 3141171499, 876946877, 2693282273, 1372485963, 791857591, 2686433993, 3759982718, 3167212022, 3472953795, 2716379847, 445679433, 3561995674, 3504004811, 3574258232, 5411716!
 2, 3331405415, 2381918588, 3769707343, 4154350007, 1140177722, 4074052095, 668550556, 3214352940, 367459370, 261225585, 2610173221, 4209349473, 3468074219, 3265815641, 314222801, 3066103646, 3808782860, 282218597, 3406013506, 3773591054, 379116347, 1285071038, 846784868, 2669647154, 3771962079, 3550491691, 2305946142, 453669953, 1268987020, 3317592352, 3279303384, 3744833421, 2610507566, 3859509063, 266596637, 3847019092, 517658769, 3462560207, 3443424879, 370717030, 4247526661, 2224018117, 4143653529, 4112773975, 2788324899, 2477274417, 1456262402, 2901442914, 1517677493, 1846949527, 2295493580, 3734397586, 2176403920, 1280348187, 1908823572, 3871786941, 846861322, 1172426758, 3287448474, 3383383037, 1655181056, 3139813346, 901632758, 1897031941, 2986607138, 3066810236, 3447102507, 1393639104, 373351379, 950779232, 625454576, 3124240540, 4148612726, 2007998917, 544563296, 2244738638, 2330496472, 2058025392, 1291430526, 424198748, 50039436, 29584100, 3605783033, 2429876329,!
  2791104160, 1057563949, 3255363231, 3075367218, 3463963227, 1!
 46904675
5, 985887462]};
+	function add(x, y) {
+		var sum = (x + y) &amp; 4294967295;
+		if (sum &lt; 0) {
+			sum = -sum;
+			return (65536 * ((sum &gt;&gt; 16) ^ 65535)) + (((sum &amp; 65535) ^ 65535) + 1);
+		}
+		return sum;
+	}
+	function split(x) {
+		var r = x &amp; 4294967295;
+		if (r &lt; 0) {
+			r = -r;
+			return [((r &amp; 65535) ^ 65535) + 1, (r &gt;&gt; 16) ^ 65535];
+		}
+		return [r &amp; 65535, (r &gt;&gt; 16)];
+	}
+	function xor(x, y) {
+		var xs = split(x);
+		var ys = split(y);
+		return (65536 * (xs[1] ^ ys[1])) + (xs[0] ^ ys[0]);
+	}
+	function $(v, box) {
+		var d = v &amp; 255;
+		v &gt;&gt;= 8;
+		var c = v &amp; 255;
+		v &gt;&gt;= 8;
+		var b = v &amp; 255;
+		v &gt;&gt;= 8;
+		var a = v &amp; 255;
+		var r = add(box.s0[a], box.s1[b]);
+		r = xor(r, box.s2[c]);
+		return add(r, box.s3[d]);
+	}
+	function eb(o, box) {
+		var l = o.left;
+		var r = o.right;
+		l = xor(l, box.p[0]);
+		r = xor(r, xor($(l, box), box.p[1]));
+		l = xor(l, xor($(r, box), box.p[2]));
+		r = xor(r, xor($(l, box), box.p[3]));
+		l = xor(l, xor($(r, box), box.p[4]));
+		r = xor(r, xor($(l, box), box.p[5]));
+		l = xor(l, xor($(r, box), box.p[6]));
+		r = xor(r, xor($(l, box), box.p[7]));
+		l = xor(l, xor($(r, box), box.p[8]));
+		r = xor(r, xor($(l, box), box.p[9]));
+		l = xor(l, xor($(r, box), box.p[10]));
+		r = xor(r, xor($(l, box), box.p[11]));
+		l = xor(l, xor($(r, box), box.p[12]));
+		r = xor(r, xor($(l, box), box.p[13]));
+		l = xor(l, xor($(r, box), box.p[14]));
+		r = xor(r, xor($(l, box), box.p[15]));
+		l = xor(l, xor($(r, box), box.p[16]));
+		o.right = l;
+		o.left = xor(r, box.p[17]);
+	}
+	function db(o, box) {
+		var l = o.left;
+		var r = o.right;
+		l = xor(l, box.p[17]);
+		r = xor(r, xor($(l, box), box.p[16]));
+		l = xor(l, xor($(r, box), box.p[15]));
+		r = xor(r, xor($(l, box), box.p[14]));
+		l = xor(l, xor($(r, box), box.p[13]));
+		r = xor(r, xor($(l, box), box.p[12]));
+		l = xor(l, xor($(r, box), box.p[11]));
+		r = xor(r, xor($(l, box), box.p[10]));
+		l = xor(l, xor($(r, box), box.p[9]));
+		r = xor(r, xor($(l, box), box.p[8]));
+		l = xor(l, xor($(r, box), box.p[7]));
+		r = xor(r, xor($(l, box), box.p[6]));
+		l = xor(l, xor($(r, box), box.p[5]));
+		r = xor(r, xor($(l, box), box.p[4]));
+		l = xor(l, xor($(r, box), box.p[3]));
+		r = xor(r, xor($(l, box), box.p[2]));
+		l = xor(l, xor($(r, box), box.p[1]));
+		o.right = l;
+		o.left = xor(r, box.p[0]);
+	}
+	function init(key) {
+		var k = key;
+		if (typeof (k) == &quot;string&quot;) {
+			var a = [];
+			for (var i = 0; i &lt; k.length; i++) {
+				a.push(k.charCodeAt(i) &amp; 255);
+			}
+			k = a;
+		}
+		var box = {p:[], s0:[], s1:[], s2:[], s3:[]};
+		for (var i = 0; i &lt; boxes.p.length; i++) {
+			box.p.push(boxes.p[i]);
+		}
+		for (var i = 0; i &lt; boxes.s0.length; i++) {
+			box.s0.push(boxes.s0[i]);
+		}
+		for (var i = 0; i &lt; boxes.s1.length; i++) {
+			box.s1.push(boxes.s1[i]);
+		}
+		for (var i = 0; i &lt; boxes.s2.length; i++) {
+			box.s2.push(boxes.s2[i]);
+		}
+		for (var i = 0; i &lt; boxes.s3.length; i++) {
+			box.s3.push(boxes.s3[i]);
+		}
+		var pos = 0;
+		var data = 0;
+		for (var i = 0; i &lt; box.p.length; i++) {
+			for (var j = 0; j &lt; 4; j++) {
+				data = (data * POW8) | k[pos];
+				if (++pos == k.length) {
+					pos = 0;
+				}
+			}
+			box.p[i] = xor(box.p[i], data);
+		}
+		var res = {left:0, right:0};
+		for (var i = 0; i &lt; box.p.length; ) {
+			eb(res, box);
+			box.p[i++] = res.left;
+			box.p[i++] = res.right;
+		}
+		for (var i = 0; i &lt; 4; i++) {
+			for (var j = 0; j &lt; box[&quot;s&quot; + i].length; ) {
+				eb(res, box);
+				box[&quot;s&quot; + i][j++] = res.left;
+				box[&quot;s&quot; + i][j++] = res.right;
+			}
+		}
+		return box;
+	}
+	function toBase64(ba) {
+		var p = &quot;=&quot;;
+		var tab = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;
+		var s = [];
+		var l = ba.length;
+		var rm = l % 3;
+		var x = l - rm;
+		for (var i = 0; i &lt; x; ) {
+			var t = ba[i++] &lt;&lt; 16 | ba[i++] &lt;&lt; 8 | ba[i++];
+			s.push(tab.charAt((t &gt;&gt;&gt; 18) &amp; 63));
+			s.push(tab.charAt((t &gt;&gt;&gt; 12) &amp; 63));
+			s.push(tab.charAt((t &gt;&gt;&gt; 6) &amp; 63));
+			s.push(tab.charAt(t &amp; 63));
+		}
+		switch (rm) {
+		  case 2:
+			var t = ba[i++] &lt;&lt; 16 | ba[i++] &lt;&lt; 8;
+			s.push(tab.charAt((t &gt;&gt;&gt; 18) &amp; 63));
+			s.push(tab.charAt((t &gt;&gt;&gt; 12) &amp; 63));
+			s.push(tab.charAt((t &gt;&gt;&gt; 6) &amp; 63));
+			s.push(p);
+			break;
+		  case 1:
+			var t = ba[i++] &lt;&lt; 16;
+			s.push(tab.charAt((t &gt;&gt;&gt; 18) &amp; 63));
+			s.push(tab.charAt((t &gt;&gt;&gt; 12) &amp; 63));
+			s.push(p);
+			s.push(p);
+			break;
+		}
+		return s.join(&quot;&quot;);
+	}
+	function fromBase64(str) {
+		var s = str.split(&quot;&quot;);
+		var p = &quot;=&quot;;
+		var tab = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;
+		var out = [];
+		var l = s.length;
+		while (s[--l] == p) {
+		}
+		for (var i = 0; i &lt; l; ) {
+			var t = tab.indexOf(s[i++]) &lt;&lt; 18 | tab.indexOf(s[i++]) &lt;&lt; 12 | tab.indexOf(s[i++]) &lt;&lt; 6 | tab.indexOf(s[i++]);
+			out.push((t &gt;&gt;&gt; 16) &amp; 255);
+			out.push((t &gt;&gt;&gt; 8) &amp; 255);
+			out.push(t &amp; 255);
+		}
+		return out;
+	}
+	this.getIV = function (outputType) {
+		var out = outputType || dojo.crypto.outputTypes.Base64;
+		switch (out) {
+		  case dojo.crypto.outputTypes.Hex:
+			var s = [];
+			for (var i = 0; i &lt; iv.length; i++) {
+				s.push((iv[i]).toString(16));
+			}
+			return s.join(&quot;&quot;);
+		  case dojo.crypto.outputTypes.String:
+			return iv.join(&quot;&quot;);
+		  case dojo.crypto.outputTypes.Raw:
+			return iv;
+		  default:
+			return toBase64(iv);
+		}
+	};
+	this.setIV = function (data, inputType) {
+		var ip = inputType || dojo.crypto.outputTypes.Base64;
+		var ba = null;
+		switch (ip) {
+		  case dojo.crypto.outputTypes.String:
+			ba = [];
+			for (var i = 0; i &lt; data.length; i++) {
+				ba.push(data.charCodeAt(i));
+			}
+			break;
+		  case dojo.crypto.outputTypes.Hex:
+			ba = [];
+			var i = 0;
+			while (i + 1 &lt; data.length) {
+				ba.push(parseInt(data.substr(i, 2), 16));
+				i += 2;
+			}
+			break;
+		  case dojo.crypto.outputTypes.Raw:
+			ba = data;
+			break;
+		  default:
+			ba = fromBase64(data);
+			break;
+		}
+		iv = {};
+		iv.left = ba[0] * POW24 | ba[1] * POW16 | ba[2] * POW8 | ba[3];
+		iv.right = ba[4] * POW24 | ba[5] * POW16 | ba[6] * POW8 | ba[7];
+	};
+	this.encrypt = function (plaintext, key, ao) {
+		var out = dojo.crypto.outputTypes.Base64;
+		var mode = dojo.crypto.cipherModes.EBC;
+		if (ao) {
+			if (ao.outputType) {
+				out = ao.outputType;
+			}
+			if (ao.cipherMode) {
+				mode = ao.cipherMode;
+			}
+		}
+		var bx = init(key);
+		var padding = 8 - (plaintext.length &amp; 7);
+		for (var i = 0; i &lt; padding; i++) {
+			plaintext += String.fromCharCode(padding);
+		}
+		var cipher = [];
+		var count = plaintext.length &gt;&gt; 3;
+		var pos = 0;
+		var o = {};
+		var isCBC = (mode == dojo.crypto.cipherModes.CBC);
+		var vector = {left:iv.left || null, right:iv.right || null};
+		for (var i = 0; i &lt; count; i++) {
+			o.left = plaintext.charCodeAt(pos) * POW24 | plaintext.charCodeAt(pos + 1) * POW16 | plaintext.charCodeAt(pos + 2) * POW8 | plaintext.charCodeAt(pos + 3);
+			o.right = plaintext.charCodeAt(pos + 4) * POW24 | plaintext.charCodeAt(pos + 5) * POW16 | plaintext.charCodeAt(pos + 6) * POW8 | plaintext.charCodeAt(pos + 7);
+			if (isCBC) {
+				o.left = xor(o.left, vector.left);
+				o.right = xor(o.right, vector.right);
+			}
+			eb(o, bx);
+			if (isCBC) {
+				vector.left = o.left;
+				vector.right = o.right;
+				dojo.crypto.outputTypes.Hex;
+			}
+			cipher.push((o.left &gt;&gt; 24) &amp; 255);
+			cipher.push((o.left &gt;&gt; 16) &amp; 255);
+			cipher.push((o.left &gt;&gt; 8) &amp; 255);
+			cipher.push(o.left &amp; 255);
+			cipher.push((o.right &gt;&gt; 24) &amp; 255);
+			cipher.push((o.right &gt;&gt; 16) &amp; 255);
+			cipher.push((o.right &gt;&gt; 8) &amp; 255);
+			cipher.push(o.right &amp; 255);
+			pos += 8;
+		}
+		switch (out) {
+		  case dojo.crypto.outputTypes.Hex:
+			var s = [];
+			for (var i = 0; i &lt; cipher.length; i++) {
+				s.push((cipher[i]).toString(16));
+			}
+			return s.join(&quot;&quot;);
+		  case dojo.crypto.outputTypes.String:
+			return cipher.join(&quot;&quot;);
+		  case dojo.crypto.outputTypes.Raw:
+			return cipher;
+		  default:
+			return toBase64(cipher);
+		}
+	};
+	this.decrypt = function (ciphertext, key, ao) {
+		var ip = dojo.crypto.outputTypes.Base64;
+		var mode = dojo.crypto.cipherModes.EBC;
+		if (ao) {
+			if (ao.outputType) {
+				ip = ao.outputType;
+			}
+			if (ao.cipherMode) {
+				mode = ao.cipherMode;
+			}
+		}
+		var bx = init(key);
+		var pt = [];
+		var c = null;
+		switch (ip) {
+		  case dojo.crypto.outputTypes.Hex:
+			c = [];
+			var i = 0;
+			while (i + 1 &lt; ciphertext.length) {
+				c.push(parseInt(ciphertext.substr(i, 2), 16));
+				i += 2;
+			}
+			break;
+		  case dojo.crypto.outputTypes.String:
+			c = [];
+			for (var i = 0; i &lt; ciphertext.length; i++) {
+				c.push(ciphertext.charCodeAt(i));
+			}
+			break;
+		  case dojo.crypto.outputTypes.Raw:
+			c = ciphertext;
+			break;
+		  default:
+			c = fromBase64(ciphertext);
+			break;
+		}
+		var count = c.length &gt;&gt; 3;
+		var pos = 0;
+		var o = {};
+		var isCBC = (mode == dojo.crypto.cipherModes.CBC);
+		var vector = {left:iv.left || null, right:iv.right || null};
+		for (var i = 0; i &lt; count; i++) {
+			o.left = c[pos] * POW24 | c[pos + 1] * POW16 | c[pos + 2] * POW8 | c[pos + 3];
+			o.right = c[pos + 4] * POW24 | c[pos + 5] * POW16 | c[pos + 6] * POW8 | c[pos + 7];
+			if (isCBC) {
+				var left = o.left;
+				var right = o.right;
+			}
+			db(o, bx);
+			if (isCBC) {
+				o.left = xor(o.left, vector.left);
+				o.right = xor(o.right, vector.right);
+				vector.left = left;
+				vector.right = right;
+			}
+			pt.push((o.left &gt;&gt; 24) &amp; 255);
+			pt.push((o.left &gt;&gt; 16) &amp; 255);
+			pt.push((o.left &gt;&gt; 8) &amp; 255);
+			pt.push(o.left &amp; 255);
+			pt.push((o.right &gt;&gt; 24) &amp; 255);
+			pt.push((o.right &gt;&gt; 16) &amp; 255);
+			pt.push((o.right &gt;&gt; 8) &amp; 255);
+			pt.push(o.right &amp; 255);
+			pos += 8;
+		}
+		if (pt[pt.length - 1] == pt[pt.length - 2] || pt[pt.length - 1] == 1) {
+			var n = pt[pt.length - 1];
+			pt.splice(pt.length - n, n);
+		}
+		for (var i = 0; i &lt; pt.length; i++) {
+			pt[i] = String.fromCharCode(pt[i]);
+		}
+		return pt.join(&quot;&quot;);
+	};
+	this.setIV(&quot;0000000000000000&quot;, dojo.crypto.outputTypes.Hex);
+}();
+

Added: tags/parley-0.55/root/static/magic/src/crypto/LICENSE
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/LICENSE	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/LICENSE	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,11 @@
+License Disclaimer:
+
+All contents of this directory are Copyright (c) the Dojo Foundation, with the
+following exceptions:
+-------------------------------------------------------------------------------
+
+MD5.js, SHA1.js:
+	* Copyright 1998-2005, Paul Johnstone
+	  Distributed under the terms of the BSD License
+
+

Added: tags/parley-0.55/root/static/magic/src/crypto/MD5.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/MD5.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/MD5.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,198 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.crypto&quot;);
+dojo.provide(&quot;dojo.crypto.MD5&quot;);
+dojo.crypto.MD5 = new function () {
+	var chrsz = 8;
+	var mask = (1 &lt;&lt; chrsz) - 1;
+	function toWord(s) {
+		var wa = [];
+		for (var i = 0; i &lt; s.length * chrsz; i += chrsz) {
+			wa[i &gt;&gt; 5] |= (s.charCodeAt(i / chrsz) &amp; mask) &lt;&lt; (i % 32);
+		}
+		return wa;
+	}
+	function toString(wa) {
+		var s = [];
+		for (var i = 0; i &lt; wa.length * 32; i += chrsz) {
+			s.push(String.fromCharCode((wa[i &gt;&gt; 5] &gt;&gt;&gt; (i % 32)) &amp; mask));
+		}
+		return s.join(&quot;&quot;);
+	}
+	function toHex(wa) {
+		var h = &quot;0123456789abcdef&quot;;
+		var s = [];
+		for (var i = 0; i &lt; wa.length * 4; i++) {
+			s.push(h.charAt((wa[i &gt;&gt; 2] &gt;&gt; ((i % 4) * 8 + 4)) &amp; 15) + h.charAt((wa[i &gt;&gt; 2] &gt;&gt; ((i % 4) * 8)) &amp; 15));
+		}
+		return s.join(&quot;&quot;);
+	}
+	function toBase64(wa) {
+		var p = &quot;=&quot;;
+		var tab = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;
+		var s = [];
+		for (var i = 0; i &lt; wa.length * 4; i += 3) {
+			var t = (((wa[i &gt;&gt; 2] &gt;&gt; 8 * (i % 4)) &amp; 255) &lt;&lt; 16) | (((wa[i + 1 &gt;&gt; 2] &gt;&gt; 8 * ((i + 1) % 4)) &amp; 255) &lt;&lt; 8) | ((wa[i + 2 &gt;&gt; 2] &gt;&gt; 8 * ((i + 2) % 4)) &amp; 255);
+			for (var j = 0; j &lt; 4; j++) {
+				if (i * 8 + j * 6 &gt; wa.length * 32) {
+					s.push(p);
+				} else {
+					s.push(tab.charAt((t &gt;&gt; 6 * (3 - j)) &amp; 63));
+				}
+			}
+		}
+		return s.join(&quot;&quot;);
+	}
+	function add(x, y) {
+		var l = (x &amp; 65535) + (y &amp; 65535);
+		var m = (x &gt;&gt; 16) + (y &gt;&gt; 16) + (l &gt;&gt; 16);
+		return (m &lt;&lt; 16) | (l &amp; 65535);
+	}
+	function R(n, c) {
+		return (n &lt;&lt; c) | (n &gt;&gt;&gt; (32 - c));
+	}
+	function C(q, a, b, x, s, t) {
+		return add(R(add(add(a, q), add(x, t)), s), b);
+	}
+	function FF(a, b, c, d, x, s, t) {
+		return C((b &amp; c) | ((~b) &amp; d), a, b, x, s, t);
+	}
+	function GG(a, b, c, d, x, s, t) {
+		return C((b &amp; d) | (c &amp; (~d)), a, b, x, s, t);
+	}
+	function HH(a, b, c, d, x, s, t) {
+		return C(b ^ c ^ d, a, b, x, s, t);
+	}
+	function II(a, b, c, d, x, s, t) {
+		return C(c ^ (b | (~d)), a, b, x, s, t);
+	}
+	function core(x, len) {
+		x[len &gt;&gt; 5] |= 128 &lt;&lt; ((len) % 32);
+		x[(((len + 64) &gt;&gt;&gt; 9) &lt;&lt; 4) + 14] = len;
+		var a = 1732584193;
+		var b = -271733879;
+		var c = -1732584194;
+		var d = 271733878;
+		for (var i = 0; i &lt; x.length; i += 16) {
+			var olda = a;
+			var oldb = b;
+			var oldc = c;
+			var oldd = d;
+			a = FF(a, b, c, d, x[i + 0], 7, -680876936);
+			d = FF(d, a, b, c, x[i + 1], 12, -389564586);
+			c = FF(c, d, a, b, x[i + 2], 17, 606105819);
+			b = FF(b, c, d, a, x[i + 3], 22, -1044525330);
+			a = FF(a, b, c, d, x[i + 4], 7, -176418897);
+			d = FF(d, a, b, c, x[i + 5], 12, 1200080426);
+			c = FF(c, d, a, b, x[i + 6], 17, -1473231341);
+			b = FF(b, c, d, a, x[i + 7], 22, -45705983);
+			a = FF(a, b, c, d, x[i + 8], 7, 1770035416);
+			d = FF(d, a, b, c, x[i + 9], 12, -1958414417);
+			c = FF(c, d, a, b, x[i + 10], 17, -42063);
+			b = FF(b, c, d, a, x[i + 11], 22, -1990404162);
+			a = FF(a, b, c, d, x[i + 12], 7, 1804603682);
+			d = FF(d, a, b, c, x[i + 13], 12, -40341101);
+			c = FF(c, d, a, b, x[i + 14], 17, -1502002290);
+			b = FF(b, c, d, a, x[i + 15], 22, 1236535329);
+			a = GG(a, b, c, d, x[i + 1], 5, -165796510);
+			d = GG(d, a, b, c, x[i + 6], 9, -1069501632);
+			c = GG(c, d, a, b, x[i + 11], 14, 643717713);
+			b = GG(b, c, d, a, x[i + 0], 20, -373897302);
+			a = GG(a, b, c, d, x[i + 5], 5, -701558691);
+			d = GG(d, a, b, c, x[i + 10], 9, 38016083);
+			c = GG(c, d, a, b, x[i + 15], 14, -660478335);
+			b = GG(b, c, d, a, x[i + 4], 20, -405537848);
+			a = GG(a, b, c, d, x[i + 9], 5, 568446438);
+			d = GG(d, a, b, c, x[i + 14], 9, -1019803690);
+			c = GG(c, d, a, b, x[i + 3], 14, -187363961);
+			b = GG(b, c, d, a, x[i + 8], 20, 1163531501);
+			a = GG(a, b, c, d, x[i + 13], 5, -1444681467);
+			d = GG(d, a, b, c, x[i + 2], 9, -51403784);
+			c = GG(c, d, a, b, x[i + 7], 14, 1735328473);
+			b = GG(b, c, d, a, x[i + 12], 20, -1926607734);
+			a = HH(a, b, c, d, x[i + 5], 4, -378558);
+			d = HH(d, a, b, c, x[i + 8], 11, -2022574463);
+			c = HH(c, d, a, b, x[i + 11], 16, 1839030562);
+			b = HH(b, c, d, a, x[i + 14], 23, -35309556);
+			a = HH(a, b, c, d, x[i + 1], 4, -1530992060);
+			d = HH(d, a, b, c, x[i + 4], 11, 1272893353);
+			c = HH(c, d, a, b, x[i + 7], 16, -155497632);
+			b = HH(b, c, d, a, x[i + 10], 23, -1094730640);
+			a = HH(a, b, c, d, x[i + 13], 4, 681279174);
+			d = HH(d, a, b, c, x[i + 0], 11, -358537222);
+			c = HH(c, d, a, b, x[i + 3], 16, -722521979);
+			b = HH(b, c, d, a, x[i + 6], 23, 76029189);
+			a = HH(a, b, c, d, x[i + 9], 4, -640364487);
+			d = HH(d, a, b, c, x[i + 12], 11, -421815835);
+			c = HH(c, d, a, b, x[i + 15], 16, 530742520);
+			b = HH(b, c, d, a, x[i + 2], 23, -995338651);
+			a = II(a, b, c, d, x[i + 0], 6, -198630844);
+			d = II(d, a, b, c, x[i + 7], 10, 1126891415);
+			c = II(c, d, a, b, x[i + 14], 15, -1416354905);
+			b = II(b, c, d, a, x[i + 5], 21, -57434055);
+			a = II(a, b, c, d, x[i + 12], 6, 1700485571);
+			d = II(d, a, b, c, x[i + 3], 10, -1894986606);
+			c = II(c, d, a, b, x[i + 10], 15, -1051523);
+			b = II(b, c, d, a, x[i + 1], 21, -2054922799);
+			a = II(a, b, c, d, x[i + 8], 6, 1873313359);
+			d = II(d, a, b, c, x[i + 15], 10, -30611744);
+			c = II(c, d, a, b, x[i + 6], 15, -1560198380);
+			b = II(b, c, d, a, x[i + 13], 21, 1309151649);
+			a = II(a, b, c, d, x[i + 4], 6, -145523070);
+			d = II(d, a, b, c, x[i + 11], 10, -1120210379);
+			c = II(c, d, a, b, x[i + 2], 15, 718787259);
+			b = II(b, c, d, a, x[i + 9], 21, -343485551);
+			a = add(a, olda);
+			b = add(b, oldb);
+			c = add(c, oldc);
+			d = add(d, oldd);
+		}
+		return [a, b, c, d];
+	}
+	function hmac(data, key) {
+		var wa = toWord(key);
+		if (wa.length &gt; 16) {
+			wa = core(wa, key.length * chrsz);
+		}
+		var l = [], r = [];
+		for (var i = 0; i &lt; 16; i++) {
+			l[i] = wa[i] ^ 909522486;
+			r[i] = wa[i] ^ 1549556828;
+		}
+		var h = core(l.concat(toWord(data)), 512 + data.length * chrsz);
+		return core(r.concat(h), 640);
+	}
+	this.compute = function (data, outputType) {
+		var out = outputType || dojo.crypto.outputTypes.Base64;
+		switch (out) {
+		  case dojo.crypto.outputTypes.Hex:
+			return toHex(core(toWord(data), data.length * chrsz));
+		  case dojo.crypto.outputTypes.String:
+			return toString(core(toWord(data), data.length * chrsz));
+		  default:
+			return toBase64(core(toWord(data), data.length * chrsz));
+		}
+	};
+	this.getHMAC = function (data, key, outputType) {
+		var out = outputType || dojo.crypto.outputTypes.Base64;
+		switch (out) {
+		  case dojo.crypto.outputTypes.Hex:
+			return toHex(hmac(data, key));
+		  case dojo.crypto.outputTypes.String:
+			return toString(hmac(data, key));
+		  default:
+			return toBase64(hmac(data, key));
+		}
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/crypto/Rijndael.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/Rijndael.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/Rijndael.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.crypto.Rijndael&quot;);
+dojo.require(&quot;dojo.crypto&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.crypto.Rijndael&quot;);
+dojo.crypto.Rijndael = new function () {
+	this.encrypt = function (plaintext, key) {
+	};
+	this.decrypt = function (ciphertext, key) {
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/crypto/SHA1.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/SHA1.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/SHA1.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,171 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.crypto&quot;);
+dojo.provide(&quot;dojo.crypto.SHA1&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.crypto.SHA1&quot;);
+dojo.crypto.SHA1 = new function () {
+	var chrsz = 8;
+	var mask = (1 &lt;&lt; chrsz) - 1;
+	function toWord(s) {
+		var wa = [];
+		for (var i = 0; i &lt; s.length * chrsz; i += chrsz) {
+			wa[i &gt;&gt; 5] |= (s.charCodeAt(i / chrsz) &amp; mask) &lt;&lt; (i % 32);
+		}
+		return wa;
+	}
+	function toString(wa) {
+		var s = [];
+		for (var i = 0; i &lt; wa.length * 32; i += chrsz) {
+			s.push(String.fromCharCode((wa[i &gt;&gt; 5] &gt;&gt;&gt; (i % 32)) &amp; mask));
+		}
+		return s.join(&quot;&quot;);
+	}
+	function toHex(wa) {
+		var h = &quot;0123456789abcdef&quot;;
+		var s = [];
+		for (var i = 0; i &lt; wa.length * 4; i++) {
+			s.push(h.charAt((wa[i &gt;&gt; 2] &gt;&gt; ((i % 4) * 8 + 4)) &amp; 15) + h.charAt((wa[i &gt;&gt; 2] &gt;&gt; ((i % 4) * 8)) &amp; 15));
+		}
+		return s.join(&quot;&quot;);
+	}
+	function toBase64(wa) {
+		var p = &quot;=&quot;;
+		var tab = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/&quot;;
+		var s = [];
+		for (var i = 0; i &lt; wa.length * 4; i += 3) {
+			var t = (((wa[i &gt;&gt; 2] &gt;&gt; 8 * (i % 4)) &amp; 255) &lt;&lt; 16) | (((wa[i + 1 &gt;&gt; 2] &gt;&gt; 8 * ((i + 1) % 4)) &amp; 255) &lt;&lt; 8) | ((wa[i + 2 &gt;&gt; 2] &gt;&gt; 8 * ((i + 2) % 4)) &amp; 255);
+			for (var j = 0; j &lt; 4; j++) {
+				if (i * 8 + j * 6 &gt; wa.length * 32) {
+					s.push(p);
+				} else {
+					s.push(tab.charAt((t &gt;&gt; 6 * (3 - j)) &amp; 63));
+				}
+			}
+		}
+		return s.join(&quot;&quot;);
+	}
+	function add(x, y) {
+		var l = (x &amp; 65535) + (y &amp; 65535);
+		var m = (x &gt;&gt; 16) + (y &gt;&gt; 16) + (l &gt;&gt; 16);
+		return (m &lt;&lt; 16) | (l &amp; 65535);
+	}
+	function r(x, n) {
+		return (x &lt;&lt; n) | (x &gt;&gt;&gt; (32 - n));
+	}
+	function f(u, v, w) {
+		return ((u &amp; v) | (~u &amp; w));
+	}
+	function g(u, v, w) {
+		return ((u &amp; v) | (u &amp; w) | (v &amp; w));
+	}
+	function h(u, v, w) {
+		return (u ^ v ^ w);
+	}
+	function fn(i, u, v, w) {
+		if (i &lt; 20) {
+			return f(u, v, w);
+		}
+		if (i &lt; 40) {
+			return h(u, v, w);
+		}
+		if (i &lt; 60) {
+			return g(u, v, w);
+		}
+		return h(u, v, w);
+	}
+	function cnst(i) {
+		if (i &lt; 20) {
+			return 1518500249;
+		}
+		if (i &lt; 40) {
+			return 1859775393;
+		}
+		if (i &lt; 60) {
+			return -1894007588;
+		}
+		return -899497514;
+	}
+	function core(x, len) {
+		x[len &gt;&gt; 5] |= 128 &lt;&lt; (24 - len % 32);
+		x[((len + 64 &gt;&gt; 9) &lt;&lt; 4) + 15] = len;
+		var w = [];
+		var a = 1732584193;
+		var b = -271733879;
+		var c = -1732584194;
+		var d = 271733878;
+		var e = -1009589776;
+		for (var i = 0; i &lt; x.length; i += 16) {
+			var olda = a;
+			var oldb = b;
+			var oldc = c;
+			var oldd = d;
+			var olde = e;
+			for (var j = 0; j &lt; 80; j++) {
+				if (j &lt; 16) {
+					w[j] = x[i + j];
+				} else {
+					w[j] = r(w[j - 3] ^ w[j - 8] ^ w[j - 14] ^ w[j - 16], 1);
+				}
+				var t = add(add(r(a, 5), fn(j, b, c, d)), add(add(e, w[j]), cnst(j)));
+				e = d;
+				d = c;
+				c = r(b, 30);
+				b = a;
+				a = t;
+			}
+			a = add(a, olda);
+			b = add(b, oldb);
+			c = add(c, oldc);
+			d = add(d, oldd);
+			e = add(e, olde);
+		}
+		return [a, b, c, d, e];
+	}
+	function hmac(data, key) {
+		var wa = toWord(key);
+		if (wa.length &gt; 16) {
+			wa = core(wa, key.length * chrsz);
+		}
+		var l = [], r = [];
+		for (var i = 0; i &lt; 16; i++) {
+			l[i] = wa[i] ^ 909522486;
+			r[i] = wa[i] ^ 1549556828;
+		}
+		var h = core(l.concat(toWord(data)), 512 + data.length * chrsz);
+		return core(r.concat(h), 640);
+	}
+	this.compute = function (data, outputType) {
+		var out = outputType || dojo.crypto.outputTypes.Base64;
+		switch (out) {
+		  case dojo.crypto.outputTypes.Hex:
+			return toHex(core(toWord(data), data.length * chrsz));
+		  case dojo.crypto.outputTypes.String:
+			return toString(core(toWord(data), data.length * chrsz));
+		  default:
+			return toBase64(core(toWord(data), data.length * chrsz));
+		}
+	};
+	this.getHMAC = function (data, key, outputType) {
+		var out = outputType || dojo.crypto.outputTypes.Base64;
+		switch (out) {
+		  case dojo.crypto.outputTypes.Hex:
+			return toHex(hmac(data, key));
+		  case dojo.crypto.outputTypes.String:
+			return toString(hmac(data, key));
+		  default:
+			return toBase64(hmac(data, key));
+		}
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/crypto/SHA256.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/SHA256.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/SHA256.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,21 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.crypto.SHA256&quot;);
+dojo.require(&quot;dojo.crypto&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.crypto.SHA256&quot;);
+dojo.crypto.SHA256 = new function () {
+	this.compute = function (s) {
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/crypto/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.crypto&quot;, &quot;dojo.crypto.MD5&quot;]});
+dojo.provide(&quot;dojo.crypto.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/crypto.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/crypto.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/crypto.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.crypto&quot;);
+dojo.crypto.cipherModes = {ECB:0, CBC:1, PCBC:2, CFB:3, OFB:4, CTR:5};
+dojo.crypto.outputTypes = {Base64:0, Hex:1, String:2, Raw:3};
+

Added: tags/parley-0.55/root/static/magic/src/data/CsvStore.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/CsvStore.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/CsvStore.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,115 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.CsvStore&quot;);
+dojo.require(&quot;dojo.data.core.RemoteStore&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.declare(&quot;dojo.data.CsvStore&quot;, dojo.data.core.RemoteStore, {_setupQueryRequest:function (result, requestKw) {
+	var serverQueryUrl = this._serverQueryUrl ? this._serverQueryUrl : &quot;&quot;;
+	var queryUrl = result.query ? result.query : &quot;&quot;;
+	requestKw.url = serverQueryUrl + queryUrl;
+	requestKw.method = &quot;get&quot;;
+}, _resultToQueryData:function (serverResponseData) {
+	var csvFileContentString = serverResponseData;
+	var arrayOfArrays = this._getArrayOfArraysFromCsvFileContents(csvFileContentString);
+	var arrayOfObjects = this._getArrayOfObjectsFromArrayOfArrays(arrayOfArrays);
+	var remoteStoreData = this._getRemoteStoreDataFromArrayOfObjects(arrayOfObjects);
+	return remoteStoreData;
+}, _setupSaveRequest:function (saveKeywordArgs, requestKw) {
+}, _getArrayOfArraysFromCsvFileContents:function (csvFileContents) {
+	dojo.lang.assertType(csvFileContents, String);
+	var lineEndingCharacters = new RegExp(&quot;\r\n|\n|\r&quot;);
+	var leadingWhiteSpaceCharacters = new RegExp(&quot;^\\s+&quot;, &quot;g&quot;);
+	var trailingWhiteSpaceCharacters = new RegExp(&quot;\\s+$&quot;, &quot;g&quot;);
+	var doubleQuotes = new RegExp(&quot;\&quot;\&quot;&quot;, &quot;g&quot;);
+	var arrayOfOutputRecords = [];
+	var arrayOfInputLines = csvFileContents.split(lineEndingCharacters);
+	for (var i in arrayOfInputLines) {
+		var singleLine = arrayOfInputLines[i];
+		if (singleLine.length &gt; 0) {
+			var listOfFields = singleLine.split(&quot;,&quot;);
+			var j = 0;
+			while (j &lt; listOfFields.length) {
+				var space_field_space = listOfFields[j];
+				var field_space = space_field_space.replace(leadingWhiteSpaceCharacters, &quot;&quot;);
+				var field = field_space.replace(trailingWhiteSpaceCharacters, &quot;&quot;);
+				var firstChar = field.charAt(0);
+				var lastChar = field.charAt(field.length - 1);
+				var secondToLastChar = field.charAt(field.length - 2);
+				var thirdToLastChar = field.charAt(field.length - 3);
+				if ((firstChar == &quot;\&quot;&quot;) &amp;&amp; ((lastChar != &quot;\&quot;&quot;) || ((lastChar == &quot;\&quot;&quot;) &amp;&amp; (secondToLastChar == &quot;\&quot;&quot;) &amp;&amp; (thirdToLastChar != &quot;\&quot;&quot;)))) {
+					if (j + 1 === listOfFields.length) {
+						return null;
+					}
+					var nextField = listOfFields[j + 1];
+					listOfFields[j] = field_space + &quot;,&quot; + nextField;
+					listOfFields.splice(j + 1, 1);
+				} else {
+					if ((firstChar == &quot;\&quot;&quot;) &amp;&amp; (lastChar == &quot;\&quot;&quot;)) {
+						field = field.slice(1, (field.length - 1));
+						field = field.replace(doubleQuotes, &quot;\&quot;&quot;);
+					}
+					listOfFields[j] = field;
+					j += 1;
+				}
+			}
+			arrayOfOutputRecords.push(listOfFields);
+		}
+	}
+	return arrayOfOutputRecords;
+}, _getArrayOfObjectsFromArrayOfArrays:function (arrayOfArrays) {
+	dojo.lang.assertType(arrayOfArrays, Array);
+	var arrayOfItems = [];
+	if (arrayOfArrays.length &gt; 1) {
+		var arrayOfKeys = arrayOfArrays[0];
+		for (var i = 1; i &lt; arrayOfArrays.length; ++i) {
+			var row = arrayOfArrays[i];
+			var item = {};
+			for (var j in row) {
+				var value = row[j];
+				var key = arrayOfKeys[j];
+				item[key] = value;
+			}
+			arrayOfItems.push(item);
+		}
+	}
+	return arrayOfItems;
+}, _getRemoteStoreDataFromArrayOfObjects:function (arrayOfObjects) {
+	dojo.lang.assertType(arrayOfObjects, Array);
+	var output = {};
+	for (var i = 0; i &lt; arrayOfObjects.length; ++i) {
+		var object = arrayOfObjects[i];
+		for (var key in object) {
+			var value = object[key];
+			object[key] = [value];
+		}
+		output[i] = object;
+	}
+	return output;
+}, newItem:function (attributes, keywordArgs) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.newItem&quot;);
+}, deleteItem:function (item) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.deleteItem&quot;);
+}, setValues:function (item, attribute, values) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.setValues&quot;);
+}, set:function (item, attribute, value) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.set&quot;);
+}, unsetAttribute:function (item, attribute) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.unsetAttribute&quot;);
+}, save:function (keywordArgs) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.save&quot;);
+}, revert:function () {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.revert&quot;);
+}, isDirty:function (item) {
+	dojo.unimplemented(&quot;dojo.data.CsvStore.isDirty&quot;);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/OpmlStore.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/OpmlStore.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/OpmlStore.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,166 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.OpmlStore&quot;);
+dojo.require(&quot;dojo.data.core.Read&quot;);
+dojo.require(&quot;dojo.data.core.Result&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.data.OpmlStore&quot;);
+dojo.declare(&quot;dojo.data.OpmlStore&quot;, dojo.data.core.Read, {initializer:function (keywordParameters) {
+	this._arrayOfTopLevelItems = [];
+	this._metadataNodes = null;
+	this._loadFinished = false;
+	this._opmlFileUrl = keywordParameters[&quot;url&quot;];
+}, _assertIsItem:function (item) {
+	if (!this.isItem(item)) {
+		throw new Error(&quot;dojo.data.OpmlStore: a function was passed an item argument that was not an item&quot;);
+	}
+}, _removeChildNodesThatAreNotElementNodes:function (node, recursive) {
+	var childNodes = node.childNodes;
+	if (childNodes.length == 0) {
+		return;
+	}
+	var nodesToRemove = [];
+	var i, childNode;
+	for (i = 0; i &lt; childNodes.length; ++i) {
+		childNode = childNodes[i];
+		if (childNode.nodeType != Node.ELEMENT_NODE) {
+			nodesToRemove.push(childNode);
+		}
+	}
+	for (i = 0; i &lt; nodesToRemove.length; ++i) {
+		childNode = nodesToRemove[i];
+		node.removeChild(childNode);
+	}
+	if (recursive) {
+		for (i = 0; i &lt; childNodes.length; ++i) {
+			childNode = childNodes[i];
+			this._removeChildNodesThatAreNotElementNodes(childNode, recursive);
+		}
+	}
+}, _processRawXmlTree:function (rawXmlTree) {
+	var headNodes = rawXmlTree.getElementsByTagName(&quot;head&quot;);
+	var headNode = headNodes[0];
+	this._removeChildNodesThatAreNotElementNodes(headNode);
+	this._metadataNodes = headNode.childNodes;
+	var bodyNodes = rawXmlTree.getElementsByTagName(&quot;body&quot;);
+	var bodyNode = bodyNodes[0];
+	this._removeChildNodesThatAreNotElementNodes(bodyNode, true);
+	var bodyChildNodes = bodyNodes[0].childNodes;
+	for (var i = 0; i &lt; bodyChildNodes.length; ++i) {
+		var node = bodyChildNodes[i];
+		if (node.tagName == &quot;outline&quot;) {
+			this._arrayOfTopLevelItems.push(node);
+		}
+	}
+}, get:function (item, attribute, defaultValue) {
+	this._assertIsItem(item);
+	if (attribute == &quot;children&quot;) {
+		return (item.firstChild || defaultValue);
+	} else {
+		var value = item.getAttribute(attribute);
+		value = (value != undefined) ? value : defaultValue;
+		return value;
+	}
+}, getValues:function (item, attribute) {
+	this._assertIsItem(item);
+	if (attribute == &quot;children&quot;) {
+		var array = [];
+		for (var i = 0; i &lt; item.childNodes.length; ++i) {
+			array.push(item.childNodes[i]);
+		}
+		return array;
+	} else {
+		return [item.getAttribute(attribute)];
+	}
+}, getAttributes:function (item) {
+	this._assertIsItem(item);
+	var attributes = [];
+	var xmlNode = item;
+	var xmlAttributes = xmlNode.attributes;
+	for (var i = 0; i &lt; xmlAttributes.length; ++i) {
+		var xmlAttribute = xmlAttributes.item(i);
+		attributes.push(xmlAttribute.nodeName);
+	}
+	if (xmlNode.childNodes.length &gt; 0) {
+		attributes.push(&quot;children&quot;);
+	}
+	return attributes;
+}, hasAttribute:function (item, attribute) {
+	return (this.getValues(item, attribute).length &gt; 0);
+}, containsValue:function (item, attribute, value) {
+	var values = this.getValues(item, attribute);
+	for (var i = 0; i &lt; values.length; ++i) {
+		var possibleValue = values[i];
+		if (value == possibleValue) {
+			return true;
+		}
+	}
+	return false;
+}, isItem:function (something) {
+	return (something &amp;&amp; something.nodeType == Node.ELEMENT_NODE &amp;&amp; something.tagName == &quot;outline&quot;);
+}, isItemAvailable:function (something) {
+	return this.isItem(something);
+}, find:function (keywordArgs) {
+	var result = null;
+	if (keywordArgs instanceof dojo.data.core.Result) {
+		result = keywordArgs;
+		result.store = this;
+	} else {
+		result = new dojo.data.core.Result(keywordArgs, this);
+	}
+	var self = this;
+	var bindHandler = function (type, data, evt) {
+		var scope = result.scope || dj_global;
+		if (type == &quot;load&quot;) {
+			self._processRawXmlTree(data);
+			if (result.saveResult) {
+				result.items = self._arrayOfTopLevelItems;
+			}
+			if (result.onbegin) {
+				result.onbegin.call(scope, result);
+			}
+			for (var i = 0; i &lt; self._arrayOfTopLevelItems.length; i++) {
+				var item = self._arrayOfTopLevelItems[i];
+				if (result.onnext &amp;&amp; !result._aborted) {
+					result.onnext.call(scope, item, result);
+				}
+			}
+			if (result.oncompleted &amp;&amp; !result._aborted) {
+				result.oncompleted.call(scope, result);
+			}
+		} else {
+			if (type == &quot;error&quot; || type == &quot;timeout&quot;) {
+				var errorObject = data;
+				if (result.onerror) {
+					result.onerror.call(scope, data);
+				}
+			}
+		}
+	};
+	if (!this._loadFinished) {
+		if (this._opmlFileUrl) {
+			var bindRequest = dojo.io.bind({url:this._opmlFileUrl, handle:bindHandler, mimetype:&quot;text/xml&quot;, sync:(result.sync || false)});
+			result._abortFunc = bindRequest.abort;
+		}
+	}
+	return result;
+}, getIdentity:function (item) {
+	dojo.unimplemented(&quot;dojo.data.OpmlStore.getIdentity()&quot;);
+	return null;
+}, findByIdentity:function (identity) {
+	dojo.unimplemented(&quot;dojo.data.OpmlStore.findByIdentity()&quot;);
+	return null;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/RdfStore.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/RdfStore.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/RdfStore.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,185 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.RdfStore&quot;);
+dojo.provide(&quot;dojo.data.RhizomeStore&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.data.core.RemoteStore&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.data.RdfDatatypeSerializer = function (type, convertFunc, uri) {
+	this.type = type;
+	this._converter = convertFunc;
+	this.uri = uri;
+	this.serialize = function (value) {
+		return this._converter.call(value, value);
+	};
+};
+dojo.declare(&quot;dojo.data.RdfStore&quot;, dojo.data.core.RemoteStore, {_datatypeMap:{literal:function (value) {
+	var literal = value.value;
+	if (value[&quot;xml:lang&quot;]) {
+		literal.lang = value[&quot;xml:lang&quot;];
+	}
+	return literal;
+}, uri:function (value) {
+	return {id:value.value};
+}, bnode:function (value) {
+	return {id:&quot;_:&quot; + value.value};
+}, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#int">http://www.w3.org/2001/XMLSchema#int</A>&quot;:function (value) {
+	return parseInt(value.value);
+}, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#integer">http://www.w3.org/2001/XMLSchema#integer</A>&quot;:function (value) {
+	return parseInt(value.value);
+}, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#long">http://www.w3.org/2001/XMLSchema#long</A>&quot;:function (value) {
+	return parseInt(value.value);
+}, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#float">http://www.w3.org/2001/XMLSchema#float</A>&quot;:function (value) {
+	return parseFloat(value.value);
+}, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#double">http://www.w3.org/2001/XMLSchema#double</A>&quot;:function (value) {
+	return parseFloat(value.value);
+}, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#boolean">http://www.w3.org/2001/XMLSchema#boolean</A>&quot;:function (value) {
+	return !value || value == &quot;false&quot; || value == &quot;0&quot; ? false : true;
+}}, _datatypeSerializers:[new dojo.data.RdfDatatypeSerializer(Number, Number.toString, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#float">http://www.w3.org/2001/XMLSchema#float</A>&quot;), new dojo.data.RdfDatatypeSerializer(Boolean, Boolean.toString, &quot;<A HREF="http://www.w3.org/2001/XMLSchema#boolean">http://www.w3.org/2001/XMLSchema#boolean</A>&quot;)], _findDatatypeSerializer:function (value) {
+	var length = this._datatypeSerializers.length;
+	for (var i = 0; i &lt; length; i++) {
+		var datatype = this._datatypeSerializers[i];
+		if (value instanceof datatype.type) {
+			return datatype;
+		}
+	}
+}, _toRDFValue:function (value) {
+	var rdfvalue = {};
+	if (value.id) {
+		if (value.id.slice(0, 2) == &quot;_:&quot;) {
+			rdfvalue.type = &quot;bnode&quot;;
+			rdfvalue.value = value.id.substring(2);
+		} else {
+			rdfvalue.type = &quot;uri&quot;;
+			rdfvalue.value = value.id;
+		}
+	} else {
+		if (typeof value == &quot;string&quot; || value instanceof String) {
+			rdfvalue.type = &quot;literal&quot;;
+			rdfvalue.value = value;
+			if (value.lang) {
+				rdfvalue[&quot;xml:lang&quot;] = value.lang;
+			}
+		} else {
+			if (typeof value == &quot;number&quot;) {
+				value = new Number(value);
+			} else {
+				if (typeof value == &quot;boolean&quot;) {
+					value = new Boolean(value);
+				}
+			}
+			var datatype = this._findDatatypeSerializer(value);
+			if (datatype) {
+				rdfvalue = {&quot;type&quot;:&quot;typed-literal&quot;, &quot;datatype&quot;:datatype.uri, &quot;value&quot;:value.toString()};
+			} else {
+				rdfvalue = {&quot;type&quot;:&quot;literal&quot;, &quot;value&quot;:value.toString()};
+			}
+		}
+	}
+	return rdfvalue;
+}, _setupSaveRequest:function (saveKeywordArgs, requestKw) {
+	var rdfResult = {&quot;head&quot;:{&quot;vars&quot;:[&quot;s&quot;, &quot;p&quot;, &quot;o&quot;]}, &quot;results&quot;:{&quot;bindings&quot;:[]}};
+	var resources = [];
+	for (var key in this._deleted) {
+		resources.push(key);
+	}
+	rdfResult.results.deleted = resources;
+	for (key in this._changed) {
+		var subject = this._toRDFValue(this.getIdentity(key));
+		var attributes = this._changed[key];
+		for (var attr in attributes) {
+			var predicate = {type:&quot;uri&quot;, value:attr};
+			var values = attributes[attr];
+			if (!values.length) {
+				continue;
+			}
+			var rdfvalues = [];
+			for (var i = 0; i &lt; values.length; i++) {
+				var rdfvalue = this._toRDFValue(values[i]);
+				rdfResult.results.bindings.push({s:subject, p:predicate, o:rdfvalue});
+			}
+		}
+	}
+	var oldRegistry = dojo.json.jsonRegistry;
+	dojo.json.jsonRegistry = this._jsonRegistry;
+	var jsonString = dojo.json.serialize(rdfResult);
+	dojo.json.jsonRegistry = oldRegistry;
+	requestKw.postContent = jsonString;
+}, _resultToQueryMetadata:function (json) {
+	return json.head;
+}, _resultToQueryData:function (json) {
+	var items = {};
+	var stmts = json.results.bindings;
+	for (var i = 0; i &lt; stmts.length; i++) {
+		var stmt = stmts[i];
+		var subject = stmt.s.value;
+		if (stmt.s.type == &quot;bnode&quot;) {
+			subject = &quot;_:&quot; + subject;
+		}
+		var attributes = data[subject];
+		if (!attributes) {
+			attributes = {};
+			data[stmt.s] = attributes;
+		}
+		var attr = attributes[stmt.p.value];
+		if (!attr) {
+			attributes[stmt.p.value] = [stmt.o];
+		} else {
+			attr.push(stmt.o);
+		}
+	}
+	return items;
+}});
+dojo.declare(&quot;dojo.data.RhizomeStore&quot;, dojo.data.RdfStore, {initializer:function (kwArgs) {
+	this._serverQueryUrl = kwArgs.baseUrl + &quot;search?view=json&amp;searchType=RxPath&amp;search=&quot;;
+	this._serverSaveUrl = kwArgs.baseUrl + &quot;save-metadata&quot;;
+}, _resultToQueryMetadata:function (json) {
+	return json;
+}, _resultToQueryData:function (json) {
+	return json;
+}, _setupSaveRequest:function (saveKeywordArgs, requestKw) {
+	requestKw.url = this._serverSaveUrl;
+	requestKw.method = &quot;post&quot;;
+	requestKw.mimetype = &quot;text/plain&quot;;
+	var resources = [];
+	for (var key in this._deleted) {
+		resources.push(key);
+	}
+	var changes = {};
+	for (key in this._changed) {
+		if (!this._added[key]) {
+			resources.push(key);
+		}
+		var attributes = this._changed[key];
+		var rdfattributes = {};
+		for (var attr in attributes) {
+			var values = attributes[attr];
+			if (!values.length) {
+				continue;
+			}
+			var rdfvalues = [];
+			for (var i = 0; i &lt; values.length; i++) {
+				var rdfvalue = this._toRDFValue(values[i]);
+				rdfvalues.push(rdfvalue);
+			}
+			rdfattributes[attr] = rdfvalues;
+		}
+		changes[key] = rdfattributes;
+	}
+	var oldRegistry = dojo.json.jsonRegistry;
+	dojo.json.jsonRegistry = this._jsonRegistry;
+	var jsonString = dojo.json.serialize(changes);
+	dojo.json.jsonRegistry = oldRegistry;
+	requestKw.content = {rdfFormat:&quot;json&quot;, resource:resources, metadata:jsonString};
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/YahooStore.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/YahooStore.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/YahooStore.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,44 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.YahooStore&quot;);
+dojo.require(&quot;dojo.data.core.RemoteStore&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.io.ScriptSrcIO&quot;);
+dojo.declare(&quot;dojo.data.YahooStore&quot;, dojo.data.core.RemoteStore, {_setupQueryRequest:function (result, requestKw) {
+	var start = 1;
+	var count = 1;
+	if (result) {
+		start = result.start || start;
+		count = result.count || count;
+	}
+	var sourceUrl = &quot;<A HREF="http://api.search.yahoo.com/WebSearchService/V1/webSearch?appid=dojo&amp;language=en&amp;query=">http://api.search.yahoo.com/WebSearchService/V1/webSearch?appid=dojo&amp;language=en&amp;query=</A>&quot; + result.query + &quot;&amp;start=&quot; + start + &quot;&amp;results=&quot; + count + &quot;&amp;output=json&quot;;
+	requestKw.url = sourceUrl;
+	requestKw.transport = &quot;ScriptSrcTransport&quot;;
+	requestKw.mimetype = &quot;text/json&quot;;
+	requestKw.jsonParamName = &quot;callback&quot;;
+}, _resultToQueryMetadata:function (json) {
+	return json.ResultSet;
+}, _resultToQueryData:function (json) {
+	var data = {};
+	for (var i = 0; i &lt; json.ResultSet.totalResultsReturned; ++i) {
+		var record = json.ResultSet.Result[i];
+		var item = {};
+		item[&quot;Url&quot;] = [record.Url];
+		item[&quot;Title&quot;] = [record.Title];
+		item[&quot;Summary&quot;] = [record.Summary];
+		var arrayIndex = (json.ResultSet.firstResultPosition - 1) + i;
+		data[arrayIndex.toString()] = item;
+	}
+	return data;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/core/Read.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/core/Read.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/core/Read.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,55 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.core.Read&quot;);
+dojo.require(&quot;dojo.data.core.Result&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.data.core.Read&quot;);
+dojo.declare(&quot;dojo.data.core.Read&quot;, null, {get:function (item, attribute, defaultValue) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.get&quot;);
+	var attributeValue = null;
+	return attributeValue;
+}, getValues:function (item, attribute) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.getValues&quot;);
+	var array = null;
+	return array;
+}, getAttributes:function (item) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.getAttributes&quot;);
+	var array = null;
+	return array;
+}, hasAttribute:function (item, attribute) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.hasAttribute&quot;);
+	return false;
+}, containsValue:function (item, attribute, value) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.containsValue&quot;);
+	return false;
+}, isItem:function (something) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.isItem&quot;);
+	return false;
+}, isItemAvailable:function (something) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.isItemAvailable&quot;);
+	return false;
+}, find:function (keywordArgs) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.find&quot;);
+	var result = null;
+	return result;
+}, getIdentity:function (item) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.getIdentity&quot;);
+	var itemIdentifyString = null;
+	return itemIdentifyString;
+}, findByIdentity:function (identity) {
+	dojo.unimplemented(&quot;dojo.data.core.Read.getByIdentity&quot;);
+	var item = null;
+	return item;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/core/RemoteStore.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/core/RemoteStore.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/core/RemoteStore.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,354 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.core.RemoteStore&quot;);
+dojo.require(&quot;dojo.data.core.Read&quot;);
+dojo.require(&quot;dojo.data.core.Write&quot;);
+dojo.require(&quot;dojo.data.core.Result&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.experimental(&quot;dojo.data.core.RemoteStore&quot;);
+dojo.lang.declare(&quot;dojo.data.core.RemoteStore&quot;, [dojo.data.core.Read, dojo.data.core.Write], {_datatypeMap:{}, _jsonRegistry:dojo.json.jsonRegistry, initializer:function (kwArgs) {
+	if (!kwArgs) {
+		kwArgs = {};
+	}
+	this._serverQueryUrl = kwArgs.queryUrl || &quot;&quot;;
+	this._serverSaveUrl = kwArgs.saveUrl || &quot;&quot;;
+	this._deleted = {};
+	this._changed = {};
+	this._added = {};
+	this._results = {};
+	this._data = {};
+	this._numItems = 0;
+}, _setupQueryRequest:function (result, requestKw) {
+	result.query = result.query || &quot;&quot;;
+	requestKw.url = this._serverQueryUrl + encodeURIComponent(result.query);
+	requestKw.method = &quot;get&quot;;
+	requestKw.mimetype = &quot;text/json&quot;;
+}, _resultToQueryMetadata:function (serverResponseData) {
+	return serverResponseData;
+}, _resultToQueryData:function (serverResponseData) {
+	return serverResponseData.data;
+}, _remoteToLocalValues:function (attributes) {
+	for (var key in attributes) {
+		var values = attributes[key];
+		for (var i = 0; i &lt; values.length; i++) {
+			var value = values[i];
+			var type = value.datatype || value.type;
+			if (type) {
+				var localValue = value.value;
+				if (this._datatypeMap[type]) {
+					localValue = this._datatypeMap[type](value);
+				}
+				values[i] = localValue;
+			}
+		}
+	}
+	return attributes;
+}, _queryToQueryKey:function (query) {
+	if (typeof query == &quot;string&quot;) {
+		return query;
+	} else {
+		return dojo.json.serialize(query);
+	}
+}, _assertIsItem:function (item) {
+	if (!this.isItem(item)) {
+		throw new Error(&quot;dojo.data.RemoteStore: a function was passed an item argument that was not an item&quot;);
+	}
+}, get:function (item, attribute, defaultValue) {
+	var valueArray = this.getValues(item, attribute);
+	if (valueArray.length == 0) {
+		return defaultValue;
+	}
+	return valueArray[0];
+}, getValues:function (item, attribute) {
+	var itemIdentity = this.getIdentity(item);
+	this._assertIsItem(itemIdentity);
+	var changes = this._changed[itemIdentity];
+	if (changes) {
+		var newvalues = changes[attribute];
+		if (newvalues !== undefined) {
+			return newvalues;
+		} else {
+			return [];
+		}
+	}
+	return this._data[itemIdentity][0][attribute];
+}, getAttributes:function (item) {
+	var itemIdentity = this.getIdentity(item);
+	if (!itemIdentity) {
+		return undefined;
+	}
+	var atts = [];
+	var attrDict = this._data[itemIdentity][0];
+	for (var att in attrDict) {
+		atts.push(att);
+	}
+	return atts;
+}, hasAttribute:function (item, attribute) {
+	var valueArray = this.getValues(item, attribute);
+	return valueArray.length ? true : false;
+}, containsValue:function (item, attribute, value) {
+	var valueArray = this.getValues(item, attribute);
+	for (var i = 0; i &lt; valueArray.length; i++) {
+		if (valueArray[i] == value) {
+			return true;
+		}
+	}
+	return false;
+}, isItem:function (something) {
+	if (!something) {
+		return false;
+	}
+	var itemIdentity = something;
+	if (this._deleted[itemIdentity]) {
+		return false;
+	}
+	if (this._data[itemIdentity]) {
+		return true;
+	}
+	if (this._added[itemIdentity]) {
+		return true;
+	}
+	return false;
+}, find:function (keywordArgs) {
+	var result = null;
+	if (keywordArgs instanceof dojo.data.core.Result) {
+		result = keywordArgs;
+		result.store = this;
+	} else {
+		result = new dojo.data.core.Result(keywordArgs, this);
+	}
+	var query = result.query;
+	var self = this;
+	var bindfunc = function (type, data, evt) {
+		var scope = result.scope || dj_global;
+		if (type == &quot;load&quot;) {
+			result.resultMetadata = self._resultToQueryMetadata(data);
+			var dataDict = self._resultToQueryData(data);
+			if (result.onbegin) {
+				result.onbegin.call(scope, result);
+			}
+			var count = 0;
+			var resultData = [];
+			var newItemCount = 0;
+			for (var key in dataDict) {
+				if (result._aborted) {
+					break;
+				}
+				if (!self._deleted[key]) {
+					var values = dataDict[key];
+					var attributeDict = self._remoteToLocalValues(values);
+					var existingValue = self._data[key];
+					var refCount = 1;
+					if (existingValue) {
+						refCount = ++existingValue[1];
+					} else {
+						newItemCount++;
+					}
+					self._data[key] = [attributeDict, refCount];
+					resultData.push(key);
+					count++;
+					if (result.onnext) {
+						result.onnext.call(scope, key, result);
+					}
+				}
+			}
+			self._results[self._queryToQueryKey(query)] = resultData;
+			self._numItems += newItemCount;
+			result.length = count;
+			if (result.saveResult) {
+				result.items = resultData;
+			}
+			if (!result._aborted &amp;&amp; result.oncompleted) {
+				result.oncompleted.call(scope, result);
+			}
+		} else {
+			if (type == &quot;error&quot; || type == &quot;timeout&quot;) {
+				dojo.debug(&quot;find error: &quot; + dojo.json.serialize(data));
+				if (result.onerror) {
+					result.onerror.call(scope, data);
+				}
+			}
+		}
+	};
+	var bindKw = keywordArgs.bindArgs || {};
+	bindKw.sync = result.sync;
+	bindKw.handle = bindfunc;
+	this._setupQueryRequest(result, bindKw);
+	var request = dojo.io.bind(bindKw);
+	result._abortFunc = request.abort;
+	return result;
+}, getIdentity:function (item) {
+	if (!this.isItem(item)) {
+		return null;
+	}
+	return (item.id ? item.id : item);
+}, newItem:function (attributes, keywordArgs) {
+	var itemIdentity = keywordArgs[&quot;identity&quot;];
+	if (this._deleted[itemIdentity]) {
+		delete this._deleted[itemIdentity];
+	} else {
+		this._added[itemIdentity] = 1;
+	}
+	if (attributes) {
+		for (var attribute in attributes) {
+			var valueOrArrayOfValues = attributes[attribute];
+			if (dojo.lang.isArray(valueOrArrayOfValues)) {
+				this.setValues(itemIdentity, attribute, valueOrArrayOfValues);
+			} else {
+				this.set(itemIdentity, attribute, valueOrArrayOfValues);
+			}
+		}
+	}
+	return {id:itemIdentity};
+}, deleteItem:function (item) {
+	var identity = this.getIdentity(item);
+	if (!identity) {
+		return false;
+	}
+	if (this._added[identity]) {
+		delete this._added[identity];
+	} else {
+		this._deleted[identity] = 1;
+	}
+	if (this._changed[identity]) {
+		delete this._changed[identity];
+	}
+	return true;
+}, setValues:function (item, attribute, values) {
+	var identity = this.getIdentity(item);
+	if (!identity) {
+		return undefined;
+	}
+	var changes = this._changed[identity];
+	if (!changes) {
+		changes = {};
+		this._changed[identity] = changes;
+	}
+	changes[attribute] = values;
+	return true;
+}, set:function (item, attribute, value) {
+	return this.setValues(item, attribute, [value]);
+}, unsetAttribute:function (item, attribute) {
+	return this.setValues(item, attribute, []);
+}, _initChanges:function () {
+	this._deleted = {};
+	this._changed = {};
+	this._added = {};
+}, _setupSaveRequest:function (saveKeywordArgs, requestKw) {
+	requestKw.url = this._serverSaveUrl;
+	requestKw.method = &quot;post&quot;;
+	requestKw.mimetype = &quot;text/plain&quot;;
+	var deleted = [];
+	for (var key in this._deleted) {
+		deleted.push(key);
+	}
+	var saveStruct = {&quot;changed&quot;:this._changed, &quot;deleted&quot;:deleted};
+	var oldRegistry = dojo.json.jsonRegistry;
+	dojo.json.jsonRegistry = this._jsonRegistry;
+	var jsonString = dojo.json.serialize(saveStruct);
+	dojo.json.jsonRegistry = oldRegistry;
+	requestKw.postContent = jsonString;
+}, save:function (keywordArgs) {
+	keywordArgs = keywordArgs || {};
+	var result = new dojo.Deferred();
+	var self = this;
+	var bindfunc = function (type, data, evt) {
+		if (type == &quot;load&quot;) {
+			if (result.fired == 1) {
+				return;
+			}
+			var key = null;
+			for (key in self._added) {
+				if (!self._data[key]) {
+					self._data[key] = [{}, 1];
+				}
+			}
+			for (key in self._changed) {
+				var existing = self._data[key];
+				var changes = self._changed[key];
+				if (existing) {
+					existing[0] = changes;
+				} else {
+					self._data[key] = [changes, 1];
+				}
+			}
+			for (key in self._deleted) {
+				if (self._data[key]) {
+					delete self._data[key];
+				}
+			}
+			self._initChanges();
+			result.callback(true);
+		} else {
+			if (type == &quot;error&quot; || type == &quot;timeout&quot;) {
+				result.errback(data);
+			}
+		}
+	};
+	var bindKw = {sync:keywordArgs[&quot;sync&quot;], handle:bindfunc};
+	this._setupSaveRequest(keywordArgs, bindKw);
+	var request = dojo.io.bind(bindKw);
+	result.canceller = function (deferred) {
+		request.abort();
+	};
+	return result;
+}, revert:function () {
+	this._initChanges();
+	return true;
+}, isDirty:function (item) {
+	if (item) {
+		var identity = item.id || item;
+		return this._deleted[identity] || this._changed[identity];
+	} else {
+		var key = null;
+		for (key in this._changed) {
+			return true;
+		}
+		for (key in this._deleted) {
+			return true;
+		}
+		for (key in this._added) {
+			return true;
+		}
+		return false;
+	}
+}, createReference:function (idstring) {
+	return {id:idstring};
+}, getSize:function () {
+	return this._numItems;
+}, forgetResults:function (query) {
+	var queryKey = this._queryToQueryKey(query);
+	var results = this._results[queryKey];
+	if (!results) {
+		return false;
+	}
+	var removed = 0;
+	for (var i = 0; i &lt; results.length; i++) {
+		var key = results[i];
+		var existingValue = this._data[key];
+		if (existingValue[1] &lt;= 1) {
+			delete this._data[key];
+			removed++;
+		} else {
+			existingValue[1] = --existingValue[1];
+		}
+	}
+	delete this._results[queryKey];
+	this._numItems -= removed;
+	return true;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/core/Result.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/core/Result.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/core/Result.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.core.Result&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.data.core.Result&quot;);
+dojo.declare(&quot;dojo.data.core.Result&quot;, null, {initializer:function (keywordArgs, store) {
+	this.fromKwArgs(keywordArgs || {});
+	this.items = null;
+	this.resultMetadata = null;
+	this.length = -1;
+	this.store = store;
+	this._aborted = false;
+	this._abortFunc = null;
+}, sync:true, abort:function () {
+	this._aborted = true;
+	if (this._abortFunc) {
+		this._abortFunc();
+	}
+}, fromKwArgs:function (kwArgs) {
+	if (typeof kwArgs.saveResult == &quot;undefined&quot;) {
+		this.saveResult = kwArgs.onnext ? false : true;
+	}
+	dojo.lang.mixin(this, kwArgs);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/core/Write.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/core/Write.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/core/Write.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,44 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.core.Write&quot;);
+dojo.require(&quot;dojo.data.core.Read&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.data.core.Write&quot;);
+dojo.declare(&quot;dojo.data.core.Write&quot;, dojo.data.core.Read, {newItem:function (keywordArgs) {
+	var newItem;
+	dojo.unimplemented(&quot;dojo.data.core.Write.newItem&quot;);
+	return newItem;
+}, deleteItem:function (item) {
+	dojo.unimplemented(&quot;dojo.data.core.Write.deleteItem&quot;);
+	return false;
+}, set:function (item, attribute, value) {
+	dojo.unimplemented(&quot;dojo.data.core.Write.set&quot;);
+	return false;
+}, setValues:function (item, attribute, values) {
+	dojo.unimplemented(&quot;dojo.data.core.Write.setValues&quot;);
+	return false;
+}, unsetAttribute:function (item, attribute) {
+	dojo.unimplemented(&quot;dojo.data.core.Write.clear&quot;);
+	return false;
+}, save:function () {
+	dojo.unimplemented(&quot;dojo.data.core.Write.save&quot;);
+	return false;
+}, revert:function () {
+	dojo.unimplemented(&quot;dojo.data.core.Write.revert&quot;);
+	return false;
+}, isDirty:function (item) {
+	dojo.unimplemented(&quot;dojo.data.core.Write.isDirty&quot;);
+	return false;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/data/old/Attribute.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/Attribute.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/Attribute.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.Attribute&quot;);
+dojo.require(&quot;dojo.data.old.Item&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.Attribute = function (dataProvider, attributeId) {
+	dojo.lang.assertType(dataProvider, dojo.data.old.provider.Base, {optional:true});
+	dojo.lang.assertType(attributeId, String);
+	dojo.data.old.Item.call(this, dataProvider);
+	this._attributeId = attributeId;
+};
+dojo.inherits(dojo.data.old.Attribute, dojo.data.old.Item);
+dojo.data.old.Attribute.prototype.toString = function () {
+	return this._attributeId;
+};
+dojo.data.old.Attribute.prototype.getAttributeId = function () {
+	return this._attributeId;
+};
+dojo.data.old.Attribute.prototype.getType = function () {
+	return this.get(&quot;type&quot;);
+};
+dojo.data.old.Attribute.prototype.setType = function (type) {
+	this.set(&quot;type&quot;, type);
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/Item.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/Item.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/Item.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,223 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.Item&quot;);
+dojo.require(&quot;dojo.data.old.Observable&quot;);
+dojo.require(&quot;dojo.data.old.Value&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.Item = function (dataProvider) {
+	dojo.lang.assertType(dataProvider, dojo.data.old.provider.Base, {optional:true});
+	dojo.data.old.Observable.call(this);
+	this._dataProvider = dataProvider;
+	this._dictionaryOfAttributeValues = {};
+};
+dojo.inherits(dojo.data.old.Item, dojo.data.old.Observable);
+dojo.data.old.Item.compare = function (itemOne, itemTwo) {
+	dojo.lang.assertType(itemOne, dojo.data.old.Item);
+	if (!dojo.lang.isOfType(itemTwo, dojo.data.old.Item)) {
+		return -1;
+	}
+	var nameOne = itemOne.getName();
+	var nameTwo = itemTwo.getName();
+	if (nameOne == nameTwo) {
+		var attributeArrayOne = itemOne.getAttributes();
+		var attributeArrayTwo = itemTwo.getAttributes();
+		if (attributeArrayOne.length != attributeArrayTwo.length) {
+			if (attributeArrayOne.length &gt; attributeArrayTwo.length) {
+				return 1;
+			} else {
+				return -1;
+			}
+		}
+		for (var i in attributeArrayOne) {
+			var attribute = attributeArrayOne[i];
+			var arrayOfValuesOne = itemOne.getValues(attribute);
+			var arrayOfValuesTwo = itemTwo.getValues(attribute);
+			dojo.lang.assert(arrayOfValuesOne &amp;&amp; (arrayOfValuesOne.length &gt; 0));
+			if (!arrayOfValuesTwo) {
+				return 1;
+			}
+			if (arrayOfValuesOne.length != arrayOfValuesTwo.length) {
+				if (arrayOfValuesOne.length &gt; arrayOfValuesTwo.length) {
+					return 1;
+				} else {
+					return -1;
+				}
+			}
+			for (var j in arrayOfValuesOne) {
+				var value = arrayOfValuesOne[j];
+				if (!itemTwo.hasAttributeValue(value)) {
+					return 1;
+				}
+			}
+			return 0;
+		}
+	} else {
+		if (nameOne &gt; nameTwo) {
+			return 1;
+		} else {
+			return -1;
+		}
+	}
+};
+dojo.data.old.Item.prototype.toString = function () {
+	var arrayOfStrings = [];
+	var attributes = this.getAttributes();
+	for (var i in attributes) {
+		var attribute = attributes[i];
+		var arrayOfValues = this.getValues(attribute);
+		var valueString;
+		if (arrayOfValues.length == 1) {
+			valueString = arrayOfValues[0];
+		} else {
+			valueString = &quot;[&quot;;
+			valueString += arrayOfValues.join(&quot;, &quot;);
+			valueString += &quot;]&quot;;
+		}
+		arrayOfStrings.push(&quot;  &quot; + attribute + &quot;: &quot; + valueString);
+	}
+	var returnString = &quot;{ &quot;;
+	returnString += arrayOfStrings.join(&quot;,\n&quot;);
+	returnString += &quot; }&quot;;
+	return returnString;
+};
+dojo.data.old.Item.prototype.compare = function (otherItem) {
+	return dojo.data.old.Item.compare(this, otherItem);
+};
+dojo.data.old.Item.prototype.isEqual = function (otherItem) {
+	return (this.compare(otherItem) == 0);
+};
+dojo.data.old.Item.prototype.getName = function () {
+	return this.get(&quot;name&quot;);
+};
+dojo.data.old.Item.prototype.get = function (attributeId) {
+	var literalOrValueOrArray = this._dictionaryOfAttributeValues[attributeId];
+	if (dojo.lang.isUndefined(literalOrValueOrArray)) {
+		return null;
+	}
+	if (literalOrValueOrArray instanceof dojo.data.old.Value) {
+		return literalOrValueOrArray.getValue();
+	}
+	if (dojo.lang.isArray(literalOrValueOrArray)) {
+		var dojoDataValue = literalOrValueOrArray[0];
+		return dojoDataValue.getValue();
+	}
+	return literalOrValueOrArray;
+};
+dojo.data.old.Item.prototype.getValue = function (attributeId) {
+	var literalOrValueOrArray = this._dictionaryOfAttributeValues[attributeId];
+	if (dojo.lang.isUndefined(literalOrValueOrArray)) {
+		return null;
+	}
+	if (literalOrValueOrArray instanceof dojo.data.old.Value) {
+		return literalOrValueOrArray;
+	}
+	if (dojo.lang.isArray(literalOrValueOrArray)) {
+		var dojoDataValue = literalOrValueOrArray[0];
+		return dojoDataValue;
+	}
+	var literal = literalOrValueOrArray;
+	dojoDataValue = new dojo.data.old.Value(literal);
+	this._dictionaryOfAttributeValues[attributeId] = dojoDataValue;
+	return dojoDataValue;
+};
+dojo.data.old.Item.prototype.getValues = function (attributeId) {
+	var literalOrValueOrArray = this._dictionaryOfAttributeValues[attributeId];
+	if (dojo.lang.isUndefined(literalOrValueOrArray)) {
+		return null;
+	}
+	if (literalOrValueOrArray instanceof dojo.data.old.Value) {
+		var array = [literalOrValueOrArray];
+		this._dictionaryOfAttributeValues[attributeId] = array;
+		return array;
+	}
+	if (dojo.lang.isArray(literalOrValueOrArray)) {
+		return literalOrValueOrArray;
+	}
+	var literal = literalOrValueOrArray;
+	var dojoDataValue = new dojo.data.old.Value(literal);
+	array = [dojoDataValue];
+	this._dictionaryOfAttributeValues[attributeId] = array;
+	return array;
+};
+dojo.data.old.Item.prototype.load = function (attributeId, value) {
+	this._dataProvider.registerAttribute(attributeId);
+	var literalOrValueOrArray = this._dictionaryOfAttributeValues[attributeId];
+	if (dojo.lang.isUndefined(literalOrValueOrArray)) {
+		this._dictionaryOfAttributeValues[attributeId] = value;
+		return;
+	}
+	if (!(value instanceof dojo.data.old.Value)) {
+		value = new dojo.data.old.Value(value);
+	}
+	if (literalOrValueOrArray instanceof dojo.data.old.Value) {
+		var array = [literalOrValueOrArray, value];
+		this._dictionaryOfAttributeValues[attributeId] = array;
+		return;
+	}
+	if (dojo.lang.isArray(literalOrValueOrArray)) {
+		literalOrValueOrArray.push(value);
+		return;
+	}
+	var literal = literalOrValueOrArray;
+	var dojoDataValue = new dojo.data.old.Value(literal);
+	array = [dojoDataValue, value];
+	this._dictionaryOfAttributeValues[attributeId] = array;
+};
+dojo.data.old.Item.prototype.set = function (attributeId, value) {
+	this._dataProvider.registerAttribute(attributeId);
+	this._dictionaryOfAttributeValues[attributeId] = value;
+	this._dataProvider.noteChange(this, attributeId, value);
+};
+dojo.data.old.Item.prototype.setValue = function (attributeId, value) {
+	this.set(attributeId, value);
+};
+dojo.data.old.Item.prototype.addValue = function (attributeId, value) {
+	this.load(attributeId, value);
+	this._dataProvider.noteChange(this, attributeId, value);
+};
+dojo.data.old.Item.prototype.setValues = function (attributeId, arrayOfValues) {
+	dojo.lang.assertType(arrayOfValues, Array);
+	this._dataProvider.registerAttribute(attributeId);
+	var finalArray = [];
+	this._dictionaryOfAttributeValues[attributeId] = finalArray;
+	for (var i in arrayOfValues) {
+		var value = arrayOfValues[i];
+		if (!(value instanceof dojo.data.old.Value)) {
+			value = new dojo.data.old.Value(value);
+		}
+		finalArray.push(value);
+		this._dataProvider.noteChange(this, attributeId, value);
+	}
+};
+dojo.data.old.Item.prototype.getAttributes = function () {
+	var arrayOfAttributes = [];
+	for (var key in this._dictionaryOfAttributeValues) {
+		arrayOfAttributes.push(this._dataProvider.getAttribute(key));
+	}
+	return arrayOfAttributes;
+};
+dojo.data.old.Item.prototype.hasAttribute = function (attributeId) {
+	return (attributeId in this._dictionaryOfAttributeValues);
+};
+dojo.data.old.Item.prototype.hasAttributeValue = function (attributeId, value) {
+	var arrayOfValues = this.getValues(attributeId);
+	for (var i in arrayOfValues) {
+		var candidateValue = arrayOfValues[i];
+		if (candidateValue.isEqual(value)) {
+			return true;
+		}
+	}
+	return false;
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/Kind.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/Kind.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/Kind.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.Kind&quot;);
+dojo.require(&quot;dojo.data.old.Item&quot;);
+dojo.data.old.Kind = function (dataProvider) {
+	dojo.data.old.Item.call(this, dataProvider);
+};
+dojo.inherits(dojo.data.old.Kind, dojo.data.old.Item);
+

Added: tags/parley-0.55/root/static/magic/src/data/old/Observable.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/Observable.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/Observable.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,40 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.Observable&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.Observable = function () {
+};
+dojo.data.old.Observable.prototype.addObserver = function (observer) {
+	dojo.lang.assertType(observer, Object);
+	dojo.lang.assertType(observer.observedObjectHasChanged, Function);
+	if (!this._arrayOfObservers) {
+		this._arrayOfObservers = [];
+	}
+	if (!dojo.lang.inArray(this._arrayOfObservers, observer)) {
+		this._arrayOfObservers.push(observer);
+	}
+};
+dojo.data.old.Observable.prototype.removeObserver = function (observer) {
+	if (!this._arrayOfObservers) {
+		return;
+	}
+	var index = dojo.lang.indexOf(this._arrayOfObservers, observer);
+	if (index != -1) {
+		this._arrayOfObservers.splice(index, 1);
+	}
+};
+dojo.data.old.Observable.prototype.getObservers = function () {
+	return this._arrayOfObservers;
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/ResultSet.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/ResultSet.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/ResultSet.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,52 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.ResultSet&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.require(&quot;dojo.collections.Collections&quot;);
+dojo.data.old.ResultSet = function (dataProvider, arrayOfItems) {
+	dojo.lang.assertType(dataProvider, dojo.data.old.provider.Base, {optional:true});
+	dojo.lang.assertType(arrayOfItems, Array, {optional:true});
+	dojo.data.old.Observable.call(this);
+	this._dataProvider = dataProvider;
+	this._arrayOfItems = [];
+	if (arrayOfItems) {
+		this._arrayOfItems = arrayOfItems;
+	}
+};
+dojo.inherits(dojo.data.old.ResultSet, dojo.data.old.Observable);
+dojo.data.old.ResultSet.prototype.toString = function () {
+	var returnString = this._arrayOfItems.join(&quot;, &quot;);
+	return returnString;
+};
+dojo.data.old.ResultSet.prototype.toArray = function () {
+	return this._arrayOfItems;
+};
+dojo.data.old.ResultSet.prototype.getIterator = function () {
+	return new dojo.collections.Iterator(this._arrayOfItems);
+};
+dojo.data.old.ResultSet.prototype.getLength = function () {
+	return this._arrayOfItems.length;
+};
+dojo.data.old.ResultSet.prototype.getItemAt = function (index) {
+	return this._arrayOfItems[index];
+};
+dojo.data.old.ResultSet.prototype.indexOf = function (item) {
+	return dojo.lang.indexOf(this._arrayOfItems, item);
+};
+dojo.data.old.ResultSet.prototype.contains = function (item) {
+	return dojo.lang.inArray(this._arrayOfItems, item);
+};
+dojo.data.old.ResultSet.prototype.getDataProvider = function () {
+	return this._dataProvider;
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/Type.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/Type.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/Type.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.Type&quot;);
+dojo.require(&quot;dojo.data.old.Item&quot;);
+dojo.data.old.Type = function (dataProvider) {
+	dojo.data.old.Item.call(this, dataProvider);
+};
+dojo.inherits(dojo.data.old.Type, dojo.data.old.Item);
+

Added: tags/parley-0.55/root/static/magic/src/data/old/Value.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/Value.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/Value.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.Value&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.Value = function (value) {
+	this._value = value;
+	this._type = null;
+};
+dojo.data.old.Value.prototype.toString = function () {
+	return this._value.toString();
+};
+dojo.data.old.Value.prototype.getValue = function () {
+	return this._value;
+};
+dojo.data.old.Value.prototype.getType = function () {
+	dojo.unimplemented(&quot;dojo.data.old.Value.prototype.getType&quot;);
+	return this._type;
+};
+dojo.data.old.Value.prototype.compare = function () {
+	dojo.unimplemented(&quot;dojo.data.old.Value.prototype.compare&quot;);
+};
+dojo.data.old.Value.prototype.isEqual = function () {
+	dojo.unimplemented(&quot;dojo.data.old.Value.prototype.isEqual&quot;);
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,17 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.data.old.*&quot;);
+dojo.kwCompoundRequire({common:[&quot;dojo.data.old.Item&quot;, &quot;dojo.data.old.ResultSet&quot;, &quot;dojo.data.old.provider.FlatFile&quot;]});
+dojo.provide(&quot;dojo.data.old.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/data/old/format/Csv.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/format/Csv.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/format/Csv.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,81 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.format.Csv&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.format.Csv = new function () {
+	this.getArrayStructureFromCsvFileContents = function (csvFileContents) {
+		dojo.lang.assertType(csvFileContents, String);
+		var lineEndingCharacters = new RegExp(&quot;\r\n|\n|\r&quot;);
+		var leadingWhiteSpaceCharacters = new RegExp(&quot;^\\s+&quot;, &quot;g&quot;);
+		var trailingWhiteSpaceCharacters = new RegExp(&quot;\\s+$&quot;, &quot;g&quot;);
+		var doubleQuotes = new RegExp(&quot;\&quot;\&quot;&quot;, &quot;g&quot;);
+		var arrayOfOutputRecords = [];
+		var arrayOfInputLines = csvFileContents.split(lineEndingCharacters);
+		for (var i in arrayOfInputLines) {
+			var singleLine = arrayOfInputLines[i];
+			if (singleLine.length &gt; 0) {
+				var listOfFields = singleLine.split(&quot;,&quot;);
+				var j = 0;
+				while (j &lt; listOfFields.length) {
+					var space_field_space = listOfFields[j];
+					var field_space = space_field_space.replace(leadingWhiteSpaceCharacters, &quot;&quot;);
+					var field = field_space.replace(trailingWhiteSpaceCharacters, &quot;&quot;);
+					var firstChar = field.charAt(0);
+					var lastChar = field.charAt(field.length - 1);
+					var secondToLastChar = field.charAt(field.length - 2);
+					var thirdToLastChar = field.charAt(field.length - 3);
+					if ((firstChar == &quot;\&quot;&quot;) &amp;&amp; ((lastChar != &quot;\&quot;&quot;) || ((lastChar == &quot;\&quot;&quot;) &amp;&amp; (secondToLastChar == &quot;\&quot;&quot;) &amp;&amp; (thirdToLastChar != &quot;\&quot;&quot;)))) {
+						if (j + 1 === listOfFields.length) {
+							return null;
+						}
+						var nextField = listOfFields[j + 1];
+						listOfFields[j] = field_space + &quot;,&quot; + nextField;
+						listOfFields.splice(j + 1, 1);
+					} else {
+						if ((firstChar == &quot;\&quot;&quot;) &amp;&amp; (lastChar == &quot;\&quot;&quot;)) {
+							field = field.slice(1, (field.length - 1));
+							field = field.replace(doubleQuotes, &quot;\&quot;&quot;);
+						}
+						listOfFields[j] = field;
+						j += 1;
+					}
+				}
+				arrayOfOutputRecords.push(listOfFields);
+			}
+		}
+		return arrayOfOutputRecords;
+	};
+	this.loadDataProviderFromFileContents = function (dataProvider, csvFileContents) {
+		dojo.lang.assertType(dataProvider, dojo.data.old.provider.Base);
+		dojo.lang.assertType(csvFileContents, String);
+		var arrayOfArrays = this.getArrayStructureFromCsvFileContents(csvFileContents);
+		if (arrayOfArrays) {
+			var arrayOfKeys = arrayOfArrays[0];
+			for (var i = 1; i &lt; arrayOfArrays.length; ++i) {
+				var row = arrayOfArrays[i];
+				var item = dataProvider.getNewItemToLoad();
+				for (var j in row) {
+					var value = row[j];
+					var key = arrayOfKeys[j];
+					item.load(key, value);
+				}
+			}
+		}
+	};
+	this.getCsvStringFromResultSet = function (resultSet) {
+		dojo.unimplemented(&quot;dojo.data.old.format.Csv.getCsvStringFromResultSet&quot;);
+		var csvString = null;
+		return csvString;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/data/old/format/Json.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/format/Json.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/format/Json.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,71 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.format.Json&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.format.Json = new function () {
+	this.loadDataProviderFromFileContents = function (dataProvider, jsonFileContents) {
+		dojo.lang.assertType(dataProvider, dojo.data.old.provider.Base);
+		dojo.lang.assertType(jsonFileContents, String);
+		var arrayOfJsonData = eval(&quot;(&quot; + jsonFileContents + &quot;)&quot;);
+		this.loadDataProviderFromArrayOfJsonData(dataProvider, arrayOfJsonData);
+	};
+	this.loadDataProviderFromArrayOfJsonData = function (dataProvider, arrayOfJsonData) {
+		dojo.lang.assertType(arrayOfJsonData, Array, {optional:true});
+		if (arrayOfJsonData &amp;&amp; (arrayOfJsonData.length &gt; 0)) {
+			var firstRow = arrayOfJsonData[0];
+			dojo.lang.assertType(firstRow, [Array, &quot;pureobject&quot;]);
+			if (dojo.lang.isArray(firstRow)) {
+				_loadDataProviderFromArrayOfArrays(dataProvider, arrayOfJsonData);
+			} else {
+				dojo.lang.assertType(firstRow, &quot;pureobject&quot;);
+				_loadDataProviderFromArrayOfObjects(dataProvider, arrayOfJsonData);
+			}
+		}
+	};
+	this.getJsonStringFromResultSet = function (resultSet) {
+		dojo.unimplemented(&quot;dojo.data.old.format.Json.getJsonStringFromResultSet&quot;);
+		var jsonString = null;
+		return jsonString;
+	};
+	function _loadDataProviderFromArrayOfArrays(dataProvider, arrayOfJsonData) {
+		var arrayOfKeys = arrayOfJsonData[0];
+		for (var i = 1; i &lt; arrayOfJsonData.length; ++i) {
+			var row = arrayOfJsonData[i];
+			var item = dataProvider.getNewItemToLoad();
+			for (var j in row) {
+				var value = row[j];
+				var key = arrayOfKeys[j];
+				item.load(key, value);
+			}
+		}
+	}
+	function _loadDataProviderFromArrayOfObjects(dataProvider, arrayOfJsonData) {
+		for (var i in arrayOfJsonData) {
+			var row = arrayOfJsonData[i];
+			var item = dataProvider.getNewItemToLoad();
+			for (var key in row) {
+				var value = row[key];
+				if (dojo.lang.isArray(value)) {
+					var arrayOfValues = value;
+					for (var j in arrayOfValues) {
+						value = arrayOfValues[j];
+						item.load(key, value);
+					}
+				} else {
+					item.load(key, value);
+				}
+			}
+		}
+	}
+}();
+

Added: tags/parley-0.55/root/static/magic/src/data/old/provider/Base.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/provider/Base.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/provider/Base.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,124 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.provider.Base&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.provider.Base = function () {
+	this._countOfNestedTransactions = 0;
+	this._changesInCurrentTransaction = null;
+};
+dojo.data.old.provider.Base.prototype.beginTransaction = function () {
+	if (this._countOfNestedTransactions === 0) {
+		this._changesInCurrentTransaction = [];
+	}
+	this._countOfNestedTransactions += 1;
+};
+dojo.data.old.provider.Base.prototype.endTransaction = function () {
+	this._countOfNestedTransactions -= 1;
+	dojo.lang.assert(this._countOfNestedTransactions &gt;= 0);
+	if (this._countOfNestedTransactions === 0) {
+		var listOfChangesMade = this._saveChanges();
+		this._changesInCurrentTransaction = null;
+		if (listOfChangesMade.length &gt; 0) {
+			this._notifyObserversOfChanges(listOfChangesMade);
+		}
+	}
+};
+dojo.data.old.provider.Base.prototype.getNewItemToLoad = function () {
+	return this._newItem();
+};
+dojo.data.old.provider.Base.prototype.newItem = function (itemName) {
+	dojo.lang.assertType(itemName, String, {optional:true});
+	var item = this._newItem();
+	if (itemName) {
+		item.set(&quot;name&quot;, itemName);
+	}
+	return item;
+};
+dojo.data.old.provider.Base.prototype.newAttribute = function (attributeId) {
+	dojo.lang.assertType(attributeId, String, {optional:true});
+	var attribute = this._newAttribute(attributeId);
+	return attribute;
+};
+dojo.data.old.provider.Base.prototype.getAttribute = function (attributeId) {
+	dojo.unimplemented(&quot;dojo.data.old.provider.Base&quot;);
+	var attribute;
+	return attribute;
+};
+dojo.data.old.provider.Base.prototype.getAttributes = function () {
+	dojo.unimplemented(&quot;dojo.data.old.provider.Base&quot;);
+	return this._arrayOfAttributes;
+};
+dojo.data.old.provider.Base.prototype.fetchArray = function () {
+	dojo.unimplemented(&quot;dojo.data.old.provider.Base&quot;);
+	return [];
+};
+dojo.data.old.provider.Base.prototype.fetchResultSet = function () {
+	dojo.unimplemented(&quot;dojo.data.old.provider.Base&quot;);
+	var resultSet;
+	return resultSet;
+};
+dojo.data.old.provider.Base.prototype.noteChange = function (item, attribute, value) {
+	var change = {item:item, attribute:attribute, value:value};
+	if (this._countOfNestedTransactions === 0) {
+		this.beginTransaction();
+		this._changesInCurrentTransaction.push(change);
+		this.endTransaction();
+	} else {
+		this._changesInCurrentTransaction.push(change);
+	}
+};
+dojo.data.old.provider.Base.prototype.addItemObserver = function (item, observer) {
+	dojo.lang.assertType(item, dojo.data.old.Item);
+	item.addObserver(observer);
+};
+dojo.data.old.provider.Base.prototype.removeItemObserver = function (item, observer) {
+	dojo.lang.assertType(item, dojo.data.old.Item);
+	item.removeObserver(observer);
+};
+dojo.data.old.provider.Base.prototype._newItem = function () {
+	var item = new dojo.data.old.Item(this);
+	return item;
+};
+dojo.data.old.provider.Base.prototype._newAttribute = function (attributeId) {
+	var attribute = new dojo.data.old.Attribute(this);
+	return attribute;
+};
+dojo.data.old.provider.Base.prototype._saveChanges = function () {
+	var arrayOfChangesMade = this._changesInCurrentTransaction;
+	return arrayOfChangesMade;
+};
+dojo.data.old.provider.Base.prototype._notifyObserversOfChanges = function (arrayOfChanges) {
+	var arrayOfResultSets = this._getResultSets();
+	for (var i in arrayOfChanges) {
+		var change = arrayOfChanges[i];
+		var changedItem = change.item;
+		var arrayOfItemObservers = changedItem.getObservers();
+		for (var j in arrayOfItemObservers) {
+			var observer = arrayOfItemObservers[j];
+			observer.observedObjectHasChanged(changedItem, change);
+		}
+		for (var k in arrayOfResultSets) {
+			var resultSet = arrayOfResultSets[k];
+			var arrayOfResultSetObservers = resultSet.getObservers();
+			for (var m in arrayOfResultSetObservers) {
+				observer = arrayOfResultSetObservers[m];
+				observer.observedObjectHasChanged(resultSet, change);
+			}
+		}
+	}
+};
+dojo.data.old.provider.Base.prototype._getResultSets = function () {
+	dojo.unimplemented(&quot;dojo.data.old.provider.Base&quot;);
+	return [];
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/provider/Delicious.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/provider/Delicious.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/provider/Delicious.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,33 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.provider.Delicious&quot;);
+dojo.require(&quot;dojo.data.old.provider.FlatFile&quot;);
+dojo.require(&quot;dojo.data.old.format.Json&quot;);
+dojo.data.old.provider.Delicious = function () {
+	dojo.data.old.provider.FlatFile.call(this);
+	if (Delicious &amp;&amp; Delicious.posts) {
+		dojo.data.old.format.Json.loadDataProviderFromArrayOfJsonData(this, Delicious.posts);
+	} else {
+	}
+	var u = this.registerAttribute(&quot;u&quot;);
+	var d = this.registerAttribute(&quot;d&quot;);
+	var t = this.registerAttribute(&quot;t&quot;);
+	u.load(&quot;name&quot;, &quot;Bookmark&quot;);
+	d.load(&quot;name&quot;, &quot;Description&quot;);
+	t.load(&quot;name&quot;, &quot;Tags&quot;);
+	u.load(&quot;type&quot;, &quot;String&quot;);
+	d.load(&quot;type&quot;, &quot;String&quot;);
+	t.load(&quot;type&quot;, &quot;String&quot;);
+};
+dojo.inherits(dojo.data.old.provider.Delicious, dojo.data.old.provider.FlatFile);
+

Added: tags/parley-0.55/root/static/magic/src/data/old/provider/FlatFile.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/provider/FlatFile.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/provider/FlatFile.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,113 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.provider.FlatFile&quot;);
+dojo.require(&quot;dojo.data.old.provider.Base&quot;);
+dojo.require(&quot;dojo.data.old.Item&quot;);
+dojo.require(&quot;dojo.data.old.Attribute&quot;);
+dojo.require(&quot;dojo.data.old.ResultSet&quot;);
+dojo.require(&quot;dojo.data.old.format.Json&quot;);
+dojo.require(&quot;dojo.data.old.format.Csv&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.data.old.provider.FlatFile = function (keywordParameters) {
+	dojo.lang.assertType(keywordParameters, &quot;pureobject&quot;, {optional:true});
+	dojo.data.old.provider.Base.call(this);
+	this._arrayOfItems = [];
+	this._resultSet = null;
+	this._dictionaryOfAttributes = {};
+	if (keywordParameters) {
+		var jsonObjects = keywordParameters[&quot;jsonObjects&quot;];
+		var jsonString = keywordParameters[&quot;jsonString&quot;];
+		var fileUrl = keywordParameters[&quot;url&quot;];
+		if (jsonObjects) {
+			dojo.data.old.format.Json.loadDataProviderFromArrayOfJsonData(this, jsonObjects);
+		}
+		if (jsonString) {
+			dojo.data.old.format.Json.loadDataProviderFromFileContents(this, jsonString);
+		}
+		if (fileUrl) {
+			var arrayOfParts = fileUrl.split(&quot;.&quot;);
+			var lastPart = arrayOfParts[(arrayOfParts.length - 1)];
+			var formatParser = null;
+			if (lastPart == &quot;json&quot;) {
+				formatParser = dojo.data.old.format.Json;
+			}
+			if (lastPart == &quot;csv&quot;) {
+				formatParser = dojo.data.old.format.Csv;
+			}
+			if (formatParser) {
+				var fileContents = dojo.hostenv.getText(fileUrl);
+				formatParser.loadDataProviderFromFileContents(this, fileContents);
+			} else {
+				dojo.lang.assert(false, &quot;new dojo.data.old.provider.FlatFile({url: }) was passed a file without a .csv or .json suffix&quot;);
+			}
+		}
+	}
+};
+dojo.inherits(dojo.data.old.provider.FlatFile, dojo.data.old.provider.Base);
+dojo.data.old.provider.FlatFile.prototype.getProviderCapabilities = function (keyword) {
+	dojo.lang.assertType(keyword, String, {optional:true});
+	if (!this._ourCapabilities) {
+		this._ourCapabilities = {transactions:false, undo:false, login:false, versioning:false, anonymousRead:true, anonymousWrite:false, permissions:false, queries:false, strongTyping:false, datatypes:[String, Date, Number]};
+	}
+	if (keyword) {
+		return this._ourCapabilities[keyword];
+	} else {
+		return this._ourCapabilities;
+	}
+};
+dojo.data.old.provider.FlatFile.prototype.registerAttribute = function (attributeId) {
+	var registeredAttribute = this.getAttribute(attributeId);
+	if (!registeredAttribute) {
+		var newAttribute = new dojo.data.old.Attribute(this, attributeId);
+		this._dictionaryOfAttributes[attributeId] = newAttribute;
+		registeredAttribute = newAttribute;
+	}
+	return registeredAttribute;
+};
+dojo.data.old.provider.FlatFile.prototype.getAttribute = function (attributeId) {
+	var attribute = (this._dictionaryOfAttributes[attributeId] || null);
+	return attribute;
+};
+dojo.data.old.provider.FlatFile.prototype.getAttributes = function () {
+	var arrayOfAttributes = [];
+	for (var key in this._dictionaryOfAttributes) {
+		var attribute = this._dictionaryOfAttributes[key];
+		arrayOfAttributes.push(attribute);
+	}
+	return arrayOfAttributes;
+};
+dojo.data.old.provider.FlatFile.prototype.fetchArray = function (query) {
+	return this._arrayOfItems;
+};
+dojo.data.old.provider.FlatFile.prototype.fetchResultSet = function (query) {
+	if (!this._resultSet) {
+		this._resultSet = new dojo.data.old.ResultSet(this, this.fetchArray(query));
+	}
+	return this._resultSet;
+};
+dojo.data.old.provider.FlatFile.prototype._newItem = function () {
+	var item = new dojo.data.old.Item(this);
+	this._arrayOfItems.push(item);
+	return item;
+};
+dojo.data.old.provider.FlatFile.prototype._newAttribute = function (attributeId) {
+	dojo.lang.assertType(attributeId, String);
+	dojo.lang.assert(this.getAttribute(attributeId) === null);
+	var attribute = new dojo.data.old.Attribute(this, attributeId);
+	this._dictionaryOfAttributes[attributeId] = attribute;
+	return attribute;
+};
+dojo.data.old.provider.Base.prototype._getResultSets = function () {
+	return [this._resultSet];
+};
+

Added: tags/parley-0.55/root/static/magic/src/data/old/provider/JotSpot.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/provider/JotSpot.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/provider/JotSpot.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.provider.JotSpot&quot;);
+dojo.require(&quot;dojo.data.old.provider.Base&quot;);
+dojo.data.old.provider.JotSpot = function () {
+	dojo.unimplemented(&quot;dojo.data.old.provider.JotSpot&quot;);
+};
+dojo.inherits(dojo.data.old.provider.JotSpot, dojo.data.old.provider.Base);
+

Added: tags/parley-0.55/root/static/magic/src/data/old/provider/MySql.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/provider/MySql.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/provider/MySql.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data.old.provider.MySql&quot;);
+dojo.require(&quot;dojo.data.old.provider.Base&quot;);
+dojo.data.old.provider.MySql = function () {
+	dojo.unimplemented(&quot;dojo.data.old.provider.MySql&quot;);
+};
+dojo.inherits(dojo.data.old.provider.MySql, dojo.data.old.provider.Base);
+

Added: tags/parley-0.55/root/static/magic/src/data/old/to_do.txt
===================================================================
--- tags/parley-0.55/root/static/magic/src/data/old/to_do.txt	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data/old/to_do.txt	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,45 @@
+Existing Features
+ * can import data from .json or .csv format files
+ * can import data from del.icio.us
+ * can create and modify data programmatically
+ * can bind data to dojo.widget.Chart
+ * can bind data to dojo.widget.SortableTable
+ * can bind one data set to multiple widgets
+ * notifications: widgets are notified when data changes
+ * notification available per-item or per-resultSet
+ * can create ad-hoc attributes
+ * attributes can be loosely-typed 
+ * attributes can have meta-data like type and display name
+ * half-implemented support for sorting
+ * half-implemented support for export to .json
+ * API for getting data in simple arrays 
+ * API for getting ResultSets with iterators (precursor to support for something like the openrico.org live grid)
+ 
+~~~~~~~~~~~~~~~~~~~~~~~~
+To-Do List
+ * be able to import data from an html &lt;table&gt;&lt;/table&gt;
+ * think about being able to import data from some type of XML 
+ * think about integration with dojo.undo.Manager
+ * think more about how to represent the notion of different data types
+ * think about what problems we'll run into when we have a MySQL data provider
+ * in TableBindingHack, improve support for data types in the SortableTable binding
+ * deal with ids (including MySQL multi-field keys)
+ * add support for item-references:  employeeItem.set('department', departmentItem);
+ * deal with Attributes as instances of Items, not just subclasses of Items
+ * unit tests for compare/sort code
+ * unit tests for everything
+ * implement item.toString('json') and item.toString('xml')
+ * implement dataProvider.newItem({name: 'foo', age: 26})
+ * deal better with transactions
+ * add support for deleting items
+ * don't send out multiple notifications to the same observer
+ * deal with item versions
+ * prototype a Yahoo data provider -- <A HREF="http://developer.yahoo.net/common/json.html">http://developer.yahoo.net/common/json.html</A>
+ * prototype a data provider that enforces strong typing
+ * prototype a data provider that prevents ad-hoc attributes
+ * prototype a data provider that enforces single-kind item
+ * prototype a data provider that allows for login/authentication
+ * have loosely typed result sets play nicely with widgets that expect strong typing
+ * prototype an example of spreadsheet-style formulas or derivation rules
+ * experiment with some sort of fetch() that returns only a subset of a data provider's items
+

Added: tags/parley-0.55/root/static/magic/src/data.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/data.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/data.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.data&quot;);
+dojo.data = {};
+

Added: tags/parley-0.55/root/static/magic/src/date/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/date/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/date/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,316 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.date.common&quot;);
+dojo.date.setDayOfYear = function (dateObject, dayOfYear) {
+	dateObject.setMonth(0);
+	dateObject.setDate(dayOfYear);
+	return dateObject;
+};
+dojo.date.getDayOfYear = function (dateObject) {
+	var fullYear = dateObject.getFullYear();
+	var lastDayOfPrevYear = new Date(fullYear - 1, 11, 31);
+	return Math.floor((dateObject.getTime() - lastDayOfPrevYear.getTime()) / 86400000);
+};
+dojo.date.setWeekOfYear = function (dateObject, week, firstDay) {
+	if (arguments.length == 1) {
+		firstDay = 0;
+	}
+	dojo.unimplemented(&quot;dojo.date.setWeekOfYear&quot;);
+};
+dojo.date.getWeekOfYear = function (dateObject, firstDay) {
+	if (arguments.length == 1) {
+		firstDay = 0;
+	}
+	var firstDayOfYear = new Date(dateObject.getFullYear(), 0, 1);
+	var day = firstDayOfYear.getDay();
+	firstDayOfYear.setDate(firstDayOfYear.getDate() - day + firstDay - (day &gt; firstDay ? 7 : 0));
+	return Math.floor((dateObject.getTime() - firstDayOfYear.getTime()) / 604800000);
+};
+dojo.date.setIsoWeekOfYear = function (dateObject, week, firstDay) {
+	if (arguments.length == 1) {
+		firstDay = 1;
+	}
+	dojo.unimplemented(&quot;dojo.date.setIsoWeekOfYear&quot;);
+};
+dojo.date.getIsoWeekOfYear = function (dateObject, firstDay) {
+	if (arguments.length == 1) {
+		firstDay = 1;
+	}
+	dojo.unimplemented(&quot;dojo.date.getIsoWeekOfYear&quot;);
+};
+dojo.date.shortTimezones = [&quot;IDLW&quot;, &quot;BET&quot;, &quot;HST&quot;, &quot;MART&quot;, &quot;AKST&quot;, &quot;PST&quot;, &quot;MST&quot;, &quot;CST&quot;, &quot;EST&quot;, &quot;AST&quot;, &quot;NFT&quot;, &quot;BST&quot;, &quot;FST&quot;, &quot;AT&quot;, &quot;GMT&quot;, &quot;CET&quot;, &quot;EET&quot;, &quot;MSK&quot;, &quot;IRT&quot;, &quot;GST&quot;, &quot;AFT&quot;, &quot;AGTT&quot;, &quot;IST&quot;, &quot;NPT&quot;, &quot;ALMT&quot;, &quot;MMT&quot;, &quot;JT&quot;, &quot;AWST&quot;, &quot;JST&quot;, &quot;ACST&quot;, &quot;AEST&quot;, &quot;LHST&quot;, &quot;VUT&quot;, &quot;NFT&quot;, &quot;NZT&quot;, &quot;CHAST&quot;, &quot;PHOT&quot;, &quot;LINT&quot;];
+dojo.date.timezoneOffsets = [-720, -660, -600, -570, -540, -480, -420, -360, -300, -240, -210, -180, -120, -60, 0, 60, 120, 180, 210, 240, 270, 300, 330, 345, 360, 390, 420, 480, 540, 570, 600, 630, 660, 690, 720, 765, 780, 840];
+dojo.date.getDaysInMonth = function (dateObject) {
+	var month = dateObject.getMonth();
+	var days = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
+	if (month == 1 &amp;&amp; dojo.date.isLeapYear(dateObject)) {
+		return 29;
+	} else {
+		return days[month];
+	}
+};
+dojo.date.isLeapYear = function (dateObject) {
+	var year = dateObject.getFullYear();
+	return (year % 400 == 0) ? true : (year % 100 == 0) ? false : (year % 4 == 0) ? true : false;
+};
+dojo.date.getTimezoneName = function (dateObject) {
+	var str = dateObject.toString();
+	var tz = &quot;&quot;;
+	var match;
+	var pos = str.indexOf(&quot;(&quot;);
+	if (pos &gt; -1) {
+		pos++;
+		tz = str.substring(pos, str.indexOf(&quot;)&quot;));
+	} else {
+		var pat = /([A-Z\/]+) \d{4}$/;
+		if ((match = str.match(pat))) {
+			tz = match[1];
+		} else {
+			str = dateObject.toLocaleString();
+			pat = / ([A-Z\/]+)$/;
+			if ((match = str.match(pat))) {
+				tz = match[1];
+			}
+		}
+	}
+	return tz == &quot;AM&quot; || tz == &quot;PM&quot; ? &quot;&quot; : tz;
+};
+dojo.date.getOrdinal = function (dateObject) {
+	var date = dateObject.getDate();
+	if (date % 100 != 11 &amp;&amp; date % 10 == 1) {
+		return &quot;st&quot;;
+	} else {
+		if (date % 100 != 12 &amp;&amp; date % 10 == 2) {
+			return &quot;nd&quot;;
+		} else {
+			if (date % 100 != 13 &amp;&amp; date % 10 == 3) {
+				return &quot;rd&quot;;
+			} else {
+				return &quot;th&quot;;
+			}
+		}
+	}
+};
+dojo.date.compareTypes = {DATE:1, TIME:2};
+dojo.date.compare = function (dateA, dateB, options) {
+	var dA = dateA;
+	var dB = dateB || new Date();
+	var now = new Date();
+	with (dojo.date.compareTypes) {
+		var opt = options || (DATE | TIME);
+		var d1 = new Date((opt &amp; DATE) ? dA.getFullYear() : now.getFullYear(), (opt &amp; DATE) ? dA.getMonth() : now.getMonth(), (opt &amp; DATE) ? dA.getDate() : now.getDate(), (opt &amp; TIME) ? dA.getHours() : 0, (opt &amp; TIME) ? dA.getMinutes() : 0, (opt &amp; TIME) ? dA.getSeconds() : 0);
+		var d2 = new Date((opt &amp; DATE) ? dB.getFullYear() : now.getFullYear(), (opt &amp; DATE) ? dB.getMonth() : now.getMonth(), (opt &amp; DATE) ? dB.getDate() : now.getDate(), (opt &amp; TIME) ? dB.getHours() : 0, (opt &amp; TIME) ? dB.getMinutes() : 0, (opt &amp; TIME) ? dB.getSeconds() : 0);
+	}
+	if (d1.valueOf() &gt; d2.valueOf()) {
+		return 1;
+	}
+	if (d1.valueOf() &lt; d2.valueOf()) {
+		return -1;
+	}
+	return 0;
+};
+dojo.date.dateParts = {YEAR:0, MONTH:1, DAY:2, HOUR:3, MINUTE:4, SECOND:5, MILLISECOND:6, QUARTER:7, WEEK:8, WEEKDAY:9};
+dojo.date.add = function (dt, interv, incr) {
+	if (typeof dt == &quot;number&quot;) {
+		dt = new Date(dt);
+	}
+	function fixOvershoot() {
+		if (sum.getDate() &lt; dt.getDate()) {
+			sum.setDate(0);
+		}
+	}
+	var sum = new Date(dt);
+	with (dojo.date.dateParts) {
+		switch (interv) {
+		  case YEAR:
+			sum.setFullYear(dt.getFullYear() + incr);
+			fixOvershoot();
+			break;
+		  case QUARTER:
+			incr *= 3;
+		  case MONTH:
+			sum.setMonth(dt.getMonth() + incr);
+			fixOvershoot();
+			break;
+		  case WEEK:
+			incr *= 7;
+		  case DAY:
+			sum.setDate(dt.getDate() + incr);
+			break;
+		  case WEEKDAY:
+			var dat = dt.getDate();
+			var weeks = 0;
+			var days = 0;
+			var strt = 0;
+			var trgt = 0;
+			var adj = 0;
+			var mod = incr % 5;
+			if (mod == 0) {
+				days = (incr &gt; 0) ? 5 : -5;
+				weeks = (incr &gt; 0) ? ((incr - 5) / 5) : ((incr + 5) / 5);
+			} else {
+				days = mod;
+				weeks = parseInt(incr / 5);
+			}
+			strt = dt.getDay();
+			if (strt == 6 &amp;&amp; incr &gt; 0) {
+				adj = 1;
+			} else {
+				if (strt == 0 &amp;&amp; incr &lt; 0) {
+					adj = -1;
+				}
+			}
+			trgt = (strt + days);
+			if (trgt == 0 || trgt == 6) {
+				adj = (incr &gt; 0) ? 2 : -2;
+			}
+			sum.setDate(dat + (7 * weeks) + days + adj);
+			break;
+		  case HOUR:
+			sum.setHours(sum.getHours() + incr);
+			break;
+		  case MINUTE:
+			sum.setMinutes(sum.getMinutes() + incr);
+			break;
+		  case SECOND:
+			sum.setSeconds(sum.getSeconds() + incr);
+			break;
+		  case MILLISECOND:
+			sum.setMilliseconds(sum.getMilliseconds() + incr);
+			break;
+		  default:
+			break;
+		}
+	}
+	return sum;
+};
+dojo.date.diff = function (dtA, dtB, interv) {
+	if (typeof dtA == &quot;number&quot;) {
+		dtA = new Date(dtA);
+	}
+	if (typeof dtB == &quot;number&quot;) {
+		dtB = new Date(dtB);
+	}
+	var yeaDiff = dtB.getFullYear() - dtA.getFullYear();
+	var monDiff = (dtB.getMonth() - dtA.getMonth()) + (yeaDiff * 12);
+	var msDiff = dtB.getTime() - dtA.getTime();
+	var secDiff = msDiff / 1000;
+	var minDiff = secDiff / 60;
+	var houDiff = minDiff / 60;
+	var dayDiff = houDiff / 24;
+	var weeDiff = dayDiff / 7;
+	var delta = 0;
+	with (dojo.date.dateParts) {
+		switch (interv) {
+		  case YEAR:
+			delta = yeaDiff;
+			break;
+		  case QUARTER:
+			var mA = dtA.getMonth();
+			var mB = dtB.getMonth();
+			var qA = Math.floor(mA / 3) + 1;
+			var qB = Math.floor(mB / 3) + 1;
+			qB += (yeaDiff * 4);
+			delta = qB - qA;
+			break;
+		  case MONTH:
+			delta = monDiff;
+			break;
+		  case WEEK:
+			delta = parseInt(weeDiff);
+			break;
+		  case DAY:
+			delta = dayDiff;
+			break;
+		  case WEEKDAY:
+			var days = Math.round(dayDiff);
+			var weeks = parseInt(days / 7);
+			var mod = days % 7;
+			if (mod == 0) {
+				days = weeks * 5;
+			} else {
+				var adj = 0;
+				var aDay = dtA.getDay();
+				var bDay = dtB.getDay();
+				weeks = parseInt(days / 7);
+				mod = days % 7;
+				var dtMark = new Date(dtA);
+				dtMark.setDate(dtMark.getDate() + (weeks * 7));
+				var dayMark = dtMark.getDay();
+				if (dayDiff &gt; 0) {
+					switch (true) {
+					  case aDay == 6:
+						adj = -1;
+						break;
+					  case aDay == 0:
+						adj = 0;
+						break;
+					  case bDay == 6:
+						adj = -1;
+						break;
+					  case bDay == 0:
+						adj = -2;
+						break;
+					  case (dayMark + mod) &gt; 5:
+						adj = -2;
+						break;
+					  default:
+						break;
+					}
+				} else {
+					if (dayDiff &lt; 0) {
+						switch (true) {
+						  case aDay == 6:
+							adj = 0;
+							break;
+						  case aDay == 0:
+							adj = 1;
+							break;
+						  case bDay == 6:
+							adj = 2;
+							break;
+						  case bDay == 0:
+							adj = 1;
+							break;
+						  case (dayMark + mod) &lt; 0:
+							adj = 2;
+							break;
+						  default:
+							break;
+						}
+					}
+				}
+				days += adj;
+				days -= (weeks * 2);
+			}
+			delta = days;
+			break;
+		  case HOUR:
+			delta = houDiff;
+			break;
+		  case MINUTE:
+			delta = minDiff;
+			break;
+		  case SECOND:
+			delta = secDiff;
+			break;
+		  case MILLISECOND:
+			delta = msDiff;
+			break;
+		  default:
+			break;
+		}
+	}
+	return Math.round(delta);
+};
+

Added: tags/parley-0.55/root/static/magic/src/date/format.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/date/format.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/date/format.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,713 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.date.common&quot;);
+dojo.require(&quot;dojo.date.supplemental&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.string.common&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.requireLocalization(&quot;dojo.i18n.calendar&quot;, &quot;gregorian&quot;, null, &quot;ko,zh-cn,zh,sv,ja,en,zh-tw,it,hu,nl,fi,zh-hk,fr,pt,ROOT,es,de,pt-br&quot;);
+dojo.requireLocalization(&quot;dojo.i18n.calendar&quot;, &quot;gregorianExtras&quot;, null, &quot;zh,ROOT,ja&quot;);
+(function () {
+	dojo.date.format = function (dateObject, options) {
+		if (typeof options == &quot;string&quot;) {
+			dojo.deprecated(&quot;dojo.date.format&quot;, &quot;To format dates with POSIX-style strings, please use dojo.date.strftime instead&quot;, &quot;0.5&quot;);
+			return dojo.date.strftime(dateObject, options);
+		}
+		function formatPattern(dateObject, pattern) {
+			return pattern.replace(/([a-z])\1*/ig, function (match) {
+				var s;
+				var c = match.charAt(0);
+				var l = match.length;
+				var pad;
+				var widthList = [&quot;abbr&quot;, &quot;wide&quot;, &quot;narrow&quot;];
+				switch (c) {
+				  case &quot;G&quot;:
+					if (l &gt; 3) {
+						dojo.unimplemented(&quot;Era format not implemented&quot;);
+					}
+					s = info.eras[dateObject.getFullYear() &lt; 0 ? 1 : 0];
+					break;
+				  case &quot;y&quot;:
+					s = dateObject.getFullYear();
+					switch (l) {
+					  case 1:
+						break;
+					  case 2:
+						s = String(s).substr(-2);
+						break;
+					  default:
+						pad = true;
+					}
+					break;
+				  case &quot;Q&quot;:
+				  case &quot;q&quot;:
+					s = Math.ceil((dateObject.getMonth() + 1) / 3);
+					switch (l) {
+					  case 1:
+					  case 2:
+						pad = true;
+						break;
+					  case 3:
+					  case 4:
+						dojo.unimplemented(&quot;Quarter format not implemented&quot;);
+					}
+					break;
+				  case &quot;M&quot;:
+				  case &quot;L&quot;:
+					var m = dateObject.getMonth();
+					var width;
+					switch (l) {
+					  case 1:
+					  case 2:
+						s = m + 1;
+						pad = true;
+						break;
+					  case 3:
+					  case 4:
+					  case 5:
+						width = widthList[l - 3];
+						break;
+					}
+					if (width) {
+						var type = (c == &quot;L&quot;) ? &quot;standalone&quot; : &quot;format&quot;;
+						var prop = [&quot;months&quot;, type, width].join(&quot;-&quot;);
+						s = info[prop][m];
+					}
+					break;
+				  case &quot;w&quot;:
+					var firstDay = 0;
+					s = dojo.date.getWeekOfYear(dateObject, firstDay);
+					pad = true;
+					break;
+				  case &quot;d&quot;:
+					s = dateObject.getDate();
+					pad = true;
+					break;
+				  case &quot;D&quot;:
+					s = dojo.date.getDayOfYear(dateObject);
+					pad = true;
+					break;
+				  case &quot;E&quot;:
+				  case &quot;e&quot;:
+				  case &quot;c&quot;:
+					var d = dateObject.getDay();
+					var width;
+					switch (l) {
+					  case 1:
+					  case 2:
+						if (c == &quot;e&quot;) {
+							var first = dojo.date.getFirstDayOfWeek(options.locale);
+							d = (d - first + 7) % 7;
+						}
+						if (c != &quot;c&quot;) {
+							s = d + 1;
+							pad = true;
+							break;
+						}
+					  case 3:
+					  case 4:
+					  case 5:
+						width = widthList[l - 3];
+						break;
+					}
+					if (width) {
+						var type = (c == &quot;c&quot;) ? &quot;standalone&quot; : &quot;format&quot;;
+						var prop = [&quot;days&quot;, type, width].join(&quot;-&quot;);
+						s = info[prop][d];
+					}
+					break;
+				  case &quot;a&quot;:
+					var timePeriod = (dateObject.getHours() &lt; 12) ? &quot;am&quot; : &quot;pm&quot;;
+					s = info[timePeriod];
+					break;
+				  case &quot;h&quot;:
+				  case &quot;H&quot;:
+				  case &quot;K&quot;:
+				  case &quot;k&quot;:
+					var h = dateObject.getHours();
+					switch (c) {
+					  case &quot;h&quot;:
+						s = (h % 12) || 12;
+						break;
+					  case &quot;H&quot;:
+						s = h;
+						break;
+					  case &quot;K&quot;:
+						s = (h % 12);
+						break;
+					  case &quot;k&quot;:
+						s = h || 24;
+						break;
+					}
+					pad = true;
+					break;
+				  case &quot;m&quot;:
+					s = dateObject.getMinutes();
+					pad = true;
+					break;
+				  case &quot;s&quot;:
+					s = dateObject.getSeconds();
+					pad = true;
+					break;
+				  case &quot;S&quot;:
+					s = Math.round(dateObject.getMilliseconds() * Math.pow(10, l - 3));
+					break;
+				  case &quot;v&quot;:
+				  case &quot;z&quot;:
+					s = dojo.date.getTimezoneName(dateObject);
+					if (s) {
+						break;
+					}
+					l = 4;
+				  case &quot;Z&quot;:
+					var offset = dateObject.getTimezoneOffset();
+					var tz = [(offset &lt;= 0 ? &quot;+&quot; : &quot;-&quot;), dojo.string.pad(Math.floor(Math.abs(offset) / 60), 2), dojo.string.pad(Math.abs(offset) % 60, 2)];
+					if (l == 4) {
+						tz.splice(0, 0, &quot;GMT&quot;);
+						tz.splice(3, 0, &quot;:&quot;);
+					}
+					s = tz.join(&quot;&quot;);
+					break;
+				  case &quot;Y&quot;:
+				  case &quot;u&quot;:
+				  case &quot;W&quot;:
+				  case &quot;F&quot;:
+				  case &quot;g&quot;:
+				  case &quot;A&quot;:
+					dojo.debug(match + &quot; modifier not yet implemented&quot;);
+					s = &quot;?&quot;;
+					break;
+				  default:
+					dojo.raise(&quot;dojo.date.format: invalid pattern char: &quot; + pattern);
+				}
+				if (pad) {
+					s = dojo.string.pad(s, l);
+				}
+				return s;
+			});
+		}
+		options = options || {};
+		var locale = dojo.hostenv.normalizeLocale(options.locale);
+		var formatLength = options.formatLength || &quot;full&quot;;
+		var info = dojo.date._getGregorianBundle(locale);
+		var str = [];
+		var sauce = dojo.lang.curry(this, formatPattern, dateObject);
+		if (options.selector != &quot;timeOnly&quot;) {
+			var datePattern = options.datePattern || info[&quot;dateFormat-&quot; + formatLength];
+			if (datePattern) {
+				str.push(_processPattern(datePattern, sauce));
+			}
+		}
+		if (options.selector != &quot;dateOnly&quot;) {
+			var timePattern = options.timePattern || info[&quot;timeFormat-&quot; + formatLength];
+			if (timePattern) {
+				str.push(_processPattern(timePattern, sauce));
+			}
+		}
+		var result = str.join(&quot; &quot;);
+		return result;
+	};
+	dojo.date.parse = function (value, options) {
+		options = options || {};
+		var locale = dojo.hostenv.normalizeLocale(options.locale);
+		var info = dojo.date._getGregorianBundle(locale);
+		var formatLength = options.formatLength || &quot;full&quot;;
+		if (!options.selector) {
+			options.selector = &quot;dateOnly&quot;;
+		}
+		var datePattern = options.datePattern || info[&quot;dateFormat-&quot; + formatLength];
+		var timePattern = options.timePattern || info[&quot;timeFormat-&quot; + formatLength];
+		var pattern;
+		if (options.selector == &quot;dateOnly&quot;) {
+			pattern = datePattern;
+		} else {
+			if (options.selector == &quot;timeOnly&quot;) {
+				pattern = timePattern;
+			} else {
+				if (options.selector == &quot;dateTime&quot;) {
+					pattern = datePattern + &quot; &quot; + timePattern;
+				} else {
+					var msg = &quot;dojo.date.parse: Unknown selector param passed: '&quot; + options.selector + &quot;'.&quot;;
+					msg += &quot; Defaulting to date pattern.&quot;;
+					dojo.debug(msg);
+					pattern = datePattern;
+				}
+			}
+		}
+		var groups = [];
+		var dateREString = _processPattern(pattern, dojo.lang.curry(this, _buildDateTimeRE, groups, info, options));
+		var dateRE = new RegExp(&quot;^&quot; + dateREString + &quot;$&quot;);
+		var match = dateRE.exec(value);
+		if (!match) {
+			return null;
+		}
+		var widthList = [&quot;abbr&quot;, &quot;wide&quot;, &quot;narrow&quot;];
+		var result = new Date(1972, 0);
+		var expected = {};
+		for (var i = 1; i &lt; match.length; i++) {
+			var grp = groups[i - 1];
+			var l = grp.length;
+			var v = match[i];
+			switch (grp.charAt(0)) {
+			  case &quot;y&quot;:
+				if (l != 2) {
+					result.setFullYear(v);
+					expected.year = v;
+				} else {
+					if (v &lt; 100) {
+						v = Number(v);
+						var year = &quot;&quot; + new Date().getFullYear();
+						var century = year.substring(0, 2) * 100;
+						var yearPart = Number(year.substring(2, 4));
+						var cutoff = Math.min(yearPart + 20, 99);
+						var num = (v &lt; cutoff) ? century + v : century - 100 + v;
+						result.setFullYear(num);
+						expected.year = num;
+					} else {
+						if (options.strict) {
+							return null;
+						}
+						result.setFullYear(v);
+						expected.year = v;
+					}
+				}
+				break;
+			  case &quot;M&quot;:
+				if (l &gt; 2) {
+					if (!options.strict) {
+						v = v.replace(/\./g, &quot;&quot;);
+						v = v.toLowerCase();
+					}
+					var months = info[&quot;months-format-&quot; + widthList[l - 3]].concat();
+					for (var j = 0; j &lt; months.length; j++) {
+						if (!options.strict) {
+							months[j] = months[j].toLowerCase();
+						}
+						if (v == months[j]) {
+							result.setMonth(j);
+							expected.month = j;
+							break;
+						}
+					}
+					if (j == months.length) {
+						dojo.debug(&quot;dojo.date.parse: Could not parse month name: '&quot; + v + &quot;'.&quot;);
+						return null;
+					}
+				} else {
+					result.setMonth(v - 1);
+					expected.month = v - 1;
+				}
+				break;
+			  case &quot;E&quot;:
+			  case &quot;e&quot;:
+				if (!options.strict) {
+					v = v.toLowerCase();
+				}
+				var days = info[&quot;days-format-&quot; + widthList[l - 3]].concat();
+				for (var j = 0; j &lt; days.length; j++) {
+					if (!options.strict) {
+						days[j] = days[j].toLowerCase();
+					}
+					if (v == days[j]) {
+						break;
+					}
+				}
+				if (j == days.length) {
+					dojo.debug(&quot;dojo.date.parse: Could not parse weekday name: '&quot; + v + &quot;'.&quot;);
+					return null;
+				}
+				break;
+			  case &quot;d&quot;:
+				result.setDate(v);
+				expected.date = v;
+				break;
+			  case &quot;a&quot;:
+				var am = options.am || info.am;
+				var pm = options.pm || info.pm;
+				if (!options.strict) {
+					v = v.replace(/\./g, &quot;&quot;).toLowerCase();
+					am = am.replace(/\./g, &quot;&quot;).toLowerCase();
+					pm = pm.replace(/\./g, &quot;&quot;).toLowerCase();
+				}
+				if (options.strict &amp;&amp; v != am &amp;&amp; v != pm) {
+					dojo.debug(&quot;dojo.date.parse: Could not parse am/pm part.&quot;);
+					return null;
+				}
+				var hours = result.getHours();
+				if (v == pm &amp;&amp; hours &lt; 12) {
+					result.setHours(hours + 12);
+				} else {
+					if (v == am &amp;&amp; hours == 12) {
+						result.setHours(0);
+					}
+				}
+				break;
+			  case &quot;K&quot;:
+				if (v == 24) {
+					v = 0;
+				}
+			  case &quot;h&quot;:
+			  case &quot;H&quot;:
+			  case &quot;k&quot;:
+				if (v &gt; 23) {
+					dojo.debug(&quot;dojo.date.parse: Illegal hours value&quot;);
+					return null;
+				}
+				result.setHours(v);
+				break;
+			  case &quot;m&quot;:
+				result.setMinutes(v);
+				break;
+			  case &quot;s&quot;:
+				result.setSeconds(v);
+				break;
+			  case &quot;S&quot;:
+				result.setMilliseconds(v);
+				break;
+			  default:
+				dojo.unimplemented(&quot;dojo.date.parse: unsupported pattern char=&quot; + grp.charAt(0));
+			}
+		}
+		if (expected.year &amp;&amp; result.getFullYear() != expected.year) {
+			dojo.debug(&quot;Parsed year: '&quot; + result.getFullYear() + &quot;' did not match input year: '&quot; + expected.year + &quot;'.&quot;);
+			return null;
+		}
+		if (expected.month &amp;&amp; result.getMonth() != expected.month) {
+			dojo.debug(&quot;Parsed month: '&quot; + result.getMonth() + &quot;' did not match input month: '&quot; + expected.month + &quot;'.&quot;);
+			return null;
+		}
+		if (expected.date &amp;&amp; result.getDate() != expected.date) {
+			dojo.debug(&quot;Parsed day of month: '&quot; + result.getDate() + &quot;' did not match input day of month: '&quot; + expected.date + &quot;'.&quot;);
+			return null;
+		}
+		return result;
+	};
+	function _processPattern(pattern, applyPattern, applyLiteral, applyAll) {
+		var identity = function (x) {
+			return x;
+		};
+		applyPattern = applyPattern || identity;
+		applyLiteral = applyLiteral || identity;
+		applyAll = applyAll || identity;
+		var chunks = pattern.match(/(''|[^'])+/g);
+		var literal = false;
+		for (var i = 0; i &lt; chunks.length; i++) {
+			if (!chunks[i]) {
+				chunks[i] = &quot;&quot;;
+			} else {
+				chunks[i] = (literal ? applyLiteral : applyPattern)(chunks[i]);
+				literal = !literal;
+			}
+		}
+		return applyAll(chunks.join(&quot;&quot;));
+	}
+	function _buildDateTimeRE(groups, info, options, pattern) {
+		return pattern.replace(/([a-z])\1*/ig, function (match) {
+			var s;
+			var c = match.charAt(0);
+			var l = match.length;
+			switch (c) {
+			  case &quot;y&quot;:
+				s = &quot;\\d&quot; + ((l == 2) ? &quot;{2,4}&quot; : &quot;+&quot;);
+				break;
+			  case &quot;M&quot;:
+				s = (l &gt; 2) ? &quot;\\S+&quot; : &quot;\\d{1,2}&quot;;
+				break;
+			  case &quot;d&quot;:
+				s = &quot;\\d{1,2}&quot;;
+				break;
+			  case &quot;E&quot;:
+				s = &quot;\\S+&quot;;
+				break;
+			  case &quot;h&quot;:
+			  case &quot;H&quot;:
+			  case &quot;K&quot;:
+			  case &quot;k&quot;:
+				s = &quot;\\d{1,2}&quot;;
+				break;
+			  case &quot;m&quot;:
+			  case &quot;s&quot;:
+				s = &quot;[0-5]\\d&quot;;
+				break;
+			  case &quot;S&quot;:
+				s = &quot;\\d{1,3}&quot;;
+				break;
+			  case &quot;a&quot;:
+				var am = options.am || info.am || &quot;AM&quot;;
+				var pm = options.pm || info.pm || &quot;PM&quot;;
+				if (options.strict) {
+					s = am + &quot;|&quot; + pm;
+				} else {
+					s = am;
+					s += (am != am.toLowerCase()) ? &quot;|&quot; + am.toLowerCase() : &quot;&quot;;
+					s += &quot;|&quot;;
+					s += (pm != pm.toLowerCase()) ? pm + &quot;|&quot; + pm.toLowerCase() : pm;
+				}
+				break;
+			  default:
+				dojo.unimplemented(&quot;parse of date format, pattern=&quot; + pattern);
+			}
+			if (groups) {
+				groups.push(match);
+			}
+			return &quot;\\s*(&quot; + s + &quot;)\\s*&quot;;
+		});
+	}
+})();
+dojo.date.strftime = function (dateObject, format, locale) {
+	var padChar = null;
+	function _(s, n) {
+		return dojo.string.pad(s, n || 2, padChar || &quot;0&quot;);
+	}
+	var info = dojo.date._getGregorianBundle(locale);
+	function $(property) {
+		switch (property) {
+		  case &quot;a&quot;:
+			return dojo.date.getDayShortName(dateObject, locale);
+		  case &quot;A&quot;:
+			return dojo.date.getDayName(dateObject, locale);
+		  case &quot;b&quot;:
+		  case &quot;h&quot;:
+			return dojo.date.getMonthShortName(dateObject, locale);
+		  case &quot;B&quot;:
+			return dojo.date.getMonthName(dateObject, locale);
+		  case &quot;c&quot;:
+			return dojo.date.format(dateObject, {locale:locale});
+		  case &quot;C&quot;:
+			return _(Math.floor(dateObject.getFullYear() / 100));
+		  case &quot;d&quot;:
+			return _(dateObject.getDate());
+		  case &quot;D&quot;:
+			return $(&quot;m&quot;) + &quot;/&quot; + $(&quot;d&quot;) + &quot;/&quot; + $(&quot;y&quot;);
+		  case &quot;e&quot;:
+			if (padChar == null) {
+				padChar = &quot; &quot;;
+			}
+			return _(dateObject.getDate());
+		  case &quot;f&quot;:
+			if (padChar == null) {
+				padChar = &quot; &quot;;
+			}
+			return _(dateObject.getMonth() + 1);
+		  case &quot;g&quot;:
+			break;
+		  case &quot;G&quot;:
+			dojo.unimplemented(&quot;unimplemented modifier 'G'&quot;);
+			break;
+		  case &quot;F&quot;:
+			return $(&quot;Y&quot;) + &quot;-&quot; + $(&quot;m&quot;) + &quot;-&quot; + $(&quot;d&quot;);
+		  case &quot;H&quot;:
+			return _(dateObject.getHours());
+		  case &quot;I&quot;:
+			return _(dateObject.getHours() % 12 || 12);
+		  case &quot;j&quot;:
+			return _(dojo.date.getDayOfYear(dateObject), 3);
+		  case &quot;k&quot;:
+			if (padChar == null) {
+				padChar = &quot; &quot;;
+			}
+			return _(dateObject.getHours());
+		  case &quot;l&quot;:
+			if (padChar == null) {
+				padChar = &quot; &quot;;
+			}
+			return _(dateObject.getHours() % 12 || 12);
+		  case &quot;m&quot;:
+			return _(dateObject.getMonth() + 1);
+		  case &quot;M&quot;:
+			return _(dateObject.getMinutes());
+		  case &quot;n&quot;:
+			return &quot;\n&quot;;
+		  case &quot;p&quot;:
+			return info[dateObject.getHours() &lt; 12 ? &quot;am&quot; : &quot;pm&quot;];
+		  case &quot;r&quot;:
+			return $(&quot;I&quot;) + &quot;:&quot; + $(&quot;M&quot;) + &quot;:&quot; + $(&quot;S&quot;) + &quot; &quot; + $(&quot;p&quot;);
+		  case &quot;R&quot;:
+			return $(&quot;H&quot;) + &quot;:&quot; + $(&quot;M&quot;);
+		  case &quot;S&quot;:
+			return _(dateObject.getSeconds());
+		  case &quot;t&quot;:
+			return &quot;\t&quot;;
+		  case &quot;T&quot;:
+			return $(&quot;H&quot;) + &quot;:&quot; + $(&quot;M&quot;) + &quot;:&quot; + $(&quot;S&quot;);
+		  case &quot;u&quot;:
+			return String(dateObject.getDay() || 7);
+		  case &quot;U&quot;:
+			return _(dojo.date.getWeekOfYear(dateObject));
+		  case &quot;V&quot;:
+			return _(dojo.date.getIsoWeekOfYear(dateObject));
+		  case &quot;W&quot;:
+			return _(dojo.date.getWeekOfYear(dateObject, 1));
+		  case &quot;w&quot;:
+			return String(dateObject.getDay());
+		  case &quot;x&quot;:
+			return dojo.date.format(dateObject, {selector:&quot;dateOnly&quot;, locale:locale});
+		  case &quot;X&quot;:
+			return dojo.date.format(dateObject, {selector:&quot;timeOnly&quot;, locale:locale});
+		  case &quot;y&quot;:
+			return _(dateObject.getFullYear() % 100);
+		  case &quot;Y&quot;:
+			return String(dateObject.getFullYear());
+		  case &quot;z&quot;:
+			var timezoneOffset = dateObject.getTimezoneOffset();
+			return (timezoneOffset &gt; 0 ? &quot;-&quot; : &quot;+&quot;) + _(Math.floor(Math.abs(timezoneOffset) / 60)) + &quot;:&quot; + _(Math.abs(timezoneOffset) % 60);
+		  case &quot;Z&quot;:
+			return dojo.date.getTimezoneName(dateObject);
+		  case &quot;%&quot;:
+			return &quot;%&quot;;
+		}
+	}
+	var string = &quot;&quot;;
+	var i = 0;
+	var index = 0;
+	var switchCase = null;
+	while ((index = format.indexOf(&quot;%&quot;, i)) != -1) {
+		string += format.substring(i, index++);
+		switch (format.charAt(index++)) {
+		  case &quot;_&quot;:
+			padChar = &quot; &quot;;
+			break;
+		  case &quot;-&quot;:
+			padChar = &quot;&quot;;
+			break;
+		  case &quot;0&quot;:
+			padChar = &quot;0&quot;;
+			break;
+		  case &quot;^&quot;:
+			switchCase = &quot;upper&quot;;
+			break;
+		  case &quot;*&quot;:
+			switchCase = &quot;lower&quot;;
+			break;
+		  case &quot;#&quot;:
+			switchCase = &quot;swap&quot;;
+			break;
+		  default:
+			padChar = null;
+			index--;
+			break;
+		}
+		var property = $(format.charAt(index++));
+		switch (switchCase) {
+		  case &quot;upper&quot;:
+			property = property.toUpperCase();
+			break;
+		  case &quot;lower&quot;:
+			property = property.toLowerCase();
+			break;
+		  case &quot;swap&quot;:
+			var compareString = property.toLowerCase();
+			var swapString = &quot;&quot;;
+			var j = 0;
+			var ch = &quot;&quot;;
+			while (j &lt; property.length) {
+				ch = property.charAt(j);
+				swapString += (ch == compareString.charAt(j)) ? ch.toUpperCase() : ch.toLowerCase();
+				j++;
+			}
+			property = swapString;
+			break;
+		  default:
+			break;
+		}
+		switchCase = null;
+		string += property;
+		i = index;
+	}
+	string += format.substring(i);
+	return string;
+};
+(function () {
+	var _customFormats = [];
+	dojo.date.addCustomFormats = function (packageName, bundleName) {
+		_customFormats.push({pkg:packageName, name:bundleName});
+	};
+	dojo.date._getGregorianBundle = function (locale) {
+		var gregorian = {};
+		dojo.lang.forEach(_customFormats, function (desc) {
+			var bundle = dojo.i18n.getLocalization(desc.pkg, desc.name, locale);
+			gregorian = dojo.lang.mixin(gregorian, bundle);
+		}, this);
+		return gregorian;
+	};
+})();
+dojo.date.addCustomFormats(&quot;dojo.i18n.calendar&quot;, &quot;gregorian&quot;);
+dojo.date.addCustomFormats(&quot;dojo.i18n.calendar&quot;, &quot;gregorianExtras&quot;);
+dojo.date.getNames = function (item, type, use, locale) {
+	var label;
+	var lookup = dojo.date._getGregorianBundle(locale);
+	var props = [item, use, type];
+	if (use == &quot;standAlone&quot;) {
+		label = lookup[props.join(&quot;-&quot;)];
+	}
+	props[1] = &quot;format&quot;;
+	return (label || lookup[props.join(&quot;-&quot;)]).concat();
+};
+dojo.date.getDayName = function (dateObject, locale) {
+	return dojo.date.getNames(&quot;days&quot;, &quot;wide&quot;, &quot;format&quot;, locale)[dateObject.getDay()];
+};
+dojo.date.getDayShortName = function (dateObject, locale) {
+	return dojo.date.getNames(&quot;days&quot;, &quot;abbr&quot;, &quot;format&quot;, locale)[dateObject.getDay()];
+};
+dojo.date.getMonthName = function (dateObject, locale) {
+	return dojo.date.getNames(&quot;months&quot;, &quot;wide&quot;, &quot;format&quot;, locale)[dateObject.getMonth()];
+};
+dojo.date.getMonthShortName = function (dateObject, locale) {
+	return dojo.date.getNames(&quot;months&quot;, &quot;abbr&quot;, &quot;format&quot;, locale)[dateObject.getMonth()];
+};
+dojo.date.toRelativeString = function (dateObject) {
+	var now = new Date();
+	var diff = (now - dateObject) / 1000;
+	var end = &quot; ago&quot;;
+	var future = false;
+	if (diff &lt; 0) {
+		future = true;
+		end = &quot; from now&quot;;
+		diff = -diff;
+	}
+	if (diff &lt; 60) {
+		diff = Math.round(diff);
+		return diff + &quot; second&quot; + (diff == 1 ? &quot;&quot; : &quot;s&quot;) + end;
+	}
+	if (diff &lt; 60 * 60) {
+		diff = Math.round(diff / 60);
+		return diff + &quot; minute&quot; + (diff == 1 ? &quot;&quot; : &quot;s&quot;) + end;
+	}
+	if (diff &lt; 60 * 60 * 24) {
+		diff = Math.round(diff / 3600);
+		return diff + &quot; hour&quot; + (diff == 1 ? &quot;&quot; : &quot;s&quot;) + end;
+	}
+	if (diff &lt; 60 * 60 * 24 * 7) {
+		diff = Math.round(diff / (3600 * 24));
+		if (diff == 1) {
+			return future ? &quot;Tomorrow&quot; : &quot;Yesterday&quot;;
+		} else {
+			return diff + &quot; days&quot; + end;
+		}
+	}
+	return dojo.date.format(dateObject);
+};
+dojo.date.toSql = function (dateObject, noTime) {
+	return dojo.date.strftime(dateObject, &quot;%F&quot; + !noTime ? &quot; %T&quot; : &quot;&quot;);
+};
+dojo.date.fromSql = function (sqlDate) {
+	var parts = sqlDate.split(/[\- :]/g);
+	while (parts.length &lt; 6) {
+		parts.push(0);
+	}
+	return new Date(parts[0], (parseInt(parts[1], 10) - 1), parts[2], parts[3], parts[4], parts[5]);
+};
+

Added: tags/parley-0.55/root/static/magic/src/date/serialize.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/date/serialize.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/date/serialize.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,129 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.date.serialize&quot;);
+dojo.require(&quot;dojo.string.common&quot;);
+dojo.date.setIso8601 = function (dateObject, formattedString) {
+	var comps = (formattedString.indexOf(&quot;T&quot;) == -1) ? formattedString.split(&quot; &quot;) : formattedString.split(&quot;T&quot;);
+	dateObject = dojo.date.setIso8601Date(dateObject, comps[0]);
+	if (comps.length == 2) {
+		dateObject = dojo.date.setIso8601Time(dateObject, comps[1]);
+	}
+	return dateObject;
+};
+dojo.date.fromIso8601 = function (formattedString) {
+	return dojo.date.setIso8601(new Date(0, 0), formattedString);
+};
+dojo.date.setIso8601Date = function (dateObject, formattedString) {
+	var regexp = &quot;^([0-9]{4})((-?([0-9]{2})(-?([0-9]{2}))?)|&quot; + &quot;(-?([0-9]{3}))|(-?W([0-9]{2})(-?([1-7]))?))?$&quot;;
+	var d = formattedString.match(new RegExp(regexp));
+	if (!d) {
+		dojo.debug(&quot;invalid date string: &quot; + formattedString);
+		return null;
+	}
+	var year = d[1];
+	var month = d[4];
+	var date = d[6];
+	var dayofyear = d[8];
+	var week = d[10];
+	var dayofweek = d[12] ? d[12] : 1;
+	dateObject.setFullYear(year);
+	if (dayofyear) {
+		dateObject.setMonth(0);
+		dateObject.setDate(Number(dayofyear));
+	} else {
+		if (week) {
+			dateObject.setMonth(0);
+			dateObject.setDate(1);
+			var gd = dateObject.getDay();
+			var day = gd ? gd : 7;
+			var offset = Number(dayofweek) + (7 * Number(week));
+			if (day &lt;= 4) {
+				dateObject.setDate(offset + 1 - day);
+			} else {
+				dateObject.setDate(offset + 8 - day);
+			}
+		} else {
+			if (month) {
+				dateObject.setDate(1);
+				dateObject.setMonth(month - 1);
+			}
+			if (date) {
+				dateObject.setDate(date);
+			}
+		}
+	}
+	return dateObject;
+};
+dojo.date.fromIso8601Date = function (formattedString) {
+	return dojo.date.setIso8601Date(new Date(0, 0), formattedString);
+};
+dojo.date.setIso8601Time = function (dateObject, formattedString) {
+	var timezone = &quot;Z|(([-+])([0-9]{2})(:?([0-9]{2}))?)$&quot;;
+	var d = formattedString.match(new RegExp(timezone));
+	var offset = 0;
+	if (d) {
+		if (d[0] != &quot;Z&quot;) {
+			offset = (Number(d[3]) * 60) + Number(d[5]);
+			offset *= ((d[2] == &quot;-&quot;) ? 1 : -1);
+		}
+		offset -= dateObject.getTimezoneOffset();
+		formattedString = formattedString.substr(0, formattedString.length - d[0].length);
+	}
+	var regexp = &quot;^([0-9]{2})(:?([0-9]{2})(:?([0-9]{2})(.([0-9]+))?)?)?$&quot;;
+	d = formattedString.match(new RegExp(regexp));
+	if (!d) {
+		dojo.debug(&quot;invalid time string: &quot; + formattedString);
+		return null;
+	}
+	var hours = d[1];
+	var mins = Number((d[3]) ? d[3] : 0);
+	var secs = (d[5]) ? d[5] : 0;
+	var ms = d[7] ? (Number(&quot;0.&quot; + d[7]) * 1000) : 0;
+	dateObject.setHours(hours);
+	dateObject.setMinutes(mins);
+	dateObject.setSeconds(secs);
+	dateObject.setMilliseconds(ms);
+	if (offset !== 0) {
+		dateObject.setTime(dateObject.getTime() + offset * 60000);
+	}
+	return dateObject;
+};
+dojo.date.fromIso8601Time = function (formattedString) {
+	return dojo.date.setIso8601Time(new Date(0, 0), formattedString);
+};
+dojo.date.toRfc3339 = function (dateObject, selector) {
+	if (!dateObject) {
+		dateObject = new Date();
+	}
+	var _ = dojo.string.pad;
+	var formattedDate = [];
+	if (selector != &quot;timeOnly&quot;) {
+		var date = [_(dateObject.getFullYear(), 4), _(dateObject.getMonth() + 1, 2), _(dateObject.getDate(), 2)].join(&quot;-&quot;);
+		formattedDate.push(date);
+	}
+	if (selector != &quot;dateOnly&quot;) {
+		var time = [_(dateObject.getHours(), 2), _(dateObject.getMinutes(), 2), _(dateObject.getSeconds(), 2)].join(&quot;:&quot;);
+		var timezoneOffset = dateObject.getTimezoneOffset();
+		time += (timezoneOffset &gt; 0 ? &quot;-&quot; : &quot;+&quot;) + _(Math.floor(Math.abs(timezoneOffset) / 60), 2) + &quot;:&quot; + _(Math.abs(timezoneOffset) % 60, 2);
+		formattedDate.push(time);
+	}
+	return formattedDate.join(&quot;T&quot;);
+};
+dojo.date.fromRfc3339 = function (rfcDate) {
+	if (rfcDate.indexOf(&quot;Tany&quot;) != -1) {
+		rfcDate = rfcDate.replace(&quot;Tany&quot;, &quot;&quot;);
+	}
+	var dateObject = new Date();
+	return dojo.date.setIso8601(dateObject, rfcDate);
+};
+

Added: tags/parley-0.55/root/static/magic/src/date/supplemental.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/date/supplemental.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/date/supplemental.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,47 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.date.supplemental&quot;);
+dojo.date.getFirstDayOfWeek = function (locale) {
+	var firstDay = {mv:5, ae:6, af:6, bh:6, dj:6, dz:6, eg:6, er:6, et:6, iq:6, ir:6, jo:6, ke:6, kw:6, lb:6, ly:6, ma:6, om:6, qa:6, sa:6, sd:6, so:6, tn:6, ye:6, as:0, au:0, az:0, bw:0, ca:0, cn:0, fo:0, ge:0, gl:0, gu:0, hk:0, ie:0, il:0, is:0, jm:0, jp:0, kg:0, kr:0, la:0, mh:0, mo:0, mp:0, mt:0, nz:0, ph:0, pk:0, sg:0, th:0, tt:0, tw:0, um:0, us:0, uz:0, vi:0, za:0, zw:0, et:0, mw:0, ng:0, tj:0, gb:0, sy:4};
+	locale = dojo.hostenv.normalizeLocale(locale);
+	var country = locale.split(&quot;-&quot;)[1];
+	var dow = firstDay[country];
+	return (typeof dow == &quot;undefined&quot;) ? 1 : dow;
+};
+dojo.date.getWeekend = function (locale) {
+	var weekendStart = {eg:5, il:5, sy:5, &quot;in&quot;:0, ae:4, bh:4, dz:4, iq:4, jo:4, kw:4, lb:4, ly:4, ma:4, om:4, qa:4, sa:4, sd:4, tn:4, ye:4};
+	var weekendEnd = {ae:5, bh:5, dz:5, iq:5, jo:5, kw:5, lb:5, ly:5, ma:5, om:5, qa:5, sa:5, sd:5, tn:5, ye:5, af:5, ir:5, eg:6, il:6, sy:6};
+	locale = dojo.hostenv.normalizeLocale(locale);
+	var country = locale.split(&quot;-&quot;)[1];
+	var start = weekendStart[country];
+	var end = weekendEnd[country];
+	if (typeof start == &quot;undefined&quot;) {
+		start = 6;
+	}
+	if (typeof end == &quot;undefined&quot;) {
+		end = 0;
+	}
+	return {start:start, end:end};
+};
+dojo.date.isWeekend = function (dateObj, locale) {
+	var weekend = dojo.date.getWeekend(locale);
+	var day = (dateObj || new Date()).getDay();
+	if (weekend.end &lt; weekend.start) {
+		weekend.end += 7;
+		if (day &lt; weekend.start) {
+			day += 7;
+		}
+	}
+	return day &gt;= weekend.start &amp;&amp; day &lt;= weekend.end;
+};
+

Added: tags/parley-0.55/root/static/magic/src/date.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/date.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/date.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.date&quot;);
+dojo.deprecated(&quot;dojo.date&quot;, &quot;use one of the modules in dojo.date.* instead&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/debug/Firebug.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/debug/Firebug.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/debug/Firebug.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,57 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.debug.Firebug&quot;);
+dojo.deprecated(&quot;dojo.debug.Firebug is slated for removal in 0.5; use dojo.debug.console instead.&quot;, &quot;0.5&quot;);
+if (dojo.render.html.moz) {
+	if (console &amp;&amp; console.log) {
+		var consoleLog = function () {
+			if (!djConfig.isDebug) {
+				return;
+			}
+			var args = dojo.lang.toArray(arguments);
+			args.splice(0, 0, &quot;DEBUG: &quot;);
+			console.log.apply(console, args);
+		};
+		dojo.debug = consoleLog;
+		dojo.debugDeep = consoleLog;
+		dojo.debugShallow = function (obj) {
+			if (!djConfig.isDebug) {
+				return;
+			}
+			if (dojo.lang.isArray(obj)) {
+				console.log(&quot;Array: &quot;, obj);
+				for (var i = 0; x &lt; obj.length; i++) {
+					console.log(&quot;	&quot;, &quot;[&quot; + i + &quot;]&quot;, obj[i]);
+				}
+			} else {
+				console.log(&quot;Object: &quot;, obj);
+				var propNames = [];
+				for (var prop in obj) {
+					propNames.push(prop);
+				}
+				propNames.sort();
+				dojo.lang.forEach(propNames, function (prop) {
+					try {
+						console.log(&quot;	&quot;, prop, obj[prop]);
+					}
+					catch (e) {
+						console.log(&quot;	&quot;, prop, &quot;ERROR&quot;, e.message, e);
+					}
+				});
+			}
+		};
+	} else {
+		dojo.debug(&quot;dojo.debug.Firebug requires Firebug &gt; 0.4&quot;);
+	}
+}
+

Added: tags/parley-0.55/root/static/magic/src/debug/arrow_hide.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/debug/arrow_hide.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/debug/arrow_show.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/debug/arrow_show.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/debug/console.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/debug/console.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/debug/console.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,97 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.debug.console&quot;);
+dojo.require(&quot;dojo.logging.ConsoleLogger&quot;);
+if (window.console) {
+	if (console.info != null) {
+		dojo.hostenv.println = function () {
+			if (!djConfig.isDebug) {
+				return;
+			}
+			console.info.apply(console, arguments);
+		};
+		dojo.debug = dojo.hostenv.println;
+		dojo.debugDeep = dojo.debug;
+		dojo.debugShallow = function (obj, showMethods, sort) {
+			if (!djConfig.isDebug) {
+				return;
+			}
+			showMethods = (showMethods != false);
+			sort = (sort != false);
+			if (obj == null || obj.constructor == null) {
+				return dojo.debug(obj);
+			}
+			var type = obj.declaredClass;
+			if (type == null) {
+				type = obj.constructor.toString().match(/function\s*(.*)\(/);
+				if (type) {
+					type = type[1];
+				}
+			}
+			if (type) {
+				if (type == &quot;String&quot; || type == &quot;Number&quot;) {
+					return dojo.debug(type + &quot;: &quot;, obj);
+				}
+				if (showMethods &amp;&amp; !sort) {
+					var sortedObj = obj;
+				} else {
+					var propNames = [];
+					if (showMethods) {
+						for (var prop in obj) {
+							propNames.push(prop);
+						}
+					} else {
+						for (var prop in obj) {
+							if (typeof obj[prop] != &quot;function&quot;) {
+								propNames.push(prop);
+							} else {
+								dojo.debug(prop);
+							}
+						}
+					}
+					if (sort) {
+						propNames.sort();
+					}
+					var sortedObj = {};
+					dojo.lang.forEach(propNames, function (prop) {
+						sortedObj[prop] = obj[prop];
+					});
+				}
+				return dojo.debug(type + &quot;: %o\n%2.o&quot;, obj, sortedObj);
+			}
+			return dojo.debug(obj.constructor + &quot;: &quot;, obj);
+		};
+	} else {
+		if (console.log != null) {
+			dojo.hostenv.println = function () {
+				if (!djConfig.isDebug) {
+					return;
+				}
+				var args = dojo.lang.toArray(arguments);
+				console.log(&quot;DEBUG: &quot; + args.join(&quot; &quot;));
+			};
+			dojo.debug = dojo.hostenv.println;
+		} else {
+			dojo.debug(&quot;dojo.debug.console requires Firebug &gt; 0.4&quot;);
+		}
+	}
+} else {
+	if (dojo.render.html.opera) {
+		if (opera &amp;&amp; opera.postError) {
+			dojo.hostenv.println = opera.postError;
+		} else {
+			dojo.debug(&quot;dojo.debug.Opera requires Opera &gt; 8.0&quot;);
+		}
+	}
+}
+

Added: tags/parley-0.55/root/static/magic/src/debug/deep.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/debug/deep.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/debug/deep.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,362 @@
+&lt;html&gt;
+&lt;head&gt;
+&lt;title&gt;Deep Debugger&lt;/title&gt;
+&lt;script&gt;
+
+var tableRows = {};
+var tableCels = {};
+var tableObjs = {};
+var tablesBuilt = {};
+var tableShows = {};
+var tableHides = {};
+
+// IE: nodes w/id need to be redeclared or getElementById is b0rked
+var frame = null;
+
+window.onload = function(){
+	// if IE loads this page too quickly (instantly) then 
+	// window.debugVar might not have been set
+	window.setTimeout(startMeUp, 100);
+}
+
+function startMeUp(){
+	frame = document.getElementById('frame');
+	// GET string 
+	var index = location.search.split(&quot;=&quot;).pop();
+	var debugObj = window.opener.dojo.debugDeep;
+	var debugVar = debugObj.debugVars[index] || window.debugVar;
+	buildTable('root', frame, debugVar);
+}
+
+function buildTable(path, parent, obj){
+	var keys = [];
+	var vals = [];
+	for(var prop in obj){
+		keys.push(prop);
+		try {
+			vals[prop] = obj[prop];
+		} catch(E) {
+			vals[prop] = 'ERROR: ' + E.message;
+		}
+	}
+	keys.sort(keySorter);
+
+	if (!keys.length){
+
+		var div = document.createElement('div');
+		div.appendChild(document.createTextNode('Object has no properties.'));
+
+		parent.appendChild(div);
+		return;
+	}
+
+
+	var t = document.createElement('table');
+	t.border = &quot;1&quot;;
+
+	var tb = document.createElement('tbody');
+	t.appendChild(tb);
+
+
+	for(var i = 0; i &lt; keys.length; i++) {
+		buildTableRow(path+'-'+keys[i], tb, keys[i], vals[keys[i]]);
+	}
+
+	if (path == 'root'){
+		//t.style.width = '90%';
+	}
+	t.style.width = '100%';
+
+	parent.appendChild(t);
+
+	tablesBuilt[path] = true;
+}
+
+function buildTableRow(path, tb, name, value) {
+
+	var simpleType = typeof(value);
+	var createSubrow = (simpleType == 'object');
+	var complexType = simpleType;
+
+	if (simpleType == 'object'){
+		var cls = getConstructorClass(value);
+		if (cls){
+			if (cls == 'Object'){
+			}else if (cls == 'Array'){
+				complexType = 'array';
+			}else{
+				complexType += ' ('+cls+')';
+			}
+		}
+	}
+
+/*var tr1 = document.createElement('tr');
+	var td1 = document.createElement('td');
+	var td2 = document.createElement('td');
+	var td3 = document.createElement('td');
+	var td4 = document.createElement('td');*/
+
+	var row = tb.rows.length;
+	var tr1 = tb.insertRow(row++);
+	var td1 = tr1.insertCell(0);
+	var td2 = tr1.insertCell(1);
+	var td3 = tr1.insertCell(2);
+	var td4 = tr1.insertCell(3);
+	
+	tr1.style.verticalAlign = 'top';
+	td1.style.verticalAlign = 'middle';
+
+	td1.className = 'propPlus';
+	td2.className = 'propName';
+	td3.className = 'propType';
+	td4.className = 'propVal';
+
+	//tr1.appendChild(td1);
+	//tr1.appendChild(td2);
+	//tr1.appendChild(td3);
+	//tr1.appendChild(td4);
+
+	if (createSubrow){
+		var img1 = document.createElement('img');
+		img1.width = 9;
+		img1.height = 9;
+		img1.src = 'arrow_show.gif';
+		var a1 = document.createElement('a');
+		a1.appendChild(img1);
+		a1.href = '#';
+		a1.onclick = function(){ showTableRow(path); return false; };
+
+		var img2 = document.createElement('img');
+		img2.width = 9;
+		img2.height = 9;
+		img2.src = 'arrow_hide.gif';
+		var a2 = document.createElement('a');
+		a2.appendChild(img2);
+		a2.href = '#';
+		a2.onclick = function(){ hideTableRow(path); return false; };
+		a2.style.display = 'none';
+
+		tableShows[path] = a1;
+		tableHides[path] = a2;
+
+		td1.appendChild(a1);
+		td1.appendChild(a2);
+	}else{
+		var img = document.createElement('img');
+		img.width = 9;
+		img.height = 9;
+		img.src = 'spacer.gif';
+
+		td1.appendChild(img);
+	}
+
+	td2.appendChild(document.createTextNode(name));
+	td3.appendChild(document.createTextNode(complexType));
+	td4.appendChild(buildPreBlock(value));
+
+	//tb.appendChild(tr1);
+
+	if (createSubrow){
+		var tr2 = tb.insertRow(row++);
+		var td5 = tr2.insertCell(0);
+		var td6 = tr2.insertCell(1);
+		
+		//var tr2 = document.createElement('tr');
+		//var td5 = document.createElement('td');
+		//var td6 = document.createElement('td');
+
+		td5.innerHTML = '&nbsp;';
+		//td6.innerHTML = '&nbsp;';
+
+		td6.colSpan = '3';
+
+		tr2.appendChild(td5);
+		tr2.appendChild(td6);
+
+		tr2.style.display = 'none';
+
+		tb.appendChild(tr2);
+
+		tableRows[path] = tr2;
+		tableCels[path] = td6;
+		tableObjs[path] = value;
+	}
+}
+
+function showTableRow(path){
+
+	var tr = tableRows[path];
+	var td = tableCels[path];
+	var a1 = tableShows[path];
+	var a2 = tableHides[path];
+
+	if (!tablesBuilt[path]){
+
+		//alert('building table for '+path);
+		buildTable(path, td, tableObjs[path]);
+	}
+
+	tr.style.display = 'table-row';
+
+	a1.style.display = 'none';
+	a2.style.display = 'inline';
+}
+
+function hideTableRow(path){
+
+	var tr = tableRows[path];
+	var a1 = tableShows[path];
+	var a2 = tableHides[path];
+
+	tr.style.display = 'none';
+
+	a1.style.display = 'inline';
+	a2.style.display = 'none';
+}
+
+function buildPreBlock(value){
+
+	//
+	// how many lines ?
+	//
+
+	var s = ''+value;
+	s = s.replace(&quot;\r\n&quot;, &quot;\n&quot;);
+	s = s.replace(&quot;\r&quot;, &quot;&quot;);
+	var lines = s.split(&quot;\n&quot;);
+
+
+	if (lines.length &lt; 2){
+
+		if (lines[0].length &lt; 60){
+
+			var pre = document.createElement('pre');
+			pre.appendChild(document.createTextNode(s));
+			return pre;
+		}
+	}
+
+
+	//
+	// multiple lines :(
+	//
+
+	var preview = lines[0].substr(0, 60) + ' ...';
+
+	var pre1 = document.createElement('pre');
+	pre1.appendChild(document.createTextNode(preview));
+	pre1.className = 'clicky';
+
+	var pre2 = document.createElement('pre');
+	pre2.appendChild(document.createTextNode(s));
+	pre2.style.display = 'none';
+	pre2.className = 'clicky';
+
+	pre1.onclick = function(){
+		pre1.style.display = 'none';
+		pre2.style.display = 'block';
+	}
+
+	pre2.onclick = function(){
+		pre1.style.display = 'block';
+		pre2.style.display = 'none';
+	}
+
+	var pre = document.createElement('div');
+
+	pre.appendChild(pre1);
+	pre.appendChild(pre2);
+
+	return pre;
+}
+
+function getConstructorClass(obj){
+
+	if (!obj.constructor || !obj.constructor.toString) return;
+
+	var m = obj.constructor.toString().match(/function\s*(\w+)/);
+
+	if (m &amp;&amp; m.length == 2) return m[1];
+
+	return null;
+}
+
+function keySorter(a, b){
+
+	if (a == parseInt(a) &amp;&amp; b == parseInt(b)){
+
+		return (parseInt(a) &gt; parseInt(b)) ? 1 : ((parseInt(a) &lt; parseInt(b)) ? -1 : 0);
+	}
+
+	// sort by lowercase string
+
+	var a2 = String(a).toLowerCase();
+	var b2 = String(b).toLowerCase();
+
+	return (a2 &gt; b2) ? 1 : ((a2 &lt; b2) ? -1 : 0);
+}
+
+&lt;/script&gt;
+&lt;style&gt;
+
+body {
+	font-family: arial, helvetica, sans-serif;
+}
+
+table {
+	border-width: 0px;
+	border-spacing: 1px;
+	border-collapse: separate;
+}
+
+td {
+	border-width: 0px;
+	padding: 2px;
+}
+
+img {
+	border: 0;
+}
+
+pre {
+	margin: 0;
+	padding: 0;
+	white-space: -moz-pre-wrap;  /* Mozilla, supported since 1999 */
+	white-space: -pre-wrap;      /* Opera 4 - 6 */
+	white-space: -o-pre-wrap;    /* Opera 7 */
+	white-space: pre-wrap;       /* CSS3 - Text module (Candidate Recommendation) <A HREF="http://www.w3.org/TR/css3-text/#white-space">http://www.w3.org/TR/css3-text/#white-space</A> */
+	word-wrap: break-word;       /* IE 5.5+ */
+}
+
+pre.clicky {
+	cursor: hand;
+	cursor: pointer;
+}
+
+td.propPlus {
+	width: 9px;
+	background-color: #ddd;
+}
+
+td.propName {
+	background-color: #ddd;
+}
+
+td.propType {
+	background-color: #ddd;
+}
+
+td.propVal {
+	background-color: #ddd;
+}
+
+&lt;/style&gt;
+&lt;/head&gt;
+&lt;body&gt;
+
+&lt;h2&gt;Javascript Object Browser&lt;/h2&gt;
+
+&lt;div id=&quot;frame&quot;&gt;&lt;/div&gt;
+
+&lt;/body&gt;
+&lt;/html&gt;
\ No newline at end of file


Property changes on: tags/parley-0.55/root/static/magic/src/debug/deep.html
___________________________________________________________________
Name: svn:mime-type
   + text/html

Added: tags/parley-0.55/root/static/magic/src/debug/spacer.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/debug/spacer.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/debug.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/debug.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/debug.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,85 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.debug&quot;);
+dojo.debug = function () {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	var args = arguments;
+	if (dj_undef(&quot;println&quot;, dojo.hostenv)) {
+		dojo.raise(&quot;dojo.debug not available (yet?)&quot;);
+	}
+	var isJUM = dj_global[&quot;jum&quot;] &amp;&amp; !dj_global[&quot;jum&quot;].isBrowser;
+	var s = [(isJUM ? &quot;&quot; : &quot;DEBUG: &quot;)];
+	for (var i = 0; i &lt; args.length; ++i) {
+		if (!false &amp;&amp; args[i] &amp;&amp; args[i] instanceof Error) {
+			var msg = &quot;[&quot; + args[i].name + &quot;: &quot; + dojo.errorToString(args[i]) + (args[i].fileName ? &quot;, file: &quot; + args[i].fileName : &quot;&quot;) + (args[i].lineNumber ? &quot;, line: &quot; + args[i].lineNumber : &quot;&quot;) + &quot;]&quot;;
+		} else {
+			try {
+				var msg = String(args[i]);
+			}
+			catch (e) {
+				if (dojo.render.html.ie) {
+					var msg = &quot;[ActiveXObject]&quot;;
+				} else {
+					var msg = &quot;[unknown]&quot;;
+				}
+			}
+		}
+		s.push(msg);
+	}
+	dojo.hostenv.println(s.join(&quot; &quot;));
+};
+dojo.debugShallow = function (obj) {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	dojo.debug(&quot;------------------------------------------------------------&quot;);
+	dojo.debug(&quot;Object: &quot; + obj);
+	var props = [];
+	for (var prop in obj) {
+		try {
+			props.push(prop + &quot;: &quot; + obj[prop]);
+		}
+		catch (E) {
+			props.push(prop + &quot;: ERROR - &quot; + E.message);
+		}
+	}
+	props.sort();
+	for (var i = 0; i &lt; props.length; i++) {
+		dojo.debug(props[i]);
+	}
+	dojo.debug(&quot;------------------------------------------------------------&quot;);
+};
+dojo.debugDeep = function (obj) {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	if (!dojo.uri || !dojo.uri.dojoUri) {
+		return dojo.debug(&quot;You'll need to load dojo.uri.* for deep debugging - sorry!&quot;);
+	}
+	if (!window.open) {
+		return dojo.debug(&quot;Deep debugging is only supported in host environments with window.open&quot;);
+	}
+	var idx = dojo.debugDeep.debugVars.length;
+	dojo.debugDeep.debugVars.push(obj);
+	var url = (djConfig[&quot;dojoDebugDeepHtmlUrl&quot;] || new dojo.uri.Uri(location, dojo.uri.moduleUri(&quot;dojo.debug&quot;, &quot;deep.html&quot;)).toString()) + &quot;?var=&quot; + idx;
+	var win = window.open(url, &quot;_blank&quot;, &quot;width=600, height=400, resizable=yes, scrollbars=yes, status=yes&quot;);
+	try {
+		win.debugVar = obj;
+	}
+	catch (e) {
+	}
+};
+dojo.debugDeep.debugVars = [];
+

Added: tags/parley-0.55/root/static/magic/src/dnd/DragAndDrop.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/DragAndDrop.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/DragAndDrop.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,76 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.provide(&quot;dojo.dnd.DragAndDrop&quot;);
+dojo.declare(&quot;dojo.dnd.DragSource&quot;, null, {type:&quot;&quot;, onDragEnd:function (evt) {
+}, onDragStart:function (evt) {
+}, onSelected:function (evt) {
+}, unregister:function () {
+	dojo.dnd.dragManager.unregisterDragSource(this);
+}, reregister:function () {
+	dojo.dnd.dragManager.registerDragSource(this);
+}});
+dojo.declare(&quot;dojo.dnd.DragObject&quot;, null, {type:&quot;&quot;, register:function () {
+	var dm = dojo.dnd.dragManager;
+	if (dm[&quot;registerDragObject&quot;]) {
+		dm.registerDragObject(this);
+	}
+}, onDragStart:function (evt) {
+}, onDragMove:function (evt) {
+}, onDragOver:function (evt) {
+}, onDragOut:function (evt) {
+}, onDragEnd:function (evt) {
+}, onDragLeave:dojo.lang.forward(&quot;onDragOut&quot;), onDragEnter:dojo.lang.forward(&quot;onDragOver&quot;), ondragout:dojo.lang.forward(&quot;onDragOut&quot;), ondragover:dojo.lang.forward(&quot;onDragOver&quot;)});
+dojo.declare(&quot;dojo.dnd.DropTarget&quot;, null, {acceptsType:function (type) {
+	if (!dojo.lang.inArray(this.acceptedTypes, &quot;*&quot;)) {
+		if (!dojo.lang.inArray(this.acceptedTypes, type)) {
+			return false;
+		}
+	}
+	return true;
+}, accepts:function (dragObjects) {
+	if (!dojo.lang.inArray(this.acceptedTypes, &quot;*&quot;)) {
+		for (var i = 0; i &lt; dragObjects.length; i++) {
+			if (!dojo.lang.inArray(this.acceptedTypes, dragObjects[i].type)) {
+				return false;
+			}
+		}
+	}
+	return true;
+}, unregister:function () {
+	dojo.dnd.dragManager.unregisterDropTarget(this);
+}, onDragOver:function (evt) {
+}, onDragOut:function (evt) {
+}, onDragMove:function (evt) {
+}, onDropStart:function (evt) {
+}, onDrop:function (evt) {
+}, onDropEnd:function () {
+}}, function () {
+	this.acceptedTypes = [];
+});
+dojo.dnd.DragEvent = function () {
+	this.dragSource = null;
+	this.dragObject = null;
+	this.target = null;
+	this.eventStatus = &quot;success&quot;;
+};
+dojo.declare(&quot;dojo.dnd.DragManager&quot;, null, {selectedSources:[], dragObjects:[], dragSources:[], registerDragSource:function (source) {
+}, dropTargets:[], registerDropTarget:function (target) {
+}, lastDragTarget:null, currentDragTarget:null, onKeyDown:function () {
+}, onMouseOut:function () {
+}, onMouseMove:function () {
+}, onMouseUp:function () {
+}});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/HtmlDragAndDrop.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/HtmlDragAndDrop.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/HtmlDragAndDrop.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,369 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.HtmlDragAndDrop&quot;);
+dojo.require(&quot;dojo.dnd.HtmlDragManager&quot;);
+dojo.require(&quot;dojo.dnd.DragAndDrop&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.html.iframe&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.declare(&quot;dojo.dnd.HtmlDragSource&quot;, dojo.dnd.DragSource, {dragClass:&quot;&quot;, onDragStart:function () {
+	var dragObj = new dojo.dnd.HtmlDragObject(this.dragObject, this.type);
+	if (this.dragClass) {
+		dragObj.dragClass = this.dragClass;
+	}
+	if (this.constrainToContainer) {
+		dragObj.constrainTo(this.constrainingContainer || this.domNode.parentNode);
+	}
+	return dragObj;
+}, setDragHandle:function (node) {
+	node = dojo.byId(node);
+	dojo.dnd.dragManager.unregisterDragSource(this);
+	this.domNode = node;
+	dojo.dnd.dragManager.registerDragSource(this);
+}, setDragTarget:function (node) {
+	this.dragObject = node;
+}, constrainTo:function (container) {
+	this.constrainToContainer = true;
+	if (container) {
+		this.constrainingContainer = container;
+	}
+}, onSelected:function () {
+	for (var i = 0; i &lt; this.dragObjects.length; i++) {
+		dojo.dnd.dragManager.selectedSources.push(new dojo.dnd.HtmlDragSource(this.dragObjects[i]));
+	}
+}, addDragObjects:function (el) {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		this.dragObjects.push(dojo.byId(arguments[i]));
+	}
+}}, function (node, type) {
+	node = dojo.byId(node);
+	this.dragObjects = [];
+	this.constrainToContainer = false;
+	if (node) {
+		this.domNode = node;
+		this.dragObject = node;
+		this.type = (type) || (this.domNode.nodeName.toLowerCase());
+		dojo.dnd.DragSource.prototype.reregister.call(this);
+	}
+});
+dojo.declare(&quot;dojo.dnd.HtmlDragObject&quot;, dojo.dnd.DragObject, {dragClass:&quot;&quot;, opacity:0.5, createIframe:true, disableX:false, disableY:false, createDragNode:function () {
+	var node = this.domNode.cloneNode(true);
+	if (this.dragClass) {
+		dojo.html.addClass(node, this.dragClass);
+	}
+	if (this.opacity &lt; 1) {
+		dojo.html.setOpacity(node, this.opacity);
+	}
+	var ltn = node.tagName.toLowerCase();
+	var isTr = (ltn == &quot;tr&quot;);
+	if ((isTr) || (ltn == &quot;tbody&quot;)) {
+		var doc = this.domNode.ownerDocument;
+		var table = doc.createElement(&quot;table&quot;);
+		if (isTr) {
+			var tbody = doc.createElement(&quot;tbody&quot;);
+			table.appendChild(tbody);
+			tbody.appendChild(node);
+		} else {
+			table.appendChild(node);
+		}
+		var tmpSrcTr = ((isTr) ? this.domNode : this.domNode.firstChild);
+		var tmpDstTr = ((isTr) ? node : node.firstChild);
+		var domTds = tmpSrcTr.childNodes;
+		var cloneTds = tmpDstTr.childNodes;
+		for (var i = 0; i &lt; domTds.length; i++) {
+			if ((cloneTds[i]) &amp;&amp; (cloneTds[i].style)) {
+				cloneTds[i].style.width = dojo.html.getContentBox(domTds[i]).width + &quot;px&quot;;
+			}
+		}
+		node = table;
+	}
+	if ((dojo.render.html.ie55 || dojo.render.html.ie60) &amp;&amp; this.createIframe) {
+		with (node.style) {
+			top = &quot;0px&quot;;
+			left = &quot;0px&quot;;
+		}
+		var outer = document.createElement(&quot;div&quot;);
+		outer.appendChild(node);
+		this.bgIframe = new dojo.html.BackgroundIframe(outer);
+		outer.appendChild(this.bgIframe.iframe);
+		node = outer;
+	}
+	node.style.zIndex = 999;
+	return node;
+}, onDragStart:function (e) {
+	dojo.html.clearSelection();
+	this.scrollOffset = dojo.html.getScroll().offset;
+	this.dragStartPosition = dojo.html.getAbsolutePosition(this.domNode, true);
+	this.dragOffset = {y:this.dragStartPosition.y - e.pageY, x:this.dragStartPosition.x - e.pageX};
+	this.dragClone = this.createDragNode();
+	this.containingBlockPosition = this.domNode.offsetParent ? dojo.html.getAbsolutePosition(this.domNode.offsetParent, true) : {x:0, y:0};
+	if (this.constrainToContainer) {
+		this.constraints = this.getConstraints();
+	}
+	with (this.dragClone.style) {
+		position = &quot;absolute&quot;;
+		top = this.dragOffset.y + e.pageY + &quot;px&quot;;
+		left = this.dragOffset.x + e.pageX + &quot;px&quot;;
+	}
+	dojo.body().appendChild(this.dragClone);
+	dojo.event.topic.publish(&quot;dragStart&quot;, {source:this});
+}, getConstraints:function () {
+	if (this.constrainingContainer.nodeName.toLowerCase() == &quot;body&quot;) {
+		var viewport = dojo.html.getViewport();
+		var width = viewport.width;
+		var height = viewport.height;
+		var scroll = dojo.html.getScroll().offset;
+		var x = scroll.x;
+		var y = scroll.y;
+	} else {
+		var content = dojo.html.getContentBox(this.constrainingContainer);
+		width = content.width;
+		height = content.height;
+		x = this.containingBlockPosition.x + dojo.html.getPixelValue(this.constrainingContainer, &quot;padding-left&quot;, true) + dojo.html.getBorderExtent(this.constrainingContainer, &quot;left&quot;);
+		y = this.containingBlockPosition.y + dojo.html.getPixelValue(this.constrainingContainer, &quot;padding-top&quot;, true) + dojo.html.getBorderExtent(this.constrainingContainer, &quot;top&quot;);
+	}
+	var mb = dojo.html.getMarginBox(this.domNode);
+	return {minX:x, minY:y, maxX:x + width - mb.width, maxY:y + height - mb.height};
+}, updateDragOffset:function () {
+	var scroll = dojo.html.getScroll().offset;
+	if (scroll.y != this.scrollOffset.y) {
+		var diff = scroll.y - this.scrollOffset.y;
+		this.dragOffset.y += diff;
+		this.scrollOffset.y = scroll.y;
+	}
+	if (scroll.x != this.scrollOffset.x) {
+		var diff = scroll.x - this.scrollOffset.x;
+		this.dragOffset.x += diff;
+		this.scrollOffset.x = scroll.x;
+	}
+}, onDragMove:function (e) {
+	this.updateDragOffset();
+	var x = this.dragOffset.x + e.pageX;
+	var y = this.dragOffset.y + e.pageY;
+	if (this.constrainToContainer) {
+		if (x &lt; this.constraints.minX) {
+			x = this.constraints.minX;
+		}
+		if (y &lt; this.constraints.minY) {
+			y = this.constraints.minY;
+		}
+		if (x &gt; this.constraints.maxX) {
+			x = this.constraints.maxX;
+		}
+		if (y &gt; this.constraints.maxY) {
+			y = this.constraints.maxY;
+		}
+	}
+	this.setAbsolutePosition(x, y);
+	dojo.event.topic.publish(&quot;dragMove&quot;, {source:this});
+}, setAbsolutePosition:function (x, y) {
+	if (!this.disableY) {
+		this.dragClone.style.top = y + &quot;px&quot;;
+	}
+	if (!this.disableX) {
+		this.dragClone.style.left = x + &quot;px&quot;;
+	}
+}, onDragEnd:function (e) {
+	switch (e.dragStatus) {
+	  case &quot;dropSuccess&quot;:
+		dojo.html.removeNode(this.dragClone);
+		this.dragClone = null;
+		break;
+	  case &quot;dropFailure&quot;:
+		var startCoords = dojo.html.getAbsolutePosition(this.dragClone, true);
+		var endCoords = {left:this.dragStartPosition.x + 1, top:this.dragStartPosition.y + 1};
+		var anim = dojo.lfx.slideTo(this.dragClone, endCoords, 300);
+		var dragObject = this;
+		dojo.event.connect(anim, &quot;onEnd&quot;, function (e) {
+			dojo.html.removeNode(dragObject.dragClone);
+			dragObject.dragClone = null;
+		});
+		anim.play();
+		break;
+	}
+	dojo.event.topic.publish(&quot;dragEnd&quot;, {source:this});
+}, constrainTo:function (container) {
+	this.constrainToContainer = true;
+	if (container) {
+		this.constrainingContainer = container;
+	} else {
+		this.constrainingContainer = this.domNode.parentNode;
+	}
+}}, function (node, type) {
+	this.domNode = dojo.byId(node);
+	this.type = type;
+	this.constrainToContainer = false;
+	this.dragSource = null;
+	dojo.dnd.DragObject.prototype.register.call(this);
+});
+dojo.declare(&quot;dojo.dnd.HtmlDropTarget&quot;, dojo.dnd.DropTarget, {vertical:false, onDragOver:function (e) {
+	if (!this.accepts(e.dragObjects)) {
+		return false;
+	}
+	this.childBoxes = [];
+	for (var i = 0, child; i &lt; this.domNode.childNodes.length; i++) {
+		child = this.domNode.childNodes[i];
+		if (child.nodeType != dojo.html.ELEMENT_NODE) {
+			continue;
+		}
+		var pos = dojo.html.getAbsolutePosition(child, true);
+		var inner = dojo.html.getBorderBox(child);
+		this.childBoxes.push({top:pos.y, bottom:pos.y + inner.height, left:pos.x, right:pos.x + inner.width, height:inner.height, width:inner.width, node:child});
+	}
+	return true;
+}, _getNodeUnderMouse:function (e) {
+	for (var i = 0, child; i &lt; this.childBoxes.length; i++) {
+		with (this.childBoxes[i]) {
+			if (e.pageX &gt;= left &amp;&amp; e.pageX &lt;= right &amp;&amp; e.pageY &gt;= top &amp;&amp; e.pageY &lt;= bottom) {
+				return i;
+			}
+		}
+	}
+	return -1;
+}, createDropIndicator:function () {
+	this.dropIndicator = document.createElement(&quot;div&quot;);
+	with (this.dropIndicator.style) {
+		position = &quot;absolute&quot;;
+		zIndex = 999;
+		if (this.vertical) {
+			borderLeftWidth = &quot;1px&quot;;
+			borderLeftColor = &quot;black&quot;;
+			borderLeftStyle = &quot;solid&quot;;
+			height = dojo.html.getBorderBox(this.domNode).height + &quot;px&quot;;
+			top = dojo.html.getAbsolutePosition(this.domNode, true).y + &quot;px&quot;;
+		} else {
+			borderTopWidth = &quot;1px&quot;;
+			borderTopColor = &quot;black&quot;;
+			borderTopStyle = &quot;solid&quot;;
+			width = dojo.html.getBorderBox(this.domNode).width + &quot;px&quot;;
+			left = dojo.html.getAbsolutePosition(this.domNode, true).x + &quot;px&quot;;
+		}
+	}
+}, onDragMove:function (e, dragObjects) {
+	var i = this._getNodeUnderMouse(e);
+	if (!this.dropIndicator) {
+		this.createDropIndicator();
+	}
+	var gravity = this.vertical ? dojo.html.gravity.WEST : dojo.html.gravity.NORTH;
+	var hide = false;
+	if (i &lt; 0) {
+		if (this.childBoxes.length) {
+			var before = (dojo.html.gravity(this.childBoxes[0].node, e) &amp; gravity);
+			if (before) {
+				hide = true;
+			}
+		} else {
+			var before = true;
+		}
+	} else {
+		var child = this.childBoxes[i];
+		var before = (dojo.html.gravity(child.node, e) &amp; gravity);
+		if (child.node === dragObjects[0].dragSource.domNode) {
+			hide = true;
+		} else {
+			var currentPosChild = before ? (i &gt; 0 ? this.childBoxes[i - 1] : child) : (i &lt; this.childBoxes.length - 1 ? this.childBoxes[i + 1] : child);
+			if (currentPosChild.node === dragObjects[0].dragSource.domNode) {
+				hide = true;
+			}
+		}
+	}
+	if (hide) {
+		this.dropIndicator.style.display = &quot;none&quot;;
+		return;
+	} else {
+		this.dropIndicator.style.display = &quot;&quot;;
+	}
+	this.placeIndicator(e, dragObjects, i, before);
+	if (!dojo.html.hasParent(this.dropIndicator)) {
+		dojo.body().appendChild(this.dropIndicator);
+	}
+}, placeIndicator:function (e, dragObjects, boxIndex, before) {
+	var targetProperty = this.vertical ? &quot;left&quot; : &quot;top&quot;;
+	var child;
+	if (boxIndex &lt; 0) {
+		if (this.childBoxes.length) {
+			child = before ? this.childBoxes[0] : this.childBoxes[this.childBoxes.length - 1];
+		} else {
+			this.dropIndicator.style[targetProperty] = dojo.html.getAbsolutePosition(this.domNode, true)[this.vertical ? &quot;x&quot; : &quot;y&quot;] + &quot;px&quot;;
+		}
+	} else {
+		child = this.childBoxes[boxIndex];
+	}
+	if (child) {
+		this.dropIndicator.style[targetProperty] = (before ? child[targetProperty] : child[this.vertical ? &quot;right&quot; : &quot;bottom&quot;]) + &quot;px&quot;;
+		if (this.vertical) {
+			this.dropIndicator.style.height = child.height + &quot;px&quot;;
+			this.dropIndicator.style.top = child.top + &quot;px&quot;;
+		} else {
+			this.dropIndicator.style.width = child.width + &quot;px&quot;;
+			this.dropIndicator.style.left = child.left + &quot;px&quot;;
+		}
+	}
+}, onDragOut:function (e) {
+	if (this.dropIndicator) {
+		dojo.html.removeNode(this.dropIndicator);
+		delete this.dropIndicator;
+	}
+}, onDrop:function (e) {
+	this.onDragOut(e);
+	var i = this._getNodeUnderMouse(e);
+	var gravity = this.vertical ? dojo.html.gravity.WEST : dojo.html.gravity.NORTH;
+	if (i &lt; 0) {
+		if (this.childBoxes.length) {
+			if (dojo.html.gravity(this.childBoxes[0].node, e) &amp; gravity) {
+				return this.insert(e, this.childBoxes[0].node, &quot;before&quot;);
+			} else {
+				return this.insert(e, this.childBoxes[this.childBoxes.length - 1].node, &quot;after&quot;);
+			}
+		}
+		return this.insert(e, this.domNode, &quot;append&quot;);
+	}
+	var child = this.childBoxes[i];
+	if (dojo.html.gravity(child.node, e) &amp; gravity) {
+		return this.insert(e, child.node, &quot;before&quot;);
+	} else {
+		return this.insert(e, child.node, &quot;after&quot;);
+	}
+}, insert:function (e, refNode, position) {
+	var node = e.dragObject.domNode;
+	if (position == &quot;before&quot;) {
+		return dojo.html.insertBefore(node, refNode);
+	} else {
+		if (position == &quot;after&quot;) {
+			return dojo.html.insertAfter(node, refNode);
+		} else {
+			if (position == &quot;append&quot;) {
+				refNode.appendChild(node);
+				return true;
+			}
+		}
+	}
+	return false;
+}}, function (node, types) {
+	if (arguments.length == 0) {
+		return;
+	}
+	this.domNode = dojo.byId(node);
+	dojo.dnd.DropTarget.call(this);
+	if (types &amp;&amp; dojo.lang.isString(types)) {
+		types = [types];
+	}
+	this.acceptedTypes = types || [];
+	dojo.dnd.dragManager.registerDropTarget(this);
+});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/HtmlDragCopy.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/HtmlDragCopy.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/HtmlDragCopy.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,70 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.HtmlDragCopy&quot;);
+dojo.require(&quot;dojo.dnd.*&quot;);
+dojo.declare(&quot;dojo.dnd.HtmlDragCopySource&quot;, dojo.dnd.HtmlDragSource, function (node, type, copyOnce) {
+	this.copyOnce = copyOnce;
+	this.makeCopy = true;
+}, {onDragStart:function () {
+	var dragObj = new dojo.dnd.HtmlDragCopyObject(this.dragObject, this.type, this);
+	if (this.dragClass) {
+		dragObj.dragClass = this.dragClass;
+	}
+	if (this.constrainToContainer) {
+		dragObj.constrainTo(this.constrainingContainer || this.domNode.parentNode);
+	}
+	return dragObj;
+}, onSelected:function () {
+	for (var i = 0; i &lt; this.dragObjects.length; i++) {
+		dojo.dnd.dragManager.selectedSources.push(new dojo.dnd.HtmlDragCopySource(this.dragObjects[i]));
+	}
+}});
+dojo.declare(&quot;dojo.dnd.HtmlDragCopyObject&quot;, dojo.dnd.HtmlDragObject, function (dragObject, type, source) {
+	this.copySource = source;
+}, {onDragStart:function (e) {
+	dojo.dnd.HtmlDragCopyObject.superclass.onDragStart.apply(this, arguments);
+	if (this.copySource.makeCopy) {
+		this.sourceNode = this.domNode;
+		this.domNode = this.domNode.cloneNode(true);
+	}
+}, onDragEnd:function (e) {
+	switch (e.dragStatus) {
+	  case &quot;dropFailure&quot;:
+		var startCoords = dojo.html.getAbsolutePosition(this.dragClone, true);
+		var endCoords = {left:this.dragStartPosition.x + 1, top:this.dragStartPosition.y + 1};
+		var anim = dojo.lfx.slideTo(this.dragClone, endCoords, 500, dojo.lfx.easeOut);
+		var dragObject = this;
+		dojo.event.connect(anim, &quot;onEnd&quot;, function (e) {
+			dojo.lang.setTimeout(function () {
+				dojo.html.removeNode(dragObject.dragClone);
+				dragObject.dragClone = null;
+				if (dragObject.copySource.makeCopy) {
+					dojo.html.removeNode(dragObject.domNode);
+					dragObject.domNode = dragObject.sourceNode;
+					dragObject.sourceNode = null;
+				}
+			}, 200);
+		});
+		anim.play();
+		dojo.event.topic.publish(&quot;dragEnd&quot;, {source:this});
+		return;
+	}
+	dojo.dnd.HtmlDragCopyObject.superclass.onDragEnd.apply(this, arguments);
+	this.copySource.dragObject = this.domNode;
+	if (this.copySource.copyOnce) {
+		this.copySource.makeCopy = false;
+	}
+	new dojo.dnd.HtmlDragCopySource(this.sourceNode, this.type, this.copySource.copyOnce);
+	this.sourceNode = null;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/HtmlDragManager.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/HtmlDragManager.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/HtmlDragManager.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,295 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.HtmlDragManager&quot;);
+dojo.require(&quot;dojo.dnd.DragAndDrop&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.declare(&quot;dojo.dnd.HtmlDragManager&quot;, dojo.dnd.DragManager, {disabled:false, nestedTargets:false, mouseDownTimer:null, dsCounter:0, dsPrefix:&quot;dojoDragSource&quot;, dropTargetDimensions:[], currentDropTarget:null, previousDropTarget:null, _dragTriggered:false, selectedSources:[], dragObjects:[], dragSources:[], dropTargets:[], currentX:null, currentY:null, lastX:null, lastY:null, mouseDownX:null, mouseDownY:null, threshold:7, dropAcceptable:false, cancelEvent:function (e) {
+	e.stopPropagation();
+	e.preventDefault();
+}, registerDragSource:function (ds) {
+	if (ds[&quot;domNode&quot;]) {
+		var dp = this.dsPrefix;
+		var dpIdx = dp + &quot;Idx_&quot; + (this.dsCounter++);
+		ds.dragSourceId = dpIdx;
+		this.dragSources[dpIdx] = ds;
+		ds.domNode.setAttribute(dp, dpIdx);
+		if (dojo.render.html.ie) {
+			dojo.event.browser.addListener(ds.domNode, &quot;ondragstart&quot;, this.cancelEvent);
+		}
+	}
+}, unregisterDragSource:function (ds) {
+	if (ds[&quot;domNode&quot;]) {
+		var dp = this.dsPrefix;
+		var dpIdx = ds.dragSourceId;
+		delete ds.dragSourceId;
+		delete this.dragSources[dpIdx];
+		ds.domNode.setAttribute(dp, null);
+		if (dojo.render.html.ie) {
+			dojo.event.browser.removeListener(ds.domNode, &quot;ondragstart&quot;, this.cancelEvent);
+		}
+	}
+}, registerDropTarget:function (dt) {
+	this.dropTargets.push(dt);
+}, unregisterDropTarget:function (dt) {
+	var index = dojo.lang.find(this.dropTargets, dt, true);
+	if (index &gt;= 0) {
+		this.dropTargets.splice(index, 1);
+	}
+}, getDragSource:function (e) {
+	var tn = e.target;
+	if (tn === dojo.body()) {
+		return;
+	}
+	var ta = dojo.html.getAttribute(tn, this.dsPrefix);
+	while ((!ta) &amp;&amp; (tn)) {
+		tn = tn.parentNode;
+		if ((!tn) || (tn === dojo.body())) {
+			return;
+		}
+		ta = dojo.html.getAttribute(tn, this.dsPrefix);
+	}
+	return this.dragSources[ta];
+}, onKeyDown:function (e) {
+}, onMouseDown:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	if (dojo.render.html.ie) {
+		if (e.button != 1) {
+			return;
+		}
+	} else {
+		if (e.which != 1) {
+			return;
+		}
+	}
+	var target = e.target.nodeType == dojo.html.TEXT_NODE ? e.target.parentNode : e.target;
+	if (dojo.html.isTag(target, &quot;button&quot;, &quot;textarea&quot;, &quot;input&quot;, &quot;select&quot;, &quot;option&quot;)) {
+		return;
+	}
+	var ds = this.getDragSource(e);
+	if (!ds) {
+		return;
+	}
+	if (!dojo.lang.inArray(this.selectedSources, ds)) {
+		this.selectedSources.push(ds);
+		ds.onSelected();
+	}
+	this.mouseDownX = e.pageX;
+	this.mouseDownY = e.pageY;
+	e.preventDefault();
+	dojo.event.connect(document, &quot;onmousemove&quot;, this, &quot;onMouseMove&quot;);
+}, onMouseUp:function (e, cancel) {
+	if (this.selectedSources.length == 0) {
+		return;
+	}
+	this.mouseDownX = null;
+	this.mouseDownY = null;
+	this._dragTriggered = false;
+	e.dragSource = this.dragSource;
+	if ((!e.shiftKey) &amp;&amp; (!e.ctrlKey)) {
+		if (this.currentDropTarget) {
+			this.currentDropTarget.onDropStart();
+		}
+		dojo.lang.forEach(this.dragObjects, function (tempDragObj) {
+			var ret = null;
+			if (!tempDragObj) {
+				return;
+			}
+			if (this.currentDropTarget) {
+				e.dragObject = tempDragObj;
+				var ce = this.currentDropTarget.domNode.childNodes;
+				if (ce.length &gt; 0) {
+					e.dropTarget = ce[0];
+					while (e.dropTarget == tempDragObj.domNode) {
+						e.dropTarget = e.dropTarget.nextSibling;
+					}
+				} else {
+					e.dropTarget = this.currentDropTarget.domNode;
+				}
+				if (this.dropAcceptable) {
+					ret = this.currentDropTarget.onDrop(e);
+				} else {
+					this.currentDropTarget.onDragOut(e);
+				}
+			}
+			e.dragStatus = this.dropAcceptable &amp;&amp; ret ? &quot;dropSuccess&quot; : &quot;dropFailure&quot;;
+			dojo.lang.delayThese([function () {
+				try {
+					tempDragObj.dragSource.onDragEnd(e);
+				}
+				catch (err) {
+					var ecopy = {};
+					for (var i in e) {
+						if (i == &quot;type&quot;) {
+							ecopy.type = &quot;mouseup&quot;;
+							continue;
+						}
+						ecopy[i] = e[i];
+					}
+					tempDragObj.dragSource.onDragEnd(ecopy);
+				}
+			}, function () {
+				tempDragObj.onDragEnd(e);
+			}]);
+		}, this);
+		this.selectedSources = [];
+		this.dragObjects = [];
+		this.dragSource = null;
+		if (this.currentDropTarget) {
+			this.currentDropTarget.onDropEnd();
+		}
+	} else {
+	}
+	dojo.event.disconnect(document, &quot;onmousemove&quot;, this, &quot;onMouseMove&quot;);
+	this.currentDropTarget = null;
+}, onScroll:function () {
+	for (var i = 0; i &lt; this.dragObjects.length; i++) {
+		if (this.dragObjects[i].updateDragOffset) {
+			this.dragObjects[i].updateDragOffset();
+		}
+	}
+	if (this.dragObjects.length) {
+		this.cacheTargetLocations();
+	}
+}, _dragStartDistance:function (x, y) {
+	if ((!this.mouseDownX) || (!this.mouseDownX)) {
+		return;
+	}
+	var dx = Math.abs(x - this.mouseDownX);
+	var dx2 = dx * dx;
+	var dy = Math.abs(y - this.mouseDownY);
+	var dy2 = dy * dy;
+	return parseInt(Math.sqrt(dx2 + dy2), 10);
+}, cacheTargetLocations:function () {
+	dojo.profile.start(&quot;cacheTargetLocations&quot;);
+	this.dropTargetDimensions = [];
+	dojo.lang.forEach(this.dropTargets, function (tempTarget) {
+		var tn = tempTarget.domNode;
+		if (!tn || !tempTarget.accepts([this.dragSource])) {
+			return;
+		}
+		var abs = dojo.html.getAbsolutePosition(tn, true);
+		var bb = dojo.html.getBorderBox(tn);
+		this.dropTargetDimensions.push([[abs.x, abs.y], [abs.x + bb.width, abs.y + bb.height], tempTarget]);
+	}, this);
+	dojo.profile.end(&quot;cacheTargetLocations&quot;);
+}, onMouseMove:function (e) {
+	if ((dojo.render.html.ie) &amp;&amp; (e.button != 1)) {
+		this.currentDropTarget = null;
+		this.onMouseUp(e, true);
+		return;
+	}
+	if ((this.selectedSources.length) &amp;&amp; (!this.dragObjects.length)) {
+		var dx;
+		var dy;
+		if (!this._dragTriggered) {
+			this._dragTriggered = (this._dragStartDistance(e.pageX, e.pageY) &gt; this.threshold);
+			if (!this._dragTriggered) {
+				return;
+			}
+			dx = e.pageX - this.mouseDownX;
+			dy = e.pageY - this.mouseDownY;
+		}
+		this.dragSource = this.selectedSources[0];
+		dojo.lang.forEach(this.selectedSources, function (tempSource) {
+			if (!tempSource) {
+				return;
+			}
+			var tdo = tempSource.onDragStart(e);
+			if (tdo) {
+				tdo.onDragStart(e);
+				tdo.dragOffset.y += dy;
+				tdo.dragOffset.x += dx;
+				tdo.dragSource = tempSource;
+				this.dragObjects.push(tdo);
+			}
+		}, this);
+		this.previousDropTarget = null;
+		this.cacheTargetLocations();
+	}
+	dojo.lang.forEach(this.dragObjects, function (dragObj) {
+		if (dragObj) {
+			dragObj.onDragMove(e);
+		}
+	});
+	if (this.currentDropTarget) {
+		var c = dojo.html.toCoordinateObject(this.currentDropTarget.domNode, true);
+		var dtp = [[c.x, c.y], [c.x + c.width, c.y + c.height]];
+	}
+	if ((!this.nestedTargets) &amp;&amp; (dtp) &amp;&amp; (this.isInsideBox(e, dtp))) {
+		if (this.dropAcceptable) {
+			this.currentDropTarget.onDragMove(e, this.dragObjects);
+		}
+	} else {
+		var bestBox = this.findBestTarget(e);
+		if (bestBox.target === null) {
+			if (this.currentDropTarget) {
+				this.currentDropTarget.onDragOut(e);
+				this.previousDropTarget = this.currentDropTarget;
+				this.currentDropTarget = null;
+			}
+			this.dropAcceptable = false;
+			return;
+		}
+		if (this.currentDropTarget !== bestBox.target) {
+			if (this.currentDropTarget) {
+				this.previousDropTarget = this.currentDropTarget;
+				this.currentDropTarget.onDragOut(e);
+			}
+			this.currentDropTarget = bestBox.target;
+			e.dragObjects = this.dragObjects;
+			this.dropAcceptable = this.currentDropTarget.onDragOver(e);
+		} else {
+			if (this.dropAcceptable) {
+				this.currentDropTarget.onDragMove(e, this.dragObjects);
+			}
+		}
+	}
+}, findBestTarget:function (e) {
+	var _this = this;
+	var bestBox = new Object();
+	bestBox.target = null;
+	bestBox.points = null;
+	dojo.lang.every(this.dropTargetDimensions, function (tmpDA) {
+		if (!_this.isInsideBox(e, tmpDA)) {
+			return true;
+		}
+		bestBox.target = tmpDA[2];
+		bestBox.points = tmpDA;
+		return Boolean(_this.nestedTargets);
+	});
+	return bestBox;
+}, isInsideBox:function (e, coords) {
+	if ((e.pageX &gt; coords[0][0]) &amp;&amp; (e.pageX &lt; coords[1][0]) &amp;&amp; (e.pageY &gt; coords[0][1]) &amp;&amp; (e.pageY &lt; coords[1][1])) {
+		return true;
+	}
+	return false;
+}, onMouseOver:function (e) {
+}, onMouseOut:function (e) {
+}});
+dojo.dnd.dragManager = new dojo.dnd.HtmlDragManager();
+(function () {
+	var d = document;
+	var dm = dojo.dnd.dragManager;
+	dojo.event.connect(d, &quot;onkeydown&quot;, dm, &quot;onKeyDown&quot;);
+	dojo.event.connect(d, &quot;onmouseover&quot;, dm, &quot;onMouseOver&quot;);
+	dojo.event.connect(d, &quot;onmouseout&quot;, dm, &quot;onMouseOut&quot;);
+	dojo.event.connect(d, &quot;onmousedown&quot;, dm, &quot;onMouseDown&quot;);
+	dojo.event.connect(d, &quot;onmouseup&quot;, dm, &quot;onMouseUp&quot;);
+	dojo.event.connect(window, &quot;onscroll&quot;, dm, &quot;onScroll&quot;);
+})();
+

Added: tags/parley-0.55/root/static/magic/src/dnd/HtmlDragMove.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/HtmlDragMove.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/HtmlDragMove.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.HtmlDragMove&quot;);
+dojo.require(&quot;dojo.dnd.*&quot;);
+dojo.declare(&quot;dojo.dnd.HtmlDragMoveSource&quot;, dojo.dnd.HtmlDragSource, {onDragStart:function () {
+	var dragObj = new dojo.dnd.HtmlDragMoveObject(this.dragObject, this.type);
+	if (this.constrainToContainer) {
+		dragObj.constrainTo(this.constrainingContainer);
+	}
+	return dragObj;
+}, onSelected:function () {
+	for (var i = 0; i &lt; this.dragObjects.length; i++) {
+		dojo.dnd.dragManager.selectedSources.push(new dojo.dnd.HtmlDragMoveSource(this.dragObjects[i]));
+	}
+}});
+dojo.declare(&quot;dojo.dnd.HtmlDragMoveObject&quot;, dojo.dnd.HtmlDragObject, {onDragStart:function (e) {
+	dojo.html.clearSelection();
+	this.dragClone = this.domNode;
+	if (dojo.html.getComputedStyle(this.domNode, &quot;position&quot;) != &quot;absolute&quot;) {
+		this.domNode.style.position = &quot;relative&quot;;
+	}
+	var left = parseInt(dojo.html.getComputedStyle(this.domNode, &quot;left&quot;));
+	var top = parseInt(dojo.html.getComputedStyle(this.domNode, &quot;top&quot;));
+	this.dragStartPosition = {x:isNaN(left) ? 0 : left, y:isNaN(top) ? 0 : top};
+	this.scrollOffset = dojo.html.getScroll().offset;
+	this.dragOffset = {y:this.dragStartPosition.y - e.pageY, x:this.dragStartPosition.x - e.pageX};
+	this.containingBlockPosition = {x:0, y:0};
+	if (this.constrainToContainer) {
+		this.constraints = this.getConstraints();
+	}
+	dojo.event.connect(this.domNode, &quot;onclick&quot;, this, &quot;_squelchOnClick&quot;);
+}, onDragEnd:function (e) {
+}, setAbsolutePosition:function (x, y) {
+	if (!this.disableY) {
+		this.domNode.style.top = y + &quot;px&quot;;
+	}
+	if (!this.disableX) {
+		this.domNode.style.left = x + &quot;px&quot;;
+	}
+}, _squelchOnClick:function (e) {
+	dojo.event.browser.stopEvent(e);
+	dojo.event.disconnect(this.domNode, &quot;onclick&quot;, this, &quot;_squelchOnClick&quot;);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/Sortable.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/Sortable.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/Sortable.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.Sortable&quot;);
+dojo.require(&quot;dojo.dnd.*&quot;);
+dojo.dnd.Sortable = function () {
+};
+dojo.lang.extend(dojo.dnd.Sortable, {ondragstart:function (e) {
+	var dragObject = e.target;
+	while (dragObject.parentNode &amp;&amp; dragObject.parentNode != this) {
+		dragObject = dragObject.parentNode;
+	}
+	return dragObject;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDrop.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDrop.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDrop.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,253 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.TreeDragAndDrop&quot;);
+dojo.require(&quot;dojo.dnd.HtmlDragAndDrop&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.dnd.TreeDragSource = function (node, syncController, type, treeNode) {
+	this.controller = syncController;
+	this.treeNode = treeNode;
+	dojo.dnd.HtmlDragSource.call(this, node, type);
+};
+dojo.inherits(dojo.dnd.TreeDragSource, dojo.dnd.HtmlDragSource);
+dojo.lang.extend(dojo.dnd.TreeDragSource, {onDragStart:function () {
+	var dragObject = dojo.dnd.HtmlDragSource.prototype.onDragStart.call(this);
+	dragObject.treeNode = this.treeNode;
+	dragObject.onDragStart = dojo.lang.hitch(dragObject, function (e) {
+		this.savedSelectedNode = this.treeNode.tree.selector.selectedNode;
+		if (this.savedSelectedNode) {
+			this.savedSelectedNode.unMarkSelected();
+		}
+		var result = dojo.dnd.HtmlDragObject.prototype.onDragStart.apply(this, arguments);
+		var cloneGrid = this.dragClone.getElementsByTagName(&quot;img&quot;);
+		for (var i = 0; i &lt; cloneGrid.length; i++) {
+			cloneGrid.item(i).style.backgroundImage = &quot;url()&quot;;
+		}
+		return result;
+	});
+	dragObject.onDragEnd = function (e) {
+		if (this.savedSelectedNode) {
+			this.savedSelectedNode.markSelected();
+		}
+		return dojo.dnd.HtmlDragObject.prototype.onDragEnd.apply(this, arguments);
+	};
+	return dragObject;
+}, onDragEnd:function (e) {
+	var res = dojo.dnd.HtmlDragSource.prototype.onDragEnd.call(this, e);
+	return res;
+}});
+dojo.dnd.TreeDropTarget = function (domNode, controller, type, treeNode) {
+	this.treeNode = treeNode;
+	this.controller = controller;
+	dojo.dnd.HtmlDropTarget.apply(this, [domNode, type]);
+};
+dojo.inherits(dojo.dnd.TreeDropTarget, dojo.dnd.HtmlDropTarget);
+dojo.lang.extend(dojo.dnd.TreeDropTarget, {autoExpandDelay:1500, autoExpandTimer:null, position:null, indicatorStyle:&quot;2px black solid&quot;, showIndicator:function (position) {
+	if (this.position == position) {
+		return;
+	}
+	this.hideIndicator();
+	this.position = position;
+	if (position == &quot;before&quot;) {
+		this.treeNode.labelNode.style.borderTop = this.indicatorStyle;
+	} else {
+		if (position == &quot;after&quot;) {
+			this.treeNode.labelNode.style.borderBottom = this.indicatorStyle;
+		} else {
+			if (position == &quot;onto&quot;) {
+				this.treeNode.markSelected();
+			}
+		}
+	}
+}, hideIndicator:function () {
+	this.treeNode.labelNode.style.borderBottom = &quot;&quot;;
+	this.treeNode.labelNode.style.borderTop = &quot;&quot;;
+	this.treeNode.unMarkSelected();
+	this.position = null;
+}, onDragOver:function (e) {
+	var accepts = dojo.dnd.HtmlDropTarget.prototype.onDragOver.apply(this, arguments);
+	if (accepts &amp;&amp; this.treeNode.isFolder &amp;&amp; !this.treeNode.isExpanded) {
+		this.setAutoExpandTimer();
+	}
+	return accepts;
+}, accepts:function (dragObjects) {
+	var accepts = dojo.dnd.HtmlDropTarget.prototype.accepts.apply(this, arguments);
+	if (!accepts) {
+		return false;
+	}
+	var sourceTreeNode = dragObjects[0].treeNode;
+	if (dojo.lang.isUndefined(sourceTreeNode) || !sourceTreeNode || !sourceTreeNode.isTreeNode) {
+		dojo.raise(&quot;Source is not TreeNode or not found&quot;);
+	}
+	if (sourceTreeNode === this.treeNode) {
+		return false;
+	}
+	return true;
+}, setAutoExpandTimer:function () {
+	var _this = this;
+	var autoExpand = function () {
+		if (dojo.dnd.dragManager.currentDropTarget === _this) {
+			_this.controller.expand(_this.treeNode);
+		}
+	};
+	this.autoExpandTimer = dojo.lang.setTimeout(autoExpand, _this.autoExpandDelay);
+}, getDNDMode:function () {
+	return this.treeNode.tree.DNDMode;
+}, getAcceptPosition:function (e, sourceTreeNode) {
+	var DNDMode = this.getDNDMode();
+	if (DNDMode &amp; dojo.widget.Tree.prototype.DNDModes.ONTO &amp;&amp; !(!this.treeNode.actionIsDisabled(dojo.widget.TreeNode.prototype.actions.ADDCHILD) &amp;&amp; sourceTreeNode.parent !== this.treeNode &amp;&amp; this.controller.canMove(sourceTreeNode, this.treeNode))) {
+		DNDMode &amp;= ~dojo.widget.Tree.prototype.DNDModes.ONTO;
+	}
+	var position = this.getPosition(e, DNDMode);
+	if (position == &quot;onto&quot; || (!this.isAdjacentNode(sourceTreeNode, position) &amp;&amp; this.controller.canMove(sourceTreeNode, this.treeNode.parent))) {
+		return position;
+	} else {
+		return false;
+	}
+}, onDragOut:function (e) {
+	this.clearAutoExpandTimer();
+	this.hideIndicator();
+}, clearAutoExpandTimer:function () {
+	if (this.autoExpandTimer) {
+		clearTimeout(this.autoExpandTimer);
+		this.autoExpandTimer = null;
+	}
+}, onDragMove:function (e, dragObjects) {
+	var sourceTreeNode = dragObjects[0].treeNode;
+	var position = this.getAcceptPosition(e, sourceTreeNode);
+	if (position) {
+		this.showIndicator(position);
+	}
+}, isAdjacentNode:function (sourceNode, position) {
+	if (sourceNode === this.treeNode) {
+		return true;
+	}
+	if (sourceNode.getNextSibling() === this.treeNode &amp;&amp; position == &quot;before&quot;) {
+		return true;
+	}
+	if (sourceNode.getPreviousSibling() === this.treeNode &amp;&amp; position == &quot;after&quot;) {
+		return true;
+	}
+	return false;
+}, getPosition:function (e, DNDMode) {
+	var node = dojo.byId(this.treeNode.labelNode);
+	var mousey = e.pageY || e.clientY + dojo.body().scrollTop;
+	var nodey = dojo.html.getAbsolutePosition(node).y;
+	var height = dojo.html.getBorderBox(node).height;
+	var relY = mousey - nodey;
+	var p = relY / height;
+	var position = &quot;&quot;;
+	if (DNDMode &amp; dojo.widget.Tree.prototype.DNDModes.ONTO &amp;&amp; DNDMode &amp; dojo.widget.Tree.prototype.DNDModes.BETWEEN) {
+		if (p &lt;= 0.3) {
+			position = &quot;before&quot;;
+		} else {
+			if (p &lt;= 0.7) {
+				position = &quot;onto&quot;;
+			} else {
+				position = &quot;after&quot;;
+			}
+		}
+	} else {
+		if (DNDMode &amp; dojo.widget.Tree.prototype.DNDModes.BETWEEN) {
+			if (p &lt;= 0.5) {
+				position = &quot;before&quot;;
+			} else {
+				position = &quot;after&quot;;
+			}
+		} else {
+			if (DNDMode &amp; dojo.widget.Tree.prototype.DNDModes.ONTO) {
+				position = &quot;onto&quot;;
+			}
+		}
+	}
+	return position;
+}, getTargetParentIndex:function (sourceTreeNode, position) {
+	var index = position == &quot;before&quot; ? this.treeNode.getParentIndex() : this.treeNode.getParentIndex() + 1;
+	if (this.treeNode.parent === sourceTreeNode.parent &amp;&amp; this.treeNode.getParentIndex() &gt; sourceTreeNode.getParentIndex()) {
+		index--;
+	}
+	return index;
+}, onDrop:function (e) {
+	var position = this.position;
+	this.onDragOut(e);
+	var sourceTreeNode = e.dragObject.treeNode;
+	if (!dojo.lang.isObject(sourceTreeNode)) {
+		dojo.raise(&quot;TreeNode not found in dragObject&quot;);
+	}
+	if (position == &quot;onto&quot;) {
+		return this.controller.move(sourceTreeNode, this.treeNode, 0);
+	} else {
+		var index = this.getTargetParentIndex(sourceTreeNode, position);
+		return this.controller.move(sourceTreeNode, this.treeNode.parent, index);
+	}
+}});
+dojo.dnd.TreeDNDController = function (treeController) {
+	this.treeController = treeController;
+	this.dragSources = {};
+	this.dropTargets = {};
+};
+dojo.lang.extend(dojo.dnd.TreeDNDController, {listenTree:function (tree) {
+	dojo.event.topic.subscribe(tree.eventNames.createDOMNode, this, &quot;onCreateDOMNode&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.moveFrom, this, &quot;onMoveFrom&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.moveTo, this, &quot;onMoveTo&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.addChild, this, &quot;onAddChild&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.removeNode, this, &quot;onRemoveNode&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+}, unlistenTree:function (tree) {
+	dojo.event.topic.unsubscribe(tree.eventNames.createDOMNode, this, &quot;onCreateDOMNode&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.moveFrom, this, &quot;onMoveFrom&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.moveTo, this, &quot;onMoveTo&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.addChild, this, &quot;onAddChild&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.removeNode, this, &quot;onRemoveNode&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+}, onTreeDestroy:function (message) {
+	this.unlistenTree(message.source);
+}, onCreateDOMNode:function (message) {
+	this.registerDNDNode(message.source);
+}, onAddChild:function (message) {
+	this.registerDNDNode(message.child);
+}, onMoveFrom:function (message) {
+	var _this = this;
+	dojo.lang.forEach(message.child.getDescendants(), function (node) {
+		_this.unregisterDNDNode(node);
+	});
+}, onMoveTo:function (message) {
+	var _this = this;
+	dojo.lang.forEach(message.child.getDescendants(), function (node) {
+		_this.registerDNDNode(node);
+	});
+}, registerDNDNode:function (node) {
+	if (!node.tree.DNDMode) {
+		return;
+	}
+	var source = null;
+	var target = null;
+	if (!node.actionIsDisabled(node.actions.MOVE)) {
+		var source = new dojo.dnd.TreeDragSource(node.labelNode, this, node.tree.widgetId, node);
+		this.dragSources[node.widgetId] = source;
+	}
+	var target = new dojo.dnd.TreeDropTarget(node.labelNode, this.treeController, node.tree.DNDAcceptTypes, node);
+	this.dropTargets[node.widgetId] = target;
+}, unregisterDNDNode:function (node) {
+	if (this.dragSources[node.widgetId]) {
+		dojo.dnd.dragManager.unregisterDragSource(this.dragSources[node.widgetId]);
+		delete this.dragSources[node.widgetId];
+	}
+	if (this.dropTargets[node.widgetId]) {
+		dojo.dnd.dragManager.unregisterDropTarget(this.dropTargets[node.widgetId]);
+		delete this.dropTargets[node.widgetId];
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDropV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDropV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/TreeDragAndDropV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,218 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dnd.TreeDragAndDropV3&quot;);
+dojo.require(&quot;dojo.dnd.HtmlDragAndDrop&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.dnd.TreeDragSourceV3 = function (node, syncController, type, treeNode) {
+	this.controller = syncController;
+	this.treeNode = treeNode;
+	dojo.dnd.HtmlDragSource.call(this, node, type);
+};
+dojo.inherits(dojo.dnd.TreeDragSourceV3, dojo.dnd.HtmlDragSource);
+dojo.dnd.TreeDropTargetV3 = function (domNode, controller, type, treeNode) {
+	this.treeNode = treeNode;
+	this.controller = controller;
+	dojo.dnd.HtmlDropTarget.call(this, domNode, type);
+};
+dojo.inherits(dojo.dnd.TreeDropTargetV3, dojo.dnd.HtmlDropTarget);
+dojo.lang.extend(dojo.dnd.TreeDropTargetV3, {autoExpandDelay:1500, autoExpandTimer:null, position:null, indicatorStyle:&quot;2px black groove&quot;, showIndicator:function (position) {
+	if (this.position == position) {
+		return;
+	}
+	this.hideIndicator();
+	this.position = position;
+	var node = this.treeNode;
+	node.contentNode.style.width = dojo.html.getBorderBox(node.labelNode).width + &quot;px&quot;;
+	if (position == &quot;onto&quot;) {
+		node.contentNode.style.border = this.indicatorStyle;
+	} else {
+		if (position == &quot;before&quot;) {
+			node.contentNode.style.borderTop = this.indicatorStyle;
+		} else {
+			if (position == &quot;after&quot;) {
+				node.contentNode.style.borderBottom = this.indicatorStyle;
+			}
+		}
+	}
+}, hideIndicator:function () {
+	this.treeNode.contentNode.style.borderBottom = &quot;&quot;;
+	this.treeNode.contentNode.style.borderTop = &quot;&quot;;
+	this.treeNode.contentNode.style.border = &quot;&quot;;
+	this.treeNode.contentNode.style.width = &quot;&quot;;
+	this.position = null;
+}, onDragOver:function (e) {
+	var accepts = dojo.dnd.HtmlDropTarget.prototype.onDragOver.apply(this, arguments);
+	if (accepts &amp;&amp; this.treeNode.isFolder &amp;&amp; !this.treeNode.isExpanded) {
+		this.setAutoExpandTimer();
+	}
+	if (accepts) {
+		this.cacheNodeCoords();
+	}
+	return accepts;
+}, accepts:function (dragObjects) {
+	var accepts = dojo.dnd.HtmlDropTarget.prototype.accepts.apply(this, arguments);
+	if (!accepts) {
+		return false;
+	}
+	for (var i = 0; i &lt; dragObjects.length; i++) {
+		var sourceTreeNode = dragObjects[i].treeNode;
+		if (sourceTreeNode === this.treeNode) {
+			return false;
+		}
+	}
+	return true;
+}, setAutoExpandTimer:function () {
+	var _this = this;
+	var autoExpand = function () {
+		if (dojo.dnd.dragManager.currentDropTarget === _this) {
+			_this.controller.expand(_this.treeNode);
+			dojo.dnd.dragManager.cacheTargetLocations();
+		}
+	};
+	this.autoExpandTimer = dojo.lang.setTimeout(autoExpand, _this.autoExpandDelay);
+}, getAcceptPosition:function (e, dragObjects) {
+	var DndMode = this.treeNode.tree.DndMode;
+	if (DndMode &amp; dojo.widget.TreeV3.prototype.DndModes.ONTO &amp;&amp; this.treeNode.actionIsDisabledNow(this.treeNode.actions.ADDCHILD)) {
+		DndMode &amp;= ~dojo.widget.TreeV3.prototype.DndModes.ONTO;
+	}
+	var position = this.getPosition(e, DndMode);
+	if (position == &quot;onto&quot;) {
+		return position;
+	}
+	for (var i = 0; i &lt; dragObjects.length; i++) {
+		var source = dragObjects[i].dragSource;
+		if (source.treeNode &amp;&amp; this.isAdjacentNode(source.treeNode, position)) {
+			continue;
+		}
+		if (!this.controller.canMove(source.treeNode ? source.treeNode : source, this.treeNode.parent)) {
+			return false;
+		}
+	}
+	return position;
+}, onDropEnd:function (e) {
+	this.clearAutoExpandTimer();
+	this.hideIndicator();
+}, onDragOut:function (e) {
+	this.clearAutoExpandTimer();
+	this.hideIndicator();
+}, clearAutoExpandTimer:function () {
+	if (this.autoExpandTimer) {
+		clearTimeout(this.autoExpandTimer);
+		this.autoExpandTimer = null;
+	}
+}, onDragMove:function (e, dragObjects) {
+	var position = this.getAcceptPosition(e, dragObjects);
+	if (position) {
+		this.showIndicator(position);
+	}
+}, isAdjacentNode:function (sourceNode, position) {
+	if (sourceNode === this.treeNode) {
+		return true;
+	}
+	if (sourceNode.getNextSibling() === this.treeNode &amp;&amp; position == &quot;before&quot;) {
+		return true;
+	}
+	if (sourceNode.getPreviousSibling() === this.treeNode &amp;&amp; position == &quot;after&quot;) {
+		return true;
+	}
+	return false;
+}, cacheNodeCoords:function () {
+	var node = this.treeNode.contentNode;
+	this.cachedNodeY = dojo.html.getAbsolutePosition(node).y;
+	this.cachedNodeHeight = dojo.html.getBorderBox(node).height;
+}, getPosition:function (e, DndMode) {
+	var mousey = e.pageY || e.clientY + dojo.body().scrollTop;
+	var relY = mousey - this.cachedNodeY;
+	var p = relY / this.cachedNodeHeight;
+	var position = &quot;&quot;;
+	if (DndMode &amp; dojo.widget.TreeV3.prototype.DndModes.ONTO &amp;&amp; DndMode &amp; dojo.widget.TreeV3.prototype.DndModes.BETWEEN) {
+		if (p &lt;= 0.33) {
+			position = &quot;before&quot;;
+		} else {
+			if (p &lt;= 0.66 || this.treeNode.isExpanded &amp;&amp; this.treeNode.children.length &amp;&amp; !this.treeNode.isLastChild()) {
+				position = &quot;onto&quot;;
+			} else {
+				position = &quot;after&quot;;
+			}
+		}
+	} else {
+		if (DndMode &amp; dojo.widget.TreeV3.prototype.DndModes.BETWEEN) {
+			if (p &lt;= 0.5 || this.treeNode.isExpanded &amp;&amp; this.treeNode.children.length &amp;&amp; !this.treeNode.isLastChild()) {
+				position = &quot;before&quot;;
+			} else {
+				position = &quot;after&quot;;
+			}
+		} else {
+			if (DndMode &amp; dojo.widget.TreeV3.prototype.DndModes.ONTO) {
+				position = &quot;onto&quot;;
+			}
+		}
+	}
+	return position;
+}, getTargetParentIndex:function (source, position) {
+	var index = position == &quot;before&quot; ? this.treeNode.getParentIndex() : this.treeNode.getParentIndex() + 1;
+	if (source.treeNode &amp;&amp; this.treeNode.parent === source.treeNode.parent &amp;&amp; this.treeNode.getParentIndex() &gt; source.treeNode.getParentIndex()) {
+		index--;
+	}
+	return index;
+}, onDrop:function (e) {
+	var position = this.position;
+	var source = e.dragObject.dragSource;
+	var targetParent, targetIndex;
+	if (position == &quot;onto&quot;) {
+		targetParent = this.treeNode;
+		targetIndex = 0;
+	} else {
+		targetIndex = this.getTargetParentIndex(source, position);
+		targetParent = this.treeNode.parent;
+	}
+	var r = this.getDropHandler(e, source, targetParent, targetIndex)();
+	return r;
+}, getDropHandler:function (e, source, targetParent, targetIndex) {
+	var handler;
+	var _this = this;
+	handler = function () {
+		var result;
+		if (source.treeNode) {
+			result = _this.controller.move(source.treeNode, targetParent, targetIndex, true);
+		} else {
+			if (dojo.lang.isFunction(source.onDrop)) {
+				source.onDrop(targetParent, targetIndex);
+			}
+			var treeNode = source.getTreeNode();
+			if (treeNode) {
+				result = _this.controller.createChild(targetParent, targetIndex, treeNode, true);
+			} else {
+				result = true;
+			}
+		}
+		if (result instanceof dojo.Deferred) {
+			var isSuccess = result.fired == 0;
+			if (!isSuccess) {
+				_this.handleDropError(source, targetParent, targetIndex, result);
+			}
+			return isSuccess;
+		} else {
+			return result;
+		}
+	};
+	return handler;
+}, handleDropError:function (source, parent, index, result) {
+	dojo.debug(&quot;TreeDropTargetV3.handleDropError: DND error occured&quot;);
+	dojo.debugShallow(result);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/dnd/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dnd/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dnd/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.dnd.DragAndDrop&quot;], browser:[&quot;dojo.dnd.HtmlDragAndDrop&quot;], dashboard:[&quot;dojo.dnd.HtmlDragAndDrop&quot;]});
+dojo.provide(&quot;dojo.dnd.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/docs.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/docs.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/docs.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,671 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+dojo.provide(&quot;dojo.docs&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.event.topic&quot;);
+dojo.require(&quot;dojo.rpc.JotService&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.require(&quot;dojo.DeferredList&quot;);
+
+/*
+ * TODO:
+ *
+ * Package summary needs to compensate for &quot;is&quot;
+ * Handle host environments
+ * Deal with dojo.widget weirdness
+ * Parse parameters
+ * Limit function parameters to only the valid ones (Involves packing parameters onto meta during rewriting)
+ *
+ */
+
+dojo.docs = new function() {
+	this._url = dojo.uri.dojoUri(&quot;docscripts&quot;);
+	this._rpc = new dojo.rpc.JotService;
+	this._rpc.serviceUrl = dojo.uri.dojoUri(&quot;docscripts/jsonrpc.php&quot;);
+};
+dojo.lang.mixin(dojo.docs, {
+	_count: 0,
+	_callbacks: {function_names: []},
+	_cache: {}, // Saves the JSON objects in cache
+	require: function(/*String*/ require, /*bool*/ sync) {
+		dojo.debug(&quot;require(): &quot; + require);
+		var parts = require.split(&quot;/&quot;);
+		
+		var size = parts.length;
+		var deferred = new dojo.Deferred;
+		var args = {
+			mimetype: &quot;text/json&quot;,
+			load: function(type, data){
+				dojo.debug(&quot;require(): loaded for &quot; + require);
+				
+				if(parts[0] != &quot;function_names&quot;) {
+					for(var i = 0, part; part = parts[i]; i++){
+						data = data[part];
+					}
+				}
+				deferred.callback(data);
+			},
+			error: function(){
+				deferred.errback();
+			}
+		};
+
+		if(location.protocol == &quot;file:&quot;){
+			if(size){
+				if(parts[parts.length - 1] == &quot;documentation&quot;){
+					parts[parts.length - 1] = &quot;meta&quot;;
+				}
+			
+				if(parts[0] == &quot;function_names&quot;){
+					args.url = [this._url, &quot;local_json&quot;, &quot;function_names&quot;].join(&quot;/&quot;);
+				}else{
+					var dirs = parts[0].split(&quot;.&quot;);
+					args.url = [this._url, &quot;local_json&quot;, dirs[0]].join(&quot;/&quot;);
+					if(dirs.length &gt; 1){
+						args.url = [args.url, dirs[1]].join(&quot;.&quot;);
+					}
+				}
+			}
+		}
+		
+		dojo.io.bind(args);
+		return deferred;
+	},
+	getFunctionNames: function(){
+		return this.require(&quot;function_names&quot;); // dojo.Deferred
+	},
+	unFormat: function(/*String*/ string){
+		var fString = string;
+		if(string.charAt(string.length - 1) == &quot;_&quot;){
+			fString = [string.substring(0, string.length - 1), &quot;*&quot;].join(&quot;&quot;);
+		}
+		return fString;
+	},
+	getMeta: function(/*String*/ pkg, /*String*/ name, /*Function*/ callback, /*String?*/ id){
+		// summary: Gets information about a function in regards to its meta data
+		if(typeof name == &quot;function&quot;){
+			// pId: a
+			// pkg: ignore
+			id = callback;
+			callback = name;
+			name = pkg;
+			pkg = null;
+			dojo.debug(&quot;getMeta(&quot; + name + &quot;)&quot;);
+		}else{
+			dojo.debug(&quot;getMeta(&quot; + pkg + &quot;/&quot; + name + &quot;)&quot;);
+		}
+		
+		if(!id){
+			id = &quot;_&quot;;
+		}
+	},
+	_withPkg: function(/*String*/ type, /*Object*/ data, /*Object*/ evt, /*Object*/ input, /*String*/ newType){
+		dojo.debug(&quot;_withPkg(&quot; + evt.name + &quot;) has package: &quot; + data[0]);
+		evt.pkg = data[0];
+		if(&quot;load&quot; == type &amp;&amp; evt.pkg){
+			evt.type = newType;
+		}else{
+			if(evt.callbacks &amp;&amp; evt.callbacks.length){
+				evt.callbacks.shift()(&quot;error&quot;, {}, evt, evt.input);
+			}
+		}
+	},
+	_gotMeta: function(/*String*/ type, /*Object*/ data, /*Object*/ evt){
+		dojo.debug(&quot;_gotMeta(&quot; + evt.name + &quot;)&quot;);
+
+		var cached = dojo.docs._getCache(evt.pkg, evt.name, &quot;meta&quot;, &quot;functions&quot;, evt.id);
+		if(cached.summary){
+			data.summary = cached.summary;
+		}
+		if(evt.callbacks &amp;&amp; evt.callbacks.length){
+			evt.callbacks.shift()(type, data, evt, evt.input);
+		}
+	},
+	getSrc: function(/*String*/ name, /*Function*/ callback, /*String?*/ id){
+		// summary: Gets src file (created by the doc parser)
+		dojo.debug(&quot;getSrc(&quot; + name + &quot;)&quot;);
+		if(!id){
+			id = &quot;_&quot;;
+		}
+	},
+	getDoc: function(/*String*/ name, /*Function*/ callback, /*String?*/ id){
+		// summary: Gets external documentation stored on Jot for a given function
+		dojo.debug(&quot;getDoc(&quot; + name  + &quot;)&quot;);
+
+		if(!id){
+			id = &quot;_&quot;;
+		}
+
+		var input = {};
+
+		input.type = &quot;doc&quot;;
+		input.name = name;
+		input.callbacks = [callback];
+	},
+	_gotDoc: function(/*String*/ type, /*Array*/ data, /*Object*/ evt, /*Object*/ input){
+		dojo.debug(&quot;_gotDoc(&quot; + evt.type + &quot;)&quot;);
+		
+		evt[evt.type] = data;
+		if(evt.expects &amp;&amp; evt.expects.doc){
+			for(var i = 0, expect; expect = evt.expects.doc[i]; i++){
+				if(!(expect in evt)){
+					dojo.debug(&quot;_gotDoc() waiting for more data&quot;);
+					return;
+				}
+			}
+		}
+		
+		var cache = dojo.docs._getCache(evt.pkg, &quot;meta&quot;, &quot;functions&quot;, evt.name, evt.id, &quot;meta&quot;);
+
+		var description = evt.fn.description;
+		cache.description = description;
+		data = {
+			returns: evt.fn.returns,
+			id: evt.id,
+			variables: []
+		}
+		if(!cache.parameters){
+			cache.parameters = {};
+		}
+		for(var i = 0, param; param = evt.param[i]; i++){
+			var fName = param[&quot;DocParamForm/name&quot;];
+			if(!cache.parameters[fName]){
+				cache.parameters[fName] = {};
+			}
+			cache.parameters[fName].description = param[&quot;DocParamForm/desc&quot;]
+		}
+
+		data.description = cache.description;
+		data.parameters = cache.parameters;
+		
+		evt.type = &quot;doc&quot;;
+	
+		if(evt.callbacks &amp;&amp; evt.callbacks.length){
+			evt.callbacks.shift()(&quot;load&quot;, data, evt, input);
+		}
+	},
+	getPkgDoc: function(/*String*/ name, /*Function*/ callback){
+		// summary: Gets external documentation stored on Jot for a given package
+		dojo.debug(&quot;getPkgDoc(&quot; + name + &quot;)&quot;);
+		var input = {};
+	},
+	getPkgInfo: function(/*String*/ name, /*Function*/ callback){
+		// summary: Gets a combination of the metadata and external documentation for a given package
+		dojo.debug(&quot;getPkgInfo(&quot; + name + &quot;)&quot;);
+
+		var input = {
+			expects: {
+				pkginfo: [&quot;pkgmeta&quot;, &quot;pkgdoc&quot;]
+			},
+			callback: callback
+		};
+		dojo.docs.getPkgMeta(input, name, dojo.docs._getPkgInfo);
+		dojo.docs.getPkgDoc(input, name, dojo.docs._getPkgInfo);
+	},
+	_getPkgInfo: function(/*String*/ type, /*Object*/ data, /*Object*/ evt){
+		dojo.debug(&quot;_getPkgInfo() for &quot; + evt.type);
+		var input = {};
+		var results = {};
+		if(typeof key == &quot;object&quot;){
+			input = key;
+			input[evt.type] = data;
+			if(input.expects &amp;&amp; input.expects.pkginfo){
+				for(var i = 0, expect; expect = input.expects.pkginfo[i]; i++){
+					if(!(expect in input)){
+						dojo.debug(&quot;_getPkgInfo() waiting for more data&quot;);
+						return;
+					}
+				}
+			}
+			results = input.pkgmeta;
+			results.description = input.pkgdoc;
+		}
+
+		if(input.callback){
+			input.callback(&quot;load&quot;, results, evt);
+		}
+	},
+	getInfo: function(/*String*/ name, /*Function*/ callback){
+		dojo.debug(&quot;getInfo(&quot; + name + &quot;)&quot;);
+		var input = {
+			expects: {
+				&quot;info&quot;: [&quot;meta&quot;, &quot;doc&quot;]
+			},
+			callback: callback
+		}
+		dojo.docs.getMeta(input, name, dojo.docs._getInfo);
+		dojo.docs.getDoc(input, name, dojo.docs._getInfo);
+	},
+	_getInfo: function(/*String*/ type, /*String*/ data, /*Object*/ evt, /*Object*/ input){
+		dojo.debug(&quot;_getInfo(&quot; + evt.type + &quot;)&quot;);
+		if(input &amp;&amp; input.expects &amp;&amp; input.expects.info){
+			input[evt.type] = data;
+			for(var i = 0, expect; expect = input.expects.info[i]; i++){
+				if(!(expect in input)){
+					dojo.debug(&quot;_getInfo() waiting for more data&quot;);
+					return;
+				}
+			}
+		}
+
+		if(input.callback){
+			input.callback(&quot;load&quot;, dojo.docs._getCache(evt.pkg, &quot;meta&quot;, &quot;functions&quot;, evt.name, evt.id, &quot;meta&quot;), evt, input);
+		}
+	},
+	_getMainText: function(/*String*/ text){
+		// summary: Grabs the innerHTML from a Jot Rech Text node
+		dojo.debug(&quot;_getMainText()&quot;);
+		return text.replace(/^&lt;html[^&lt;]*&gt;/, &quot;&quot;).replace(/&lt;\/html&gt;$/, &quot;&quot;).replace(/&lt;\w+\s*\/&gt;/g, &quot;&quot;);
+	},
+	getPackageMeta: function(/*Object*/ input){
+		dojo.debug(&quot;getPackageMeta(): &quot; + input.package);
+		return this.require(input.package + &quot;/meta&quot;, input.sync);
+	},
+	getFunctionMeta: function(/*Object*/ input){
+		var package = input.package || &quot;&quot;;
+		var name = input.name;
+		var id = input.id || &quot;_&quot;;
+		dojo.debug(&quot;getFunctionMeta(): &quot; + name);
+
+		if(!name) return;
+
+		if(package){
+			return this.require(package + &quot;/meta/functions/&quot; + name + &quot;/&quot; + id + &quot;/meta&quot;);
+		}else{
+			this.getFunctionNames();
+		}
+	},
+	getFunctionDocumentation: function(/*Object*/ input){
+		var package = input.package || &quot;&quot;;
+		var name = input.name;
+		var id = input.id || &quot;_&quot;;
+		dojo.debug(&quot;getFunctionDocumentation(): &quot; + name);
+		
+		if(!name) return;
+		
+		if(package){
+			return this.require(package + &quot;/meta/functions/&quot; + name + &quot;/&quot; + id + &quot;/documentation&quot;);
+		}
+	},
+	_onDocSearch: function(/*Object*/ input){
+		var _this = this;
+		var name = input.name.toLowerCase();
+		if(!name) return;
+
+		this.getFunctionNames().addCallback(function(data){
+			dojo.debug(&quot;_onDocSearch(): function names loaded for &quot; + name);
+
+			var output = [];
+			var list = [];
+			var closure = function(pkg, fn) {
+				return function(data){
+					dojo.debug(&quot;_onDocSearch(): package meta loaded for: &quot; + pkg);
+					if(data.functions){
+						var functions = data.functions;
+						for(var key in functions){
+							if(fn == key){
+								var ids = functions[key];
+								for(var id in ids){
+									var fnMeta = ids[id];
+									output.push({
+										package: pkg,
+										name: fn,
+										id: id,
+										summary: fnMeta.summary
+									});
+								}
+							}
+						}
+					}
+					return output;
+				}
+			}
+
+			pkgLoop:
+			for(var pkg in data){
+				if(pkg.toLowerCase() == name){
+					name = pkg;
+					dojo.debug(&quot;_onDocSearch found a package&quot;);
+					//dojo.docs._onDocSelectPackage(input);
+					return;
+				}
+				for(var i = 0, fn; fn = data[pkg][i]; i++){
+					if(fn.toLowerCase().indexOf(name) != -1){
+						dojo.debug(&quot;_onDocSearch(): Search matched &quot; + fn);
+						var meta = _this.getPackageMeta({package: pkg});
+						meta.addCallback(closure(pkg, fn));
+						list.push(meta);
+
+						// Build a list of all packages that need to be loaded and their loaded state.
+						continue pkgLoop;
+					}
+				}
+			}
+			
+			list = new dojo.DeferredList(list);
+			list.addCallback(function(results){
+				dojo.debug(&quot;_onDocSearch(): All packages loaded&quot;);
+				_this._printFunctionResults(results[0][1]);
+			});
+		});
+	},
+	_onDocSearchFn: function(/*String*/ type, /*Array*/ data, /*Object*/ evt){
+		dojo.debug(&quot;_onDocSearchFn(&quot; + evt.name + &quot;)&quot;);
+
+		var name = evt.name || evt.pkg;
+
+		dojo.debug(&quot;_onDocSearchFn found a function&quot;);
+
+		evt.pkgs = packages;
+		evt.pkg = name;
+		evt.loaded = 0;
+		for(var i = 0, pkg; pkg = packages[i]; i++){
+			dojo.docs.getPkgMeta(evt, pkg, dojo.docs._onDocResults);
+		}
+	},
+	_onPkgResults: function(/*String*/ type, /*Object*/ data, /*Object*/ evt, /*Object*/ input){
+		dojo.debug(&quot;_onPkgResults(&quot; + evt.type + &quot;)&quot;);
+		var description = &quot;&quot;;
+		var path = &quot;&quot;;
+		var methods = {};
+		var requires = {};
+		if(input){
+			input[evt.type] = data;
+			if(input.expects &amp;&amp; input.expects.pkgresults){
+				for(var i = 0, expect; expect = input.expects.pkgresults[i]; i++){
+					if(!(expect in input)){
+						dojo.debug(&quot;_onPkgResults() waiting for more data&quot;);
+						return;
+					}
+				}
+			}
+			path = input.pkgdoc.path;
+			description = input.pkgdoc.description;
+			methods = input.pkgmeta.methods;
+			requires = input.pkgmeta.requires;
+		}
+		var pkg = evt.name.replace(&quot;_&quot;, &quot;*&quot;);
+		var results = {
+			path: path,
+			description: description,
+			size: 0,
+			methods: [],
+			pkg: pkg,
+			requires: requires
+		}
+		var rePrivate = /_[^.]+$/;
+		for(var method in methods){
+			if(!rePrivate.test(method)){
+				for(var pId in methods[method]){
+					results.methods.push({
+						pkg: pkg,
+						name: method,
+						id: pId,
+						summary: methods[method][pId].summary
+					})
+				}
+			}
+		}
+		results.size = results.methods.length;
+		dojo.docs._printPkgResult(results);
+	},
+	_onDocResults: function(/*String*/ type, /*Object*/ data, /*Object*/ evt, /*Object*/ input){
+		dojo.debug(&quot;_onDocResults(&quot; + evt.name + &quot;/&quot; + input.pkg + &quot;) &quot; + type);
+		++input.loaded;
+
+		if(input.loaded == input.pkgs.length){
+			var pkgs = input.pkgs;
+			var name = input.pkg;
+			var results = {methods: []};
+			var rePrivate = /_[^.]+$/;
+			data = dojo.docs._cache;
+
+			for(var i = 0, pkg; pkg = pkgs[i]; i++){
+				var methods = dojo.docs._getCache(pkg, &quot;meta&quot;, &quot;methods&quot;);
+				for(var fn in methods){
+					if(fn.toLowerCase().indexOf(name) == -1){
+						continue;
+					}
+					if(fn != &quot;requires&quot; &amp;&amp; !rePrivate.test(fn)){
+						for(var pId in methods[fn]){
+							var result = {
+								pkg: pkg,
+								name: fn,
+								id: &quot;_&quot;,
+								summary: &quot;&quot;
+							}
+							if(methods[fn][pId].summary){
+								result.summary = methods[fn][pId].summary;
+							}
+							results.methods.push(result);
+						}
+					}
+				}
+			}
+
+			dojo.debug(&quot;Publishing docResults&quot;);
+			dojo.docs._printFnResults(results);
+		}
+	},
+	_printFunctionResults: function(results){
+		dojo.debug(&quot;_printFnResults(): called&quot;);
+		// summary: Call this function to send the /docs/function/results topic
+	},
+	_printPkgResult: function(results){
+		dojo.debug(&quot;_printPkgResult(): called&quot;);
+	},
+	_onDocSelectFunction: function(/*Object*/ input){
+		// summary: Get doc, meta, and src
+		var name = input.name;
+		var package = input.package || &quot;&quot;;
+		var id = input.id || &quot;_&quot;;
+		dojo.debug(&quot;_onDocSelectFunction(&quot; + name + &quot;)&quot;);
+		if(!name || !package) return false;
+
+		var pkgMeta = this.getPackageMeta({package: package});
+		var meta = this.getFunctionMeta({package: package, name: name, id: id});
+		var doc = this.getFunctionDocumentation({package: package, name: name, id: id});
+		
+		var list = new dojo.DeferredList([pkgMeta, meta, doc]);
+		list.addCallback(function(results){
+			dojo.debug(&quot;_onDocSelectFunction() loaded&quot;);
+			for(var i = 0, result; result = results[i]; i++){
+				dojo.debugShallow(result[1]);
+			}
+		});
+		
+		return list;
+	},
+	_onDocSelectPackage: function(/*Object*/ input){
+		dojo.debug(&quot;_onDocSelectPackage(&quot; + input.name + &quot;)&quot;)
+		input.expects = {
+			&quot;pkgresults&quot;: [&quot;pkgmeta&quot;, &quot;pkgdoc&quot;]
+		};
+		dojo.docs.getPkgMeta(input, input.name, dojo.docs._onPkgResults);
+		dojo.docs.getPkgDoc(input, input.name, dojo.docs._onPkgResults);
+	},
+	_onDocSelectResults: function(/*String*/ type, /*Object*/ data, /*Object*/ evt, /*Object*/ input){
+		dojo.debug(&quot;_onDocSelectResults(&quot; + evt.type + &quot;, &quot; + evt.name + &quot;)&quot;);
+		if(evt.type == &quot;meta&quot;){
+			dojo.docs.getPkgMeta(input, evt.pkg, dojo.docs._onDocSelectResults);
+		}
+		if(input){
+			input[evt.type] = data;
+			if(input.expects &amp;&amp; input.expects.docresults){
+				for(var i = 0, expect; expect = input.expects.docresults[i]; i++){
+					if(!(expect in input)){
+						dojo.debug(&quot;_onDocSelectResults() waiting for more data&quot;);
+						return;
+					}
+				}
+			}
+		}
+
+		dojo.docs._printFunctionDetail(input);
+	},
+	
+	_printFunctionDetail: function(results) {
+		// summary: Call this function to send the /docs/function/detail topic event
+	},
+
+	selectFunction: function(/*String*/ name, /*String?*/ id){
+		// summary: The combined information
+	},
+	savePackage: function(/*Object*/ callbackObject, /*String*/ callback, /*Object*/ parameters){
+		dojo.event.kwConnect({
+			srcObj: dojo.docs,
+			srcFunc: &quot;_savedPkgRpc&quot;,
+			targetObj: callbackObject,
+			targetFunc: callback,
+			once: true
+		});
+		
+		var props = {};
+		var cache = dojo.docs._getCache(parameters.pkg, &quot;meta&quot;);
+
+		var i = 1;
+
+		if(!cache.path){
+			var path = &quot;id&quot;;
+			props[[&quot;pname&quot;, i].join(&quot;&quot;)] = &quot;DocPkgForm/require&quot;;
+			props[[&quot;pvalue&quot;, i++].join(&quot;&quot;)] = parameters.pkg;
+		}else{
+			var path = cache.path;
+		}
+
+		props.form = &quot;//DocPkgForm&quot;;
+		props.path = [&quot;/WikiHome/DojoDotDoc/&quot;, path].join(&quot;&quot;);
+
+		if(parameters.description){
+			props[[&quot;pname&quot;, i].join(&quot;&quot;)] = &quot;main/text&quot;;
+			props[[&quot;pvalue&quot;, i++].join(&quot;&quot;)] = parameters.description;
+		}
+		
+		dojo.docs._rpc.callRemote(&quot;saveForm&quot;,	props).addCallbacks(dojo.docs._pkgRpc, dojo.docs._pkgRpc);
+	},
+	_pkgRpc: function(data){
+		if(data.name){
+			dojo.docs._getCache(data[&quot;DocPkgForm/require&quot;], &quot;meta&quot;).path = data.name;
+			dojo.docs._savedPkgRpc(&quot;load&quot;);
+		}else{
+			dojo.docs._savedPkgRpc(&quot;error&quot;);
+		}
+	},
+	_savedPkgRpc: function(type){
+	},
+	functionPackages: function(/*String*/ name, /*Function*/ callback, /*Object*/ input){
+		// summary: Gets the package associated with a function and stores it in the .pkg value of input
+		dojo.debug(&quot;functionPackages() name: &quot; + name);
+
+		if(!input){
+			input = {};
+		}
+		if(!input.callbacks){
+			input.callbacks = [];
+		}
+
+		input.type = &quot;function_names&quot;;
+		input.name = name;
+		input.callbacks.unshift(callback);
+		input.callbacks.unshift(dojo.docs._functionPackages);
+	},
+	_functionPackages: function(/*String*/ type, /*Array*/ data, /*Object*/ evt){
+		dojo.debug(&quot;_functionPackages() name: &quot; + evt.name);
+		evt.pkg = '';
+
+		var results = [];
+		var data = dojo.docs._cache['function_names'];
+		for(var key in data){
+			if(dojo.lang.inArray(data[key], evt.name)){
+				dojo.debug(&quot;_functionPackages() package: &quot; + key);
+				results.push(key);
+			}
+		}
+
+		if(evt.callbacks &amp;&amp; evt.callbacks.length){
+			evt.callbacks.shift()(type, results, evt, evt.input);
+		}
+	},
+	setUserName: function(/*String*/ name){
+		dojo.docs._userName = name;
+		if(name &amp;&amp; dojo.docs._password){
+			dojo.docs._logIn();
+		}
+	},
+	setPassword: function(/*String*/ password){
+		dojo.docs._password = password;
+		if(password &amp;&amp; dojo.docs._userName){
+			dojo.docs._logIn();
+		}
+	},
+	_logIn: function(){
+		dojo.io.bind({
+			url: dojo.docs._rpc.serviceUrl.toString(),
+			method: &quot;post&quot;,
+			mimetype: &quot;text/json&quot;,
+			content: {
+				username: dojo.docs._userName,
+				password: dojo.docs._password
+			},
+			load: function(type, data){
+				if(data.error){
+					dojo.docs.logInSuccess();
+				}else{
+					dojo.docs.logInFailure();
+				}
+			},
+			error: function(){
+				dojo.docs.logInFailure();
+			}
+		});
+	},
+	logInSuccess: function(){},
+	logInFailure: function(){},
+	_set: function(/*Object*/ base, /*String...*/ keys, /*String*/ value){
+		var args = [];
+		for(var i = 0, arg; arg = arguments[i]; i++){
+			args.push(arg);
+		}
+
+		if(args.length &lt; 3) return;
+		base = args.shift();
+		value = args.pop();
+		var key = args.pop();
+		for(var i = 0, arg; arg = args[i]; i++){
+			if(typeof base[arg] != &quot;object&quot;){
+				base[arg] = {};
+			}
+			base = base[arg];
+		}
+		base[key] = value;
+	},
+	_getCache: function(/*String...*/ keys){
+		var obj = dojo.docs._cache;
+		for(var i = 0; i &lt; arguments.length; i++){
+			var arg = arguments[i];
+			if(!obj[arg]){
+				obj[arg] = {};
+			}
+			obj = obj[arg];
+		}
+		return obj;
+	}
+});
+
+dojo.event.topic.subscribe(&quot;/docs/search&quot;, dojo.docs, &quot;_onDocSearch&quot;);
+dojo.event.topic.subscribe(&quot;/docs/function/select&quot;, dojo.docs, &quot;_onDocSelectFunction&quot;);
+dojo.event.topic.subscribe(&quot;/docs/package/select&quot;, dojo.docs, &quot;_onDocSelectPackage&quot;);
+
+dojo.event.topic.registerPublisher(&quot;/docs/function/results&quot;, dojo.docs, &quot;_printFunctionResults&quot;);
+dojo.event.topic.registerPublisher(&quot;/docs/function/detail&quot;, dojo.docs, &quot;_printFunctionDetail&quot;);
+dojo.event.topic.registerPublisher(&quot;/docs/package/detail&quot;, dojo.docs, &quot;_printPkgResult&quot;);

Added: tags/parley-0.55/root/static/magic/src/dom.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/dom.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/dom.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,381 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.dom&quot;);
+dojo.dom.ELEMENT_NODE = 1;
+dojo.dom.ATTRIBUTE_NODE = 2;
+dojo.dom.TEXT_NODE = 3;
+dojo.dom.CDATA_SECTION_NODE = 4;
+dojo.dom.ENTITY_REFERENCE_NODE = 5;
+dojo.dom.ENTITY_NODE = 6;
+dojo.dom.PROCESSING_INSTRUCTION_NODE = 7;
+dojo.dom.COMMENT_NODE = 8;
+dojo.dom.DOCUMENT_NODE = 9;
+dojo.dom.DOCUMENT_TYPE_NODE = 10;
+dojo.dom.DOCUMENT_FRAGMENT_NODE = 11;
+dojo.dom.NOTATION_NODE = 12;
+dojo.dom.dojoml = &quot;<A HREF="http://www.dojotoolkit.org/2004/dojoml">http://www.dojotoolkit.org/2004/dojoml</A>&quot;;
+dojo.dom.xmlns = {svg:&quot;<A HREF="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</A>&quot;, smil:&quot;<A HREF="http://www.w3.org/2001/SMIL20/">http://www.w3.org/2001/SMIL20/</A>&quot;, mml:&quot;<A HREF="http://www.w3.org/1998/Math/MathML">http://www.w3.org/1998/Math/MathML</A>&quot;, cml:&quot;<A HREF="http://www.xml-cml.org">http://www.xml-cml.org</A>&quot;, xlink:&quot;<A HREF="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</A>&quot;, xhtml:&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot;, xul:&quot;<A HREF="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul">http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul</A>&quot;, xbl:&quot;<A HREF="http://www.mozilla.org/xbl">http://www.mozilla.org/xbl</A>&quot;, fo:&quot;<A HREF="http://www.w3.org/1999/XSL/Format">http://www.w3.org/1999/XSL/Format</A>&quot;, xsl:&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot;, xslt:&quot;<A HREF="http://www.w3.org/1999/XSL/Transform">http://www.w3.org/1999/XSL/Transform</A>&quot;, xi:&quot;<A HREF="http://www.w3.org/2001/XInclude">http://www.w3.org/2001/XInclude</A>&quot;, xforms:&quot;<A HREF="http://www.w3.org/2002/01/xforms">http://www.w3.org/2002/01/xforms</A>&quot;, saxon:&quot;<A HREF="http://icl.com/saxon">http://icl.com/saxon</A>&quot;, xalan:&quot;<A HREF="http://xml.apache.org/xslt">http://xml.apache.org/xslt</A>&quot;, xsd:&quot;<A HREF="http://www.w3.org/2001/XMLSchema">http://www.w3.org/2001/XMLSchema</A>&quot;, dt:&quot;<A HREF="http://www.w3.org/2001/XMLSchema-datatypes">http://www.w3.org/2001/XMLSchema-datatypes</A>&quot;, xsi:&quot;<A HREF="http://www.w3.org/2001/XMLSchema-instance">http://www.w3.org/2001/XMLSchema-instance</A>&quot;, rdf:&quot;<A HREF="http://www.w3.org/1999/02/22-rdf-syntax-ns#">http://www.w3.org/1999/02/22-rdf-syntax-ns#</A>&quot;, rdfs:&quot;<A HREF="http://www.w3.org/2000/01/rdf-schema#">http://www.w3.org/2000/01/rdf-schema#</A>&quot;, dc:&quot;<A HREF="http://purl.org/dc/elements/1.1/">http://purl.org/dc/elements/1.1/</A>&quot;, dcq:&quot;<A HREF="http://purl.org/dc/qualifiers/1.0">http://purl.org/dc/qualifiers/1.0</A>&quot;, &quot;soap-env&quot;:&quot;<A HREF="http://schemas.xmlsoap.org/soap/envelope/">http://schemas.xmlsoap.org/soap/envelope/</A>&quot;,!
  wsdl:&quot;<A HREF="http://schemas.xmlsoap.org/wsdl/">http://schemas.xmlsoap.org/wsdl/</A>&quot;, AdobeExtensions:&quot;<A HREF="http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/">http://ns.adobe.com/AdobeSVGViewerExtensions/3.0/</A>&quot;};
+dojo.dom.isNode = function (wh) {
+	if (typeof Element == &quot;function&quot;) {
+		try {
+			return wh instanceof Element;
+		}
+		catch (e) {
+		}
+	} else {
+		return wh &amp;&amp; !isNaN(wh.nodeType);
+	}
+};
+dojo.dom.getUniqueId = function () {
+	var _document = dojo.doc();
+	do {
+		var id = &quot;dj_unique_&quot; + (++arguments.callee._idIncrement);
+	} while (_document.getElementById(id));
+	return id;
+};
+dojo.dom.getUniqueId._idIncrement = 0;
+dojo.dom.firstElement = dojo.dom.getFirstChildElement = function (parentNode, tagName) {
+	var node = parentNode.firstChild;
+	while (node &amp;&amp; node.nodeType != dojo.dom.ELEMENT_NODE) {
+		node = node.nextSibling;
+	}
+	if (tagName &amp;&amp; node &amp;&amp; node.tagName &amp;&amp; node.tagName.toLowerCase() != tagName.toLowerCase()) {
+		node = dojo.dom.nextElement(node, tagName);
+	}
+	return node;
+};
+dojo.dom.lastElement = dojo.dom.getLastChildElement = function (parentNode, tagName) {
+	var node = parentNode.lastChild;
+	while (node &amp;&amp; node.nodeType != dojo.dom.ELEMENT_NODE) {
+		node = node.previousSibling;
+	}
+	if (tagName &amp;&amp; node &amp;&amp; node.tagName &amp;&amp; node.tagName.toLowerCase() != tagName.toLowerCase()) {
+		node = dojo.dom.prevElement(node, tagName);
+	}
+	return node;
+};
+dojo.dom.nextElement = dojo.dom.getNextSiblingElement = function (node, tagName) {
+	if (!node) {
+		return null;
+	}
+	do {
+		node = node.nextSibling;
+	} while (node &amp;&amp; node.nodeType != dojo.dom.ELEMENT_NODE);
+	if (node &amp;&amp; tagName &amp;&amp; tagName.toLowerCase() != node.tagName.toLowerCase()) {
+		return dojo.dom.nextElement(node, tagName);
+	}
+	return node;
+};
+dojo.dom.prevElement = dojo.dom.getPreviousSiblingElement = function (node, tagName) {
+	if (!node) {
+		return null;
+	}
+	if (tagName) {
+		tagName = tagName.toLowerCase();
+	}
+	do {
+		node = node.previousSibling;
+	} while (node &amp;&amp; node.nodeType != dojo.dom.ELEMENT_NODE);
+	if (node &amp;&amp; tagName &amp;&amp; tagName.toLowerCase() != node.tagName.toLowerCase()) {
+		return dojo.dom.prevElement(node, tagName);
+	}
+	return node;
+};
+dojo.dom.moveChildren = function (srcNode, destNode, trim) {
+	var count = 0;
+	if (trim) {
+		while (srcNode.hasChildNodes() &amp;&amp; srcNode.firstChild.nodeType == dojo.dom.TEXT_NODE) {
+			srcNode.removeChild(srcNode.firstChild);
+		}
+		while (srcNode.hasChildNodes() &amp;&amp; srcNode.lastChild.nodeType == dojo.dom.TEXT_NODE) {
+			srcNode.removeChild(srcNode.lastChild);
+		}
+	}
+	while (srcNode.hasChildNodes()) {
+		destNode.appendChild(srcNode.firstChild);
+		count++;
+	}
+	return count;
+};
+dojo.dom.copyChildren = function (srcNode, destNode, trim) {
+	var clonedNode = srcNode.cloneNode(true);
+	return this.moveChildren(clonedNode, destNode, trim);
+};
+dojo.dom.replaceChildren = function (node, newChild) {
+	var nodes = [];
+	if (dojo.render.html.ie) {
+		for (var i = 0; i &lt; node.childNodes.length; i++) {
+			nodes.push(node.childNodes[i]);
+		}
+	}
+	dojo.dom.removeChildren(node);
+	node.appendChild(newChild);
+	for (var i = 0; i &lt; nodes.length; i++) {
+		dojo.dom.destroyNode(nodes[i]);
+	}
+};
+dojo.dom.removeChildren = function (node) {
+	var count = node.childNodes.length;
+	while (node.hasChildNodes()) {
+		dojo.dom.removeNode(node.firstChild);
+	}
+	return count;
+};
+dojo.dom.replaceNode = function (node, newNode) {
+	return node.parentNode.replaceChild(newNode, node);
+};
+dojo.dom.destroyNode = function (node) {
+	if (node.parentNode) {
+		node = dojo.dom.removeNode(node);
+	}
+	if (node.nodeType != 3) {
+		if (dojo.evalObjPath(&quot;dojo.event.browser.clean&quot;, false)) {
+			dojo.event.browser.clean(node);
+		}
+		if (dojo.render.html.ie) {
+			node.outerHTML = &quot;&quot;;
+		}
+	}
+};
+dojo.dom.removeNode = function (node) {
+	if (node &amp;&amp; node.parentNode) {
+		return node.parentNode.removeChild(node);
+	}
+};
+dojo.dom.getAncestors = function (node, filterFunction, returnFirstHit) {
+	var ancestors = [];
+	var isFunction = (filterFunction &amp;&amp; (filterFunction instanceof Function || typeof filterFunction == &quot;function&quot;));
+	while (node) {
+		if (!isFunction || filterFunction(node)) {
+			ancestors.push(node);
+		}
+		if (returnFirstHit &amp;&amp; ancestors.length &gt; 0) {
+			return ancestors[0];
+		}
+		node = node.parentNode;
+	}
+	if (returnFirstHit) {
+		return null;
+	}
+	return ancestors;
+};
+dojo.dom.getAncestorsByTag = function (node, tag, returnFirstHit) {
+	tag = tag.toLowerCase();
+	return dojo.dom.getAncestors(node, function (el) {
+		return ((el.tagName) &amp;&amp; (el.tagName.toLowerCase() == tag));
+	}, returnFirstHit);
+};
+dojo.dom.getFirstAncestorByTag = function (node, tag) {
+	return dojo.dom.getAncestorsByTag(node, tag, true);
+};
+dojo.dom.isDescendantOf = function (node, ancestor, guaranteeDescendant) {
+	if (guaranteeDescendant &amp;&amp; node) {
+		node = node.parentNode;
+	}
+	while (node) {
+		if (node == ancestor) {
+			return true;
+		}
+		node = node.parentNode;
+	}
+	return false;
+};
+dojo.dom.innerXML = function (node) {
+	if (node.innerXML) {
+		return node.innerXML;
+	} else {
+		if (node.xml) {
+			return node.xml;
+		} else {
+			if (typeof XMLSerializer != &quot;undefined&quot;) {
+				return (new XMLSerializer()).serializeToString(node);
+			}
+		}
+	}
+};
+dojo.dom.createDocument = function () {
+	var doc = null;
+	var _document = dojo.doc();
+	if (!dj_undef(&quot;ActiveXObject&quot;)) {
+		var prefixes = [&quot;MSXML2&quot;, &quot;Microsoft&quot;, &quot;MSXML&quot;, &quot;MSXML3&quot;];
+		for (var i = 0; i &lt; prefixes.length; i++) {
+			try {
+				doc = new ActiveXObject(prefixes[i] + &quot;.XMLDOM&quot;);
+			}
+			catch (e) {
+			}
+			if (doc) {
+				break;
+			}
+		}
+	} else {
+		if ((_document.implementation) &amp;&amp; (_document.implementation.createDocument)) {
+			doc = _document.implementation.createDocument(&quot;&quot;, &quot;&quot;, null);
+		}
+	}
+	return doc;
+};
+dojo.dom.createDocumentFromText = function (str, mimetype) {
+	if (!mimetype) {
+		mimetype = &quot;text/xml&quot;;
+	}
+	if (!dj_undef(&quot;DOMParser&quot;)) {
+		var parser = new DOMParser();
+		return parser.parseFromString(str, mimetype);
+	} else {
+		if (!dj_undef(&quot;ActiveXObject&quot;)) {
+			var domDoc = dojo.dom.createDocument();
+			if (domDoc) {
+				domDoc.async = false;
+				domDoc.loadXML(str);
+				return domDoc;
+			} else {
+				dojo.debug(&quot;toXml didn't work?&quot;);
+			}
+		} else {
+			var _document = dojo.doc();
+			if (_document.createElement) {
+				var tmp = _document.createElement(&quot;xml&quot;);
+				tmp.innerHTML = str;
+				if (_document.implementation &amp;&amp; _document.implementation.createDocument) {
+					var xmlDoc = _document.implementation.createDocument(&quot;foo&quot;, &quot;&quot;, null);
+					for (var i = 0; i &lt; tmp.childNodes.length; i++) {
+						xmlDoc.importNode(tmp.childNodes.item(i), true);
+					}
+					return xmlDoc;
+				}
+				return ((tmp.document) &amp;&amp; (tmp.document.firstChild ? tmp.document.firstChild : tmp));
+			}
+		}
+	}
+	return null;
+};
+dojo.dom.prependChild = function (node, parent) {
+	if (parent.firstChild) {
+		parent.insertBefore(node, parent.firstChild);
+	} else {
+		parent.appendChild(node);
+	}
+	return true;
+};
+dojo.dom.insertBefore = function (node, ref, force) {
+	if ((force != true) &amp;&amp; (node === ref || node.nextSibling === ref)) {
+		return false;
+	}
+	var parent = ref.parentNode;
+	parent.insertBefore(node, ref);
+	return true;
+};
+dojo.dom.insertAfter = function (node, ref, force) {
+	var pn = ref.parentNode;
+	if (ref == pn.lastChild) {
+		if ((force != true) &amp;&amp; (node === ref)) {
+			return false;
+		}
+		pn.appendChild(node);
+	} else {
+		return this.insertBefore(node, ref.nextSibling, force);
+	}
+	return true;
+};
+dojo.dom.insertAtPosition = function (node, ref, position) {
+	if ((!node) || (!ref) || (!position)) {
+		return false;
+	}
+	switch (position.toLowerCase()) {
+	  case &quot;before&quot;:
+		return dojo.dom.insertBefore(node, ref);
+	  case &quot;after&quot;:
+		return dojo.dom.insertAfter(node, ref);
+	  case &quot;first&quot;:
+		if (ref.firstChild) {
+			return dojo.dom.insertBefore(node, ref.firstChild);
+		} else {
+			ref.appendChild(node);
+			return true;
+		}
+		break;
+	  default:
+		ref.appendChild(node);
+		return true;
+	}
+};
+dojo.dom.insertAtIndex = function (node, containingNode, insertionIndex) {
+	var siblingNodes = containingNode.childNodes;
+	if (!siblingNodes.length || siblingNodes.length == insertionIndex) {
+		containingNode.appendChild(node);
+		return true;
+	}
+	if (insertionIndex == 0) {
+		return dojo.dom.prependChild(node, containingNode);
+	}
+	return dojo.dom.insertAfter(node, siblingNodes[insertionIndex - 1]);
+};
+dojo.dom.textContent = function (node, text) {
+	if (arguments.length &gt; 1) {
+		var _document = dojo.doc();
+		dojo.dom.replaceChildren(node, _document.createTextNode(text));
+		return text;
+	} else {
+		if (node.textContent != undefined) {
+			return node.textContent;
+		}
+		var _result = &quot;&quot;;
+		if (node == null) {
+			return _result;
+		}
+		for (var i = 0; i &lt; node.childNodes.length; i++) {
+			switch (node.childNodes[i].nodeType) {
+			  case 1:
+			  case 5:
+				_result += dojo.dom.textContent(node.childNodes[i]);
+				break;
+			  case 3:
+			  case 2:
+			  case 4:
+				_result += node.childNodes[i].nodeValue;
+				break;
+			  default:
+				break;
+			}
+		}
+		return _result;
+	}
+};
+dojo.dom.hasParent = function (node) {
+	return Boolean(node &amp;&amp; node.parentNode &amp;&amp; dojo.dom.isNode(node.parentNode));
+};
+dojo.dom.isTag = function (node) {
+	if (node &amp;&amp; node.tagName) {
+		for (var i = 1; i &lt; arguments.length; i++) {
+			if (node.tagName == String(arguments[i])) {
+				return String(arguments[i]);
+			}
+		}
+	}
+	return &quot;&quot;;
+};
+dojo.dom.setAttributeNS = function (elem, namespaceURI, attrName, attrValue) {
+	if (elem == null || ((elem == undefined) &amp;&amp; (typeof elem == &quot;undefined&quot;))) {
+		dojo.raise(&quot;No element given to dojo.dom.setAttributeNS&quot;);
+	}
+	if (!((elem.setAttributeNS == undefined) &amp;&amp; (typeof elem.setAttributeNS == &quot;undefined&quot;))) {
+		elem.setAttributeNS(namespaceURI, attrName, attrValue);
+	} else {
+		var ownerDoc = elem.ownerDocument;
+		var attribute = ownerDoc.createNode(2, attrName, namespaceURI);
+		attribute.nodeValue = attrValue;
+		elem.setAttributeNode(attribute);
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/event/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/event/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/event/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.event.common&quot;, &quot;dojo.event.topic&quot;], browser:[&quot;dojo.event.browser&quot;], dashboard:[&quot;dojo.event.browser&quot;]});
+dojo.provide(&quot;dojo.event.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/event/browser.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/event/browser.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/event/browser.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,491 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.event.browser&quot;);
+dojo.require(&quot;dojo.event.common&quot;);
+dojo._ie_clobber = new function () {
+	this.clobberNodes = [];
+	function nukeProp(node, prop) {
+		try {
+			node[prop] = null;
+		}
+		catch (e) {
+		}
+		try {
+			delete node[prop];
+		}
+		catch (e) {
+		}
+		try {
+			node.removeAttribute(prop);
+		}
+		catch (e) {
+		}
+	}
+	this.clobber = function (nodeRef) {
+		var na;
+		var tna;
+		if (nodeRef) {
+			tna = nodeRef.all || nodeRef.getElementsByTagName(&quot;*&quot;);
+			na = [nodeRef];
+			for (var x = 0; x &lt; tna.length; x++) {
+				if (tna[x][&quot;__doClobber__&quot;]) {
+					na.push(tna[x]);
+				}
+			}
+		} else {
+			try {
+				window.onload = null;
+			}
+			catch (e) {
+			}
+			na = (this.clobberNodes.length) ? this.clobberNodes : document.all;
+		}
+		tna = null;
+		var basis = {};
+		for (var i = na.length - 1; i &gt;= 0; i = i - 1) {
+			var el = na[i];
+			try {
+				if (el &amp;&amp; el[&quot;__clobberAttrs__&quot;]) {
+					for (var j = 0; j &lt; el.__clobberAttrs__.length; j++) {
+						nukeProp(el, el.__clobberAttrs__[j]);
+					}
+					nukeProp(el, &quot;__clobberAttrs__&quot;);
+					nukeProp(el, &quot;__doClobber__&quot;);
+				}
+			}
+			catch (e) {
+			}
+		}
+		na = null;
+	};
+};
+if (dojo.render.html.ie) {
+	dojo.addOnUnload(function () {
+		dojo._ie_clobber.clobber();
+		try {
+			if ((dojo[&quot;widget&quot;]) &amp;&amp; (dojo.widget[&quot;manager&quot;])) {
+				dojo.widget.manager.destroyAll();
+			}
+		}
+		catch (e) {
+		}
+		if (dojo.widget) {
+			for (var name in dojo.widget._templateCache) {
+				if (dojo.widget._templateCache[name].node) {
+					dojo.dom.destroyNode(dojo.widget._templateCache[name].node);
+					dojo.widget._templateCache[name].node = null;
+					delete dojo.widget._templateCache[name].node;
+				}
+			}
+		}
+		try {
+			window.onload = null;
+		}
+		catch (e) {
+		}
+		try {
+			window.onunload = null;
+		}
+		catch (e) {
+		}
+		dojo._ie_clobber.clobberNodes = [];
+	});
+}
+dojo.event.browser = new function () {
+	var clobberIdx = 0;
+	this.normalizedEventName = function (eventName) {
+		switch (eventName) {
+		  case &quot;CheckboxStateChange&quot;:
+		  case &quot;DOMAttrModified&quot;:
+		  case &quot;DOMMenuItemActive&quot;:
+		  case &quot;DOMMenuItemInactive&quot;:
+		  case &quot;DOMMouseScroll&quot;:
+		  case &quot;DOMNodeInserted&quot;:
+		  case &quot;DOMNodeRemoved&quot;:
+		  case &quot;RadioStateChange&quot;:
+			return eventName;
+			break;
+		  default:
+			var lcn = eventName.toLowerCase();
+			return (lcn.indexOf(&quot;on&quot;) == 0) ? lcn.substr(2) : lcn;
+			break;
+		}
+	};
+	this.clean = function (node) {
+		if (dojo.render.html.ie) {
+			dojo._ie_clobber.clobber(node);
+		}
+	};
+	this.addClobberNode = function (node) {
+		if (!dojo.render.html.ie) {
+			return;
+		}
+		if (!node[&quot;__doClobber__&quot;]) {
+			node.__doClobber__ = true;
+			dojo._ie_clobber.clobberNodes.push(node);
+			node.__clobberAttrs__ = [];
+		}
+	};
+	this.addClobberNodeAttrs = function (node, props) {
+		if (!dojo.render.html.ie) {
+			return;
+		}
+		this.addClobberNode(node);
+		for (var x = 0; x &lt; props.length; x++) {
+			node.__clobberAttrs__.push(props[x]);
+		}
+	};
+	this.removeListener = function (node, evtName, fp, capture) {
+		if (!capture) {
+			var capture = false;
+		}
+		evtName = dojo.event.browser.normalizedEventName(evtName);
+		if (evtName == &quot;key&quot;) {
+			if (dojo.render.html.ie) {
+				this.removeListener(node, &quot;onkeydown&quot;, fp, capture);
+			}
+			evtName = &quot;keypress&quot;;
+		}
+		if (node.removeEventListener) {
+			node.removeEventListener(evtName, fp, capture);
+		}
+	};
+	this.addListener = function (node, evtName, fp, capture, dontFix) {
+		if (!node) {
+			return;
+		}
+		if (!capture) {
+			var capture = false;
+		}
+		evtName = dojo.event.browser.normalizedEventName(evtName);
+		if (evtName == &quot;key&quot;) {
+			if (dojo.render.html.ie) {
+				this.addListener(node, &quot;onkeydown&quot;, fp, capture, dontFix);
+			}
+			evtName = &quot;keypress&quot;;
+		}
+		if (!dontFix) {
+			var newfp = function (evt) {
+				if (!evt) {
+					evt = window.event;
+				}
+				var ret = fp(dojo.event.browser.fixEvent(evt, this));
+				if (capture) {
+					dojo.event.browser.stopEvent(evt);
+				}
+				return ret;
+			};
+		} else {
+			newfp = fp;
+		}
+		if (node.addEventListener) {
+			node.addEventListener(evtName, newfp, capture);
+			return newfp;
+		} else {
+			evtName = &quot;on&quot; + evtName;
+			if (typeof node[evtName] == &quot;function&quot;) {
+				var oldEvt = node[evtName];
+				node[evtName] = function (e) {
+					oldEvt(e);
+					return newfp(e);
+				};
+			} else {
+				node[evtName] = newfp;
+			}
+			if (dojo.render.html.ie) {
+				this.addClobberNodeAttrs(node, [evtName]);
+			}
+			return newfp;
+		}
+	};
+	this.isEvent = function (obj) {
+		return (typeof obj != &quot;undefined&quot;) &amp;&amp; (obj) &amp;&amp; (typeof Event != &quot;undefined&quot;) &amp;&amp; (obj.eventPhase);
+	};
+	this.currentEvent = null;
+	this.callListener = function (listener, curTarget) {
+		if (typeof listener != &quot;function&quot;) {
+			dojo.raise(&quot;listener not a function: &quot; + listener);
+		}
+		dojo.event.browser.currentEvent.currentTarget = curTarget;
+		return listener.call(curTarget, dojo.event.browser.currentEvent);
+	};
+	this._stopPropagation = function () {
+		dojo.event.browser.currentEvent.cancelBubble = true;
+	};
+	this._preventDefault = function () {
+		dojo.event.browser.currentEvent.returnValue = false;
+	};
+	this.keys = {KEY_BACKSPACE:8, KEY_TAB:9, KEY_CLEAR:12, KEY_ENTER:13, KEY_SHIFT:16, KEY_CTRL:17, KEY_ALT:18, KEY_PAUSE:19, KEY_CAPS_LOCK:20, KEY_ESCAPE:27, KEY_SPACE:32, KEY_PAGE_UP:33, KEY_PAGE_DOWN:34, KEY_END:35, KEY_HOME:36, KEY_LEFT_ARROW:37, KEY_UP_ARROW:38, KEY_RIGHT_ARROW:39, KEY_DOWN_ARROW:40, KEY_INSERT:45, KEY_DELETE:46, KEY_HELP:47, KEY_LEFT_WINDOW:91, KEY_RIGHT_WINDOW:92, KEY_SELECT:93, KEY_NUMPAD_0:96, KEY_NUMPAD_1:97, KEY_NUMPAD_2:98, KEY_NUMPAD_3:99, KEY_NUMPAD_4:100, KEY_NUMPAD_5:101, KEY_NUMPAD_6:102, KEY_NUMPAD_7:103, KEY_NUMPAD_8:104, KEY_NUMPAD_9:105, KEY_NUMPAD_MULTIPLY:106, KEY_NUMPAD_PLUS:107, KEY_NUMPAD_ENTER:108, KEY_NUMPAD_MINUS:109, KEY_NUMPAD_PERIOD:110, KEY_NUMPAD_DIVIDE:111, KEY_F1:112, KEY_F2:113, KEY_F3:114, KEY_F4:115, KEY_F5:116, KEY_F6:117, KEY_F7:118, KEY_F8:119, KEY_F9:120, KEY_F10:121, KEY_F11:122, KEY_F12:123, KEY_F13:124, KEY_F14:125, KEY_F15:126, KEY_NUM_LOCK:144, KEY_SCROLL_LOCK:145};
+	this.revKeys = [];
+	for (var key in this.keys) {
+		this.revKeys[this.keys[key]] = key;
+	}
+	this.fixEvent = function (evt, sender) {
+		if (!evt) {
+			if (window[&quot;event&quot;]) {
+				evt = window.event;
+			}
+		}
+		if ((evt[&quot;type&quot;]) &amp;&amp; (evt[&quot;type&quot;].indexOf(&quot;key&quot;) == 0)) {
+			evt.keys = this.revKeys;
+			for (var key in this.keys) {
+				evt[key] = this.keys[key];
+			}
+			if (evt[&quot;type&quot;] == &quot;keydown&quot; &amp;&amp; dojo.render.html.ie) {
+				switch (evt.keyCode) {
+				  case evt.KEY_SHIFT:
+				  case evt.KEY_CTRL:
+				  case evt.KEY_ALT:
+				  case evt.KEY_CAPS_LOCK:
+				  case evt.KEY_LEFT_WINDOW:
+				  case evt.KEY_RIGHT_WINDOW:
+				  case evt.KEY_SELECT:
+				  case evt.KEY_NUM_LOCK:
+				  case evt.KEY_SCROLL_LOCK:
+				  case evt.KEY_NUMPAD_0:
+				  case evt.KEY_NUMPAD_1:
+				  case evt.KEY_NUMPAD_2:
+				  case evt.KEY_NUMPAD_3:
+				  case evt.KEY_NUMPAD_4:
+				  case evt.KEY_NUMPAD_5:
+				  case evt.KEY_NUMPAD_6:
+				  case evt.KEY_NUMPAD_7:
+				  case evt.KEY_NUMPAD_8:
+				  case evt.KEY_NUMPAD_9:
+				  case evt.KEY_NUMPAD_PERIOD:
+					break;
+				  case evt.KEY_NUMPAD_MULTIPLY:
+				  case evt.KEY_NUMPAD_PLUS:
+				  case evt.KEY_NUMPAD_ENTER:
+				  case evt.KEY_NUMPAD_MINUS:
+				  case evt.KEY_NUMPAD_DIVIDE:
+					break;
+				  case evt.KEY_PAUSE:
+				  case evt.KEY_TAB:
+				  case evt.KEY_BACKSPACE:
+				  case evt.KEY_ENTER:
+				  case evt.KEY_ESCAPE:
+				  case evt.KEY_PAGE_UP:
+				  case evt.KEY_PAGE_DOWN:
+				  case evt.KEY_END:
+				  case evt.KEY_HOME:
+				  case evt.KEY_LEFT_ARROW:
+				  case evt.KEY_UP_ARROW:
+				  case evt.KEY_RIGHT_ARROW:
+				  case evt.KEY_DOWN_ARROW:
+				  case evt.KEY_INSERT:
+				  case evt.KEY_DELETE:
+				  case evt.KEY_F1:
+				  case evt.KEY_F2:
+				  case evt.KEY_F3:
+				  case evt.KEY_F4:
+				  case evt.KEY_F5:
+				  case evt.KEY_F6:
+				  case evt.KEY_F7:
+				  case evt.KEY_F8:
+				  case evt.KEY_F9:
+				  case evt.KEY_F10:
+				  case evt.KEY_F11:
+				  case evt.KEY_F12:
+				  case evt.KEY_F12:
+				  case evt.KEY_F13:
+				  case evt.KEY_F14:
+				  case evt.KEY_F15:
+				  case evt.KEY_CLEAR:
+				  case evt.KEY_HELP:
+					evt.key = evt.keyCode;
+					break;
+				  default:
+					if (evt.ctrlKey || evt.altKey) {
+						var unifiedCharCode = evt.keyCode;
+						if (unifiedCharCode &gt;= 65 &amp;&amp; unifiedCharCode &lt;= 90 &amp;&amp; evt.shiftKey == false) {
+							unifiedCharCode += 32;
+						}
+						if (unifiedCharCode &gt;= 1 &amp;&amp; unifiedCharCode &lt;= 26 &amp;&amp; evt.ctrlKey) {
+							unifiedCharCode += 96;
+						}
+						evt.key = String.fromCharCode(unifiedCharCode);
+					}
+				}
+			} else {
+				if (evt[&quot;type&quot;] == &quot;keypress&quot;) {
+					if (dojo.render.html.opera) {
+						if (evt.which == 0) {
+							evt.key = evt.keyCode;
+						} else {
+							if (evt.which &gt; 0) {
+								switch (evt.which) {
+								  case evt.KEY_SHIFT:
+								  case evt.KEY_CTRL:
+								  case evt.KEY_ALT:
+								  case evt.KEY_CAPS_LOCK:
+								  case evt.KEY_NUM_LOCK:
+								  case evt.KEY_SCROLL_LOCK:
+									break;
+								  case evt.KEY_PAUSE:
+								  case evt.KEY_TAB:
+								  case evt.KEY_BACKSPACE:
+								  case evt.KEY_ENTER:
+								  case evt.KEY_ESCAPE:
+									evt.key = evt.which;
+									break;
+								  default:
+									var unifiedCharCode = evt.which;
+									if ((evt.ctrlKey || evt.altKey || evt.metaKey) &amp;&amp; (evt.which &gt;= 65 &amp;&amp; evt.which &lt;= 90 &amp;&amp; evt.shiftKey == false)) {
+										unifiedCharCode += 32;
+									}
+									evt.key = String.fromCharCode(unifiedCharCode);
+								}
+							}
+						}
+					} else {
+						if (dojo.render.html.ie) {
+							if (!evt.ctrlKey &amp;&amp; !evt.altKey &amp;&amp; evt.keyCode &gt;= evt.KEY_SPACE) {
+								evt.key = String.fromCharCode(evt.keyCode);
+							}
+						} else {
+							if (dojo.render.html.safari) {
+								switch (evt.keyCode) {
+								  case 25:
+									evt.key = evt.KEY_TAB;
+									evt.shift = true;
+									break;
+								  case 63232:
+									evt.key = evt.KEY_UP_ARROW;
+									break;
+								  case 63233:
+									evt.key = evt.KEY_DOWN_ARROW;
+									break;
+								  case 63234:
+									evt.key = evt.KEY_LEFT_ARROW;
+									break;
+								  case 63235:
+									evt.key = evt.KEY_RIGHT_ARROW;
+									break;
+								  case 63236:
+									evt.key = evt.KEY_F1;
+									break;
+								  case 63237:
+									evt.key = evt.KEY_F2;
+									break;
+								  case 63238:
+									evt.key = evt.KEY_F3;
+									break;
+								  case 63239:
+									evt.key = evt.KEY_F4;
+									break;
+								  case 63240:
+									evt.key = evt.KEY_F5;
+									break;
+								  case 63241:
+									evt.key = evt.KEY_F6;
+									break;
+								  case 63242:
+									evt.key = evt.KEY_F7;
+									break;
+								  case 63243:
+									evt.key = evt.KEY_F8;
+									break;
+								  case 63244:
+									evt.key = evt.KEY_F9;
+									break;
+								  case 63245:
+									evt.key = evt.KEY_F10;
+									break;
+								  case 63246:
+									evt.key = evt.KEY_F11;
+									break;
+								  case 63247:
+									evt.key = evt.KEY_F12;
+									break;
+								  case 63250:
+									evt.key = evt.KEY_PAUSE;
+									break;
+								  case 63272:
+									evt.key = evt.KEY_DELETE;
+									break;
+								  case 63273:
+									evt.key = evt.KEY_HOME;
+									break;
+								  case 63275:
+									evt.key = evt.KEY_END;
+									break;
+								  case 63276:
+									evt.key = evt.KEY_PAGE_UP;
+									break;
+								  case 63277:
+									evt.key = evt.KEY_PAGE_DOWN;
+									break;
+								  case 63302:
+									evt.key = evt.KEY_INSERT;
+									break;
+								  case 63248:
+								  case 63249:
+								  case 63289:
+									break;
+								  default:
+									evt.key = evt.charCode &gt;= evt.KEY_SPACE ? String.fromCharCode(evt.charCode) : evt.keyCode;
+								}
+							} else {
+								evt.key = evt.charCode &gt; 0 ? String.fromCharCode(evt.charCode) : evt.keyCode;
+							}
+						}
+					}
+				}
+			}
+		}
+		if (dojo.render.html.ie) {
+			if (!evt.target) {
+				evt.target = evt.srcElement;
+			}
+			if (!evt.currentTarget) {
+				evt.currentTarget = (sender ? sender : evt.srcElement);
+			}
+			if (!evt.layerX) {
+				evt.layerX = evt.offsetX;
+			}
+			if (!evt.layerY) {
+				evt.layerY = evt.offsetY;
+			}
+			var doc = (evt.srcElement &amp;&amp; evt.srcElement.ownerDocument) ? evt.srcElement.ownerDocument : document;
+			var docBody = ((dojo.render.html.ie55) || (doc[&quot;compatMode&quot;] == &quot;BackCompat&quot;)) ? doc.body : doc.documentElement;
+			if (!evt.pageX) {
+				evt.pageX = evt.clientX + (docBody.scrollLeft || 0);
+			}
+			if (!evt.pageY) {
+				evt.pageY = evt.clientY + (docBody.scrollTop || 0);
+			}
+			if (evt.type == &quot;mouseover&quot;) {
+				evt.relatedTarget = evt.fromElement;
+			}
+			if (evt.type == &quot;mouseout&quot;) {
+				evt.relatedTarget = evt.toElement;
+			}
+			this.currentEvent = evt;
+			evt.callListener = this.callListener;
+			evt.stopPropagation = this._stopPropagation;
+			evt.preventDefault = this._preventDefault;
+		}
+		return evt;
+	};
+	this.stopEvent = function (evt) {
+		if (window.event) {
+			evt.cancelBubble = true;
+			evt.returnValue = false;
+		} else {
+			evt.preventDefault();
+			evt.stopPropagation();
+		}
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/event/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/event/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/event/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,560 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.event.common&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.event = new function () {
+	this._canTimeout = dojo.lang.isFunction(dj_global[&quot;setTimeout&quot;]) || dojo.lang.isAlien(dj_global[&quot;setTimeout&quot;]);
+	function interpolateArgs(args, searchForNames) {
+		var dl = dojo.lang;
+		var ao = {srcObj:dj_global, srcFunc:null, adviceObj:dj_global, adviceFunc:null, aroundObj:null, aroundFunc:null, adviceType:(args.length &gt; 2) ? args[0] : &quot;after&quot;, precedence:&quot;last&quot;, once:false, delay:null, rate:0, adviceMsg:false, maxCalls:-1};
+		switch (args.length) {
+		  case 0:
+			return;
+		  case 1:
+			return;
+		  case 2:
+			ao.srcFunc = args[0];
+			ao.adviceFunc = args[1];
+			break;
+		  case 3:
+			if ((dl.isObject(args[0])) &amp;&amp; (dl.isString(args[1])) &amp;&amp; (dl.isString(args[2]))) {
+				ao.adviceType = &quot;after&quot;;
+				ao.srcObj = args[0];
+				ao.srcFunc = args[1];
+				ao.adviceFunc = args[2];
+			} else {
+				if ((dl.isString(args[1])) &amp;&amp; (dl.isString(args[2]))) {
+					ao.srcFunc = args[1];
+					ao.adviceFunc = args[2];
+				} else {
+					if ((dl.isObject(args[0])) &amp;&amp; (dl.isString(args[1])) &amp;&amp; (dl.isFunction(args[2]))) {
+						ao.adviceType = &quot;after&quot;;
+						ao.srcObj = args[0];
+						ao.srcFunc = args[1];
+						var tmpName = dl.nameAnonFunc(args[2], ao.adviceObj, searchForNames);
+						ao.adviceFunc = tmpName;
+					} else {
+						if ((dl.isFunction(args[0])) &amp;&amp; (dl.isObject(args[1])) &amp;&amp; (dl.isString(args[2]))) {
+							ao.adviceType = &quot;after&quot;;
+							ao.srcObj = dj_global;
+							var tmpName = dl.nameAnonFunc(args[0], ao.srcObj, searchForNames);
+							ao.srcFunc = tmpName;
+							ao.adviceObj = args[1];
+							ao.adviceFunc = args[2];
+						}
+					}
+				}
+			}
+			break;
+		  case 4:
+			if ((dl.isObject(args[0])) &amp;&amp; (dl.isObject(args[2]))) {
+				ao.adviceType = &quot;after&quot;;
+				ao.srcObj = args[0];
+				ao.srcFunc = args[1];
+				ao.adviceObj = args[2];
+				ao.adviceFunc = args[3];
+			} else {
+				if ((dl.isString(args[0])) &amp;&amp; (dl.isString(args[1])) &amp;&amp; (dl.isObject(args[2]))) {
+					ao.adviceType = args[0];
+					ao.srcObj = dj_global;
+					ao.srcFunc = args[1];
+					ao.adviceObj = args[2];
+					ao.adviceFunc = args[3];
+				} else {
+					if ((dl.isString(args[0])) &amp;&amp; (dl.isFunction(args[1])) &amp;&amp; (dl.isObject(args[2]))) {
+						ao.adviceType = args[0];
+						ao.srcObj = dj_global;
+						var tmpName = dl.nameAnonFunc(args[1], dj_global, searchForNames);
+						ao.srcFunc = tmpName;
+						ao.adviceObj = args[2];
+						ao.adviceFunc = args[3];
+					} else {
+						if ((dl.isString(args[0])) &amp;&amp; (dl.isObject(args[1])) &amp;&amp; (dl.isString(args[2])) &amp;&amp; (dl.isFunction(args[3]))) {
+							ao.srcObj = args[1];
+							ao.srcFunc = args[2];
+							var tmpName = dl.nameAnonFunc(args[3], dj_global, searchForNames);
+							ao.adviceObj = dj_global;
+							ao.adviceFunc = tmpName;
+						} else {
+							if (dl.isObject(args[1])) {
+								ao.srcObj = args[1];
+								ao.srcFunc = args[2];
+								ao.adviceObj = dj_global;
+								ao.adviceFunc = args[3];
+							} else {
+								if (dl.isObject(args[2])) {
+									ao.srcObj = dj_global;
+									ao.srcFunc = args[1];
+									ao.adviceObj = args[2];
+									ao.adviceFunc = args[3];
+								} else {
+									ao.srcObj = ao.adviceObj = ao.aroundObj = dj_global;
+									ao.srcFunc = args[1];
+									ao.adviceFunc = args[2];
+									ao.aroundFunc = args[3];
+								}
+							}
+						}
+					}
+				}
+			}
+			break;
+		  case 6:
+			ao.srcObj = args[1];
+			ao.srcFunc = args[2];
+			ao.adviceObj = args[3];
+			ao.adviceFunc = args[4];
+			ao.aroundFunc = args[5];
+			ao.aroundObj = dj_global;
+			break;
+		  default:
+			ao.srcObj = args[1];
+			ao.srcFunc = args[2];
+			ao.adviceObj = args[3];
+			ao.adviceFunc = args[4];
+			ao.aroundObj = args[5];
+			ao.aroundFunc = args[6];
+			ao.once = args[7];
+			ao.delay = args[8];
+			ao.rate = args[9];
+			ao.adviceMsg = args[10];
+			ao.maxCalls = (!isNaN(parseInt(args[11]))) ? args[11] : -1;
+			break;
+		}
+		if (dl.isFunction(ao.aroundFunc)) {
+			var tmpName = dl.nameAnonFunc(ao.aroundFunc, ao.aroundObj, searchForNames);
+			ao.aroundFunc = tmpName;
+		}
+		if (dl.isFunction(ao.srcFunc)) {
+			ao.srcFunc = dl.getNameInObj(ao.srcObj, ao.srcFunc);
+		}
+		if (dl.isFunction(ao.adviceFunc)) {
+			ao.adviceFunc = dl.getNameInObj(ao.adviceObj, ao.adviceFunc);
+		}
+		if ((ao.aroundObj) &amp;&amp; (dl.isFunction(ao.aroundFunc))) {
+			ao.aroundFunc = dl.getNameInObj(ao.aroundObj, ao.aroundFunc);
+		}
+		if (!ao.srcObj) {
+			dojo.raise(&quot;bad srcObj for srcFunc: &quot; + ao.srcFunc);
+		}
+		if (!ao.adviceObj) {
+			dojo.raise(&quot;bad adviceObj for adviceFunc: &quot; + ao.adviceFunc);
+		}
+		if (!ao.adviceFunc) {
+			dojo.debug(&quot;bad adviceFunc for srcFunc: &quot; + ao.srcFunc);
+			dojo.debugShallow(ao);
+		}
+		return ao;
+	}
+	this.connect = function () {
+		if (arguments.length == 1) {
+			var ao = arguments[0];
+		} else {
+			var ao = interpolateArgs(arguments, true);
+		}
+		if (dojo.lang.isString(ao.srcFunc) &amp;&amp; (ao.srcFunc.toLowerCase() == &quot;onkey&quot;)) {
+			if (dojo.render.html.ie) {
+				ao.srcFunc = &quot;onkeydown&quot;;
+				this.connect(ao);
+			}
+			ao.srcFunc = &quot;onkeypress&quot;;
+		}
+		if (dojo.lang.isArray(ao.srcObj) &amp;&amp; ao.srcObj != &quot;&quot;) {
+			var tmpAO = {};
+			for (var x in ao) {
+				tmpAO[x] = ao[x];
+			}
+			var mjps = [];
+			dojo.lang.forEach(ao.srcObj, function (src) {
+				if ((dojo.render.html.capable) &amp;&amp; (dojo.lang.isString(src))) {
+					src = dojo.byId(src);
+				}
+				tmpAO.srcObj = src;
+				mjps.push(dojo.event.connect.call(dojo.event, tmpAO));
+			});
+			return mjps;
+		}
+		var mjp = dojo.event.MethodJoinPoint.getForMethod(ao.srcObj, ao.srcFunc);
+		if (ao.adviceFunc) {
+			var mjp2 = dojo.event.MethodJoinPoint.getForMethod(ao.adviceObj, ao.adviceFunc);
+		}
+		mjp.kwAddAdvice(ao);
+		return mjp;
+	};
+	this.log = function (a1, a2) {
+		var kwArgs;
+		if ((arguments.length == 1) &amp;&amp; (typeof a1 == &quot;object&quot;)) {
+			kwArgs = a1;
+		} else {
+			kwArgs = {srcObj:a1, srcFunc:a2};
+		}
+		kwArgs.adviceFunc = function () {
+			var argsStr = [];
+			for (var x = 0; x &lt; arguments.length; x++) {
+				argsStr.push(arguments[x]);
+			}
+			dojo.debug(&quot;(&quot; + kwArgs.srcObj + &quot;).&quot; + kwArgs.srcFunc, &quot;:&quot;, argsStr.join(&quot;, &quot;));
+		};
+		this.kwConnect(kwArgs);
+	};
+	this.connectBefore = function () {
+		var args = [&quot;before&quot;];
+		for (var i = 0; i &lt; arguments.length; i++) {
+			args.push(arguments[i]);
+		}
+		return this.connect.apply(this, args);
+	};
+	this.connectAround = function () {
+		var args = [&quot;around&quot;];
+		for (var i = 0; i &lt; arguments.length; i++) {
+			args.push(arguments[i]);
+		}
+		return this.connect.apply(this, args);
+	};
+	this.connectOnce = function () {
+		var ao = interpolateArgs(arguments, true);
+		ao.once = true;
+		return this.connect(ao);
+	};
+	this.connectRunOnce = function () {
+		var ao = interpolateArgs(arguments, true);
+		ao.maxCalls = 1;
+		return this.connect(ao);
+	};
+	this._kwConnectImpl = function (kwArgs, disconnect) {
+		var fn = (disconnect) ? &quot;disconnect&quot; : &quot;connect&quot;;
+		if (typeof kwArgs[&quot;srcFunc&quot;] == &quot;function&quot;) {
+			kwArgs.srcObj = kwArgs[&quot;srcObj&quot;] || dj_global;
+			var tmpName = dojo.lang.nameAnonFunc(kwArgs.srcFunc, kwArgs.srcObj, true);
+			kwArgs.srcFunc = tmpName;
+		}
+		if (typeof kwArgs[&quot;adviceFunc&quot;] == &quot;function&quot;) {
+			kwArgs.adviceObj = kwArgs[&quot;adviceObj&quot;] || dj_global;
+			var tmpName = dojo.lang.nameAnonFunc(kwArgs.adviceFunc, kwArgs.adviceObj, true);
+			kwArgs.adviceFunc = tmpName;
+		}
+		kwArgs.srcObj = kwArgs[&quot;srcObj&quot;] || dj_global;
+		kwArgs.adviceObj = kwArgs[&quot;adviceObj&quot;] || kwArgs[&quot;targetObj&quot;] || dj_global;
+		kwArgs.adviceFunc = kwArgs[&quot;adviceFunc&quot;] || kwArgs[&quot;targetFunc&quot;];
+		return dojo.event[fn](kwArgs);
+	};
+	this.kwConnect = function (kwArgs) {
+		return this._kwConnectImpl(kwArgs, false);
+	};
+	this.disconnect = function () {
+		if (arguments.length == 1) {
+			var ao = arguments[0];
+		} else {
+			var ao = interpolateArgs(arguments, true);
+		}
+		if (!ao.adviceFunc) {
+			return;
+		}
+		if (dojo.lang.isString(ao.srcFunc) &amp;&amp; (ao.srcFunc.toLowerCase() == &quot;onkey&quot;)) {
+			if (dojo.render.html.ie) {
+				ao.srcFunc = &quot;onkeydown&quot;;
+				this.disconnect(ao);
+			}
+			ao.srcFunc = &quot;onkeypress&quot;;
+		}
+		if (!ao.srcObj[ao.srcFunc]) {
+			return null;
+		}
+		var mjp = dojo.event.MethodJoinPoint.getForMethod(ao.srcObj, ao.srcFunc, true);
+		mjp.removeAdvice(ao.adviceObj, ao.adviceFunc, ao.adviceType, ao.once);
+		return mjp;
+	};
+	this.kwDisconnect = function (kwArgs) {
+		return this._kwConnectImpl(kwArgs, true);
+	};
+};
+dojo.event.MethodInvocation = function (join_point, obj, args) {
+	this.jp_ = join_point;
+	this.object = obj;
+	this.args = [];
+	for (var x = 0; x &lt; args.length; x++) {
+		this.args[x] = args[x];
+	}
+	this.around_index = -1;
+};
+dojo.event.MethodInvocation.prototype.proceed = function () {
+	this.around_index++;
+	if (this.around_index &gt;= this.jp_.around.length) {
+		return this.jp_.object[this.jp_.methodname].apply(this.jp_.object, this.args);
+	} else {
+		var ti = this.jp_.around[this.around_index];
+		var mobj = ti[0] || dj_global;
+		var meth = ti[1];
+		return mobj[meth].call(mobj, this);
+	}
+};
+dojo.event.MethodJoinPoint = function (obj, funcName) {
+	this.object = obj || dj_global;
+	this.methodname = funcName;
+	this.methodfunc = this.object[funcName];
+	this.squelch = false;
+};
+dojo.event.MethodJoinPoint.getForMethod = function (obj, funcName) {
+	if (!obj) {
+		obj = dj_global;
+	}
+	var ofn = obj[funcName];
+	if (!ofn) {
+		ofn = obj[funcName] = function () {
+		};
+		if (!obj[funcName]) {
+			dojo.raise(&quot;Cannot set do-nothing method on that object &quot; + funcName);
+		}
+	} else {
+		if ((typeof ofn != &quot;function&quot;) &amp;&amp; (!dojo.lang.isFunction(ofn)) &amp;&amp; (!dojo.lang.isAlien(ofn))) {
+			return null;
+		}
+	}
+	var jpname = funcName + &quot;$joinpoint&quot;;
+	var jpfuncname = funcName + &quot;$joinpoint$method&quot;;
+	var joinpoint = obj[jpname];
+	if (!joinpoint) {
+		var isNode = false;
+		if (dojo.event[&quot;browser&quot;]) {
+			if ((obj[&quot;attachEvent&quot;]) || (obj[&quot;nodeType&quot;]) || (obj[&quot;addEventListener&quot;])) {
+				isNode = true;
+				dojo.event.browser.addClobberNodeAttrs(obj, [jpname, jpfuncname, funcName]);
+			}
+		}
+		var origArity = ofn.length;
+		obj[jpfuncname] = ofn;
+		joinpoint = obj[jpname] = new dojo.event.MethodJoinPoint(obj, jpfuncname);
+		if (!isNode) {
+			obj[funcName] = function () {
+				return joinpoint.run.apply(joinpoint, arguments);
+			};
+		} else {
+			obj[funcName] = function () {
+				var args = [];
+				if (!arguments.length) {
+					var evt = null;
+					try {
+						if (obj.ownerDocument) {
+							evt = obj.ownerDocument.parentWindow.event;
+						} else {
+							if (obj.documentElement) {
+								evt = obj.documentElement.ownerDocument.parentWindow.event;
+							} else {
+								if (obj.event) {
+									evt = obj.event;
+								} else {
+									evt = window.event;
+								}
+							}
+						}
+					}
+					catch (e) {
+						evt = window.event;
+					}
+					if (evt) {
+						args.push(dojo.event.browser.fixEvent(evt, this));
+					}
+				} else {
+					for (var x = 0; x &lt; arguments.length; x++) {
+						if ((x == 0) &amp;&amp; (dojo.event.browser.isEvent(arguments[x]))) {
+							args.push(dojo.event.browser.fixEvent(arguments[x], this));
+						} else {
+							args.push(arguments[x]);
+						}
+					}
+				}
+				return joinpoint.run.apply(joinpoint, args);
+			};
+		}
+		obj[funcName].__preJoinArity = origArity;
+	}
+	return joinpoint;
+};
+dojo.lang.extend(dojo.event.MethodJoinPoint, {squelch:false, unintercept:function () {
+	this.object[this.methodname] = this.methodfunc;
+	this.before = [];
+	this.after = [];
+	this.around = [];
+}, disconnect:dojo.lang.forward(&quot;unintercept&quot;), run:function () {
+	var obj = this.object || dj_global;
+	var args = arguments;
+	var aargs = [];
+	for (var x = 0; x &lt; args.length; x++) {
+		aargs[x] = args[x];
+	}
+	var unrollAdvice = function (marr) {
+		if (!marr) {
+			dojo.debug(&quot;Null argument to unrollAdvice()&quot;);
+			return;
+		}
+		var callObj = marr[0] || dj_global;
+		var callFunc = marr[1];
+		if (!callObj[callFunc]) {
+			dojo.raise(&quot;function \&quot;&quot; + callFunc + &quot;\&quot; does not exist on \&quot;&quot; + callObj + &quot;\&quot;&quot;);
+		}
+		var aroundObj = marr[2] || dj_global;
+		var aroundFunc = marr[3];
+		var msg = marr[6];
+		var maxCount = marr[7];
+		if (maxCount &gt; -1) {
+			if (maxCount == 0) {
+				return;
+			}
+			marr[7]--;
+		}
+		var undef;
+		var to = {args:[], jp_:this, object:obj, proceed:function () {
+			return callObj[callFunc].apply(callObj, to.args);
+		}};
+		to.args = aargs;
+		var delay = parseInt(marr[4]);
+		var hasDelay = ((!isNaN(delay)) &amp;&amp; (marr[4] !== null) &amp;&amp; (typeof marr[4] != &quot;undefined&quot;));
+		if (marr[5]) {
+			var rate = parseInt(marr[5]);
+			var cur = new Date();
+			var timerSet = false;
+			if ((marr[&quot;last&quot;]) &amp;&amp; ((cur - marr.last) &lt;= rate)) {
+				if (dojo.event._canTimeout) {
+					if (marr[&quot;delayTimer&quot;]) {
+						clearTimeout(marr.delayTimer);
+					}
+					var tod = parseInt(rate * 2);
+					var mcpy = dojo.lang.shallowCopy(marr);
+					marr.delayTimer = setTimeout(function () {
+						mcpy[5] = 0;
+						unrollAdvice(mcpy);
+					}, tod);
+				}
+				return;
+			} else {
+				marr.last = cur;
+			}
+		}
+		if (aroundFunc) {
+			aroundObj[aroundFunc].call(aroundObj, to);
+		} else {
+			if ((hasDelay) &amp;&amp; ((dojo.render.html) || (dojo.render.svg))) {
+				dj_global[&quot;setTimeout&quot;](function () {
+					if (msg) {
+						callObj[callFunc].call(callObj, to);
+					} else {
+						callObj[callFunc].apply(callObj, args);
+					}
+				}, delay);
+			} else {
+				if (msg) {
+					callObj[callFunc].call(callObj, to);
+				} else {
+					callObj[callFunc].apply(callObj, args);
+				}
+			}
+		}
+	};
+	var unRollSquelch = function () {
+		if (this.squelch) {
+			try {
+				return unrollAdvice.apply(this, arguments);
+			}
+			catch (e) {
+				dojo.debug(e);
+			}
+		} else {
+			return unrollAdvice.apply(this, arguments);
+		}
+	};
+	if ((this[&quot;before&quot;]) &amp;&amp; (this.before.length &gt; 0)) {
+		dojo.lang.forEach(this.before.concat(new Array()), unRollSquelch);
+	}
+	var result;
+	try {
+		if ((this[&quot;around&quot;]) &amp;&amp; (this.around.length &gt; 0)) {
+			var mi = new dojo.event.MethodInvocation(this, obj, args);
+			result = mi.proceed();
+		} else {
+			if (this.methodfunc) {
+				result = this.object[this.methodname].apply(this.object, args);
+			}
+		}
+	}
+	catch (e) {
+		if (!this.squelch) {
+			dojo.debug(e, &quot;when calling&quot;, this.methodname, &quot;on&quot;, this.object, &quot;with arguments&quot;, args);
+			dojo.raise(e);
+		}
+	}
+	if ((this[&quot;after&quot;]) &amp;&amp; (this.after.length &gt; 0)) {
+		dojo.lang.forEach(this.after.concat(new Array()), unRollSquelch);
+	}
+	return (this.methodfunc) ? result : null;
+}, getArr:function (kind) {
+	var type = &quot;after&quot;;
+	if ((typeof kind == &quot;string&quot;) &amp;&amp; (kind.indexOf(&quot;before&quot;) != -1)) {
+		type = &quot;before&quot;;
+	} else {
+		if (kind == &quot;around&quot;) {
+			type = &quot;around&quot;;
+		}
+	}
+	if (!this[type]) {
+		this[type] = [];
+	}
+	return this[type];
+}, kwAddAdvice:function (args) {
+	this.addAdvice(args[&quot;adviceObj&quot;], args[&quot;adviceFunc&quot;], args[&quot;aroundObj&quot;], args[&quot;aroundFunc&quot;], args[&quot;adviceType&quot;], args[&quot;precedence&quot;], args[&quot;once&quot;], args[&quot;delay&quot;], args[&quot;rate&quot;], args[&quot;adviceMsg&quot;], args[&quot;maxCalls&quot;]);
+}, addAdvice:function (thisAdviceObj, thisAdvice, thisAroundObj, thisAround, adviceType, precedence, once, delay, rate, asMessage, maxCalls) {
+	var arr = this.getArr(adviceType);
+	if (!arr) {
+		dojo.raise(&quot;bad this: &quot; + this);
+	}
+	var ao = [thisAdviceObj, thisAdvice, thisAroundObj, thisAround, delay, rate, asMessage, maxCalls];
+	if (once) {
+		if (this.hasAdvice(thisAdviceObj, thisAdvice, adviceType, arr) &gt;= 0) {
+			return;
+		}
+	}
+	if (precedence == &quot;first&quot;) {
+		arr.unshift(ao);
+	} else {
+		arr.push(ao);
+	}
+}, hasAdvice:function (thisAdviceObj, thisAdvice, adviceType, arr) {
+	if (!arr) {
+		arr = this.getArr(adviceType);
+	}
+	var ind = -1;
+	for (var x = 0; x &lt; arr.length; x++) {
+		var aao = (typeof thisAdvice == &quot;object&quot;) ? (new String(thisAdvice)).toString() : thisAdvice;
+		var a1o = (typeof arr[x][1] == &quot;object&quot;) ? (new String(arr[x][1])).toString() : arr[x][1];
+		if ((arr[x][0] == thisAdviceObj) &amp;&amp; (a1o == aao)) {
+			ind = x;
+		}
+	}
+	return ind;
+}, removeAdvice:function (thisAdviceObj, thisAdvice, adviceType, once) {
+	var arr = this.getArr(adviceType);
+	var ind = this.hasAdvice(thisAdviceObj, thisAdvice, adviceType, arr);
+	if (ind == -1) {
+		return false;
+	}
+	while (ind != -1) {
+		arr.splice(ind, 1);
+		if (once) {
+			break;
+		}
+		ind = this.hasAdvice(thisAdviceObj, thisAdvice, adviceType, arr);
+	}
+	return true;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/event/topic.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/event/topic.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/event/topic.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,79 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.event.common&quot;);
+dojo.provide(&quot;dojo.event.topic&quot;);
+dojo.event.topic = new function () {
+	this.topics = {};
+	this.getTopic = function (topic) {
+		if (!this.topics[topic]) {
+			this.topics[topic] = new this.TopicImpl(topic);
+		}
+		return this.topics[topic];
+	};
+	this.registerPublisher = function (topic, obj, funcName) {
+		var topic = this.getTopic(topic);
+		topic.registerPublisher(obj, funcName);
+	};
+	this.subscribe = function (topic, obj, funcName) {
+		var topic = this.getTopic(topic);
+		topic.subscribe(obj, funcName);
+	};
+	this.unsubscribe = function (topic, obj, funcName) {
+		var topic = this.getTopic(topic);
+		topic.unsubscribe(obj, funcName);
+	};
+	this.destroy = function (topic) {
+		this.getTopic(topic).destroy();
+		delete this.topics[topic];
+	};
+	this.publishApply = function (topic, args) {
+		var topic = this.getTopic(topic);
+		topic.sendMessage.apply(topic, args);
+	};
+	this.publish = function (topic, message) {
+		var topic = this.getTopic(topic);
+		var args = [];
+		for (var x = 1; x &lt; arguments.length; x++) {
+			args.push(arguments[x]);
+		}
+		topic.sendMessage.apply(topic, args);
+	};
+};
+dojo.event.topic.TopicImpl = function (topicName) {
+	this.topicName = topicName;
+	this.subscribe = function (listenerObject, listenerMethod) {
+		var tf = listenerMethod || listenerObject;
+		var to = (!listenerMethod) ? dj_global : listenerObject;
+		return dojo.event.kwConnect({srcObj:this, srcFunc:&quot;sendMessage&quot;, adviceObj:to, adviceFunc:tf});
+	};
+	this.unsubscribe = function (listenerObject, listenerMethod) {
+		var tf = (!listenerMethod) ? listenerObject : listenerMethod;
+		var to = (!listenerMethod) ? null : listenerObject;
+		return dojo.event.kwDisconnect({srcObj:this, srcFunc:&quot;sendMessage&quot;, adviceObj:to, adviceFunc:tf});
+	};
+	this._getJoinPoint = function () {
+		return dojo.event.MethodJoinPoint.getForMethod(this, &quot;sendMessage&quot;);
+	};
+	this.setSquelch = function (shouldSquelch) {
+		this._getJoinPoint().squelch = shouldSquelch;
+	};
+	this.destroy = function () {
+		this._getJoinPoint().disconnect();
+	};
+	this.registerPublisher = function (publisherObject, publisherMethod) {
+		dojo.event.connect(publisherObject, publisherMethod, this, &quot;sendMessage&quot;);
+	};
+	this.sendMessage = function (message) {
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/event.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/event.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/event.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.event&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.deprecated(&quot;dojo.event&quot;, &quot;replaced by dojo.event.*&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/experimental.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/experimental.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/experimental.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,22 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.experimental&quot;);
+dojo.experimental = function (moduleName, extra) {
+	var message = &quot;EXPERIMENTAL: &quot; + moduleName;
+	message += &quot; -- Not yet ready for use.  APIs subject to change without notice.&quot;;
+	if (extra) {
+		message += &quot; &quot; + extra;
+	}
+	dojo.debug(message);
+};
+

Added: tags/parley-0.55/root/static/magic/src/flash/flash6/DojoExternalInterface.as
===================================================================
--- tags/parley-0.55/root/static/magic/src/flash/flash6/DojoExternalInterface.as	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/flash/flash6/DojoExternalInterface.as	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,215 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+/** 
+		An implementation of Flash 8's ExternalInterface that works with Flash 6
+		and which is source-compatible with Flash 8. 
+		
+		@author Brad Neuberg, <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">bkn3 at columbia.edu</A> 
+*/
+
+class DojoExternalInterface{
+	public static var available:Boolean;
+	public static var dojoPath = &quot;&quot;;
+	
+	public static var _fscommandReady = false;
+	public static var _callbacks = new Array();
+
+	public static function initialize(){ 
+		//getURL(&quot;javascript:dojo.debug('FLASH:DojoExternalInterface initialize')&quot;);
+		// FIXME: Set available variable by testing for capabilities
+		DojoExternalInterface.available = true;
+		
+		// extract the dojo base path
+		DojoExternalInterface.dojoPath = DojoExternalInterface.getDojoPath();
+		//getURL(&quot;javascript:dojo.debug('FLASH:dojoPath=&quot;+DojoExternalInterface.dojoPath+&quot;')&quot;);
+		
+		// Sometimes, on IE, the fscommand infrastructure can take a few hundred
+		// milliseconds the first time a page loads. Set a timer to keep checking
+		// to make sure we can issue fscommands; otherwise, our calls to fscommand
+		// for setCallback() and loaded() will just &quot;disappear&quot;
+		_root.fscommandReady = false;
+		var fsChecker = function(){
+			// issue a test fscommand
+			fscommand(&quot;fscommandReady&quot;);
+			
+			// JavaScript should set _root.fscommandReady if it got the call
+			if(_root.fscommandReady == &quot;true&quot;){
+				DojoExternalInterface._fscommandReady = true;
+				clearInterval(_root.fsTimer);
+			}
+		};
+		_root.fsTimer = setInterval(fsChecker, 100);
+	}
+	
+	public static function addCallback(methodName:String, instance:Object, 
+											method:Function) : Boolean{
+		// A variable that indicates whether the call below succeeded
+		_root._succeeded = null;
+		
+		// Callbacks are registered with the JavaScript side as follows.
+		// On the Flash side, we maintain a lookup table that associates
+		// the methodName with the actual instance and method that are
+		// associated with this method.
+		// Using fscommand, we send over the action &quot;addCallback&quot;, with the
+		// argument being the methodName to add, such as &quot;foobar&quot;.
+		// The JavaScript takes these values and registers the existence of
+		// this callback point.
+		
+		// precede the method name with a _ character in case it starts
+		// with a number
+		_callbacks[&quot;_&quot; + methodName] = {_instance: instance, _method: method};
+		_callbacks[_callbacks.length] = methodName;
+		
+		// The API for ExternalInterface says we have to make sure the call
+		// succeeded; check to see if there is a value 
+		// for _succeeded, which is set by the JavaScript side
+		if(_root._succeeded == null){
+			return false;
+		}else{
+			return true;
+		}
+	}
+	
+	public static function call(methodName:String, 
+								resultsCallback:Function) : Void{
+		// FIXME: support full JSON serialization
+		
+		// First, we pack up all of the arguments to this call and set them
+		// as Flash variables, which the JavaScript side will unpack using
+		// plugin.GetVariable(). We set the number of arguments as &quot;_numArgs&quot;,
+		// and add each argument as a variable, such as &quot;_1&quot;, &quot;_2&quot;, etc., starting
+		// from 0.
+		// We then execute an fscommand with the action &quot;call&quot; and the
+		// argument being the method name. JavaScript takes the method name,
+		// retrieves the arguments using GetVariable, executes the method,
+		// and then places the return result in a Flash variable
+		// named &quot;_returnResult&quot;.
+		_root._numArgs = arguments.length - 2;
+		for(var i = 2; i &lt; arguments.length; i++){
+			var argIndex = i - 2;
+			_root[&quot;_&quot; + argIndex] = arguments[i];
+		}
+		
+		_root._returnResult = undefined;
+		fscommand(&quot;call&quot;, methodName);
+		
+		// immediately return if the caller is not waiting for return results
+		if(resultsCallback == undefined || resultsCallback == null){
+			return;
+		}
+		
+		// check at regular intervals for return results	
+		var resultsChecker = function(){
+			if((typeof _root._returnResult != &quot;undefined&quot;)&amp;&amp;
+				(_root._returnResult != &quot;undefined&quot;)){
+				clearInterval(_root._callbackID);
+				resultsCallback.call(null, _root._returnResult);
+			}
+		};	
+		_root._callbackID = setInterval(resultsChecker, 100);
+	}
+	
+	/** 
+			Called by Flash to indicate to JavaScript that we are ready to have
+			our Flash functions called. Calling loaded()
+			will fire the dojo.flash.loaded() event, so that JavaScript can know that
+			Flash has finished loading and adding its callbacks, and can begin to
+			interact with the Flash file.
+	*/
+	public static function loaded(){
+		//getURL(&quot;javascript:dojo.debug('FLASH:loaded')&quot;);
+		
+		// one more step: see if fscommands are ready to be executed; if not,
+		// set an interval that will keep running until fscommands are ready;
+		// make sure the gateway is loaded as well
+		var execLoaded = function(){
+			if(DojoExternalInterface._fscommandReady == true){
+				clearInterval(_root.loadedInterval);
+				
+				// initialize the small Flash file that helps gateway JS to Flash
+				// calls
+				DojoExternalInterface._initializeFlashRunner();
+			}	
+		};
+		
+		if(_fscommandReady == true){
+			execLoaded();
+		}else{
+			_root.loadedInterval = setInterval(execLoaded, 50);
+		}
+	}
+	
+	/** 
+			Handles and executes a JavaScript to Flash method call. Used by
+			initializeFlashRunner. 
+	*/
+	public static function _handleJSCall(){
+		// get our parameters
+		var numArgs = parseInt(_root._numArgs);
+		var jsArgs = new Array();
+		for(var i = 0; i &lt; numArgs; i++){
+			var currentValue = _root[&quot;_&quot; + i];
+			jsArgs.push(currentValue);
+		}
+		
+		// get our function name
+		var functionName = _root._functionName;
+		
+		// now get the actual instance and method object to execute on,
+		// using our lookup table that was constructed by calls to
+		// addCallback on initialization
+		var instance = _callbacks[&quot;_&quot; + functionName]._instance;
+		var method = _callbacks[&quot;_&quot; + functionName]._method;
+		
+		// execute it
+		var results = method.apply(instance, jsArgs);
+		
+		// return the results
+		_root._returnResult = results;
+	}
+	
+	/** Called by the flash6_gateway.swf to indicate that it is loaded. */
+	public static function _gatewayReady(){
+		for(var i = 0; i &lt; _callbacks.length; i++){
+			fscommand(&quot;addCallback&quot;, _callbacks[i]);
+		}
+		call(&quot;dojo.flash.loaded&quot;);
+	}
+	
+	/** 
+			When JavaScript wants to communicate with Flash it simply sets
+			the Flash variable &quot;_execute&quot; to true; this method creates the
+			internal Movie Clip, called the Flash Runner, that makes this
+			magic happen.
+	*/
+	public static function _initializeFlashRunner(){
+		// figure out where our Flash movie is
+		var swfLoc = DojoExternalInterface.dojoPath + &quot;flash6_gateway.swf&quot;;
+		
+		// load our gateway helper file
+		_root.createEmptyMovieClip(&quot;_flashRunner&quot;, 5000);
+		_root._flashRunner._lockroot = true;
+		_root._flashRunner.loadMovie(swfLoc);
+	}
+	
+	private static function getDojoPath(){
+		var url = _root._url;
+		var start = url.indexOf(&quot;baseRelativePath=&quot;) + &quot;baseRelativePath=&quot;.length;
+		var path = url.substring(start);
+		var end = path.indexOf(&quot;&amp;&quot;);
+		if(end != -1){
+			path = path.substring(0, end);
+		}
+		return path;
+	}
+}
+
+// vim:ts=4:noet:tw=0:

Added: tags/parley-0.55/root/static/magic/src/flash/flash6/flash6_gateway.fla
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/flash/flash6/flash6_gateway.fla
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: tags/parley-0.55/root/static/magic/src/flash/flash8/DojoExternalInterface.as
===================================================================
--- tags/parley-0.55/root/static/magic/src/flash/flash8/DojoExternalInterface.as	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/flash/flash8/DojoExternalInterface.as	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,234 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+/**
+	A wrapper around Flash 8's ExternalInterface; DojoExternalInterface is needed so that we
+	can do a Flash 6 implementation of ExternalInterface, and be able
+	to support having a single codebase that uses DojoExternalInterface
+	across Flash versions rather than having two seperate source bases,
+	where one uses ExternalInterface and the other uses DojoExternalInterface.
+	
+	DojoExternalInterface class does a variety of optimizations to bypass ExternalInterface's
+	unbelievably bad performance so that we can have good performance
+	on Safari; see the blog post
+	<A HREF="http://codinginparadise.org/weblog/2006/02/how-to-speed-up-flash-8s.html">http://codinginparadise.org/weblog/2006/02/how-to-speed-up-flash-8s.html</A>
+	for details.
+	
+	@author Brad Neuberg, <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">bkn3 at columbia.edu</A>
+*/
+import flash.external.ExternalInterface;
+
+class DojoExternalInterface{
+	public static var available:Boolean;
+	public static var dojoPath = &quot;&quot;;
+	
+	private static var flashMethods:Array = new Array();
+	private static var numArgs:Number;
+	private static var argData:Array;
+	private static var resultData = null;
+	
+	public static function initialize(){
+		// extract the dojo base path
+		DojoExternalInterface.dojoPath = DojoExternalInterface.getDojoPath();
+		
+		// see if we need to do an express install
+		var install:ExpressInstall = new ExpressInstall();
+		if(install.needsUpdate){
+			install.init();
+		}
+		
+		// register our callback functions
+		ExternalInterface.addCallback(&quot;startExec&quot;, DojoExternalInterface, startExec);
+		ExternalInterface.addCallback(&quot;setNumberArguments&quot;, DojoExternalInterface,
+																	setNumberArguments);
+		ExternalInterface.addCallback(&quot;chunkArgumentData&quot;, DojoExternalInterface,
+																	chunkArgumentData);
+		ExternalInterface.addCallback(&quot;exec&quot;, DojoExternalInterface, exec);
+		ExternalInterface.addCallback(&quot;getReturnLength&quot;, DojoExternalInterface,
+																	getReturnLength);
+		ExternalInterface.addCallback(&quot;chunkReturnData&quot;, DojoExternalInterface,
+																	chunkReturnData);
+		ExternalInterface.addCallback(&quot;endExec&quot;, DojoExternalInterface, endExec);
+		
+		// set whether communication is available
+		DojoExternalInterface.available = ExternalInterface.available;
+		DojoExternalInterface.call(&quot;loaded&quot;);
+	}
+	
+	public static function addCallback(methodName:String, instance:Object, 
+										 								 method:Function) : Boolean{
+		// register DojoExternalInterface methodName with it's instance
+		DojoExternalInterface.flashMethods[methodName] = instance;
+		
+		// tell JavaScript about DojoExternalInterface new method so we can create a proxy
+		ExternalInterface.call(&quot;dojo.flash.comm._addExternalInterfaceCallback&quot;, 
+													 methodName);
+													 
+		return true;
+	}
+	
+	public static function call(methodName:String,
+								resultsCallback:Function) : Void{
+		// we might have any number of optional arguments, so we have to 
+		// pass them in dynamically; strip out the results callback
+		var parameters = new Array();
+		for(var i = 0; i &lt; arguments.length; i++){
+			if(i != 1){ // skip the callback
+				parameters.push(arguments[i]);
+			}
+		}
+		
+		var results = ExternalInterface.call.apply(ExternalInterface, parameters);
+		
+		// immediately give the results back, since ExternalInterface is
+		// synchronous
+		if(resultsCallback != null &amp;&amp; typeof resultsCallback != &quot;undefined&quot;){
+			resultsCallback.call(null, results);
+		}
+	}
+	
+	/** 
+			Called by Flash to indicate to JavaScript that we are ready to have
+			our Flash functions called. Calling loaded()
+			will fire the dojo.flash.loaded() event, so that JavaScript can know that
+			Flash has finished loading and adding its callbacks, and can begin to
+			interact with the Flash file.
+	*/
+	public static function loaded(){
+		DojoExternalInterface.call(&quot;dojo.flash.loaded&quot;);
+	}
+	
+	public static function startExec():Void{
+		DojoExternalInterface.numArgs = null;
+		DojoExternalInterface.argData = null;
+		DojoExternalInterface.resultData = null;
+	}
+	
+	public static function setNumberArguments(numArgs):Void{
+		DojoExternalInterface.numArgs = numArgs;
+		DojoExternalInterface.argData = new Array(DojoExternalInterface.numArgs);
+	}
+	
+	public static function chunkArgumentData(value, argIndex:Number):Void{
+		//getURL(&quot;javascript:dojo.debug('FLASH: chunkArgumentData, value=&quot;+value+&quot;, argIndex=&quot;+argIndex+&quot;')&quot;);
+		var currentValue = DojoExternalInterface.argData[argIndex];
+		if(currentValue == null || typeof currentValue == &quot;undefined&quot;){
+			DojoExternalInterface.argData[argIndex] = value;
+		}else{
+			DojoExternalInterface.argData[argIndex] += value;
+		}
+	}
+	
+	public static function exec(methodName):Void{
+		// decode all of the arguments that were passed in
+		for(var i = 0; i &lt; DojoExternalInterface.argData.length; i++){
+			DojoExternalInterface.argData[i] = 
+				DojoExternalInterface.decodeData(DojoExternalInterface.argData[i]);
+		}
+		
+		var instance = DojoExternalInterface.flashMethods[methodName];
+		DojoExternalInterface.resultData = instance[methodName].apply(
+																			instance, DojoExternalInterface.argData);
+		// encode the result data
+		DojoExternalInterface.resultData = 
+			DojoExternalInterface.encodeData(DojoExternalInterface.resultData);
+			
+		//getURL(&quot;javascript:dojo.debug('FLASH: encoded result data=&quot;+DojoExternalInterface.resultData+&quot;')&quot;);
+	}
+	
+	public static function getReturnLength():Number{
+	 if(DojoExternalInterface.resultData == null || 
+	 					typeof DojoExternalInterface.resultData == &quot;undefined&quot;){
+	 	return 0;
+	 }
+	 var segments = Math.ceil(DojoExternalInterface.resultData.length / 1024);
+	 return segments;
+	}
+	
+	public static function chunkReturnData(segment:Number):String{
+		var numSegments = DojoExternalInterface.getReturnLength();
+		var startCut = segment * 1024;
+		var endCut = segment * 1024 + 1024;
+		if(segment == (numSegments - 1)){
+			endCut = segment * 1024 + DojoExternalInterface.resultData.length;
+		}
+			
+		var piece = DojoExternalInterface.resultData.substring(startCut, endCut);
+		
+		//getURL(&quot;javascript:dojo.debug('FLASH: chunking return piece=&quot;+piece+&quot;')&quot;);
+		
+		return piece;
+	}
+	
+	public static function endExec():Void{
+	}
+	
+	private static function decodeData(data):String{
+		// we have to use custom encodings for certain characters when passing
+		// them over; for example, passing a backslash over as //// from JavaScript
+		// to Flash doesn't work
+		data = DojoExternalInterface.replaceStr(data, &quot;&amp;custom_backslash;&quot;, &quot;\\&quot;);
+		
+		data = DojoExternalInterface.replaceStr(data, &quot;\\\'&quot;, &quot;\'&quot;);
+		data = DojoExternalInterface.replaceStr(data, &quot;\\\&quot;&quot;, &quot;\&quot;&quot;);
+		
+		return data;
+	}
+	
+	private static function encodeData(data){
+		//getURL(&quot;javascript:dojo.debug('inside flash, data before=&quot;+data+&quot;')&quot;);
+
+		// double encode all entity values, or they will be mis-decoded
+		// by Flash when returned
+		data = DojoExternalInterface.replaceStr(data, &quot;&amp;&quot;, &quot;&amp;&quot;);
+		
+		// certain XMLish characters break Flash's wire serialization for
+		// ExternalInterface; encode these into a custom encoding, rather than
+		// the standard entity encoding, because otherwise we won't be able to
+		// differentiate between our own encoding and any entity characters
+		// that are being used in the string itself
+		data = DojoExternalInterface.replaceStr(data, '&lt;', '&amp;custom_lt;');
+		data = DojoExternalInterface.replaceStr(data, '&gt;', '&amp;custom_gt;');
+		
+		// encode control characters and JavaScript delimiters
+		data = DojoExternalInterface.replaceStr(data, &quot;\n&quot;, &quot;\\n&quot;);
+		data = DojoExternalInterface.replaceStr(data, &quot;\r&quot;, &quot;\\r&quot;);
+		data = DojoExternalInterface.replaceStr(data, &quot;\f&quot;, &quot;\\f&quot;);
+		data = DojoExternalInterface.replaceStr(data, &quot;'&quot;, &quot;\\'&quot;);
+		data = DojoExternalInterface.replaceStr(data, '&quot;', '\&quot;');
+		
+		//getURL(&quot;javascript:dojo.debug('inside flash, data after=&quot;+data+&quot;')&quot;);
+		return data;
+	}
+	
+	/** 
+			Flash ActionScript has no String.replace method or support for
+			Regular Expressions! We roll our own very simple one.
+	*/
+	private static function replaceStr(inputStr:String, replaceThis:String, 
+																		 withThis:String):String {
+		var splitStr = inputStr.split(replaceThis)
+		inputStr = splitStr.join(withThis)
+		return inputStr;
+	}
+	
+	private static function getDojoPath(){
+		var url = _root._url;
+		var start = url.indexOf(&quot;baseRelativePath=&quot;) + &quot;baseRelativePath=&quot;.length;
+		var path = url.substring(start);
+		var end = path.indexOf(&quot;&amp;&quot;);
+		if(end != -1){
+			path = path.substring(0, end);
+		}
+		return path;
+	}
+}
+
+// vim:ts=4:noet:tw=0:

Added: tags/parley-0.55/root/static/magic/src/flash/flash8/ExpressInstall.as
===================================================================
--- tags/parley-0.55/root/static/magic/src/flash/flash8/ExpressInstall.as	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/flash/flash8/ExpressInstall.as	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,81 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+/**
+ * Based on the expressinstall.as class created by Geoff Stearns as part
+ * of the FlashObject library.
+ *
+ * Use this file to invoke the Macromedia Flash Player Express Install functionality
+ * This file is intended for use with the FlashObject embed script. You can download FlashObject 
+ * and this file at the following URL: <A HREF="http://blog.deconcept.com/flashobject/">http://blog.deconcept.com/flashobject/</A>
+ *
+ * Usage: 
+ *          var ExpressInstall = new ExpressInstall();
+ *          
+ *          // test to see if install is needed:
+ *          if (ExpressInstall.needsUpdate) { // returns true if update is needed
+ *              ExpressInstall.init(); // starts the update
+ *          }
+ *
+ *	NOTE: Your Flash movie must be at least 214px by 137px in order to use ExpressInstall.
+ *
+ */
+
+class ExpressInstall {
+	public var needsUpdate:Boolean;
+	private var updater:MovieClip;
+	private var hold:MovieClip;
+	
+	public function ExpressInstall(){
+		// does the user need to update?
+		this.needsUpdate = (_root.MMplayerType == undefined) ? false : true;	
+	}
+
+	public function init():Void{
+		this.loadUpdater();
+	}
+
+	public function loadUpdater():Void {
+		System.security.allowDomain(&quot;fpdownload.macromedia.com&quot;);
+
+		// hope that nothing is at a depth of 10000000, you can change this depth if needed, but you want
+		// it to be on top of your content if you have any stuff on the first frame
+		this.updater = _root.createEmptyMovieClip(&quot;expressInstallHolder&quot;, 10000000);
+
+		// register the callback so we know if they cancel or there is an error
+		var _self = this;
+		this.updater.installStatus = _self.onInstallStatus;
+		this.hold = this.updater.createEmptyMovieClip(&quot;hold&quot;, 1);
+
+		// can't use movieClipLoader because it has to work in 6.0.65
+		this.updater.onEnterFrame = function():Void {
+			if(typeof this.hold.startUpdate == 'function'){
+				_self.initUpdater();
+				this.onEnterFrame = null;
+			}
+		}
+
+		var cacheBuster:Number = Math.random();
+
+		this.hold.loadMovie(&quot;<A HREF="http://fpdownload.macromedia.com/pub/flashplayer/">http://fpdownload.macromedia.com/pub/flashplayer/</A>&quot;
+												+&quot;update/current/swf/autoUpdater.swf?&quot;+ cacheBuster);
+	}
+
+	private function initUpdater():Void{
+		this.hold.redirectURL = _root.MMredirectURL;
+		this.hold.MMplayerType = _root.MMplayerType;
+		this.hold.MMdoctitle = _root.MMdoctitle;
+		this.hold.startUpdate();
+	}
+
+	public function onInstallStatus(msg):Void{
+		getURL(&quot;javascript:dojo.flash.install._onInstallStatus('&quot;+msg+&quot;')&quot;);
+	}
+}

Added: tags/parley-0.55/root/static/magic/src/flash.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/flash.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/flash.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,446 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.flash&quot;);
+dojo.require(&quot;dojo.string.*&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.flash = function () {
+};
+dojo.flash = {flash6_version:null, flash8_version:null, ready:false, _visible:true, _loadedListeners:new Array(), _installingListeners:new Array(), setSwf:function (fileInfo) {
+	if (fileInfo == null || dojo.lang.isUndefined(fileInfo)) {
+		return;
+	}
+	if (fileInfo.flash6 != null &amp;&amp; !dojo.lang.isUndefined(fileInfo.flash6)) {
+		this.flash6_version = fileInfo.flash6;
+	}
+	if (fileInfo.flash8 != null &amp;&amp; !dojo.lang.isUndefined(fileInfo.flash8)) {
+		this.flash8_version = fileInfo.flash8;
+	}
+	if (!dojo.lang.isUndefined(fileInfo.visible)) {
+		this._visible = fileInfo.visible;
+	}
+	this._initialize();
+}, useFlash6:function () {
+	if (this.flash6_version == null) {
+		return false;
+	} else {
+		if (this.flash6_version != null &amp;&amp; dojo.flash.info.commVersion == 6) {
+			return true;
+		} else {
+			return false;
+		}
+	}
+}, useFlash8:function () {
+	if (this.flash8_version == null) {
+		return false;
+	} else {
+		if (this.flash8_version != null &amp;&amp; dojo.flash.info.commVersion == 8) {
+			return true;
+		} else {
+			return false;
+		}
+	}
+}, addLoadedListener:function (listener) {
+	this._loadedListeners.push(listener);
+}, addInstallingListener:function (listener) {
+	this._installingListeners.push(listener);
+}, loaded:function () {
+	dojo.flash.ready = true;
+	if (dojo.flash._loadedListeners.length &gt; 0) {
+		for (var i = 0; i &lt; dojo.flash._loadedListeners.length; i++) {
+			dojo.flash._loadedListeners[i].call(null);
+		}
+	}
+}, installing:function () {
+	if (dojo.flash._installingListeners.length &gt; 0) {
+		for (var i = 0; i &lt; dojo.flash._installingListeners.length; i++) {
+			dojo.flash._installingListeners[i].call(null);
+		}
+	}
+}, _initialize:function () {
+	var installer = new dojo.flash.Install();
+	dojo.flash.installer = installer;
+	if (installer.needed() == true) {
+		installer.install();
+	} else {
+		dojo.flash.obj = new dojo.flash.Embed(this._visible);
+		dojo.flash.obj.write(dojo.flash.info.commVersion);
+		dojo.flash.comm = new dojo.flash.Communicator();
+	}
+}};
+dojo.flash.Info = function () {
+	if (dojo.render.html.ie) {
+		document.writeln(&quot;&lt;script language=\&quot;VBScript\&quot; type=\&quot;text/vbscript\&quot;&gt;&quot;);
+		document.writeln(&quot;Function VBGetSwfVer(i)&quot;);
+		document.writeln(&quot;  on error resume next&quot;);
+		document.writeln(&quot;  Dim swControl, swVersion&quot;);
+		document.writeln(&quot;  swVersion = 0&quot;);
+		document.writeln(&quot;  set swControl = CreateObject(\&quot;ShockwaveFlash.ShockwaveFlash.\&quot; + CStr(i))&quot;);
+		document.writeln(&quot;  if (IsObject(swControl)) then&quot;);
+		document.writeln(&quot;	swVersion = swControl.GetVariable(\&quot;$version\&quot;)&quot;);
+		document.writeln(&quot;  end if&quot;);
+		document.writeln(&quot;  VBGetSwfVer = swVersion&quot;);
+		document.writeln(&quot;End Function&quot;);
+		document.writeln(&quot;&lt;/script&gt;&quot;);
+	}
+	this._detectVersion();
+	this._detectCommunicationVersion();
+};
+dojo.flash.Info.prototype = {version:-1, versionMajor:-1, versionMinor:-1, versionRevision:-1, capable:false, commVersion:6, installing:false, isVersionOrAbove:function (reqMajorVer, reqMinorVer, reqVer) {
+	reqVer = parseFloat(&quot;.&quot; + reqVer);
+	if (this.versionMajor &gt;= reqMajorVer &amp;&amp; this.versionMinor &gt;= reqMinorVer &amp;&amp; this.versionRevision &gt;= reqVer) {
+		return true;
+	} else {
+		return false;
+	}
+}, _detectVersion:function () {
+	var versionStr;
+	for (var testVersion = 25; testVersion &gt; 0; testVersion--) {
+		if (dojo.render.html.ie) {
+			versionStr = VBGetSwfVer(testVersion);
+		} else {
+			versionStr = this._JSFlashInfo(testVersion);
+		}
+		if (versionStr == -1) {
+			this.capable = false;
+			return;
+		} else {
+			if (versionStr != 0) {
+				var versionArray;
+				if (dojo.render.html.ie) {
+					var tempArray = versionStr.split(&quot; &quot;);
+					var tempString = tempArray[1];
+					versionArray = tempString.split(&quot;,&quot;);
+				} else {
+					versionArray = versionStr.split(&quot;.&quot;);
+				}
+				this.versionMajor = versionArray[0];
+				this.versionMinor = versionArray[1];
+				this.versionRevision = versionArray[2];
+				var versionString = this.versionMajor + &quot;.&quot; + this.versionRevision;
+				this.version = parseFloat(versionString);
+				this.capable = true;
+				break;
+			}
+		}
+	}
+}, _JSFlashInfo:function (testVersion) {
+	if (navigator.plugins != null &amp;&amp; navigator.plugins.length &gt; 0) {
+		if (navigator.plugins[&quot;Shockwave Flash 2.0&quot;] || navigator.plugins[&quot;Shockwave Flash&quot;]) {
+			var swVer2 = navigator.plugins[&quot;Shockwave Flash 2.0&quot;] ? &quot; 2.0&quot; : &quot;&quot;;
+			var flashDescription = navigator.plugins[&quot;Shockwave Flash&quot; + swVer2].description;
+			var descArray = flashDescription.split(&quot; &quot;);
+			var tempArrayMajor = descArray[2].split(&quot;.&quot;);
+			var versionMajor = tempArrayMajor[0];
+			var versionMinor = tempArrayMajor[1];
+			if (descArray[3] != &quot;&quot;) {
+				var tempArrayMinor = descArray[3].split(&quot;r&quot;);
+			} else {
+				var tempArrayMinor = descArray[4].split(&quot;r&quot;);
+			}
+			var versionRevision = tempArrayMinor[1] &gt; 0 ? tempArrayMinor[1] : 0;
+			var version = versionMajor + &quot;.&quot; + versionMinor + &quot;.&quot; + versionRevision;
+			return version;
+		}
+	}
+	return -1;
+}, _detectCommunicationVersion:function () {
+	if (this.capable == false) {
+		this.commVersion = null;
+		return;
+	}
+	if (typeof djConfig[&quot;forceFlashComm&quot;] != &quot;undefined&quot; &amp;&amp; typeof djConfig[&quot;forceFlashComm&quot;] != null) {
+		this.commVersion = djConfig[&quot;forceFlashComm&quot;];
+		return;
+	}
+	if (dojo.render.html.safari == true || dojo.render.html.opera == true) {
+		this.commVersion = 8;
+	} else {
+		this.commVersion = 6;
+	}
+}};
+dojo.flash.Embed = function (visible) {
+	this._visible = visible;
+};
+dojo.flash.Embed.prototype = {width:215, height:138, id:&quot;flashObject&quot;, _visible:true, protocol:function () {
+	switch (window.location.protocol) {
+	  case &quot;https:&quot;:
+		return &quot;https&quot;;
+		break;
+	  default:
+		return &quot;http&quot;;
+		break;
+	}
+}, write:function (flashVer, doExpressInstall) {
+	if (dojo.lang.isUndefined(doExpressInstall)) {
+		doExpressInstall = false;
+	}
+	var containerStyle = new dojo.string.Builder();
+	containerStyle.append(&quot;width: &quot; + this.width + &quot;px; &quot;);
+	containerStyle.append(&quot;height: &quot; + this.height + &quot;px; &quot;);
+	if (this._visible == false) {
+		containerStyle.append(&quot;position: absolute; &quot;);
+		containerStyle.append(&quot;z-index: 10000; &quot;);
+		containerStyle.append(&quot;top: -1000px; &quot;);
+		containerStyle.append(&quot;left: -1000px; &quot;);
+	}
+	containerStyle = containerStyle.toString();
+	var objectHTML;
+	var swfloc;
+	if (flashVer == 6) {
+		swfloc = dojo.flash.flash6_version;
+		var dojoPath = djConfig.baseRelativePath;
+		swfloc = swfloc + &quot;?baseRelativePath=&quot; + escape(dojoPath);
+		objectHTML = &quot;&lt;embed id=\&quot;&quot; + this.id + &quot;\&quot; src=\&quot;&quot; + swfloc + &quot;\&quot; &quot; + &quot;	quality=\&quot;high\&quot; bgcolor=\&quot;#ffffff\&quot; &quot; + &quot;	width=\&quot;&quot; + this.width + &quot;\&quot; height=\&quot;&quot; + this.height + &quot;\&quot; &quot; + &quot;	name=\&quot;&quot; + this.id + &quot;\&quot; &quot; + &quot;	align=\&quot;middle\&quot; allowScriptAccess=\&quot;sameDomain\&quot; &quot; + &quot;	type=\&quot;application/x-shockwave-flash\&quot; swLiveConnect=\&quot;true\&quot; &quot; + &quot;	pluginspage=\&quot;&quot; + this.protocol() + &quot;://www.macromedia.com/go/getflashplayer\&quot;&gt;&quot;;
+	} else {
+		swfloc = dojo.flash.flash8_version;
+		var swflocObject = swfloc;
+		var swflocEmbed = swfloc;
+		var dojoPath = djConfig.baseRelativePath;
+		if (doExpressInstall) {
+			var redirectURL = escape(window.location);
+			document.title = document.title.slice(0, 47) + &quot; - Flash Player Installation&quot;;
+			var docTitle = escape(document.title);
+			swflocObject += &quot;?MMredirectURL=&quot; + redirectURL + &quot;&amp;MMplayerType=ActiveX&quot; + &quot;&amp;MMdoctitle=&quot; + docTitle + &quot;&amp;baseRelativePath=&quot; + escape(dojoPath);
+			swflocEmbed += &quot;?MMredirectURL=&quot; + redirectURL + &quot;&amp;MMplayerType=PlugIn&quot; + &quot;&amp;baseRelativePath=&quot; + escape(dojoPath);
+		}
+		if (swflocEmbed.indexOf(&quot;?&quot;) == -1) {
+			swflocEmbed += &quot;?baseRelativePath=&quot; + escape(dojoPath) + &quot;' &quot;;
+		}
+		objectHTML = &quot;&lt;object classid=\&quot;clsid:d27cdb6e-ae6d-11cf-96b8-444553540000\&quot; &quot; + &quot;codebase=\&quot;&quot; + this.protocol() + &quot;://fpdownload.macromedia.com/pub/shockwave/cabs/flash/&quot; + &quot;swflash.cab#version=8,0,0,0\&quot; &quot; + &quot;width=\&quot;&quot; + this.width + &quot;\&quot; &quot; + &quot;height=\&quot;&quot; + this.height + &quot;\&quot; &quot; + &quot;id=\&quot;&quot; + this.id + &quot;\&quot; &quot; + &quot;align=\&quot;middle\&quot;&gt; &quot; + &quot;&lt;param name=\&quot;allowScriptAccess\&quot; value=\&quot;sameDomain\&quot; /&gt; &quot; + &quot;&lt;param name=\&quot;movie\&quot; value=\&quot;&quot; + swflocObject + &quot;\&quot; /&gt; &quot; + &quot;&lt;param name=\&quot;quality\&quot; value=\&quot;high\&quot; /&gt; &quot; + &quot;&lt;param name=\&quot;bgcolor\&quot; value=\&quot;#ffffff\&quot; /&gt; &quot; + &quot;&lt;embed src=\&quot;&quot; + swflocEmbed + &quot;' &quot; + &quot;quality=\&quot;high\&quot; &quot; + &quot;bgcolor=\&quot;#ffffff\&quot; &quot; + &quot;width=\&quot;&quot; + this.width + &quot;\&quot; &quot; + &quot;height=\&quot;&quot; + this.height + &quot;\&quot; &quot; + &quot;id=\&quot;&quot; + this.id + &quot;\&quot; &quot; + &quot;name=\&quot;&quot; + this.id + &quot;\&quot; &quot; + &quot;swLiveConnect=\&quot;true\&quot; &quot; + &quot;align=\&quot;middle\&quot; &quot; + &quot;allowScriptAccess=\&quot;sameDomain\&quot; &quot; + &quot;type=\&quot;application/x-shockwave-flash\&quot; &quot; + &quot;pluginspage=\&quot;&quot; + this.protocol() + &quot;://www.macromedia.com/go/getflashplayer\&quot; /&gt;&quot; + &quot;&lt;/!
 object&gt;&quot;;
+	}
+	objectHTML = &quot;&lt;div id=\&quot;&quot; + this.id + &quot;Container\&quot; style=\&quot;&quot; + containerStyle + &quot;\&quot;&gt; &quot; + objectHTML + &quot;&lt;/div&gt;&quot;;
+	document.writeln(objectHTML);
+}, get:function () {
+	return document.getElementById(this.id);
+}, setVisible:function (visible) {
+	var container = dojo.byId(this.id + &quot;Container&quot;);
+	if (visible == true) {
+		container.style.visibility = &quot;visible&quot;;
+	} else {
+		container.style.position = &quot;absolute&quot;;
+		container.style.x = &quot;-1000px&quot;;
+		container.style.y = &quot;-1000px&quot;;
+		container.style.visibility = &quot;hidden&quot;;
+	}
+}, center:function () {
+	var elementWidth = this.width;
+	var elementHeight = this.height;
+	var scroll_offset = dojo.html.getScroll().offset;
+	var viewport_size = dojo.html.getViewport();
+	var x = scroll_offset.x + (viewport_size.width - elementWidth) / 2;
+	var y = scroll_offset.y + (viewport_size.height - elementHeight) / 2;
+	var container = dojo.byId(this.id + &quot;Container&quot;);
+	container.style.top = y + &quot;px&quot;;
+	container.style.left = x + &quot;px&quot;;
+}};
+dojo.flash.Communicator = function () {
+	if (dojo.flash.useFlash6()) {
+		this._writeFlash6();
+	} else {
+		if (dojo.flash.useFlash8()) {
+			this._writeFlash8();
+		}
+	}
+};
+dojo.flash.Communicator.prototype = {_writeFlash6:function () {
+	var id = dojo.flash.obj.id;
+	document.writeln(&quot;&lt;script language=\&quot;JavaScript\&quot;&gt;&quot;);
+	document.writeln(&quot;  function &quot; + id + &quot;_DoFSCommand(command, args){ &quot;);
+	document.writeln(&quot;	dojo.flash.comm._handleFSCommand(command, args); &quot;);
+	document.writeln(&quot;}&quot;);
+	document.writeln(&quot;&lt;/script&gt;&quot;);
+	if (dojo.render.html.ie) {
+		document.writeln(&quot;&lt;SCRIPT LANGUAGE=VBScript&gt; &quot;);
+		document.writeln(&quot;on error resume next &quot;);
+		document.writeln(&quot;Sub &quot; + id + &quot;_FSCommand(ByVal command, ByVal args)&quot;);
+		document.writeln(&quot; call &quot; + id + &quot;_DoFSCommand(command, args)&quot;);
+		document.writeln(&quot;end sub&quot;);
+		document.writeln(&quot;&lt;/SCRIPT&gt; &quot;);
+	}
+}, _writeFlash8:function () {
+}, _handleFSCommand:function (command, args) {
+	if (command != null &amp;&amp; !dojo.lang.isUndefined(command) &amp;&amp; /^FSCommand:(.*)/.test(command) == true) {
+		command = command.match(/^FSCommand:(.*)/)[1];
+	}
+	if (command == &quot;addCallback&quot;) {
+		this._fscommandAddCallback(command, args);
+	} else {
+		if (command == &quot;call&quot;) {
+			this._fscommandCall(command, args);
+		} else {
+			if (command == &quot;fscommandReady&quot;) {
+				this._fscommandReady();
+			}
+		}
+	}
+}, _fscommandAddCallback:function (command, args) {
+	var functionName = args;
+	var callFunc = function () {
+		return dojo.flash.comm._call(functionName, arguments);
+	};
+	dojo.flash.comm[functionName] = callFunc;
+	dojo.flash.obj.get().SetVariable(&quot;_succeeded&quot;, true);
+}, _fscommandCall:function (command, args) {
+	var plugin = dojo.flash.obj.get();
+	var functionName = args;
+	var numArgs = parseInt(plugin.GetVariable(&quot;_numArgs&quot;));
+	var flashArgs = new Array();
+	for (var i = 0; i &lt; numArgs; i++) {
+		var currentArg = plugin.GetVariable(&quot;_&quot; + i);
+		flashArgs.push(currentArg);
+	}
+	var runMe;
+	if (functionName.indexOf(&quot;.&quot;) == -1) {
+		runMe = window[functionName];
+	} else {
+		runMe = eval(functionName);
+	}
+	var results = null;
+	if (!dojo.lang.isUndefined(runMe) &amp;&amp; runMe != null) {
+		results = runMe.apply(null, flashArgs);
+	}
+	plugin.SetVariable(&quot;_returnResult&quot;, results);
+}, _fscommandReady:function () {
+	var plugin = dojo.flash.obj.get();
+	plugin.SetVariable(&quot;fscommandReady&quot;, &quot;true&quot;);
+}, _call:function (functionName, args) {
+	var plugin = dojo.flash.obj.get();
+	plugin.SetVariable(&quot;_functionName&quot;, functionName);
+	plugin.SetVariable(&quot;_numArgs&quot;, args.length);
+	for (var i = 0; i &lt; args.length; i++) {
+		var value = args[i];
+		value = value.replace(/\0/g, &quot;\\0&quot;);
+		plugin.SetVariable(&quot;_&quot; + i, value);
+	}
+	plugin.TCallLabel(&quot;/_flashRunner&quot;, &quot;execute&quot;);
+	var results = plugin.GetVariable(&quot;_returnResult&quot;);
+	results = results.replace(/\\0/g, &quot;\x00&quot;);
+	return results;
+}, _addExternalInterfaceCallback:function (methodName) {
+	var wrapperCall = function () {
+		var methodArgs = new Array(arguments.length);
+		for (var i = 0; i &lt; arguments.length; i++) {
+			methodArgs[i] = arguments[i];
+		}
+		return dojo.flash.comm._execFlash(methodName, methodArgs);
+	};
+	dojo.flash.comm[methodName] = wrapperCall;
+}, _encodeData:function (data) {
+	var entityRE = /\&amp;([^;]*)\;/g;
+	data = data.replace(entityRE, &quot;&amp;$1;&quot;);
+	data = data.replace(/&lt;/g, &quot;&lt;&quot;);
+	data = data.replace(/&gt;/g, &quot;&gt;&quot;);
+	data = data.replace(&quot;\\&quot;, &quot;&amp;custom_backslash;&amp;custom_backslash;&quot;);
+	data = data.replace(/\n/g, &quot;\\n&quot;);
+	data = data.replace(/\r/g, &quot;\\r&quot;);
+	data = data.replace(/\f/g, &quot;\\f&quot;);
+	data = data.replace(/\0/g, &quot;\\0&quot;);
+	data = data.replace(/\'/g, &quot;\\'&quot;);
+	data = data.replace(/\&quot;/g, &quot;\\\&quot;&quot;);
+	return data;
+}, _decodeData:function (data) {
+	if (data == null || typeof data == &quot;undefined&quot;) {
+		return data;
+	}
+	data = data.replace(/\&amp;custom_lt\;/g, &quot;&lt;&quot;);
+	data = data.replace(/\&amp;custom_gt\;/g, &quot;&gt;&quot;);
+	data = eval(&quot;\&quot;&quot; + data + &quot;\&quot;&quot;);
+	return data;
+}, _chunkArgumentData:function (value, argIndex) {
+	var plugin = dojo.flash.obj.get();
+	var numSegments = Math.ceil(value.length / 1024);
+	for (var i = 0; i &lt; numSegments; i++) {
+		var startCut = i * 1024;
+		var endCut = i * 1024 + 1024;
+		if (i == (numSegments - 1)) {
+			endCut = i * 1024 + value.length;
+		}
+		var piece = value.substring(startCut, endCut);
+		piece = this._encodeData(piece);
+		plugin.CallFunction(&quot;&lt;invoke name=\&quot;chunkArgumentData\&quot; &quot; + &quot;returntype=\&quot;javascript\&quot;&gt;&quot; + &quot;&lt;arguments&gt;&quot; + &quot;&lt;string&gt;&quot; + piece + &quot;&lt;/string&gt;&quot; + &quot;&lt;number&gt;&quot; + argIndex + &quot;&lt;/number&gt;&quot; + &quot;&lt;/arguments&gt;&quot; + &quot;&lt;/invoke&gt;&quot;);
+	}
+}, _chunkReturnData:function () {
+	var plugin = dojo.flash.obj.get();
+	var numSegments = plugin.getReturnLength();
+	var resultsArray = new Array();
+	for (var i = 0; i &lt; numSegments; i++) {
+		var piece = plugin.CallFunction(&quot;&lt;invoke name=\&quot;chunkReturnData\&quot; &quot; + &quot;returntype=\&quot;javascript\&quot;&gt;&quot; + &quot;&lt;arguments&gt;&quot; + &quot;&lt;number&gt;&quot; + i + &quot;&lt;/number&gt;&quot; + &quot;&lt;/arguments&gt;&quot; + &quot;&lt;/invoke&gt;&quot;);
+		if (piece == &quot;\&quot;\&quot;&quot; || piece == &quot;''&quot;) {
+			piece = &quot;&quot;;
+		} else {
+			piece = piece.substring(1, piece.length - 1);
+		}
+		resultsArray.push(piece);
+	}
+	var results = resultsArray.join(&quot;&quot;);
+	return results;
+}, _execFlash:function (methodName, methodArgs) {
+	var plugin = dojo.flash.obj.get();
+	plugin.startExec();
+	plugin.setNumberArguments(methodArgs.length);
+	for (var i = 0; i &lt; methodArgs.length; i++) {
+		this._chunkArgumentData(methodArgs[i], i);
+	}
+	plugin.exec(methodName);
+	var results = this._chunkReturnData();
+	results = this._decodeData(results);
+	plugin.endExec();
+	return results;
+}};
+dojo.flash.Install = function () {
+};
+dojo.flash.Install.prototype = {needed:function () {
+	if (dojo.flash.info.capable == false) {
+		return true;
+	}
+	if (dojo.render.os.mac == true &amp;&amp; !dojo.flash.info.isVersionOrAbove(8, 0, 0)) {
+		return true;
+	}
+	if (!dojo.flash.info.isVersionOrAbove(6, 0, 0)) {
+		return true;
+	}
+	return false;
+}, install:function () {
+	dojo.flash.info.installing = true;
+	dojo.flash.installing();
+	if (dojo.flash.info.capable == false) {
+		var installObj = new dojo.flash.Embed(false);
+		installObj.write(8);
+	} else {
+		if (dojo.flash.info.isVersionOrAbove(6, 0, 65)) {
+			var installObj = new dojo.flash.Embed(false);
+			installObj.write(8, true);
+			installObj.setVisible(true);
+			installObj.center();
+		} else {
+			alert(&quot;This content requires a more recent version of the Macromedia &quot; + &quot; Flash Player.&quot;);
+			window.location.href = +dojo.flash.Embed.protocol() + &quot;://www.macromedia.com/go/getflashplayer&quot;;
+		}
+	}
+}, _onInstallStatus:function (msg) {
+	if (msg == &quot;Download.Complete&quot;) {
+		dojo.flash._initialize();
+	} else {
+		if (msg == &quot;Download.Cancelled&quot;) {
+			alert(&quot;This content requires a more recent version of the Macromedia &quot; + &quot; Flash Player.&quot;);
+			window.location.href = dojo.flash.Embed.protocol() + &quot;://www.macromedia.com/go/getflashplayer&quot;;
+		} else {
+			if (msg == &quot;Download.Failed&quot;) {
+				alert(&quot;There was an error downloading the Flash Player update. &quot; + &quot;Please try again later, or visit macromedia.com to download &quot; + &quot;the latest version of the Flash plugin.&quot;);
+			}
+		}
+	}
+}};
+dojo.flash.info = new dojo.flash.Info();
+

Added: tags/parley-0.55/root/static/magic/src/gfx/Colorspace.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/Colorspace.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/Colorspace.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,723 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.Colorspace&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.math.matrix&quot;);
+dojo.gfx.Colorspace = function () {
+	this.whitePoint = &quot;D65&quot;;
+	this.stdObserver = &quot;10&quot;;
+	this.chromaticAdaptationAlg = &quot;bradford&quot;;
+	this.RGBWorkingSpace = &quot;s_rgb&quot;;
+	this.useApproxCIELabMapping = 1;
+	this.chainMaps = {&quot;RGB_to_xyY&quot;:[&quot;XYZ&quot;], &quot;xyY_to_RGB&quot;:[&quot;XYZ&quot;], &quot;RGB_to_Lab&quot;:[&quot;XYZ&quot;], &quot;Lab_to_RGB&quot;:[&quot;XYZ&quot;], &quot;RGB_to_LCHab&quot;:[&quot;XYZ&quot;, &quot;Lab&quot;], &quot;LCHab_to_RGB&quot;:[&quot;Lab&quot;], &quot;xyY_to_Lab&quot;:[&quot;XYZ&quot;], &quot;Lab_to_xyY&quot;:[&quot;XYZ&quot;], &quot;XYZ_to_LCHab&quot;:[&quot;Lab&quot;], &quot;LCHab_to_XYZ&quot;:[&quot;Lab&quot;], &quot;xyY_to_LCHab&quot;:[&quot;XYZ&quot;, &quot;Lab&quot;], &quot;LCHab_to_xyY&quot;:[&quot;Lab&quot;, &quot;XYZ&quot;], &quot;RGB_to_Luv&quot;:[&quot;XYZ&quot;], &quot;Luv_to_RGB&quot;:[&quot;XYZ&quot;], &quot;xyY_to_Luv&quot;:[&quot;XYZ&quot;], &quot;Luv_to_xyY&quot;:[&quot;XYZ&quot;], &quot;Lab_to_Luv&quot;:[&quot;XYZ&quot;], &quot;Luv_to_Lab&quot;:[&quot;XYZ&quot;], &quot;LCHab_to_Luv&quot;:[&quot;Lab&quot;, &quot;XYZ&quot;], &quot;Luv_to_LCHab&quot;:[&quot;XYZ&quot;, &quot;Lab&quot;], &quot;RGB_to_LCHuv&quot;:[&quot;XYZ&quot;, &quot;Luv&quot;], &quot;LCHuv_to_RGB&quot;:[&quot;Luv&quot;, &quot;XYZ&quot;], &quot;XYZ_to_LCHuv&quot;:[&quot;Luv&quot;], &quot;LCHuv_to_XYZ&quot;:[&quot;Luv&quot;], &quot;xyY_to_LCHuv&quot;:[&quot;XYZ&quot;, &quot;Luv&quot;], &quot;LCHuv_to_xyY&quot;:[&quot;Luv&quot;, &quot;XYZ&quot;], &quot;Lab_to_LCHuv&quot;:[&quot;XYZ&quot;, &quot;Luv&quot;], &quot;LCHuv_to_Lab&quot;:[&quot;Luv&quot;, &quot;XYZ&quot;], &quot;LCHab_to_LCHuv&quot;:[&quot;Lab&quot;, &quot;XYZ&quot;, &quot;Luv&quot;], &quot;LCHuv_to_LCHab&quot;:[&quot;Luv&quot;, &quot;XYZ&quot;, &quot;Lab&quot;], &quot;XYZ_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMY_to_XYZ&quot;:[&quot;RGB&quot;], &quot;xyY_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMY_to_xyY&quot;:[&quot;RGB&quot;], &quot;Lab_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMY_to_Lab&quot;:[&quot;RGB&quot;], &quot;LCHab_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMY_to_!
 LCHab&quot;:[&quot;RGB&quot;], &quot;Luv_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMY_to_Luv&quot;:[&quot;RGB&quot;], &quot;LCHuv_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMY_to_LCHuv&quot;:[&quot;RGB&quot;], &quot;XYZ_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_XYZ&quot;:[&quot;RGB&quot;], &quot;xyY_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_xyY&quot;:[&quot;RGB&quot;], &quot;Lab_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_Lab&quot;:[&quot;RGB&quot;], &quot;LCHab_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_LCHab&quot;:[&quot;RGB&quot;], &quot;Luv_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_Luv&quot;:[&quot;RGB&quot;], &quot;LCHuv_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_LCHuv&quot;:[&quot;RGB&quot;], &quot;CMY_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMYK_to_HSL&quot;:[&quot;RGB&quot;], &quot;HSL_to_CMYK&quot;:[&quot;RGB&quot;], &quot;XYZ_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_XYZ&quot;:[&quot;RGB&quot;], &quot;xyY_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_xyY&quot;:[&quot;RGB&quot;], &quot;Lab_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_Lab&quot;:[&quot;RGB&quot;], &quot;LCHab_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_LCHab&quot;:[&quot;RGB&quot;], &quot;Luv_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_Luv&quot;:[&quot;RGB&quot;], &quot;LCHuv_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_LCHuv&quot;:[&quot;RGB&quot;], &quot;CMY_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_CMY&quot;:[&quot;RGB&quot;], &quot;CMYK_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_CMYK&quot;:[&quot;RGB&quot;], &quot;HSL_to_HSV&quot;:[&quot;RGB&quot;], &quot;HSV_to_HSL&quot;:[&quot;RGB&quot;], &quot;XYZ_to_CMYK&quot;:[&quot;RGB&quot;], &quot;CMYK_to_XYZ&quot;:[&quot;RGB&quot;], &quot;xyY_to_CMYK&quot;:[&quot;RGB&quot;], &quot;CMYK_to_xyY&quot;:[&quot;RGB&quot;], &quot;Lab_to_CMYK&quot;:[&quot;RGB&quot;!
 ], &quot;CMYK_to_Lab&quot;:[&quot;RGB&quot;], &quot;LCHab_to_CMYK&quot;:[&quot;RGB&quot;], &quot;CMYK_to_LC!
 Hab&quot;:[&quot;R
GB&quot;], &quot;Luv_to_CMYK&quot;:[&quot;RGB&quot;], &quot;CMYK_to_Luv&quot;:[&quot;RGB&quot;], &quot;LCHuv_to_CMYK&quot;:[&quot;RGB&quot;], &quot;CMYK_to_LCHuv&quot;:[&quot;RGB&quot;]};
+	return this;
+};
+dojo.gfx.Colorspace.prototype.convert = function (col, model_from, model_to) {
+	var k = model_from + &quot;_to_&quot; + model_to;
+	if (this[k]) {
+		return this[k](col);
+	} else {
+		if (this.chainMaps[k]) {
+			var cur = model_from;
+			var models = this.chainMaps[k].concat();
+			models.push(model_to);
+			for (var i = 0; i &lt; models.length; i++) {
+				col = this.convert(col, cur, models[i]);
+				cur = models[i];
+			}
+			return col;
+		} else {
+			dojo.debug(&quot;Can't convert from &quot; + model_from + &quot; to &quot; + model_to);
+		}
+	}
+};
+dojo.gfx.Colorspace.prototype.munge = function (keys, args) {
+	if (dojo.lang.isArray(args[0])) {
+		args = args[0];
+	}
+	var out = new Array();
+	for (var i = 0; i &lt; keys.length; i++) {
+		out[keys.charAt(i)] = args[i];
+	}
+	return out;
+};
+dojo.gfx.Colorspace.prototype.getWhitePoint = function () {
+	var x = 0;
+	var y = 0;
+	var t = 0;
+	switch (this.stdObserver) {
+	  case &quot;2&quot;:
+		switch (this.whitePoint) {
+		  case &quot;E&quot;:
+			x = 1 / 3;
+			y = 1 / 3;
+			t = 5400;
+			break;
+		  case &quot;D50&quot;:
+			x = 0.34567;
+			y = 0.3585;
+			t = 5000;
+			break;
+		  case &quot;D55&quot;:
+			x = 0.33242;
+			y = 0.34743;
+			t = 5500;
+			break;
+		  case &quot;D65&quot;:
+			x = 0.31271;
+			y = 0.32902;
+			t = 6500;
+			break;
+		  case &quot;D75&quot;:
+			x = 0.29902;
+			y = 0.31485;
+			t = 7500;
+			break;
+		  case &quot;A&quot;:
+			x = 0.44757;
+			y = 0.40745;
+			t = 2856;
+			break;
+		  case &quot;B&quot;:
+			x = 0.34842;
+			y = 0.35161;
+			t = 4874;
+			break;
+		  case &quot;C&quot;:
+			x = 0.31006;
+			y = 0.31616;
+			t = 6774;
+			break;
+		  case &quot;9300&quot;:
+			x = 0.2848;
+			y = 0.2932;
+			t = 9300;
+			break;
+		  case &quot;F2&quot;:
+			x = 0.37207;
+			y = 0.37512;
+			t = 4200;
+			break;
+		  case &quot;F7&quot;:
+			x = 0.31285;
+			y = 0.32918;
+			t = 6500;
+			break;
+		  case &quot;F11&quot;:
+			x = 0.38054;
+			y = 0.37691;
+			t = 4000;
+			break;
+		  default:
+			dojo.debug(&quot;White point &quot; + this.whitePoint + &quot; isn't defined for Std. Observer &quot; + this.strObserver);
+		}
+		break;
+	  case &quot;10&quot;:
+		switch (this.whitePoint) {
+		  case &quot;E&quot;:
+			x = 1 / 3;
+			y = 1 / 3;
+			t = 5400;
+			break;
+		  case &quot;D50&quot;:
+			x = 0.34773;
+			y = 0.35952;
+			t = 5000;
+			break;
+		  case &quot;D55&quot;:
+			x = 0.33411;
+			y = 0.34877;
+			t = 5500;
+			break;
+		  case &quot;D65&quot;:
+			x = 0.31382;
+			y = 0.331;
+			t = 6500;
+			break;
+		  case &quot;D75&quot;:
+			x = 0.29968;
+			y = 0.3174;
+			t = 7500;
+			break;
+		  case &quot;A&quot;:
+			x = 0.45117;
+			y = 0.40594;
+			t = 2856;
+			break;
+		  case &quot;B&quot;:
+			x = 0.3498;
+			y = 0.3527;
+			t = 4874;
+			break;
+		  case &quot;C&quot;:
+			x = 0.31039;
+			y = 0.31905;
+			t = 6774;
+			break;
+		  case &quot;F2&quot;:
+			x = 0.37928;
+			y = 0.36723;
+			t = 4200;
+			break;
+		  case &quot;F7&quot;:
+			x = 0.31565;
+			y = 0.32951;
+			t = 6500;
+			break;
+		  case &quot;F11&quot;:
+			x = 0.38543;
+			y = 0.3711;
+			t = 4000;
+			break;
+		  default:
+			dojo.debug(&quot;White point &quot; + this.whitePoint + &quot; isn't defined for Std. Observer &quot; + this.strObserver);
+		}
+		break;
+	  default:
+		dojo.debug(&quot;Std. Observer &quot; + this.strObserver + &quot; isn't defined&quot;);
+	}
+	var z = 1 - x - y;
+	var wp = {&quot;x&quot;:x, &quot;y&quot;:y, &quot;z&quot;:z, &quot;t&quot;:t};
+	wp.Y = 1;
+	var XYZ = this.xyY_to_XYZ([wp.x, wp.y, wp.Y]);
+	wp.X = XYZ[0];
+	wp.Y = XYZ[1];
+	wp.Z = XYZ[2];
+	return wp;
+};
+dojo.gfx.Colorspace.prototype.getPrimaries = function () {
+	var m = [];
+	switch (this.RGBWorkingSpace) {
+	  case &quot;adobe_rgb_1998&quot;:
+		m = [2.2, &quot;D65&quot;, 0.64, 0.33, 0.297361, 0.21, 0.71, 0.627355, 0.15, 0.06, 0.075285];
+		break;
+	  case &quot;apple_rgb&quot;:
+		m = [1.8, &quot;D65&quot;, 0.625, 0.34, 0.244634, 0.28, 0.595, 0.672034, 0.155, 0.07, 0.083332];
+		break;
+	  case &quot;best_rgb&quot;:
+		m = [2.2, &quot;D50&quot;, 0.7347, 0.2653, 0.228457, 0.215, 0.775, 0.737352, 0.13, 0.035, 0.034191];
+		break;
+	  case &quot;beta_rgb&quot;:
+		m = [2.2, &quot;D50&quot;, 0.6888, 0.3112, 0.303273, 0.1986, 0.7551, 0.663786, 0.1265, 0.0352, 0.032941];
+		break;
+	  case &quot;bruce_rgb&quot;:
+		m = [2.2, &quot;D65&quot;, 0.64, 0.33, 0.240995, 0.28, 0.65, 0.683554, 0.15, 0.06, 0.075452];
+		break;
+	  case &quot;cie_rgb&quot;:
+		m = [2.2, &quot;E&quot;, 0.735, 0.265, 0.176204, 0.274, 0.717, 0.812985, 0.167, 0.009, 0.010811];
+		break;
+	  case &quot;color_match_rgb&quot;:
+		m = [1.8, &quot;D50&quot;, 0.63, 0.34, 0.274884, 0.295, 0.605, 0.658132, 0.15, 0.075, 0.066985];
+		break;
+	  case &quot;don_rgb_4&quot;:
+		m = [2.2, &quot;D50&quot;, 0.696, 0.3, 0.27835, 0.215, 0.765, 0.68797, 0.13, 0.035, 0.03368];
+		break;
+	  case &quot;eci_rgb&quot;:
+		m = [1.8, &quot;D50&quot;, 0.67, 0.33, 0.32025, 0.21, 0.71, 0.602071, 0.14, 0.08, 0.077679];
+		break;
+	  case &quot;ekta_space_ps5&quot;:
+		m = [2.2, &quot;D50&quot;, 0.695, 0.305, 0.260629, 0.26, 0.7, 0.734946, 0.11, 0.005, 0.004425];
+		break;
+	  case &quot;ntsc_rgb&quot;:
+		m = [2.2, &quot;C&quot;, 0.67, 0.33, 0.298839, 0.21, 0.71, 0.586811, 0.14, 0.08, 0.11435];
+		break;
+	  case &quot;pal_secam_rgb&quot;:
+		m = [2.2, &quot;D65&quot;, 0.64, 0.33, 0.222021, 0.29, 0.6, 0.706645, 0.15, 0.06, 0.071334];
+		break;
+	  case &quot;pro_photo_rgb&quot;:
+		m = [1.8, &quot;D50&quot;, 0.7347, 0.2653, 0.28804, 0.1596, 0.8404, 0.711874, 0.0366, 0.0001, 0.000086];
+		break;
+	  case &quot;smpte-c_rgb&quot;:
+		m = [2.2, &quot;D65&quot;, 0.63, 0.34, 0.212395, 0.31, 0.595, 0.701049, 0.155, 0.07, 0.086556];
+		break;
+	  case &quot;s_rgb&quot;:
+		m = [2.2, &quot;D65&quot;, 0.64, 0.33, 0.212656, 0.3, 0.6, 0.715158, 0.15, 0.06, 0.072186];
+		break;
+	  case &quot;wide_gamut_rgb&quot;:
+		m = [2.2, &quot;D50&quot;, 0.735, 0.265, 0.258187, 0.115, 0.826, 0.724938, 0.157, 0.018, 0.016875];
+		break;
+	  default:
+		dojo.debug(&quot;RGB working space &quot; + this.RGBWorkingSpace + &quot; isn't defined&quot;);
+	}
+	var p = {name:this.RGBWorkingSpace, gamma:m[0], wp:m[1], xr:m[2], yr:m[3], Yr:m[4], xg:m[5], yg:m[6], Yg:m[7], xb:m[8], yb:m[9], Yb:m[10]};
+	if (p.wp != this.whitePoint) {
+		var r = this.XYZ_to_xyY(this.chromaticAdaptation(this.xyY_to_XYZ([p.xr, p.yr, p.Yr]), p.wp, this.whitePoint));
+		var g = this.XYZ_to_xyY(this.chromaticAdaptation(this.xyY_to_XYZ([p.xg, p.yg, p.Yg]), p.wp, this.whitePoint));
+		var b = this.XYZ_to_xyY(this.chromaticAdaptation(this.xyY_to_XYZ([p.xb, p.yb, p.Yb]), p.wp, this.whitePoint));
+		p.xr = r[0];
+		p.yr = r[1];
+		p.Yr = r[2];
+		p.xg = g[0];
+		p.yg = g[1];
+		p.Yg = g[2];
+		p.xb = b[0];
+		p.yb = b[1];
+		p.Yb = b[2];
+		p.wp = this.whitePoint;
+	}
+	p.zr = 1 - p.xr - p.yr;
+	p.zg = 1 - p.xg - p.yg;
+	p.zb = 1 - p.xb - p.yb;
+	return p;
+};
+dojo.gfx.Colorspace.prototype.epsilon = function () {
+	return this.useApproxCIELabMapping ? 0.008856 : 216 / 24289;
+};
+dojo.gfx.Colorspace.prototype.kappa = function () {
+	return this.useApproxCIELabMapping ? 903.3 : 24389 / 27;
+};
+dojo.gfx.Colorspace.prototype.XYZ_to_xyY = function () {
+	var src = this.munge(&quot;XYZ&quot;, arguments);
+	var sum = src.X + src.Y + src.Z;
+	if (sum == 0) {
+		var wp = this.getWhitePoint();
+		var x = wp.x;
+		var y = wp.y;
+	} else {
+		var x = src.X / sum;
+		var y = src.Y / sum;
+	}
+	var Y = src.Y;
+	return [x, y, Y];
+};
+dojo.gfx.Colorspace.prototype.xyY_to_XYZ = function () {
+	var src = this.munge(&quot;xyY&quot;, arguments);
+	if (src.y == 0) {
+		var X = 0;
+		var Y = 0;
+		var Z = 0;
+	} else {
+		var X = (src.x * src.Y) / src.y;
+		var Y = src.Y;
+		var Z = ((1 - src.x - src.y) * src.Y) / src.y;
+	}
+	return [X, Y, Z];
+};
+dojo.gfx.Colorspace.prototype.RGB_to_XYZ = function () {
+	var src = this.munge(&quot;RGB&quot;, arguments);
+	var m = this.getRGB_XYZ_Matrix();
+	var pr = this.getPrimaries();
+	if (this.RGBWorkingSpace == &quot;s_rgb&quot;) {
+		var r = (src.R &gt; 0.04045) ? Math.pow(((src.R + 0.055) / 1.055), 2.4) : src.R / 12.92;
+		var g = (src.G &gt; 0.04045) ? Math.pow(((src.G + 0.055) / 1.055), 2.4) : src.G / 12.92;
+		var b = (src.B &gt; 0.04045) ? Math.pow(((src.B + 0.055) / 1.055), 2.4) : src.B / 12.92;
+	} else {
+		var r = Math.pow(src.R, pr.gamma);
+		var g = Math.pow(src.G, pr.gamma);
+		var b = Math.pow(src.B, pr.gamma);
+	}
+	var XYZ = dojo.math.matrix.multiply([[r, g, b]], m);
+	return [XYZ[0][0], XYZ[0][1], XYZ[0][2]];
+};
+dojo.gfx.Colorspace.prototype.XYZ_to_RGB = function () {
+	var src = this.munge(&quot;XYZ&quot;, arguments);
+	var mi = this.getXYZ_RGB_Matrix();
+	var pr = this.getPrimaries();
+	var rgb = dojo.math.matrix.multiply([[src.X, src.Y, src.Z]], mi);
+	var r = rgb[0][0];
+	var g = rgb[0][1];
+	var b = rgb[0][2];
+	if (this.RGBWorkingSpace == &quot;s_rgb&quot;) {
+		var R = (r &gt; 0.0031308) ? (1.055 * Math.pow(r, 1 / 2.4)) - 0.055 : 12.92 * r;
+		var G = (g &gt; 0.0031308) ? (1.055 * Math.pow(g, 1 / 2.4)) - 0.055 : 12.92 * g;
+		var B = (b &gt; 0.0031308) ? (1.055 * Math.pow(b, 1 / 2.4)) - 0.055 : 12.92 * b;
+	} else {
+		var R = Math.pow(r, 1 / pr.gamma);
+		var G = Math.pow(g, 1 / pr.gamma);
+		var B = Math.pow(b, 1 / pr.gamma);
+	}
+	return [R, G, B];
+};
+dojo.gfx.Colorspace.prototype.XYZ_to_Lab = function () {
+	var src = this.munge(&quot;XYZ&quot;, arguments);
+	var wp = this.getWhitePoint();
+	var xr = src.X / wp.X;
+	var yr = src.Y / wp.Y;
+	var zr = src.Z / wp.Z;
+	var fx = (xr &gt; this.epsilon()) ? Math.pow(xr, 1 / 3) : (this.kappa() * xr + 16) / 116;
+	var fy = (yr &gt; this.epsilon()) ? Math.pow(yr, 1 / 3) : (this.kappa() * yr + 16) / 116;
+	var fz = (zr &gt; this.epsilon()) ? Math.pow(zr, 1 / 3) : (this.kappa() * zr + 16) / 116;
+	var L = 116 * fy - 16;
+	var a = 500 * (fx - fy);
+	var b = 200 * (fy - fz);
+	return [L, a, b];
+};
+dojo.gfx.Colorspace.prototype.Lab_to_XYZ = function () {
+	var src = this.munge(&quot;Lab&quot;, arguments);
+	var wp = this.getWhitePoint();
+	var yr = (src.L &gt; (this.kappa() * this.epsilon())) ? Math.pow((src.L + 16) / 116, 3) : src.L / this.kappa();
+	var fy = (yr &gt; this.epsilon()) ? (src.L + 16) / 116 : (this.kappa() * yr + 16) / 116;
+	var fx = (src.a / 500) + fy;
+	var fz = fy - (src.b / 200);
+	var fxcube = Math.pow(fx, 3);
+	var fzcube = Math.pow(fz, 3);
+	var xr = (fxcube &gt; this.epsilon()) ? fxcube : (116 * fx - 16) / this.kappa();
+	var zr = (fzcube &gt; this.epsilon()) ? fzcube : (116 * fz - 16) / this.kappa();
+	var X = xr * wp.X;
+	var Y = yr * wp.Y;
+	var Z = zr * wp.Z;
+	return [X, Y, Z];
+};
+dojo.gfx.Colorspace.prototype.Lab_to_LCHab = function () {
+	var src = this.munge(&quot;Lab&quot;, arguments);
+	var L = src.L;
+	var C = Math.pow(src.a * src.a + src.b * src.b, 0.5);
+	var H = Math.atan2(src.b, src.a) * (180 / Math.PI);
+	if (H &lt; 0) {
+		H += 360;
+	}
+	if (H &gt; 360) {
+		H -= 360;
+	}
+	return [L, C, H];
+};
+dojo.gfx.Colorspace.prototype.LCHab_to_Lab = function () {
+	var src = this.munge(&quot;LCH&quot;, arguments);
+	var H_rad = src.H * (Math.PI / 180);
+	var L = src.L;
+	var a = src.C / Math.pow(Math.pow(Math.tan(H_rad), 2) + 1, 0.5);
+	if ((90 &lt; src.H) &amp;&amp; (src.H &lt; 270)) {
+		a = -a;
+	}
+	var b = Math.pow(Math.pow(src.C, 2) - Math.pow(a, 2), 0.5);
+	if (src.H &gt; 180) {
+		b = -b;
+	}
+	return [L, a, b];
+};
+dojo.gfx.Colorspace.prototype.chromaticAdaptation = function (col, src_w, dst_w) {
+	col = this.munge(&quot;XYZ&quot;, [col]);
+	var old_wp = this.whitePoint;
+	this.whitePoint = src_w;
+	var wp_src = this.getWhitePoint();
+	this.whitePoint = dst_w;
+	var wp_dst = this.getWhitePoint();
+	this.whitePoint = old_wp;
+	switch (this.chromaticAdaptationAlg) {
+	  case &quot;xyz_scaling&quot;:
+		var ma = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];
+		var mai = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];
+		break;
+	  case &quot;bradford&quot;:
+		var ma = [[0.8951, -0.7502, 0.0389], [0.2664, 1.7135, -0.0685], [-0.1614, 0.0367, 1.0296]];
+		var mai = [[0.986993, 0.432305, -0.008529], [-0.147054, 0.51836, 0.040043], [0.159963, 0.049291, 0.968487]];
+		break;
+	  case &quot;von_kries&quot;:
+		var ma = [[0.40024, -0.2263, 0], [0.7076, 1.16532, 0], [-0.08081, 0.0457, 0.91822]];
+		var mai = [[1.859936, 0.361191, 0], [-1.129382, 0.638812, 0], [0.219897, -0.000006, 1.089064]];
+		break;
+	  default:
+		dojo.debug(&quot;The &quot; + this.chromaticAdaptationAlg + &quot; chromatic adaptation algorithm matricies are not defined&quot;);
+	}
+	var domain_src = dojo.math.matrix.multiply([[wp_src.x, wp_src.y, wp_src.z]], ma);
+	var domain_dst = dojo.math.matrix.multiply([[wp_dst.x, wp_dst.y, wp_dst.z]], ma);
+	var centre = [[domain_dst[0][0] / domain_src[0][0], 0, 0], [0, domain_dst[0][1] / domain_src[0][1], 0], [0, 0, domain_dst[0][2] / domain_src[0][2]]];
+	var m = dojo.math.matrix.multiply(dojo.math.matrix.multiply(ma, centre), mai);
+	var dst = dojo.math.matrix.multiply([[col.X, col.Y, col.Z]], m);
+	return dst[0];
+};
+dojo.gfx.Colorspace.prototype.getRGB_XYZ_Matrix = function () {
+	var wp = this.getWhitePoint();
+	var pr = this.getPrimaries();
+	var Xr = pr.xr / pr.yr;
+	var Yr = 1;
+	var Zr = (1 - pr.xr - pr.yr) / pr.yr;
+	var Xg = pr.xg / pr.yg;
+	var Yg = 1;
+	var Zg = (1 - pr.xg - pr.yg) / pr.yg;
+	var Xb = pr.xb / pr.yb;
+	var Yb = 1;
+	var Zb = (1 - pr.xb - pr.yb) / pr.yb;
+	var m1 = [[Xr, Yr, Zr], [Xg, Yg, Zg], [Xb, Yb, Zb]];
+	var m2 = [[wp.X, wp.Y, wp.Z]];
+	var sm = dojo.math.matrix.multiply(m2, dojo.math.matrix.inverse(m1));
+	var Sr = sm[0][0];
+	var Sg = sm[0][1];
+	var Sb = sm[0][2];
+	var m4 = [[Sr * Xr, Sr * Yr, Sr * Zr], [Sg * Xg, Sg * Yg, Sg * Zg], [Sb * Xb, Sb * Yb, Sb * Zb]];
+	return m4;
+};
+dojo.gfx.Colorspace.prototype.getXYZ_RGB_Matrix = function () {
+	var m = this.getRGB_XYZ_Matrix();
+	return dojo.math.matrix.inverse(m);
+};
+dojo.gfx.Colorspace.prototype.XYZ_to_Luv = function () {
+	var src = this.munge(&quot;XYZ&quot;, arguments);
+	var wp = this.getWhitePoint();
+	var ud = (4 * src.X) / (src.X + 15 * src.Y + 3 * src.Z);
+	var vd = (9 * src.Y) / (src.X + 15 * src.Y + 3 * src.Z);
+	var udr = (4 * wp.X) / (wp.X + 15 * wp.Y + 3 * wp.Z);
+	var vdr = (9 * wp.Y) / (wp.X + 15 * wp.Y + 3 * wp.Z);
+	var yr = src.Y / wp.Y;
+	var L = (yr &gt; this.epsilon()) ? 116 * Math.pow(yr, 1 / 3) - 16 : this.kappa() * yr;
+	var u = 13 * L * (ud - udr);
+	var v = 13 * L * (vd - vdr);
+	return [L, u, v];
+};
+dojo.gfx.Colorspace.prototype.Luv_to_XYZ = function () {
+	var src = this.munge(&quot;Luv&quot;, arguments);
+	var wp = this.getWhitePoint();
+	var uz = (4 * wp.X) / (wp.X + 15 * wp.Y + 3 * wp.Z);
+	var vz = (9 * wp.Y) / (wp.X + 15 * wp.Y + 3 * wp.Z);
+	var Y = (src.L &gt; this.kappa() * this.epsilon()) ? Math.pow((src.L + 16) / 116, 3) : src.L / this.kappa();
+	var a = (1 / 3) * (((52 * src.L) / (src.u + 13 * src.L * uz)) - 1);
+	var b = -5 * Y;
+	var c = -(1 / 3);
+	var d = Y * (((39 * src.L) / (src.v + 13 * src.L * vz)) - 5);
+	var X = (d - b) / (a - c);
+	var Z = X * a + b;
+	return [X, Y, Z];
+};
+dojo.gfx.Colorspace.prototype.Luv_to_LCHuv = function () {
+	var src = this.munge(&quot;Luv&quot;, arguments);
+	var L = src.L;
+	var C = Math.pow(src.u * src.u + src.v * src.v, 0.5);
+	var H = Math.atan2(src.v, src.u) * (180 / Math.PI);
+	if (H &lt; 0) {
+		H += 360;
+	}
+	if (H &gt; 360) {
+		H -= 360;
+	}
+	return [L, C, H];
+};
+dojo.gfx.Colorspace.prototype.LCHuv_to_Luv = function () {
+	var src = this.munge(&quot;LCH&quot;, arguments);
+	var H_rad = src.H * (Math.PI / 180);
+	var L = src.L;
+	var u = src.C / Math.pow(Math.pow(Math.tan(H_rad), 2) + 1, 0.5);
+	var v = Math.pow(src.C * src.C - u * u, 0.5);
+	if ((90 &lt; src.H) &amp;&amp; (src.H &lt; 270)) {
+		u *= -1;
+	}
+	if (src.H &gt; 180) {
+		v *= -1;
+	}
+	return [L, u, v];
+};
+dojo.gfx.Colorspace.colorTemp_to_whitePoint = function (T) {
+	if (T &lt; 4000) {
+		dojo.debug(&quot;Can't find a white point for temperatures under 4000K&quot;);
+		return [0, 0];
+	}
+	if (T &gt; 25000) {
+		dojo.debug(&quot;Can't find a white point for temperatures over 25000K&quot;);
+		return [0, 0];
+	}
+	var T1 = T;
+	var T2 = T * T;
+	var T3 = T2 * T;
+	var ten9 = Math.pow(10, 9);
+	var ten6 = Math.pow(10, 6);
+	var ten3 = Math.pow(10, 3);
+	if (T &lt;= 7000) {
+		var x = (-4.607 * ten9 / T3) + (2.9678 * ten6 / T2) + (0.09911 * ten3 / T) + 0.244063;
+	} else {
+		var x = (-2.0064 * ten9 / T3) + (1.9018 * ten6 / T2) + (0.24748 * ten3 / T) + 0.23704;
+	}
+	var y = -3 * x * x + 2.87 * x - 0.275;
+	return [x, y];
+};
+dojo.gfx.Colorspace.prototype.RGB_to_CMY = function () {
+	var src = this.munge(&quot;RGB&quot;, arguments);
+	var C = 1 - src.R;
+	var M = 1 - src.G;
+	var Y = 1 - src.B;
+	return [C, M, Y];
+};
+dojo.gfx.Colorspace.prototype.CMY_to_RGB = function () {
+	var src = this.munge(&quot;CMY&quot;, arguments);
+	var R = 1 - src.C;
+	var G = 1 - src.M;
+	var B = 1 - src.Y;
+	return [R, G, B];
+};
+dojo.gfx.Colorspace.prototype.RGB_to_CMYK = function () {
+	var src = this.munge(&quot;RGB&quot;, arguments);
+	var K = Math.min(1 - src.R, 1 - src.G, 1 - src.B);
+	var C = (1 - src.R - K) / (1 - K);
+	var M = (1 - src.G - K) / (1 - K);
+	var Y = (1 - src.B - K) / (1 - K);
+	return [C, M, Y, K];
+};
+dojo.gfx.Colorspace.prototype.CMYK_to_RGB = function () {
+	var src = this.munge(&quot;CMYK&quot;, arguments);
+	var R = 1 - Math.min(1, src.C * (1 - src.K) + src.K);
+	var G = 1 - Math.min(1, src.M * (1 - src.K) + src.K);
+	var B = 1 - Math.min(1, src.Y * (1 - src.K) + src.K);
+	return [R, G, B];
+};
+dojo.gfx.Colorspace.prototype.CMY_to_CMYK = function () {
+	var src = this.munge(&quot;CMY&quot;, arguments);
+	var K = Math.min(src.C, src.M, src.Y);
+	var C = (src.C - K) / (1 - K);
+	var M = (src.M - K) / (1 - K);
+	var Y = (src.Y - K) / (1 - K);
+	return [C, M, Y, K];
+};
+dojo.gfx.Colorspace.prototype.CMYK_to_CMY = function () {
+	var src = this.munge(&quot;CMYK&quot;, arguments);
+	var C = Math.min(1, src.C * (1 - src.K) + src.K);
+	var M = Math.min(1, src.M * (1 - src.K) + src.K);
+	var Y = Math.min(1, src.Y * (1 - src.K) + src.K);
+	return [C, M, Y];
+};
+dojo.gfx.Colorspace.prototype.RGB_to_HSV = function () {
+	var src = this.munge(&quot;RGB&quot;, arguments);
+	var min = Math.min(src.R, src.G, src.B);
+	var V = Math.max(src.R, src.G, src.B);
+	var delta = V - min;
+	var H = null;
+	var S = (V == 0) ? 0 : delta / V;
+	if (S == 0) {
+		H = 0;
+	} else {
+		if (src.R == V) {
+			H = 60 * (src.G - src.B) / delta;
+		} else {
+			if (src.G == V) {
+				H = 120 + 60 * (src.B - src.R) / delta;
+			} else {
+				if (src.B == V) {
+					H = 240 + 60 * (src.R - src.G) / delta;
+				}
+			}
+		}
+		if (H &lt; 0) {
+			H += 360;
+		}
+	}
+	H = (H == 0) ? 360 : H;
+	return [H, S, V];
+};
+dojo.gfx.Colorspace.prototype.HSV_to_RGB = function () {
+	var src = this.munge(&quot;HSV&quot;, arguments);
+	if (src.H == 360) {
+		src.H = 0;
+	}
+	var r = null;
+	var g = null;
+	var b = null;
+	if (src.S == 0) {
+		var R = src.V;
+		var G = src.V;
+		var B = src.V;
+	} else {
+		var hTemp = src.H / 60;
+		var i = Math.floor(hTemp);
+		var f = hTemp - i;
+		var p = src.V * (1 - src.S);
+		var q = src.V * (1 - (src.S * f));
+		var t = src.V * (1 - (src.S * (1 - f)));
+		switch (i) {
+		  case 0:
+			R = src.V;
+			G = t;
+			B = p;
+			break;
+		  case 1:
+			R = q;
+			G = src.V;
+			B = p;
+			break;
+		  case 2:
+			R = p;
+			G = src.V;
+			B = t;
+			break;
+		  case 3:
+			R = p;
+			G = q;
+			B = src.V;
+			break;
+		  case 4:
+			R = t;
+			G = p;
+			B = src.V;
+			break;
+		  case 5:
+			R = src.V;
+			G = p;
+			B = q;
+			break;
+		}
+	}
+	return [R, G, B];
+};
+dojo.gfx.Colorspace.prototype.RGB_to_HSL = function () {
+	var src = this.munge(&quot;RGB&quot;, arguments);
+	var min = Math.min(src.R, src.G, src.B);
+	var max = Math.max(src.R, src.G, src.B);
+	var delta = max - min;
+	var H = 0;
+	var S = 0;
+	var L = (min + max) / 2;
+	if ((L &gt; 0) &amp;&amp; (L &lt; 1)) {
+		S = delta / ((L &lt; 0.5) ? (2 * L) : (2 - 2 * L));
+	}
+	if (delta &gt; 0) {
+		if ((max == src.R) &amp;&amp; (max != src.G)) {
+			H += (src.G - src.B) / delta;
+		}
+		if ((max == src.G) &amp;&amp; (max != src.B)) {
+			H += (2 + (src.B - src.R) / delta);
+		}
+		if ((max == src.B) &amp;&amp; (max != src.R)) {
+			H += (4 + (src.R - src.G) / delta);
+		}
+		H *= 60;
+	}
+	H = (H == 0) ? 360 : H;
+	return [H, S, L];
+};
+dojo.gfx.Colorspace.prototype.HSL_to_RGB = function () {
+	var src = this.munge(&quot;HSL&quot;, arguments);
+	while (src.H &lt; 0) {
+		src.H += 360;
+	}
+	while (src.H &gt;= 360) {
+		src.H -= 360;
+	}
+	var R = 0;
+	var G = 0;
+	var B = 0;
+	if (src.H &lt; 120) {
+		R = (120 - src.H) / 60;
+		G = src.H / 60;
+		B = 0;
+	} else {
+		if (src.H &lt; 240) {
+			R = 0;
+			G = (240 - src.H) / 60;
+			B = (src.H - 120) / 60;
+		} else {
+			R = (src.H - 240) / 60;
+			G = 0;
+			B = (360 - src.H) / 60;
+		}
+	}
+	R = 2 * src.S * Math.min(R, 1) + (1 - src.S);
+	G = 2 * src.S * Math.min(G, 1) + (1 - src.S);
+	B = 2 * src.S * Math.min(B, 1) + (1 - src.S);
+	if (src.L &lt; 0.5) {
+		R = src.L * R;
+		G = src.L * G;
+		B = src.L * B;
+	} else {
+		R = (1 - src.L) * R + 2 * src.L - 1;
+		G = (1 - src.L) * G + 2 * src.L - 1;
+		B = (1 - src.L) * B + 2 * src.L - 1;
+	}
+	return [R, G, B];
+};
+

Added: tags/parley-0.55/root/static/magic/src/gfx/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,17 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.gfx.color&quot;, &quot;dojo.gfx.matrix&quot;, &quot;dojo.gfx.common&quot;]});
+dojo.requireIf(dojo.render.svg.capable, &quot;dojo.gfx.svg&quot;);
+dojo.requireIf(dojo.render.vml.capable, &quot;dojo.gfx.vml&quot;);
+dojo.provide(&quot;dojo.gfx.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/gfx/color/hsl.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/color/hsl.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/color/hsl.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,118 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.color.hsl&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.lang.extend(dojo.gfx.color.Color, {toHsl:function () {
+	return dojo.gfx.color.rgb2hsl(this.toRgb());
+}});
+dojo.gfx.color.rgb2hsl = function (r, g, b) {
+	if (dojo.lang.isArray(r)) {
+		b = r[2] || 0;
+		g = r[1] || 0;
+		r = r[0] || 0;
+	}
+	r /= 255;
+	g /= 255;
+	b /= 255;
+	var h = null;
+	var s = null;
+	var l = null;
+	var min = Math.min(r, g, b);
+	var max = Math.max(r, g, b);
+	var delta = max - min;
+	l = (min + max) / 2;
+	s = 0;
+	if ((l &gt; 0) &amp;&amp; (l &lt; 1)) {
+		s = delta / ((l &lt; 0.5) ? (2 * l) : (2 - 2 * l));
+	}
+	h = 0;
+	if (delta &gt; 0) {
+		if ((max == r) &amp;&amp; (max != g)) {
+			h += (g - b) / delta;
+		}
+		if ((max == g) &amp;&amp; (max != b)) {
+			h += (2 + (b - r) / delta);
+		}
+		if ((max == b) &amp;&amp; (max != r)) {
+			h += (4 + (r - g) / delta);
+		}
+		h *= 60;
+	}
+	h = (h == 0) ? 360 : Math.ceil((h / 360) * 255);
+	s = Math.ceil(s * 255);
+	l = Math.ceil(l * 255);
+	return [h, s, l];
+};
+dojo.gfx.color.hsl2rgb = function (h, s, l) {
+	if (dojo.lang.isArray(h)) {
+		l = h[2] || 0;
+		s = h[1] || 0;
+		h = h[0] || 0;
+	}
+	h = (h / 255) * 360;
+	if (h == 360) {
+		h = 0;
+	}
+	s = s / 255;
+	l = l / 255;
+	while (h &lt; 0) {
+		h += 360;
+	}
+	while (h &gt; 360) {
+		h -= 360;
+	}
+	var r, g, b;
+	if (h &lt; 120) {
+		r = (120 - h) / 60;
+		g = h / 60;
+		b = 0;
+	} else {
+		if (h &lt; 240) {
+			r = 0;
+			g = (240 - h) / 60;
+			b = (h - 120) / 60;
+		} else {
+			r = (h - 240) / 60;
+			g = 0;
+			b = (360 - h) / 60;
+		}
+	}
+	r = Math.min(r, 1);
+	g = Math.min(g, 1);
+	b = Math.min(b, 1);
+	r = 2 * s * r + (1 - s);
+	g = 2 * s * g + (1 - s);
+	b = 2 * s * b + (1 - s);
+	if (l &lt; 0.5) {
+		r = l * r;
+		g = l * g;
+		b = l * b;
+	} else {
+		r = (1 - l) * r + 2 * l - 1;
+		g = (1 - l) * g + 2 * l - 1;
+		b = (1 - l) * b + 2 * l - 1;
+	}
+	r = Math.ceil(r * 255);
+	g = Math.ceil(g * 255);
+	b = Math.ceil(b * 255);
+	return [r, g, b];
+};
+dojo.gfx.color.hsl2hex = function (h, s, l) {
+	var rgb = dojo.gfx.color.hsl2rgb(h, s, l);
+	return dojo.gfx.color.rgb2hex(rgb[0], rgb[1], rgb[2]);
+};
+dojo.gfx.color.hex2hsl = function (hex) {
+	var rgb = dojo.gfx.color.hex2rgb(hex);
+	return dojo.gfx.color.rgb2hsl(rgb[0], rgb[1], rgb[2]);
+};
+

Added: tags/parley-0.55/root/static/magic/src/gfx/color/hsv.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/color/hsv.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/color/hsv.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,210 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.color.hsv&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.lang.extend(dojo.gfx.color.Color, {toHsv:function () {
+	return dojo.gfx.color.rgb2hsv(this.toRgb());
+}});
+dojo.gfx.color.rgb2hsv = function (r, g, b, options) {
+	if (dojo.lang.isArray(r)) {
+		if (g) {
+			options = g;
+		}
+		b = r[2] || 0;
+		g = r[1] || 0;
+		r = r[0] || 0;
+	}
+	var opt = {inputRange:(options &amp;&amp; options.inputRange) ? options.inputRange : 255, outputRange:(options &amp;&amp; options.outputRange) ? options.outputRange : [255, 255, 255]};
+	var h = null;
+	var s = null;
+	var v = null;
+	switch (opt.inputRange) {
+	  case 1:
+		r = (r * 255);
+		g = (g * 255);
+		b = (b * 255);
+		break;
+	  case 100:
+		r = (r / 100) * 255;
+		g = (g / 100) * 255;
+		b = (b / 100) * 255;
+		break;
+	  default:
+		break;
+	}
+	var min = Math.min(r, g, b);
+	v = Math.max(r, g, b);
+	var delta = v - min;
+	s = (v == 0) ? 0 : delta / v;
+	if (s == 0) {
+		h = 0;
+	} else {
+		if (r == v) {
+			h = 60 * (g - b) / delta;
+		} else {
+			if (g == v) {
+				h = 120 + 60 * (b - r) / delta;
+			} else {
+				if (b == v) {
+					h = 240 + 60 * (r - g) / delta;
+				}
+			}
+		}
+		if (h &lt;= 0) {
+			h += 360;
+		}
+	}
+	switch (opt.outputRange[0]) {
+	  case 360:
+		break;
+	  case 100:
+		h = (h / 360) * 100;
+		break;
+	  case 1:
+		h = (h / 360);
+		break;
+	  default:
+		h = (h / 360) * 255;
+		break;
+	}
+	switch (opt.outputRange[1]) {
+	  case 100:
+		s = s * 100;
+	  case 1:
+		break;
+	  default:
+		s = s * 255;
+		break;
+	}
+	switch (opt.outputRange[2]) {
+	  case 100:
+		v = (v / 255) * 100;
+		break;
+	  case 1:
+		v = (v / 255);
+		break;
+	  default:
+		break;
+	}
+	h = dojo.math.round(h);
+	s = dojo.math.round(s);
+	v = dojo.math.round(v);
+	return [h, s, v];
+};
+dojo.gfx.color.hsv2rgb = function (h, s, v, options) {
+	if (dojo.lang.isArray(h)) {
+		if (s) {
+			options = s;
+		}
+		v = h[2] || 0;
+		s = h[1] || 0;
+		h = h[0] || 0;
+	}
+	var opt = {inputRange:(options &amp;&amp; options.inputRange) ? options.inputRange : [255, 255, 255], outputRange:(options &amp;&amp; options.outputRange) ? options.outputRange : 255};
+	switch (opt.inputRange[0]) {
+	  case 1:
+		h = h * 360;
+		break;
+	  case 100:
+		h = (h / 100) * 360;
+		break;
+	  case 360:
+		h = h;
+		break;
+	  default:
+		h = (h / 255) * 360;
+	}
+	if (h == 360) {
+		h = 0;
+	}
+	switch (opt.inputRange[1]) {
+	  case 100:
+		s /= 100;
+		break;
+	  case 255:
+		s /= 255;
+	}
+	switch (opt.inputRange[2]) {
+	  case 100:
+		v /= 100;
+		break;
+	  case 255:
+		v /= 255;
+	}
+	var r = null;
+	var g = null;
+	var b = null;
+	if (s == 0) {
+		r = v;
+		g = v;
+		b = v;
+	} else {
+		var hTemp = h / 60;
+		var i = Math.floor(hTemp);
+		var f = hTemp - i;
+		var p = v * (1 - s);
+		var q = v * (1 - (s * f));
+		var t = v * (1 - (s * (1 - f)));
+		switch (i) {
+		  case 0:
+			r = v;
+			g = t;
+			b = p;
+			break;
+		  case 1:
+			r = q;
+			g = v;
+			b = p;
+			break;
+		  case 2:
+			r = p;
+			g = v;
+			b = t;
+			break;
+		  case 3:
+			r = p;
+			g = q;
+			b = v;
+			break;
+		  case 4:
+			r = t;
+			g = p;
+			b = v;
+			break;
+		  case 5:
+			r = v;
+			g = p;
+			b = q;
+			break;
+		}
+	}
+	switch (opt.outputRange) {
+	  case 1:
+		r = dojo.math.round(r, 2);
+		g = dojo.math.round(g, 2);
+		b = dojo.math.round(b, 2);
+		break;
+	  case 100:
+		r = Math.round(r * 100);
+		g = Math.round(g * 100);
+		b = Math.round(b * 100);
+		break;
+	  default:
+		r = Math.round(r * 255);
+		g = Math.round(g * 255);
+		b = Math.round(b * 255);
+	}
+	return [r, g, b];
+};
+

Added: tags/parley-0.55/root/static/magic/src/gfx/color.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/color.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/color.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,150 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.gfx.color.Color = function (r, g, b, a) {
+	if (dojo.lang.isArray(r)) {
+		this.r = r[0];
+		this.g = r[1];
+		this.b = r[2];
+		this.a = r[3] || 1;
+	} else {
+		if (dojo.lang.isString(r)) {
+			var rgb = dojo.gfx.color.extractRGB(r);
+			this.r = rgb[0];
+			this.g = rgb[1];
+			this.b = rgb[2];
+			this.a = g || 1;
+		} else {
+			if (r instanceof dojo.gfx.color.Color) {
+				this.r = r.r;
+				this.b = r.b;
+				this.g = r.g;
+				this.a = r.a;
+			} else {
+				this.r = r;
+				this.g = g;
+				this.b = b;
+				this.a = a;
+			}
+		}
+	}
+};
+dojo.gfx.color.Color.fromArray = function (arr) {
+	return new dojo.gfx.color.Color(arr[0], arr[1], arr[2], arr[3]);
+};
+dojo.extend(dojo.gfx.color.Color, {toRgb:function (includeAlpha) {
+	if (includeAlpha) {
+		return this.toRgba();
+	} else {
+		return [this.r, this.g, this.b];
+	}
+}, toRgba:function () {
+	return [this.r, this.g, this.b, this.a];
+}, toHex:function () {
+	return dojo.gfx.color.rgb2hex(this.toRgb());
+}, toCss:function () {
+	return &quot;rgb(&quot; + this.toRgb().join() + &quot;)&quot;;
+}, toString:function () {
+	return this.toHex();
+}, blend:function (color, weight) {
+	var rgb = null;
+	if (dojo.lang.isArray(color)) {
+		rgb = color;
+	} else {
+		if (color instanceof dojo.gfx.color.Color) {
+			rgb = color.toRgb();
+		} else {
+			rgb = new dojo.gfx.color.Color(color).toRgb();
+		}
+	}
+	return dojo.gfx.color.blend(this.toRgb(), rgb, weight);
+}});
+dojo.gfx.color.named = {white:[255, 255, 255], black:[0, 0, 0], red:[255, 0, 0], green:[0, 255, 0], lime:[0, 255, 0], blue:[0, 0, 255], navy:[0, 0, 128], gray:[128, 128, 128], silver:[192, 192, 192]};
+dojo.gfx.color.blend = function (a, b, weight) {
+	if (typeof a == &quot;string&quot;) {
+		return dojo.gfx.color.blendHex(a, b, weight);
+	}
+	if (!weight) {
+		weight = 0;
+	}
+	weight = Math.min(Math.max(-1, weight), 1);
+	weight = ((weight + 1) / 2);
+	var c = [];
+	for (var x = 0; x &lt; 3; x++) {
+		c[x] = parseInt(b[x] + ((a[x] - b[x]) * weight));
+	}
+	return c;
+};
+dojo.gfx.color.blendHex = function (a, b, weight) {
+	return dojo.gfx.color.rgb2hex(dojo.gfx.color.blend(dojo.gfx.color.hex2rgb(a), dojo.gfx.color.hex2rgb(b), weight));
+};
+dojo.gfx.color.extractRGB = function (color) {
+	var hex = &quot;0123456789abcdef&quot;;
+	color = color.toLowerCase();
+	if (color.indexOf(&quot;rgb&quot;) == 0) {
+		var matches = color.match(/rgba*\((\d+), *(\d+), *(\d+)/i);
+		var ret = matches.splice(1, 3);
+		return ret;
+	} else {
+		var colors = dojo.gfx.color.hex2rgb(color);
+		if (colors) {
+			return colors;
+		} else {
+			return dojo.gfx.color.named[color] || [255, 255, 255];
+		}
+	}
+};
+dojo.gfx.color.hex2rgb = function (hex) {
+	var hexNum = &quot;0123456789ABCDEF&quot;;
+	var rgb = new Array(3);
+	if (hex.indexOf(&quot;#&quot;) == 0) {
+		hex = hex.substring(1);
+	}
+	hex = hex.toUpperCase();
+	if (hex.replace(new RegExp(&quot;[&quot; + hexNum + &quot;]&quot;, &quot;g&quot;), &quot;&quot;) != &quot;&quot;) {
+		return null;
+	}
+	if (hex.length == 3) {
+		rgb[0] = hex.charAt(0) + hex.charAt(0);
+		rgb[1] = hex.charAt(1) + hex.charAt(1);
+		rgb[2] = hex.charAt(2) + hex.charAt(2);
+	} else {
+		rgb[0] = hex.substring(0, 2);
+		rgb[1] = hex.substring(2, 4);
+		rgb[2] = hex.substring(4);
+	}
+	for (var i = 0; i &lt; rgb.length; i++) {
+		rgb[i] = hexNum.indexOf(rgb[i].charAt(0)) * 16 + hexNum.indexOf(rgb[i].charAt(1));
+	}
+	return rgb;
+};
+dojo.gfx.color.rgb2hex = function (r, g, b) {
+	if (dojo.lang.isArray(r)) {
+		g = r[1] || 0;
+		b = r[2] || 0;
+		r = r[0] || 0;
+	}
+	var ret = dojo.lang.map([r, g, b], function (x) {
+		x = new Number(x);
+		var s = x.toString(16);
+		while (s.length &lt; 2) {
+			s = &quot;0&quot; + s;
+		}
+		return s;
+	});
+	ret.unshift(&quot;#&quot;);
+	return ret.join(&quot;&quot;);
+};
+

Added: tags/parley-0.55/root/static/magic/src/gfx/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,63 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.common&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.lang.mixin(dojo.gfx, {defaultPath:{type:&quot;path&quot;, path:&quot;&quot;}, defaultPolyline:{type:&quot;polyline&quot;, points:[]}, defaultRect:{type:&quot;rect&quot;, x:0, y:0, width:100, height:100, r:0}, defaultEllipse:{type:&quot;ellipse&quot;, cx:0, cy:0, rx:200, ry:100}, defaultCircle:{type:&quot;circle&quot;, cx:0, cy:0, r:100}, defaultLine:{type:&quot;line&quot;, x1:0, y1:0, x2:100, y2:100}, defaultImage:{type:&quot;image&quot;, width:0, height:0, src:&quot;&quot;}, defaultStroke:{color:&quot;black&quot;, width:1, cap:&quot;butt&quot;, join:4}, defaultLinearGradient:{type:&quot;linear&quot;, x1:0, y1:0, x2:100, y2:100, colors:[{offset:0, color:&quot;black&quot;}, {offset:1, color:&quot;white&quot;}]}, defaultRadialGradient:{type:&quot;radial&quot;, cx:0, cy:0, r:100, colors:[{offset:0, color:&quot;black&quot;}, {offset:1, color:&quot;white&quot;}]}, defaultPattern:{type:&quot;pattern&quot;, x:0, y:0, width:0, height:0, src:&quot;&quot;}, normalizeColor:function (color) {
+	return (color instanceof dojo.gfx.color.Color) ? color : new dojo.gfx.color.Color(color);
+}, normalizeParameters:function (existed, update) {
+	if (update) {
+		var empty = {};
+		for (var x in existed) {
+			if (x in update &amp;&amp; !(x in empty)) {
+				existed[x] = update[x];
+			}
+		}
+	}
+	return existed;
+}, makeParameters:function (defaults, update) {
+	if (!update) {
+		return dojo.lang.shallowCopy(defaults, true);
+	}
+	var result = {};
+	for (var i in defaults) {
+		if (!(i in result)) {
+			result[i] = dojo.lang.shallowCopy((i in update) ? update[i] : defaults[i], true);
+		}
+	}
+	return result;
+}, formatNumber:function (x, addSpace) {
+	var val = x.toString();
+	if (val.indexOf(&quot;e&quot;) &gt;= 0) {
+		val = x.toFixed(4);
+	} else {
+		var point = val.indexOf(&quot;.&quot;);
+		if (point &gt;= 0 &amp;&amp; val.length - point &gt; 5) {
+			val = x.toFixed(4);
+		}
+	}
+	if (x &lt; 0) {
+		return val;
+	}
+	return addSpace ? &quot; &quot; + val : val;
+}, pathRegExp:/([A-Za-z]+)|(\d+(\.\d+)?)|(\.\d+)|(-\d+(\.\d+)?)|(-\.\d+)/g});
+dojo.declare(&quot;dojo.gfx.Surface&quot;, null, {initializer:function () {
+	this.rawNode = null;
+}, getEventSource:function () {
+	return this.rawNode;
+}});
+dojo.declare(&quot;dojo.gfx.Point&quot;, null, {});
+dojo.declare(&quot;dojo.gfx.Rectangle&quot;, null, {});
+

Added: tags/parley-0.55/root/static/magic/src/gfx/matrix.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/matrix.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/matrix.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,148 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.matrix&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.math.*&quot;);
+dojo.gfx.matrix.Matrix2D = function (arg) {
+	if (arg) {
+		if (arg instanceof Array) {
+			if (arg.length &gt; 0) {
+				var m = dojo.gfx.matrix.normalize(arg[0]);
+				for (var i = 1; i &lt; arg.length; ++i) {
+					var l = m;
+					var r = dojo.gfx.matrix.normalize(arg[i]);
+					m = new dojo.gfx.matrix.Matrix2D();
+					m.xx = l.xx * r.xx + l.xy * r.yx;
+					m.xy = l.xx * r.xy + l.xy * r.yy;
+					m.yx = l.yx * r.xx + l.yy * r.yx;
+					m.yy = l.yx * r.xy + l.yy * r.yy;
+					m.dx = l.xx * r.dx + l.xy * r.dy + l.dx;
+					m.dy = l.yx * r.dx + l.yy * r.dy + l.dy;
+				}
+				dojo.mixin(this, m);
+			}
+		} else {
+			dojo.mixin(this, arg);
+		}
+	}
+};
+dojo.extend(dojo.gfx.matrix.Matrix2D, {xx:1, xy:0, yx:0, yy:1, dx:0, dy:0});
+dojo.mixin(dojo.gfx.matrix, {identity:new dojo.gfx.matrix.Matrix2D(), flipX:new dojo.gfx.matrix.Matrix2D({xx:-1}), flipY:new dojo.gfx.matrix.Matrix2D({yy:-1}), flipXY:new dojo.gfx.matrix.Matrix2D({xx:-1, yy:-1}), translate:function (a, b) {
+	if (arguments.length &gt; 1) {
+		return new dojo.gfx.matrix.Matrix2D({dx:a, dy:b});
+	}
+	return new dojo.gfx.matrix.Matrix2D({dx:a.x, dy:a.y});
+}, scale:function (a, b) {
+	if (arguments.length &gt; 1) {
+		return new dojo.gfx.matrix.Matrix2D({xx:a, yy:b});
+	}
+	if (typeof a == &quot;number&quot;) {
+		return new dojo.gfx.matrix.Matrix2D({xx:a, yy:a});
+	}
+	return new dojo.gfx.matrix.Matrix2D({xx:a.x, yy:a.y});
+}, rotate:function (angle) {
+	var c = Math.cos(angle);
+	var s = Math.sin(angle);
+	return new dojo.gfx.matrix.Matrix2D({xx:c, xy:s, yx:-s, yy:c});
+}, rotateg:function (degree) {
+	return dojo.gfx.matrix.rotate(dojo.math.degToRad(degree));
+}, skewX:function (angle) {
+	return new dojo.gfx.matrix.Matrix2D({xy:Math.tan(angle)});
+}, skewXg:function (degree) {
+	return dojo.gfx.matrix.skewX(dojo.math.degToRad(degree));
+}, skewY:function (angle) {
+	return new dojo.gfx.matrix.Matrix2D({yx:-Math.tan(angle)});
+}, skewYg:function (degree) {
+	return dojo.gfx.matrix.skewY(dojo.math.degToRad(degree));
+}, normalize:function (matrix) {
+	return (matrix instanceof dojo.gfx.matrix.Matrix2D) ? matrix : new dojo.gfx.matrix.Matrix2D(matrix);
+}, clone:function (matrix) {
+	var obj = new dojo.gfx.matrix.Matrix2D();
+	for (var i in matrix) {
+		if (typeof (matrix[i]) == &quot;number&quot; &amp;&amp; typeof (obj[i]) == &quot;number&quot; &amp;&amp; obj[i] != matrix[i]) {
+			obj[i] = matrix[i];
+		}
+	}
+	return obj;
+}, invert:function (matrix) {
+	var m = dojo.gfx.matrix.normalize(matrix);
+	var D = m.xx * m.yy - m.xy * m.yx;
+	var M = new dojo.gfx.matrix.Matrix2D({xx:m.yy / D, xy:-m.xy / D, yx:-m.yx / D, yy:m.xx / D, dx:(m.yx * m.dy - m.yy * m.dx) / D, dy:(m.xy * m.dx - m.xx * m.dy) / D});
+	return M;
+}, _multiplyPoint:function (m, x, y) {
+	return {x:m.xx * x + m.xy * y + m.dx, y:m.yx * x + m.yy * y + m.dy};
+}, multiplyPoint:function (matrix, a, b) {
+	var m = dojo.gfx.matrix.normalize(matrix);
+	if (typeof a == &quot;number&quot; &amp;&amp; typeof b == &quot;number&quot;) {
+		return dojo.gfx.matrix._multiplyPoint(m, a, b);
+	}
+	return dojo.gfx.matrix._multiplyPoint(m, a.x, a.y);
+}, multiply:function (matrix) {
+	var m = dojo.gfx.matrix.normalize(matrix);
+	for (var i = 1; i &lt; arguments.length; ++i) {
+		var l = m;
+		var r = dojo.gfx.matrix.normalize(arguments[i]);
+		m = new dojo.gfx.matrix.Matrix2D();
+		m.xx = l.xx * r.xx + l.xy * r.yx;
+		m.xy = l.xx * r.xy + l.xy * r.yy;
+		m.yx = l.yx * r.xx + l.yy * r.yx;
+		m.yy = l.yx * r.xy + l.yy * r.yy;
+		m.dx = l.xx * r.dx + l.xy * r.dy + l.dx;
+		m.dy = l.yx * r.dx + l.yy * r.dy + l.dy;
+	}
+	return m;
+}, _sandwich:function (m, x, y) {
+	return dojo.gfx.matrix.multiply(dojo.gfx.matrix.translate(x, y), m, dojo.gfx.matrix.translate(-x, -y));
+}, scaleAt:function (a, b, c, d) {
+	switch (arguments.length) {
+	  case 4:
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.scale(a, b), c, d);
+	  case 3:
+		if (typeof c == &quot;number&quot;) {
+			return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.scale(a), b, c);
+		}
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.scale(a, b), c.x, c.y);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.scale(a), b.x, b.y);
+}, rotateAt:function (angle, a, b) {
+	if (arguments.length &gt; 2) {
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.rotate(angle), a, b);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.rotate(angle), a.x, a.y);
+}, rotategAt:function (degree, a, b) {
+	if (arguments.length &gt; 2) {
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.rotateg(degree), a, b);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.rotateg(degree), a.x, a.y);
+}, skewXAt:function (angle, a, b) {
+	if (arguments.length &gt; 2) {
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewX(angle), a, b);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewX(angle), a.x, a.y);
+}, skewXgAt:function (degree, a, b) {
+	if (arguments.length &gt; 2) {
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewXg(degree), a, b);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewXg(degree), a.x, a.y);
+}, skewYAt:function (angle, a, b) {
+	if (arguments.length &gt; 2) {
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewY(angle), a, b);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewY(angle), a.x, a.y);
+}, skewYgAt:function (degree, a, b) {
+	if (arguments.length &gt; 2) {
+		return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewYg(degree), a, b);
+	}
+	return dojo.gfx.matrix._sandwich(dojo.gfx.matrix.skewYg(degree), a.x, a.y);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/gfx/path.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/path.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/path.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,268 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.path&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.gfx.shape&quot;);
+dojo.declare(&quot;dojo.gfx.path.Path&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultPath, true);
+	this.segments = [];
+	this.absolute = true;
+	this.last = {};
+	this.attach(rawNode);
+}, setAbsoluteMode:function (mode) {
+	this.absolute = typeof (mode) == &quot;string&quot; ? (mode == &quot;absolute&quot;) : mode;
+	return this;
+}, getAbsoluteMode:function () {
+	return this.absolute;
+}, getBoundingBox:function () {
+	return &quot;l&quot; in this.bbox ? {x:this.bbox.l, y:this.bbox.t, width:this.bbox.r - this.bbox.l, height:this.bbox.b - this.bbox.t} : null;
+}, getLastPosition:function () {
+	return &quot;x&quot; in this.last ? this.last : null;
+}, _updateBBox:function (x, y) {
+	if (&quot;l&quot; in this.bbox) {
+		if (this.bbox.l &gt; x) {
+			this.bbox.l = x;
+		}
+		if (this.bbox.r &lt; x) {
+			this.bbox.r = x;
+		}
+		if (this.bbox.t &gt; y) {
+			this.bbox.t = y;
+		}
+		if (this.bbox.b &lt; y) {
+			this.bbox.b = y;
+		}
+	} else {
+		this.bbox = {l:x, b:y, r:x, t:y};
+	}
+}, _updateWithSegment:function (segment) {
+	var n = segment.args;
+	var l = n.length;
+	switch (segment.action) {
+	  case &quot;M&quot;:
+	  case &quot;L&quot;:
+	  case &quot;C&quot;:
+	  case &quot;S&quot;:
+	  case &quot;Q&quot;:
+	  case &quot;T&quot;:
+		for (var i = 0; i &lt; l; i += 2) {
+			this._updateBBox(this.bbox, n[i], n[i + 1]);
+		}
+		this.last.x = n[l - 2];
+		this.last.y = n[l - 1];
+		this.absolute = true;
+		break;
+	  case &quot;H&quot;:
+		for (var i = 0; i &lt; l; ++i) {
+			this._updateBBox(this.bbox, n[i], this.last.y);
+		}
+		this.last.x = n[l - 1];
+		this.absolute = true;
+		break;
+	  case &quot;V&quot;:
+		for (var i = 0; i &lt; l; ++i) {
+			this._updateBBox(this.bbox, this.last.x, n[i]);
+		}
+		this.last.y = n[l - 1];
+		this.absolute = true;
+		break;
+	  case &quot;m&quot;:
+		var start = 0;
+		if (!(&quot;x&quot; in this.last)) {
+			this._updateBBox(this.bbox, this.last.x = n[0], this.last.y = n[1]);
+			start = 2;
+		}
+		for (var i = start; i &lt; l; i += 2) {
+			this._updateBBox(this.bbox, this.last.x += n[i], this.last.y += n[i + 1]);
+		}
+		this.absolute = false;
+		break;
+	  case &quot;l&quot;:
+	  case &quot;t&quot;:
+		for (var i = 0; i &lt; l; i += 2) {
+			this._updateBBox(this.bbox, this.last.x += n[i], this.last.y += n[i + 1]);
+		}
+		this.absolute = false;
+		break;
+	  case &quot;h&quot;:
+		for (var i = 0; i &lt; l; ++i) {
+			this._updateBBox(this.bbox, this.last.x += n[i], this.last.y);
+		}
+		this.absolute = false;
+		break;
+	  case &quot;v&quot;:
+		for (var i = 0; i &lt; l; ++i) {
+			this._updateBBox(this.bbox, this.last.x, this.last.y += n[i]);
+		}
+		this.absolute = false;
+		break;
+	  case &quot;c&quot;:
+		for (var i = 0; i &lt; l; i += 6) {
+			this._updateBBox(this.bbox, this.last.x + n[i], this.last.y + n[i + 1]);
+			this._updateBBox(this.bbox, this.last.x + n[i + 2], this.last.y + n[i + 3]);
+			this._updateBBox(this.bbox, this.last.x += n[i + 4], this.last.y += n[i + 5]);
+		}
+		this.absolute = false;
+		break;
+	  case &quot;s&quot;:
+	  case &quot;q&quot;:
+		for (var i = 0; i &lt; l; i += 4) {
+			this._updateBBox(this.bbox, this.last.x + n[i], this.last.y + n[i + 1]);
+			this._updateBBox(this.bbox, this.last.x += n[i + 2], this.last.y += n[i + 3]);
+		}
+		this.absolute = false;
+		break;
+	  case &quot;A&quot;:
+		for (var i = 0; i &lt; l; i += 7) {
+			this._updateBBox(this.bbox, n[i + 5], n[i + 6]);
+		}
+		this.last.x = n[l - 2];
+		this.last.y = n[l - 1];
+		this.absolute = true;
+		break;
+	  case &quot;a&quot;:
+		for (var i = 0; i &lt; l; i += 7) {
+			this._updateBBox(this.bbox, this.last.x += n[i + 5], this.last.y += n[i + 6]);
+		}
+		this.absolute = false;
+		break;
+	}
+	var path = [segment.action];
+	for (var i = 0; i &lt; l; ++i) {
+		path.push(dojo.gfx.formatNumber(n[i], true));
+	}
+	if (typeof (this.shape.path) == &quot;string&quot;) {
+		this.shape.path += path.join(&quot;&quot;);
+	} else {
+		this.shape.path = this.shape.path.concat(path);
+	}
+}, _validSegments:{m:2, l:2, h:1, v:1, c:6, s:4, q:4, t:2, a:7, z:0}, _pushSegment:function (action, args) {
+	var group = this._validSegments[action.toLowerCase()];
+	if (typeof (group) == &quot;number&quot;) {
+		if (group) {
+			if (args.length &gt;= group) {
+				var segment = {action:action, args:args.slice(0, args.length - args.length % group)};
+				this.segments.push(segment);
+				this._updateWithSegment(segment);
+			}
+		} else {
+			var segment = {action:action, args:[]};
+			this.segments.push(segment);
+			this._updateWithSegment(segment);
+		}
+	}
+}, _collectArgs:function (array, args) {
+	for (var i = 0; i &lt; args.length; ++i) {
+		var t = args[i];
+		if (typeof (t) == &quot;boolean&quot;) {
+			array.push(t ? 1 : 0);
+		} else {
+			if (typeof (t) == &quot;number&quot;) {
+				array.push(t);
+			} else {
+				if (t instanceof Array) {
+					this._collectArgs(array, t);
+				} else {
+					if (&quot;x&quot; in t &amp;&amp; &quot;y&quot; in t) {
+						array.push(t.x);
+						array.push(t.y);
+					}
+				}
+			}
+		}
+	}
+}, moveTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;M&quot; : &quot;m&quot;, args);
+	return this;
+}, lineTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;L&quot; : &quot;l&quot;, args);
+	return this;
+}, hLineTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;H&quot; : &quot;h&quot;, args);
+	return this;
+}, vLineTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;V&quot; : &quot;v&quot;, args);
+	return this;
+}, curveTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;C&quot; : &quot;c&quot;, args);
+	return this;
+}, smoothCurveTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;S&quot; : &quot;s&quot;, args);
+	return this;
+}, qCurveTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;Q&quot; : &quot;q&quot;, args);
+	return this;
+}, qSmoothCurveTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	this._pushSegment(this.absolute ? &quot;T&quot; : &quot;t&quot;, args);
+	return this;
+}, arcTo:function () {
+	var args = [];
+	this._collectArgs(args, arguments);
+	for (var i = 2; i &lt; args.length; i += 7) {
+		args[i] = -args[i];
+	}
+	this._pushSegment(this.absolute ? &quot;A&quot; : &quot;a&quot;, args);
+	return this;
+}, closePath:function () {
+	this._pushSegment(&quot;Z&quot;, []);
+	return this;
+}, _setPath:function (path) {
+	var p = path.match(dojo.gfx.pathRegExp);
+	this.segments = [];
+	this.absolute = true;
+	this.bbox = {};
+	this.last = {};
+	if (!p) {
+		return;
+	}
+	var action = &quot;&quot;;
+	var args = [];
+	for (var i = 0; i &lt; p.length; ++i) {
+		var t = p[i];
+		var x = parseFloat(t);
+		if (isNaN(x)) {
+			if (action) {
+				this._pushSegment(action, args);
+			}
+			args = [];
+			action = t;
+		} else {
+			args.push(x);
+		}
+	}
+	this._pushSegment(action, args);
+}, setShape:function (newShape) {
+	this.shape = dojo.gfx.makeParameters(this.shape, typeof (newShape) == &quot;string&quot; ? {path:newShape} : newShape);
+	var path = this.shape.path;
+	this.shape.path = [];
+	this._setPath(path);
+	this.shape.path = this.shape.path.join(&quot;&quot;);
+	return this;
+}, _2PI:Math.PI * 2});
+

Added: tags/parley-0.55/root/static/magic/src/gfx/shape.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/shape.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/shape.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,176 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.shape&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.gfx.common&quot;);
+dojo.declare(&quot;dojo.gfx.Shape&quot;, null, {initializer:function () {
+	this.rawNode = null;
+	this.shape = null;
+	this.matrix = null;
+	this.fillStyle = null;
+	this.strokeStyle = null;
+	this.bbox = null;
+	this.parent = null;
+	this.parentMatrix = null;
+}, getNode:function () {
+	return this.rawNode;
+}, getShape:function () {
+	return this.shape;
+}, getTransform:function () {
+	return this.matrix;
+}, getFill:function () {
+	return this.fillStyle;
+}, getStroke:function () {
+	return this.strokeStyle;
+}, getParent:function () {
+	return this.parent;
+}, getBoundingBox:function () {
+	return this.bbox;
+}, getEventSource:function () {
+	return this.rawNode;
+}, setShape:function (shape) {
+	return this;
+}, setFill:function (fill) {
+	return this;
+}, setStroke:function (stroke) {
+	return this;
+}, moveToFront:function () {
+	return this;
+}, moveToBack:function () {
+	return this;
+}, setTransform:function (matrix) {
+	this.matrix = dojo.gfx.matrix.clone(matrix ? dojo.gfx.matrix.normalize(matrix) : dojo.gfx.identity, true);
+	return this._applyTransform();
+}, applyRightTransform:function (matrix) {
+	return matrix ? this.setTransform([this.matrix, matrix]) : this;
+}, applyLeftTransform:function (matrix) {
+	return matrix ? this.setTransform([matrix, this.matrix]) : this;
+}, applyTransform:function (matrix) {
+	return matrix ? this.setTransform([this.matrix, matrix]) : this;
+}, remove:function (silently) {
+	if (this.parent) {
+		this.parent.remove(this, silently);
+	}
+	return this;
+}, _setParent:function (parent, matrix) {
+	this.parent = parent;
+	return this._updateParentMatrix(matrix);
+}, _updateParentMatrix:function (matrix) {
+	this.parentMatrix = matrix ? dojo.gfx.matrix.clone(matrix) : null;
+	return this._applyTransform();
+}, _getRealMatrix:function () {
+	return this.parentMatrix ? new dojo.gfx.matrix.Matrix2D([this.parentMatrix, this.matrix]) : this.matrix;
+}});
+dojo.declare(&quot;dojo.gfx.shape.VirtualGroup&quot;, dojo.gfx.Shape, {initializer:function () {
+	this.children = [];
+}, add:function (shape) {
+	var oldParent = shape.getParent();
+	if (oldParent) {
+		oldParent.remove(shape, true);
+	}
+	this.children.push(shape);
+	return shape._setParent(this, this._getRealMatrix());
+}, remove:function (shape, silently) {
+	for (var i = 0; i &lt; this.children.length; ++i) {
+		if (this.children[i] == shape) {
+			if (silently) {
+			} else {
+				shape._setParent(null, null);
+			}
+			this.children.splice(i, 1);
+			break;
+		}
+	}
+	return this;
+}, _applyTransform:function () {
+	var matrix = this._getRealMatrix();
+	for (var i = 0; i &lt; this.children.length; ++i) {
+		this.children[i]._updateParentMatrix(matrix);
+	}
+	return this;
+}});
+dojo.declare(&quot;dojo.gfx.shape.Rect&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultRect, true);
+	this.attach(rawNode);
+}, getBoundingBox:function () {
+	return this.shape;
+}});
+dojo.declare(&quot;dojo.gfx.shape.Ellipse&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultEllipse, true);
+	this.attach(rawNode);
+}, getBoundingBox:function () {
+	if (!this.bbox) {
+		var shape = this.shape;
+		this.bbox = {x:shape.cx - shape.rx, y:shape.cy - shape.ry, width:2 * shape.rx, height:2 * shape.ry};
+	}
+	return this.bbox;
+}});
+dojo.declare(&quot;dojo.gfx.shape.Circle&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultCircle, true);
+	this.attach(rawNode);
+}, getBoundingBox:function () {
+	if (!this.bbox) {
+		var shape = this.shape;
+		this.bbox = {x:shape.cx - shape.r, y:shape.cy - shape.r, width:2 * shape.r, height:2 * shape.r};
+	}
+	return this.bbox;
+}});
+dojo.declare(&quot;dojo.gfx.shape.Line&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultLine, true);
+	this.attach(rawNode);
+}, getBoundingBox:function () {
+	if (!this.bbox) {
+		var shape = this.shape;
+		this.bbox = {x:Math.min(shape.x1, shape.x2), y:Math.min(shape.y1, shape.y2), width:Math.abs(shape.x2 - shape.x1), height:Math.abs(shape.y2 - shape.y1)};
+	}
+	return this.bbox;
+}});
+dojo.declare(&quot;dojo.gfx.shape.Polyline&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultPolyline, true);
+	this.attach(rawNode);
+}, getBoundingBox:function () {
+	if (!this.bbox &amp;&amp; this.shape.points.length) {
+		var p = this.shape.points;
+		var l = p.length;
+		var t = p[0];
+		var bbox = {l:t.x, t:t.y, r:t.x, b:t.y};
+		for (var i = 1; i &lt; l; ++i) {
+			t = p[i];
+			if (bbox.l &gt; t.x) {
+				bbox.l = t.x;
+			}
+			if (bbox.r &lt; t.x) {
+				bbox.r = t.x;
+			}
+			if (bbox.t &gt; t.y) {
+				bbox.t = t.y;
+			}
+			if (bbox.b &lt; t.y) {
+				bbox.b = t.y;
+			}
+		}
+		this.bbox = {x:bbox.l, y:bbox.t, width:bbox.r - bbox.l, height:bbox.b - bbox.t};
+	}
+	return this.bbox;
+}});
+dojo.declare(&quot;dojo.gfx.shape.Image&quot;, dojo.gfx.Shape, {initializer:function (rawNode) {
+	this.shape = dojo.lang.shallowCopy(dojo.gfx.defaultImage, true);
+	this.attach(rawNode);
+}, getBoundingBox:function () {
+	if (!this.bbox) {
+		var shape = this.shape;
+		this.bbox = {x:0, y:0, width:shape.width, height:shape.height};
+	}
+	return this.bbox;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/gfx/svg.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/svg.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/svg.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,473 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.svg&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.svg&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.gfx.common&quot;);
+dojo.require(&quot;dojo.gfx.shape&quot;);
+dojo.require(&quot;dojo.gfx.path&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.gfx.svg&quot;);
+dojo.gfx.svg.getRef = function (fill) {
+	if (!fill || fill == &quot;none&quot;) {
+		return null;
+	}
+	if (fill.match(/^url\(#.+\)$/)) {
+		return dojo.byId(fill.slice(5, -1));
+	}
+	if (dojo.render.html.opera &amp;&amp; fill.match(/^#dj_unique_.+$/)) {
+		return dojo.byId(fill.slice(1));
+	}
+	return null;
+};
+dojo.lang.extend(dojo.gfx.Shape, {setFill:function (fill) {
+	if (!fill) {
+		this.fillStyle = null;
+		this.rawNode.setAttribute(&quot;fill&quot;, &quot;none&quot;);
+		this.rawNode.setAttribute(&quot;fill-opacity&quot;, 0);
+		return this;
+	}
+	if (typeof (fill) == &quot;object&quot; &amp;&amp; &quot;type&quot; in fill) {
+		switch (fill.type) {
+		  case &quot;linear&quot;:
+			var f = dojo.gfx.makeParameters(dojo.gfx.defaultLinearGradient, fill);
+			var gradient = this._setFillObject(f, &quot;linearGradient&quot;);
+			dojo.lang.forEach([&quot;x1&quot;, &quot;y1&quot;, &quot;x2&quot;, &quot;y2&quot;], function (x) {
+				gradient.setAttribute(x, f[x].toFixed(8));
+			});
+			break;
+		  case &quot;radial&quot;:
+			var f = dojo.gfx.makeParameters(dojo.gfx.defaultRadialGradient, fill);
+			var gradient = this._setFillObject(f, &quot;radialGradient&quot;);
+			dojo.lang.forEach([&quot;cx&quot;, &quot;cy&quot;, &quot;r&quot;], function (x) {
+				gradient.setAttribute(x, f[x].toFixed(8));
+			});
+			break;
+		  case &quot;pattern&quot;:
+			var f = dojo.gfx.makeParameters(dojo.gfx.defaultPattern, fill);
+			var pattern = this._setFillObject(f, &quot;pattern&quot;);
+			dojo.lang.forEach([&quot;x&quot;, &quot;y&quot;, &quot;width&quot;, &quot;height&quot;], function (x) {
+				pattern.setAttribute(x, f[x].toFixed(8));
+			});
+			break;
+		}
+		return this;
+	}
+	var f = dojo.gfx.normalizeColor(fill);
+	this.fillStyle = f;
+	this.rawNode.setAttribute(&quot;fill&quot;, f.toCss());
+	this.rawNode.setAttribute(&quot;fill-opacity&quot;, f.a);
+	return this;
+}, setStroke:function (stroke) {
+	if (!stroke) {
+		this.strokeStyle = null;
+		this.rawNode.setAttribute(&quot;stroke&quot;, &quot;none&quot;);
+		this.rawNode.setAttribute(&quot;stroke-opacity&quot;, 0);
+		return this;
+	}
+	this.strokeStyle = dojo.gfx.makeParameters(dojo.gfx.defaultStroke, stroke);
+	this.strokeStyle.color = dojo.gfx.normalizeColor(this.strokeStyle.color);
+	var s = this.strokeStyle;
+	var rn = this.rawNode;
+	if (s) {
+		rn.setAttribute(&quot;stroke&quot;, s.color.toCss());
+		rn.setAttribute(&quot;stroke-opacity&quot;, s.color.a);
+		rn.setAttribute(&quot;stroke-width&quot;, s.width);
+		rn.setAttribute(&quot;stroke-linecap&quot;, s.cap);
+		if (typeof (s.join) == &quot;number&quot;) {
+			rn.setAttribute(&quot;stroke-linejoin&quot;, &quot;miter&quot;);
+			rn.setAttribute(&quot;stroke-miterlimit&quot;, s.join);
+		} else {
+			rn.setAttribute(&quot;stroke-linejoin&quot;, s.join);
+		}
+	}
+	return this;
+}, _setFillObject:function (f, nodeType) {
+	var def_elems = this.rawNode.parentNode.getElementsByTagName(&quot;defs&quot;);
+	if (def_elems.length == 0) {
+		return this;
+	}
+	this.fillStyle = f;
+	var defs = def_elems[0];
+	var fill = this.rawNode.getAttribute(&quot;fill&quot;);
+	var ref = dojo.gfx.svg.getRef(fill);
+	if (ref) {
+		fill = ref;
+		if (fill.tagName.toLowerCase() != nodeType.toLowerCase()) {
+			var id = fill.id;
+			fill.parentNode.removeChild(fill);
+			fill = document.createElementNS(dojo.svg.xmlns.svg, nodeType);
+			fill.setAttribute(&quot;id&quot;, id);
+			defs.appendChild(fill);
+		} else {
+			while (fill.childNodes.length) {
+				fill.removeChild(fill.lastChild);
+			}
+		}
+	} else {
+		fill = document.createElementNS(dojo.svg.xmlns.svg, nodeType);
+		fill.setAttribute(&quot;id&quot;, dojo.dom.getUniqueId());
+		defs.appendChild(fill);
+	}
+	if (nodeType == &quot;pattern&quot;) {
+		fill.setAttribute(&quot;patternUnits&quot;, &quot;userSpaceOnUse&quot;);
+		var img = document.createElementNS(dojo.svg.xmlns.svg, &quot;image&quot;);
+		img.setAttribute(&quot;x&quot;, 0);
+		img.setAttribute(&quot;y&quot;, 0);
+		img.setAttribute(&quot;width&quot;, f.width.toFixed(8));
+		img.setAttribute(&quot;height&quot;, f.height.toFixed(8));
+		img.setAttributeNS(dojo.svg.xmlns.xlink, &quot;href&quot;, f.src);
+		fill.appendChild(img);
+	} else {
+		fill.setAttribute(&quot;gradientUnits&quot;, &quot;userSpaceOnUse&quot;);
+		for (var i = 0; i &lt; f.colors.length; ++i) {
+			f.colors[i].color = dojo.gfx.normalizeColor(f.colors[i].color);
+			var t = document.createElementNS(dojo.svg.xmlns.svg, &quot;stop&quot;);
+			t.setAttribute(&quot;offset&quot;, f.colors[i].offset.toFixed(8));
+			t.setAttribute(&quot;stop-color&quot;, f.colors[i].color.toCss());
+			fill.appendChild(t);
+		}
+	}
+	this.rawNode.setAttribute(&quot;fill&quot;, &quot;url(#&quot; + fill.getAttribute(&quot;id&quot;) + &quot;)&quot;);
+	this.rawNode.removeAttribute(&quot;fill-opacity&quot;);
+	return fill;
+}, _applyTransform:function () {
+	var matrix = this._getRealMatrix();
+	if (matrix) {
+		var tm = this.matrix;
+		this.rawNode.setAttribute(&quot;transform&quot;, &quot;matrix(&quot; + tm.xx.toFixed(8) + &quot;,&quot; + tm.yx.toFixed(8) + &quot;,&quot; + tm.xy.toFixed(8) + &quot;,&quot; + tm.yy.toFixed(8) + &quot;,&quot; + tm.dx.toFixed(8) + &quot;,&quot; + tm.dy.toFixed(8) + &quot;)&quot;);
+	} else {
+		this.rawNode.removeAttribute(&quot;transform&quot;);
+	}
+	return this;
+}, setRawNode:function (rawNode) {
+	with (rawNode) {
+		setAttribute(&quot;fill&quot;, &quot;none&quot;);
+		setAttribute(&quot;fill-opacity&quot;, 0);
+		setAttribute(&quot;stroke&quot;, &quot;none&quot;);
+		setAttribute(&quot;stroke-opacity&quot;, 0);
+		setAttribute(&quot;stroke-width&quot;, 1);
+		setAttribute(&quot;stroke-linecap&quot;, &quot;butt&quot;);
+		setAttribute(&quot;stroke-linejoin&quot;, &quot;miter&quot;);
+		setAttribute(&quot;stroke-miterlimit&quot;, 4);
+	}
+	this.rawNode = rawNode;
+}, moveToFront:function () {
+	this.rawNode.parentNode.appendChild(this.rawNode);
+	return this;
+}, moveToBack:function () {
+	this.rawNode.parentNode.insertBefore(this.rawNode, this.rawNode.parentNode.firstChild);
+	return this;
+}, setShape:function (newShape) {
+	this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	for (var i in this.shape) {
+		if (i != &quot;type&quot;) {
+			this.rawNode.setAttribute(i, this.shape[i]);
+		}
+	}
+	return this;
+}, attachFill:function (rawNode) {
+	var fillStyle = null;
+	if (rawNode) {
+		var fill = rawNode.getAttribute(&quot;fill&quot;);
+		if (fill == &quot;none&quot;) {
+			return;
+		}
+		var ref = dojo.gfx.svg.getRef(fill);
+		if (ref) {
+			var gradient = ref;
+			switch (gradient.tagName.toLowerCase()) {
+			  case &quot;lineargradient&quot;:
+				fillStyle = this._getGradient(dojo.gfx.defaultLinearGradient, gradient);
+				dojo.lang.forEach([&quot;x1&quot;, &quot;y1&quot;, &quot;x2&quot;, &quot;y2&quot;], function (x) {
+					fillStyle[x] = gradient.getAttribute(x);
+				});
+				break;
+			  case &quot;radialgradient&quot;:
+				fillStyle = this._getGradient(dojo.gfx.defaultRadialGradient, gradient);
+				dojo.lang.forEach([&quot;cx&quot;, &quot;cy&quot;, &quot;r&quot;], function (x) {
+					fillStyle[x] = gradient.getAttribute(x);
+				});
+				fillStyle.cx = gradient.getAttribute(&quot;cx&quot;);
+				fillStyle.cy = gradient.getAttribute(&quot;cy&quot;);
+				fillStyle.r = gradient.getAttribute(&quot;r&quot;);
+				break;
+			  case &quot;pattern&quot;:
+				fillStyle = dojo.lang.shallowCopy(dojo.gfx.defaultPattern, true);
+				dojo.lang.forEach([&quot;x&quot;, &quot;y&quot;, &quot;width&quot;, &quot;height&quot;], function (x) {
+					fillStyle[x] = gradient.getAttribute(x);
+				});
+				fillStyle.src = gradient.firstChild.getAttributeNS(dojo.svg.xmlns.xlink, &quot;href&quot;);
+				break;
+			}
+		} else {
+			fillStyle = new dojo.gfx.color.Color(fill);
+			var opacity = rawNode.getAttribute(&quot;fill-opacity&quot;);
+			if (opacity != null) {
+				fillStyle.a = opacity;
+			}
+		}
+	}
+	return fillStyle;
+}, _getGradient:function (defaultGradient, gradient) {
+	var fillStyle = dojo.lang.shallowCopy(defaultGradient, true);
+	fillStyle.colors = [];
+	for (var i = 0; i &lt; gradient.childNodes.length; ++i) {
+		fillStyle.colors.push({offset:gradient.childNodes[i].getAttribute(&quot;offset&quot;), color:new dojo.gfx.color.Color(gradient.childNodes[i].getAttribute(&quot;stop-color&quot;))});
+	}
+	return fillStyle;
+}, attachStroke:function (rawNode) {
+	if (!rawNode) {
+		return;
+	}
+	var stroke = rawNode.getAttribute(&quot;stroke&quot;);
+	if (stroke == null || stroke == &quot;none&quot;) {
+		return null;
+	}
+	var strokeStyle = dojo.lang.shallowCopy(dojo.gfx.defaultStroke, true);
+	var color = new dojo.gfx.color.Color(stroke);
+	if (color) {
+		strokeStyle.color = color;
+		strokeStyle.color.a = rawNode.getAttribute(&quot;stroke-opacity&quot;);
+		strokeStyle.width = rawNode.getAttribute(&quot;stroke-width&quot;);
+		strokeStyle.cap = rawNode.getAttribute(&quot;stroke-linecap&quot;);
+		strokeStyle.join = rawNode.getAttribute(&quot;stroke-linejoin&quot;);
+		if (strokeStyle.join == &quot;miter&quot;) {
+			strokeStyle.join = rawNode.getAttribute(&quot;stroke-miterlimit&quot;);
+		}
+	}
+	return strokeStyle;
+}, attachTransform:function (rawNode) {
+	var matrix = null;
+	if (rawNode) {
+		matrix = rawNode.getAttribute(&quot;transform&quot;);
+		if (matrix.match(/^matrix\(.+\)$/)) {
+			var t = matrix.slice(7, -1).split(&quot;,&quot;);
+			matrix = dojo.gfx.matrix.normalize({xx:parseFloat(t[0]), xy:parseFloat(t[2]), yx:parseFloat(t[1]), yy:parseFloat(t[3]), dx:parseFloat(t[4]), dy:parseFloat(t[5])});
+		}
+	}
+	return matrix;
+}, attachShape:function (rawNode) {
+	var shape = null;
+	if (rawNode) {
+		shape = dojo.lang.shallowCopy(this.shape, true);
+		for (var i in shape) {
+			shape[i] = rawNode.getAttribute(i);
+		}
+	}
+	return shape;
+}, attach:function (rawNode) {
+	if (rawNode) {
+		this.rawNode = rawNode;
+		this.fillStyle = this.attachFill(rawNode);
+		this.strokeStyle = this.attachStroke(rawNode);
+		this.matrix = this.attachTransform(rawNode);
+		this.shape = this.attachShape(rawNode);
+	}
+}});
+dojo.declare(&quot;dojo.gfx.Group&quot;, dojo.gfx.Shape, {setRawNode:function (rawNode) {
+	this.rawNode = rawNode;
+}});
+dojo.gfx.Group.nodeType = &quot;g&quot;;
+dojo.declare(&quot;dojo.gfx.Rect&quot;, dojo.gfx.shape.Rect, {attachShape:function (rawNode) {
+	var shape = null;
+	if (rawNode) {
+		shape = dojo.gfx.Rect.superclass.attachShape.apply(this, arguments);
+		shape.r = Math.min(rawNode.getAttribute(&quot;rx&quot;), rawNode.getAttribute(&quot;ry&quot;));
+	}
+	return shape;
+}, setShape:function (newShape) {
+	this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	for (var i in this.shape) {
+		if (i != &quot;type&quot; &amp;&amp; i != &quot;r&quot;) {
+			this.rawNode.setAttribute(i, this.shape[i]);
+		}
+	}
+	this.rawNode.setAttribute(&quot;rx&quot;, this.shape.r);
+	this.rawNode.setAttribute(&quot;ry&quot;, this.shape.r);
+	return this;
+}});
+dojo.gfx.Rect.nodeType = &quot;rect&quot;;
+dojo.gfx.Ellipse = dojo.gfx.shape.Ellipse;
+dojo.gfx.Ellipse.nodeType = &quot;ellipse&quot;;
+dojo.gfx.Circle = dojo.gfx.shape.Circle;
+dojo.gfx.Circle.nodeType = &quot;circle&quot;;
+dojo.gfx.Line = dojo.gfx.shape.Line;
+dojo.gfx.Line.nodeType = &quot;line&quot;;
+dojo.declare(&quot;dojo.gfx.Polyline&quot;, dojo.gfx.shape.Polyline, {setShape:function (points) {
+	if (points &amp;&amp; points instanceof Array) {
+		this.shape = dojo.gfx.makeParameters(this.shape, {points:points});
+		if (closed &amp;&amp; this.shape.points.length) {
+			this.shape.points.push(this.shape.points[0]);
+		}
+	} else {
+		this.shape = dojo.gfx.makeParameters(this.shape, points);
+	}
+	this.box = null;
+	var attr = [];
+	var p = this.shape.points;
+	for (var i = 0; i &lt; p.length; ++i) {
+		attr.push(p[i].x.toFixed(8));
+		attr.push(p[i].y.toFixed(8));
+	}
+	this.rawNode.setAttribute(&quot;points&quot;, attr.join(&quot; &quot;));
+	return this;
+}});
+dojo.gfx.Polyline.nodeType = &quot;polyline&quot;;
+dojo.declare(&quot;dojo.gfx.Image&quot;, dojo.gfx.shape.Image, {setShape:function (newShape) {
+	this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	var rawNode = this.rawNode;
+	for (var i in this.shape) {
+		if (i != &quot;type&quot; &amp;&amp; i != &quot;src&quot;) {
+			rawNode.setAttribute(i, this.shape[i]);
+		}
+	}
+	rawNode.setAttributeNS(dojo.svg.xmlns.xlink, &quot;href&quot;, this.shape.src);
+	return this;
+}, setStroke:function () {
+	return this;
+}, setFill:function () {
+	return this;
+}, attachStroke:function (rawNode) {
+	return null;
+}, attachFill:function (rawNode) {
+	return null;
+}});
+dojo.gfx.Image.nodeType = &quot;image&quot;;
+dojo.declare(&quot;dojo.gfx.Path&quot;, dojo.gfx.path.Path, {_updateWithSegment:function (segment) {
+	dojo.gfx.Path.superclass._updateWithSegment.apply(this, arguments);
+	if (typeof (this.shape.path) == &quot;string&quot;) {
+		this.rawNode.setAttribute(&quot;d&quot;, this.shape.path);
+	}
+}, setShape:function (newShape) {
+	dojo.gfx.Path.superclass.setShape.apply(this, arguments);
+	this.rawNode.setAttribute(&quot;d&quot;, this.shape.path);
+	return this;
+}});
+dojo.gfx.Path.nodeType = &quot;path&quot;;
+dojo.gfx._creators = {createPath:function (path) {
+	return this.createObject(dojo.gfx.Path, path);
+}, createRect:function (rect) {
+	return this.createObject(dojo.gfx.Rect, rect);
+}, createCircle:function (circle) {
+	return this.createObject(dojo.gfx.Circle, circle);
+}, createEllipse:function (ellipse) {
+	return this.createObject(dojo.gfx.Ellipse, ellipse);
+}, createLine:function (line) {
+	return this.createObject(dojo.gfx.Line, line);
+}, createPolyline:function (points) {
+	return this.createObject(dojo.gfx.Polyline, points);
+}, createImage:function (image) {
+	return this.createObject(dojo.gfx.Image, image);
+}, createGroup:function () {
+	return this.createObject(dojo.gfx.Group);
+}, createObject:function (shapeType, rawShape) {
+	if (!this.rawNode) {
+		return null;
+	}
+	var shape = new shapeType();
+	var node = document.createElementNS(dojo.svg.xmlns.svg, shapeType.nodeType);
+	shape.setRawNode(node);
+	this.rawNode.appendChild(node);
+	shape.setShape(rawShape);
+	this.add(shape);
+	return shape;
+}, add:function (shape) {
+	var oldParent = shape.getParent();
+	if (oldParent) {
+		oldParent.remove(shape, true);
+	}
+	shape._setParent(this, null);
+	this.rawNode.appendChild(shape.rawNode);
+	return this;
+}, remove:function (shape, silently) {
+	if (this.rawNode == shape.rawNode.parentNode) {
+		this.rawNode.removeChild(shape.rawNode);
+	}
+	shape._setParent(null, null);
+	return this;
+}};
+dojo.gfx.attachNode = function (node) {
+	if (!node) {
+		return null;
+	}
+	var s = null;
+	switch (node.tagName.toLowerCase()) {
+	  case dojo.gfx.Rect.nodeType:
+		s = new dojo.gfx.Rect();
+		break;
+	  case dojo.gfx.Ellipse.nodeType:
+		s = new dojo.gfx.Ellipse();
+		break;
+	  case dojo.gfx.Polyline.nodeType:
+		s = new dojo.gfx.Polyline();
+		break;
+	  case dojo.gfx.Path.nodeType:
+		s = new dojo.gfx.Path();
+		break;
+	  case dojo.gfx.Circle.nodeType:
+		s = new dojo.gfx.Circle();
+		break;
+	  case dojo.gfx.Line.nodeType:
+		s = new dojo.gfx.Line();
+		break;
+	  case dojo.gfx.Image.nodeType:
+		s = new dojo.gfx.Image();
+		break;
+	  default:
+		dojo.debug(&quot;FATAL ERROR! tagName = &quot; + node.tagName);
+	}
+	s.attach(node);
+	return s;
+};
+dojo.lang.extend(dojo.gfx.Surface, {setDimensions:function (width, height) {
+	if (!this.rawNode) {
+		return this;
+	}
+	this.rawNode.setAttribute(&quot;width&quot;, width);
+	this.rawNode.setAttribute(&quot;height&quot;, height);
+	return this;
+}, getDimensions:function () {
+	return this.rawNode ? {width:this.rawNode.getAttribute(&quot;width&quot;), height:this.rawNode.getAttribute(&quot;height&quot;)} : null;
+}});
+dojo.gfx.createSurface = function (parentNode, width, height) {
+	var s = new dojo.gfx.Surface();
+	s.rawNode = document.createElementNS(dojo.svg.xmlns.svg, &quot;svg&quot;);
+	s.rawNode.setAttribute(&quot;width&quot;, width);
+	s.rawNode.setAttribute(&quot;height&quot;, height);
+	var defs = new dojo.gfx.svg.Defines();
+	var node = document.createElementNS(dojo.svg.xmlns.svg, dojo.gfx.svg.Defines.nodeType);
+	defs.setRawNode(node);
+	s.rawNode.appendChild(node);
+	dojo.byId(parentNode).appendChild(s.rawNode);
+	return s;
+};
+dojo.gfx.attachSurface = function (node) {
+	var s = new dojo.gfx.Surface();
+	s.rawNode = node;
+	return s;
+};
+dojo.lang.extend(dojo.gfx.Group, dojo.gfx._creators);
+dojo.lang.extend(dojo.gfx.Surface, dojo.gfx._creators);
+delete dojo.gfx._creators;
+dojo.gfx.svg.Defines = function () {
+	this.rawNode = null;
+};
+dojo.lang.extend(dojo.gfx.svg.Defines, {setRawNode:function (rawNode) {
+	this.rawNode = rawNode;
+}});
+dojo.gfx.svg.Defines.nodeType = &quot;defs&quot;;
+

Added: tags/parley-0.55/root/static/magic/src/gfx/vml.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/gfx/vml.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/gfx/vml.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,1010 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.gfx.vml&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.string.*&quot;);
+dojo.require(&quot;dojo.html.metrics&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.gfx.common&quot;);
+dojo.require(&quot;dojo.gfx.shape&quot;);
+dojo.require(&quot;dojo.gfx.path&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.gfx.vml&quot;);
+dojo.gfx.vml.xmlns = &quot;urn:schemas-microsoft-com:vml&quot;;
+dojo.gfx.vml._parseFloat = function (str) {
+	return str.match(/^\d+f$/i) ? parseInt(str) / 65536 : parseFloat(str);
+};
+dojo.gfx.vml.cm_in_pt = 72 / 2.54;
+dojo.gfx.vml.mm_in_pt = 7.2 / 2.54;
+dojo.gfx.vml.px_in_pt = function () {
+	return dojo.html.getCachedFontMeasurements()[&quot;12pt&quot;] / 12;
+};
+dojo.gfx.vml.pt2px = function (len) {
+	return len * this.px_in_pt();
+};
+dojo.gfx.vml.px2pt = function (len) {
+	return len / this.px_in_pt();
+};
+dojo.gfx.vml.normalizedLength = function (len) {
+	if (len.length == 0) {
+		return 0;
+	}
+	if (len.length &gt; 2) {
+		var px_in_pt = this.px_in_pt();
+		var val = parseFloat(len);
+		switch (len.slice(-2)) {
+		  case &quot;px&quot;:
+			return val;
+		  case &quot;pt&quot;:
+			return val * px_in_pt;
+		  case &quot;in&quot;:
+			return val * 72 * px_in_pt;
+		  case &quot;pc&quot;:
+			return val * 12 * px_in_pt;
+		  case &quot;mm&quot;:
+			return val / this.mm_in_pt * px_in_pt;
+		  case &quot;cm&quot;:
+			return val / this.cm_in_pt * px_in_pt;
+		}
+	}
+	return parseFloat(len);
+};
+dojo.lang.extend(dojo.gfx.Shape, {setFill:function (fill) {
+	if (!fill) {
+		this.fillStyle = null;
+		this.rawNode.filled = false;
+		return this;
+	}
+	if (typeof (fill) == &quot;object&quot; &amp;&amp; &quot;type&quot; in fill) {
+		switch (fill.type) {
+		  case &quot;linear&quot;:
+			var f = dojo.gfx.makeParameters(dojo.gfx.defaultLinearGradient, fill);
+			this.fillStyle = f;
+			var s = &quot;&quot;;
+			for (var i = 0; i &lt; f.colors.length; ++i) {
+				f.colors[i].color = dojo.gfx.normalizeColor(f.colors[i].color);
+				s += f.colors[i].offset.toFixed(8) + &quot; &quot; + f.colors[i].color.toHex() + &quot;;&quot;;
+			}
+			var fo = this.rawNode.fill;
+			fo.colors.value = s;
+			fo.method = &quot;sigma&quot;;
+			fo.type = &quot;gradient&quot;;
+			fo.angle = (dojo.math.radToDeg(Math.atan2(f.x2 - f.x1, f.y2 - f.y1)) + 180) % 360;
+			fo.on = true;
+			break;
+		  case &quot;radial&quot;:
+			var f = dojo.gfx.makeParameters(dojo.gfx.defaultRadialGradient, fill);
+			this.fillStyle = f;
+			var w = parseFloat(this.rawNode.style.width);
+			var h = parseFloat(this.rawNode.style.height);
+			var c = isNaN(w) ? 1 : 2 * f.r / w;
+			var i = f.colors.length - 1;
+			f.colors[i].color = dojo.gfx.normalizeColor(f.colors[i].color);
+			var s = &quot;0 &quot; + f.colors[i].color.toHex();
+			for (; i &gt;= 0; --i) {
+				f.colors[i].color = dojo.gfx.normalizeColor(f.colors[i].color);
+				s += (1 - c * f.colors[i].offset).toFixed(8) + &quot; &quot; + f.colors[i].color.toHex() + &quot;;&quot;;
+			}
+			var fo = this.rawNode.fill;
+			fo.colors.value = s;
+			fo.method = &quot;sigma&quot;;
+			fo.type = &quot;gradientradial&quot;;
+			if (isNaN(w) || isNaN(h)) {
+				fo.focusposition = &quot;0.5 0.5&quot;;
+			} else {
+				fo.focusposition = (f.cx / w).toFixed(8) + &quot; &quot; + (f.cy / h).toFixed(8);
+			}
+			fo.focussize = &quot;0 0&quot;;
+			fo.on = true;
+			break;
+		  case &quot;pattern&quot;:
+			var f = dojo.gfx.makeParameters(dojo.gfx.defaultPattern, fill);
+			this.fillStyle = f;
+			var fo = this.rawNode.fill;
+			fo.type = &quot;tile&quot;;
+			fo.src = f.src;
+			if (f.width &amp;&amp; f.height) {
+				fo.size.x = dojo.gfx.vml.px2pt(f.width);
+				fo.size.y = dojo.gfx.vml.px2pt(f.height);
+			}
+			fo.alignShape = false;
+			fo.position.x = 0;
+			fo.position.y = 0;
+			fo.origin.x = f.width ? f.x / f.width : 0;
+			fo.origin.y = f.height ? f.y / f.height : 0;
+			fo.on = true;
+			break;
+		}
+		this.rawNode.fill.opacity = 1;
+		return this;
+	}
+	this.fillStyle = dojo.gfx.normalizeColor(fill);
+	this.rawNode.fillcolor = this.fillStyle.toHex();
+	this.rawNode.fill.opacity = this.fillStyle.a;
+	this.rawNode.filled = true;
+	return this;
+}, setStroke:function (stroke) {
+	if (!stroke) {
+		this.strokeStyle = null;
+		this.rawNode.stroked = false;
+		return this;
+	}
+	this.strokeStyle = dojo.gfx.makeParameters(dojo.gfx.defaultStroke, stroke);
+	this.strokeStyle.color = dojo.gfx.normalizeColor(this.strokeStyle.color);
+	var s = this.strokeStyle;
+	this.rawNode.stroked = true;
+	this.rawNode.strokecolor = s.color.toCss();
+	this.rawNode.strokeweight = s.width + &quot;px&quot;;
+	if (this.rawNode.stroke) {
+		this.rawNode.stroke.opacity = s.color.a;
+		this.rawNode.stroke.endcap = this._translate(this._capMap, s.cap);
+		if (typeof (s.join) == &quot;number&quot;) {
+			this.rawNode.stroke.joinstyle = &quot;miter&quot;;
+			this.rawNode.stroke.miterlimit = s.join;
+		} else {
+			this.rawNode.stroke.joinstyle = s.join;
+		}
+	}
+	return this;
+}, _capMap:{butt:&quot;flat&quot;}, _capMapReversed:{flat:&quot;butt&quot;}, _translate:function (dict, value) {
+	return (value in dict) ? dict[value] : value;
+}, _applyTransform:function () {
+	var matrix = this._getRealMatrix();
+	if (!matrix) {
+		return this;
+	}
+	var skew = this.rawNode.skew;
+	if (typeof (skew) == &quot;undefined&quot;) {
+		for (var i = 0; i &lt; this.rawNode.childNodes.length; ++i) {
+			if (this.rawNode.childNodes[i].tagName == &quot;skew&quot;) {
+				skew = this.rawNode.childNodes[i];
+				break;
+			}
+		}
+	}
+	if (skew) {
+		skew.on = false;
+		var mt = matrix.xx.toFixed(8) + &quot; &quot; + matrix.xy.toFixed(8) + &quot; &quot; + matrix.yx.toFixed(8) + &quot; &quot; + matrix.yy.toFixed(8) + &quot; 0 0&quot;;
+		var offset = Math.floor(matrix.dx).toFixed() + &quot;px &quot; + Math.floor(matrix.dy).toFixed() + &quot;px&quot;;
+		var l = parseFloat(this.rawNode.style.left);
+		var t = parseFloat(this.rawNode.style.top);
+		var w = parseFloat(this.rawNode.style.width);
+		var h = parseFloat(this.rawNode.style.height);
+		if (isNaN(l)) {
+			l = 0;
+		}
+		if (isNaN(t)) {
+			t = 0;
+		}
+		if (isNaN(w)) {
+			w = 1;
+		}
+		if (isNaN(h)) {
+			h = 1;
+		}
+		var origin = (-l / w - 0.5).toFixed(8) + &quot; &quot; + (-t / h - 0.5).toFixed(8);
+		skew.matrix = mt;
+		skew.origin = origin;
+		skew.offset = offset;
+		skew.on = true;
+	}
+	return this;
+}, setRawNode:function (rawNode) {
+	rawNode.stroked = false;
+	rawNode.filled = false;
+	this.rawNode = rawNode;
+}, attachFill:function (rawNode) {
+	var fillStyle = null;
+	var fo = rawNode.fill;
+	if (rawNode) {
+		if (fo.on &amp;&amp; fo.type == &quot;gradient&quot;) {
+			var fillStyle = dojo.lang.shallowCopy(dojo.gfx.defaultLinearGradient, true);
+			var rad = dojo.math.degToRad(fo.angle);
+			fillStyle.x2 = Math.cos(rad);
+			fillStyle.y2 = Math.sin(rad);
+			fillStyle.colors = [];
+			var stops = fo.colors.value.split(&quot;;&quot;);
+			for (var i = 0; i &lt; stops.length; ++i) {
+				var t = stops[i].match(/\S+/g);
+				if (!t || t.length != 2) {
+					continue;
+				}
+				fillStyle.colors.push({offset:dojo.gfx.vml._parseFloat(t[0]), color:new dojo.gfx.color.Color(t[1])});
+			}
+		} else {
+			if (fo.on &amp;&amp; fo.type == &quot;gradientradial&quot;) {
+				var fillStyle = dojo.lang.shallowCopy(dojo.gfx.defaultRadialGradient, true);
+				var w = parseFloat(rawNode.style.width);
+				var h = parseFloat(rawNode.style.height);
+				fillStyle.cx = isNaN(w) ? 0 : fo.focusposition.x * w;
+				fillStyle.cy = isNaN(h) ? 0 : fo.focusposition.y * h;
+				fillStyle.r = isNaN(w) ? 1 : w / 2;
+				fillStyle.colors = [];
+				var stops = fo.colors.value.split(&quot;;&quot;);
+				for (var i = stops.length - 1; i &gt;= 0; --i) {
+					var t = stops[i].match(/\S+/g);
+					if (!t || t.length != 2) {
+						continue;
+					}
+					fillStyle.colors.push({offset:dojo.gfx.vml._parseFloat(t[0]), color:new dojo.gfx.color.Color(t[1])});
+				}
+			} else {
+				if (fo.on &amp;&amp; fo.type == &quot;tile&quot;) {
+					var fillStyle = dojo.lang.shallowCopy(dojo.gfx.defaultPattern, true);
+					fillStyle.width = dojo.gfx.vml.pt2px(fo.size.x);
+					fillStyle.height = dojo.gfx.vml.pt2px(fo.size.y);
+					fillStyle.x = fo.origin.x * fillStyle.width;
+					fillStyle.y = fo.origin.y * fillStyle.height;
+					fillStyle.src = fo.src;
+				} else {
+					if (fo.on &amp;&amp; rawNode.fillcolor) {
+						fillStyle = new dojo.gfx.color.Color(rawNode.fillcolor + &quot;&quot;);
+						fillStyle.a = fo.opacity;
+					}
+				}
+			}
+		}
+	}
+	return fillStyle;
+}, attachStroke:function (rawNode) {
+	var strokeStyle = dojo.lang.shallowCopy(dojo.gfx.defaultStroke, true);
+	if (rawNode &amp;&amp; rawNode.stroked) {
+		strokeStyle.color = new dojo.gfx.color.Color(rawNode.strokecolor.value);
+		dojo.debug(&quot;We are expecting an .75pt here, instead of strokeweight = &quot; + rawNode.strokeweight);
+		strokeStyle.width = dojo.gfx.vml.normalizedLength(rawNode.strokeweight + &quot;&quot;);
+		strokeStyle.color.a = rawNode.stroke.opacity;
+		strokeStyle.cap = this._translate(this._capMapReversed, rawNode.stroke.endcap);
+		strokeStyle.join = rawNode.stroke.joinstyle == &quot;miter&quot; ? rawNode.stroke.miterlimit : rawNode.stroke.joinstyle;
+	} else {
+		return null;
+	}
+	return strokeStyle;
+}, attachTransform:function (rawNode) {
+	var matrix = {};
+	if (rawNode) {
+		var s = rawNode.skew;
+		matrix.xx = s.matrix.xtox;
+		matrix.xy = s.matrix.ytox;
+		matrix.yx = s.matrix.xtoy;
+		matrix.yy = s.matrix.ytoy;
+		matrix.dx = dojo.gfx.vml.pt2px(s.offset.x);
+		matrix.dy = dojo.gfx.vml.pt2px(s.offset.y);
+	}
+	return dojo.gfx.matrix.normalize(matrix);
+}, attach:function (rawNode) {
+	if (rawNode) {
+		this.rawNode = rawNode;
+		this.shape = this.attachShape(rawNode);
+		this.fillStyle = this.attachFill(rawNode);
+		this.strokeStyle = this.attachStroke(rawNode);
+		this.matrix = this.attachTransform(rawNode);
+	}
+}});
+dojo.declare(&quot;dojo.gfx.Group&quot;, dojo.gfx.shape.VirtualGroup, {add:function (shape) {
+	if (this != shape.getParent()) {
+		this.rawNode.appendChild(shape.rawNode);
+		dojo.gfx.Group.superclass.add.apply(this, arguments);
+	}
+	return this;
+}, remove:function (shape, silently) {
+	if (this == shape.getParent()) {
+		if (this.rawNode == shape.rawNode.parentNode) {
+			this.rawNode.removeChild(shape.rawNode);
+		}
+		dojo.gfx.Group.superclass.remove.apply(this, arguments);
+	}
+	return this;
+}, attach:function (rawNode) {
+	if (rawNode) {
+		this.rawNode = rawNode;
+		this.shape = null;
+		this.fillStyle = null;
+		this.strokeStyle = null;
+		this.matrix = null;
+	}
+}});
+dojo.gfx.Group.nodeType = &quot;group&quot;;
+var zIndex = {moveToFront:function () {
+	this.rawNode.parentNode.appendChild(this.rawNode);
+	return this;
+}, moveToBack:function () {
+	this.rawNode.parentNode.insertBefore(this.rawNode, this.rawNode.parentNode.firstChild);
+	return this;
+}};
+dojo.lang.extend(dojo.gfx.Shape, zIndex);
+dojo.lang.extend(dojo.gfx.Group, zIndex);
+delete zIndex;
+dojo.declare(&quot;dojo.gfx.Rect&quot;, dojo.gfx.shape.Rect, {attachShape:function (rawNode) {
+	var arcsize = rawNode.outerHTML.match(/arcsize = \&quot;(\d*\.?\d+[%f]?)\&quot;/)[1];
+	arcsize = (arcsize.indexOf(&quot;%&quot;) &gt;= 0) ? parseFloat(arcsize) / 100 : dojo.gfx.vml._parseFloat(arcsize);
+	var style = rawNode.style;
+	var width = parseFloat(style.width);
+	var height = parseFloat(style.height);
+	var o = dojo.gfx.makeParameters(dojo.gfx.defaultRect, {x:parseInt(style.left), y:parseInt(style.top), width:width, height:height, r:Math.min(width, height) * arcsize});
+	return o;
+}, setShape:function (newShape) {
+	var shape = this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	var style = this.rawNode.style;
+	style.left = shape.x.toFixed();
+	style.top = shape.y.toFixed();
+	style.width = (typeof (shape.width) == &quot;string&quot; &amp;&amp; shape.width.indexOf(&quot;%&quot;) &gt;= 0) ? shape.width : shape.width.toFixed();
+	style.height = (typeof (shape.width) == &quot;string&quot; &amp;&amp; shape.height.indexOf(&quot;%&quot;) &gt;= 0) ? shape.height : shape.height.toFixed();
+	var r = Math.min(1, (shape.r / Math.min(parseFloat(shape.width), parseFloat(shape.height)))).toFixed(8);
+	var parent = this.rawNode.parentNode;
+	var before = null;
+	if (parent) {
+		if (parent.lastChild != this.rawNode) {
+			for (var i = 0; i &lt; parent.childNodes.length; ++i) {
+				if (parent.childNodes[i] == this.rawNode) {
+					before = parent.childNodes[i + 1];
+					break;
+				}
+			}
+		}
+		parent.removeChild(this.rawNode);
+	}
+	this.rawNode.arcsize = r;
+	if (parent) {
+		if (before) {
+			parent.insertBefore(this.rawNode, before);
+		} else {
+			parent.appendChild(this.rawNode);
+		}
+	}
+	return this.setTransform(this.matrix);
+}});
+dojo.gfx.Rect.nodeType = &quot;roundrect&quot;;
+dojo.declare(&quot;dojo.gfx.Ellipse&quot;, dojo.gfx.shape.Ellipse, {attachShape:function (rawNode) {
+	var style = this.rawNode.style;
+	var rx = parseInt(style.width) / 2;
+	var ry = parseInt(style.height) / 2;
+	var o = dojo.gfx.makeParameters(dojo.gfx.defaultEllipse, {cx:parseInt(style.left) + rx, cy:parseInt(style.top) + ry, rx:rx, ry:ry});
+	return o;
+}, setShape:function (newShape) {
+	var shape = this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	var style = this.rawNode.style;
+	style.left = (shape.cx - shape.rx).toFixed();
+	style.top = (shape.cy - shape.ry).toFixed();
+	style.width = (shape.rx * 2).toFixed();
+	style.height = (shape.ry * 2).toFixed();
+	return this.setTransform(this.matrix);
+}});
+dojo.gfx.Ellipse.nodeType = &quot;oval&quot;;
+dojo.declare(&quot;dojo.gfx.Circle&quot;, dojo.gfx.shape.Circle, {attachShape:function (rawNode) {
+	var style = this.rawNode.style;
+	var r = parseInt(style.width) / 2;
+	var o = dojo.gfx.makeParameters(dojo.gfx.defaultCircle, {cx:parseInt(style.left) + r, cy:parseInt(style.top) + r, r:r});
+	return o;
+}, setShape:function (newShape) {
+	var shape = this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	var style = this.rawNode.style;
+	style.left = (shape.cx - shape.r).toFixed();
+	style.top = (shape.cy - shape.r).toFixed();
+	style.width = (shape.r * 2).toFixed();
+	style.height = (shape.r * 2).toFixed();
+	return this;
+}});
+dojo.gfx.Circle.nodeType = &quot;oval&quot;;
+dojo.declare(&quot;dojo.gfx.Line&quot;, dojo.gfx.shape.Line, function (rawNode) {
+	if (rawNode) {
+		rawNode.setAttribute(&quot;dojoGfxType&quot;, &quot;line&quot;);
+	}
+}, {attachShape:function (rawNode) {
+	var p = rawNode.path.v.match(dojo.gfx.pathRegExp);
+	var shape = {};
+	do {
+		if (p.length &lt; 7 || p[0] != &quot;m&quot; || p[3] != &quot;l&quot; || p[6] != &quot;e&quot;) {
+			break;
+		}
+		shape.x1 = parseInt(p[1]);
+		shape.y1 = parseInt(p[2]);
+		shape.x2 = parseInt(p[4]);
+		shape.y2 = parseInt(p[5]);
+	} while (false);
+	return dojo.gfx.makeParameters(dojo.gfx.defaultLine, shape);
+}, setShape:function (newShape) {
+	var shape = this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	this.rawNode.path.v = &quot;m&quot; + shape.x1.toFixed() + &quot; &quot; + shape.y1.toFixed() + &quot;l&quot; + shape.x2.toFixed() + &quot; &quot; + shape.y2.toFixed() + &quot;e&quot;;
+	return this.setTransform(this.matrix);
+}});
+dojo.gfx.Line.nodeType = &quot;shape&quot;;
+dojo.declare(&quot;dojo.gfx.Polyline&quot;, dojo.gfx.shape.Polyline, function (rawNode) {
+	if (rawNode) {
+		rawNode.setAttribute(&quot;dojoGfxType&quot;, &quot;polyline&quot;);
+	}
+}, {attachShape:function (rawNode) {
+	var shape = dojo.lang.shallowCopy(dojo.gfx.defaultPolyline, true);
+	var p = rawNode.path.v.match(dojo.gfx.pathRegExp);
+	do {
+		if (p.length &lt; 3 || p[0] != &quot;m&quot;) {
+			break;
+		}
+		var x = parseInt(p[0]);
+		var y = parseInt(p[1]);
+		if (isNaN(x) || isNaN(y)) {
+			break;
+		}
+		shape.points.push({x:x, y:y});
+		if (p.length &lt; 6 || p[3] != &quot;l&quot;) {
+			break;
+		}
+		for (var i = 4; i &lt; p.length; i += 2) {
+			x = parseInt(p[i]);
+			y = parseInt(p[i + 1]);
+			if (isNaN(x) || isNaN(y)) {
+				break;
+			}
+			shape.points.push({x:x, y:y});
+		}
+	} while (false);
+	return shape;
+}, setShape:function (points, closed) {
+	if (points &amp;&amp; points instanceof Array) {
+		this.shape = dojo.gfx.makeParameters(this.shape, {points:points});
+		if (closed &amp;&amp; this.shape.points.length) {
+			this.shape.points.push(this.shape.points[0]);
+		}
+	} else {
+		this.shape = dojo.gfx.makeParameters(this.shape, points);
+	}
+	this.bbox = null;
+	var attr = [];
+	var p = this.shape.points;
+	if (p.length &gt; 0) {
+		attr.push(&quot;m&quot;);
+		attr.push(p[0].x.toFixed());
+		attr.push(p[0].y.toFixed());
+		if (p.length &gt; 1) {
+			attr.push(&quot;l&quot;);
+			for (var i = 1; i &lt; p.length; ++i) {
+				attr.push(p[i].x.toFixed());
+				attr.push(p[i].y.toFixed());
+			}
+		}
+	}
+	attr.push(&quot;e&quot;);
+	this.rawNode.path.v = attr.join(&quot; &quot;);
+	return this.setTransform(this.matrix);
+}});
+dojo.gfx.Polyline.nodeType = &quot;shape&quot;;
+dojo.declare(&quot;dojo.gfx.Image&quot;, dojo.gfx.shape.Image, {getEventSource:function () {
+	return this.rawNode ? this.rawNode.firstChild : null;
+}, attachShape:function (rawNode) {
+	var shape = dojo.lang.shallowCopy(dojo.gfx.defaultImage, true);
+	shape.src = rawNode.firstChild.src;
+	return shape;
+}, setShape:function (newShape) {
+	var shape = this.shape = dojo.gfx.makeParameters(this.shape, newShape);
+	this.bbox = null;
+	var firstChild = this.rawNode.firstChild;
+	firstChild.src = shape.src;
+	if (shape.width || shape.height) {
+		firstChild.style.width = shape.width;
+		firstChild.style.height = shape.height;
+	}
+	return this.setTransform(this.matrix);
+}, setStroke:function () {
+	return this;
+}, setFill:function () {
+	return this;
+}, attachStroke:function (rawNode) {
+	return null;
+}, attachFill:function (rawNode) {
+	return null;
+}, attachTransform:function (rawNode) {
+	var matrix = {};
+	if (rawNode) {
+		var m = rawNode.filters[&quot;DXImageTransform.Microsoft.Matrix&quot;];
+		matrix.xx = m.M11;
+		matrix.xy = m.M12;
+		matrix.yx = m.M21;
+		matrix.yy = m.M22;
+		matrix.dx = m.Dx;
+		matrix.dy = m.Dy;
+	}
+	return dojo.gfx.matrix.normalize(matrix);
+}, _applyTransform:function () {
+	var matrix = this._getRealMatrix();
+	if (!matrix) {
+		return this;
+	}
+	with (this.rawNode.filters[&quot;DXImageTransform.Microsoft.Matrix&quot;]) {
+		M11 = matrix.xx;
+		M12 = matrix.xy;
+		M21 = matrix.yx;
+		M22 = matrix.yy;
+		Dx = matrix.dx;
+		Dy = matrix.dy;
+	}
+	return this;
+}});
+dojo.gfx.Image.nodeType = &quot;image&quot;;
+dojo.gfx.path._calcArc = function (alpha) {
+	var cosa = Math.cos(alpha);
+	var sina = Math.sin(alpha);
+	var p2 = {x:cosa + (4 / 3) * (1 - cosa), y:sina - (4 / 3) * cosa * (1 - cosa) / sina};
+	return {s:{x:cosa, y:sina}, c1:p2, c2:{x:p2.x, y:-p2.y}, e:{x:cosa, y:-sina}};
+};
+dojo.declare(&quot;dojo.gfx.Path&quot;, dojo.gfx.path.Path, function (rawNode) {
+	if (rawNode) {
+		rawNode.setAttribute(&quot;dojoGfxType&quot;, &quot;path&quot;);
+	}
+	this.vmlPath = &quot;&quot;;
+	this.lastControl = {};
+}, {_updateWithSegment:function (segment) {
+	var last = dojo.lang.shallowCopy(this.last);
+	dojo.gfx.Path.superclass._updateWithSegment.apply(this, arguments);
+	var path = this[this.renderers[segment.action]](segment, last);
+	if (typeof (this.vmlPath) == &quot;string&quot;) {
+		this.vmlPath += path.join(&quot;&quot;);
+	} else {
+		this.vmlPath = this.vmlPath.concat(path);
+	}
+	if (typeof (this.vmlPath) == &quot;string&quot;) {
+		this.rawNode.path.v = this.vmlPath + &quot; e&quot;;
+	}
+}, attachShape:function (rawNode) {
+	var shape = dojo.lang.shallowCopy(dojo.gfx.defaultPath, true);
+	var p = rawNode.path.v.match(dojo.gfx.pathRegExp);
+	var t = [], skip = false;
+	for (var i = 0; i &lt; p.length; ++p) {
+		var s = p[i];
+		if (s in this._pathVmlToSvgMap) {
+			skip = false;
+			t.push(this._pathVmlToSvgMap[s]);
+		} else {
+			if (!skip) {
+				var n = parseInt(s);
+				if (isNaN(n)) {
+					skip = true;
+				} else {
+					t.push(n);
+				}
+			}
+		}
+	}
+	if (t.length) {
+		shape.path = t.join(&quot; &quot;);
+	}
+	return shape;
+}, setShape:function (newShape) {
+	this.vmlPath = [];
+	this.lastControl = {};
+	dojo.gfx.Path.superclass.setShape.apply(this, arguments);
+	this.vmlPath = this.vmlPath.join(&quot;&quot;);
+	this.rawNode.path.v = this.vmlPath + &quot; e&quot;;
+	return this;
+}, _pathVmlToSvgMap:{m:&quot;M&quot;, l:&quot;L&quot;, t:&quot;m&quot;, r:&quot;l&quot;, c:&quot;C&quot;, v:&quot;c&quot;, qb:&quot;Q&quot;, x:&quot;z&quot;, e:&quot;&quot;}, renderers:{M:&quot;_moveToA&quot;, m:&quot;_moveToR&quot;, L:&quot;_lineToA&quot;, l:&quot;_lineToR&quot;, H:&quot;_hLineToA&quot;, h:&quot;_hLineToR&quot;, V:&quot;_vLineToA&quot;, v:&quot;_vLineToR&quot;, C:&quot;_curveToA&quot;, c:&quot;_curveToR&quot;, S:&quot;_smoothCurveToA&quot;, s:&quot;_smoothCurveToR&quot;, Q:&quot;_qCurveToA&quot;, q:&quot;_qCurveToR&quot;, T:&quot;_qSmoothCurveToA&quot;, t:&quot;_qSmoothCurveToR&quot;, A:&quot;_arcTo&quot;, a:&quot;_arcTo&quot;, Z:&quot;_closePath&quot;, z:&quot;_closePath&quot;}, _addArgs:function (path, args, from, upto) {
+	if (typeof (upto) == &quot;undefined&quot;) {
+		upto = args.length;
+	}
+	if (typeof (from) == &quot;undefined&quot;) {
+		from = 0;
+	}
+	for (var i = from; i &lt; upto; ++i) {
+		path.push(&quot; &quot;);
+		path.push(args[i].toFixed());
+	}
+}, _addArgsAdjusted:function (path, last, args, from, upto) {
+	if (typeof (upto) == &quot;undefined&quot;) {
+		upto = args.length;
+	}
+	if (typeof (from) == &quot;undefined&quot;) {
+		from = 0;
+	}
+	for (var i = from; i &lt; upto; i += 2) {
+		path.push(&quot; &quot;);
+		path.push((last.x + args[i]).toFixed());
+		path.push(&quot; &quot;);
+		path.push((last.y + args[i + 1]).toFixed());
+	}
+}, _moveToA:function (segment) {
+	var p = [&quot; m&quot;];
+	var n = segment.args;
+	var l = n.length;
+	if (l == 2) {
+		this._addArgs(p, n);
+	} else {
+		this._addArgs(p, n, 0, 2);
+		p.push(&quot; l&quot;);
+		this._addArgs(p, n, 2);
+	}
+	this.lastControl = {};
+	return p;
+}, _moveToR:function (segment, last) {
+	var p = [&quot;x&quot; in last ? &quot; t&quot; : &quot; m&quot;];
+	var n = segment.args;
+	var l = n.length;
+	if (l == 2) {
+		this._addArgs(p, n);
+	} else {
+		this._addArgs(p, n, 0, 2);
+		p.push(&quot; r&quot;);
+		this._addArgs(p, n, 2);
+	}
+	this.lastControl = {};
+	return p;
+}, _lineToA:function (segment) {
+	var p = [&quot; l&quot;];
+	this._addArgs(p, segment.args);
+	this.lastControl = {};
+	return p;
+}, _lineToR:function (segment) {
+	var p = [&quot; r&quot;];
+	this._addArgs(p, segment.args);
+	this.lastControl = {};
+	return p;
+}, _hLineToA:function (segment, last) {
+	var p = [&quot; l&quot;];
+	var n = segment.args;
+	var l = n.length;
+	var y = &quot; &quot; + last.y.toFixed();
+	for (var i = 0; i &lt; l; ++i) {
+		p.push(&quot; &quot;);
+		p.push(n[i].toFixed());
+		p.push(y);
+	}
+	this.lastControl = {};
+	return p;
+}, _hLineToR:function (segment) {
+	var p = [&quot; r&quot;];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; ++i) {
+		p.push(&quot; &quot;);
+		p.push(n[i].toFixed());
+		p.push(&quot; 0&quot;);
+	}
+	this.lastControl = {};
+	return p;
+}, _vLineToA:function (segment, last) {
+	var p = [&quot; l&quot;];
+	var n = segment.args;
+	var l = n.length;
+	var x = &quot; &quot; + last.x.toFixed();
+	for (var i = 0; i &lt; l; ++i) {
+		p.push(x);
+		p.push(&quot; &quot;);
+		p.push(n[i].toFixed());
+	}
+	this.lastControl = {};
+	return p;
+}, _vLineToR:function (segment) {
+	var p = [&quot; r&quot;];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; ++i) {
+		p.push(&quot; 0 &quot;);
+		p.push(n[i].toFixed());
+	}
+	this.lastControl = {};
+	return p;
+}, _curveToA:function (segment) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 6) {
+		p.push(&quot; c&quot;);
+		this._addArgs(p, n, i, i + 6);
+	}
+	this.lastControl = {x:n[l - 4], y:n[l - 3], type:&quot;C&quot;};
+	return p;
+}, _curveToR:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 6) {
+		p.push(&quot; v&quot;);
+		this._addArgs(p, n, i, i + 6);
+		this.lastControl = {x:last.x + n[i + 2], y:last.y + n[i + 3]};
+		last.x += n[i + 4];
+		last.y += n[i + 5];
+	}
+	this.lastControl.type = &quot;C&quot;;
+	return p;
+}, _smoothCurveToA:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 4) {
+		p.push(&quot; c&quot;);
+		if (this.lastControl.type == &quot;C&quot;) {
+			this._addArgs(p, [2 * last.x - this.lastControl.x, 2 * last.y - this.lastControl.y]);
+		} else {
+			this._addArgs(p, [last.x, last.y]);
+		}
+		this._addArgs(p, n, i, i + 4);
+	}
+	this.lastControl = {x:n[l - 4], y:n[l - 3], type:&quot;C&quot;};
+	return p;
+}, _smoothCurveToR:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 4) {
+		p.push(&quot; v&quot;);
+		if (this.lastControl.type == &quot;C&quot;) {
+			this._addArgs(p, [last.x - this.lastControl.x, last.y - this.lastControl.y]);
+		} else {
+			this._addArgs(p, [0, 0]);
+		}
+		this._addArgs(p, n, i, i + 4);
+		this.lastControl = {x:last.x + n[i], y:last.y + n[i + 1]};
+		last.x += n[i + 2];
+		last.y += n[i + 3];
+	}
+	this.lastControl.type = &quot;C&quot;;
+	return p;
+}, _qCurveToA:function (segment) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 4) {
+		p.push(&quot; qb&quot;);
+		this._addArgs(p, n, i, i + 4);
+	}
+	this.lastControl = {x:n[l - 4], y:n[l - 3], type:&quot;Q&quot;};
+	return p;
+}, _qCurveToR:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 4) {
+		p.push(&quot; qb&quot;);
+		this._addArgsAdjusted(p, last, n, i, i + 4);
+		this.lastControl = {x:last.x + n[i], y:last.y + n[i + 1]};
+		last.x += n[i + 2];
+		last.y += n[i + 3];
+	}
+	this.lastControl.type = &quot;Q&quot;;
+	return p;
+}, _qSmoothCurveToA:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 2) {
+		p.push(&quot; qb&quot;);
+		if (this.lastControl.type == &quot;Q&quot;) {
+			this._addArgs(p, [this.lastControl.x = 2 * last.x - this.lastControl.x, this.lastControl.y = 2 * last.y - this.lastControl.y]);
+		} else {
+			this._addArgs(p, [this.lastControl.x = last.x, this.lastControl.y = last.y]);
+		}
+		this._addArgs(p, n, i, i + 2);
+	}
+	this.lastControl.type = &quot;Q&quot;;
+	return p;
+}, _qSmoothCurveToR:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	for (var i = 0; i &lt; l; i += 2) {
+		p.push(&quot; qb&quot;);
+		if (this.lastControl.type == &quot;Q&quot;) {
+			this._addArgs(p, [this.lastControl.x = 2 * last.x - this.lastControl.x, this.lastControl.y = 2 * last.y - this.lastControl.y]);
+		} else {
+			this._addArgs(p, [this.lastControl.x = last.x, this.lastControl.y = last.y]);
+		}
+		this._addArgsAdjusted(p, last, n, i, i + 2);
+	}
+	this.lastControl.type = &quot;Q&quot;;
+	return p;
+}, _PI4:Math.PI / 4, _curvePI4:dojo.gfx.path._calcArc(Math.PI / 8), _calcArcTo:function (path, last, rx, ry, xRotg, large, cw, x, y) {
+	var m = dojo.gfx.matrix;
+	var xRot = -dojo.math.degToRad(xRotg);
+	var rx2 = rx * rx;
+	var ry2 = ry * ry;
+	var pa = m.multiplyPoint(m.rotate(-xRot), {x:(last.x - x) / 2, y:(last.y - y) / 2});
+	var pax2 = pa.x * pa.x;
+	var pay2 = pa.y * pa.y;
+	var c1 = Math.sqrt((rx2 * ry2 - rx2 * pay2 - ry2 * pax2) / (rx2 * pay2 + ry2 * pax2));
+	var ca = {x:c1 * rx * pa.y / ry, y:-c1 * ry * pa.x / rx};
+	if (large == cw) {
+		ca = {x:-ca.x, y:-ca.y};
+	}
+	var c = m.multiplyPoint([m.translate((last.x + x) / 2, (last.y + y) / 2), m.rotate(xRot)], ca);
+	var startAngle = Math.atan2(c.y - last.y, last.x - c.x) - xRot;
+	var endAngle = Math.atan2(c.y - y, x - c.x) - xRot;
+	var theta = cw ? startAngle - endAngle : endAngle - startAngle;
+	if (theta &lt; 0) {
+		theta += this._2PI;
+	} else {
+		if (theta &gt; this._2PI) {
+			theta = this._2PI;
+		}
+	}
+	var elliptic_transform = m.normalize([m.translate(c.x, c.y), m.rotate(xRot), m.scale(rx, ry)]);
+	var alpha = this._PI4 / 2;
+	var curve = this._curvePI4;
+	var step = cw ? -alpha : alpha;
+	for (var angle = theta; angle &gt; 0; angle -= this._PI4) {
+		if (angle &lt; this._PI4) {
+			alpha = angle / 2;
+			curve = dojo.gfx.path._calcArc(alpha);
+			step = cw ? -alpha : alpha;
+		}
+		var c1, c2, e;
+		var M = m.normalize([elliptic_transform, m.rotate(startAngle + step)]);
+		if (cw) {
+			c1 = m.multiplyPoint(M, curve.c2);
+			c2 = m.multiplyPoint(M, curve.c1);
+			e = m.multiplyPoint(M, curve.s);
+		} else {
+			c1 = m.multiplyPoint(M, curve.c1);
+			c2 = m.multiplyPoint(M, curve.c2);
+			e = m.multiplyPoint(M, curve.e);
+		}
+		path.push(&quot; c&quot;);
+		this._addArgs(path, [c1.x, c1.y, c2.x, c2.y, e.x, e.y]);
+		startAngle += 2 * step;
+	}
+}, _arcTo:function (segment, last) {
+	var p = [];
+	var n = segment.args;
+	var l = n.length;
+	var relative = segment.action == &quot;a&quot;;
+	for (var i = 0; i &lt; l; i += 7) {
+		var x1 = n[i + 5];
+		var y1 = n[i + 6];
+		if (relative) {
+			x1 += last.x;
+			y1 += last.y;
+		}
+		this._calcArcTo(p, last, n[i], n[i + 1], n[i + 2], n[i + 3] ? 1 : 0, n[i + 4] ? 1 : 0, x1, y1);
+		last = {x:x1, y:y1};
+	}
+	this.lastControl = {};
+	return p;
+}, _closePath:function () {
+	this.lastControl = {};
+	return [&quot;x&quot;];
+}});
+dojo.gfx.Path.nodeType = &quot;shape&quot;;
+dojo.gfx._creators = {createPath:function (path) {
+	return this.createObject(dojo.gfx.Path, path, true);
+}, createRect:function (rect) {
+	return this.createObject(dojo.gfx.Rect, rect);
+}, createCircle:function (circle) {
+	return this.createObject(dojo.gfx.Circle, circle);
+}, createEllipse:function (ellipse) {
+	return this.createObject(dojo.gfx.Ellipse, ellipse);
+}, createLine:function (line) {
+	return this.createObject(dojo.gfx.Line, line, true);
+}, createPolyline:function (points) {
+	return this.createObject(dojo.gfx.Polyline, points, true);
+}, createImage:function (image) {
+	if (!this.rawNode) {
+		return null;
+	}
+	var shape = new dojo.gfx.Image();
+	var node = document.createElement(&quot;div&quot;);
+	node.style.position = &quot;relative&quot;;
+	node.style.width = this.rawNode.style.width;
+	node.style.height = this.rawNode.style.height;
+	node.style.filter = &quot;progid:DXImageTransform.Microsoft.Matrix(M11=1, M12=0, M21=0, M22=1, Dx=0, Dy=0)&quot;;
+	var img = document.createElement(&quot;img&quot;);
+	node.appendChild(img);
+	shape.setRawNode(node);
+	this.rawNode.appendChild(node);
+	shape.setShape(image);
+	this.add(shape);
+	return shape;
+}, createGroup:function () {
+	return this.createObject(dojo.gfx.Group, null, true);
+}, createObject:function (shapeType, rawShape, overrideSize) {
+	if (!this.rawNode) {
+		return null;
+	}
+	var shape = new shapeType();
+	var node = document.createElement(&quot;v:&quot; + shapeType.nodeType);
+	shape.setRawNode(node);
+	this.rawNode.appendChild(node);
+	if (overrideSize) {
+		this._overrideSize(node);
+	}
+	shape.setShape(rawShape);
+	this.add(shape);
+	return shape;
+}, _overrideSize:function (node) {
+	node.style.width = this.rawNode.style.width;
+	node.style.height = this.rawNode.style.height;
+	node.coordsize = parseFloat(node.style.width) + &quot; &quot; + parseFloat(node.style.height);
+}};
+dojo.lang.extend(dojo.gfx.Group, dojo.gfx._creators);
+dojo.lang.extend(dojo.gfx.Surface, dojo.gfx._creators);
+delete dojo.gfx._creators;
+dojo.gfx.attachNode = function (node) {
+	if (!node) {
+		return null;
+	}
+	var s = null;
+	switch (node.tagName.toLowerCase()) {
+	  case dojo.gfx.Rect.nodeType:
+		s = new dojo.gfx.Rect();
+		break;
+	  case dojo.gfx.Ellipse.nodeType:
+		s = (node.style.width == node.style.height) ? new dojo.gfx.Circle() : new dojo.gfx.Ellipse();
+		break;
+	  case dojo.gfx.Path.nodeType:
+		switch (node.getAttribute(&quot;dojoGfxType&quot;)) {
+		  case &quot;line&quot;:
+			s = new dojo.gfx.Line();
+			break;
+		  case &quot;polyline&quot;:
+			s = new dojo.gfx.Polyline();
+			break;
+		  case &quot;path&quot;:
+			s = new dojo.gfx.Path();
+			break;
+		}
+		break;
+	  case dojo.gfx.Image.nodeType:
+		s = new dojo.gfx.Image();
+		break;
+	  default:
+		dojo.debug(&quot;FATAL ERROR! tagName = &quot; + node.tagName);
+	}
+	s.attach(node);
+	return s;
+};
+dojo.lang.extend(dojo.gfx.Surface, {setDimensions:function (width, height) {
+	if (!this.rawNode) {
+		return this;
+	}
+	this.rawNode.style.width = width;
+	this.rawNode.style.height = height;
+	this.rawNode.coordsize = width + &quot; &quot; + height;
+	return this;
+}, getDimensions:function () {
+	return this.rawNode ? {width:this.rawNode.style.width, height:this.rawNode.style.height} : null;
+}, add:function (shape) {
+	var oldParent = shape.getParent();
+	if (this != oldParent) {
+		this.rawNode.appendChild(shape.rawNode);
+		if (oldParent) {
+			oldParent.remove(shape, true);
+		}
+		shape._setParent(this, null);
+	}
+	return this;
+}, remove:function (shape, silently) {
+	if (this == shape.getParent()) {
+		if (this.rawNode == shape.rawNode.parentNode) {
+			this.rawNode.removeChild(shape.rawNode);
+		}
+		shape._setParent(null, null);
+	}
+	return this;
+}});
+dojo.gfx.createSurface = function (parentNode, width, height) {
+	var s = new dojo.gfx.Surface();
+	s.rawNode = document.createElement(&quot;v:group&quot;);
+	s.rawNode.style.width = width ? width : &quot;100%&quot;;
+	s.rawNode.style.height = height ? height : &quot;100%&quot;;
+	s.rawNode.coordsize = (width &amp;&amp; height) ? (parseFloat(width) + &quot; &quot; + parseFloat(height)) : &quot;100% 100%&quot;;
+	s.rawNode.coordorigin = &quot;0 0&quot;;
+	dojo.byId(parentNode).appendChild(s.rawNode);
+	return s;
+};
+dojo.gfx.attachSurface = function (node) {
+	var s = new dojo.gfx.Surface();
+	s.rawNode = node;
+	return s;
+};
+

Added: tags/parley-0.55/root/static/magic/src/graphics/Colorspace.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/graphics/Colorspace.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/graphics/Colorspace.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,17 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.graphics.Colorspace&quot;);
+dojo.require(&quot;dojo.gfx.Colorspace&quot;);
+dojo.deprecated(&quot;dojo.graphics.Colorspace: use dojo.gfx.Colorspace instead.&quot;, &quot;0.5&quot;);
+dojo.graphics.Colorspace = dojo.gfx.Colorspace;
+

Added: tags/parley-0.55/root/static/magic/src/graphics/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/graphics/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/graphics/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,14 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.graphics.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/graphics/color/hsl.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/graphics/color/hsl.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/graphics/color/hsl.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,32 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.graphics.color.hsl&quot;);
+dojo.require(&quot;dojo.gfx.color.hsl&quot;);
+dojo.deprecated(&quot;dojo.graphics.color.hsl has been replaced with dojo.gfx.color.hsl&quot;, &quot;0.5&quot;);
+dojo.graphics.color.rgb2hsl = function (r, g, b) {
+	dojo.deprecated(&quot;dojo.graphics.color.rgb2hsl has been replaced with dojo.gfx.color.rgb2hsl&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.rgb2hsl(r, g, b);
+};
+dojo.graphics.color.hsl2rgb = function (h, s, l) {
+	dojo.deprecated(&quot;dojo.graphics.color.hsl2rgb has been replaced with dojo.gfx.color.hsl2rgb&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.hsl2rgb(h, s, l);
+};
+dojo.graphics.color.hsl2hex = function (h, s, l) {
+	dojo.deprecated(&quot;dojo.graphics.color.hsl2hex has been replaced with dojo.gfx.color.hsl2hex&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.hsl2hex(h, s, l);
+};
+dojo.graphics.color.hex2hsl = function (hex) {
+	dojo.deprecated(&quot;dojo.graphics.color.hex2hsl has been replaced with dojo.gfx.color.hex2hsl&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.hex2hsl(hex);
+};
+

Added: tags/parley-0.55/root/static/magic/src/graphics/color/hsv.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/graphics/color/hsv.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/graphics/color/hsv.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.graphics.color.hsv&quot;);
+dojo.require(&quot;dojo.gfx.color.hsv&quot;);
+dojo.deprecated(&quot;dojo.graphics.color.hsv has been replaced by dojo.gfx.color.hsv&quot;, &quot;0.5&quot;);
+dojo.graphics.color.rgb2hsv = function (r, g, b) {
+	dojo.deprecated(&quot;dojo.graphics.color.rgb2hsv has been replaced by dojo.gfx.color.rgb2hsv&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.rgb2hsv(r, g, b);
+};
+dojo.graphics.color.hsv2rgb = function (h, s, v) {
+	dojo.deprecated(&quot;dojo.graphics.color.hsv2rgb has been replaced by dojo.gfx.color.hsv2rgb&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.hsv2rgb(h, s, v);
+};
+

Added: tags/parley-0.55/root/static/magic/src/graphics/color.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/graphics/color.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/graphics/color.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,38 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.graphics.color&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.deprecated(&quot;dojo.graphics.color.Color is now dojo.gfx.color.Color.&quot;, &quot;0.5&quot;);
+dojo.graphics.color.Color = dojo.gfx.color.Color;
+dojo.graphics.color.named = dojo.gfx.color.named;
+dojo.graphics.color.blend = function (a, b, weight) {
+	dojo.deprecated(&quot;dojo.graphics.color.blend is now dojo.gfx.color.blend&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.blend(a, b, weight);
+};
+dojo.graphics.color.blendHex = function (a, b, weight) {
+	dojo.deprecated(&quot;dojo.graphics.color.blendHex is now dojo.gfx.color.blendHex&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.rgb2hex(dojo.gfx.color.blend(dojo.gfx.color.hex2rgb(a), dojo.gfx.color.hex2rgb(b), weight));
+};
+dojo.graphics.color.extractRGB = function (color) {
+	dojo.deprecated(&quot;dojo.graphics.color.extractRGB is now dojo.gfx.color.extractRGB&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.extractRGB(color);
+};
+dojo.graphics.color.hex2rgb = function (hex) {
+	dojo.deprecated(&quot;dojo.graphics.color.hex2rgb is now dojo.gfx.color.hex2rgb&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.hex2rgb(hex);
+};
+dojo.graphics.color.rgb2hex = function (r, g, b) {
+	dojo.deprecated(&quot;dojo.graphics.color.rgb2hex is now dojo.gfx.color.rgb2hex&quot;, &quot;0.5&quot;);
+	return dojo.gfx.color.rgb2hex;
+};
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_adobesvg.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_adobesvg.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_adobesvg.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,380 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+if (typeof window == &quot;undefined&quot;) {
+	dojo.raise(&quot;attempt to use adobe svg hostenv when no window object&quot;);
+}
+with (dojo.render) {
+	name = navigator.appName;
+	ver = parseFloat(navigator.appVersion, 10);
+	switch (navigator.platform) {
+	  case &quot;MacOS&quot;:
+		os.osx = true;
+		break;
+	  case &quot;Linux&quot;:
+		os.linux = true;
+		break;
+	  case &quot;Windows&quot;:
+		os.win = true;
+		break;
+	  default:
+		os.linux = true;
+		break;
+	}
+	svg.capable = true;
+	svg.support.builtin = true;
+	svg.adobe = true;
+}
+dojo.hostenv.println = function (s) {
+	try {
+		var ti = document.createElement(&quot;text&quot;);
+		ti.setAttribute(&quot;x&quot;, &quot;50&quot;);
+		var yPos = 25 + 15 * document.getElementsByTagName(&quot;text&quot;).length;
+		ti.setAttribute(&quot;y&quot;, yPos);
+		var tn = document.createTextNode(s);
+		ti.appendChild(tn);
+		document.documentElement.appendChild(ti);
+	}
+	catch (e) {
+	}
+};
+dojo.debug = function () {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	var args = arguments;
+	if (typeof dojo.hostenv.println != &quot;function&quot;) {
+		dojo.raise(&quot;attempt to call dojo.debug when there is no dojo.hostenv println implementation (yet?)&quot;);
+	}
+	var isJUM = dj_global[&quot;jum&quot;];
+	var s = isJUM ? &quot;&quot; : &quot;DEBUG: &quot;;
+	for (var i = 0; i &lt; args.length; ++i) {
+		s += args[i];
+	}
+	if (isJUM) {
+		jum.debug(s);
+	} else {
+		dojo.hostenv.println(s);
+	}
+};
+dojo.hostenv.startPackage(&quot;dojo.hostenv&quot;);
+dojo.hostenv.name_ = &quot;adobesvg&quot;;
+dojo.hostenv.anonCtr = 0;
+dojo.hostenv.anon = {};
+dojo.hostenv.nameAnonFunc = function (anonFuncPtr, namespaceObj) {
+	var ret = &quot;_&quot; + this.anonCtr++;
+	var nso = (namespaceObj || this.anon);
+	while (typeof nso[ret] != &quot;undefined&quot;) {
+		ret = &quot;_&quot; + this.anonCtr++;
+	}
+	nso[ret] = anonFuncPtr;
+	return ret;
+};
+dojo.hostenv.modulesLoadedFired = false;
+dojo.hostenv.modulesLoadedListeners = [];
+dojo.hostenv.getTextStack = [];
+dojo.hostenv.loadUriStack = [];
+dojo.hostenv.loadedUris = [];
+dojo.hostenv.modulesLoaded = function () {
+	if (this.modulesLoadedFired) {
+		return;
+	}
+	if ((this.loadUriStack.length == 0) &amp;&amp; (this.getTextStack.length == 0)) {
+		if (this.inFlightCount &gt; 0) {
+			dojo.debug(&quot;couldn't initialize, there are files still in flight&quot;);
+			return;
+		}
+		this.modulesLoadedFired = true;
+		var mll = this.modulesLoadedListeners;
+		for (var x = 0; x &lt; mll.length; x++) {
+			mll[x]();
+		}
+	}
+};
+dojo.hostenv.getNewAnonFunc = function () {
+	var ret = &quot;_&quot; + this.anonCtr++;
+	while (typeof this.anon[ret] != &quot;undefined&quot;) {
+		ret = &quot;_&quot; + this.anonCtr++;
+	}
+	eval(&quot;dojo.nostenv.anon.&quot; + ret + &quot; = function(){};&quot;);
+	return [ret, this.anon[ret]];
+};
+dojo.hostenv.displayStack = function () {
+	var oa = [];
+	var stack = this.loadUriStack;
+	for (var x = 0; x &lt; stack.length; x++) {
+		oa.unshift([stack[x][0], (typeof stack[x][2])]);
+	}
+	dojo.debug(&quot;&lt;pre&gt;&quot; + oa.join(&quot;\n&quot;) + &quot;&lt;/pre&gt;&quot;);
+};
+dojo.hostenv.unwindUriStack = function () {
+	var stack = this.loadUriStack;
+	for (var x in dojo.hostenv.loadedUris) {
+		for (var y = stack.length - 1; y &gt;= 0; y--) {
+			if (stack[y][0] == x) {
+				stack.splice(y, 1);
+			}
+		}
+	}
+	var next = stack.pop();
+	if ((!next) &amp;&amp; (stack.length == 0)) {
+		return;
+	}
+	for (var x = 0; x &lt; stack.length; x++) {
+		if ((stack[x][0] == next[0]) &amp;&amp; (stack[x][2])) {
+			next[2] == stack[x][2];
+		}
+	}
+	var last = next;
+	while (dojo.hostenv.loadedUris[next[0]]) {
+		last = next;
+		next = stack.pop();
+	}
+	while (typeof next[2] == &quot;string&quot;) {
+		try {
+			dj_eval(next[2]);
+			next[1](true);
+		}
+		catch (e) {
+			dojo.debug(&quot;we got an error when loading &quot; + next[0]);
+			dojo.debug(&quot;error: &quot; + e);
+		}
+		dojo.hostenv.loadedUris[next[0]] = true;
+		dojo.hostenv.loadedUris.push(next[0]);
+		last = next;
+		next = stack.pop();
+		if ((!next) &amp;&amp; (stack.length == 0)) {
+			break;
+		}
+		while (dojo.hostenv.loadedUris[next[0]]) {
+			last = next;
+			next = stack.pop();
+		}
+	}
+	if (next) {
+		stack.push(next);
+		dojo.debug(&quot;### CHOKED ON: &quot; + next[0]);
+	}
+};
+dojo.hostenv.loadUri = function (uri, cb) {
+	if (dojo.hostenv.loadedUris[uri]) {
+		return;
+	}
+	var stack = this.loadUriStack;
+	stack.push([uri, cb, null]);
+	var tcb = function (contents) {
+		if (contents.content) {
+			contents = contents.content;
+		}
+		var next = stack.pop();
+		if ((!next) &amp;&amp; (stack.length == 0)) {
+			dojo.hostenv.modulesLoaded();
+			return;
+		}
+		if (typeof contents == &quot;string&quot;) {
+			stack.push(next);
+			for (var x = 0; x &lt; stack.length; x++) {
+				if (stack[x][0] == uri) {
+					stack[x][2] = contents;
+				}
+			}
+			next = stack.pop();
+		}
+		if (dojo.hostenv.loadedUris[next[0]]) {
+			dojo.hostenv.unwindUriStack();
+			return;
+		}
+		stack.push(next);
+		if (next[0] != uri) {
+			if (typeof next[2] == &quot;string&quot;) {
+				dojo.hostenv.unwindUriStack();
+			}
+		} else {
+			if (!contents) {
+				next[1](false);
+			} else {
+				var deps = dojo.hostenv.getDepsForEval(next[2]);
+				if (deps.length &gt; 0) {
+					eval(deps.join(&quot;;&quot;));
+				} else {
+					dojo.hostenv.unwindUriStack();
+				}
+			}
+		}
+	};
+	this.getText(uri, tcb, true);
+};
+dojo.hostenv.loadModule = function (modulename, exact_only, omit_module_check) {
+	var module = this.findModule(modulename, 0);
+	if (module) {
+		return module;
+	}
+	if (typeof this.loading_modules_[modulename] !== &quot;undefined&quot;) {
+		dojo.debug(&quot;recursive attempt to load module '&quot; + modulename + &quot;'&quot;);
+	} else {
+		this.addedToLoadingCount.push(modulename);
+	}
+	this.loading_modules_[modulename] = 1;
+	var relpath = modulename.replace(/\./g, &quot;/&quot;) + &quot;.js&quot;;
+	var syms = modulename.split(&quot;.&quot;);
+	var nsyms = modulename.split(&quot;.&quot;);
+	if (syms[0] == &quot;dojo&quot;) {
+		syms[0] = &quot;src&quot;;
+	}
+	var last = syms.pop();
+	syms.push(last);
+	var _this = this;
+	var pfn = this.pkgFileName;
+	if (last == &quot;*&quot;) {
+		modulename = (nsyms.slice(0, -1)).join(&quot;.&quot;);
+		var module = this.findModule(modulename, 0);
+		if (module) {
+			_this.removedFromLoadingCount.push(modulename);
+			return module;
+		}
+		var nextTry = function (lastStatus) {
+			if (lastStatus) {
+				module = _this.findModule(modulename, false);
+				if ((!module) &amp;&amp; (syms[syms.length - 1] != pfn)) {
+					dojo.raise(&quot;Module symbol '&quot; + modulename + &quot;' is not defined after loading '&quot; + relpath + &quot;'&quot;);
+				}
+				if (module) {
+					_this.removedFromLoadingCount.push(modulename);
+					dojo.hostenv.modulesLoaded();
+					return;
+				}
+			}
+			syms.pop();
+			syms.push(pfn);
+			relpath = syms.join(&quot;/&quot;) + &quot;.js&quot;;
+			if (relpath.charAt(0) == &quot;/&quot;) {
+				relpath = relpath.slice(1);
+			}
+			_this.loadPath(relpath, ((!omit_module_check) ? modulename : null), nextTry);
+		};
+		nextTry();
+	} else {
+		relpath = syms.join(&quot;/&quot;) + &quot;.js&quot;;
+		modulename = nsyms.join(&quot;.&quot;);
+		var nextTry = function (lastStatus) {
+			if (lastStatus) {
+				module = _this.findModule(modulename, false);
+				if ((!module) &amp;&amp; (syms[syms.length - 1] != pfn)) {
+					dojo.raise(&quot;Module symbol '&quot; + modulename + &quot;' is not defined after loading '&quot; + relpath + &quot;'&quot;);
+				}
+				if (module) {
+					_this.removedFromLoadingCount.push(modulename);
+					dojo.hostenv.modulesLoaded();
+					return;
+				}
+			}
+			var setPKG = (syms[syms.length - 1] == pfn) ? false : true;
+			syms.pop();
+			if (setPKG) {
+				syms.push(pfn);
+			}
+			relpath = syms.join(&quot;/&quot;) + &quot;.js&quot;;
+			if (relpath.charAt(0) == &quot;/&quot;) {
+				relpath = relpath.slice(1);
+			}
+			_this.loadPath(relpath, ((!omit_module_check) ? modulename : null), nextTry);
+		};
+		this.loadPath(relpath, ((!omit_module_check) ? modulename : null), nextTry);
+	}
+	return;
+};
+dojo.hostenv.async_cb = null;
+dojo.hostenv.unWindGetTextStack = function () {
+	if (dojo.hostenv.inFlightCount &gt; 0) {
+		setTimeout(&quot;dojo.hostenv.unWindGetTextStack()&quot;, 100);
+		return;
+	}
+	dojo.hostenv.inFlightCount++;
+	var next = dojo.hostenv.getTextStack.pop();
+	if ((!next) &amp;&amp; (dojo.hostenv.getTextStack.length == 0)) {
+		dojo.hostenv.inFlightCount--;
+		dojo.hostenv.async_cb = function () {
+		};
+		return;
+	}
+	dojo.hostenv.async_cb = next[1];
+	window.getURL(next[0], function (result) {
+		dojo.hostenv.inFlightCount--;
+		dojo.hostenv.async_cb(result.content);
+		dojo.hostenv.unWindGetTextStack();
+	});
+};
+dojo.hostenv.getText = function (uri, async_cb, fail_ok) {
+	try {
+		if (async_cb) {
+			dojo.hostenv.getTextStack.push([uri, async_cb, fail_ok]);
+			dojo.hostenv.unWindGetTextStack();
+		} else {
+			return dojo.raise(&quot;No synchronous XMLHTTP implementation available, for uri &quot; + uri);
+		}
+	}
+	catch (e) {
+		return dojo.raise(&quot;No XMLHTTP implementation available, for uri &quot; + uri);
+	}
+};
+dojo.hostenv.postText = function (uri, async_cb, text, fail_ok, mime_type, encoding) {
+	var http = null;
+	var async_callback = function (httpResponse) {
+		if (!httpResponse.success) {
+			dojo.raise(&quot;Request for uri '&quot; + uri + &quot;' resulted in &quot; + httpResponse.status);
+		}
+		if (!httpResponse.content) {
+			if (!fail_ok) {
+				dojo.raise(&quot;Request for uri '&quot; + uri + &quot;' resulted in no content&quot;);
+			}
+			return null;
+		}
+		async_cb(httpResponse.content);
+	};
+	try {
+		if (async_cb) {
+			http = window.postURL(uri, text, async_callback, mimeType, encoding);
+		} else {
+			return dojo.raise(&quot;No synchronous XMLHTTP post implementation available, for uri &quot; + uri);
+		}
+	}
+	catch (e) {
+		return dojo.raise(&quot;No XMLHTTP post implementation available, for uri &quot; + uri);
+	}
+};
+function dj_last_script_src() {
+	var scripts = window.document.getElementsByTagName(&quot;script&quot;);
+	if (scripts.length &lt; 1) {
+		dojo.raise(&quot;No script elements in window.document, so can't figure out my script src&quot;);
+	}
+	var li = scripts.length - 1;
+	var xlinkNS = &quot;<A HREF="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</A>&quot;;
+	var src = null;
+	var script = null;
+	while (!src) {
+		script = scripts.item(li);
+		src = script.getAttributeNS(xlinkNS, &quot;href&quot;);
+		li--;
+		if (li &lt; 0) {
+			break;
+		}
+	}
+	if (!src) {
+		dojo.raise(&quot;Last script element (out of &quot; + scripts.length + &quot;) has no src&quot;);
+	}
+	return src;
+}
+if (!dojo.hostenv[&quot;library_script_uri_&quot;]) {
+	dojo.hostenv.library_script_uri_ = dj_last_script_src();
+}
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_browser.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_browser.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_browser.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,417 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+if (typeof window != &quot;undefined&quot;) {
+	(function () {
+		if (djConfig.allowQueryConfig) {
+			var baseUrl = document.location.toString();
+			var params = baseUrl.split(&quot;?&quot;, 2);
+			if (params.length &gt; 1) {
+				var paramStr = params[1];
+				var pairs = paramStr.split(&quot;&amp;&quot;);
+				for (var x in pairs) {
+					var sp = pairs[x].split(&quot;=&quot;);
+					if ((sp[0].length &gt; 9) &amp;&amp; (sp[0].substr(0, 9) == &quot;djConfig.&quot;)) {
+						var opt = sp[0].substr(9);
+						try {
+							djConfig[opt] = eval(sp[1]);
+						}
+						catch (e) {
+							djConfig[opt] = sp[1];
+						}
+					}
+				}
+			}
+		}
+		if (((djConfig[&quot;baseScriptUri&quot;] == &quot;&quot;) || (djConfig[&quot;baseRelativePath&quot;] == &quot;&quot;)) &amp;&amp; (document &amp;&amp; document.getElementsByTagName)) {
+			var scripts = document.getElementsByTagName(&quot;script&quot;);
+			var rePkg = /(__package__|dojo|bootstrap1)\.js([\?\.]|$)/i;
+			for (var i = 0; i &lt; scripts.length; i++) {
+				var src = scripts[i].getAttribute(&quot;src&quot;);
+				if (!src) {
+					continue;
+				}
+				var m = src.match(rePkg);
+				if (m) {
+					var root = src.substring(0, m.index);
+					if (src.indexOf(&quot;bootstrap1&quot;) &gt; -1) {
+						root += &quot;../&quot;;
+					}
+					if (!this[&quot;djConfig&quot;]) {
+						djConfig = {};
+					}
+					if (djConfig[&quot;baseScriptUri&quot;] == &quot;&quot;) {
+						djConfig[&quot;baseScriptUri&quot;] = root;
+					}
+					if (djConfig[&quot;baseRelativePath&quot;] == &quot;&quot;) {
+						djConfig[&quot;baseRelativePath&quot;] = root;
+					}
+					break;
+				}
+			}
+		}
+		var dr = dojo.render;
+		var drh = dojo.render.html;
+		var drs = dojo.render.svg;
+		var dua = (drh.UA = navigator.userAgent);
+		var dav = (drh.AV = navigator.appVersion);
+		var t = true;
+		var f = false;
+		drh.capable = t;
+		drh.support.builtin = t;
+		dr.ver = parseFloat(drh.AV);
+		dr.os.mac = dav.indexOf(&quot;Macintosh&quot;) &gt;= 0;
+		dr.os.win = dav.indexOf(&quot;Windows&quot;) &gt;= 0;
+		dr.os.linux = dav.indexOf(&quot;X11&quot;) &gt;= 0;
+		drh.opera = dua.indexOf(&quot;Opera&quot;) &gt;= 0;
+		drh.khtml = (dav.indexOf(&quot;Konqueror&quot;) &gt;= 0) || (dav.indexOf(&quot;Safari&quot;) &gt;= 0);
+		drh.safari = dav.indexOf(&quot;Safari&quot;) &gt;= 0;
+		var geckoPos = dua.indexOf(&quot;Gecko&quot;);
+		drh.mozilla = drh.moz = (geckoPos &gt;= 0) &amp;&amp; (!drh.khtml);
+		if (drh.mozilla) {
+			drh.geckoVersion = dua.substring(geckoPos + 6, geckoPos + 14);
+		}
+		drh.ie = (document.all) &amp;&amp; (!drh.opera);
+		drh.ie50 = drh.ie &amp;&amp; dav.indexOf(&quot;MSIE 5.0&quot;) &gt;= 0;
+		drh.ie55 = drh.ie &amp;&amp; dav.indexOf(&quot;MSIE 5.5&quot;) &gt;= 0;
+		drh.ie60 = drh.ie &amp;&amp; dav.indexOf(&quot;MSIE 6.0&quot;) &gt;= 0;
+		drh.ie70 = drh.ie &amp;&amp; dav.indexOf(&quot;MSIE 7.0&quot;) &gt;= 0;
+		var cm = document[&quot;compatMode&quot;];
+		drh.quirks = (cm == &quot;BackCompat&quot;) || (cm == &quot;QuirksMode&quot;) || drh.ie55 || drh.ie50;
+		dojo.locale = dojo.locale || (drh.ie ? navigator.userLanguage : navigator.language).toLowerCase();
+		dr.vml.capable = drh.ie;
+		drs.capable = f;
+		drs.support.plugin = f;
+		drs.support.builtin = f;
+		var tdoc = window[&quot;document&quot;];
+		var tdi = tdoc[&quot;implementation&quot;];
+		if ((tdi) &amp;&amp; (tdi[&quot;hasFeature&quot;]) &amp;&amp; (tdi.hasFeature(&quot;org.w3c.dom.svg&quot;, &quot;1.0&quot;))) {
+			drs.capable = t;
+			drs.support.builtin = t;
+			drs.support.plugin = f;
+		}
+		if (drh.safari) {
+			var tmp = dua.split(&quot;AppleWebKit/&quot;)[1];
+			var ver = parseFloat(tmp.split(&quot; &quot;)[0]);
+			if (ver &gt;= 420) {
+				drs.capable = t;
+				drs.support.builtin = t;
+				drs.support.plugin = f;
+			}
+		} else {
+		}
+	})();
+	dojo.hostenv.startPackage(&quot;dojo.hostenv&quot;);
+	dojo.render.name = dojo.hostenv.name_ = &quot;browser&quot;;
+	dojo.hostenv.searchIds = [];
+	dojo.hostenv._XMLHTTP_PROGIDS = [&quot;Msxml2.XMLHTTP&quot;, &quot;Microsoft.XMLHTTP&quot;, &quot;Msxml2.XMLHTTP.4.0&quot;];
+	dojo.hostenv.getXmlhttpObject = function () {
+		var http = null;
+		var last_e = null;
+		try {
+			http = new XMLHttpRequest();
+		}
+		catch (e) {
+		}
+		if (!http) {
+			for (var i = 0; i &lt; 3; ++i) {
+				var progid = dojo.hostenv._XMLHTTP_PROGIDS[i];
+				try {
+					http = new ActiveXObject(progid);
+				}
+				catch (e) {
+					last_e = e;
+				}
+				if (http) {
+					dojo.hostenv._XMLHTTP_PROGIDS = [progid];
+					break;
+				}
+			}
+		}
+		if (!http) {
+			return dojo.raise(&quot;XMLHTTP not available&quot;, last_e);
+		}
+		return http;
+	};
+	dojo.hostenv._blockAsync = false;
+	dojo.hostenv.getText = function (uri, async_cb, fail_ok) {
+		if (!async_cb) {
+			this._blockAsync = true;
+		}
+		var http = this.getXmlhttpObject();
+		function isDocumentOk(http) {
+			var stat = http[&quot;status&quot;];
+			return Boolean((!stat) || ((200 &lt;= stat) &amp;&amp; (300 &gt; stat)) || (stat == 304));
+		}
+		if (async_cb) {
+			var _this = this, timer = null, gbl = dojo.global();
+			var xhr = dojo.evalObjPath(&quot;dojo.io.XMLHTTPTransport&quot;);
+			http.onreadystatechange = function () {
+				if (timer) {
+					gbl.clearTimeout(timer);
+					timer = null;
+				}
+				if (_this._blockAsync || (xhr &amp;&amp; xhr._blockAsync)) {
+					timer = gbl.setTimeout(function () {
+						http.onreadystatechange.apply(this);
+					}, 10);
+				} else {
+					if (4 == http.readyState) {
+						if (isDocumentOk(http)) {
+							async_cb(http.responseText);
+						}
+					}
+				}
+			};
+		}
+		http.open(&quot;GET&quot;, uri, async_cb ? true : false);
+		try {
+			http.send(null);
+			if (async_cb) {
+				return null;
+			}
+			if (!isDocumentOk(http)) {
+				var err = Error(&quot;Unable to load &quot; + uri + &quot; status:&quot; + http.status);
+				err.status = http.status;
+				err.responseText = http.responseText;
+				throw err;
+			}
+		}
+		catch (e) {
+			this._blockAsync = false;
+			if ((fail_ok) &amp;&amp; (!async_cb)) {
+				return null;
+			} else {
+				throw e;
+			}
+		}
+		this._blockAsync = false;
+		return http.responseText;
+	};
+	dojo.hostenv.defaultDebugContainerId = &quot;dojoDebug&quot;;
+	dojo.hostenv._println_buffer = [];
+	dojo.hostenv._println_safe = false;
+	dojo.hostenv.println = function (line) {
+		if (!dojo.hostenv._println_safe) {
+			dojo.hostenv._println_buffer.push(line);
+		} else {
+			try {
+				var console = document.getElementById(djConfig.debugContainerId ? djConfig.debugContainerId : dojo.hostenv.defaultDebugContainerId);
+				if (!console) {
+					console = dojo.body();
+				}
+				var div = document.createElement(&quot;div&quot;);
+				div.appendChild(document.createTextNode(line));
+				console.appendChild(div);
+			}
+			catch (e) {
+				try {
+					document.write(&quot;&lt;div&gt;&quot; + line + &quot;&lt;/div&gt;&quot;);
+				}
+				catch (e2) {
+					window.status = line;
+				}
+			}
+		}
+	};
+	dojo.addOnLoad(function () {
+		dojo.hostenv._println_safe = true;
+		while (dojo.hostenv._println_buffer.length &gt; 0) {
+			dojo.hostenv.println(dojo.hostenv._println_buffer.shift());
+		}
+	});
+	function dj_addNodeEvtHdlr(node, evtName, fp) {
+		var oldHandler = node[&quot;on&quot; + evtName] || function () {
+		};
+		node[&quot;on&quot; + evtName] = function () {
+			fp.apply(node, arguments);
+			oldHandler.apply(node, arguments);
+		};
+		return true;
+	}
+	dojo.hostenv._djInitFired = false;
+	function dj_load_init(e) {
+		dojo.hostenv._djInitFired = true;
+		var type = (e &amp;&amp; e.type) ? e.type.toLowerCase() : &quot;load&quot;;
+		if (arguments.callee.initialized || (type != &quot;domcontentloaded&quot; &amp;&amp; type != &quot;load&quot;)) {
+			return;
+		}
+		arguments.callee.initialized = true;
+		if (typeof (_timer) != &quot;undefined&quot;) {
+			clearInterval(_timer);
+			delete _timer;
+		}
+		var initFunc = function () {
+			if (dojo.render.html.ie) {
+				dojo.hostenv.makeWidgets();
+			}
+		};
+		if (dojo.hostenv.inFlightCount == 0) {
+			initFunc();
+			dojo.hostenv.modulesLoaded();
+		} else {
+			dojo.hostenv.modulesLoadedListeners.unshift(initFunc);
+		}
+	}
+	if (document.addEventListener) {
+		if (dojo.render.html.opera || (dojo.render.html.moz &amp;&amp; (djConfig[&quot;enableMozDomContentLoaded&quot;] === true))) {
+			document.addEventListener(&quot;DOMContentLoaded&quot;, dj_load_init, null);
+		}
+		window.addEventListener(&quot;load&quot;, dj_load_init, null);
+	}
+	if (dojo.render.html.ie &amp;&amp; dojo.render.os.win) {
+		document.attachEvent(&quot;onreadystatechange&quot;, function (e) {
+			if (document.readyState == &quot;complete&quot;) {
+				dj_load_init();
+			}
+		});
+	}
+	if (/(WebKit|khtml)/i.test(navigator.userAgent)) {
+		var _timer = setInterval(function () {
+			if (/loaded|complete/.test(document.readyState)) {
+				dj_load_init();
+			}
+		}, 10);
+	}
+	if (dojo.render.html.ie) {
+		dj_addNodeEvtHdlr(window, &quot;beforeunload&quot;, function () {
+			dojo.hostenv._unloading = true;
+			window.setTimeout(function () {
+				dojo.hostenv._unloading = false;
+			}, 0);
+		});
+	}
+	dj_addNodeEvtHdlr(window, &quot;unload&quot;, function () {
+		dojo.hostenv.unloaded();
+		if ((!dojo.render.html.ie) || (dojo.render.html.ie &amp;&amp; dojo.hostenv._unloading)) {
+			dojo.hostenv.unloaded();
+		}
+	});
+	dojo.hostenv.makeWidgets = function () {
+		var sids = [];
+		if (djConfig.searchIds &amp;&amp; djConfig.searchIds.length &gt; 0) {
+			sids = sids.concat(djConfig.searchIds);
+		}
+		if (dojo.hostenv.searchIds &amp;&amp; dojo.hostenv.searchIds.length &gt; 0) {
+			sids = sids.concat(dojo.hostenv.searchIds);
+		}
+		if ((djConfig.parseWidgets) || (sids.length &gt; 0)) {
+			if (dojo.evalObjPath(&quot;dojo.widget.Parse&quot;)) {
+				var parser = new dojo.xml.Parse();
+				if (sids.length &gt; 0) {
+					for (var x = 0; x &lt; sids.length; x++) {
+						var tmpNode = document.getElementById(sids[x]);
+						if (!tmpNode) {
+							continue;
+						}
+						var frag = parser.parseElement(tmpNode, null, true);
+						dojo.widget.getParser().createComponents(frag);
+					}
+				} else {
+					if (djConfig.parseWidgets) {
+						var frag = parser.parseElement(dojo.body(), null, true);
+						dojo.widget.getParser().createComponents(frag);
+					}
+				}
+			}
+		}
+	};
+	dojo.addOnLoad(function () {
+		if (!dojo.render.html.ie) {
+			dojo.hostenv.makeWidgets();
+		}
+	});
+	try {
+		if (dojo.render.html.ie) {
+			document.namespaces.add(&quot;v&quot;, &quot;urn:schemas-microsoft-com:vml&quot;);
+			document.createStyleSheet().addRule(&quot;v\\:*&quot;, &quot;behavior:url(#default#VML)&quot;);
+		}
+	}
+	catch (e) {
+	}
+	dojo.hostenv.writeIncludes = function () {
+	};
+	if (!dj_undef(&quot;document&quot;, this)) {
+		dj_currentDocument = this.document;
+	}
+	dojo.doc = function () {
+		return dj_currentDocument;
+	};
+	dojo.body = function () {
+		return dojo.doc().body || dojo.doc().getElementsByTagName(&quot;body&quot;)[0];
+	};
+	dojo.byId = function (id, doc) {
+		if ((id) &amp;&amp; ((typeof id == &quot;string&quot;) || (id instanceof String))) {
+			if (!doc) {
+				doc = dj_currentDocument;
+			}
+			var ele = doc.getElementById(id);
+			if (ele &amp;&amp; (ele.id != id) &amp;&amp; doc.all) {
+				ele = null;
+				eles = doc.all[id];
+				if (eles) {
+					if (eles.length) {
+						for (var i = 0; i &lt; eles.length; i++) {
+							if (eles[i].id == id) {
+								ele = eles[i];
+								break;
+							}
+						}
+					} else {
+						ele = eles;
+					}
+				}
+			}
+			return ele;
+		}
+		return id;
+	};
+	dojo.setContext = function (globalObject, globalDocument) {
+		dj_currentContext = globalObject;
+		dj_currentDocument = globalDocument;
+	};
+	dojo._fireCallback = function (callback, context, cbArguments) {
+		if ((context) &amp;&amp; ((typeof callback == &quot;string&quot;) || (callback instanceof String))) {
+			callback = context[callback];
+		}
+		return (context ? callback.apply(context, cbArguments || []) : callback());
+	};
+	dojo.withGlobal = function (globalObject, callback, thisObject, cbArguments) {
+		var rval;
+		var oldGlob = dj_currentContext;
+		var oldDoc = dj_currentDocument;
+		try {
+			dojo.setContext(globalObject, globalObject.document);
+			rval = dojo._fireCallback(callback, thisObject, cbArguments);
+		}
+		finally {
+			dojo.setContext(oldGlob, oldDoc);
+		}
+		return rval;
+	};
+	dojo.withDoc = function (documentObject, callback, thisObject, cbArguments) {
+		var rval;
+		var oldDoc = dj_currentDocument;
+		try {
+			dj_currentDocument = documentObject;
+			rval = dojo._fireCallback(callback, thisObject, cbArguments);
+		}
+		finally {
+			dj_currentDocument = oldDoc;
+		}
+		return rval;
+	};
+}
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);
+dojo.requireIf(djConfig[&quot;debugAtAllCosts&quot;] &amp;&amp; !window.widget &amp;&amp; !djConfig[&quot;useXDomain&quot;], &quot;dojo.browser_debug&quot;);
+dojo.requireIf(djConfig[&quot;debugAtAllCosts&quot;] &amp;&amp; !window.widget &amp;&amp; djConfig[&quot;useXDomain&quot;], &quot;dojo.browser_debug_xd&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_dashboard.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_dashboard.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_dashboard.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,180 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.render.name = dojo.hostenv.name_ = &quot;dashboard&quot;;
+dojo.hostenv.println = function (message) {
+	return alert(message);
+};
+dojo.hostenv.getXmlhttpObject = function (kwArgs) {
+	if (widget.system &amp;&amp; kwArgs) {
+		if ((kwArgs.contentType &amp;&amp; kwArgs.contentType.indexOf(&quot;text/&quot;) != 0) || (kwArgs.headers &amp;&amp; kwArgs.headers[&quot;content-type&quot;] &amp;&amp; kwArgs.headers[&quot;content-type&quot;].indexOf(&quot;text/&quot;) != 0)) {
+			var curl = new dojo.hostenv.CurlRequest;
+			curl._save = true;
+			return curl;
+		} else {
+			if (kwArgs.method &amp;&amp; kwArgs.method.toUpperCase() == &quot;HEAD&quot;) {
+				return new dojo.hostenv.CurlRequest;
+			} else {
+				if (kwArgs.headers &amp;&amp; kwArgs.header.referer) {
+					return new dojo.hostenv.CurlRequest;
+				}
+			}
+		}
+	}
+	return new XMLHttpRequest;
+};
+dojo.hostenv.CurlRequest = function () {
+	this.onreadystatechange = null;
+	this.readyState = 0;
+	this.responseText = &quot;&quot;;
+	this.responseXML = null;
+	this.status = 0;
+	this.statusText = &quot;&quot;;
+	this._method = &quot;&quot;;
+	this._url = &quot;&quot;;
+	this._async = true;
+	this._referrer = &quot;&quot;;
+	this._headers = [];
+	this._save = false;
+	this._responseHeader = &quot;&quot;;
+	this._responseHeaders = {};
+	this._fileName = &quot;&quot;;
+	this._username = &quot;&quot;;
+	this._password = &quot;&quot;;
+};
+dojo.hostenv.CurlRequest.prototype.open = function (method, url, async, username, password) {
+	this._method = method;
+	this._url = url;
+	if (async) {
+		this._async = async;
+	}
+	if (username) {
+		this._username = username;
+	}
+	if (password) {
+		this._password = password;
+	}
+};
+dojo.hostenv.CurlRequest.prototype.setRequestHeader = function (label, value) {
+	switch (label) {
+	  case &quot;Referer&quot;:
+		this._referrer = value;
+		break;
+	  case &quot;content-type&quot;:
+		break;
+	  default:
+		this._headers.push(label + &quot;=&quot; + value);
+		break;
+	}
+};
+dojo.hostenv.CurlRequest.prototype.getAllResponseHeaders = function () {
+	return this._responseHeader;
+};
+dojo.hostenv.CurlRequest.prototype.getResponseHeader = function (headerLabel) {
+	return this._responseHeaders[headerLabel];
+};
+dojo.hostenv.CurlRequest.prototype.send = function (content) {
+	this.readyState = 1;
+	if (this.onreadystatechange) {
+		this.onreadystatechange.call(this);
+	}
+	var query = {sS:&quot;&quot;};
+	if (this._referrer) {
+		query.e = this._referrer;
+	}
+	if (this._headers.length) {
+		query.H = this._headers.join(&quot;&amp;&quot;);
+	}
+	if (this._username) {
+		if (this._password) {
+			query.u = this._username + &quot;:&quot; + this._password;
+		} else {
+			query.u = this._username;
+		}
+	}
+	if (content) {
+		query.d = this.content;
+		if (this._method != &quot;POST&quot;) {
+			query.G = &quot;&quot;;
+		}
+	}
+	if (this._method == &quot;HEAD&quot;) {
+		query.I = &quot;&quot;;
+	} else {
+		if (this._save) {
+			query.I = &quot;&quot;;
+		} else {
+			query.i = &quot;&quot;;
+		}
+	}
+	var system = widget.system(dojo.hostenv.CurlRequest._formatCall(query, this._url), null);
+	this.readyState = 2;
+	if (this.onreadystatechange) {
+		this.onreadystatechange.call(this);
+	}
+	if (system.errorString) {
+		this.responseText = system.errorString;
+		this.status = 0;
+	} else {
+		if (this._save) {
+			this._responseHeader = system.outputString;
+		} else {
+			var split = system.outputString.replace(/\r/g, &quot;&quot;).split(&quot;\n\n&quot;, 2);
+			this._responseHeader = split[0];
+			this.responseText = split[1];
+		}
+		split = this._responseHeader.split(&quot;\n&quot;);
+		this.statusText = split.shift();
+		this.status = this.statusText.split(&quot; &quot;)[1];
+		for (var i = 0, header; header = split[i]; i++) {
+			var header_split = header.split(&quot;: &quot;, 2);
+			this._responseHeaders[header_split[0]] = header_split[1];
+		}
+		if (this._save) {
+			widget.system(&quot;/bin/mkdir cache&quot;, null);
+			this._fileName = this._url.split(&quot;/&quot;).pop().replace(/\W/g, &quot;&quot;);
+			this._fileName += &quot;.&quot; + this._responseHeaders[&quot;Content-Type&quot;].replace(/[\r\n]/g, &quot;&quot;).split(&quot;/&quot;).pop();
+			delete query.I;
+			query.o = &quot;cache/&quot; + this._fileName;
+			system = widget.system(dojo.hostenv.CurlRequest._formatCall(query, this._url), null);
+			if (!system.errorString) {
+				this.responseText = &quot;cache/&quot; + this._fileName;
+			}
+		} else {
+			if (this._method == &quot;HEAD&quot;) {
+				this.responseText = this._responseHeader;
+			}
+		}
+	}
+	this.readyState = 4;
+	if (this.onreadystatechange) {
+		this.onreadystatechange.call(this);
+	}
+};
+dojo.hostenv.CurlRequest._formatCall = function (query, url) {
+	var call = [&quot;/usr/bin/curl&quot;];
+	for (var key in query) {
+		if (query[key] != &quot;&quot;) {
+			call.push(&quot;-&quot; + key + &quot; '&quot; + query[key].replace(/'/g, &quot;'&quot;) + &quot;'&quot;);
+		} else {
+			call.push(&quot;-&quot; + key);
+		}
+	}
+	call.push(&quot;'&quot; + url.replace(/'/g, &quot;'&quot;) + &quot;'&quot;);
+	return call.join(&quot; &quot;);
+};
+dojo.hostenv.exit = function () {
+	if (widget.system) {
+		widget.system(&quot;/bin/rm -rf cache/*&quot;, null);
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_jsc.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_jsc.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_jsc.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,78 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+/*
+ * JScript .NET jsc
+ *
+ */
+
+dojo.hostenv.name_ = 'jsc';
+
+// Sanity check this is the right hostenv.
+// See the Rotor source code jscript/engine/globalobject.cs for what globals
+// are available.
+if((typeof ScriptEngineMajorVersion != 'function')||(ScriptEngineMajorVersion() &lt; 7)){
+	dojo.raise(&quot;attempt to use JScript .NET host environment with inappropriate ScriptEngine&quot;); 
+}
+
+// for more than you wanted to know about why this import is required even if
+// we fully qualify all symbols, see
+// <A HREF="http://groups.google.com/groups?th=f050c7aeefdcbde2&amp;rnum=12">http://groups.google.com/groups?th=f050c7aeefdcbde2&amp;rnum=12</A>
+import System;
+
+dojo.hostenv.getText = function(uri){
+	if(!System.IO.File.Exists(uri)){
+		// dojo.raise(&quot;No such file '&quot; + uri + &quot;'&quot;);
+		return 0;
+	}
+	var reader = new System.IO.StreamReader(uri);
+	var contents : String = reader.ReadToEnd();
+	return contents;
+}
+
+dojo.hostenv.loadUri = function(uri){
+	var contents = this.getText(uri);
+	if(!contents){
+		dojo.raise(&quot;got no back contents from uri '&quot; + uri + &quot;': &quot; + contents);
+	}
+	// TODO: in JScript .NET, eval will not affect the symbol table of the current code?
+	var value = dj_eval(contents);
+	dojo.debug(&quot;jsc eval of contents returned: &quot;, value);
+	return 1;
+
+	// for an example doing runtime code compilation, see:
+	// <A HREF="http://groups.google.com/groups?selm=eQ1aeciCBHA.1644%40tkmsftngp05&amp;rnum=6">http://groups.google.com/groups?selm=eQ1aeciCBHA.1644%40tkmsftngp05&amp;rnum=6</A>
+	// Microsoft.JScript or System.CodeDom.Compiler ?
+	// var engine = new Microsoft.JScript.Vsa.VsaEngine()
+	// what about loading a js file vs. a dll?
+	// GetObject(&quot;script:&quot; . uri);
+}
+
+/* The System.Environment object is useful:
+    print (&quot;CommandLine='&quot; + System.Environment.CommandLine + &quot;' &quot; +
+	   &quot;program name='&quot; + System.Environment.GetCommandLineArgs()[0] + &quot;' &quot; +
+	   &quot;CurrentDirectory='&quot; + System.Environment.CurrentDirectory + &quot;' &quot; +
+	   &quot;StackTrace='&quot; + System.Environment.StackTrace + &quot;'&quot;);
+*/
+
+// same as System.Console.WriteLine
+// sigh; Rotor treats symbol &quot;print&quot; at parse time without actually putting it
+// in the builtin symbol table.
+// Note that the print symbol is not available if jsc is run with the &quot;/print-&quot;
+// option.
+dojo.hostenv.println = function(s){
+	print(s); // = print
+}
+
+dojo.hostenv.getLibraryScriptUri = function(){
+	return System.Environment.GetCommandLineArgs()[0];
+}
+
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);

Added: tags/parley-0.55/root/static/magic/src/hostenv_rhino.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_rhino.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_rhino.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,163 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.hostenv.println = function (line) {
+	if (arguments.length &gt; 0) {
+		print(arguments[0]);
+		for (var i = 1; i &lt; arguments.length; i++) {
+			var valid = false;
+			for (var p in arguments[i]) {
+				valid = true;
+				break;
+			}
+			if (valid) {
+				dojo.debugShallow(arguments[i]);
+			}
+		}
+	} else {
+		print(line);
+	}
+};
+dojo.locale = dojo.locale || java.util.Locale.getDefault().toString().replace(&quot;_&quot;, &quot;-&quot;).toLowerCase();
+dojo.render.name = dojo.hostenv.name_ = &quot;rhino&quot;;
+dojo.hostenv.getVersion = function () {
+	return version();
+};
+if (dj_undef(&quot;byId&quot;)) {
+	dojo.byId = function (id, doc) {
+		if (id &amp;&amp; (typeof id == &quot;string&quot; || id instanceof String)) {
+			if (!doc) {
+				doc = document;
+			}
+			return doc.getElementById(id);
+		}
+		return id;
+	};
+}
+dojo.hostenv.loadUri = function (uri, cb) {
+	try {
+		var local = (new java.io.File(uri)).exists();
+		if (!local) {
+			try {
+				var stream = (new java.net.URL(uri)).openStream();
+				stream.close();
+			}
+			catch (e) {
+				return false;
+			}
+		}
+		if (cb) {
+			var contents = (local ? readText : readUri)(uri, &quot;UTF-8&quot;);
+			cb(eval(&quot;(&quot; + contents + &quot;)&quot;));
+		} else {
+			load(uri);
+		}
+		return true;
+	}
+	catch (e) {
+		dojo.debug(&quot;rhino load('&quot; + uri + &quot;') failed. Exception: &quot; + e);
+		return false;
+	}
+};
+dojo.hostenv.exit = function (exitcode) {
+	quit(exitcode);
+};
+function dj_rhino_current_script_via_java(depth) {
+	var optLevel = Packages.org.mozilla.javascript.Context.getCurrentContext().getOptimizationLevel();
+	var caw = new java.io.CharArrayWriter();
+	var pw = new java.io.PrintWriter(caw);
+	var exc = new java.lang.Exception();
+	var s = caw.toString();
+	var matches = s.match(/[^\(]*\.js\)/gi);
+	if (!matches) {
+		throw Error(&quot;cannot parse printStackTrace output: &quot; + s);
+	}
+	var fname = ((typeof depth != &quot;undefined&quot;) &amp;&amp; (depth)) ? matches[depth + 1] : matches[matches.length - 1];
+	var fname = matches[3];
+	if (!fname) {
+		fname = matches[1];
+	}
+	if (!fname) {
+		throw Error(&quot;could not find js file in printStackTrace output: &quot; + s);
+	}
+	return fname;
+}
+function readText(path, encoding) {
+	encoding = encoding || &quot;utf-8&quot;;
+	var jf = new java.io.File(path);
+	var is = new java.io.FileInputStream(jf);
+	return dj_readInputStream(is, encoding);
+}
+function readUri(uri, encoding) {
+	var conn = (new java.net.URL(uri)).openConnection();
+	encoding = encoding || conn.getContentEncoding() || &quot;utf-8&quot;;
+	var is = conn.getInputStream();
+	return dj_readInputStream(is, encoding);
+}
+function dj_readInputStream(is, encoding) {
+	var input = new java.io.BufferedReader(new java.io.InputStreamReader(is, encoding));
+	try {
+		var sb = new java.lang.StringBuffer();
+		var line = &quot;&quot;;
+		while ((line = input.readLine()) !== null) {
+			sb.append(line);
+			sb.append(java.lang.System.getProperty(&quot;line.separator&quot;));
+		}
+		return sb.toString();
+	}
+	finally {
+		input.close();
+	}
+}
+if (!djConfig.libraryScriptUri.length) {
+	try {
+		djConfig.libraryScriptUri = dj_rhino_current_script_via_java(1);
+	}
+	catch (e) {
+		if (djConfig[&quot;isDebug&quot;]) {
+			print(&quot;\n&quot;);
+			print(&quot;we have no idea where Dojo is located.&quot;);
+			print(&quot;Please try loading rhino in a non-interpreted mode or set a&quot;);
+			print(&quot;\n\tdjConfig.libraryScriptUri\n&quot;);
+			print(&quot;Setting the dojo path to './'&quot;);
+			print(&quot;This is probably wrong!&quot;);
+			print(&quot;\n&quot;);
+			print(&quot;Dojo will try to load anyway&quot;);
+		}
+		djConfig.libraryScriptUri = &quot;./&quot;;
+	}
+}
+dojo.doc = function () {
+	return document;
+};
+dojo.body = function () {
+	return document.body;
+};
+function setTimeout(func, delay) {
+	var def = {sleepTime:delay, hasSlept:false, run:function () {
+		if (!this.hasSlept) {
+			this.hasSlept = true;
+			java.lang.Thread.currentThread().sleep(this.sleepTime);
+		}
+		try {
+			func();
+		}
+		catch (e) {
+			dojo.debug(&quot;Error running setTimeout thread:&quot; + e);
+		}
+	}};
+	var runnable = new java.lang.Runnable(def);
+	var thread = new java.lang.Thread(runnable);
+	thread.start();
+}
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_spidermonkey.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_spidermonkey.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_spidermonkey.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,50 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.hostenv.name_ = &quot;spidermonkey&quot;;
+dojo.hostenv.println = print;
+dojo.hostenv.exit = function (exitcode) {
+	quit(exitcode);
+};
+dojo.hostenv.getVersion = function () {
+	return version();
+};
+if (typeof line2pc == &quot;undefined&quot;) {
+	dojo.raise(&quot;attempt to use SpiderMonkey host environment when no 'line2pc' global&quot;);
+}
+function dj_spidermonkey_current_file(depth) {
+	var s = &quot;&quot;;
+	try {
+		throw Error(&quot;whatever&quot;);
+	}
+	catch (e) {
+		s = e.stack;
+	}
+	var matches = s.match(/[^@]*\.js/gi);
+	if (!matches) {
+		dojo.raise(&quot;could not parse stack string: '&quot; + s + &quot;'&quot;);
+	}
+	var fname = (typeof depth != &quot;undefined&quot; &amp;&amp; depth) ? matches[depth + 1] : matches[matches.length - 1];
+	if (!fname) {
+		dojo.raise(&quot;could not find file name in stack string '&quot; + s + &quot;'&quot;);
+	}
+	return fname;
+}
+if (!dojo.hostenv.library_script_uri_) {
+	dojo.hostenv.library_script_uri_ = dj_spidermonkey_current_file(0);
+}
+dojo.hostenv.loadUri = function (uri) {
+	var ok = load(uri);
+	return 1;
+};
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_svg.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_svg.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_svg.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,247 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+if (typeof window == &quot;undefined&quot;) {
+	dojo.raise(&quot;attempt to use adobe svg hostenv when no window object&quot;);
+}
+dojo.debug = function () {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	var args = arguments;
+	var isJUM = dj_global[&quot;jum&quot;];
+	var s = isJUM ? &quot;&quot; : &quot;DEBUG: &quot;;
+	for (var i = 0; i &lt; args.length; ++i) {
+		s += args[i];
+	}
+	if (isJUM) {
+		jum.debug(s);
+	} else {
+		dojo.hostenv.println(s);
+	}
+};
+dojo.render.name = navigator.appName;
+dojo.render.ver = parseFloat(navigator.appVersion, 10);
+switch (navigator.platform) {
+  case &quot;MacOS&quot;:
+	dojo.render.os.osx = true;
+	break;
+  case &quot;Linux&quot;:
+	dojo.render.os.linux = true;
+	break;
+  case &quot;Windows&quot;:
+	dojo.render.os.win = true;
+	break;
+  default:
+	dojo.render.os.linux = true;
+	break;
+}
+dojo.render.svg.capable = true;
+dojo.render.svg.support.builtin = true;
+dojo.render.svg.moz = ((navigator.userAgent.indexOf(&quot;Gecko&quot;) &gt;= 0) &amp;&amp; (!((navigator.appVersion.indexOf(&quot;Konqueror&quot;) &gt;= 0) || (navigator.appVersion.indexOf(&quot;Safari&quot;) &gt;= 0))));
+dojo.render.svg.adobe = (window.parseXML != null);
+dojo.hostenv.startPackage(&quot;dojo.hostenv&quot;);
+dojo.hostenv.println = function (s) {
+	try {
+		var ti = document.createElement(&quot;text&quot;);
+		ti.setAttribute(&quot;x&quot;, &quot;50&quot;);
+		ti.setAttribute(&quot;y&quot;, (25 + 15 * document.getElementsByTagName(&quot;text&quot;).length));
+		ti.appendChild(document.createTextNode(s));
+		document.documentElement.appendChild(ti);
+	}
+	catch (e) {
+	}
+};
+dojo.hostenv.name_ = &quot;svg&quot;;
+dojo.hostenv.setModulePrefix = function (module, prefix) {
+};
+dojo.hostenv.getModulePrefix = function (module) {
+};
+dojo.hostenv.getTextStack = [];
+dojo.hostenv.loadUriStack = [];
+dojo.hostenv.loadedUris = [];
+dojo.hostenv.modules_ = {};
+dojo.hostenv.modulesLoadedFired = false;
+dojo.hostenv.modulesLoadedListeners = [];
+dojo.hostenv.getText = function (uri, cb, data) {
+	if (!cb) {
+		var cb = function (result) {
+			window.alert(result);
+		};
+	}
+	if (!data) {
+		window.getUrl(uri, cb);
+	} else {
+		window.postUrl(uri, data, cb);
+	}
+};
+dojo.hostenv.getLibaryScriptUri = function () {
+};
+dojo.hostenv.loadUri = function (uri) {
+};
+dojo.hostenv.loadUriAndCheck = function (uri, module) {
+};
+dojo.hostenv.loadModule = function (moduleName) {
+	var a = moduleName.split(&quot;.&quot;);
+	var currentObj = window;
+	var s = [];
+	for (var i = 0; i &lt; a.length; i++) {
+		if (a[i] == &quot;*&quot;) {
+			continue;
+		}
+		s.push(a[i]);
+		if (!currentObj[a[i]]) {
+			dojo.raise(&quot;dojo.require('&quot; + moduleName + &quot;'): module does not exist.&quot;);
+		} else {
+			currentObj = currentObj[a[i]];
+		}
+	}
+	return;
+};
+dojo.hostenv.startPackage = function (moduleName) {
+	var a = moduleName.split(&quot;.&quot;);
+	var currentObj = window;
+	var s = [];
+	for (var i = 0; i &lt; a.length; i++) {
+		if (a[i] == &quot;*&quot;) {
+			continue;
+		}
+		s.push(a[i]);
+		if (!currentObj[a[i]]) {
+			currentObj[a[i]] = {};
+		}
+		currentObj = currentObj[a[i]];
+	}
+	return;
+};
+if (window.parseXML) {
+	window.XMLSerialzer = function () {
+		function nodeToString(n, a) {
+			function fixText(s) {
+				return String(s).replace(/\&amp;/g, &quot;&amp;&quot;).replace(/&gt;/g, &quot;&gt;&quot;).replace(/&lt;/g, &quot;&lt;&quot;);
+			}
+			function fixAttribute(s) {
+				return fixText(s).replace(/\&quot;/g, &quot;&quot;&quot;);
+			}
+			switch (n.nodeType) {
+			  case 1:
+				var name = n.nodeName;
+				a.push(&quot;&lt;&quot; + name);
+				for (var i = 0; i &lt; n.attributes.length; i++) {
+					if (n.attributes.item(i).specified) {
+						a.push(&quot; &quot; + n.attributes.item(i).nodeName.toLowerCase() + &quot;=\&quot;&quot; + fixAttribute(n.attributes.item(i).nodeValue) + &quot;\&quot;&quot;);
+					}
+				}
+				if (n.canHaveChildren || n.hasChildNodes()) {
+					a.push(&quot;&gt;&quot;);
+					for (var i = 0; i &lt; n.childNodes.length; i++) {
+						nodeToString(n.childNodes.item(i), a);
+					}
+					a.push(&quot;&lt;/&quot; + name + &quot;&gt;\n&quot;);
+				} else {
+					a.push(&quot; /&gt;\n&quot;);
+				}
+				break;
+			  case 3:
+				a.push(fixText(n.nodeValue));
+				break;
+			  case 4:
+				a.push(&quot;&lt;![CDA&quot; + &quot;TA[\n&quot; + n.nodeValue + &quot;\n]&quot; + &quot;]&gt;&quot;);
+				break;
+			  case 7:
+				a.push(n.nodeValue);
+				if (/(^&lt;\?xml)|(^&lt;\!DOCTYPE)/.test(n.nodeValue)) {
+					a.push(&quot;\n&quot;);
+				}
+				break;
+			  case 8:
+				a.push(&quot;&lt;!-- &quot; + n.nodeValue + &quot; --&gt;\n&quot;);
+				break;
+			  case 9:
+			  case 11:
+				for (var i = 0; i &lt; n.childNodes.length; i++) {
+					nodeToString(n.childNodes.item(i), a);
+				}
+				break;
+			  default:
+				a.push(&quot;&lt;!--\nNot Supported:\n\n&quot; + &quot;nodeType: &quot; + n.nodeType + &quot;\nnodeName: &quot; + n.nodeName + &quot;\n--&gt;&quot;);
+			}
+		}
+		this.serializeToString = function (node) {
+			var a = [];
+			nodeToString(node, a);
+			return a.join(&quot;&quot;);
+		};
+	};
+	window.DOMParser = function () {
+		this.parseFromString = function (s) {
+			return parseXML(s, window.document);
+		};
+	};
+	window.XMLHttpRequest = function () {
+		var uri = null;
+		var method = &quot;POST&quot;;
+		var isAsync = true;
+		var cb = function (d) {
+			this.responseText = d.content;
+			try {
+				this.responseXML = parseXML(this.responseText, window.document);
+			}
+			catch (e) {
+			}
+			this.status = &quot;200&quot;;
+			this.statusText = &quot;OK&quot;;
+			if (!d.success) {
+				this.status = &quot;500&quot;;
+				this.statusText = &quot;Internal Server Error&quot;;
+			}
+			this.onload();
+			this.onreadystatechange();
+		};
+		this.onload = function () {
+		};
+		this.readyState = 4;
+		this.onreadystatechange = function () {
+		};
+		this.status = 0;
+		this.statusText = &quot;&quot;;
+		this.responseBody = null;
+		this.responseStream = null;
+		this.responseXML = null;
+		this.responseText = null;
+		this.abort = function () {
+			return;
+		};
+		this.getAllResponseHeaders = function () {
+			return [];
+		};
+		this.getResponseHeader = function (n) {
+			return null;
+		};
+		this.setRequestHeader = function (nm, val) {
+		};
+		this.open = function (meth, url, async) {
+			method = meth;
+			uri = url;
+		};
+		this.send = function (data) {
+			var d = data || null;
+			if (method == &quot;GET&quot;) {
+				getURL(uri, cb);
+			} else {
+				postURL(uri, data, cb);
+			}
+		};
+	};
+}
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/hostenv_wsh.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/hostenv_wsh.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/hostenv_wsh.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.hostenv.name_ = &quot;wsh&quot;;
+if (typeof WScript == &quot;undefined&quot;) {
+	dojo.raise(&quot;attempt to use WSH host environment when no WScript global&quot;);
+}
+dojo.hostenv.println = WScript.Echo;
+dojo.hostenv.getCurrentScriptUri = function () {
+	return WScript.ScriptFullName();
+};
+dojo.hostenv.getText = function (fpath) {
+	var fso = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
+	var istream = fso.OpenTextFile(fpath, 1);
+	if (!istream) {
+		return null;
+	}
+	var contents = istream.ReadAll();
+	istream.Close();
+	return contents;
+};
+dojo.hostenv.exit = function (exitcode) {
+	WScript.Quit(exitcode);
+};
+dojo.requireIf((djConfig[&quot;isDebug&quot;] || djConfig[&quot;debugAtAllCosts&quot;]), &quot;dojo.debug&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/html/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.html.common&quot;, &quot;dojo.html.style&quot;]});
+dojo.provide(&quot;dojo.html.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/html/color.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/color.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/color.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,38 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.provide(&quot;dojo.html.color&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.html.getBackgroundColor = function (node) {
+	node = dojo.byId(node);
+	var color;
+	do {
+		color = dojo.html.getStyle(node, &quot;background-color&quot;);
+		if (color.toLowerCase() == &quot;rgba(0, 0, 0, 0)&quot;) {
+			color = &quot;transparent&quot;;
+		}
+		if (node == document.getElementsByTagName(&quot;body&quot;)[0]) {
+			node = null;
+			break;
+		}
+		node = node.parentNode;
+	} while (node &amp;&amp; dojo.lang.inArray([&quot;transparent&quot;, &quot;&quot;], color));
+	if (color == &quot;transparent&quot;) {
+		color = [255, 255, 255, 0];
+	} else {
+		color = dojo.gfx.color.extractRGB(color);
+	}
+	return color;
+};
+

Added: tags/parley-0.55/root/static/magic/src/html/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,182 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.lang.mixin(dojo.html, dojo.dom);
+dojo.html.body = function () {
+	dojo.deprecated(&quot;dojo.html.body() moved to dojo.body()&quot;, &quot;0.5&quot;);
+	return dojo.body();
+};
+dojo.html.getEventTarget = function (evt) {
+	if (!evt) {
+		evt = dojo.global().event || {};
+	}
+	var t = (evt.srcElement ? evt.srcElement : (evt.target ? evt.target : null));
+	while ((t) &amp;&amp; (t.nodeType != 1)) {
+		t = t.parentNode;
+	}
+	return t;
+};
+dojo.html.getViewport = function () {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	var w = 0;
+	var h = 0;
+	if (dojo.render.html.mozilla) {
+		w = _document.documentElement.clientWidth;
+		h = _window.innerHeight;
+	} else {
+		if (!dojo.render.html.opera &amp;&amp; _window.innerWidth) {
+			w = _window.innerWidth;
+			h = _window.innerHeight;
+		} else {
+			if (!dojo.render.html.opera &amp;&amp; dojo.exists(_document, &quot;documentElement.clientWidth&quot;)) {
+				var w2 = _document.documentElement.clientWidth;
+				if (!w || w2 &amp;&amp; w2 &lt; w) {
+					w = w2;
+				}
+				h = _document.documentElement.clientHeight;
+			} else {
+				if (dojo.body().clientWidth) {
+					w = dojo.body().clientWidth;
+					h = dojo.body().clientHeight;
+				}
+			}
+		}
+	}
+	return {width:w, height:h};
+};
+dojo.html.getScroll = function () {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	var top = _window.pageYOffset || _document.documentElement.scrollTop || dojo.body().scrollTop || 0;
+	var left = _window.pageXOffset || _document.documentElement.scrollLeft || dojo.body().scrollLeft || 0;
+	return {top:top, left:left, offset:{x:left, y:top}};
+};
+dojo.html.getParentByType = function (node, type) {
+	var _document = dojo.doc();
+	var parent = dojo.byId(node);
+	type = type.toLowerCase();
+	while ((parent) &amp;&amp; (parent.nodeName.toLowerCase() != type)) {
+		if (parent == (_document[&quot;body&quot;] || _document[&quot;documentElement&quot;])) {
+			return null;
+		}
+		parent = parent.parentNode;
+	}
+	return parent;
+};
+dojo.html.getAttribute = function (node, attr) {
+	node = dojo.byId(node);
+	if ((!node) || (!node.getAttribute)) {
+		return null;
+	}
+	var ta = typeof attr == &quot;string&quot; ? attr : new String(attr);
+	var v = node.getAttribute(ta.toUpperCase());
+	if ((v) &amp;&amp; (typeof v == &quot;string&quot;) &amp;&amp; (v != &quot;&quot;)) {
+		return v;
+	}
+	if (v &amp;&amp; v.value) {
+		return v.value;
+	}
+	if ((node.getAttributeNode) &amp;&amp; (node.getAttributeNode(ta))) {
+		return (node.getAttributeNode(ta)).value;
+	} else {
+		if (node.getAttribute(ta)) {
+			return node.getAttribute(ta);
+		} else {
+			if (node.getAttribute(ta.toLowerCase())) {
+				return node.getAttribute(ta.toLowerCase());
+			}
+		}
+	}
+	return null;
+};
+dojo.html.hasAttribute = function (node, attr) {
+	return dojo.html.getAttribute(dojo.byId(node), attr) ? true : false;
+};
+dojo.html.getCursorPosition = function (e) {
+	e = e || dojo.global().event;
+	var cursor = {x:0, y:0};
+	if (e.pageX || e.pageY) {
+		cursor.x = e.pageX;
+		cursor.y = e.pageY;
+	} else {
+		var de = dojo.doc().documentElement;
+		var db = dojo.body();
+		cursor.x = e.clientX + ((de || db)[&quot;scrollLeft&quot;]) - ((de || db)[&quot;clientLeft&quot;]);
+		cursor.y = e.clientY + ((de || db)[&quot;scrollTop&quot;]) - ((de || db)[&quot;clientTop&quot;]);
+	}
+	return cursor;
+};
+dojo.html.isTag = function (node) {
+	node = dojo.byId(node);
+	if (node &amp;&amp; node.tagName) {
+		for (var i = 1; i &lt; arguments.length; i++) {
+			if (node.tagName.toLowerCase() == String(arguments[i]).toLowerCase()) {
+				return String(arguments[i]).toLowerCase();
+			}
+		}
+	}
+	return &quot;&quot;;
+};
+if (dojo.render.html.ie &amp;&amp; !dojo.render.html.ie70) {
+	if (window.location.href.substr(0, 6).toLowerCase() != &quot;https:&quot;) {
+		(function () {
+			var xscript = dojo.doc().createElement(&quot;script&quot;);
+			xscript.src = &quot;javascript:'dojo.html.createExternalElement=function(doc, tag){ return doc.createElement(tag); }'&quot;;
+			dojo.doc().getElementsByTagName(&quot;head&quot;)[0].appendChild(xscript);
+		})();
+	}
+} else {
+	dojo.html.createExternalElement = function (doc, tag) {
+		return doc.createElement(tag);
+	};
+}
+dojo.html._callDeprecated = function (inFunc, replFunc, args, argName, retValue) {
+	dojo.deprecated(&quot;dojo.html.&quot; + inFunc, &quot;replaced by dojo.html.&quot; + replFunc + &quot;(&quot; + (argName ? &quot;node, {&quot; + argName + &quot;: &quot; + argName + &quot;}&quot; : &quot;&quot;) + &quot;)&quot; + (retValue ? &quot;.&quot; + retValue : &quot;&quot;), &quot;0.5&quot;);
+	var newArgs = [];
+	if (argName) {
+		var argsIn = {};
+		argsIn[argName] = args[1];
+		newArgs.push(args[0]);
+		newArgs.push(argsIn);
+	} else {
+		newArgs = args;
+	}
+	var ret = dojo.html[replFunc].apply(dojo.html, args);
+	if (retValue) {
+		return ret[retValue];
+	} else {
+		return ret;
+	}
+};
+dojo.html.getViewportWidth = function () {
+	return dojo.html._callDeprecated(&quot;getViewportWidth&quot;, &quot;getViewport&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getViewportHeight = function () {
+	return dojo.html._callDeprecated(&quot;getViewportHeight&quot;, &quot;getViewport&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getViewportSize = function () {
+	return dojo.html._callDeprecated(&quot;getViewportSize&quot;, &quot;getViewport&quot;, arguments);
+};
+dojo.html.getScrollTop = function () {
+	return dojo.html._callDeprecated(&quot;getScrollTop&quot;, &quot;getScroll&quot;, arguments, null, &quot;top&quot;);
+};
+dojo.html.getScrollLeft = function () {
+	return dojo.html._callDeprecated(&quot;getScrollLeft&quot;, &quot;getScroll&quot;, arguments, null, &quot;left&quot;);
+};
+dojo.html.getScrollOffset = function () {
+	return dojo.html._callDeprecated(&quot;getScrollOffset&quot;, &quot;getScroll&quot;, arguments, null, &quot;offset&quot;);
+};
+

Added: tags/parley-0.55/root/static/magic/src/html/display.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/display.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/display.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,147 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.html._toggle = function (node, tester, setter) {
+	node = dojo.byId(node);
+	setter(node, !tester(node));
+	return tester(node);
+};
+dojo.html.show = function (node) {
+	node = dojo.byId(node);
+	if (dojo.html.getStyleProperty(node, &quot;display&quot;) == &quot;none&quot;) {
+		dojo.html.setStyle(node, &quot;display&quot;, (node.dojoDisplayCache || &quot;&quot;));
+		node.dojoDisplayCache = undefined;
+	}
+};
+dojo.html.hide = function (node) {
+	node = dojo.byId(node);
+	if (typeof node[&quot;dojoDisplayCache&quot;] == &quot;undefined&quot;) {
+		var d = dojo.html.getStyleProperty(node, &quot;display&quot;);
+		if (d != &quot;none&quot;) {
+			node.dojoDisplayCache = d;
+		}
+	}
+	dojo.html.setStyle(node, &quot;display&quot;, &quot;none&quot;);
+};
+dojo.html.setShowing = function (node, showing) {
+	dojo.html[(showing ? &quot;show&quot; : &quot;hide&quot;)](node);
+};
+dojo.html.isShowing = function (node) {
+	return (dojo.html.getStyleProperty(node, &quot;display&quot;) != &quot;none&quot;);
+};
+dojo.html.toggleShowing = function (node) {
+	return dojo.html._toggle(node, dojo.html.isShowing, dojo.html.setShowing);
+};
+dojo.html.displayMap = {tr:&quot;&quot;, td:&quot;&quot;, th:&quot;&quot;, img:&quot;inline&quot;, span:&quot;inline&quot;, input:&quot;inline&quot;, button:&quot;inline&quot;};
+dojo.html.suggestDisplayByTagName = function (node) {
+	node = dojo.byId(node);
+	if (node &amp;&amp; node.tagName) {
+		var tag = node.tagName.toLowerCase();
+		return (tag in dojo.html.displayMap ? dojo.html.displayMap[tag] : &quot;block&quot;);
+	}
+};
+dojo.html.setDisplay = function (node, display) {
+	dojo.html.setStyle(node, &quot;display&quot;, ((display instanceof String || typeof display == &quot;string&quot;) ? display : (display ? dojo.html.suggestDisplayByTagName(node) : &quot;none&quot;)));
+};
+dojo.html.isDisplayed = function (node) {
+	return (dojo.html.getComputedStyle(node, &quot;display&quot;) != &quot;none&quot;);
+};
+dojo.html.toggleDisplay = function (node) {
+	return dojo.html._toggle(node, dojo.html.isDisplayed, dojo.html.setDisplay);
+};
+dojo.html.setVisibility = function (node, visibility) {
+	dojo.html.setStyle(node, &quot;visibility&quot;, ((visibility instanceof String || typeof visibility == &quot;string&quot;) ? visibility : (visibility ? &quot;visible&quot; : &quot;hidden&quot;)));
+};
+dojo.html.isVisible = function (node) {
+	return (dojo.html.getComputedStyle(node, &quot;visibility&quot;) != &quot;hidden&quot;);
+};
+dojo.html.toggleVisibility = function (node) {
+	return dojo.html._toggle(node, dojo.html.isVisible, dojo.html.setVisibility);
+};
+dojo.html.setOpacity = function (node, opacity, dontFixOpacity) {
+	node = dojo.byId(node);
+	var h = dojo.render.html;
+	if (!dontFixOpacity) {
+		if (opacity &gt;= 1) {
+			if (h.ie) {
+				dojo.html.clearOpacity(node);
+				return;
+			} else {
+				opacity = 0.999999;
+			}
+		} else {
+			if (opacity &lt; 0) {
+				opacity = 0;
+			}
+		}
+	}
+	if (h.ie) {
+		if (node.nodeName.toLowerCase() == &quot;tr&quot;) {
+			var tds = node.getElementsByTagName(&quot;td&quot;);
+			for (var x = 0; x &lt; tds.length; x++) {
+				tds[x].style.filter = &quot;Alpha(Opacity=&quot; + opacity * 100 + &quot;)&quot;;
+			}
+		}
+		node.style.filter = &quot;Alpha(Opacity=&quot; + opacity * 100 + &quot;)&quot;;
+	} else {
+		if (h.moz) {
+			node.style.opacity = opacity;
+			node.style.MozOpacity = opacity;
+		} else {
+			if (h.safari) {
+				node.style.opacity = opacity;
+				node.style.KhtmlOpacity = opacity;
+			} else {
+				node.style.opacity = opacity;
+			}
+		}
+	}
+};
+dojo.html.clearOpacity = function (node) {
+	node = dojo.byId(node);
+	var ns = node.style;
+	var h = dojo.render.html;
+	if (h.ie) {
+		try {
+			if (node.filters &amp;&amp; node.filters.alpha) {
+				ns.filter = &quot;&quot;;
+			}
+		}
+		catch (e) {
+		}
+	} else {
+		if (h.moz) {
+			ns.opacity = 1;
+			ns.MozOpacity = 1;
+		} else {
+			if (h.safari) {
+				ns.opacity = 1;
+				ns.KhtmlOpacity = 1;
+			} else {
+				ns.opacity = 1;
+			}
+		}
+	}
+};
+dojo.html.getOpacity = function (node) {
+	node = dojo.byId(node);
+	var h = dojo.render.html;
+	if (h.ie) {
+		var opac = (node.filters &amp;&amp; node.filters.alpha &amp;&amp; typeof node.filters.alpha.opacity == &quot;number&quot; ? node.filters.alpha.opacity : 100) / 100;
+	} else {
+		var opac = node.style.opacity || node.style.MozOpacity || node.style.KhtmlOpacity || 1;
+	}
+	return opac &gt;= 0.999999 ? 1 : Number(opac);
+};
+

Added: tags/parley-0.55/root/static/magic/src/html/iframe.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/iframe.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/iframe.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,84 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.iframe&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.html.iframeContentWindow = function (iframe_el) {
+	var win = dojo.html.getDocumentWindow(dojo.html.iframeContentDocument(iframe_el)) || dojo.html.iframeContentDocument(iframe_el).__parent__ || (iframe_el.name &amp;&amp; document.frames[iframe_el.name]) || null;
+	return win;
+};
+dojo.html.iframeContentDocument = function (iframe_el) {
+	var doc = iframe_el.contentDocument || ((iframe_el.contentWindow) &amp;&amp; (iframe_el.contentWindow.document)) || ((iframe_el.name) &amp;&amp; (document.frames[iframe_el.name]) &amp;&amp; (document.frames[iframe_el.name].document)) || null;
+	return doc;
+};
+dojo.html.BackgroundIframe = function (node) {
+	if (dojo.render.html.ie55 || dojo.render.html.ie60) {
+		var html = &quot;&lt;iframe src='javascript:false'&quot; + &quot; style='position: absolute; left: 0px; top: 0px; width: 100%; height: 100%;&quot; + &quot;z-index: -1; filter:Alpha(Opacity=\&quot;0\&quot;);' &quot; + &quot;&gt;&quot;;
+		this.iframe = dojo.doc().createElement(html);
+		this.iframe.tabIndex = -1;
+		if (node) {
+			node.appendChild(this.iframe);
+			this.domNode = node;
+		} else {
+			dojo.body().appendChild(this.iframe);
+			this.iframe.style.display = &quot;none&quot;;
+		}
+	}
+};
+dojo.lang.extend(dojo.html.BackgroundIframe, {iframe:null, onResized:function () {
+	if (this.iframe &amp;&amp; this.domNode &amp;&amp; this.domNode.parentNode) {
+		var outer = dojo.html.getMarginBox(this.domNode);
+		if (outer.width == 0 || outer.height == 0) {
+			dojo.lang.setTimeout(this, this.onResized, 100);
+			return;
+		}
+		this.iframe.style.width = outer.width + &quot;px&quot;;
+		this.iframe.style.height = outer.height + &quot;px&quot;;
+	}
+}, size:function (node) {
+	if (!this.iframe) {
+		return;
+	}
+	var coords = dojo.html.toCoordinateObject(node, true, dojo.html.boxSizing.BORDER_BOX);
+	with (this.iframe.style) {
+		width = coords.width + &quot;px&quot;;
+		height = coords.height + &quot;px&quot;;
+		left = coords.left + &quot;px&quot;;
+		top = coords.top + &quot;px&quot;;
+	}
+}, setZIndex:function (node) {
+	if (!this.iframe) {
+		return;
+	}
+	if (dojo.dom.isNode(node)) {
+		this.iframe.style.zIndex = dojo.html.getStyle(node, &quot;z-index&quot;) - 1;
+	} else {
+		if (!isNaN(node)) {
+			this.iframe.style.zIndex = node;
+		}
+	}
+}, show:function () {
+	if (this.iframe) {
+		this.iframe.style.display = &quot;block&quot;;
+	}
+}, hide:function () {
+	if (this.iframe) {
+		this.iframe.style.display = &quot;none&quot;;
+	}
+}, remove:function () {
+	if (this.iframe) {
+		dojo.html.removeNode(this.iframe, true);
+		delete this.iframe;
+		this.iframe = null;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowB.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowB.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowBL.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowBL.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowBR.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowBR.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowL.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowL.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowR.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowR.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowT.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowT.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowTL.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowTL.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/images/shadowTR.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/html/images/shadowTR.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/html/layout.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/layout.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/layout.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,388 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.html.sumAncestorProperties = function (node, prop) {
+	node = dojo.byId(node);
+	if (!node) {
+		return 0;
+	}
+	var retVal = 0;
+	while (node) {
+		if (dojo.html.getComputedStyle(node, &quot;position&quot;) == &quot;fixed&quot;) {
+			return 0;
+		}
+		var val = node[prop];
+		if (val) {
+			retVal += val - 0;
+			if (node == dojo.body()) {
+				break;
+			}
+		}
+		node = node.parentNode;
+	}
+	return retVal;
+};
+dojo.html.setStyleAttributes = function (node, attributes) {
+	node = dojo.byId(node);
+	var splittedAttribs = attributes.replace(/(;)?\s*$/, &quot;&quot;).split(&quot;;&quot;);
+	for (var i = 0; i &lt; splittedAttribs.length; i++) {
+		var nameValue = splittedAttribs[i].split(&quot;:&quot;);
+		var name = nameValue[0].replace(/\s*$/, &quot;&quot;).replace(/^\s*/, &quot;&quot;).toLowerCase();
+		var value = nameValue[1].replace(/\s*$/, &quot;&quot;).replace(/^\s*/, &quot;&quot;);
+		switch (name) {
+		  case &quot;opacity&quot;:
+			dojo.html.setOpacity(node, value);
+			break;
+		  case &quot;content-height&quot;:
+			dojo.html.setContentBox(node, {height:value});
+			break;
+		  case &quot;content-width&quot;:
+			dojo.html.setContentBox(node, {width:value});
+			break;
+		  case &quot;outer-height&quot;:
+			dojo.html.setMarginBox(node, {height:value});
+			break;
+		  case &quot;outer-width&quot;:
+			dojo.html.setMarginBox(node, {width:value});
+			break;
+		  default:
+			node.style[dojo.html.toCamelCase(name)] = value;
+		}
+	}
+};
+dojo.html.boxSizing = {MARGIN_BOX:&quot;margin-box&quot;, BORDER_BOX:&quot;border-box&quot;, PADDING_BOX:&quot;padding-box&quot;, CONTENT_BOX:&quot;content-box&quot;};
+dojo.html.getAbsolutePosition = dojo.html.abs = function (node, includeScroll, boxType) {
+	node = dojo.byId(node, node.ownerDocument);
+	var ret = {x:0, y:0};
+	var bs = dojo.html.boxSizing;
+	if (!boxType) {
+		boxType = bs.CONTENT_BOX;
+	}
+	var nativeBoxType = 2;
+	var targetBoxType;
+	switch (boxType) {
+	  case bs.MARGIN_BOX:
+		targetBoxType = 3;
+		break;
+	  case bs.BORDER_BOX:
+		targetBoxType = 2;
+		break;
+	  case bs.PADDING_BOX:
+	  default:
+		targetBoxType = 1;
+		break;
+	  case bs.CONTENT_BOX:
+		targetBoxType = 0;
+		break;
+	}
+	var h = dojo.render.html;
+	var db = document[&quot;body&quot;] || document[&quot;documentElement&quot;];
+	if (h.ie) {
+		with (node.getBoundingClientRect()) {
+			ret.x = left - 2;
+			ret.y = top - 2;
+		}
+	} else {
+		if (document.getBoxObjectFor) {
+			nativeBoxType = 1;
+			try {
+				var bo = document.getBoxObjectFor(node);
+				ret.x = bo.x - dojo.html.sumAncestorProperties(node, &quot;scrollLeft&quot;);
+				ret.y = bo.y - dojo.html.sumAncestorProperties(node, &quot;scrollTop&quot;);
+			}
+			catch (e) {
+			}
+		} else {
+			if (node[&quot;offsetParent&quot;]) {
+				var endNode;
+				if ((h.safari) &amp;&amp; (node.style.getPropertyValue(&quot;position&quot;) == &quot;absolute&quot;) &amp;&amp; (node.parentNode == db)) {
+					endNode = db;
+				} else {
+					endNode = db.parentNode;
+				}
+				if (node.parentNode != db) {
+					var nd = node;
+					if (dojo.render.html.opera) {
+						nd = db;
+					}
+					ret.x -= dojo.html.sumAncestorProperties(nd, &quot;scrollLeft&quot;);
+					ret.y -= dojo.html.sumAncestorProperties(nd, &quot;scrollTop&quot;);
+				}
+				var curnode = node;
+				do {
+					var n = curnode[&quot;offsetLeft&quot;];
+					if (!h.opera || n &gt; 0) {
+						ret.x += isNaN(n) ? 0 : n;
+					}
+					var m = curnode[&quot;offsetTop&quot;];
+					ret.y += isNaN(m) ? 0 : m;
+					curnode = curnode.offsetParent;
+				} while ((curnode != endNode) &amp;&amp; (curnode != null));
+			} else {
+				if (node[&quot;x&quot;] &amp;&amp; node[&quot;y&quot;]) {
+					ret.x += isNaN(node.x) ? 0 : node.x;
+					ret.y += isNaN(node.y) ? 0 : node.y;
+				}
+			}
+		}
+	}
+	if (includeScroll) {
+		var scroll = dojo.html.getScroll();
+		ret.y += scroll.top;
+		ret.x += scroll.left;
+	}
+	var extentFuncArray = [dojo.html.getPaddingExtent, dojo.html.getBorderExtent, dojo.html.getMarginExtent];
+	if (nativeBoxType &gt; targetBoxType) {
+		for (var i = targetBoxType; i &lt; nativeBoxType; ++i) {
+			ret.y += extentFuncArray[i](node, &quot;top&quot;);
+			ret.x += extentFuncArray[i](node, &quot;left&quot;);
+		}
+	} else {
+		if (nativeBoxType &lt; targetBoxType) {
+			for (var i = targetBoxType; i &gt; nativeBoxType; --i) {
+				ret.y -= extentFuncArray[i - 1](node, &quot;top&quot;);
+				ret.x -= extentFuncArray[i - 1](node, &quot;left&quot;);
+			}
+		}
+	}
+	ret.top = ret.y;
+	ret.left = ret.x;
+	return ret;
+};
+dojo.html.isPositionAbsolute = function (node) {
+	return (dojo.html.getComputedStyle(node, &quot;position&quot;) == &quot;absolute&quot;);
+};
+dojo.html._sumPixelValues = function (node, selectors, autoIsZero) {
+	var total = 0;
+	for (var x = 0; x &lt; selectors.length; x++) {
+		total += dojo.html.getPixelValue(node, selectors[x], autoIsZero);
+	}
+	return total;
+};
+dojo.html.getMargin = function (node) {
+	return {width:dojo.html._sumPixelValues(node, [&quot;margin-left&quot;, &quot;margin-right&quot;], (dojo.html.getComputedStyle(node, &quot;position&quot;) == &quot;absolute&quot;)), height:dojo.html._sumPixelValues(node, [&quot;margin-top&quot;, &quot;margin-bottom&quot;], (dojo.html.getComputedStyle(node, &quot;position&quot;) == &quot;absolute&quot;))};
+};
+dojo.html.getBorder = function (node) {
+	return {width:dojo.html.getBorderExtent(node, &quot;left&quot;) + dojo.html.getBorderExtent(node, &quot;right&quot;), height:dojo.html.getBorderExtent(node, &quot;top&quot;) + dojo.html.getBorderExtent(node, &quot;bottom&quot;)};
+};
+dojo.html.getBorderExtent = function (node, side) {
+	return (dojo.html.getStyle(node, &quot;border-&quot; + side + &quot;-style&quot;) == &quot;none&quot; ? 0 : dojo.html.getPixelValue(node, &quot;border-&quot; + side + &quot;-width&quot;));
+};
+dojo.html.getMarginExtent = function (node, side) {
+	return dojo.html._sumPixelValues(node, [&quot;margin-&quot; + side], dojo.html.isPositionAbsolute(node));
+};
+dojo.html.getPaddingExtent = function (node, side) {
+	return dojo.html._sumPixelValues(node, [&quot;padding-&quot; + side], true);
+};
+dojo.html.getPadding = function (node) {
+	return {width:dojo.html._sumPixelValues(node, [&quot;padding-left&quot;, &quot;padding-right&quot;], true), height:dojo.html._sumPixelValues(node, [&quot;padding-top&quot;, &quot;padding-bottom&quot;], true)};
+};
+dojo.html.getPadBorder = function (node) {
+	var pad = dojo.html.getPadding(node);
+	var border = dojo.html.getBorder(node);
+	return {width:pad.width + border.width, height:pad.height + border.height};
+};
+dojo.html.getBoxSizing = function (node) {
+	var h = dojo.render.html;
+	var bs = dojo.html.boxSizing;
+	if (((h.ie) || (h.opera)) &amp;&amp; node.nodeName.toLowerCase() != &quot;img&quot;) {
+		var cm = document[&quot;compatMode&quot;];
+		if ((cm == &quot;BackCompat&quot;) || (cm == &quot;QuirksMode&quot;)) {
+			return bs.BORDER_BOX;
+		} else {
+			return bs.CONTENT_BOX;
+		}
+	} else {
+		if (arguments.length == 0) {
+			node = document.documentElement;
+		}
+		var sizing;
+		if (!h.ie) {
+			sizing = dojo.html.getStyle(node, &quot;-moz-box-sizing&quot;);
+			if (!sizing) {
+				sizing = dojo.html.getStyle(node, &quot;box-sizing&quot;);
+			}
+		}
+		return (sizing ? sizing : bs.CONTENT_BOX);
+	}
+};
+dojo.html.isBorderBox = function (node) {
+	return (dojo.html.getBoxSizing(node) == dojo.html.boxSizing.BORDER_BOX);
+};
+dojo.html.getBorderBox = function (node) {
+	node = dojo.byId(node);
+	return {width:node.offsetWidth, height:node.offsetHeight};
+};
+dojo.html.getPaddingBox = function (node) {
+	var box = dojo.html.getBorderBox(node);
+	var border = dojo.html.getBorder(node);
+	return {width:box.width - border.width, height:box.height - border.height};
+};
+dojo.html.getContentBox = function (node) {
+	node = dojo.byId(node);
+	var padborder = dojo.html.getPadBorder(node);
+	return {width:node.offsetWidth - padborder.width, height:node.offsetHeight - padborder.height};
+};
+dojo.html.setContentBox = function (node, args) {
+	node = dojo.byId(node);
+	var width = 0;
+	var height = 0;
+	var isbb = dojo.html.isBorderBox(node);
+	var padborder = (isbb ? dojo.html.getPadBorder(node) : {width:0, height:0});
+	var ret = {};
+	if (typeof args.width != &quot;undefined&quot;) {
+		width = args.width + padborder.width;
+		ret.width = dojo.html.setPositivePixelValue(node, &quot;width&quot;, width);
+	}
+	if (typeof args.height != &quot;undefined&quot;) {
+		height = args.height + padborder.height;
+		ret.height = dojo.html.setPositivePixelValue(node, &quot;height&quot;, height);
+	}
+	return ret;
+};
+dojo.html.getMarginBox = function (node) {
+	var borderbox = dojo.html.getBorderBox(node);
+	var margin = dojo.html.getMargin(node);
+	return {width:borderbox.width + margin.width, height:borderbox.height + margin.height};
+};
+dojo.html.setMarginBox = function (node, args) {
+	node = dojo.byId(node);
+	var width = 0;
+	var height = 0;
+	var isbb = dojo.html.isBorderBox(node);
+	var padborder = (!isbb ? dojo.html.getPadBorder(node) : {width:0, height:0});
+	var margin = dojo.html.getMargin(node);
+	var ret = {};
+	if (typeof args.width != &quot;undefined&quot;) {
+		width = args.width - padborder.width;
+		width -= margin.width;
+		ret.width = dojo.html.setPositivePixelValue(node, &quot;width&quot;, width);
+	}
+	if (typeof args.height != &quot;undefined&quot;) {
+		height = args.height - padborder.height;
+		height -= margin.height;
+		ret.height = dojo.html.setPositivePixelValue(node, &quot;height&quot;, height);
+	}
+	return ret;
+};
+dojo.html.getElementBox = function (node, type) {
+	var bs = dojo.html.boxSizing;
+	switch (type) {
+	  case bs.MARGIN_BOX:
+		return dojo.html.getMarginBox(node);
+	  case bs.BORDER_BOX:
+		return dojo.html.getBorderBox(node);
+	  case bs.PADDING_BOX:
+		return dojo.html.getPaddingBox(node);
+	  case bs.CONTENT_BOX:
+	  default:
+		return dojo.html.getContentBox(node);
+	}
+};
+dojo.html.toCoordinateObject = dojo.html.toCoordinateArray = function (coords, includeScroll, boxtype) {
+	if (coords instanceof Array || typeof coords == &quot;array&quot;) {
+		dojo.deprecated(&quot;dojo.html.toCoordinateArray&quot;, &quot;use dojo.html.toCoordinateObject({left: , top: , width: , height: }) instead&quot;, &quot;0.5&quot;);
+		while (coords.length &lt; 4) {
+			coords.push(0);
+		}
+		while (coords.length &gt; 4) {
+			coords.pop();
+		}
+		var ret = {left:coords[0], top:coords[1], width:coords[2], height:coords[3]};
+	} else {
+		if (!coords.nodeType &amp;&amp; !(coords instanceof String || typeof coords == &quot;string&quot;) &amp;&amp; (&quot;width&quot; in coords || &quot;height&quot; in coords || &quot;left&quot; in coords || &quot;x&quot; in coords || &quot;top&quot; in coords || &quot;y&quot; in coords)) {
+			var ret = {left:coords.left || coords.x || 0, top:coords.top || coords.y || 0, width:coords.width || 0, height:coords.height || 0};
+		} else {
+			var node = dojo.byId(coords);
+			var pos = dojo.html.abs(node, includeScroll, boxtype);
+			var marginbox = dojo.html.getMarginBox(node);
+			var ret = {left:pos.left, top:pos.top, width:marginbox.width, height:marginbox.height};
+		}
+	}
+	ret.x = ret.left;
+	ret.y = ret.top;
+	return ret;
+};
+dojo.html.setMarginBoxWidth = dojo.html.setOuterWidth = function (node, width) {
+	return dojo.html._callDeprecated(&quot;setMarginBoxWidth&quot;, &quot;setMarginBox&quot;, arguments, &quot;width&quot;);
+};
+dojo.html.setMarginBoxHeight = dojo.html.setOuterHeight = function () {
+	return dojo.html._callDeprecated(&quot;setMarginBoxHeight&quot;, &quot;setMarginBox&quot;, arguments, &quot;height&quot;);
+};
+dojo.html.getMarginBoxWidth = dojo.html.getOuterWidth = function () {
+	return dojo.html._callDeprecated(&quot;getMarginBoxWidth&quot;, &quot;getMarginBox&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getMarginBoxHeight = dojo.html.getOuterHeight = function () {
+	return dojo.html._callDeprecated(&quot;getMarginBoxHeight&quot;, &quot;getMarginBox&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getTotalOffset = function (node, type, includeScroll) {
+	return dojo.html._callDeprecated(&quot;getTotalOffset&quot;, &quot;getAbsolutePosition&quot;, arguments, null, type);
+};
+dojo.html.getAbsoluteX = function (node, includeScroll) {
+	return dojo.html._callDeprecated(&quot;getAbsoluteX&quot;, &quot;getAbsolutePosition&quot;, arguments, null, &quot;x&quot;);
+};
+dojo.html.getAbsoluteY = function (node, includeScroll) {
+	return dojo.html._callDeprecated(&quot;getAbsoluteY&quot;, &quot;getAbsolutePosition&quot;, arguments, null, &quot;y&quot;);
+};
+dojo.html.totalOffsetLeft = function (node, includeScroll) {
+	return dojo.html._callDeprecated(&quot;totalOffsetLeft&quot;, &quot;getAbsolutePosition&quot;, arguments, null, &quot;left&quot;);
+};
+dojo.html.totalOffsetTop = function (node, includeScroll) {
+	return dojo.html._callDeprecated(&quot;totalOffsetTop&quot;, &quot;getAbsolutePosition&quot;, arguments, null, &quot;top&quot;);
+};
+dojo.html.getMarginWidth = function (node) {
+	return dojo.html._callDeprecated(&quot;getMarginWidth&quot;, &quot;getMargin&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getMarginHeight = function (node) {
+	return dojo.html._callDeprecated(&quot;getMarginHeight&quot;, &quot;getMargin&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getBorderWidth = function (node) {
+	return dojo.html._callDeprecated(&quot;getBorderWidth&quot;, &quot;getBorder&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getBorderHeight = function (node) {
+	return dojo.html._callDeprecated(&quot;getBorderHeight&quot;, &quot;getBorder&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getPaddingWidth = function (node) {
+	return dojo.html._callDeprecated(&quot;getPaddingWidth&quot;, &quot;getPadding&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getPaddingHeight = function (node) {
+	return dojo.html._callDeprecated(&quot;getPaddingHeight&quot;, &quot;getPadding&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getPadBorderWidth = function (node) {
+	return dojo.html._callDeprecated(&quot;getPadBorderWidth&quot;, &quot;getPadBorder&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getPadBorderHeight = function (node) {
+	return dojo.html._callDeprecated(&quot;getPadBorderHeight&quot;, &quot;getPadBorder&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getBorderBoxWidth = dojo.html.getInnerWidth = function () {
+	return dojo.html._callDeprecated(&quot;getBorderBoxWidth&quot;, &quot;getBorderBox&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getBorderBoxHeight = dojo.html.getInnerHeight = function () {
+	return dojo.html._callDeprecated(&quot;getBorderBoxHeight&quot;, &quot;getBorderBox&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.getContentBoxWidth = dojo.html.getContentWidth = function () {
+	return dojo.html._callDeprecated(&quot;getContentBoxWidth&quot;, &quot;getContentBox&quot;, arguments, null, &quot;width&quot;);
+};
+dojo.html.getContentBoxHeight = dojo.html.getContentHeight = function () {
+	return dojo.html._callDeprecated(&quot;getContentBoxHeight&quot;, &quot;getContentBox&quot;, arguments, null, &quot;height&quot;);
+};
+dojo.html.setContentBoxWidth = dojo.html.setContentWidth = function (node, width) {
+	return dojo.html._callDeprecated(&quot;setContentBoxWidth&quot;, &quot;setContentBox&quot;, arguments, &quot;width&quot;);
+};
+dojo.html.setContentBoxHeight = dojo.html.setContentHeight = function (node, height) {
+	return dojo.html._callDeprecated(&quot;setContentBoxHeight&quot;, &quot;setContentBox&quot;, arguments, &quot;height&quot;);
+};
+

Added: tags/parley-0.55/root/static/magic/src/html/metrics.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/metrics.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/metrics.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,215 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.metrics&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.html.getScrollbar = function () {
+	var scroll = document.createElement(&quot;div&quot;);
+	scroll.style.width = &quot;100px&quot;;
+	scroll.style.height = &quot;100px&quot;;
+	scroll.style.overflow = &quot;scroll&quot;;
+	scroll.style.position = &quot;absolute&quot;;
+	scroll.style.top = &quot;-300px&quot;;
+	scroll.style.left = &quot;0px&quot;;
+	var test = document.createElement(&quot;div&quot;);
+	test.style.width = &quot;400px&quot;;
+	test.style.height = &quot;400px&quot;;
+	scroll.appendChild(test);
+	dojo.body().appendChild(scroll);
+	var width = scroll.offsetWidth - scroll.clientWidth;
+	dojo.body().removeChild(scroll);
+	scroll.removeChild(test);
+	scroll = test = null;
+	return {width:width};
+};
+dojo.html.getFontMeasurements = function () {
+	var heights = {&quot;1em&quot;:0, &quot;1ex&quot;:0, &quot;100%&quot;:0, &quot;12pt&quot;:0, &quot;16px&quot;:0, &quot;xx-small&quot;:0, &quot;x-small&quot;:0, &quot;small&quot;:0, &quot;medium&quot;:0, &quot;large&quot;:0, &quot;x-large&quot;:0, &quot;xx-large&quot;:0};
+	if (dojo.render.html.ie) {
+		document.documentElement.style.fontSize = &quot;100%&quot;;
+	}
+	var div = document.createElement(&quot;div&quot;);
+	div.style.position = &quot;absolute&quot;;
+	div.style.left = &quot;-100px&quot;;
+	div.style.top = &quot;0&quot;;
+	div.style.width = &quot;30px&quot;;
+	div.style.height = &quot;1000em&quot;;
+	div.style.border = &quot;0&quot;;
+	div.style.margin = &quot;0&quot;;
+	div.style.padding = &quot;0&quot;;
+	div.style.outline = &quot;0&quot;;
+	div.style.lineHeight = &quot;1&quot;;
+	div.style.overflow = &quot;hidden&quot;;
+	dojo.body().appendChild(div);
+	for (var p in heights) {
+		div.style.fontSize = p;
+		heights[p] = Math.round(div.offsetHeight * 12 / 16) * 16 / 12 / 1000;
+	}
+	dojo.body().removeChild(div);
+	div = null;
+	return heights;
+};
+dojo.html._fontMeasurements = null;
+dojo.html.getCachedFontMeasurements = function (recalculate) {
+	if (recalculate || !dojo.html._fontMeasurements) {
+		dojo.html._fontMeasurements = dojo.html.getFontMeasurements();
+	}
+	return dojo.html._fontMeasurements;
+};
+dojo.html.measureFragment = function (node, html, boxType) {
+	var clone = node.cloneNode(true);
+	clone.innerHTML = html;
+	node.parentNode.appendChild(clone);
+	var ret = dojo.html.getElementBox(clone, boxType);
+	node.parentNode.removeChild(clone);
+	clone = null;
+	return ret;
+};
+dojo.html.getFittedFragment = function (node, html) {
+	function cl(node) {
+		var element = document.createElement(node.tagName);
+		element.id = node.id + &quot;-clone&quot;;
+		element.className = node.className;
+		for (var j = 0; j &lt; node.attributes.length; j++) {
+			if (node.attributes[j].specified) {
+				if (node.attributes[j].nodeName.toLowerCase() != &quot;style&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;edited&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;contenteditable&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;id&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;class&quot;) {
+					element.setAttribute(node.attributes[j].nodeName.toLowerCase(), node.attributes[j].nodeValue);
+				}
+			}
+		}
+		return element;
+	}
+	var height = dojo.html.getFontMeasurements()[&quot;16px&quot;];
+	var n = cl(node);
+	n.style.width = dojo.html.getBorderBox(node).width + &quot;px&quot;;
+	n.style.height = (height + 4) + &quot;px&quot;;
+	node.parentNode.appendChild(n);
+	var rem = dojo.html.fitToElement(n, html);
+	var ret = n.innerHTML;
+	n.parentNode.removeChild(n);
+	return ret;
+};
+dojo.html.fitToElement = function (node, html) {
+	function cl(node) {
+		var element = document.createElement(node.tagName);
+		element.id = node.id + &quot;-clone&quot;;
+		element.className = node.className;
+		for (var j = 0; j &lt; node.attributes.length; j++) {
+			if (node.attributes[j].specified) {
+				if (node.attributes[j].nodeName.toLowerCase() != &quot;style&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;edited&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;contenteditable&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;id&quot; &amp;&amp; node.attributes[j].nodeName.toLowerCase() != &quot;class&quot;) {
+					element.setAttribute(node.attributes[j].nodeName.toLowerCase(), node.attributes[j].nodeValue);
+				}
+			}
+		}
+		return element;
+	}
+	var clone = cl(node);
+	node.parentNode.appendChild(clone);
+	var t = dojo.html.getBorderBox(node);
+	clone.style.width = t.width + &quot;px&quot;;
+	var singletons = [&quot;br&quot;, &quot;img&quot;, &quot;hr&quot;, &quot;input&quot;, &quot;!--&quot;];
+	var chop = [&quot;&lt;BR&gt;&quot;, &quot;&lt;br&gt;&quot;, &quot;&lt;br/&gt;&quot;, &quot;&lt;br /&gt;&quot;, &quot;&lt;p&gt;&lt;/p&gt;&quot;, &quot;&lt;P&gt;&lt;/P&gt;&quot;];
+	var openTags = [];
+	var str = html;
+	var i = 0;
+	var limit = str.length;
+	var add = 0;
+	var doLoop = true;
+	clone.innerHTML = str;
+	while (doLoop) {
+		add = Math.round((limit - i) / 2);
+		if (add &lt;= 1) {
+			doLoop = false;
+		}
+		i += add;
+		clone.innerHTML = str.substr(0, i);
+		if (clone.offsetHeight &gt; t.height) {
+			limit = i;
+			i -= add;
+		}
+	}
+	if (str.substr(0, i) != str) {
+		var lastSpace = str.substr(0, i).lastIndexOf(&quot; &quot;);
+		var lastNewLine = str.substr(0, i).lastIndexOf(&quot;\n&quot;);
+		var lastGreater = str.substr(0, i).lastIndexOf(&quot;&gt;&quot;);
+		var lastLess = str.substr(0, i).lastIndexOf(&quot;&lt;&quot;);
+		if (lastLess &lt;= lastGreater &amp;&amp; lastNewLine == i - 1) {
+			i = i;
+		} else {
+			if (lastSpace != -1 &amp;&amp; lastSpace &gt; lastGreater &amp;&amp; lastGreater &gt; lastLess) {
+				i = lastSpace + 1;
+			} else {
+				if (lastLess &gt; lastGreater) {
+					i = lastLess;
+				} else {
+					if (lastGreater != -1) {
+						i = lastGreater + 1;
+					}
+				}
+			}
+		}
+	}
+	str = str.substr(0, i);
+	var ret = html.substr(str.length);
+	var doPush = true;
+	var tags = str.split(&quot;&lt;&quot;);
+	tags.shift();
+	for (var j = 0; j &lt; tags.length; j++) {
+		tags[j] = tags[j].split(&quot;&gt;&quot;)[0];
+		if (tags[j].charAt(tags[j].length - 1) == &quot;/&quot;) {
+			continue;
+		}
+		if (tags[j].charAt(0) != &quot;/&quot;) {
+			for (var k = 0; k &lt; singletons.length; k++) {
+				if (tags[j].split(&quot; &quot;)[0].toLowerCase() == singletons[k]) {
+					doPush = false;
+				}
+			}
+			if (doPush) {
+				openTags.push(tags[j]);
+			}
+			doPush = true;
+		} else {
+			openTags.pop();
+		}
+	}
+	for (var j = 0; j &lt; chop.length; j++) {
+		if (ret.charAt(0) == &quot;\n&quot;) {
+			ret = ret.substr(1);
+		}
+		while (ret.indexOf(chop[j]) == 0) {
+			ret = ret.substr(chop[j].length);
+		}
+	}
+	for (var j = openTags.length - 1; j &gt;= 0; j--) {
+		if (str.lastIndexOf(openTags[j]) == (str.length - openTags[j].length - 1)) {
+			str = str.substring(0, str.lastIndexOf(openTags[j]));
+		} else {
+			str += &quot;&lt;/&quot; + openTags[j] + &quot;&gt;&quot;;
+		}
+		if (ret.length &gt; 0) {
+			ret = &quot;&lt;&quot; + openTags[j] + &quot;&gt;&quot; + ret;
+		}
+	}
+	for (var j = 0; j &lt; chop.length; j++) {
+		if (ret.charAt(0) == &quot;\n&quot;) {
+			ret = ret.substr(1);
+		}
+		while (ret.indexOf(chop[j]) == 0) {
+			ret = ret.substr(chop[j].length);
+		}
+	}
+	node.innerHTML = str;
+	clone.parentNode.removeChild(clone);
+	clone = null;
+	return ret;
+};
+

Added: tags/parley-0.55/root/static/magic/src/html/selection.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/selection.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/selection.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,339 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.provide(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.html.selectionType = {NONE:0, TEXT:1, CONTROL:2};
+dojo.html.clearSelection = function () {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	try {
+		if (_window[&quot;getSelection&quot;]) {
+			if (dojo.render.html.safari) {
+				_window.getSelection().collapse();
+			} else {
+				_window.getSelection().removeAllRanges();
+			}
+		} else {
+			if (_document.selection) {
+				if (_document.selection.empty) {
+					_document.selection.empty();
+				} else {
+					if (_document.selection.clear) {
+						_document.selection.clear();
+					}
+				}
+			}
+		}
+		return true;
+	}
+	catch (e) {
+		dojo.debug(e);
+		return false;
+	}
+};
+dojo.html.disableSelection = function (element) {
+	element = dojo.byId(element) || dojo.body();
+	var h = dojo.render.html;
+	if (h.mozilla) {
+		element.style.MozUserSelect = &quot;none&quot;;
+	} else {
+		if (h.safari) {
+			element.style.KhtmlUserSelect = &quot;none&quot;;
+		} else {
+			if (h.ie) {
+				element.unselectable = &quot;on&quot;;
+			} else {
+				return false;
+			}
+		}
+	}
+	return true;
+};
+dojo.html.enableSelection = function (element) {
+	element = dojo.byId(element) || dojo.body();
+	var h = dojo.render.html;
+	if (h.mozilla) {
+		element.style.MozUserSelect = &quot;&quot;;
+	} else {
+		if (h.safari) {
+			element.style.KhtmlUserSelect = &quot;&quot;;
+		} else {
+			if (h.ie) {
+				element.unselectable = &quot;off&quot;;
+			} else {
+				return false;
+			}
+		}
+	}
+	return true;
+};
+dojo.html.selectElement = function (element) {
+	dojo.deprecated(&quot;dojo.html.selectElement&quot;, &quot;replaced by dojo.html.selection.selectElementChildren&quot;, 0.5);
+};
+dojo.html.selectInputText = function (element) {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	element = dojo.byId(element);
+	if (_document[&quot;selection&quot;] &amp;&amp; dojo.body()[&quot;createTextRange&quot;]) {
+		var range = element.createTextRange();
+		range.moveStart(&quot;character&quot;, 0);
+		range.moveEnd(&quot;character&quot;, element.value.length);
+		range.select();
+	} else {
+		if (_window[&quot;getSelection&quot;]) {
+			var selection = _window.getSelection();
+			element.setSelectionRange(0, element.value.length);
+		}
+	}
+	element.focus();
+};
+dojo.html.isSelectionCollapsed = function () {
+	dojo.deprecated(&quot;dojo.html.isSelectionCollapsed&quot;, &quot;replaced by dojo.html.selection.isCollapsed&quot;, 0.5);
+	return dojo.html.selection.isCollapsed();
+};
+dojo.lang.mixin(dojo.html.selection, {getType:function () {
+	if (dojo.doc()[&quot;selection&quot;]) {
+		return dojo.html.selectionType[dojo.doc().selection.type.toUpperCase()];
+	} else {
+		var stype = dojo.html.selectionType.TEXT;
+		var oSel;
+		try {
+			oSel = dojo.global().getSelection();
+		}
+		catch (e) {
+		}
+		if (oSel &amp;&amp; oSel.rangeCount == 1) {
+			var oRange = oSel.getRangeAt(0);
+			if (oRange.startContainer == oRange.endContainer &amp;&amp; (oRange.endOffset - oRange.startOffset) == 1 &amp;&amp; oRange.startContainer.nodeType != dojo.dom.TEXT_NODE) {
+				stype = dojo.html.selectionType.CONTROL;
+			}
+		}
+		return stype;
+	}
+}, isCollapsed:function () {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	if (_document[&quot;selection&quot;]) {
+		return _document.selection.createRange().text == &quot;&quot;;
+	} else {
+		if (_window[&quot;getSelection&quot;]) {
+			var selection = _window.getSelection();
+			if (dojo.lang.isString(selection)) {
+				return selection == &quot;&quot;;
+			} else {
+				return selection.isCollapsed || selection.toString() == &quot;&quot;;
+			}
+		}
+	}
+}, getSelectedElement:function () {
+	if (dojo.html.selection.getType() == dojo.html.selectionType.CONTROL) {
+		if (dojo.doc()[&quot;selection&quot;]) {
+			var range = dojo.doc().selection.createRange();
+			if (range &amp;&amp; range.item) {
+				return dojo.doc().selection.createRange().item(0);
+			}
+		} else {
+			var selection = dojo.global().getSelection();
+			return selection.anchorNode.childNodes[selection.anchorOffset];
+		}
+	}
+}, getParentElement:function () {
+	if (dojo.html.selection.getType() == dojo.html.selectionType.CONTROL) {
+		var p = dojo.html.selection.getSelectedElement();
+		if (p) {
+			return p.parentNode;
+		}
+	} else {
+		if (dojo.doc()[&quot;selection&quot;]) {
+			return dojo.doc().selection.createRange().parentElement();
+		} else {
+			var selection = dojo.global().getSelection();
+			if (selection) {
+				var node = selection.anchorNode;
+				while (node &amp;&amp; node.nodeType != dojo.dom.ELEMENT_NODE) {
+					node = node.parentNode;
+				}
+				return node;
+			}
+		}
+	}
+}, getSelectedText:function () {
+	if (dojo.doc()[&quot;selection&quot;]) {
+		if (dojo.html.selection.getType() == dojo.html.selectionType.CONTROL) {
+			return null;
+		}
+		return dojo.doc().selection.createRange().text;
+	} else {
+		var selection = dojo.global().getSelection();
+		if (selection) {
+			return selection.toString();
+		}
+	}
+}, getSelectedHtml:function () {
+	if (dojo.doc()[&quot;selection&quot;]) {
+		if (dojo.html.selection.getType() == dojo.html.selectionType.CONTROL) {
+			return null;
+		}
+		return dojo.doc().selection.createRange().htmlText;
+	} else {
+		var selection = dojo.global().getSelection();
+		if (selection &amp;&amp; selection.rangeCount) {
+			var frag = selection.getRangeAt(0).cloneContents();
+			var div = document.createElement(&quot;div&quot;);
+			div.appendChild(frag);
+			return div.innerHTML;
+		}
+		return null;
+	}
+}, hasAncestorElement:function (tagName) {
+	return (dojo.html.selection.getAncestorElement.apply(this, arguments) != null);
+}, getAncestorElement:function (tagName) {
+	var node = dojo.html.selection.getSelectedElement() || dojo.html.selection.getParentElement();
+	while (node) {
+		if (dojo.html.selection.isTag(node, arguments).length &gt; 0) {
+			return node;
+		}
+		node = node.parentNode;
+	}
+	return null;
+}, isTag:function (node, tags) {
+	if (node &amp;&amp; node.tagName) {
+		for (var i = 0; i &lt; tags.length; i++) {
+			if (node.tagName.toLowerCase() == String(tags[i]).toLowerCase()) {
+				return String(tags[i]).toLowerCase();
+			}
+		}
+	}
+	return &quot;&quot;;
+}, selectElement:function (element) {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	element = dojo.byId(element);
+	if (_document.selection &amp;&amp; dojo.body().createTextRange) {
+		try {
+			var range = dojo.body().createControlRange();
+			range.addElement(element);
+			range.select();
+		}
+		catch (e) {
+			dojo.html.selection.selectElementChildren(element);
+		}
+	} else {
+		if (_window[&quot;getSelection&quot;]) {
+			var selection = _window.getSelection();
+			if (selection[&quot;removeAllRanges&quot;]) {
+				var range = _document.createRange();
+				range.selectNode(element);
+				selection.removeAllRanges();
+				selection.addRange(range);
+			}
+		}
+	}
+}, selectElementChildren:function (element) {
+	var _window = dojo.global();
+	var _document = dojo.doc();
+	element = dojo.byId(element);
+	if (_document.selection &amp;&amp; dojo.body().createTextRange) {
+		var range = dojo.body().createTextRange();
+		range.moveToElementText(element);
+		range.select();
+	} else {
+		if (_window[&quot;getSelection&quot;]) {
+			var selection = _window.getSelection();
+			if (selection[&quot;setBaseAndExtent&quot;]) {
+				selection.setBaseAndExtent(element, 0, element, element.innerText.length - 1);
+			} else {
+				if (selection[&quot;selectAllChildren&quot;]) {
+					selection.selectAllChildren(element);
+				}
+			}
+		}
+	}
+}, getBookmark:function () {
+	var bookmark;
+	var _document = dojo.doc();
+	if (_document[&quot;selection&quot;]) {
+		var range = _document.selection.createRange();
+		bookmark = range.getBookmark();
+	} else {
+		var selection;
+		try {
+			selection = dojo.global().getSelection();
+		}
+		catch (e) {
+		}
+		if (selection) {
+			var range = selection.getRangeAt(0);
+			bookmark = range.cloneRange();
+		} else {
+			dojo.debug(&quot;No idea how to store the current selection for this browser!&quot;);
+		}
+	}
+	return bookmark;
+}, moveToBookmark:function (bookmark) {
+	var _document = dojo.doc();
+	if (_document[&quot;selection&quot;]) {
+		var range = _document.selection.createRange();
+		range.moveToBookmark(bookmark);
+		range.select();
+	} else {
+		var selection;
+		try {
+			selection = dojo.global().getSelection();
+		}
+		catch (e) {
+		}
+		if (selection &amp;&amp; selection[&quot;removeAllRanges&quot;]) {
+			selection.removeAllRanges();
+			selection.addRange(bookmark);
+		} else {
+			dojo.debug(&quot;No idea how to restore selection for this browser!&quot;);
+		}
+	}
+}, collapse:function (beginning) {
+	if (dojo.global()[&quot;getSelection&quot;]) {
+		var selection = dojo.global().getSelection();
+		if (selection.removeAllRanges) {
+			if (beginning) {
+				selection.collapseToStart();
+			} else {
+				selection.collapseToEnd();
+			}
+		} else {
+			dojo.global().getSelection().collapse(beginning);
+		}
+	} else {
+		if (dojo.doc().selection) {
+			var range = dojo.doc().selection.createRange();
+			range.collapse(beginning);
+			range.select();
+		}
+	}
+}, remove:function () {
+	if (dojo.doc().selection) {
+		var selection = dojo.doc().selection;
+		if (selection.type.toUpperCase() != &quot;NONE&quot;) {
+			selection.clear();
+		}
+		return selection;
+	} else {
+		var selection = dojo.global().getSelection();
+		for (var i = 0; i &lt; selection.rangeCount; i++) {
+			selection.getRangeAt(i).deleteContents();
+		}
+		return selection;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/html/shadow.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/shadow.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/shadow.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,17 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.shadow&quot;);
+dojo.require(&quot;dojo.lfx.shadow&quot;);
+dojo.deprecated(&quot;dojo.html.shadow has been moved to dojo.lfx.&quot;, &quot;0.5&quot;);
+dojo.html.shadow = dojo.lfx.shadow;
+

Added: tags/parley-0.55/root/static/magic/src/html/style.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/style.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/style.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,483 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.html.getClass = function (node) {
+	node = dojo.byId(node);
+	if (!node) {
+		return &quot;&quot;;
+	}
+	var cs = &quot;&quot;;
+	if (node.className) {
+		cs = node.className;
+	} else {
+		if (dojo.html.hasAttribute(node, &quot;class&quot;)) {
+			cs = dojo.html.getAttribute(node, &quot;class&quot;);
+		}
+	}
+	return cs.replace(/^\s+|\s+$/g, &quot;&quot;);
+};
+dojo.html.getClasses = function (node) {
+	var c = dojo.html.getClass(node);
+	return (c == &quot;&quot;) ? [] : c.split(/\s+/g);
+};
+dojo.html.hasClass = function (node, classname) {
+	return (new RegExp(&quot;(^|\\s+)&quot; + classname + &quot;(\\s+|$)&quot;)).test(dojo.html.getClass(node));
+};
+dojo.html.prependClass = function (node, classStr) {
+	classStr += &quot; &quot; + dojo.html.getClass(node);
+	return dojo.html.setClass(node, classStr);
+};
+dojo.html.addClass = function (node, classStr) {
+	if (dojo.html.hasClass(node, classStr)) {
+		return false;
+	}
+	classStr = (dojo.html.getClass(node) + &quot; &quot; + classStr).replace(/^\s+|\s+$/g, &quot;&quot;);
+	return dojo.html.setClass(node, classStr);
+};
+dojo.html.setClass = function (node, classStr) {
+	node = dojo.byId(node);
+	var cs = new String(classStr);
+	try {
+		if (typeof node.className == &quot;string&quot;) {
+			node.className = cs;
+		} else {
+			if (node.setAttribute) {
+				node.setAttribute(&quot;class&quot;, classStr);
+				node.className = cs;
+			} else {
+				return false;
+			}
+		}
+	}
+	catch (e) {
+		dojo.debug(&quot;dojo.html.setClass() failed&quot;, e);
+	}
+	return true;
+};
+dojo.html.removeClass = function (node, classStr, allowPartialMatches) {
+	try {
+		if (!allowPartialMatches) {
+			var newcs = dojo.html.getClass(node).replace(new RegExp(&quot;(^|\\s+)&quot; + classStr + &quot;(\\s+|$)&quot;), &quot;$1$2&quot;);
+		} else {
+			var newcs = dojo.html.getClass(node).replace(classStr, &quot;&quot;);
+		}
+		dojo.html.setClass(node, newcs);
+	}
+	catch (e) {
+		dojo.debug(&quot;dojo.html.removeClass() failed&quot;, e);
+	}
+	return true;
+};
+dojo.html.replaceClass = function (node, newClass, oldClass) {
+	dojo.html.removeClass(node, oldClass);
+	dojo.html.addClass(node, newClass);
+};
+dojo.html.classMatchType = {ContainsAll:0, ContainsAny:1, IsOnly:2};
+dojo.html.getElementsByClass = function (classStr, parent, nodeType, classMatchType, useNonXpath) {
+	useNonXpath = false;
+	var _document = dojo.doc();
+	parent = dojo.byId(parent) || _document;
+	var classes = classStr.split(/\s+/g);
+	var nodes = [];
+	if (classMatchType != 1 &amp;&amp; classMatchType != 2) {
+		classMatchType = 0;
+	}
+	var reClass = new RegExp(&quot;(\\s|^)((&quot; + classes.join(&quot;)|(&quot;) + &quot;))(\\s|$)&quot;);
+	var srtLength = classes.join(&quot; &quot;).length;
+	var candidateNodes = [];
+	if (!useNonXpath &amp;&amp; _document.evaluate) {
+		var xpath = &quot;.//&quot; + (nodeType || &quot;*&quot;) + &quot;[contains(&quot;;
+		if (classMatchType != dojo.html.classMatchType.ContainsAny) {
+			xpath += &quot;concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot; + classes.join(&quot; ') and contains(concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot;) + &quot; ')&quot;;
+			if (classMatchType == 2) {
+				xpath += &quot; and string-length(@class)=&quot; + srtLength + &quot;]&quot;;
+			} else {
+				xpath += &quot;]&quot;;
+			}
+		} else {
+			xpath += &quot;concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot; + classes.join(&quot; ') or contains(concat(' '<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">, at class</A>,' '), ' &quot;) + &quot; ')]&quot;;
+		}
+		var xpathResult = _document.evaluate(xpath, parent, null, XPathResult.ANY_TYPE, null);
+		var result = xpathResult.iterateNext();
+		while (result) {
+			try {
+				candidateNodes.push(result);
+				result = xpathResult.iterateNext();
+			}
+			catch (e) {
+				break;
+			}
+		}
+		return candidateNodes;
+	} else {
+		if (!nodeType) {
+			nodeType = &quot;*&quot;;
+		}
+		candidateNodes = parent.getElementsByTagName(nodeType);
+		var node, i = 0;
+	outer:
+		while (node = candidateNodes[i++]) {
+			var nodeClasses = dojo.html.getClasses(node);
+			if (nodeClasses.length == 0) {
+				continue outer;
+			}
+			var matches = 0;
+			for (var j = 0; j &lt; nodeClasses.length; j++) {
+				if (reClass.test(nodeClasses[j])) {
+					if (classMatchType == dojo.html.classMatchType.ContainsAny) {
+						nodes.push(node);
+						continue outer;
+					} else {
+						matches++;
+					}
+				} else {
+					if (classMatchType == dojo.html.classMatchType.IsOnly) {
+						continue outer;
+					}
+				}
+			}
+			if (matches == classes.length) {
+				if ((classMatchType == dojo.html.classMatchType.IsOnly) &amp;&amp; (matches == nodeClasses.length)) {
+					nodes.push(node);
+				} else {
+					if (classMatchType == dojo.html.classMatchType.ContainsAll) {
+						nodes.push(node);
+					}
+				}
+			}
+		}
+		return nodes;
+	}
+};
+dojo.html.getElementsByClassName = dojo.html.getElementsByClass;
+dojo.html.toCamelCase = function (selector) {
+	var arr = selector.split(&quot;-&quot;), cc = arr[0];
+	for (var i = 1; i &lt; arr.length; i++) {
+		cc += arr[i].charAt(0).toUpperCase() + arr[i].substring(1);
+	}
+	return cc;
+};
+dojo.html.toSelectorCase = function (selector) {
+	return selector.replace(/([A-Z])/g, &quot;-$1&quot;).toLowerCase();
+};
+if (dojo.render.html.ie) {
+	dojo.html.getComputedStyle = function (node, property, value) {
+		node = dojo.byId(node);
+		if (!node || !node.currentStyle) {
+			return value;
+		}
+		return node.currentStyle[dojo.html.toCamelCase(property)];
+	};
+	dojo.html.getComputedStyles = function (node) {
+		return node.currentStyle;
+	};
+} else {
+	dojo.html.getComputedStyle = function (node, property, value) {
+		node = dojo.byId(node);
+		if (!node || !node.style) {
+			return value;
+		}
+		var s = document.defaultView.getComputedStyle(node, null);
+		return (s &amp;&amp; s[dojo.html.toCamelCase(property)]) || &quot;&quot;;
+	};
+	dojo.html.getComputedStyles = function (node) {
+		return document.defaultView.getComputedStyle(node, null);
+	};
+}
+dojo.html.getStyleProperty = function (node, cssSelector) {
+	node = dojo.byId(node);
+	return (node &amp;&amp; node.style ? node.style[dojo.html.toCamelCase(cssSelector)] : undefined);
+};
+dojo.html.getStyle = function (node, cssSelector) {
+	var value = dojo.html.getStyleProperty(node, cssSelector);
+	return (value ? value : dojo.html.getComputedStyle(node, cssSelector));
+};
+dojo.html.setStyle = function (node, cssSelector, value) {
+	node = dojo.byId(node);
+	if (node &amp;&amp; node.style) {
+		var camelCased = dojo.html.toCamelCase(cssSelector);
+		node.style[camelCased] = value;
+	}
+};
+dojo.html.setStyleText = function (target, text) {
+	try {
+		target.style.cssText = text;
+	}
+	catch (e) {
+		target.setAttribute(&quot;style&quot;, text);
+	}
+};
+dojo.html.copyStyle = function (target, source) {
+	if (!source.style.cssText) {
+		target.setAttribute(&quot;style&quot;, source.getAttribute(&quot;style&quot;));
+	} else {
+		target.style.cssText = source.style.cssText;
+	}
+	dojo.html.addClass(target, dojo.html.getClass(source));
+};
+dojo.html.getUnitValue = function (node, cssSelector, autoIsZero) {
+	var s = dojo.html.getComputedStyle(node, cssSelector);
+	if ((!s) || ((s == &quot;auto&quot;) &amp;&amp; (autoIsZero))) {
+		return {value:0, units:&quot;px&quot;};
+	}
+	var match = s.match(/(\-?[\d.]+)([a-z%]*)/i);
+	if (!match) {
+		return dojo.html.getUnitValue.bad;
+	}
+	return {value:Number(match[1]), units:match[2].toLowerCase()};
+};
+dojo.html.getUnitValue.bad = {value:NaN, units:&quot;&quot;};
+if (dojo.render.html.ie) {
+	dojo.html.toPixelValue = function (element, styleValue) {
+		if (!styleValue) {
+			return 0;
+		}
+		if (styleValue.slice(-2) == &quot;px&quot;) {
+			return parseFloat(styleValue);
+		}
+		var pixelValue = 0;
+		with (element) {
+			var sLeft = style.left;
+			var rsLeft = runtimeStyle.left;
+			runtimeStyle.left = currentStyle.left;
+			try {
+				style.left = styleValue || 0;
+				pixelValue = style.pixelLeft;
+				style.left = sLeft;
+				runtimeStyle.left = rsLeft;
+			}
+			catch (e) {
+			}
+		}
+		return pixelValue;
+	};
+} else {
+	dojo.html.toPixelValue = function (element, styleValue) {
+		return (styleValue &amp;&amp; (styleValue.slice(-2) == &quot;px&quot;) ? parseFloat(styleValue) : 0);
+	};
+}
+dojo.html.getPixelValue = function (node, styleProperty, autoIsZero) {
+	return dojo.html.toPixelValue(node, dojo.html.getComputedStyle(node, styleProperty));
+};
+dojo.html.setPositivePixelValue = function (node, selector, value) {
+	if (isNaN(value)) {
+		return false;
+	}
+	node.style[selector] = Math.max(0, value) + &quot;px&quot;;
+	return true;
+};
+dojo.html.styleSheet = null;
+dojo.html.insertCssRule = function (selector, declaration, index) {
+	if (!dojo.html.styleSheet) {
+		if (document.createStyleSheet) {
+			dojo.html.styleSheet = document.createStyleSheet();
+		} else {
+			if (document.styleSheets[0]) {
+				dojo.html.styleSheet = document.styleSheets[0];
+			} else {
+				return null;
+			}
+		}
+	}
+	if (arguments.length &lt; 3) {
+		if (dojo.html.styleSheet.cssRules) {
+			index = dojo.html.styleSheet.cssRules.length;
+		} else {
+			if (dojo.html.styleSheet.rules) {
+				index = dojo.html.styleSheet.rules.length;
+			} else {
+				return null;
+			}
+		}
+	}
+	if (dojo.html.styleSheet.insertRule) {
+		var rule = selector + &quot; { &quot; + declaration + &quot; }&quot;;
+		return dojo.html.styleSheet.insertRule(rule, index);
+	} else {
+		if (dojo.html.styleSheet.addRule) {
+			return dojo.html.styleSheet.addRule(selector, declaration, index);
+		} else {
+			return null;
+		}
+	}
+};
+dojo.html.removeCssRule = function (index) {
+	if (!dojo.html.styleSheet) {
+		dojo.debug(&quot;no stylesheet defined for removing rules&quot;);
+		return false;
+	}
+	if (dojo.render.html.ie) {
+		if (!index) {
+			index = dojo.html.styleSheet.rules.length;
+			dojo.html.styleSheet.removeRule(index);
+		}
+	} else {
+		if (document.styleSheets[0]) {
+			if (!index) {
+				index = dojo.html.styleSheet.cssRules.length;
+			}
+			dojo.html.styleSheet.deleteRule(index);
+		}
+	}
+	return true;
+};
+dojo.html._insertedCssFiles = [];
+dojo.html.insertCssFile = function (URI, doc, checkDuplicates, fail_ok) {
+	if (!URI) {
+		return;
+	}
+	if (!doc) {
+		doc = document;
+	}
+	var cssStr = dojo.hostenv.getText(URI, false, fail_ok);
+	if (cssStr === null) {
+		return;
+	}
+	cssStr = dojo.html.fixPathsInCssText(cssStr, URI);
+	if (checkDuplicates) {
+		var idx = -1, node, ent = dojo.html._insertedCssFiles;
+		for (var i = 0; i &lt; ent.length; i++) {
+			if ((ent[i].doc == doc) &amp;&amp; (ent[i].cssText == cssStr)) {
+				idx = i;
+				node = ent[i].nodeRef;
+				break;
+			}
+		}
+		if (node) {
+			var styles = doc.getElementsByTagName(&quot;style&quot;);
+			for (var i = 0; i &lt; styles.length; i++) {
+				if (styles[i] == node) {
+					return;
+				}
+			}
+			dojo.html._insertedCssFiles.shift(idx, 1);
+		}
+	}
+	var style = dojo.html.insertCssText(cssStr, doc);
+	dojo.html._insertedCssFiles.push({&quot;doc&quot;:doc, &quot;cssText&quot;:cssStr, &quot;nodeRef&quot;:style});
+	if (style &amp;&amp; djConfig.isDebug) {
+		style.setAttribute(&quot;dbgHref&quot;, URI);
+	}
+	return style;
+};
+dojo.html.insertCssText = function (cssStr, doc, URI) {
+	if (!cssStr) {
+		return;
+	}
+	if (!doc) {
+		doc = document;
+	}
+	if (URI) {
+		cssStr = dojo.html.fixPathsInCssText(cssStr, URI);
+	}
+	var style = doc.createElement(&quot;style&quot;);
+	style.setAttribute(&quot;type&quot;, &quot;text/css&quot;);
+	var head = doc.getElementsByTagName(&quot;head&quot;)[0];
+	if (!head) {
+		dojo.debug(&quot;No head tag in document, aborting styles&quot;);
+		return;
+	} else {
+		head.appendChild(style);
+	}
+	if (style.styleSheet) {
+		var setFunc = function () {
+			try {
+				style.styleSheet.cssText = cssStr;
+			}
+			catch (e) {
+				dojo.debug(e);
+			}
+		};
+		if (style.styleSheet.disabled) {
+			setTimeout(setFunc, 10);
+		} else {
+			setFunc();
+		}
+	} else {
+		var cssText = doc.createTextNode(cssStr);
+		style.appendChild(cssText);
+	}
+	return style;
+};
+dojo.html.fixPathsInCssText = function (cssStr, URI) {
+	if (!cssStr || !URI) {
+		return;
+	}
+	var match, str = &quot;&quot;, url = &quot;&quot;, urlChrs = &quot;[\\t\\s\\w\\(\\)\\/\\.\\\\'\&quot;-:#=&amp;?~]+&quot;;
+	var regex = new RegExp(&quot;url\\(\\s*(&quot; + urlChrs + &quot;)\\s*\\)&quot;);
+	var regexProtocol = /(file|https?|ftps?):\/\//;
+	regexTrim = new RegExp(&quot;^[\\s]*(['\&quot;]?)(&quot; + urlChrs + &quot;)\\1[\\s]*?$&quot;);
+	if (dojo.render.html.ie55 || dojo.render.html.ie60) {
+		var regexIe = new RegExp(&quot;AlphaImageLoader\\((.*)src=['\&quot;](&quot; + urlChrs + &quot;)['\&quot;]&quot;);
+		while (match = regexIe.exec(cssStr)) {
+			url = match[2].replace(regexTrim, &quot;$2&quot;);
+			if (!regexProtocol.exec(url)) {
+				url = (new dojo.uri.Uri(URI, url).toString());
+			}
+			str += cssStr.substring(0, match.index) + &quot;AlphaImageLoader(&quot; + match[1] + &quot;src='&quot; + url + &quot;'&quot;;
+			cssStr = cssStr.substr(match.index + match[0].length);
+		}
+		cssStr = str + cssStr;
+		str = &quot;&quot;;
+	}
+	while (match = regex.exec(cssStr)) {
+		url = match[1].replace(regexTrim, &quot;$2&quot;);
+		if (!regexProtocol.exec(url)) {
+			url = (new dojo.uri.Uri(URI, url).toString());
+		}
+		str += cssStr.substring(0, match.index) + &quot;url(&quot; + url + &quot;)&quot;;
+		cssStr = cssStr.substr(match.index + match[0].length);
+	}
+	return str + cssStr;
+};
+dojo.html.setActiveStyleSheet = function (title) {
+	var i = 0, a, els = dojo.doc().getElementsByTagName(&quot;link&quot;);
+	while (a = els[i++]) {
+		if (a.getAttribute(&quot;rel&quot;).indexOf(&quot;style&quot;) != -1 &amp;&amp; a.getAttribute(&quot;title&quot;)) {
+			a.disabled = true;
+			if (a.getAttribute(&quot;title&quot;) == title) {
+				a.disabled = false;
+			}
+		}
+	}
+};
+dojo.html.getActiveStyleSheet = function () {
+	var i = 0, a, els = dojo.doc().getElementsByTagName(&quot;link&quot;);
+	while (a = els[i++]) {
+		if (a.getAttribute(&quot;rel&quot;).indexOf(&quot;style&quot;) != -1 &amp;&amp; a.getAttribute(&quot;title&quot;) &amp;&amp; !a.disabled) {
+			return a.getAttribute(&quot;title&quot;);
+		}
+	}
+	return null;
+};
+dojo.html.getPreferredStyleSheet = function () {
+	var i = 0, a, els = dojo.doc().getElementsByTagName(&quot;link&quot;);
+	while (a = els[i++]) {
+		if (a.getAttribute(&quot;rel&quot;).indexOf(&quot;style&quot;) != -1 &amp;&amp; a.getAttribute(&quot;rel&quot;).indexOf(&quot;alt&quot;) == -1 &amp;&amp; a.getAttribute(&quot;title&quot;)) {
+			return a.getAttribute(&quot;title&quot;);
+		}
+	}
+	return null;
+};
+dojo.html.applyBrowserClass = function (node) {
+	var drh = dojo.render.html;
+	var classes = {dj_ie:drh.ie, dj_ie55:drh.ie55, dj_ie6:drh.ie60, dj_ie7:drh.ie70, dj_iequirks:drh.ie &amp;&amp; drh.quirks, dj_opera:drh.opera, dj_opera8:drh.opera &amp;&amp; (Math.floor(dojo.render.version) == 8), dj_opera9:drh.opera &amp;&amp; (Math.floor(dojo.render.version) == 9), dj_khtml:drh.khtml, dj_safari:drh.safari, dj_gecko:drh.mozilla};
+	for (var p in classes) {
+		if (classes[p]) {
+			dojo.html.addClass(node, p);
+		}
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/html/util.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html/util.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html/util.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,356 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html.util&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.html.getElementWindow = function (element) {
+	return dojo.html.getDocumentWindow(element.ownerDocument);
+};
+dojo.html.getDocumentWindow = function (doc) {
+	if (dojo.render.html.safari &amp;&amp; !doc._parentWindow) {
+		var fix = function (win) {
+			win.document._parentWindow = win;
+			for (var i = 0; i &lt; win.frames.length; i++) {
+				fix(win.frames[i]);
+			}
+		};
+		fix(window.top);
+	}
+	if (dojo.render.html.ie &amp;&amp; window !== document.parentWindow &amp;&amp; !doc._parentWindow) {
+		doc.parentWindow.execScript(&quot;document._parentWindow = window;&quot;, &quot;Javascript&quot;);
+		var win = doc._parentWindow;
+		doc._parentWindow = null;
+		return win;
+	}
+	return doc._parentWindow || doc.parentWindow || doc.defaultView;
+};
+dojo.html.gravity = function (node, e) {
+	node = dojo.byId(node);
+	var mouse = dojo.html.getCursorPosition(e);
+	with (dojo.html) {
+		var absolute = getAbsolutePosition(node, true);
+		var bb = getBorderBox(node);
+		var nodecenterx = absolute.x + (bb.width / 2);
+		var nodecentery = absolute.y + (bb.height / 2);
+	}
+	with (dojo.html.gravity) {
+		return ((mouse.x &lt; nodecenterx ? WEST : EAST) | (mouse.y &lt; nodecentery ? NORTH : SOUTH));
+	}
+};
+dojo.html.gravity.NORTH = 1;
+dojo.html.gravity.SOUTH = 1 &lt;&lt; 1;
+dojo.html.gravity.EAST = 1 &lt;&lt; 2;
+dojo.html.gravity.WEST = 1 &lt;&lt; 3;
+dojo.html.overElement = function (element, e) {
+	element = dojo.byId(element);
+	var mouse = dojo.html.getCursorPosition(e);
+	var bb = dojo.html.getBorderBox(element);
+	var absolute = dojo.html.getAbsolutePosition(element, true, dojo.html.boxSizing.BORDER_BOX);
+	var top = absolute.y;
+	var bottom = top + bb.height;
+	var left = absolute.x;
+	var right = left + bb.width;
+	return (mouse.x &gt;= left &amp;&amp; mouse.x &lt;= right &amp;&amp; mouse.y &gt;= top &amp;&amp; mouse.y &lt;= bottom);
+};
+dojo.html.renderedTextContent = function (node) {
+	node = dojo.byId(node);
+	var result = &quot;&quot;;
+	if (node == null) {
+		return result;
+	}
+	for (var i = 0; i &lt; node.childNodes.length; i++) {
+		switch (node.childNodes[i].nodeType) {
+		  case 1:
+		  case 5:
+			var display = &quot;unknown&quot;;
+			try {
+				display = dojo.html.getStyle(node.childNodes[i], &quot;display&quot;);
+			}
+			catch (E) {
+			}
+			switch (display) {
+			  case &quot;block&quot;:
+			  case &quot;list-item&quot;:
+			  case &quot;run-in&quot;:
+			  case &quot;table&quot;:
+			  case &quot;table-row-group&quot;:
+			  case &quot;table-header-group&quot;:
+			  case &quot;table-footer-group&quot;:
+			  case &quot;table-row&quot;:
+			  case &quot;table-column-group&quot;:
+			  case &quot;table-column&quot;:
+			  case &quot;table-cell&quot;:
+			  case &quot;table-caption&quot;:
+				result += &quot;\n&quot;;
+				result += dojo.html.renderedTextContent(node.childNodes[i]);
+				result += &quot;\n&quot;;
+				break;
+			  case &quot;none&quot;:
+				break;
+			  default:
+				if (node.childNodes[i].tagName &amp;&amp; node.childNodes[i].tagName.toLowerCase() == &quot;br&quot;) {
+					result += &quot;\n&quot;;
+				} else {
+					result += dojo.html.renderedTextContent(node.childNodes[i]);
+				}
+				break;
+			}
+			break;
+		  case 3:
+		  case 2:
+		  case 4:
+			var text = node.childNodes[i].nodeValue;
+			var textTransform = &quot;unknown&quot;;
+			try {
+				textTransform = dojo.html.getStyle(node, &quot;text-transform&quot;);
+			}
+			catch (E) {
+			}
+			switch (textTransform) {
+			  case &quot;capitalize&quot;:
+				var words = text.split(&quot; &quot;);
+				for (var i = 0; i &lt; words.length; i++) {
+					words[i] = words[i].charAt(0).toUpperCase() + words[i].substring(1);
+				}
+				text = words.join(&quot; &quot;);
+				break;
+			  case &quot;uppercase&quot;:
+				text = text.toUpperCase();
+				break;
+			  case &quot;lowercase&quot;:
+				text = text.toLowerCase();
+				break;
+			  default:
+				break;
+			}
+			switch (textTransform) {
+			  case &quot;nowrap&quot;:
+				break;
+			  case &quot;pre-wrap&quot;:
+				break;
+			  case &quot;pre-line&quot;:
+				break;
+			  case &quot;pre&quot;:
+				break;
+			  default:
+				text = text.replace(/\s+/, &quot; &quot;);
+				if (/\s$/.test(result)) {
+					text.replace(/^\s/, &quot;&quot;);
+				}
+				break;
+			}
+			result += text;
+			break;
+		  default:
+			break;
+		}
+	}
+	return result;
+};
+dojo.html.createNodesFromText = function (txt, trim) {
+	if (trim) {
+		txt = txt.replace(/^\s+|\s+$/g, &quot;&quot;);
+	}
+	var tn = dojo.doc().createElement(&quot;div&quot;);
+	tn.style.visibility = &quot;hidden&quot;;
+	dojo.body().appendChild(tn);
+	var tableType = &quot;none&quot;;
+	if ((/^&lt;t[dh][\s\r\n&gt;]/i).test(txt.replace(/^\s+/))) {
+		txt = &quot;&lt;table&gt;&lt;tbody&gt;&lt;tr&gt;&quot; + txt + &quot;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&quot;;
+		tableType = &quot;cell&quot;;
+	} else {
+		if ((/^&lt;tr[\s\r\n&gt;]/i).test(txt.replace(/^\s+/))) {
+			txt = &quot;&lt;table&gt;&lt;tbody&gt;&quot; + txt + &quot;&lt;/tbody&gt;&lt;/table&gt;&quot;;
+			tableType = &quot;row&quot;;
+		} else {
+			if ((/^&lt;(thead|tbody|tfoot)[\s\r\n&gt;]/i).test(txt.replace(/^\s+/))) {
+				txt = &quot;&lt;table&gt;&quot; + txt + &quot;&lt;/table&gt;&quot;;
+				tableType = &quot;section&quot;;
+			}
+		}
+	}
+	tn.innerHTML = txt;
+	if (tn[&quot;normalize&quot;]) {
+		tn.normalize();
+	}
+	var parent = null;
+	switch (tableType) {
+	  case &quot;cell&quot;:
+		parent = tn.getElementsByTagName(&quot;tr&quot;)[0];
+		break;
+	  case &quot;row&quot;:
+		parent = tn.getElementsByTagName(&quot;tbody&quot;)[0];
+		break;
+	  case &quot;section&quot;:
+		parent = tn.getElementsByTagName(&quot;table&quot;)[0];
+		break;
+	  default:
+		parent = tn;
+		break;
+	}
+	var nodes = [];
+	for (var x = 0; x &lt; parent.childNodes.length; x++) {
+		nodes.push(parent.childNodes[x].cloneNode(true));
+	}
+	tn.style.display = &quot;none&quot;;
+	dojo.html.destroyNode(tn);
+	return nodes;
+};
+dojo.html.placeOnScreen = function (node, desiredX, desiredY, padding, hasScroll, corners, tryOnly) {
+	if (desiredX instanceof Array || typeof desiredX == &quot;array&quot;) {
+		tryOnly = corners;
+		corners = hasScroll;
+		hasScroll = padding;
+		padding = desiredY;
+		desiredY = desiredX[1];
+		desiredX = desiredX[0];
+	}
+	if (corners instanceof String || typeof corners == &quot;string&quot;) {
+		corners = corners.split(&quot;,&quot;);
+	}
+	if (!isNaN(padding)) {
+		padding = [Number(padding), Number(padding)];
+	} else {
+		if (!(padding instanceof Array || typeof padding == &quot;array&quot;)) {
+			padding = [0, 0];
+		}
+	}
+	var scroll = dojo.html.getScroll().offset;
+	var view = dojo.html.getViewport();
+	node = dojo.byId(node);
+	var oldDisplay = node.style.display;
+	node.style.display = &quot;&quot;;
+	var bb = dojo.html.getBorderBox(node);
+	var w = bb.width;
+	var h = bb.height;
+	node.style.display = oldDisplay;
+	if (!(corners instanceof Array || typeof corners == &quot;array&quot;)) {
+		corners = [&quot;TL&quot;];
+	}
+	var bestx, besty, bestDistance = Infinity, bestCorner;
+	for (var cidex = 0; cidex &lt; corners.length; ++cidex) {
+		var corner = corners[cidex];
+		var match = true;
+		var tryX = desiredX - (corner.charAt(1) == &quot;L&quot; ? 0 : w) + padding[0] * (corner.charAt(1) == &quot;L&quot; ? 1 : -1);
+		var tryY = desiredY - (corner.charAt(0) == &quot;T&quot; ? 0 : h) + padding[1] * (corner.charAt(0) == &quot;T&quot; ? 1 : -1);
+		if (hasScroll) {
+			tryX -= scroll.x;
+			tryY -= scroll.y;
+		}
+		if (tryX &lt; 0) {
+			tryX = 0;
+			match = false;
+		}
+		if (tryY &lt; 0) {
+			tryY = 0;
+			match = false;
+		}
+		var x = tryX + w;
+		if (x &gt; view.width) {
+			x = view.width - w;
+			match = false;
+		} else {
+			x = tryX;
+		}
+		x = Math.max(padding[0], x) + scroll.x;
+		var y = tryY + h;
+		if (y &gt; view.height) {
+			y = view.height - h;
+			match = false;
+		} else {
+			y = tryY;
+		}
+		y = Math.max(padding[1], y) + scroll.y;
+		if (match) {
+			bestx = x;
+			besty = y;
+			bestDistance = 0;
+			bestCorner = corner;
+			break;
+		} else {
+			var dist = Math.pow(x - tryX - scroll.x, 2) + Math.pow(y - tryY - scroll.y, 2);
+			if (bestDistance &gt; dist) {
+				bestDistance = dist;
+				bestx = x;
+				besty = y;
+				bestCorner = corner;
+			}
+		}
+	}
+	if (!tryOnly) {
+		node.style.left = bestx + &quot;px&quot;;
+		node.style.top = besty + &quot;px&quot;;
+	}
+	return {left:bestx, top:besty, x:bestx, y:besty, dist:bestDistance, corner:bestCorner};
+};
+dojo.html.placeOnScreenPoint = function (node, desiredX, desiredY, padding, hasScroll) {
+	dojo.deprecated(&quot;dojo.html.placeOnScreenPoint&quot;, &quot;use dojo.html.placeOnScreen() instead&quot;, &quot;0.5&quot;);
+	return dojo.html.placeOnScreen(node, desiredX, desiredY, padding, hasScroll, [&quot;TL&quot;, &quot;TR&quot;, &quot;BL&quot;, &quot;BR&quot;]);
+};
+dojo.html.placeOnScreenAroundElement = function (node, aroundNode, padding, aroundType, aroundCorners, tryOnly) {
+	var best, bestDistance = Infinity;
+	aroundNode = dojo.byId(aroundNode);
+	var oldDisplay = aroundNode.style.display;
+	aroundNode.style.display = &quot;&quot;;
+	var mb = dojo.html.getElementBox(aroundNode, aroundType);
+	var aroundNodeW = mb.width;
+	var aroundNodeH = mb.height;
+	var aroundNodePos = dojo.html.getAbsolutePosition(aroundNode, true, aroundType);
+	aroundNode.style.display = oldDisplay;
+	for (var nodeCorner in aroundCorners) {
+		var pos, desiredX, desiredY;
+		var corners = aroundCorners[nodeCorner];
+		desiredX = aroundNodePos.x + (nodeCorner.charAt(1) == &quot;L&quot; ? 0 : aroundNodeW);
+		desiredY = aroundNodePos.y + (nodeCorner.charAt(0) == &quot;T&quot; ? 0 : aroundNodeH);
+		pos = dojo.html.placeOnScreen(node, desiredX, desiredY, padding, true, corners, true);
+		if (pos.dist == 0) {
+			best = pos;
+			break;
+		} else {
+			if (bestDistance &gt; pos.dist) {
+				bestDistance = pos.dist;
+				best = pos;
+			}
+		}
+	}
+	if (!tryOnly) {
+		node.style.left = best.left + &quot;px&quot;;
+		node.style.top = best.top + &quot;px&quot;;
+	}
+	return best;
+};
+dojo.html.scrollIntoView = function (node) {
+	if (!node) {
+		return;
+	}
+	if (dojo.render.html.ie) {
+		if (dojo.html.getBorderBox(node.parentNode).height &lt;= node.parentNode.scrollHeight) {
+			node.scrollIntoView(false);
+		}
+	} else {
+		if (dojo.render.html.mozilla) {
+			node.scrollIntoView(false);
+		} else {
+			var parent = node.parentNode;
+			var parentBottom = parent.scrollTop + dojo.html.getBorderBox(parent).height;
+			var nodeBottom = node.offsetTop + dojo.html.getMarginBox(node).height;
+			if (parentBottom &lt; nodeBottom) {
+				parent.scrollTop += (nodeBottom - parentBottom);
+			} else {
+				if (parent.scrollTop &gt; node.offsetTop) {
+					parent.scrollTop -= (parent.scrollTop - node.offsetTop);
+				}
+			}
+		}
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/html.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/html.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/html.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.html&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.deprecated(&quot;dojo.html&quot;, &quot;replaced by dojo.html.*&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/README
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/README	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/README	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+All files within this directory and subdirectories were manually derived from <A HREF="http://unicode.org/cldr">http://unicode.org/cldr</A>
+
+See terms of use: <A HREF="http://www.unicode.org/copyright.html#Exhibit1">http://www.unicode.org/copyright.html#Exhibit1</A>
+
+Eventually, this data should be generated directly from the XML in the CLDR repository to provide
+accurate and full support for the full set of locales.

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/de/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/de/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/de/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;Wochentag&quot;, &quot;dateFormat-medium&quot;:&quot;dd.MM.yyyy&quot;, &quot;field-second&quot;:&quot;Sekunde&quot;, &quot;field-week&quot;:&quot;Woche&quot;, &quot;pm&quot;:&quot;nachm.&quot;, &quot;timeFormat-full&quot;:&quot;H:mm' Uhr 'z&quot;, &quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;am&quot;:&quot;vorm.&quot;, &quot;days-standAlone-narrow&quot;:[&quot;S&quot;, &quot;M&quot;, &quot;D&quot;, &quot;M&quot;, &quot;D&quot;, &quot;F&quot;, &quot;S&quot;], &quot;field-year&quot;:&quot;Jahr&quot;, &quot;eras&quot;:[&quot;v. Chr.&quot;, &quot;n. Chr.&quot;], &quot;field-hour&quot;:&quot;Stunde&quot;, &quot;dateFormat-long&quot;:&quot;d. MMMM yyyy&quot;, &quot;field-day&quot;:&quot;Tag&quot;, &quot;field-dayperiod&quot;:&quot;Tagesh\xe4lfte&quot;, &quot;field-month&quot;:&quot;Monat&quot;, &quot;dateFormat-short&quot;:&quot;dd.MM.yy&quot;, &quot;months-format-wide&quot;:[&quot;Januar&quot;, &quot;Februar&quot;, &quot;M\xe4rz&quot;, &quot;April&quot;, &quot;Mai&quot;, &quot;Juni&quot;, &quot;Juli&quot;, &quot;August&quot;, &quot;September&quot;, &quot;Oktober&quot;, &quot;November&quot;, &quot;Dezember&quot;], &quot;field-era&quot;:&quot;Epoche&quot;, &quot;months-format-abbr&quot;:[&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mrz&quot;, &quot;Apr&quot;, &quot;Mai&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Okt&quot;, &quot;Nov&quot;, &quot;Dez&quot;], &quot;days-format-wide&quot;:[&quot;Sonntag&quot;, &quot;Montag&quot;, &quot;Dienstag&quot;, &quot;Mittwoch&quot;, &quot;Donnerstag&quot;, &quot;Freitag&quot;, &quot;Samstag&quot;], &quot;dateFormat-full&quot;:&quot;EEEE, d. MMMM yyyy&quot;, &quot;field-zone&quot;:&quot;Zone&quot;, &quot;days-!
 format-abbr&quot;:[&quot;So&quot;, &quot;Mo&quot;, &quot;Di&quot;, &quot;Mi&quot;, &quot;Do&quot;, &quot;Fr&quot;, &quot;Sa&quot;], &quot;field-minute&quot;:&quot;Minute&quot;, &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/en/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/en/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/en/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;dateFormat-long&quot;:&quot;MMMM d, yyyy&quot;, &quot;timeFormat-full&quot;:&quot;h:mm:ss a v&quot;, &quot;eras&quot;:[&quot;BC&quot;, &quot;AD&quot;], &quot;timeFormat-medium&quot;:&quot;h:mm:ss a&quot;, &quot;dateFormat-medium&quot;:&quot;MMM d, yyyy&quot;, &quot;months-format-abbr&quot;:[&quot;Jan&quot;, &quot;Feb&quot;, &quot;Mar&quot;, &quot;Apr&quot;, &quot;May&quot;, &quot;Jun&quot;, &quot;Jul&quot;, &quot;Aug&quot;, &quot;Sep&quot;, &quot;Oct&quot;, &quot;Nov&quot;, &quot;Dec&quot;], &quot;dateFormat-full&quot;:&quot;EEEE, MMMM d, yyyy&quot;, &quot;days-format-abbr&quot;:[&quot;Sun&quot;, &quot;Mon&quot;, &quot;Tue&quot;, &quot;Wed&quot;, &quot;Thu&quot;, &quot;Fri&quot;, &quot;Sat&quot;], &quot;timeFormat-long&quot;:&quot;h:mm:ss a z&quot;, &quot;timeFormat-short&quot;:&quot;h:mm a&quot;, &quot;dateFormat-short&quot;:&quot;M/d/yy&quot;, &quot;months-format-wide&quot;:[&quot;January&quot;, &quot;February&quot;, &quot;March&quot;, &quot;April&quot;, &quot;May&quot;, &quot;June&quot;, &quot;July&quot;, &quot;August&quot;, &quot;September&quot;, &quot;October&quot;, &quot;November&quot;, &quot;December&quot;], &quot;days-standAlone-narrow&quot;:[&quot;S&quot;, &quot;M&quot;, &quot;T&quot;, &quot;W&quot;, &quot;T&quot;, &quot;F&quot;, &quot;S&quot;], &quot;days-format-wide&quot;:[&quot;Sunday&quot;, &quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;, &quot;Saturday&quot;], &quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;pm&quot;:&quot;PM&quot;, &quot;am&quot;:&quot;AM&quot;, &quot;field-year&quot;:&quot;Year&quot;, &quot;fi!
 eld-minute&quot;:&quot;Minute&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/es/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/es/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/es/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;d\xeda de la semana&quot;, &quot;dateFormat-medium&quot;:&quot;dd-MMM-yy&quot;, &quot;field-second&quot;:&quot;segundo&quot;, &quot;field-week&quot;:&quot;semana&quot;, &quot;pm&quot;:&quot;p.m.&quot;, &quot;timeFormat-full&quot;:&quot;HH'H'mm''ss\&quot; z&quot;, &quot;months-standAlone-narrow&quot;:[&quot;E&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;am&quot;:&quot;a.m.&quot;, &quot;days-standAlone-narrow&quot;:[&quot;D&quot;, &quot;L&quot;, &quot;M&quot;, &quot;M&quot;, &quot;J&quot;, &quot;V&quot;, &quot;S&quot;], &quot;field-year&quot;:&quot;a\xf1o&quot;, &quot;eras&quot;:[&quot;a.C.&quot;, &quot;d.C.&quot;], &quot;field-minute&quot;:&quot;minuto&quot;, &quot;field-hour&quot;:&quot;hora&quot;, &quot;dateFormat-long&quot;:&quot;d' de 'MMMM' de 'yyyy&quot;, &quot;field-day&quot;:&quot;d\xeda&quot;, &quot;field-dayperiod&quot;:&quot;periodo del d\xeda&quot;, &quot;field-month&quot;:&quot;mes&quot;, &quot;dateFormat-short&quot;:&quot;d/MM/yy&quot;, &quot;months-format-wide&quot;:[&quot;enero&quot;, &quot;febrero&quot;, &quot;marzo&quot;, &quot;abril&quot;, &quot;mayo&quot;, &quot;junio&quot;, &quot;julio&quot;, &quot;agosto&quot;, &quot;septiembre&quot;, &quot;octubre&quot;, &quot;noviembre&quot;, &quot;diciembre&quot;], &quot;field-era&quot;:&quot;era&quot;, &quot;months-format-abbr&quot;:[&quot;ene&quot;, &quot;feb&quot;, &quot;mar&quot;, &quot;abr&quot;, &quot;may&quot;, &quot;jun&quot;, &quot;jul&quot;, &quot;ago&quot;, &quot;sep&quot;, &quot;oct&quot;, &quot;nov&quot;, &quot;dic&quot;], &quot;days-format-wide&quot;:[&quot;domingo&quot;, &quot;lunes&quot;, &quot;martes&quot;, &quot;mi\xe9rcoles&quot;, &quot;jueves&quot;, &quot;viernes&quot;, &quot;s\xe1bado&quot;], &quot;dateFormat-full&quot;:&quot;EEEE d'!
  de 'MMMM' de 'yyyy&quot;, &quot;field-zone&quot;:&quot;zona&quot;, &quot;days-format-abbr&quot;:[&quot;dom&quot;, &quot;lun&quot;, &quot;mar&quot;, &quot;mi\xe9&quot;, &quot;jue&quot;, &quot;vie&quot;, &quot;s\xe1b&quot;], &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fi/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fi/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fi/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;viikonp\xe4iv\xe4&quot;, &quot;dateFormat-medium&quot;:&quot;d.M.yyyy&quot;, &quot;field-second&quot;:&quot;sekunti&quot;, &quot;field-week&quot;:&quot;viikko&quot;, &quot;pm&quot;:&quot;ip.&quot;, &quot;timeFormat-full&quot;:&quot;H.mm.ss v&quot;, &quot;months-standAlone-narrow&quot;:[&quot;T&quot;, &quot;H&quot;, &quot;M&quot;, &quot;H&quot;, &quot;T&quot;, &quot;K&quot;, &quot;H&quot;, &quot;E&quot;, &quot;S&quot;, &quot;L&quot;, &quot;M&quot;, &quot;J&quot;], &quot;am&quot;:&quot;ap.&quot;, &quot;days-standAlone-narrow&quot;:[&quot;S&quot;, &quot;M&quot;, &quot;T&quot;, &quot;K&quot;, &quot;T&quot;, &quot;P&quot;, &quot;L&quot;], &quot;field-year&quot;:&quot;vuosi&quot;, &quot;eras&quot;:[&quot;eKr.&quot;, &quot;jKr.&quot;], &quot;field-minute&quot;:&quot;minuutti&quot;, &quot;timeFormat-medium&quot;:&quot;H.mm.ss&quot;, &quot;field-hour&quot;:&quot;tunti&quot;, &quot;dateFormat-long&quot;:&quot;d. MMMM'ta 'yyyy&quot;, &quot;field-day&quot;:&quot;p\xe4iv\xe4&quot;, &quot;field-dayperiod&quot;:&quot;ap/ip-valinta&quot;, &quot;field-month&quot;:&quot;kuukausi&quot;, &quot;dateFormat-short&quot;:&quot;d.M.yyyy&quot;, &quot;months-format-wide&quot;:[&quot;tammikuu&quot;, &quot;helmikuu&quot;, &quot;maaliskuu&quot;, &quot;huhtikuu&quot;, &quot;toukokuu&quot;, &quot;kes\xe4kuu&quot;, &quot;hein\xe4kuu&quot;, &quot;elokuu&quot;, &quot;syyskuu&quot;, &quot;lokakuu&quot;, &quot;marraskuu&quot;, &quot;joulukuu&quot;], &quot;field-era&quot;:&quot;aikakausi&quot;, &quot;timeFormat-short&quot;:&quot;H.mm&quot;, &quot;months-format-abbr&quot;:[&quot;tammi&quot;, &quot;helmi&quot;, &quot;maalis&quot;, &quot;huhti&quot;, &quot;touko&quot;, &quot;kes\xe4&quot;, &quot;hein\xe4&quot;, &quot;elo&quot;, &quot;syys&quot;, &quot;loka&quot;, &quot;marras&quot;, &quot;joulu&quot;], &quot;timeFormat-long&quot;:&quot;'kl!
 o 'H.mm.ss&quot;, &quot;days-format-wide&quot;:[&quot;sunnuntai&quot;, &quot;maanantai&quot;, &quot;tiistai&quot;, &quot;keskiviikko&quot;, &quot;torstai&quot;, &quot;perjantai&quot;, &quot;lauantai&quot;], &quot;dateFormat-full&quot;:&quot;EEEE'na 'd. MMMM'ta 'yyyy&quot;, &quot;field-zone&quot;:&quot;aikavy\xf6hyke&quot;, &quot;days-format-abbr&quot;:[&quot;su&quot;, &quot;ma&quot;, &quot;ti&quot;, &quot;ke&quot;, &quot;to&quot;, &quot;pe&quot;, &quot;la&quot;]})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fr/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fr/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/fr/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;jour de la semaine&quot;, &quot;dateFormat-medium&quot;:&quot;d MMM yy&quot;, &quot;field-second&quot;:&quot;seconde&quot;, &quot;field-week&quot;:&quot;semaine&quot;, &quot;pm&quot;:&quot;ap. m.&quot;, &quot;timeFormat-full&quot;:&quot;HH' h 'mm z&quot;, &quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;am&quot;:&quot;matin&quot;, &quot;days-standAlone-narrow&quot;:[&quot;D&quot;, &quot;L&quot;, &quot;M&quot;, &quot;M&quot;, &quot;J&quot;, &quot;V&quot;, &quot;S&quot;], &quot;field-year&quot;:&quot;ann\xe9e&quot;, &quot;eras&quot;:[&quot;av. J.-C.&quot;, &quot;apr. J.-C.&quot;], &quot;field-minute&quot;:&quot;minute&quot;, &quot;field-hour&quot;:&quot;heure&quot;, &quot;dateFormat-long&quot;:&quot;d MMMM yyyy&quot;, &quot;field-day&quot;:&quot;jour&quot;, &quot;field-dayperiod&quot;:&quot;p\xe9riode de la journ\xe9e&quot;, &quot;field-month&quot;:&quot;mois&quot;, &quot;dateFormat-short&quot;:&quot;dd/MM/yy&quot;, &quot;months-format-wide&quot;:[&quot;janvier&quot;, &quot;f\xe9vrier&quot;, &quot;mars&quot;, &quot;avril&quot;, &quot;mai&quot;, &quot;juin&quot;, &quot;juillet&quot;, &quot;ao\xfbt&quot;, &quot;septembre&quot;, &quot;octobre&quot;, &quot;novembre&quot;, &quot;d\xe9cembre&quot;], &quot;field-era&quot;:&quot;\xe9poque&quot;, &quot;months-format-abbr&quot;:[&quot;janv.&quot;, &quot;f\xe9vr.&quot;, &quot;mars&quot;, &quot;avr.&quot;, &quot;mai&quot;, &quot;juin&quot;, &quot;juil.&quot;, &quot;ao\xfbt&quot;, &quot;sept.&quot;, &quot;oct.&quot;, &quot;nov.&quot;, &quot;d\xe9c.&quot;], &quot;days-format-wide&quot;:[&quot;dimanche&quot;, &quot;lundi&quot;, &quot;mardi&quot;, &quot;mercredi&quot;, &quot;jeudi&quot;, &quot;vendredi&quot;!
 , &quot;samedi&quot;], &quot;dateFormat-full&quot;:&quot;EEEE d MMMM yyyy&quot;, &quot;field-zone&quot;:&quot;zone&quot;, &quot;days-format-abbr&quot;:[&quot;dim.&quot;, &quot;lun.&quot;, &quot;mar.&quot;, &quot;mer.&quot;, &quot;jeu.&quot;, &quot;ven.&quot;, &quot;sam.&quot;], &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;dateFormat-medium&quot;:&quot;yyyy MMM d&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;pm&quot;:&quot;PM&quot;, &quot;timeFormat-full&quot;:&quot;HH:mm:ss z&quot;, &quot;months-standAlone-narrow&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;], &quot;am&quot;:&quot;AM&quot;, &quot;days-standAlone-narrow&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;], &quot;field-year&quot;:&quot;Year&quot;, &quot;eras&quot;:[&quot;BCE&quot;, &quot;CE&quot;], &quot;field-minute&quot;:&quot;Minute&quot;, &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;dateFormat-long&quot;:&quot;yyyy MMMM d&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;dateFormat-short&quot;:&quot;yy/MM/dd&quot;, &quot;months-format-wide&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;], &quot;field-era&quot;:&quot;Era&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;months-format-abbr&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;], &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;, &quot;days-format-wide&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;], &quot;dateFormat-full&quot;:&quot;EEEE, yyyy MMMM dd&quot;, &quot;field-zone&quot;:&quot;Zone&quot;, &quot;days-format-abbr&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4!
 &quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;]})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorianExtras.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorianExtras.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/gregorianExtras.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;dateFormat-yearOnly&quot;:&quot;yyyy&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/hu/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/hu/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/hu/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;h\xe9t napja&quot;, &quot;dateFormat-medium&quot;:&quot;yyyy MMM d&quot;, &quot;field-second&quot;:&quot;m\xe1sodperc&quot;, &quot;field-week&quot;:&quot;h\xe9t&quot;, &quot;pm&quot;:&quot;d.u.&quot;, &quot;timeFormat-full&quot;:&quot;h:mm:ss a v&quot;, &quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;\xc1&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;am&quot;:&quot;d.e.&quot;, &quot;days-standAlone-narrow&quot;:[&quot;V&quot;, &quot;H&quot;, &quot;K&quot;, &quot;Sz&quot;, &quot;Cs&quot;, &quot;P&quot;, &quot;Sz&quot;], &quot;field-year&quot;:&quot;\xe9v&quot;, &quot;eras&quot;:[&quot;k.e.&quot;, &quot;k.u.&quot;], &quot;field-minute&quot;:&quot;perc&quot;, &quot;timeFormat-medium&quot;:&quot;h:mm:ss a&quot;, &quot;field-hour&quot;:&quot;\xf3ra&quot;, &quot;dateFormat-long&quot;:&quot;yyyy MMMM d&quot;, &quot;field-day&quot;:&quot;nap&quot;, &quot;field-dayperiod&quot;:&quot;napszak&quot;, &quot;field-month&quot;:&quot;h\xf3nap&quot;, &quot;dateFormat-short&quot;:&quot;yyyy-M-d&quot;, &quot;months-format-wide&quot;:[&quot;janu\xe1r&quot;, &quot;febru\xe1r&quot;, &quot;m\xe1rcius&quot;, &quot;\xe1prilis&quot;, &quot;m\xe1jus&quot;, &quot;j\xfanius&quot;, &quot;j\xfalius&quot;, &quot;augusztus&quot;, &quot;szeptember&quot;, &quot;okt\xf3ber&quot;, &quot;november&quot;, &quot;december&quot;], &quot;field-era&quot;:&quot;\xe9ra&quot;, &quot;timeFormat-short&quot;:&quot;h:mm a&quot;, &quot;months-format-abbr&quot;:[&quot;jan&quot;, &quot;feb&quot;, &quot;m\xe1r&quot;, &quot;apr&quot;, &quot;m\xe1j&quot;, &quot;j\xfan&quot;, &quot;j\xfal&quot;, &quot;aug&quot;, &quot;sze&quot;, &quot;okt&quot;, &quot;nov&quot;, &quot;dec&quot;], &quot;timeFormat-long&quot;:&quot;h:mm:ss a z&quot;, &quot;d!
 ays-format-wide&quot;:[&quot;vas\xe1rnap&quot;, &quot;h\xe9tf\u0151&quot;, &quot;kedd&quot;, &quot;szerda&quot;, &quot;cs\xfct\xf6rt\xf6k&quot;, &quot;p\xe9ntek&quot;, &quot;szombat&quot;], &quot;dateFormat-full&quot;:&quot;yyyy MMMM d, EEEE&quot;, &quot;field-zone&quot;:&quot;z\xf3na&quot;, &quot;days-format-abbr&quot;:[&quot;Va&quot;, &quot;H\xe9&quot;, &quot;Ke&quot;, &quot;Sze&quot;, &quot;Cs\xfc&quot;, &quot;P\xe9&quot;, &quot;Szo&quot;]})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/it/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/it/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/it/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;giorno della settimana&quot;, &quot;dateFormat-medium&quot;:&quot;dd/MMM/yy&quot;, &quot;field-second&quot;:&quot;secondo&quot;, &quot;field-week&quot;:&quot;settimana&quot;, &quot;pm&quot;:&quot;p.&quot;, &quot;months-standAlone-narrow&quot;:[&quot;G&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;G&quot;, &quot;L&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;am&quot;:&quot;m.&quot;, &quot;days-standAlone-narrow&quot;:[&quot;D&quot;, &quot;L&quot;, &quot;M&quot;, &quot;M&quot;, &quot;G&quot;, &quot;V&quot;, &quot;S&quot;], &quot;field-year&quot;:&quot;anno&quot;, &quot;eras&quot;:[&quot;aC&quot;, &quot;dC&quot;], &quot;field-minute&quot;:&quot;minuto&quot;, &quot;field-hour&quot;:&quot;ora&quot;, &quot;dateFormat-long&quot;:&quot;dd MMMM yyyy&quot;, &quot;field-day&quot;:&quot;giorno&quot;, &quot;field-dayperiod&quot;:&quot;periodo del giorno&quot;, &quot;field-month&quot;:&quot;mese&quot;, &quot;dateFormat-short&quot;:&quot;dd/MM/yy&quot;, &quot;months-format-wide&quot;:[&quot;gennaio&quot;, &quot;febbraio&quot;, &quot;marzo&quot;, &quot;aprile&quot;, &quot;maggio&quot;, &quot;giugno&quot;, &quot;luglio&quot;, &quot;agosto&quot;, &quot;settembre&quot;, &quot;ottobre&quot;, &quot;novembre&quot;, &quot;dicembre&quot;], &quot;field-era&quot;:&quot;era&quot;, &quot;months-format-abbr&quot;:[&quot;gen&quot;, &quot;feb&quot;, &quot;mar&quot;, &quot;apr&quot;, &quot;mag&quot;, &quot;giu&quot;, &quot;lug&quot;, &quot;ago&quot;, &quot;set&quot;, &quot;ott&quot;, &quot;nov&quot;, &quot;dic&quot;], &quot;days-format-wide&quot;:[&quot;domenica&quot;, &quot;luned\xec&quot;, &quot;marted\xec&quot;, &quot;mercoled\xec&quot;, &quot;gioved\xec&quot;, &quot;venerd\xec&quot;, &quot;sabato&quot;], &quot;dateFormat-full&quot;:&quot;EEEE d MMMM yyyy&quot;, &quot;field-zone&quot;:&quot;zona&quot;!
 , &quot;days-format-abbr&quot;:[&quot;dom&quot;, &quot;lun&quot;, &quot;mar&quot;, &quot;mer&quot;, &quot;gio&quot;, &quot;ven&quot;, &quot;sab&quot;], &quot;timeFormat-full&quot;:&quot;HH:mm:ss z&quot;, &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;days-standAlone-narrow&quot;:[&quot;\u65e5&quot;, &quot;\u6708&quot;, &quot;\u706b&quot;, &quot;\u6c34&quot;, &quot;\u6728&quot;, &quot;\u91d1&quot;, &quot;\u571f&quot;], &quot;timeFormat-full&quot;:&quot;H'\u6642'mm'\u5206'ss'\u79d2'z&quot;, &quot;eras&quot;:[&quot;\u7d00\u5143\u524d&quot;, &quot;\u897f\u66a6&quot;], &quot;timeFormat-medium&quot;:&quot;H:mm:ss&quot;, &quot;dateFormat-medium&quot;:&quot;yyyy/MM/dd&quot;, &quot;am&quot;:&quot;\u5348\u524d&quot;, &quot;months-format-abbr&quot;:[&quot;1 \u6708&quot;, &quot;2 \u6708&quot;, &quot;3 \u6708&quot;, &quot;4 \u6708&quot;, &quot;5 \u6708&quot;, &quot;6 \u6708&quot;, &quot;7 \u6708&quot;, &quot;8 \u6708&quot;, &quot;9 \u6708&quot;, &quot;10 \u6708&quot;, &quot;11 \u6708&quot;, &quot;12 \u6708&quot;], &quot;dateFormat-full&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'EEEE&quot;, &quot;days-format-abbr&quot;:[&quot;\u65e5&quot;, &quot;\u6708&quot;, &quot;\u706b&quot;, &quot;\u6c34&quot;, &quot;\u6728&quot;, &quot;\u91d1&quot;, &quot;\u571f&quot;], &quot;timeFormat-long&quot;:&quot;H:mm:ss:z&quot;, &quot;timeFormat-short&quot;:&quot;H:mm&quot;, &quot;pm&quot;:&quot;\u5348\u5f8c&quot;, &quot;months-format-wide&quot;:[&quot;1 \u6708&quot;, &quot;2 \u6708&quot;, &quot;3 \u6708&quot;, &quot;4 \u6708&quot;, &quot;5 \u6708&quot;, &quot;6 \u6708&quot;, &quot;7 \u6708&quot;, &quot;8 \u6708&quot;, &quot;9 \u6708&quot;, &quot;10 \u6708&quot;, &quot;11 \u6708&quot;, &quot;12 \u6708&quot;], &quot;dateFormat-long&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'&quot;, &quot;days-format-wide&quot;:[&quot;\u65e5\u66dc\u65e5&quot;, &quot;\u6708\u66dc\u65e5&quot;, &quot;\u706b\u66dc\u65e5&quot;, !
 &quot;\u6c34\u66dc\u65e5&quot;, &quot;\u6728\u66dc\u65e5&quot;, &quot;\u91d1\u66dc\u65e5&quot;, &quot;\u571f\u66dc\u65e5&quot;], &quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;months-standAlone-narrow&quot;:[&quot;1&quot;, &quot;2&quot;, &quot;3&quot;, &quot;4&quot;, &quot;5&quot;, &quot;6&quot;, &quot;7&quot;, &quot;8&quot;, &quot;9&quot;, &quot;10&quot;, &quot;11&quot;, &quot;12&quot;], &quot;field-year&quot;:&quot;Year&quot;, &quot;field-minute&quot;:&quot;Minute&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;dateFormat-short&quot;:&quot;yy/MM/dd&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorianExtras.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorianExtras.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ja/gregorianExtras.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;dateFormat-yearOnly&quot;:&quot;yyyy\u5e74&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ko/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ko/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/ko/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;months-standAlone-narrow&quot;:[&quot;1\uc6d4&quot;, &quot;2\uc6d4&quot;, &quot;3\uc6d4&quot;, &quot;4\uc6d4&quot;, &quot;5\uc6d4&quot;, &quot;6\uc6d4&quot;, &quot;7\uc6d4&quot;, &quot;8\uc6d4&quot;, &quot;9\uc6d4&quot;, &quot;10\uc6d4&quot;, &quot;11\uc6d4&quot;, &quot;12\uc6d4&quot;], &quot;dateFormat-long&quot;:&quot;yyyy'\ub144' M'\uc6d4' d'\uc77c'&quot;, &quot;timeFormat-full&quot;:&quot;a hh'\uc2dc' mm'\ubd84' ss'\ucd08' z&quot;, &quot;eras&quot;:[&quot;\uae30\uc6d0\uc804&quot;, &quot;\uc11c\uae30&quot;], &quot;timeFormat-medium&quot;:&quot;a hh'\uc2dc' mm'\ubd84'&quot;, &quot;dateFormat-medium&quot;:&quot;yyyy. MM. dd&quot;, &quot;am&quot;:&quot;\uc624\uc804&quot;, &quot;months-format-abbr&quot;:[&quot;1\uc6d4&quot;, &quot;2\uc6d4&quot;, &quot;3\uc6d4&quot;, &quot;4\uc6d4&quot;, &quot;5\uc6d4&quot;, &quot;6\uc6d4&quot;, &quot;7\uc6d4&quot;, &quot;8\uc6d4&quot;, &quot;9\uc6d4&quot;, &quot;10\uc6d4&quot;, &quot;11\uc6d4&quot;, &quot;12\uc6d4&quot;], &quot;dateFormat-full&quot;:&quot;yyyy'\ub144' M'\uc6d4' d'\uc77c' EEEE&quot;, &quot;days-format-abbr&quot;:[&quot;\uc77c&quot;, &quot;\uc6d4&quot;, &quot;\ud654&quot;, &quot;\uc218&quot;, &quot;\ubaa9&quot;, &quot;\uae08&quot;, &quot;\ud1a0&quot;], &quot;timeFormat-long&quot;:&quot;a hh'\uc2dc' mm'\ubd84' ss'\ucd08'&quot;, &quot;timeFormat-short&quot;:&quot;a hh'\uc2dc' mm'\ubd84'&quot;, &quot;dateFormat-short&quot;:&quot;yy. MM. dd&quot;, &quot;pm&quot;:&quot;\uc624\ud6c4&quot;, &quot;months-format-wide&quot;:[&quot;1\uc6d4&quot;, &quot;2\uc6d4&quot;, &quot;3\uc6d4&quot;, &quot;4\uc6d4&quot;, &quot;5\uc6d4&quot;, &quot;6\uc6d4&quot;, &quot;7\uc6d!
 4&quot;, &quot;8\uc6d4&quot;, &quot;9\uc6d4&quot;, &quot;10\uc6d4&quot;, &quot;11\uc6d4&quot;, &quot;12\uc6d4&quot;], &quot;days-standAlone-narrow&quot;:[&quot;\uc77c&quot;, &quot;\uc6d4&quot;, &quot;\ud654&quot;, &quot;\uc218&quot;, &quot;\ubaa9&quot;, &quot;\uae08&quot;, &quot;\ud1a0&quot;], &quot;days-format-wide&quot;:[&quot;\uc77c\uc694\uc77c&quot;, &quot;\uc6d4\uc694\uc77c&quot;, &quot;\ud654\uc694\uc77c&quot;, &quot;\uc218\uc694\uc77c&quot;, &quot;\ubaa9\uc694\uc77c&quot;, &quot;\uae08\uc694\uc77c&quot;, &quot;\ud1a0\uc694\uc77c&quot;], &quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;field-year&quot;:&quot;Year&quot;, &quot;field-minute&quot;:&quot;Minute&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/nl/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/nl/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/nl/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;dateFormat-medium&quot;:&quot;d MMM yyyy&quot;, &quot;field-second&quot;:&quot;Seconde&quot;, &quot;timeFormat-full&quot;:&quot;HH:mm:ss v&quot;, &quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;days-standAlone-narrow&quot;:[&quot;Z&quot;, &quot;M&quot;, &quot;D&quot;, &quot;W&quot;, &quot;D&quot;, &quot;V&quot;, &quot;Z&quot;], &quot;field-year&quot;:&quot;Jaar&quot;, &quot;eras&quot;:[&quot;v. Chr.&quot;, &quot;n. Chr.&quot;], &quot;field-minute&quot;:&quot;Minuut&quot;, &quot;field-hour&quot;:&quot;Uur&quot;, &quot;dateFormat-long&quot;:&quot;d MMMM yyyy&quot;, &quot;field-day&quot;:&quot;Dag&quot;, &quot;field-dayperiod&quot;:&quot;Dagdeel&quot;, &quot;field-month&quot;:&quot;Maand&quot;, &quot;dateFormat-short&quot;:&quot;dd-MM-yy&quot;, &quot;months-format-wide&quot;:[&quot;januari&quot;, &quot;februari&quot;, &quot;maart&quot;, &quot;april&quot;, &quot;mei&quot;, &quot;juni&quot;, &quot;juli&quot;, &quot;augustus&quot;, &quot;september&quot;, &quot;oktober&quot;, &quot;november&quot;, &quot;december&quot;], &quot;field-era&quot;:&quot;Tijdperk&quot;, &quot;months-format-abbr&quot;:[&quot;jan&quot;, &quot;feb&quot;, &quot;mrt&quot;, &quot;apr&quot;, &quot;mei&quot;, &quot;jun&quot;, &quot;jul&quot;, &quot;aug&quot;, &quot;sep&quot;, &quot;okt&quot;, &quot;nov&quot;, &quot;dec&quot;], &quot;days-format-wide&quot;:[&quot;zondag&quot;, &quot;maandag&quot;, &quot;dinsdag&quot;, &quot;woensdag&quot;, &quot;donderdag&quot;, &quot;vrijdag&quot;, &quot;zaterdag&quot;], &quot;dateFormat-full&quot;:&quot;EEEE d MMMM yyyy&quot;, &quot;days-format-abbr&quot;:[&quot;zo&quot;, &quot;ma&quot;, &quot;di&quot;, &quot;wo&quot;, &quot;do&quot;, &quot;vr&quot;, &quot;za&quot;], &quot;field-weekday&quot;:&quot;Dag van de wee!
 k&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;pm&quot;:&quot;PM&quot;, &quot;am&quot;:&quot;AM&quot;, &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;dateFormat-long&quot;:&quot;d' de 'MMMM' de 'yyyy&quot;, &quot;timeFormat-full&quot;:&quot;HH'H'mm'm'ss's' z&quot;, &quot;eras&quot;:[&quot;a.C.&quot;, &quot;d.C.&quot;], &quot;dateFormat-medium&quot;:&quot;d/MMM/yyyy&quot;, &quot;months-format-abbr&quot;:[&quot;jan&quot;, &quot;fev&quot;, &quot;mar&quot;, &quot;abr&quot;, &quot;mai&quot;, &quot;jun&quot;, &quot;jul&quot;, &quot;ago&quot;, &quot;set&quot;, &quot;out&quot;, &quot;nov&quot;, &quot;dez&quot;], &quot;dateFormat-full&quot;:&quot;EEEE, d' de 'MMMM' de 'yyyy&quot;, &quot;days-format-abbr&quot;:[&quot;dom&quot;, &quot;seg&quot;, &quot;ter&quot;, &quot;qua&quot;, &quot;qui&quot;, &quot;sex&quot;, &quot;s\xe1b&quot;], &quot;dateFormat-short&quot;:&quot;dd-MM-yyyy&quot;, &quot;months-format-wide&quot;:[&quot;janeiro&quot;, &quot;fevereiro&quot;, &quot;mar\xe7o&quot;, &quot;abril&quot;, &quot;maio&quot;, &quot;junho&quot;, &quot;julho&quot;, &quot;agosto&quot;, &quot;setembro&quot;, &quot;outubro&quot;, &quot;novembro&quot;, &quot;dezembro&quot;], &quot;days-standAlone-narrow&quot;:[&quot;D&quot;, &quot;S&quot;, &quot;T&quot;, &quot;Q&quot;, &quot;Q&quot;, &quot;S&quot;, &quot;S&quot;], &quot;days-format-wide&quot;:[&quot;domingo&quot;, &quot;segunda-feira&quot;, &quot;ter\xe7a-feira&quot;, &quot;quarta-feira&quot;, &quot;quinta-feira&quot;, &quot;sexta-feira&quot;, &quot;s\xe1bado&quot;], &quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;pm&quot;:&quot;PM&quot;, &quot;am&quot;:&quot;AM&quot;, &quot;field-year&quot;:&quot;Year&quot;, &quot;field-minute&quot;:&quot;Minute&quot;, &quot;time!
 Format-medium&quot;:&quot;HH:mm:ss&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt-br/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt-br/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/pt-br/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-hour&quot;:&quot;Hora&quot;, &quot;field-dayperiod&quot;:&quot;Per\xedodo do dia&quot;, &quot;field-minute&quot;:&quot;Minuto&quot;, &quot;timeFormat-full&quot;:&quot;HH'h'mm'min'ss's' z&quot;, &quot;field-weekday&quot;:&quot;Dia da semana&quot;, &quot;field-week&quot;:&quot;Semana&quot;, &quot;field-second&quot;:&quot;Segundo&quot;, &quot;dateFormat-medium&quot;:&quot;dd/MM/yyyy&quot;, &quot;field-day&quot;:&quot;Dia&quot;, &quot;timeFormat-long&quot;:&quot;H'h'm'min's's' z&quot;, &quot;field-month&quot;:&quot;M\xeas&quot;, &quot;field-year&quot;:&quot;Ano&quot;, &quot;dateFormat-short&quot;:&quot;dd/MM/yy&quot;, &quot;field-zone&quot;:&quot;Fuso&quot;, &quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;dateFormat-long&quot;:&quot;d' de 'MMMM' de 'yyyy&quot;, &quot;eras&quot;:[&quot;a.C.&quot;, &quot;d.C.&quot;], &quot;months-format-abbr&quot;:[&quot;jan&quot;, &quot;fev&quot;, &quot;mar&quot;, &quot;abr&quot;, &quot;mai&quot;, &quot;jun&quot;, &quot;jul&quot;, &quot;ago&quot;, &quot;set&quot;, &quot;out&quot;, &quot;nov&quot;, &quot;dez&quot;], &quot;dateFormat-full&quot;:&quot;EEEE, d' de 'MMMM' de 'yyyy&quot;, &quot;days-format-abbr&quot;:[&quot;dom&quot;, &quot;seg&quot;, &quot;ter&quot;, &quot;qua&quot;, &quot;qui&quot;, &quot;sex&quot;, &quot;s\xe1b&quot;], &quot;months-format-wide&quot;:[&quot;janeiro&quot;, &quot;fevereiro&quot;, &quot;mar\xe7o&quot;, &quot;abril&quot;, &quot;maio&quot;, &quot;junho&quot;, &quot;julho&quot;, &quot;agosto&quot;, &quot;setembro&quot;, &quot;outubro&quot;, &quot;novembro&quot;, &quot;dezembro&quot;], &quot;days-standAlone-narrow&quot;:[&quot;D&quot;, &quot;S&quot;, &quot;T&quot;, &quot;Q&quot;, &quot;Q&quot;, &quot;S&quot;!
 , &quot;S&quot;], &quot;days-format-wide&quot;:[&quot;domingo&quot;, &quot;segunda-feira&quot;, &quot;ter\xe7a-feira&quot;, &quot;quarta-feira&quot;, &quot;quinta-feira&quot;, &quot;sexta-feira&quot;, &quot;s\xe1bado&quot;], &quot;pm&quot;:&quot;PM&quot;, &quot;am&quot;:&quot;AM&quot;, &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/sv/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/sv/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/sv/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;field-weekday&quot;:&quot;veckodag&quot;, &quot;dateFormat-medium&quot;:&quot;d MMM yyyy&quot;, &quot;field-second&quot;:&quot;sekund&quot;, &quot;field-week&quot;:&quot;vecka&quot;, &quot;pm&quot;:&quot;em&quot;, &quot;timeFormat-full&quot;:&quot;'kl. 'HH.mm.ss z&quot;, &quot;months-standAlone-narrow&quot;:[&quot;J&quot;, &quot;F&quot;, &quot;M&quot;, &quot;A&quot;, &quot;M&quot;, &quot;J&quot;, &quot;J&quot;, &quot;A&quot;, &quot;S&quot;, &quot;O&quot;, &quot;N&quot;, &quot;D&quot;], &quot;am&quot;:&quot;fm&quot;, &quot;days-standAlone-narrow&quot;:[&quot;S&quot;, &quot;M&quot;, &quot;T&quot;, &quot;O&quot;, &quot;T&quot;, &quot;F&quot;, &quot;L&quot;], &quot;field-year&quot;:&quot;\xe5r&quot;, &quot;eras&quot;:[&quot;f.Kr.&quot;, &quot;e.Kr.&quot;], &quot;field-minute&quot;:&quot;minut&quot;, &quot;timeFormat-medium&quot;:&quot;HH.mm.ss&quot;, &quot;field-hour&quot;:&quot;timme&quot;, &quot;dateFormat-long&quot;:&quot;EEEE d MMM yyyy&quot;, &quot;field-day&quot;:&quot;dag&quot;, &quot;field-dayperiod&quot;:&quot;dagsperiod&quot;, &quot;field-month&quot;:&quot;m\xe5nad&quot;, &quot;dateFormat-short&quot;:&quot;yyyy-MM-dd&quot;, &quot;months-format-wide&quot;:[&quot;januari&quot;, &quot;februari&quot;, &quot;mars&quot;, &quot;april&quot;, &quot;maj&quot;, &quot;juni&quot;, &quot;juli&quot;, &quot;augusti&quot;, &quot;september&quot;, &quot;oktober&quot;, &quot;november&quot;, &quot;december&quot;], &quot;field-era&quot;:&quot;era&quot;, &quot;timeFormat-short&quot;:&quot;HH.mm&quot;, &quot;months-format-abbr&quot;:[&quot;jan&quot;, &quot;feb&quot;, &quot;mar&quot;, &quot;apr&quot;, &quot;maj&quot;, &quot;jun&quot;, &quot;jul&quot;, &quot;aug&quot;, &quot;sep&quot;, &quot;okt&quot;, &quot;nov&quot;, &quot;dec&quot;], &quot;timeFormat-long&quot;:&quot;HH.mm.ss z&quot;, &quot;days-format-wide&quot;:[&quot;s\xf6ndag&quot;, &quot;m\xe5ndag&quot;, &quot;tisdag&quot;, &quot;onsd!
 ag&quot;, &quot;torsdag&quot;, &quot;fredag&quot;, &quot;l\xf6rdag&quot;], &quot;dateFormat-full&quot;:&quot;EEEE'en den' d MMMM yyyy&quot;, &quot;field-zone&quot;:&quot;tidszon&quot;, &quot;days-format-abbr&quot;:[&quot;s\xf6&quot;, &quot;m\xe5&quot;, &quot;ti&quot;, &quot;on&quot;, &quot;to&quot;, &quot;fr&quot;, &quot;l\xf6&quot;]})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;days-standAlone-narrow&quot;:[&quot;\u65e5&quot;, &quot;\u4e00&quot;, &quot;\u4e8c&quot;, &quot;\u4e09&quot;, &quot;\u56db&quot;, &quot;\u4e94&quot;, &quot;\u516d&quot;], &quot;eras&quot;:[&quot;\u516c\u5143\u524d&quot;, &quot;\u516c\u5143&quot;], &quot;am&quot;:&quot;\u4e0a\u5348&quot;, &quot;months-format-abbr&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708&quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;, &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;days-format-abbr&quot;:[&quot;\u5468\u65e5&quot;, &quot;\u5468\u4e00&quot;, &quot;\u5468\u4e8c&quot;, &quot;\u5468\u4e09&quot;, &quot;\u5468\u56db&quot;, &quot;\u5468\u4e94&quot;, &quot;\u5468\u516d&quot;], &quot;pm&quot;:&quot;\u4e0b\u5348&quot;, &quot;months-format-wide&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708&quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;, &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;months-standAlone-narrow&quot;:[&quot;1\u6708&quot;, &quot;2\u6708&quot;, &quot;3\u6708&quot;, &quot;4\u6708&quot;, &quot;5\u6708&quot;, &quot;6\u6708&quot;, &quot;7\u6708&quot;, &quot;8\u6708&quot;, &quot;9\u6708&quot;, &quot;10\u6708&quot;, &quot;11\u6708&quot;, &quot;12\u6708&quot;], &quot;days-format-wide&quot;:[&quot;\u661f\u671f\u65e5&quot;, &quot;\u661f!
 \u671f\u4e00&quot;, &quot;\u661f\u671f\u4e8c&quot;, &quot;\u661f\u671f\u4e09&quot;, &quot;\u661f\u671f\u56db&quot;, &quot;\u661f\u671f\u4e94&quot;, &quot;\u661f\u671f\u516d&quot;], &quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;dateFormat-medium&quot;:&quot;yyyy MMM d&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;timeFormat-full&quot;:&quot;HH:mm:ss z&quot;, &quot;field-year&quot;:&quot;Year&quot;, &quot;field-minute&quot;:&quot;Minute&quot;, &quot;timeFormat-medium&quot;:&quot;HH:mm:ss&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;dateFormat-long&quot;:&quot;yyyy MMMM d&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;dateFormat-short&quot;:&quot;yy/MM/dd&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;timeFormat-short&quot;:&quot;HH:mm&quot;, &quot;timeFormat-long&quot;:&quot;HH:mm:ss z&quot;, &quot;dateFormat-full&quot;:&quot;EEEE, yyyy MMMM dd&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorianExtras.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorianExtras.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh/gregorianExtras.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;dateFormat-yearOnly&quot;:&quot;yyyy'\u5e74'&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-cn/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-cn/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-cn/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;dateFormat-medium&quot;:&quot;yyyy-M-d&quot;, &quot;field-second&quot;:&quot;\u79d2\u949f&quot;, &quot;field-week&quot;:&quot;\u5468&quot;, &quot;timeFormat-full&quot;:&quot;ahh'\u65f6'mm'\u5206'ss'\u79d2' z&quot;, &quot;field-year&quot;:&quot;\u5e74&quot;, &quot;field-minute&quot;:&quot;\u5206\u949f&quot;, &quot;timeFormat-medium&quot;:&quot;ahh:mm:ss&quot;, &quot;field-hour&quot;:&quot;\u5c0f\u65f6&quot;, &quot;dateFormat-long&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'&quot;, &quot;field-day&quot;:&quot;\u65e5&quot;, &quot;field-dayperiod&quot;:&quot;\u4e0a\u5348/\u4e0b\u5348&quot;, &quot;field-month&quot;:&quot;\u6708&quot;, &quot;dateFormat-short&quot;:&quot;yy-M-d&quot;, &quot;field-era&quot;:&quot;\u65f6\u671f&quot;, &quot;timeFormat-short&quot;:&quot;ah:mm&quot;, &quot;timeFormat-long&quot;:&quot;ahh'\u65f6'mm'\u5206'ss'\u79d2'&quot;, &quot;dateFormat-full&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'EEEE&quot;, &quot;field-weekday&quot;:&quot;\u5468\u5929&quot;, &quot;field-zone&quot;:&quot;\u533a\u57df&quot;, &quot;days-standAlone-narrow&quot;:[&quot;\u65e5&quot;, &quot;\u4e00&quot;, &quot;\u4e8c&quot;, &quot;\u4e09&quot;, &quot;\u56db&quot;, &quot;\u4e94&quot;, &quot;\u516d&quot;], &quot;eras&quot;:[&quot;\u516c\u5143\u524d&quot;, &quot;\u516c\u5143&quot;], &quot;am&quot;:&quot;\u4e0a\u5348&quot;, &quot;months-format-abbr&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708&quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;!
 , &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;days-format-abbr&quot;:[&quot;\u5468\u65e5&quot;, &quot;\u5468\u4e00&quot;, &quot;\u5468\u4e8c&quot;, &quot;\u5468\u4e09&quot;, &quot;\u5468\u56db&quot;, &quot;\u5468\u4e94&quot;, &quot;\u5468\u516d&quot;], &quot;pm&quot;:&quot;\u4e0b\u5348&quot;, &quot;months-format-wide&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708&quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;, &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;months-standAlone-narrow&quot;:[&quot;1\u6708&quot;, &quot;2\u6708&quot;, &quot;3\u6708&quot;, &quot;4\u6708&quot;, &quot;5\u6708&quot;, &quot;6\u6708&quot;, &quot;7\u6708&quot;, &quot;8\u6708&quot;, &quot;9\u6708&quot;, &quot;10\u6708&quot;, &quot;11\u6708&quot;, &quot;12\u6708&quot;], &quot;days-format-wide&quot;:[&quot;\u661f\u671f\u65e5&quot;, &quot;\u661f\u671f\u4e00&quot;, &quot;\u661f\u671f\u4e8c&quot;, &quot;\u661f\u671f\u4e09&quot;, &quot;\u661f\u671f\u56db&quot;, &quot;\u661f\u671f\u4e94&quot;, &quot;\u661f\u671f\u516d&quot;]})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-hk/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-hk/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-hk/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;timeFormat-full&quot;:&quot;ahh'\u6642'mm'\u5206'ss'\u79d2' z&quot;, &quot;eras&quot;:[&quot;\u897f\u5143\u524d&quot;, &quot;\u897f\u5143&quot;], &quot;timeFormat-medium&quot;:&quot;a h:mm:ss&quot;, &quot;dateFormat-medium&quot;:&quot;yyyy/M/d&quot;, &quot;dateFormat-full&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'EEEE&quot;, &quot;days-format-abbr&quot;:[&quot;\u9031\u65e5&quot;, &quot;\u9031\u4e00&quot;, &quot;\u9031\u4e8c&quot;, &quot;\u9031\u4e09&quot;, &quot;\u9031\u56db&quot;, &quot;\u9031\u4e94&quot;, &quot;\u9031\u516d&quot;], &quot;timeFormat-long&quot;:&quot;ahh'\u6642'mm'\u5206'ss'\u79d2'&quot;, &quot;timeFormat-short&quot;:&quot;a h:mm&quot;, &quot;dateFormat-short&quot;:&quot;yyyy/M/d&quot;, &quot;dateFormat-long&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'&quot;, &quot;days-standAlone-narrow&quot;:[&quot;\u65e5&quot;, &quot;\u4e00&quot;, &quot;\u4e8c&quot;, &quot;\u4e09&quot;, &quot;\u56db&quot;, &quot;\u4e94&quot;, &quot;\u516d&quot;], &quot;am&quot;:&quot;\u4e0a\u5348&quot;, &quot;months-format-abbr&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708&quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;, &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;pm&quot;:&quot;\u4e0b\u5348&quot;, &quot;months-format-wide&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708!
 &quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;, &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;months-standAlone-narrow&quot;:[&quot;1\u6708&quot;, &quot;2\u6708&quot;, &quot;3\u6708&quot;, &quot;4\u6708&quot;, &quot;5\u6708&quot;, &quot;6\u6708&quot;, &quot;7\u6708&quot;, &quot;8\u6708&quot;, &quot;9\u6708&quot;, &quot;10\u6708&quot;, &quot;11\u6708&quot;, &quot;12\u6708&quot;], &quot;days-format-wide&quot;:[&quot;\u661f\u671f\u65e5&quot;, &quot;\u661f\u671f\u4e00&quot;, &quot;\u661f\u671f\u4e8c&quot;, &quot;\u661f\u671f\u4e09&quot;, &quot;\u661f\u671f\u56db&quot;, &quot;\u661f\u671f\u4e94&quot;, &quot;\u661f\u671f\u516d&quot;], &quot;field-weekday&quot;:&quot;Day of the Week&quot;, &quot;field-second&quot;:&quot;Second&quot;, &quot;field-week&quot;:&quot;Week&quot;, &quot;field-year&quot;:&quot;Year&quot;, &quot;field-minute&quot;:&quot;Minute&quot;, &quot;field-hour&quot;:&quot;Hour&quot;, &quot;field-day&quot;:&quot;Day&quot;, &quot;field-dayperiod&quot;:&quot;Dayperiod&quot;, &quot;field-month&quot;:&quot;Month&quot;, &quot;field-era&quot;:&quot;Era&quot;, &quot;field-zone&quot;:&quot;Zone&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-tw/gregorian.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-tw/gregorian.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/calendar/nls/zh-tw/gregorian.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;dateFormat-medium&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'&quot;, &quot;field-second&quot;:&quot;\u79d2&quot;, &quot;field-week&quot;:&quot;\u9031&quot;, &quot;timeFormat-full&quot;:&quot;ahh'\u6642'mm'\u5206'ss'\u79d2' z&quot;, &quot;eras&quot;:[&quot;\u897f\u5143\u524d&quot;, &quot;\u897f\u5143&quot;], &quot;field-year&quot;:&quot;\u5e74&quot;, &quot;field-minute&quot;:&quot;\u5206\u9418&quot;, &quot;timeFormat-medium&quot;:&quot;ahh:mm:ss&quot;, &quot;field-hour&quot;:&quot;\u5c0f\u6642&quot;, &quot;dateFormat-long&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'&quot;, &quot;field-day&quot;:&quot;\u6574\u65e5&quot;, &quot;field-dayperiod&quot;:&quot;\u65e5\u9593&quot;, &quot;field-month&quot;:&quot;\u6708&quot;, &quot;dateFormat-short&quot;:&quot;yy'\u5e74'M'\u6708'd'\u65e5'&quot;, &quot;field-era&quot;:&quot;\u5e74\u4ee3&quot;, &quot;timeFormat-short&quot;:&quot;ah:mm&quot;, &quot;months-format-abbr&quot;:[&quot;1\u6708&quot;, &quot;2\u6708&quot;, &quot;3\u6708&quot;, &quot;4\u6708&quot;, &quot;5\u6708&quot;, &quot;6\u6708&quot;, &quot;7\u6708&quot;, &quot;8\u6708&quot;, &quot;9\u6708&quot;, &quot;10\u6708&quot;, &quot;11\u6708&quot;, &quot;12\u6708&quot;], &quot;timeFormat-long&quot;:&quot;ahh'\u6642'mm'\u5206'ss'\u79d2'&quot;, &quot;field-weekday&quot;:&quot;\u9031\u5929&quot;, &quot;dateFormat-full&quot;:&quot;yyyy'\u5e74'M'\u6708'd'\u65e5'EEEE&quot;, &quot;field-zone&quot;:&quot;\u5340\u57df&quot;, &quot;days-standAlone-narrow&quot;:[&quot;\u65e5&quot;, &quot;\u4e00&quot;, &quot;\u4e8c&quot;, &quot;\u4e09&quot;, &quot;\u56db&quot;, &quot;\u4e94&quot;, &quot;\u516d!
 &quot;], &quot;am&quot;:&quot;\u4e0a\u5348&quot;, &quot;days-format-abbr&quot;:[&quot;\u5468\u65e5&quot;, &quot;\u5468\u4e00&quot;, &quot;\u5468\u4e8c&quot;, &quot;\u5468\u4e09&quot;, &quot;\u5468\u56db&quot;, &quot;\u5468\u4e94&quot;, &quot;\u5468\u516d&quot;], &quot;pm&quot;:&quot;\u4e0b\u5348&quot;, &quot;months-format-wide&quot;:[&quot;\u4e00\u6708&quot;, &quot;\u4e8c\u6708&quot;, &quot;\u4e09\u6708&quot;, &quot;\u56db\u6708&quot;, &quot;\u4e94\u6708&quot;, &quot;\u516d\u6708&quot;, &quot;\u4e03\u6708&quot;, &quot;\u516b\u6708&quot;, &quot;\u4e5d\u6708&quot;, &quot;\u5341\u6708&quot;, &quot;\u5341\u4e00\u6708&quot;, &quot;\u5341\u4e8c\u6708&quot;], &quot;months-standAlone-narrow&quot;:[&quot;1\u6708&quot;, &quot;2\u6708&quot;, &quot;3\u6708&quot;, &quot;4\u6708&quot;, &quot;5\u6708&quot;, &quot;6\u6708&quot;, &quot;7\u6708&quot;, &quot;8\u6708&quot;, &quot;9\u6708&quot;, &quot;10\u6708&quot;, &quot;11\u6708&quot;, &quot;12\u6708&quot;], &quot;days-format-wide&quot;:[&quot;\u661f\u671f\u65e5&quot;, &quot;\u661f\u671f\u4e00&quot;, &quot;\u661f\u671f\u4e8c&quot;, &quot;\u661f\u671f\u4e09&quot;, &quot;\u661f\u671f\u56db&quot;, &quot;\u661f\u671f\u4e94&quot;, &quot;\u661f\u671f\u516d&quot;]})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,44 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.i18n.common&quot;);
+dojo.i18n.getLocalization = function (packageName, bundleName, locale) {
+	dojo.hostenv.preloadLocalizations();
+	locale = dojo.hostenv.normalizeLocale(locale);
+	var elements = locale.split(&quot;-&quot;);
+	var module = [packageName, &quot;nls&quot;, bundleName].join(&quot;.&quot;);
+	var bundle = dojo.hostenv.findModule(module, true);
+	var localization;
+	for (var i = elements.length; i &gt; 0; i--) {
+		var loc = elements.slice(0, i).join(&quot;_&quot;);
+		if (bundle[loc]) {
+			localization = bundle[loc];
+			break;
+		}
+	}
+	if (!localization) {
+		localization = bundle.ROOT;
+	}
+	if (localization) {
+		var clazz = function () {
+		};
+		clazz.prototype = localization;
+		return new clazz();
+	}
+	dojo.raise(&quot;Bundle not found: &quot; + bundleName + &quot; in &quot; + packageName + &quot; , locale=&quot; + locale);
+};
+dojo.i18n.isLTR = function (locale) {
+	var lang = dojo.hostenv.normalizeLocale(locale).split(&quot;-&quot;)[0];
+	var RTL = {ar:true, fa:true, he:true, ur:true, yi:true};
+	return !RTL[lang];
+};
+

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,138 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.i18n.currency.common&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.i18n.currency&quot;);
+dojo.require(&quot;dojo.regexp&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.require(&quot;dojo.i18n.number&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.i18n.currency.format = function (value, iso, flags, locale) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var formatData = dojo.i18n.currency._mapToLocalizedFormatData(dojo.i18n.currency.FORMAT_TABLE, iso, locale);
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = formatData.places;
+	}
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = 2;
+	}
+	flags.signed = false;
+	var result = dojo.i18n.number.format(value, flags, locale);
+	var sym = formatData.symbol;
+	if (formatData.adjSpace == &quot;symbol&quot;) {
+		if (formatData.placement == &quot;after&quot;) {
+			sym = &quot; &quot; + sym;
+		} else {
+			sym = sym + &quot; &quot;;
+		}
+	}
+	if (value &lt; 0) {
+		if (formatData.signPlacement == &quot;before&quot;) {
+			sym = &quot;-&quot; + sym;
+		} else {
+			if (formatData.signPlacement == &quot;after&quot;) {
+				sym = sym + &quot;-&quot;;
+			}
+		}
+	}
+	var spc = (formatData.adjSpace == &quot;number&quot;) ? &quot; &quot; : &quot;&quot;;
+	if (formatData.placement == &quot;after&quot;) {
+		result = result + spc + sym;
+	} else {
+		result = sym + spc + result;
+	}
+	if (value &lt; 0) {
+		if (formatData.signPlacement == &quot;around&quot;) {
+			result = &quot;(&quot; + result + &quot;)&quot;;
+		} else {
+			if (formatData.signPlacement == &quot;end&quot;) {
+				result = result + &quot;-&quot;;
+			} else {
+				if (!formatData.signPlacement || formatData.signPlacement == &quot;begin&quot;) {
+					result = &quot;-&quot; + result;
+				}
+			}
+		}
+	}
+	return result;
+};
+dojo.i18n.currency.parse = function (value, iso, locale, flags) {
+	if (typeof flags.validate == &quot;undefined&quot;) {
+		flags.validate = true;
+	}
+	if (flags.validate &amp;&amp; !dojo.i18n.number.isCurrency(value, iso, locale, flags)) {
+		return Number.NaN;
+	}
+	var sign = (value.indexOf(&quot;-&quot;) != -1);
+	var abs = abs.replace(/\-/, &quot;&quot;);
+	var formatData = dojo.i18n.currency._mapToLocalizedFormatData(dojo.i18n.currency.FORMAT_TABLE, iso, locale);
+	abs = abs.replace(new RegExp(&quot;\\&quot; + formatData.symbol), &quot;&quot;);
+	var number = dojo.i18n.number.parse(abs, locale, flags);
+	if (sign) {
+		number = number * -1;
+	}
+	return number;
+};
+dojo.i18n.currency.isCurrency = function (value, iso, locale, flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var numberFormatData = dojo.i18n.number._mapToLocalizedFormatData(dojo.i18n.number.FORMAT_TABLE, locale);
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = numberFormatData[0];
+	} else {
+		if (dojo.lang.isArray(flags.separator) &amp;&amp; flags.separator.length == 0) {
+			flags.separator = [numberFormatData[0], &quot;&quot;];
+		}
+	}
+	if (typeof flags.decimal == &quot;undefined&quot;) {
+		flags.decimal = numberFormatData[2];
+	}
+	if (typeof flags.groupSize == &quot;undefined&quot;) {
+		flags.groupSize = numberFormatData[3];
+	}
+	if (typeof flags.groupSize2 == &quot;undefined&quot;) {
+		flags.groupSize2 = numberFormatData[4];
+	}
+	var formatData = dojo.i18n.currency._mapToLocalizedFormatData(dojo.i18n.currency.FORMAT_TABLE, iso, locale);
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = formatData.places;
+	}
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = 2;
+	}
+	if (typeof flags.symbol == &quot;undefined&quot;) {
+		flags.symbol = formatData.symbol;
+	} else {
+		if (dojo.lang.isArray(flags.symbol) &amp;&amp; flags.symbol.length == 0) {
+			flags.symbol = [formatData.symbol, &quot;&quot;];
+		}
+	}
+	if (typeof flags.placement == &quot;undefined&quot;) {
+		flags.placement = formatData.placement;
+	}
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.currency(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+dojo.i18n.currency._mapToLocalizedFormatData = function (table, iso, locale) {
+	var formatData = dojo.i18n.currency.FORMAT_TABLE[iso];
+	if (!dojo.lang.isArray(formatData)) {
+		return formatData;
+	}
+	return dojo.i18n.number._mapToLocalizedFormatData(formatData[0], locale);
+};
+(function () {
+	var arabic = {symbol:&quot;\u062c&quot;, placement:&quot;after&quot;, htmlSymbol:&quot;?&quot;};
+	var euro = {symbol:&quot;\u20ac&quot;, placement:&quot;before&quot;, adjSpace:&quot;symbol&quot;, htmlSymbol:&quot;&euro;&quot;};
+	var euroAfter = {symbol:&quot;\u20ac&quot;, placement:&quot;after&quot;, htmlSymbol:&quot;&euro;&quot;};
+	dojo.i18n.currency.FORMAT_TABLE = {AED:{symbol:&quot;\u062c&quot;, placement:&quot;after&quot;}, ARS:{symbol:&quot;$&quot;, signPlacement:&quot;after&quot;}, ATS:{symbol:&quot;\u20ac&quot;, adjSpace:&quot;number&quot;, signPlacement:&quot;after&quot;, htmlSymbol:&quot;&euro;&quot;}, AUD:{symbol:&quot;$&quot;}, BOB:{symbol:&quot;$b&quot;}, BRL:{symbol:&quot;R$&quot;, adjSpace:&quot;symbol&quot;}, BEF:euroAfter, BHD:arabic, CAD:[{&quot;*&quot;:{symbol:&quot;$&quot;}, &quot;fr-ca&quot;:{symbol:&quot;$&quot;, placement:&quot;after&quot;, signPlacement:&quot;around&quot;}}], CHF:{symbol:&quot;CHF&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, CLP:{symbol:&quot;$&quot;}, COP:{symbol:&quot;$&quot;, signPlacement:&quot;around&quot;}, CNY:{symbol:&quot;\xa5&quot;, htmlSymbol:&quot;&yen;&quot;}, CRC:{symbol:&quot;\u20a1&quot;, signPlacement:&quot;after&quot;, htmlSymbol:&quot;?&quot;}, CZK:{symbol:&quot;Kc&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, DEM:euroAfter, DKK:{symbol:&quot;kr.&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, DOP:{symbol:&quot;$&quot;}, DZD:arabic, ECS:{symbol:&quot;$&quot;, signPlacement:&quot;after&quot;}, EGP:arabic, ESP:euroAfter, EUR:euro, FIM:euroAfter, FRF:euroAfter, GBP:{symbol:&quot;\xa3&quot;, htmlSymbol:&quot;&pound;&quot;}, GRD:{symbol:&quot;\u20ac&quot;, signPlacement:&quot;end&quot;, htm!
 lSymbol:&quot;&euro;&quot;}, GTQ:{symbol:&quot;Q&quot;, signPlacement:&quot;after&quot;}, HKD:{symbol:&quot;HK$&quot;}, HNL:{symbol:&quot;L.&quot;, signPlacement:&quot;end&quot;}, HUF:{symbol:&quot;Ft&quot;, placement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, IEP:{symbol:&quot;\u20ac&quot;, htmlSymbol:&quot;&euro;&quot;}, ILS:{symbol:&quot;\u05e9\&quot;\u05d7&quot;, placement:&quot;after&quot;, htmlSymbol:&quot;?&quot;}, INR:{symbol:&quot;Rs.&quot;}, ITL:{symbol:&quot;\u20ac&quot;, signPlacement:&quot;after&quot;, htmlSymbol:&quot;&euro;&quot;}, JOD:arabic, JPY:{symbol:&quot;\xa5&quot;, places:0, htmlSymbol:&quot;&yen;&quot;}, KRW:{symbol:&quot;\u20a9&quot;, places:0, htmlSymbol:&quot;?&quot;}, KWD:arabic, LBP:arabic, LUF:euroAfter, MAD:arabic, MXN:{symbol:&quot;$&quot;, signPlacement:&quot;around&quot;}, NIO:{symbol:&quot;C$&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, NLG:{symbol:&quot;\u20ac&quot;, signPlacement:&quot;end&quot;, htmlSymbol:&quot;&euro;&quot;}, NOK:{symbol:&quot;kr&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, NZD:{symbol:&quot;$&quot;}, OMR:arabic, PAB:{symbol:&quot;B/&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, PEN:{symbol:&quot;S/&quot;, signPlacement:&quot;after&quot;}, PLN:{symbol:&quot;z&quot;, placement:&quot;after&quot;}, PTE:euroAfter, PYG:{symbol:&quot;Gs.&quot;, signPlacement:&quot;aft!
 er&quot;}, QAR:arabic, RUR:{symbol:&quot;rub.&quot;, placement:&quot;after&quot;}, SAR:!
 arabic, 
SEK:{symbol:&quot;kr&quot;, placement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, SGD:{symbol:&quot;$&quot;}, SVC:{symbol:&quot;\u20a1&quot;, signPlacement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, SYP:arabic, TND:arabic, TRL:{symbol:&quot;TL&quot;, placement:&quot;after&quot;}, TWD:{symbol:&quot;NT$&quot;}, USD:{symbol:&quot;$&quot;}, UYU:{symbol:&quot;$U&quot;, signplacement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, VEB:{symbol:&quot;Bs&quot;, signplacement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, YER:arabic, ZAR:{symbol:&quot;R&quot;, signPlacement:&quot;around&quot;}};
+})();
+

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/EUR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/EUR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/EUR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;EUR&quot;, &quot;symbol&quot;:&quot;\u20ac&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/GBP.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/GBP.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/GBP.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;GBP&quot;, &quot;symbol&quot;:&quot;\xa3&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/INR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/INR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/INR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;INR&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ITL.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ITL.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ITL.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;ITL&quot;, &quot;symbol&quot;:&quot;\u20a4&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/JPY.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/JPY.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/JPY.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;JPY&quot;, &quot;symbol&quot;:&quot;\xa5&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/README
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/README	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/README	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+All files within this directory and subdirectories were manually derived from <A HREF="http://unicode.org/cldr">http://unicode.org/cldr</A>
+
+See terms of use: <A HREF="http://www.unicode.org/copyright.html#Exhibit1">http://www.unicode.org/copyright.html#Exhibit1</A>
+
+Eventually, this data should be generated directly from the XML in the CLDR repository to provide
+accurate and full support for the full set of locales.

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/USD.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/USD.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/USD.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;USD&quot;, &quot;symbol&quot;:&quot;$&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/EUR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/EUR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/EUR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;Euro&quot;, &quot;symbol&quot;:&quot;\u20ac&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/GBP.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/GBP.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/GBP.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;British Pound Sterling&quot;, &quot;symbol&quot;:&quot;\xa3&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/INR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/INR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/INR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;Indian Rupee&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/ITL.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/ITL.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/ITL.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;Italian Lira&quot;, &quot;symbol&quot;:&quot;\u20a4&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/JPY.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/JPY.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/JPY.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;Japanese Yen&quot;, &quot;symbol&quot;:&quot;\xa5&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/USD.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/USD.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en/USD.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;US Dollar&quot;, &quot;symbol&quot;:&quot;US$&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en-us/USD.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en-us/USD.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/en-us/USD.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;symbol&quot;:&quot;$&quot;, &quot;displayName&quot;:&quot;US Dollar&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/EUR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/EUR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/EUR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u092f\u0941\u0930\u094b&quot;, &quot;symbol&quot;:&quot;\u20ac&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/GBP.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/GBP.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/GBP.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u092c\u094d\u0930\u093f\u0924\u0928 \u0915\u093e \u092a\u094c\u0928\u094d\u0921 \u0938\u094d\u091f\u0930\u094d\u0932\u093f\u0917&quot;, &quot;symbol&quot;:&quot;\xa3&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/INR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/INR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/INR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u092d\u093e\u0930\u0924\u0940\u092f  \u0930\u0942\u092a\u092f\u093e&quot;, &quot;symbol&quot;:&quot;\u0930\u0941.&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/ITL.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/ITL.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/ITL.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u0907\u0924\u0932\u0940 \u0915\u093e \u0932\u0940\u0930\u093e&quot;, &quot;symbol&quot;:&quot;\u20a4&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/JPY.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/JPY.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/JPY.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u091c\u093e\u092a\u093e\u0928\u0940 \u092f\u0947\u0928&quot;, &quot;symbol&quot;:&quot;\xa5&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/USD.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/USD.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/hi/USD.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u0905\u092e\u0930\u0940\u0915\u0940 \u0921\u093e\u0932\u0930&quot;, &quot;symbol&quot;:&quot;$&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/EUR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/EUR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/EUR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u30e6\u30fc\u30ed&quot;, &quot;symbol&quot;:&quot;\u20ac&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/GBP.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/GBP.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/GBP.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u82f1\u56fd\u30dd\u30f3\u30c9&quot;, &quot;symbol&quot;:&quot;\xa3&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/INR.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/INR.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/INR.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u30a4\u30f3\u30c9 \u30eb\u30d4\u30fc&quot;, &quot;symbol&quot;:&quot;INR&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/ITL.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/ITL.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/ITL.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u30a4\u30bf\u30ea\u30a2 \u30ea\u30e9&quot;, &quot;symbol&quot;:&quot;\u20a4&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/JPY.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/JPY.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/JPY.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u65e5\u672c\u5186&quot;, &quot;symbol&quot;:&quot;\uffe5&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/USD.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/USD.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency/nls/ja/USD.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;displayName&quot;:&quot;\u7c73\u30c9\u30eb&quot;, &quot;symbol&quot;:&quot;$&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/i18n/currency.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/currency.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/currency.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,138 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.i18n.currency&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.i18n.currency&quot;);
+dojo.require(&quot;dojo.regexp&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.require(&quot;dojo.i18n.number&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.i18n.currency.format = function (value, iso, flags, locale) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var formatData = dojo.i18n.currency._mapToLocalizedFormatData(dojo.i18n.currency.FORMAT_TABLE, iso, locale);
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = formatData.places;
+	}
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = 2;
+	}
+	flags.signed = false;
+	var result = dojo.i18n.number.format(value, flags, locale);
+	var sym = formatData.symbol;
+	if (formatData.adjSpace == &quot;symbol&quot;) {
+		if (formatData.placement == &quot;after&quot;) {
+			sym = &quot; &quot; + sym;
+		} else {
+			sym = sym + &quot; &quot;;
+		}
+	}
+	if (value &lt; 0) {
+		if (formatData.signPlacement == &quot;before&quot;) {
+			sym = &quot;-&quot; + sym;
+		} else {
+			if (formatData.signPlacement == &quot;after&quot;) {
+				sym = sym + &quot;-&quot;;
+			}
+		}
+	}
+	var spc = (formatData.adjSpace == &quot;number&quot;) ? &quot; &quot; : &quot;&quot;;
+	if (formatData.placement == &quot;after&quot;) {
+		result = result + spc + sym;
+	} else {
+		result = sym + spc + result;
+	}
+	if (value &lt; 0) {
+		if (formatData.signPlacement == &quot;around&quot;) {
+			result = &quot;(&quot; + result + &quot;)&quot;;
+		} else {
+			if (formatData.signPlacement == &quot;end&quot;) {
+				result = result + &quot;-&quot;;
+			} else {
+				if (!formatData.signPlacement || formatData.signPlacement == &quot;begin&quot;) {
+					result = &quot;-&quot; + result;
+				}
+			}
+		}
+	}
+	return result;
+};
+dojo.i18n.currency.parse = function (value, iso, locale, flags) {
+	if (typeof flags.validate == &quot;undefined&quot;) {
+		flags.validate = true;
+	}
+	if (flags.validate &amp;&amp; !dojo.i18n.number.isCurrency(value, iso, locale, flags)) {
+		return Number.NaN;
+	}
+	var sign = (value.indexOf(&quot;-&quot;) != -1);
+	var abs = abs.replace(/\-/, &quot;&quot;);
+	var formatData = dojo.i18n.currency._mapToLocalizedFormatData(dojo.i18n.currency.FORMAT_TABLE, iso, locale);
+	abs = abs.replace(new RegExp(&quot;\\&quot; + formatData.symbol), &quot;&quot;);
+	var number = dojo.i18n.number.parse(abs, locale, flags);
+	if (sign) {
+		number = number * -1;
+	}
+	return number;
+};
+dojo.i18n.currency.isCurrency = function (value, iso, locale, flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var numberFormatData = dojo.i18n.number._mapToLocalizedFormatData(dojo.i18n.number.FORMAT_TABLE, locale);
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = numberFormatData[0];
+	} else {
+		if (dojo.lang.isArray(flags.separator) &amp;&amp; flags.separator.length == 0) {
+			flags.separator = [numberFormatData[0], &quot;&quot;];
+		}
+	}
+	if (typeof flags.decimal == &quot;undefined&quot;) {
+		flags.decimal = numberFormatData[2];
+	}
+	if (typeof flags.groupSize == &quot;undefined&quot;) {
+		flags.groupSize = numberFormatData[3];
+	}
+	if (typeof flags.groupSize2 == &quot;undefined&quot;) {
+		flags.groupSize2 = numberFormatData[4];
+	}
+	var formatData = dojo.i18n.currency._mapToLocalizedFormatData(dojo.i18n.currency.FORMAT_TABLE, iso, locale);
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = formatData.places;
+	}
+	if (typeof flags.places == &quot;undefined&quot;) {
+		flags.places = 2;
+	}
+	if (typeof flags.symbol == &quot;undefined&quot;) {
+		flags.symbol = formatData.symbol;
+	} else {
+		if (dojo.lang.isArray(flags.symbol) &amp;&amp; flags.symbol.length == 0) {
+			flags.symbol = [formatData.symbol, &quot;&quot;];
+		}
+	}
+	if (typeof flags.placement == &quot;undefined&quot;) {
+		flags.placement = formatData.placement;
+	}
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.currency(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+dojo.i18n.currency._mapToLocalizedFormatData = function (table, iso, locale) {
+	var formatData = dojo.i18n.currency.FORMAT_TABLE[iso];
+	if (!dojo.lang.isArray(formatData)) {
+		return formatData;
+	}
+	return dojo.i18n.number._mapToLocalizedFormatData(formatData[0], locale);
+};
+(function () {
+	var arabic = {symbol:&quot;\u062c&quot;, placement:&quot;after&quot;, htmlSymbol:&quot;?&quot;};
+	var euro = {symbol:&quot;\u20ac&quot;, placement:&quot;before&quot;, adjSpace:&quot;symbol&quot;, htmlSymbol:&quot;&euro;&quot;};
+	var euroAfter = {symbol:&quot;\u20ac&quot;, placement:&quot;after&quot;, htmlSymbol:&quot;&euro;&quot;};
+	dojo.i18n.currency.FORMAT_TABLE = {AED:{symbol:&quot;\u062c&quot;, placement:&quot;after&quot;}, ARS:{symbol:&quot;$&quot;, signPlacement:&quot;after&quot;}, ATS:{symbol:&quot;\u20ac&quot;, adjSpace:&quot;number&quot;, signPlacement:&quot;after&quot;, htmlSymbol:&quot;&euro;&quot;}, AUD:{symbol:&quot;$&quot;}, BOB:{symbol:&quot;$b&quot;}, BRL:{symbol:&quot;R$&quot;, adjSpace:&quot;symbol&quot;}, BEF:euroAfter, BHD:arabic, CAD:[{&quot;*&quot;:{symbol:&quot;$&quot;}, &quot;fr-ca&quot;:{symbol:&quot;$&quot;, placement:&quot;after&quot;, signPlacement:&quot;around&quot;}}], CHF:{symbol:&quot;CHF&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, CLP:{symbol:&quot;$&quot;}, COP:{symbol:&quot;$&quot;, signPlacement:&quot;around&quot;}, CNY:{symbol:&quot;\xa5&quot;, htmlSymbol:&quot;&yen;&quot;}, CRC:{symbol:&quot;\u20a1&quot;, signPlacement:&quot;after&quot;, htmlSymbol:&quot;?&quot;}, CZK:{symbol:&quot;Kc&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, DEM:euroAfter, DKK:{symbol:&quot;kr.&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, DOP:{symbol:&quot;$&quot;}, DZD:arabic, ECS:{symbol:&quot;$&quot;, signPlacement:&quot;after&quot;}, EGP:arabic, ESP:euroAfter, EUR:euro, FIM:euroAfter, FRF:euroAfter, GBP:{symbol:&quot;\xa3&quot;, htmlSymbol:&quot;&pound;&quot;}, GRD:{symbol:&quot;\u20ac&quot;, signPlacement:&quot;end&quot;, htm!
 lSymbol:&quot;&euro;&quot;}, GTQ:{symbol:&quot;Q&quot;, signPlacement:&quot;after&quot;}, HKD:{symbol:&quot;HK$&quot;}, HNL:{symbol:&quot;L.&quot;, signPlacement:&quot;end&quot;}, HUF:{symbol:&quot;Ft&quot;, placement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, IEP:{symbol:&quot;\u20ac&quot;, htmlSymbol:&quot;&euro;&quot;}, ILS:{symbol:&quot;\u05e9\&quot;\u05d7&quot;, placement:&quot;after&quot;, htmlSymbol:&quot;?&quot;}, INR:{symbol:&quot;Rs.&quot;}, ITL:{symbol:&quot;\u20ac&quot;, signPlacement:&quot;after&quot;, htmlSymbol:&quot;&euro;&quot;}, JOD:arabic, JPY:{symbol:&quot;\xa5&quot;, places:0, htmlSymbol:&quot;&yen;&quot;}, KRW:{symbol:&quot;\u20a9&quot;, places:0, htmlSymbol:&quot;?&quot;}, KWD:arabic, LBP:arabic, LUF:euroAfter, MAD:arabic, MXN:{symbol:&quot;$&quot;, signPlacement:&quot;around&quot;}, NIO:{symbol:&quot;C$&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, NLG:{symbol:&quot;\u20ac&quot;, signPlacement:&quot;end&quot;, htmlSymbol:&quot;&euro;&quot;}, NOK:{symbol:&quot;kr&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, NZD:{symbol:&quot;$&quot;}, OMR:arabic, PAB:{symbol:&quot;B/&quot;, adjSpace:&quot;symbol&quot;, signPlacement:&quot;after&quot;}, PEN:{symbol:&quot;S/&quot;, signPlacement:&quot;after&quot;}, PLN:{symbol:&quot;z&quot;, placement:&quot;after&quot;}, PTE:euroAfter, PYG:{symbol:&quot;Gs.&quot;, signPlacement:&quot;aft!
 er&quot;}, QAR:arabic, RUR:{symbol:&quot;rub.&quot;, placement:&quot;after&quot;}, SAR:!
 arabic, 
SEK:{symbol:&quot;kr&quot;, placement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, SGD:{symbol:&quot;$&quot;}, SVC:{symbol:&quot;\u20a1&quot;, signPlacement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, SYP:arabic, TND:arabic, TRL:{symbol:&quot;TL&quot;, placement:&quot;after&quot;}, TWD:{symbol:&quot;NT$&quot;}, USD:{symbol:&quot;$&quot;}, UYU:{symbol:&quot;$U&quot;, signplacement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, VEB:{symbol:&quot;Bs&quot;, signplacement:&quot;after&quot;, adjSpace:&quot;symbol&quot;}, YER:arabic, ZAR:{symbol:&quot;R&quot;, signPlacement:&quot;around&quot;}};
+})();
+

Added: tags/parley-0.55/root/static/magic/src/i18n/number.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/i18n/number.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/i18n/number.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,151 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.i18n.number&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.i18n.number&quot;);
+dojo.require(&quot;dojo.regexp&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.i18n.number.format = function (value, flags, locale) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var formatData = dojo.i18n.number._mapToLocalizedFormatData(dojo.i18n.number.FORMAT_TABLE, locale);
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = formatData[1];
+	}
+	if (typeof flags.decimal == &quot;undefined&quot;) {
+		flags.decimal = formatData[2];
+	}
+	if (typeof flags.groupSize == &quot;undefined&quot;) {
+		flags.groupSize = formatData[3];
+	}
+	if (typeof flags.groupSize2 == &quot;undefined&quot;) {
+		flags.groupSize2 = formatData[4];
+	}
+	if (typeof flags.round == &quot;undefined&quot;) {
+		flags.round = true;
+	}
+	if (typeof flags.signed == &quot;undefined&quot;) {
+		flags.signed = true;
+	}
+	var output = (flags.signed &amp;&amp; (value &lt; 0)) ? &quot;-&quot; : &quot;&quot;;
+	value = Math.abs(value);
+	var whole = String((((flags.places &gt; 0) || !flags.round) ? Math.floor : Math.round)(value));
+	function splitSubstrings(str, count) {
+		for (var subs = []; str.length &gt;= count; str = str.substr(0, str.length - count)) {
+			subs.push(str.substr(-count));
+		}
+		if (str.length &gt; 0) {
+			subs.push(str);
+		}
+		return subs.reverse();
+	}
+	if (flags.groupSize2 &amp;&amp; (whole.length &gt; flags.groupSize)) {
+		var groups = splitSubstrings(whole.substr(0, whole.length - flags.groupSize), flags.groupSize2);
+		groups.push(whole.substr(-flags.groupSize));
+		output = output + groups.join(flags.separator);
+	} else {
+		if (flags.groupSize) {
+			output = output + splitSubstrings(whole, flags.groupSize).join(flags.separator);
+		} else {
+			output = output + whole;
+		}
+	}
+	if (flags.places &gt; 0) {
+		var fract = value - Math.floor(value);
+		fract = (flags.round ? Math.round : Math.floor)(fract * Math.pow(10, flags.places));
+		output = output + flags.decimal + fract;
+	}
+	return output;
+};
+dojo.i18n.number.parse = function (value, locale, flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var formatData = dojo.i18n.number._mapToLocalizedFormatData(dojo.i18n.number.FORMAT_TABLE, locale);
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = formatData[1];
+	}
+	if (typeof flags.decimal == &quot;undefined&quot;) {
+		flags.decimal = formatData[2];
+	}
+	if (typeof flags.groupSize == &quot;undefined&quot;) {
+		flags.groupSize = formatData[3];
+	}
+	if (typeof flags.groupSize2 == &quot;undefined&quot;) {
+		flags.groupSize2 = formatData[4];
+	}
+	if (typeof flags.validate == &quot;undefined&quot;) {
+		flags.validate = true;
+	}
+	if (flags.validate &amp;&amp; !dojo.i18n.number.isReal(value, locale, flags)) {
+		return Number.NaN;
+	}
+	var numbers = value.split(flags.decimal);
+	if (numbers.length &gt; 2) {
+		return Number.NaN;
+	}
+	var whole = Number(numbers[0].replace(new RegExp(&quot;\\&quot; + flags.separator, &quot;g&quot;), &quot;&quot;));
+	var fract = (numbers.length == 1) ? 0 : Number(numbers[1]) / Math.pow(10, String(numbers[1]).length);
+	return whole + fract;
+};
+dojo.i18n.number.isInteger = function (value, locale, flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var formatData = dojo.i18n.number._mapToLocalizedFormatData(dojo.i18n.number.FORMAT_TABLE, locale);
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = formatData[1];
+	} else {
+		if (dojo.lang.isArray(flags.separator) &amp;&amp; flags.separator.length === 0) {
+			flags.separator = [formatData[1], &quot;&quot;];
+		}
+	}
+	if (typeof flags.groupSize == &quot;undefined&quot;) {
+		flags.groupSize = formatData[3];
+	}
+	if (typeof flags.groupSize2 == &quot;undefined&quot;) {
+		flags.groupSize2 = formatData[4];
+	}
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.integer(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+dojo.i18n.number.isReal = function (value, locale, flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var formatData = dojo.i18n.number._mapToLocalizedFormatData(dojo.i18n.number.FORMAT_TABLE, locale);
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = formatData[1];
+	} else {
+		if (dojo.lang.isArray(flags.separator) &amp;&amp; flags.separator.length === 0) {
+			flags.separator = [formatData[1], &quot;&quot;];
+		}
+	}
+	if (typeof flags.decimal == &quot;undefined&quot;) {
+		flags.decimal = formatData[2];
+	}
+	if (typeof flags.groupSize == &quot;undefined&quot;) {
+		flags.groupSize = formatData[3];
+	}
+	if (typeof flags.groupSize2 == &quot;undefined&quot;) {
+		flags.groupSize2 = formatData[4];
+	}
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.realNumber(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+(function () {
+	dojo.i18n.number.FORMAT_TABLE = {&quot;ar-ae&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-bh&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-dz&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-eg&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-jo&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-kw&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-lb&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-ma&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-om&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-qa&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-sa&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-sy&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-tn&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;ar-ye&quot;:[&quot;&quot;, &quot;&quot;, &quot;,&quot;, 1], &quot;cs-cz&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;da-dk&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;de-at&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;de-de&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;de-lu&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;de-ch&quot;:[&quot;'&quot;, &quot;'&quot;, &quot;.&quot;, 3], &quot;el-gr&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;en-au&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-ca&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-gb&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-hk&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-ie&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-in&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3, 2], &quot;en-nz&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-us&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;en-za&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-ar&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-bo&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-cl&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-co&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-cr&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3],!
  &quot;es-do&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-ec&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-es&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-gt&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-hn&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-mx&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-ni&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-pa&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-pe&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-pr&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-py&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-sv&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;es-uy&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;es-ve&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;fi-fi&quot;:[&quot; &quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;fr-be&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;fr-ca&quot;:[&quot; &quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;fr-ch&quot;:[&quot; &quot;, &quot; &quot;, &quot;.&quot;, 3], &quot;fr-fr&quot;:[&quot; &quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;fr-lu&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;he-il&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;hu-hu&quot;:[&quot; &quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;it-ch&quot;:[&quot; &quot;, &quot; &quot;, &quot;.&quot;, 3], &quot;it-it&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;ja-jp&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;ko-kr&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;no-no&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;nl-be&quot;:[&quot; &quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;nl-nl&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;pl-pl&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;pt-br&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;pt-pt&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;$&quot;, 3], &quot;ru-ru&quot;:[&quot; &quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;sv-se&quot;:[&quot;.&quot;, &quot; &quot;, &quot;,&quot;, 3], &quot;tr-tr&quot;:[&quot;.&quot;, &quot;.&quot;, &quot;,&quot;, 3], &quot;zh-cn&quot;!
 :[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;zh-hk&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3], &quot;zh-tw&quot;:[&quot;,&quot;,!
  &quot;,&quot;, &quot;.
&quot;, 3], &quot;*&quot;:[&quot;,&quot;, &quot;,&quot;, &quot;.&quot;, 3]};
+})();
+dojo.i18n.number._mapToLocalizedFormatData = function (table, locale) {
+	locale = dojo.hostenv.normalizeLocale(locale);
+	var data = table[locale];
+	if (typeof data == &quot;undefined&quot;) {
+		data = table[&quot;*&quot;];
+	}
+	return data;
+};
+

Added: tags/parley-0.55/root/static/magic/src/iCalendar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/iCalendar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/iCalendar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.cal.iCalendar&quot;);
+dojo.deprecated(&quot;dojo.icalendar&quot;, &quot;use dojo.cal.iCalendar isntead&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/io/BrowserIO.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/BrowserIO.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/BrowserIO.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,495 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.BrowserIO&quot;);
+dojo.require(&quot;dojo.io.common&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.undo.browser&quot;);
+if (!dj_undef(&quot;window&quot;)) {
+	dojo.io.checkChildrenForFile = function (node) {
+		var hasFile = false;
+		var inputs = node.getElementsByTagName(&quot;input&quot;);
+		dojo.lang.forEach(inputs, function (input) {
+			if (hasFile) {
+				return;
+			}
+			if (input.getAttribute(&quot;type&quot;) == &quot;file&quot;) {
+				hasFile = true;
+			}
+		});
+		return hasFile;
+	};
+	dojo.io.formHasFile = function (formNode) {
+		return dojo.io.checkChildrenForFile(formNode);
+	};
+	dojo.io.updateNode = function (node, urlOrArgs) {
+		node = dojo.byId(node);
+		var args = urlOrArgs;
+		if (dojo.lang.isString(urlOrArgs)) {
+			args = {url:urlOrArgs};
+		}
+		args.mimetype = &quot;text/html&quot;;
+		args.load = function (t, d, e) {
+			while (node.firstChild) {
+				dojo.dom.destroyNode(node.firstChild);
+			}
+			node.innerHTML = d;
+		};
+		dojo.io.bind(args);
+	};
+	dojo.io.formFilter = function (node) {
+		var type = (node.type || &quot;&quot;).toLowerCase();
+		return !node.disabled &amp;&amp; node.name &amp;&amp; !dojo.lang.inArray([&quot;file&quot;, &quot;submit&quot;, &quot;image&quot;, &quot;reset&quot;, &quot;button&quot;], type);
+	};
+	dojo.io.encodeForm = function (formNode, encoding, formFilter) {
+		if ((!formNode) || (!formNode.tagName) || (!formNode.tagName.toLowerCase() == &quot;form&quot;)) {
+			dojo.raise(&quot;Attempted to encode a non-form element.&quot;);
+		}
+		if (!formFilter) {
+			formFilter = dojo.io.formFilter;
+		}
+		var enc = /utf/i.test(encoding || &quot;&quot;) ? encodeURIComponent : dojo.string.encodeAscii;
+		var values = [];
+		for (var i = 0; i &lt; formNode.elements.length; i++) {
+			var elm = formNode.elements[i];
+			if (!elm || elm.tagName.toLowerCase() == &quot;fieldset&quot; || !formFilter(elm)) {
+				continue;
+			}
+			var name = enc(elm.name);
+			var type = elm.type.toLowerCase();
+			if (type == &quot;select-multiple&quot;) {
+				for (var j = 0; j &lt; elm.options.length; j++) {
+					if (elm.options[j].selected) {
+						values.push(name + &quot;=&quot; + enc(elm.options[j].value));
+					}
+				}
+			} else {
+				if (dojo.lang.inArray([&quot;radio&quot;, &quot;checkbox&quot;], type)) {
+					if (elm.checked) {
+						values.push(name + &quot;=&quot; + enc(elm.value));
+					}
+				} else {
+					values.push(name + &quot;=&quot; + enc(elm.value));
+				}
+			}
+		}
+		var inputs = formNode.getElementsByTagName(&quot;input&quot;);
+		for (var i = 0; i &lt; inputs.length; i++) {
+			var input = inputs[i];
+			if (input.type.toLowerCase() == &quot;image&quot; &amp;&amp; input.form == formNode &amp;&amp; formFilter(input)) {
+				var name = enc(input.name);
+				values.push(name + &quot;=&quot; + enc(input.value));
+				values.push(name + &quot;.x=0&quot;);
+				values.push(name + &quot;.y=0&quot;);
+			}
+		}
+		return values.join(&quot;&amp;&quot;) + &quot;&amp;&quot;;
+	};
+	dojo.io.FormBind = function (args) {
+		this.bindArgs = {};
+		if (args &amp;&amp; args.formNode) {
+			this.init(args);
+		} else {
+			if (args) {
+				this.init({formNode:args});
+			}
+		}
+	};
+	dojo.lang.extend(dojo.io.FormBind, {form:null, bindArgs:null, clickedButton:null, init:function (args) {
+		var form = dojo.byId(args.formNode);
+		if (!form || !form.tagName || form.tagName.toLowerCase() != &quot;form&quot;) {
+			throw new Error(&quot;FormBind: Couldn't apply, invalid form&quot;);
+		} else {
+			if (this.form == form) {
+				return;
+			} else {
+				if (this.form) {
+					throw new Error(&quot;FormBind: Already applied to a form&quot;);
+				}
+			}
+		}
+		dojo.lang.mixin(this.bindArgs, args);
+		this.form = form;
+		this.connect(form, &quot;onsubmit&quot;, &quot;submit&quot;);
+		for (var i = 0; i &lt; form.elements.length; i++) {
+			var node = form.elements[i];
+			if (node &amp;&amp; node.type &amp;&amp; dojo.lang.inArray([&quot;submit&quot;, &quot;button&quot;], node.type.toLowerCase())) {
+				this.connect(node, &quot;onclick&quot;, &quot;click&quot;);
+			}
+		}
+		var inputs = form.getElementsByTagName(&quot;input&quot;);
+		for (var i = 0; i &lt; inputs.length; i++) {
+			var input = inputs[i];
+			if (input.type.toLowerCase() == &quot;image&quot; &amp;&amp; input.form == form) {
+				this.connect(input, &quot;onclick&quot;, &quot;click&quot;);
+			}
+		}
+	}, onSubmit:function (form) {
+		return true;
+	}, submit:function (e) {
+		e.preventDefault();
+		if (this.onSubmit(this.form)) {
+			dojo.io.bind(dojo.lang.mixin(this.bindArgs, {formFilter:dojo.lang.hitch(this, &quot;formFilter&quot;)}));
+		}
+	}, click:function (e) {
+		var node = e.currentTarget;
+		if (node.disabled) {
+			return;
+		}
+		this.clickedButton = node;
+	}, formFilter:function (node) {
+		var type = (node.type || &quot;&quot;).toLowerCase();
+		var accept = false;
+		if (node.disabled || !node.name) {
+			accept = false;
+		} else {
+			if (dojo.lang.inArray([&quot;submit&quot;, &quot;button&quot;, &quot;image&quot;], type)) {
+				if (!this.clickedButton) {
+					this.clickedButton = node;
+				}
+				accept = node == this.clickedButton;
+			} else {
+				accept = !dojo.lang.inArray([&quot;file&quot;, &quot;submit&quot;, &quot;reset&quot;, &quot;button&quot;], type);
+			}
+		}
+		return accept;
+	}, connect:function (srcObj, srcFcn, targetFcn) {
+		if (dojo.evalObjPath(&quot;dojo.event.connect&quot;)) {
+			dojo.event.connect(srcObj, srcFcn, this, targetFcn);
+		} else {
+			var fcn = dojo.lang.hitch(this, targetFcn);
+			srcObj[srcFcn] = function (e) {
+				if (!e) {
+					e = window.event;
+				}
+				if (!e.currentTarget) {
+					e.currentTarget = e.srcElement;
+				}
+				if (!e.preventDefault) {
+					e.preventDefault = function () {
+						window.event.returnValue = false;
+					};
+				}
+				fcn(e);
+			};
+		}
+	}});
+	dojo.io.XMLHTTPTransport = new function () {
+		var _this = this;
+		var _cache = {};
+		this.useCache = false;
+		this.preventCache = false;
+		function getCacheKey(url, query, method) {
+			return url + &quot;|&quot; + query + &quot;|&quot; + method.toLowerCase();
+		}
+		function addToCache(url, query, method, http) {
+			_cache[getCacheKey(url, query, method)] = http;
+		}
+		function getFromCache(url, query, method) {
+			return _cache[getCacheKey(url, query, method)];
+		}
+		this.clearCache = function () {
+			_cache = {};
+		};
+		function doLoad(kwArgs, http, url, query, useCache) {
+			if (((http.status &gt;= 200) &amp;&amp; (http.status &lt; 300)) || (http.status == 304) || (http.status == 1223) || (location.protocol == &quot;file:&quot; &amp;&amp; (http.status == 0 || http.status == undefined)) || (location.protocol == &quot;chrome:&quot; &amp;&amp; (http.status == 0 || http.status == undefined))) {
+				var ret;
+				if (kwArgs.method.toLowerCase() == &quot;head&quot;) {
+					var headers = http.getAllResponseHeaders();
+					ret = {};
+					ret.toString = function () {
+						return headers;
+					};
+					var values = headers.split(/[\r\n]+/g);
+					for (var i = 0; i &lt; values.length; i++) {
+						var pair = values[i].match(/^([^:]+)\s*:\s*(.+)$/i);
+						if (pair) {
+							ret[pair[1]] = pair[2];
+						}
+					}
+				} else {
+					if (kwArgs.mimetype == &quot;text/javascript&quot;) {
+						try {
+							ret = dj_eval(http.responseText);
+						}
+						catch (e) {
+							dojo.debug(e);
+							dojo.debug(http.responseText);
+							ret = null;
+						}
+					} else {
+						if (kwArgs.mimetype.substr(0, 9) == &quot;text/json&quot; || kwArgs.mimetype.substr(0, 16) == &quot;application/json&quot;) {
+							try {
+								ret = dj_eval(&quot;(&quot; + kwArgs.jsonFilter(http.responseText) + &quot;)&quot;);
+							}
+							catch (e) {
+								dojo.debug(e);
+								dojo.debug(http.responseText);
+								ret = false;
+							}
+						} else {
+							if ((kwArgs.mimetype == &quot;application/xml&quot;) || (kwArgs.mimetype == &quot;text/xml&quot;)) {
+								ret = http.responseXML;
+								if (!ret || typeof ret == &quot;string&quot; || !http.getResponseHeader(&quot;Content-Type&quot;)) {
+									ret = dojo.dom.createDocumentFromText(http.responseText);
+								}
+							} else {
+								ret = http.responseText;
+							}
+						}
+					}
+				}
+				if (useCache) {
+					addToCache(url, query, kwArgs.method, http);
+				}
+				kwArgs[(typeof kwArgs.load == &quot;function&quot;) ? &quot;load&quot; : &quot;handle&quot;](&quot;load&quot;, ret, http, kwArgs);
+			} else {
+				var errObj = new dojo.io.Error(&quot;XMLHttpTransport Error: &quot; + http.status + &quot; &quot; + http.statusText);
+				kwArgs[(typeof kwArgs.error == &quot;function&quot;) ? &quot;error&quot; : &quot;handle&quot;](&quot;error&quot;, errObj, http, kwArgs);
+			}
+		}
+		function setHeaders(http, kwArgs) {
+			if (kwArgs[&quot;headers&quot;]) {
+				for (var header in kwArgs[&quot;headers&quot;]) {
+					if (header.toLowerCase() == &quot;content-type&quot; &amp;&amp; !kwArgs[&quot;contentType&quot;]) {
+						kwArgs[&quot;contentType&quot;] = kwArgs[&quot;headers&quot;][header];
+					} else {
+						http.setRequestHeader(header, kwArgs[&quot;headers&quot;][header]);
+					}
+				}
+			}
+		}
+		this.inFlight = [];
+		this.inFlightTimer = null;
+		this.startWatchingInFlight = function () {
+			if (!this.inFlightTimer) {
+				this.inFlightTimer = setTimeout(&quot;dojo.io.XMLHTTPTransport.watchInFlight();&quot;, 10);
+			}
+		};
+		this.watchInFlight = function () {
+			var now = null;
+			if (!dojo.hostenv._blockAsync &amp;&amp; !_this._blockAsync) {
+				for (var x = this.inFlight.length - 1; x &gt;= 0; x--) {
+					try {
+						var tif = this.inFlight[x];
+						if (!tif || tif.http._aborted || !tif.http.readyState) {
+							this.inFlight.splice(x, 1);
+							continue;
+						}
+						if (4 == tif.http.readyState) {
+							this.inFlight.splice(x, 1);
+							doLoad(tif.req, tif.http, tif.url, tif.query, tif.useCache);
+						} else {
+							if (tif.startTime) {
+								if (!now) {
+									now = (new Date()).getTime();
+								}
+								if (tif.startTime + (tif.req.timeoutSeconds * 1000) &lt; now) {
+									if (typeof tif.http.abort == &quot;function&quot;) {
+										tif.http.abort();
+									}
+									this.inFlight.splice(x, 1);
+									tif.req[(typeof tif.req.timeout == &quot;function&quot;) ? &quot;timeout&quot; : &quot;handle&quot;](&quot;timeout&quot;, null, tif.http, tif.req);
+								}
+							}
+						}
+					}
+					catch (e) {
+						try {
+							var errObj = new dojo.io.Error(&quot;XMLHttpTransport.watchInFlight Error: &quot; + e);
+							tif.req[(typeof tif.req.error == &quot;function&quot;) ? &quot;error&quot; : &quot;handle&quot;](&quot;error&quot;, errObj, tif.http, tif.req);
+						}
+						catch (e2) {
+							dojo.debug(&quot;XMLHttpTransport error callback failed: &quot; + e2);
+						}
+					}
+				}
+			}
+			clearTimeout(this.inFlightTimer);
+			if (this.inFlight.length == 0) {
+				this.inFlightTimer = null;
+				return;
+			}
+			this.inFlightTimer = setTimeout(&quot;dojo.io.XMLHTTPTransport.watchInFlight();&quot;, 10);
+		};
+		var hasXmlHttp = dojo.hostenv.getXmlhttpObject() ? true : false;
+		this.canHandle = function (kwArgs) {
+			var mlc = kwArgs[&quot;mimetype&quot;].toLowerCase() || &quot;&quot;;
+			return hasXmlHttp &amp;&amp; ((dojo.lang.inArray([&quot;text/plain&quot;, &quot;text/html&quot;, &quot;application/xml&quot;, &quot;text/xml&quot;, &quot;text/javascript&quot;], mlc)) || (mlc.substr(0, 9) == &quot;text/json&quot; || mlc.substr(0, 16) == &quot;application/json&quot;)) &amp;&amp; !(kwArgs[&quot;formNode&quot;] &amp;&amp; dojo.io.formHasFile(kwArgs[&quot;formNode&quot;]));
+		};
+		this.multipartBoundary = &quot;45309FFF-BD65-4d50-99C9-36986896A96F&quot;;
+		this.bind = function (kwArgs) {
+			if (!kwArgs[&quot;url&quot;]) {
+				if (!kwArgs[&quot;formNode&quot;] &amp;&amp; (kwArgs[&quot;backButton&quot;] || kwArgs[&quot;back&quot;] || kwArgs[&quot;changeUrl&quot;] || kwArgs[&quot;watchForURL&quot;]) &amp;&amp; (!djConfig.preventBackButtonFix)) {
+					dojo.deprecated(&quot;Using dojo.io.XMLHTTPTransport.bind() to add to browser history without doing an IO request&quot;, &quot;Use dojo.undo.browser.addToHistory() instead.&quot;, &quot;0.4&quot;);
+					dojo.undo.browser.addToHistory(kwArgs);
+					return true;
+				}
+			}
+			var url = kwArgs.url;
+			var query = &quot;&quot;;
+			if (kwArgs[&quot;formNode&quot;]) {
+				var ta = kwArgs.formNode.getAttribute(&quot;action&quot;);
+				if ((ta) &amp;&amp; (!kwArgs[&quot;url&quot;])) {
+					url = ta;
+				}
+				var tp = kwArgs.formNode.getAttribute(&quot;method&quot;);
+				if ((tp) &amp;&amp; (!kwArgs[&quot;method&quot;])) {
+					kwArgs.method = tp;
+				}
+				query += dojo.io.encodeForm(kwArgs.formNode, kwArgs.encoding, kwArgs[&quot;formFilter&quot;]);
+			}
+			if (url.indexOf(&quot;#&quot;) &gt; -1) {
+				dojo.debug(&quot;Warning: dojo.io.bind: stripping hash values from url:&quot;, url);
+				url = url.split(&quot;#&quot;)[0];
+			}
+			if (kwArgs[&quot;file&quot;]) {
+				kwArgs.method = &quot;post&quot;;
+			}
+			if (!kwArgs[&quot;method&quot;]) {
+				kwArgs.method = &quot;get&quot;;
+			}
+			if (kwArgs.method.toLowerCase() == &quot;get&quot;) {
+				kwArgs.multipart = false;
+			} else {
+				if (kwArgs[&quot;file&quot;]) {
+					kwArgs.multipart = true;
+				} else {
+					if (!kwArgs[&quot;multipart&quot;]) {
+						kwArgs.multipart = false;
+					}
+				}
+			}
+			if (kwArgs[&quot;backButton&quot;] || kwArgs[&quot;back&quot;] || kwArgs[&quot;changeUrl&quot;]) {
+				dojo.undo.browser.addToHistory(kwArgs);
+			}
+			var content = kwArgs[&quot;content&quot;] || {};
+			if (kwArgs.sendTransport) {
+				content[&quot;dojo.transport&quot;] = &quot;xmlhttp&quot;;
+			}
+			do {
+				if (kwArgs.postContent) {
+					query = kwArgs.postContent;
+					break;
+				}
+				if (content) {
+					query += dojo.io.argsFromMap(content, kwArgs.encoding);
+				}
+				if (kwArgs.method.toLowerCase() == &quot;get&quot; || !kwArgs.multipart) {
+					break;
+				}
+				var t = [];
+				if (query.length) {
+					var q = query.split(&quot;&amp;&quot;);
+					for (var i = 0; i &lt; q.length; ++i) {
+						if (q[i].length) {
+							var p = q[i].split(&quot;=&quot;);
+							t.push(&quot;--&quot; + this.multipartBoundary, &quot;Content-Disposition: form-data; name=\&quot;&quot; + p[0] + &quot;\&quot;&quot;, &quot;&quot;, p[1]);
+						}
+					}
+				}
+				if (kwArgs.file) {
+					if (dojo.lang.isArray(kwArgs.file)) {
+						for (var i = 0; i &lt; kwArgs.file.length; ++i) {
+							var o = kwArgs.file[i];
+							t.push(&quot;--&quot; + this.multipartBoundary, &quot;Content-Disposition: form-data; name=\&quot;&quot; + o.name + &quot;\&quot;; filename=\&quot;&quot; + (&quot;fileName&quot; in o ? o.fileName : o.name) + &quot;\&quot;&quot;, &quot;Content-Type: &quot; + (&quot;contentType&quot; in o ? o.contentType : &quot;application/octet-stream&quot;), &quot;&quot;, o.content);
+						}
+					} else {
+						var o = kwArgs.file;
+						t.push(&quot;--&quot; + this.multipartBoundary, &quot;Content-Disposition: form-data; name=\&quot;&quot; + o.name + &quot;\&quot;; filename=\&quot;&quot; + (&quot;fileName&quot; in o ? o.fileName : o.name) + &quot;\&quot;&quot;, &quot;Content-Type: &quot; + (&quot;contentType&quot; in o ? o.contentType : &quot;application/octet-stream&quot;), &quot;&quot;, o.content);
+					}
+				}
+				if (t.length) {
+					t.push(&quot;--&quot; + this.multipartBoundary + &quot;--&quot;, &quot;&quot;);
+					query = t.join(&quot;\r\n&quot;);
+				}
+			} while (false);
+			var async = kwArgs[&quot;sync&quot;] ? false : true;
+			var preventCache = kwArgs[&quot;preventCache&quot;] || (this.preventCache == true &amp;&amp; kwArgs[&quot;preventCache&quot;] != false);
+			var useCache = kwArgs[&quot;useCache&quot;] == true || (this.useCache == true &amp;&amp; kwArgs[&quot;useCache&quot;] != false);
+			if (!preventCache &amp;&amp; useCache) {
+				var cachedHttp = getFromCache(url, query, kwArgs.method);
+				if (cachedHttp) {
+					doLoad(kwArgs, cachedHttp, url, query, false);
+					return;
+				}
+			}
+			var http = dojo.hostenv.getXmlhttpObject(kwArgs);
+			var received = false;
+			if (async) {
+				var startTime = this.inFlight.push({&quot;req&quot;:kwArgs, &quot;http&quot;:http, &quot;url&quot;:url, &quot;query&quot;:query, &quot;useCache&quot;:useCache, &quot;startTime&quot;:kwArgs.timeoutSeconds ? (new Date()).getTime() : 0});
+				this.startWatchingInFlight();
+			} else {
+				_this._blockAsync = true;
+			}
+			if (kwArgs.method.toLowerCase() == &quot;post&quot;) {
+				if (!kwArgs.user) {
+					http.open(&quot;POST&quot;, url, async);
+				} else {
+					http.open(&quot;POST&quot;, url, async, kwArgs.user, kwArgs.password);
+				}
+				setHeaders(http, kwArgs);
+				http.setRequestHeader(&quot;Content-Type&quot;, kwArgs.multipart ? (&quot;multipart/form-data; boundary=&quot; + this.multipartBoundary) : (kwArgs.contentType || &quot;application/x-www-form-urlencoded&quot;));
+				try {
+					http.send(query);
+				}
+				catch (e) {
+					if (typeof http.abort == &quot;function&quot;) {
+						http.abort();
+					}
+					doLoad(kwArgs, {status:404}, url, query, useCache);
+				}
+			} else {
+				var tmpUrl = url;
+				if (query != &quot;&quot;) {
+					tmpUrl += (tmpUrl.indexOf(&quot;?&quot;) &gt; -1 ? &quot;&amp;&quot; : &quot;?&quot;) + query;
+				}
+				if (preventCache) {
+					tmpUrl += (dojo.string.endsWithAny(tmpUrl, &quot;?&quot;, &quot;&amp;&quot;) ? &quot;&quot; : (tmpUrl.indexOf(&quot;?&quot;) &gt; -1 ? &quot;&amp;&quot; : &quot;?&quot;)) + &quot;dojo.preventCache=&quot; + new Date().valueOf();
+				}
+				if (!kwArgs.user) {
+					http.open(kwArgs.method.toUpperCase(), tmpUrl, async);
+				} else {
+					http.open(kwArgs.method.toUpperCase(), tmpUrl, async, kwArgs.user, kwArgs.password);
+				}
+				setHeaders(http, kwArgs);
+				try {
+					http.send(null);
+				}
+				catch (e) {
+					if (typeof http.abort == &quot;function&quot;) {
+						http.abort();
+					}
+					doLoad(kwArgs, {status:404}, url, query, useCache);
+				}
+			}
+			if (!async) {
+				doLoad(kwArgs, http, url, query, useCache);
+				_this._blockAsync = false;
+			}
+			kwArgs.abort = function () {
+				try {
+					http._aborted = true;
+				}
+				catch (e) {
+				}
+				return http.abort();
+			};
+			return;
+		};
+		dojo.io.transports.addTransport(&quot;XMLHTTPTransport&quot;);
+	};
+}
+

Added: tags/parley-0.55/root/static/magic/src/io/IframeIO.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/IframeIO.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/IframeIO.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,214 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.IframeIO&quot;);
+dojo.require(&quot;dojo.io.BrowserIO&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.io.createIFrame = function (fname, onloadstr, uri) {
+	if (window[fname]) {
+		return window[fname];
+	}
+	if (window.frames[fname]) {
+		return window.frames[fname];
+	}
+	var r = dojo.render.html;
+	var cframe = null;
+	var turi = uri;
+	if (!turi) {
+		if (djConfig[&quot;useXDomain&quot;] &amp;&amp; !djConfig[&quot;dojoIframeHistoryUrl&quot;]) {
+			dojo.debug(&quot;dojo.io.createIFrame: When using cross-domain Dojo builds,&quot; + &quot; please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl&quot; + &quot; to the path on your domain to iframe_history.html&quot;);
+		}
+		turi = (djConfig[&quot;dojoIframeHistoryUrl&quot;] || dojo.uri.moduleUri(&quot;dojo&quot;, &quot;../iframe_history.html&quot;)) + &quot;#noInit=true&quot;;
+	}
+	var ifrstr = ((r.ie) &amp;&amp; (dojo.render.os.win)) ? &quot;&lt;iframe name=\&quot;&quot; + fname + &quot;\&quot; src=\&quot;&quot; + turi + &quot;\&quot; onload=\&quot;&quot; + onloadstr + &quot;\&quot;&gt;&quot; : &quot;iframe&quot;;
+	cframe = document.createElement(ifrstr);
+	with (cframe) {
+		name = fname;
+		setAttribute(&quot;name&quot;, fname);
+		id = fname;
+	}
+	dojo.body().appendChild(cframe);
+	window[fname] = cframe;
+	with (cframe.style) {
+		if (!r.safari) {
+			position = &quot;absolute&quot;;
+		}
+		left = top = &quot;0px&quot;;
+		height = width = &quot;1px&quot;;
+		visibility = &quot;hidden&quot;;
+	}
+	if (!r.ie) {
+		dojo.io.setIFrameSrc(cframe, turi, true);
+		cframe.onload = new Function(onloadstr);
+	}
+	return cframe;
+};
+dojo.io.IframeTransport = new function () {
+	var _this = this;
+	this.currentRequest = null;
+	this.requestQueue = [];
+	this.iframeName = &quot;dojoIoIframe&quot;;
+	this.fireNextRequest = function () {
+		try {
+			if ((this.currentRequest) || (this.requestQueue.length == 0)) {
+				return;
+			}
+			var cr = this.currentRequest = this.requestQueue.shift();
+			cr._contentToClean = [];
+			var fn = cr[&quot;formNode&quot;];
+			var content = cr[&quot;content&quot;] || {};
+			if (cr.sendTransport) {
+				content[&quot;dojo.transport&quot;] = &quot;iframe&quot;;
+			}
+			if (fn) {
+				if (content) {
+					for (var x in content) {
+						if (!fn[x]) {
+							var tn;
+							if (dojo.render.html.ie) {
+								tn = document.createElement(&quot;&lt;input type='hidden' name='&quot; + x + &quot;' value='&quot; + content[x] + &quot;'&gt;&quot;);
+								fn.appendChild(tn);
+							} else {
+								tn = document.createElement(&quot;input&quot;);
+								fn.appendChild(tn);
+								tn.type = &quot;hidden&quot;;
+								tn.name = x;
+								tn.value = content[x];
+							}
+							cr._contentToClean.push(x);
+						} else {
+							fn[x].value = content[x];
+						}
+					}
+				}
+				if (cr[&quot;url&quot;]) {
+					cr._originalAction = fn.getAttribute(&quot;action&quot;);
+					fn.setAttribute(&quot;action&quot;, cr.url);
+				}
+				if (!fn.getAttribute(&quot;method&quot;)) {
+					fn.setAttribute(&quot;method&quot;, (cr[&quot;method&quot;]) ? cr[&quot;method&quot;] : &quot;post&quot;);
+				}
+				cr._originalTarget = fn.getAttribute(&quot;target&quot;);
+				fn.setAttribute(&quot;target&quot;, this.iframeName);
+				fn.target = this.iframeName;
+				fn.submit();
+			} else {
+				var query = dojo.io.argsFromMap(this.currentRequest.content);
+				var tmpUrl = cr.url + (cr.url.indexOf(&quot;?&quot;) &gt; -1 ? &quot;&amp;&quot; : &quot;?&quot;) + query;
+				dojo.io.setIFrameSrc(this.iframe, tmpUrl, true);
+			}
+		}
+		catch (e) {
+			this.iframeOnload(e);
+		}
+	};
+	this.canHandle = function (kwArgs) {
+		return ((dojo.lang.inArray([&quot;text/plain&quot;, &quot;text/html&quot;, &quot;text/javascript&quot;, &quot;text/json&quot;, &quot;application/json&quot;], kwArgs[&quot;mimetype&quot;])) &amp;&amp; (dojo.lang.inArray([&quot;post&quot;, &quot;get&quot;], kwArgs[&quot;method&quot;].toLowerCase())) &amp;&amp; (!((kwArgs[&quot;sync&quot;]) &amp;&amp; (kwArgs[&quot;sync&quot;] == true))));
+	};
+	this.bind = function (kwArgs) {
+		if (!this[&quot;iframe&quot;]) {
+			this.setUpIframe();
+		}
+		this.requestQueue.push(kwArgs);
+		this.fireNextRequest();
+		return;
+	};
+	this.setUpIframe = function () {
+		this.iframe = dojo.io.createIFrame(this.iframeName, &quot;dojo.io.IframeTransport.iframeOnload();&quot;);
+	};
+	this.iframeOnload = function (errorObject) {
+		if (!_this.currentRequest) {
+			_this.fireNextRequest();
+			return;
+		}
+		var req = _this.currentRequest;
+		if (req.formNode) {
+			var toClean = req._contentToClean;
+			for (var i = 0; i &lt; toClean.length; i++) {
+				var key = toClean[i];
+				if (dojo.render.html.safari) {
+					var fNode = req.formNode;
+					for (var j = 0; j &lt; fNode.childNodes.length; j++) {
+						var chNode = fNode.childNodes[j];
+						if (chNode.name == key) {
+							var pNode = chNode.parentNode;
+							pNode.removeChild(chNode);
+							break;
+						}
+					}
+				} else {
+					var input = req.formNode[key];
+					req.formNode.removeChild(input);
+					req.formNode[key] = null;
+				}
+			}
+			if (req[&quot;_originalAction&quot;]) {
+				req.formNode.setAttribute(&quot;action&quot;, req._originalAction);
+			}
+			if (req[&quot;_originalTarget&quot;]) {
+				req.formNode.setAttribute(&quot;target&quot;, req._originalTarget);
+				req.formNode.target = req._originalTarget;
+			}
+		}
+		var contentDoc = function (iframe_el) {
+			var doc = iframe_el.contentDocument || ((iframe_el.contentWindow) &amp;&amp; (iframe_el.contentWindow.document)) || ((iframe_el.name) &amp;&amp; (document.frames[iframe_el.name]) &amp;&amp; (document.frames[iframe_el.name].document)) || null;
+			return doc;
+		};
+		var value;
+		var success = false;
+		if (errorObject) {
+			this._callError(req, &quot;IframeTransport Request Error: &quot; + errorObject);
+		} else {
+			var ifd = contentDoc(_this.iframe);
+			try {
+				var cmt = req.mimetype;
+				if ((cmt == &quot;text/javascript&quot;) || (cmt == &quot;text/json&quot;) || (cmt == &quot;application/json&quot;)) {
+					var js = ifd.getElementsByTagName(&quot;textarea&quot;)[0].value;
+					if (cmt == &quot;text/json&quot; || cmt == &quot;application/json&quot;) {
+						js = &quot;(&quot; + js + &quot;)&quot;;
+					}
+					value = dj_eval(js);
+				} else {
+					if (cmt == &quot;text/html&quot;) {
+						value = ifd;
+					} else {
+						value = ifd.getElementsByTagName(&quot;textarea&quot;)[0].value;
+					}
+				}
+				success = true;
+			}
+			catch (e) {
+				this._callError(req, &quot;IframeTransport Error: &quot; + e);
+			}
+		}
+		try {
+			if (success &amp;&amp; dojo.lang.isFunction(req[&quot;load&quot;])) {
+				req.load(&quot;load&quot;, value, req);
+			}
+		}
+		catch (e) {
+			throw e;
+		}
+		finally {
+			_this.currentRequest = null;
+			_this.fireNextRequest();
+		}
+	};
+	this._callError = function (req, message) {
+		var errObj = new dojo.io.Error(message);
+		if (dojo.lang.isFunction(req[&quot;error&quot;])) {
+			req.error(&quot;error&quot;, errObj, req);
+		}
+	};
+	dojo.io.transports.addTransport(&quot;IframeTransport&quot;);
+};
+

Added: tags/parley-0.55/root/static/magic/src/io/RepubsubIO.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/RepubsubIO.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/RepubsubIO.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,337 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.BrowserIO&quot;);
+dojo.provide(&quot;dojo.io.RepubsubIO&quot;);
+dojo.io.repubsubTranport = new function () {
+	var rps = dojo.io.repubsub;
+	this.canHandle = function (kwArgs) {
+		if ((kwArgs[&quot;mimetype&quot;] == &quot;text/javascript&quot;) &amp;&amp; (kwArgs[&quot;method&quot;] == &quot;repubsub&quot;)) {
+			return true;
+		}
+		return false;
+	};
+	this.bind = function (kwArgs) {
+		if (!rps.isInitialized) {
+			rps.init();
+		}
+		if (!rps.topics[kwArgs.url]) {
+			kwArgs.rpsLoad = function (evt) {
+				kwArgs.load(&quot;load&quot;, evt);
+			};
+			rps.subscribe(kwArgs.url, kwArgs, &quot;rpsLoad&quot;);
+		}
+		if (kwArgs[&quot;content&quot;]) {
+			var cEvt = dojo.io.repubsubEvent.initFromProperties(kwArgs.content);
+			rps.publish(kwArgs.url, cEvt);
+		}
+	};
+	dojo.io.transports.addTransport(&quot;repubsubTranport&quot;);
+};
+dojo.io.repubsub = new function () {
+	this.initDoc = &quot;init.html&quot;;
+	this.isInitialized = false;
+	this.subscriptionBacklog = [];
+	this.debug = true;
+	this.rcvNodeName = null;
+	this.sndNodeName = null;
+	this.rcvNode = null;
+	this.sndNode = null;
+	this.canRcv = false;
+	this.canSnd = false;
+	this.canLog = false;
+	this.sndTimer = null;
+	this.windowRef = window;
+	this.backlog = [];
+	this.tunnelInitCount = 0;
+	this.tunnelFrameKey = &quot;tunnel_frame&quot;;
+	this.serverBaseURL = location.protocol + &quot;//&quot; + location.host + location.pathname;
+	this.logBacklog = [];
+	this.getRandStr = function () {
+		return Math.random().toString().substring(2, 10);
+	};
+	this.userid = &quot;guest&quot;;
+	this.tunnelID = this.getRandStr();
+	this.attachPathList = [];
+	this.topics = [];
+	this.parseGetStr = function () {
+		var baseUrl = document.location.toString();
+		var params = baseUrl.split(&quot;?&quot;, 2);
+		if (params.length &gt; 1) {
+			var paramStr = params[1];
+			var pairs = paramStr.split(&quot;&amp;&quot;);
+			var opts = [];
+			for (var x in pairs) {
+				var sp = pairs[x].split(&quot;=&quot;);
+				try {
+					opts[sp[0]] = eval(sp[1]);
+				}
+				catch (e) {
+					opts[sp[0]] = sp[1];
+				}
+			}
+			return opts;
+		} else {
+			return [];
+		}
+	};
+	var getOpts = this.parseGetStr();
+	for (var x in getOpts) {
+		this[x] = getOpts[x];
+	}
+	if (!this[&quot;tunnelURI&quot;]) {
+		this.tunnelURI = [&quot;/who/&quot;, escape(this.userid), &quot;/s/&quot;, this.getRandStr(), &quot;/kn_journal&quot;].join(&quot;&quot;);
+	}
+	if (window[&quot;repubsubOpts&quot;] || window[&quot;rpsOpts&quot;]) {
+		var optObj = window[&quot;repubsubOpts&quot;] || window[&quot;rpsOpts&quot;];
+		for (var x in optObj) {
+			this[x] = optObj[x];
+		}
+	}
+	this.tunnelCloseCallback = function () {
+		dojo.io.setIFrameSrc(this.rcvNode, this.initDoc + &quot;?callback=repubsub.rcvNodeReady&amp;domain=&quot; + document.domain);
+	};
+	this.receiveEventFromTunnel = function (evt, srcWindow) {
+		if (!evt[&quot;elements&quot;]) {
+			this.log(&quot;bailing! event received without elements!&quot;, &quot;error&quot;);
+			return;
+		}
+		var e = {};
+		for (var i = 0; i &lt; evt.elements.length; i++) {
+			var ee = evt.elements[i];
+			e[ee.name || ee.nameU] = (ee.value || ee.valueU);
+			this.log(&quot;[event]: &quot; + (ee.name || ee.nameU) + &quot;: &quot; + e[ee.name || ee.nameU]);
+		}
+		this.dispatch(e);
+	};
+	this.widenDomain = function (domainStr) {
+		var cd = domainStr || document.domain;
+		if (cd.indexOf(&quot;.&quot;) == -1) {
+			return;
+		}
+		var dps = cd.split(&quot;.&quot;);
+		if (dps.length &lt;= 2) {
+			return;
+		}
+		dps = dps.slice(dps.length - 2);
+		document.domain = dps.join(&quot;.&quot;);
+	};
+	this.parseCookie = function () {
+		var cs = document.cookie;
+		var keypairs = cs.split(&quot;;&quot;);
+		for (var x = 0; x &lt; keypairs.length; x++) {
+			keypairs[x] = keypairs[x].split(&quot;=&quot;);
+			if (x != keypairs.length - 1) {
+				cs += &quot;;&quot;;
+			}
+		}
+		return keypairs;
+	};
+	this.setCookie = function (keypairs, clobber) {
+		if ((clobber) &amp;&amp; (clobber == true)) {
+			document.cookie = &quot;&quot;;
+		}
+		var cs = &quot;&quot;;
+		for (var x = 0; x &lt; keypairs.length; x++) {
+			cs += keypairs[x][0] + &quot;=&quot; + keypairs[x][1];
+			if (x != keypairs.length - 1) {
+				cs += &quot;;&quot;;
+			}
+		}
+		document.cookie = cs;
+	};
+	this.log = function (str, lvl) {
+		if (!this.debug) {
+			return;
+		}
+		while (this.logBacklog.length &gt; 0) {
+			if (!this.canLog) {
+				break;
+			}
+			var blo = this.logBacklog.shift();
+			this.writeLog(&quot;[&quot; + blo[0] + &quot;]: &quot; + blo[1], blo[2]);
+		}
+		this.writeLog(str, lvl);
+	};
+	this.writeLog = function (str, lvl) {
+		dojo.debug(((new Date()).toLocaleTimeString()) + &quot;: &quot; + str);
+	};
+	this.init = function () {
+		this.widenDomain();
+		this.openTunnel();
+		this.isInitialized = true;
+		while (this.subscriptionBacklog.length) {
+			this.subscribe.apply(this, this.subscriptionBacklog.shift());
+		}
+	};
+	this.clobber = function () {
+		if (this.rcvNode) {
+			this.setCookie([[this.tunnelFrameKey, &quot;closed&quot;], [&quot;path&quot;, &quot;/&quot;]], false);
+		}
+	};
+	this.openTunnel = function () {
+		this.rcvNodeName = &quot;rcvIFrame_&quot; + this.getRandStr();
+		this.setCookie([[this.tunnelFrameKey, this.rcvNodeName], [&quot;path&quot;, &quot;/&quot;]], false);
+		this.rcvNode = dojo.io.createIFrame(this.rcvNodeName);
+		dojo.io.setIFrameSrc(this.rcvNode, this.initDoc + &quot;?callback=repubsub.rcvNodeReady&amp;domain=&quot; + document.domain);
+		this.sndNodeName = &quot;sndIFrame_&quot; + this.getRandStr();
+		this.sndNode = dojo.io.createIFrame(this.sndNodeName);
+		dojo.io.setIFrameSrc(this.sndNode, this.initDoc + &quot;?callback=repubsub.sndNodeReady&amp;domain=&quot; + document.domain);
+	};
+	this.rcvNodeReady = function () {
+		var statusURI = [this.tunnelURI, &quot;/kn_status/&quot;, this.getRandStr(), &quot;_&quot;, String(this.tunnelInitCount++)].join(&quot;&quot;);
+		this.log(&quot;rcvNodeReady&quot;);
+		var initURIArr = [this.serverBaseURL, &quot;/kn?kn_from=&quot;, escape(this.tunnelURI), &quot;&amp;kn_id=&quot;, escape(this.tunnelID), &quot;&amp;kn_status_from=&quot;, escape(statusURI)];
+		dojo.io.setIFrameSrc(this.rcvNode, initURIArr.join(&quot;&quot;));
+		this.subscribe(statusURI, this, &quot;statusListener&quot;, true);
+		this.log(initURIArr.join(&quot;&quot;));
+	};
+	this.sndNodeReady = function () {
+		this.canSnd = true;
+		this.log(&quot;sndNodeReady&quot;);
+		this.log(this.backlog.length);
+		if (this.backlog.length &gt; 0) {
+			this.dequeueEvent();
+		}
+	};
+	this.statusListener = function (evt) {
+		this.log(&quot;status listener called&quot;);
+		this.log(evt.status, &quot;info&quot;);
+	};
+	this.dispatch = function (evt) {
+		if (evt[&quot;to&quot;] || evt[&quot;kn_routed_from&quot;]) {
+			var rf = evt[&quot;to&quot;] || evt[&quot;kn_routed_from&quot;];
+			var topic = rf.split(this.serverBaseURL, 2)[1];
+			if (!topic) {
+				topic = rf;
+			}
+			this.log(&quot;[topic] &quot; + topic);
+			if (topic.length &gt; 3) {
+				if (topic.slice(0, 3) == &quot;/kn&quot;) {
+					topic = topic.slice(3);
+				}
+			}
+			if (this.attachPathList[topic]) {
+				this.attachPathList[topic](evt);
+			}
+		}
+	};
+	this.subscribe = function (topic, toObj, toFunc, dontTellServer) {
+		if (!this.isInitialized) {
+			this.subscriptionBacklog.push([topic, toObj, toFunc, dontTellServer]);
+			return;
+		}
+		if (!this.attachPathList[topic]) {
+			this.attachPathList[topic] = function () {
+				return true;
+			};
+			this.log(&quot;subscribing to: &quot; + topic);
+			this.topics.push(topic);
+		}
+		var revt = new dojo.io.repubsubEvent(this.tunnelURI, topic, &quot;route&quot;);
+		var rstr = [this.serverBaseURL + &quot;/kn&quot;, revt.toGetString()].join(&quot;&quot;);
+		dojo.event.kwConnect({once:true, srcObj:this.attachPathList, srcFunc:topic, adviceObj:toObj, adviceFunc:toFunc});
+		if (!this.rcvNode) {
+		}
+		if (dontTellServer) {
+			return;
+		}
+		this.log(&quot;sending subscription to: &quot; + topic);
+		this.sendTopicSubToServer(topic, rstr);
+	};
+	this.sendTopicSubToServer = function (topic, str) {
+		if (!this.attachPathList[topic][&quot;subscriptions&quot;]) {
+			this.enqueueEventStr(str);
+			this.attachPathList[topic].subscriptions = 0;
+		}
+		this.attachPathList[topic].subscriptions++;
+	};
+	this.unSubscribe = function (topic, toObj, toFunc) {
+		dojo.event.kwDisconnect({srcObj:this.attachPathList, srcFunc:topic, adviceObj:toObj, adviceFunc:toFunc});
+	};
+	this.publish = function (topic, event) {
+		var evt = dojo.io.repubsubEvent.initFromProperties(event);
+		evt.to = topic;
+		var evtURLParts = [];
+		evtURLParts.push(this.serverBaseURL + &quot;/kn&quot;);
+		evtURLParts.push(evt.toGetString());
+		this.enqueueEventStr(evtURLParts.join(&quot;&quot;));
+	};
+	this.enqueueEventStr = function (evtStr) {
+		this.log(&quot;enqueueEventStr&quot;);
+		this.backlog.push(evtStr);
+		this.dequeueEvent();
+	};
+	this.dequeueEvent = function (force) {
+		this.log(&quot;dequeueEvent&quot;);
+		if (this.backlog.length &lt;= 0) {
+			return;
+		}
+		if ((this.canSnd) || (force)) {
+			dojo.io.setIFrameSrc(this.sndNode, this.backlog.shift() + &quot;&amp;callback=repubsub.sndNodeReady&quot;);
+			this.canSnd = false;
+		} else {
+			this.log(&quot;sndNode not available yet!&quot;, &quot;debug&quot;);
+		}
+	};
+};
+dojo.io.repubsubEvent = function (to, from, method, id, routeURI, payload, dispname, uid) {
+	this.to = to;
+	this.from = from;
+	this.method = method || &quot;route&quot;;
+	this.id = id || repubsub.getRandStr();
+	this.uri = routeURI;
+	this.displayname = dispname || repubsub.displayname;
+	this.userid = uid || repubsub.userid;
+	this.payload = payload || &quot;&quot;;
+	this.flushChars = 4096;
+	this.initFromProperties = function (evt) {
+		if (evt.constructor = dojo.io.repubsubEvent) {
+			for (var x in evt) {
+				this[x] = evt[x];
+			}
+		} else {
+			for (var x in evt) {
+				if (typeof this.forwardPropertiesMap[x] == &quot;string&quot;) {
+					this[this.forwardPropertiesMap[x]] = evt[x];
+				} else {
+					this[x] = evt[x];
+				}
+			}
+		}
+	};
+	this.toGetString = function (noQmark) {
+		var qs = [((noQmark) ? &quot;&quot; : &quot;?&quot;)];
+		for (var x = 0; x &lt; this.properties.length; x++) {
+			var tp = this.properties[x];
+			if (this[tp[0]]) {
+				qs.push(tp[1] + &quot;=&quot; + encodeURIComponent(String(this[tp[0]])));
+			}
+		}
+		return qs.join(&quot;&amp;&quot;);
+	};
+};
+dojo.io.repubsubEvent.prototype.properties = [[&quot;from&quot;, &quot;kn_from&quot;], [&quot;to&quot;, &quot;kn_to&quot;], [&quot;method&quot;, &quot;do_method&quot;], [&quot;id&quot;, &quot;kn_id&quot;], [&quot;uri&quot;, &quot;kn_uri&quot;], [&quot;displayname&quot;, &quot;kn_displayname&quot;], [&quot;userid&quot;, &quot;kn_userid&quot;], [&quot;payload&quot;, &quot;kn_payload&quot;], [&quot;flushChars&quot;, &quot;kn_response_flush&quot;], [&quot;responseFormat&quot;, &quot;kn_response_format&quot;]];
+dojo.io.repubsubEvent.prototype.forwardPropertiesMap = {};
+dojo.io.repubsubEvent.prototype.reversePropertiesMap = {};
+for (var x = 0; x &lt; dojo.io.repubsubEvent.prototype.properties.length; x++) {
+	var tp = dojo.io.repubsubEvent.prototype.properties[x];
+	dojo.io.repubsubEvent.prototype.reversePropertiesMap[tp[0]] = tp[1];
+	dojo.io.repubsubEvent.prototype.forwardPropertiesMap[tp[1]] = tp[0];
+}
+dojo.io.repubsubEvent.initFromProperties = function (evt) {
+	var eventObj = new dojo.io.repubsubEvent();
+	eventObj.initFromProperties(evt);
+	return eventObj;
+};
+

Added: tags/parley-0.55/root/static/magic/src/io/RhinoIO.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/RhinoIO.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/RhinoIO.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,116 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.RhinoIO&quot;);
+dojo.require(&quot;dojo.io.common&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.io.RhinoHTTPTransport = new function () {
+	this.canHandle = function (req) {
+		if (dojo.lang.find([&quot;text/plain&quot;, &quot;text/html&quot;, &quot;text/xml&quot;, &quot;text/javascript&quot;, &quot;text/json&quot;, &quot;application/json&quot;], (req.mimetype.toLowerCase() || &quot;&quot;)) &lt; 0) {
+			return false;
+		}
+		if (req.url.substr(0, 7) != &quot;<A HREF="http://">http://</A>&quot;) {
+			return false;
+		}
+		return true;
+	};
+	function doLoad(req, conn) {
+		var ret;
+		if (req.method.toLowerCase() == &quot;head&quot;) {
+		} else {
+			var stream = conn.getContent();
+			var reader = new java.io.BufferedReader(new java.io.InputStreamReader(stream));
+			var text = &quot;&quot;;
+			var line = null;
+			while ((line = reader.readLine()) != null) {
+				text += line;
+			}
+			if (req.mimetype == &quot;text/javascript&quot;) {
+				try {
+					ret = dj_eval(text);
+				}
+				catch (e) {
+					dojo.debug(e);
+					dojo.debug(text);
+					ret = null;
+				}
+			} else {
+				if (req.mimetype == &quot;text/json&quot; || req.mimetype == &quot;application/json&quot;) {
+					try {
+						ret = dj_eval(&quot;(&quot; + text + &quot;)&quot;);
+					}
+					catch (e) {
+						dojo.debug(e);
+						dojo.debug(text);
+						ret = false;
+					}
+				} else {
+					ret = text;
+				}
+			}
+		}
+		req.load(&quot;load&quot;, ret, req);
+	}
+	function connect(req) {
+		var content = req.content || {};
+		var query;
+		if (req.sendTransport) {
+			content[&quot;dojo.transport&quot;] = &quot;rhinohttp&quot;;
+		}
+		if (req.postContent) {
+			query = req.postContent;
+		} else {
+			query = dojo.io.argsFromMap(content, req.encoding);
+		}
+		var url_text = req.url;
+		if (req.method.toLowerCase() == &quot;get&quot; &amp;&amp; query != &quot;&quot;) {
+			url_text = url_text + &quot;?&quot; + query;
+		}
+		var url = new java.net.URL(url_text);
+		var conn = url.openConnection();
+		conn.setRequestMethod(req.method.toUpperCase());
+		if (req.headers) {
+			for (var header in req.headers) {
+				if (header.toLowerCase() == &quot;content-type&quot; &amp;&amp; !req.contentType) {
+					req.contentType = req.headers[header];
+				} else {
+					conn.setRequestProperty(header, req.headers[header]);
+				}
+			}
+		}
+		if (req.contentType) {
+			conn.setRequestProperty(&quot;Content-Type&quot;, req.contentType);
+		}
+		if (req.method.toLowerCase() == &quot;post&quot;) {
+			conn.setDoOutput(true);
+			var output_stream = conn.getOutputStream();
+			var byte_array = (new java.lang.String(query)).getBytes();
+			output_stream.write(byte_array, 0, byte_array.length);
+		}
+		conn.connect();
+		doLoad(req, conn);
+	}
+	this.bind = function (req) {
+		var async = req[&quot;sync&quot;] ? false : true;
+		if (async) {
+			setTimeout(dojo.lang.hitch(this, function () {
+				connect(req);
+			}), 1);
+		} else {
+			connect(req);
+		}
+	};
+	dojo.io.transports.addTransport(&quot;RhinoHTTPTransport&quot;);
+};
+

Added: tags/parley-0.55/root/static/magic/src/io/ScriptSrcIO.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/ScriptSrcIO.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/ScriptSrcIO.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,317 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.ScriptSrcIO&quot;);
+dojo.require(&quot;dojo.io.BrowserIO&quot;);
+dojo.require(&quot;dojo.undo.browser&quot;);
+dojo.io.ScriptSrcTransport = new function () {
+	this.preventCache = false;
+	this.maxUrlLength = 1000;
+	this.inFlightTimer = null;
+	this.DsrStatusCodes = {Continue:100, Ok:200, Error:500};
+	this.startWatchingInFlight = function () {
+		if (!this.inFlightTimer) {
+			this.inFlightTimer = setInterval(&quot;dojo.io.ScriptSrcTransport.watchInFlight();&quot;, 100);
+		}
+	};
+	this.watchInFlight = function () {
+		var totalCount = 0;
+		var doneCount = 0;
+		for (var param in this._state) {
+			totalCount++;
+			var currentState = this._state[param];
+			if (currentState.isDone) {
+				doneCount++;
+				delete this._state[param];
+			} else {
+				if (!currentState.isFinishing) {
+					var listener = currentState.kwArgs;
+					try {
+						if (currentState.checkString &amp;&amp; eval(&quot;typeof(&quot; + currentState.checkString + &quot;) != 'undefined'&quot;)) {
+							currentState.isFinishing = true;
+							this._finish(currentState, &quot;load&quot;);
+							doneCount++;
+							delete this._state[param];
+						} else {
+							if (listener.timeoutSeconds &amp;&amp; listener.timeout) {
+								if (currentState.startTime + (listener.timeoutSeconds * 1000) &lt; (new Date()).getTime()) {
+									currentState.isFinishing = true;
+									this._finish(currentState, &quot;timeout&quot;);
+									doneCount++;
+									delete this._state[param];
+								}
+							} else {
+								if (!listener.timeoutSeconds) {
+									doneCount++;
+								}
+							}
+						}
+					}
+					catch (e) {
+						currentState.isFinishing = true;
+						this._finish(currentState, &quot;error&quot;, {status:this.DsrStatusCodes.Error, response:e});
+					}
+				}
+			}
+		}
+		if (doneCount &gt;= totalCount) {
+			clearInterval(this.inFlightTimer);
+			this.inFlightTimer = null;
+		}
+	};
+	this.canHandle = function (kwArgs) {
+		return dojo.lang.inArray([&quot;text/javascript&quot;, &quot;text/json&quot;, &quot;application/json&quot;], (kwArgs[&quot;mimetype&quot;].toLowerCase())) &amp;&amp; (kwArgs[&quot;method&quot;].toLowerCase() == &quot;get&quot;) &amp;&amp; !(kwArgs[&quot;formNode&quot;] &amp;&amp; dojo.io.formHasFile(kwArgs[&quot;formNode&quot;])) &amp;&amp; (!kwArgs[&quot;sync&quot;] || kwArgs[&quot;sync&quot;] == false) &amp;&amp; !kwArgs[&quot;file&quot;] &amp;&amp; !kwArgs[&quot;multipart&quot;];
+	};
+	this.removeScripts = function () {
+		var scripts = document.getElementsByTagName(&quot;script&quot;);
+		for (var i = 0; scripts &amp;&amp; i &lt; scripts.length; i++) {
+			var scriptTag = scripts[i];
+			if (scriptTag.className == &quot;ScriptSrcTransport&quot;) {
+				var parent = scriptTag.parentNode;
+				parent.removeChild(scriptTag);
+				i--;
+			}
+		}
+	};
+	this.bind = function (kwArgs) {
+		var url = kwArgs.url;
+		var query = &quot;&quot;;
+		if (kwArgs[&quot;formNode&quot;]) {
+			var ta = kwArgs.formNode.getAttribute(&quot;action&quot;);
+			if ((ta) &amp;&amp; (!kwArgs[&quot;url&quot;])) {
+				url = ta;
+			}
+			var tp = kwArgs.formNode.getAttribute(&quot;method&quot;);
+			if ((tp) &amp;&amp; (!kwArgs[&quot;method&quot;])) {
+				kwArgs.method = tp;
+			}
+			query += dojo.io.encodeForm(kwArgs.formNode, kwArgs.encoding, kwArgs[&quot;formFilter&quot;]);
+		}
+		if (url.indexOf(&quot;#&quot;) &gt; -1) {
+			dojo.debug(&quot;Warning: dojo.io.bind: stripping hash values from url:&quot;, url);
+			url = url.split(&quot;#&quot;)[0];
+		}
+		var urlParts = url.split(&quot;?&quot;);
+		if (urlParts &amp;&amp; urlParts.length == 2) {
+			url = urlParts[0];
+			query += (query ? &quot;&amp;&quot; : &quot;&quot;) + urlParts[1];
+		}
+		if (kwArgs[&quot;backButton&quot;] || kwArgs[&quot;back&quot;] || kwArgs[&quot;changeUrl&quot;]) {
+			dojo.undo.browser.addToHistory(kwArgs);
+		}
+		var id = kwArgs[&quot;apiId&quot;] ? kwArgs[&quot;apiId&quot;] : &quot;id&quot; + this._counter++;
+		var content = kwArgs[&quot;content&quot;];
+		var jsonpName = kwArgs.jsonParamName;
+		if (kwArgs.sendTransport || jsonpName) {
+			if (!content) {
+				content = {};
+			}
+			if (kwArgs.sendTransport) {
+				content[&quot;dojo.transport&quot;] = &quot;scriptsrc&quot;;
+			}
+			if (jsonpName) {
+				content[jsonpName] = &quot;dojo.io.ScriptSrcTransport._state.&quot; + id + &quot;.jsonpCall&quot;;
+			}
+		}
+		if (kwArgs.postContent) {
+			query = kwArgs.postContent;
+		} else {
+			if (content) {
+				query += ((query) ? &quot;&amp;&quot; : &quot;&quot;) + dojo.io.argsFromMap(content, kwArgs.encoding, jsonpName);
+			}
+		}
+		if (kwArgs[&quot;apiId&quot;]) {
+			kwArgs[&quot;useRequestId&quot;] = true;
+		}
+		var state = {&quot;id&quot;:id, &quot;idParam&quot;:&quot;_dsrid=&quot; + id, &quot;url&quot;:url, &quot;query&quot;:query, &quot;kwArgs&quot;:kwArgs, &quot;startTime&quot;:(new Date()).getTime(), &quot;isFinishing&quot;:false};
+		if (!url) {
+			this._finish(state, &quot;error&quot;, {status:this.DsrStatusCodes.Error, statusText:&quot;url.none&quot;});
+			return;
+		}
+		if (content &amp;&amp; content[jsonpName]) {
+			state.jsonp = content[jsonpName];
+			state.jsonpCall = function (data) {
+				if (data[&quot;Error&quot;] || data[&quot;error&quot;]) {
+					if (dojo[&quot;json&quot;] &amp;&amp; dojo[&quot;json&quot;][&quot;serialize&quot;]) {
+						dojo.debug(dojo.json.serialize(data));
+					}
+					dojo.io.ScriptSrcTransport._finish(this, &quot;error&quot;, data);
+				} else {
+					dojo.io.ScriptSrcTransport._finish(this, &quot;load&quot;, data);
+				}
+			};
+		}
+		if (kwArgs[&quot;useRequestId&quot;] || kwArgs[&quot;checkString&quot;] || state[&quot;jsonp&quot;]) {
+			this._state[id] = state;
+		}
+		if (kwArgs[&quot;checkString&quot;]) {
+			state.checkString = kwArgs[&quot;checkString&quot;];
+		}
+		state.constantParams = (kwArgs[&quot;constantParams&quot;] == null ? &quot;&quot; : kwArgs[&quot;constantParams&quot;]);
+		if (kwArgs[&quot;preventCache&quot;] || (this.preventCache == true &amp;&amp; kwArgs[&quot;preventCache&quot;] != false)) {
+			state.nocacheParam = &quot;dojo.preventCache=&quot; + new Date().valueOf();
+		} else {
+			state.nocacheParam = &quot;&quot;;
+		}
+		var urlLength = state.url.length + state.query.length + state.constantParams.length + state.nocacheParam.length + this._extraPaddingLength;
+		if (kwArgs[&quot;useRequestId&quot;]) {
+			urlLength += state.idParam.length;
+		}
+		if (!kwArgs[&quot;checkString&quot;] &amp;&amp; kwArgs[&quot;useRequestId&quot;] &amp;&amp; !state[&quot;jsonp&quot;] &amp;&amp; !kwArgs[&quot;forceSingleRequest&quot;] &amp;&amp; urlLength &gt; this.maxUrlLength) {
+			if (url &gt; this.maxUrlLength) {
+				this._finish(state, &quot;error&quot;, {status:this.DsrStatusCodes.Error, statusText:&quot;url.tooBig&quot;});
+				return;
+			} else {
+				this._multiAttach(state, 1);
+			}
+		} else {
+			var queryParams = [state.constantParams, state.nocacheParam, state.query];
+			if (kwArgs[&quot;useRequestId&quot;] &amp;&amp; !state[&quot;jsonp&quot;]) {
+				queryParams.unshift(state.idParam);
+			}
+			var finalUrl = this._buildUrl(state.url, queryParams);
+			state.finalUrl = finalUrl;
+			this._attach(state.id, finalUrl);
+		}
+		this.startWatchingInFlight();
+	};
+	this._counter = 1;
+	this._state = {};
+	this._extraPaddingLength = 16;
+	this._buildUrl = function (url, nameValueArray) {
+		var finalUrl = url;
+		var joiner = &quot;?&quot;;
+		for (var i = 0; i &lt; nameValueArray.length; i++) {
+			if (nameValueArray[i]) {
+				finalUrl += joiner + nameValueArray[i];
+				joiner = &quot;&amp;&quot;;
+			}
+		}
+		return finalUrl;
+	};
+	this._attach = function (id, url) {
+		var element = document.createElement(&quot;script&quot;);
+		element.type = &quot;text/javascript&quot;;
+		element.src = url;
+		element.id = id;
+		element.className = &quot;ScriptSrcTransport&quot;;
+		document.getElementsByTagName(&quot;head&quot;)[0].appendChild(element);
+	};
+	this._multiAttach = function (state, part) {
+		if (state.query == null) {
+			this._finish(state, &quot;error&quot;, {status:this.DsrStatusCodes.Error, statusText:&quot;query.null&quot;});
+			return;
+		}
+		if (!state.constantParams) {
+			state.constantParams = &quot;&quot;;
+		}
+		var queryMax = this.maxUrlLength - state.idParam.length - state.constantParams.length - state.url.length - state.nocacheParam.length - this._extraPaddingLength;
+		var isDone = state.query.length &lt; queryMax;
+		var currentQuery;
+		if (isDone) {
+			currentQuery = state.query;
+			state.query = null;
+		} else {
+			var ampEnd = state.query.lastIndexOf(&quot;&amp;&quot;, queryMax - 1);
+			var eqEnd = state.query.lastIndexOf(&quot;=&quot;, queryMax - 1);
+			if (ampEnd &gt; eqEnd || eqEnd == queryMax - 1) {
+				currentQuery = state.query.substring(0, ampEnd);
+				state.query = state.query.substring(ampEnd + 1, state.query.length);
+			} else {
+				currentQuery = state.query.substring(0, queryMax);
+				var queryName = currentQuery.substring((ampEnd == -1 ? 0 : ampEnd + 1), eqEnd);
+				state.query = queryName + &quot;=&quot; + state.query.substring(queryMax, state.query.length);
+			}
+		}
+		var queryParams = [currentQuery, state.idParam, state.constantParams, state.nocacheParam];
+		if (!isDone) {
+			queryParams.push(&quot;_part=&quot; + part);
+		}
+		var url = this._buildUrl(state.url, queryParams);
+		this._attach(state.id + &quot;_&quot; + part, url);
+	};
+	this._finish = function (state, callback, event) {
+		if (callback != &quot;partOk&quot; &amp;&amp; !state.kwArgs[callback] &amp;&amp; !state.kwArgs[&quot;handle&quot;]) {
+			if (callback == &quot;error&quot;) {
+				state.isDone = true;
+				throw event;
+			}
+		} else {
+			switch (callback) {
+			  case &quot;load&quot;:
+				var response = event ? event.response : null;
+				if (!response) {
+					response = event;
+				}
+				state.kwArgs[(typeof state.kwArgs.load == &quot;function&quot;) ? &quot;load&quot; : &quot;handle&quot;](&quot;load&quot;, response, event, state.kwArgs);
+				state.isDone = true;
+				break;
+			  case &quot;partOk&quot;:
+				var part = parseInt(event.response.part, 10) + 1;
+				if (event.response.constantParams) {
+					state.constantParams = event.response.constantParams;
+				}
+				this._multiAttach(state, part);
+				state.isDone = false;
+				break;
+			  case &quot;error&quot;:
+				state.kwArgs[(typeof state.kwArgs.error == &quot;function&quot;) ? &quot;error&quot; : &quot;handle&quot;](&quot;error&quot;, event.response, event, state.kwArgs);
+				state.isDone = true;
+				break;
+			  default:
+				state.kwArgs[(typeof state.kwArgs[callback] == &quot;function&quot;) ? callback : &quot;handle&quot;](callback, event, event, state.kwArgs);
+				state.isDone = true;
+			}
+		}
+	};
+	dojo.io.transports.addTransport(&quot;ScriptSrcTransport&quot;);
+};
+window.onscriptload = function (event) {
+	var state = null;
+	var transport = dojo.io.ScriptSrcTransport;
+	if (transport._state[event.id]) {
+		state = transport._state[event.id];
+	} else {
+		var tempState;
+		for (var param in transport._state) {
+			tempState = transport._state[param];
+			if (tempState.finalUrl &amp;&amp; tempState.finalUrl == event.id) {
+				state = tempState;
+				break;
+			}
+		}
+		if (state == null) {
+			var scripts = document.getElementsByTagName(&quot;script&quot;);
+			for (var i = 0; scripts &amp;&amp; i &lt; scripts.length; i++) {
+				var scriptTag = scripts[i];
+				if (scriptTag.getAttribute(&quot;class&quot;) == &quot;ScriptSrcTransport&quot; &amp;&amp; scriptTag.src == event.id) {
+					state = transport._state[scriptTag.id];
+					break;
+				}
+			}
+		}
+		if (state == null) {
+			throw &quot;No matching state for onscriptload event.id: &quot; + event.id;
+		}
+	}
+	var callbackName = &quot;error&quot;;
+	switch (event.status) {
+	  case dojo.io.ScriptSrcTransport.DsrStatusCodes.Continue:
+		callbackName = &quot;partOk&quot;;
+		break;
+	  case dojo.io.ScriptSrcTransport.DsrStatusCodes.Ok:
+		callbackName = &quot;load&quot;;
+		break;
+	}
+	transport._finish(state, callbackName, event);
+};
+

Added: tags/parley-0.55/root/static/magic/src/io/XhrIframeProxy.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/XhrIframeProxy.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/XhrIframeProxy.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,152 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.XhrIframeProxy&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.io.XhrIframeProxy&quot;);
+dojo.require(&quot;dojo.io.IframeIO&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.io.XhrIframeProxy = {xipClientUrl:djConfig[&quot;xipClientUrl&quot;] || dojo.uri.moduleUri(&quot;dojo.io&quot;, &quot;xip_client.html&quot;), _state:{}, _stateIdCounter:0, needFrameRecursion:function () {
+	return (true == dojo.render.html.ie70);
+}, send:function (facade) {
+	var stateId = &quot;XhrIframeProxy&quot; + (this._stateIdCounter++);
+	facade._stateId = stateId;
+	var frameUrl = this.xipClientUrl + &quot;#0:init:id=&quot; + stateId + &quot;&amp;server=&quot; + encodeURIComponent(facade._ifpServerUrl) + &quot;&amp;fr=false&quot;;
+	if (this.needFrameRecursion()) {
+		var fullClientUrl = window.location.href;
+		if ((this.xipClientUrl + &quot;&quot;).charAt(0) == &quot;/&quot;) {
+			var endIndex = fullClientUrl.indexOf(&quot;://&quot;);
+			endIndex = fullClientUrl.indexOf(&quot;/&quot;, endIndex + 1);
+			fullClientUrl = fullClientUrl.substring(0, endIndex);
+		} else {
+			fullClientUrl = fullClientUrl.substring(0, fullClientUrl.lastIndexOf(&quot;/&quot;) + 1);
+		}
+		fullClientUrl += this.xipClientUrl;
+		var serverUrl = facade._ifpServerUrl + (facade._ifpServerUrl.indexOf(&quot;?&quot;) == -1 ? &quot;?&quot; : &quot;&amp;&quot;) + &quot;dojo.fr=1&quot;;
+		frameUrl = serverUrl + &quot;#0:init:id=&quot; + stateId + &quot;&amp;client=&quot; + encodeURIComponent(fullClientUrl) + &quot;&amp;fr=&quot; + this.needFrameRecursion();
+	}
+	this._state[stateId] = {facade:facade, stateId:stateId, clientFrame:dojo.io.createIFrame(stateId, &quot;&quot;, frameUrl)};
+	return stateId;
+}, receive:function (stateId, urlEncodedData) {
+	var response = {};
+	var nvPairs = urlEncodedData.split(&quot;&amp;&quot;);
+	for (var i = 0; i &lt; nvPairs.length; i++) {
+		if (nvPairs[i]) {
+			var nameValue = nvPairs[i].split(&quot;=&quot;);
+			response[decodeURIComponent(nameValue[0])] = decodeURIComponent(nameValue[1]);
+		}
+	}
+	var state = this._state[stateId];
+	var facade = state.facade;
+	facade._setResponseHeaders(response.responseHeaders);
+	if (response.status == 0 || response.status) {
+		facade.status = parseInt(response.status, 10);
+	}
+	if (response.statusText) {
+		facade.statusText = response.statusText;
+	}
+	if (response.responseText) {
+		facade.responseText = response.responseText;
+		var contentType = facade.getResponseHeader(&quot;Content-Type&quot;);
+		if (contentType &amp;&amp; (contentType == &quot;application/xml&quot; || contentType == &quot;text/xml&quot;)) {
+			facade.responseXML = dojo.dom.createDocumentFromText(response.responseText, contentType);
+		}
+	}
+	facade.readyState = 4;
+	this.destroyState(stateId);
+}, clientFrameLoaded:function (stateId) {
+	var state = this._state[stateId];
+	var facade = state.facade;
+	if (this.needFrameRecursion()) {
+		var clientWindow = window.open(&quot;&quot;, state.stateId + &quot;_clientEndPoint&quot;);
+	} else {
+		var clientWindow = state.clientFrame.contentWindow;
+	}
+	var reqHeaders = [];
+	for (var param in facade._requestHeaders) {
+		reqHeaders.push(param + &quot;: &quot; + facade._requestHeaders[param]);
+	}
+	var requestData = {uri:facade._uri};
+	if (reqHeaders.length &gt; 0) {
+		requestData.requestHeaders = reqHeaders.join(&quot;\r\n&quot;);
+	}
+	if (facade._method) {
+		requestData.method = facade._method;
+	}
+	if (facade._bodyData) {
+		requestData.data = facade._bodyData;
+	}
+	clientWindow.send(dojo.io.argsFromMap(requestData, &quot;utf8&quot;));
+}, destroyState:function (stateId) {
+	var state = this._state[stateId];
+	if (state) {
+		delete this._state[stateId];
+		var parentNode = state.clientFrame.parentNode;
+		parentNode.removeChild(state.clientFrame);
+		state.clientFrame = null;
+		state = null;
+	}
+}, createFacade:function () {
+	if (arguments &amp;&amp; arguments[0] &amp;&amp; arguments[0][&quot;iframeProxyUrl&quot;]) {
+		return new dojo.io.XhrIframeFacade(arguments[0][&quot;iframeProxyUrl&quot;]);
+	} else {
+		return dojo.io.XhrIframeProxy.oldGetXmlhttpObject.apply(dojo.hostenv, arguments);
+	}
+}};
+dojo.io.XhrIframeProxy.oldGetXmlhttpObject = dojo.hostenv.getXmlhttpObject;
+dojo.hostenv.getXmlhttpObject = dojo.io.XhrIframeProxy.createFacade;
+dojo.io.XhrIframeFacade = function (ifpServerUrl) {
+	this._requestHeaders = {};
+	this._allResponseHeaders = null;
+	this._responseHeaders = {};
+	this._method = null;
+	this._uri = null;
+	this._bodyData = null;
+	this.responseText = null;
+	this.responseXML = null;
+	this.status = null;
+	this.statusText = null;
+	this.readyState = 0;
+	this._ifpServerUrl = ifpServerUrl;
+	this._stateId = null;
+};
+dojo.lang.extend(dojo.io.XhrIframeFacade, {open:function (method, uri) {
+	this._method = method;
+	this._uri = uri;
+	this.readyState = 1;
+}, setRequestHeader:function (header, value) {
+	this._requestHeaders[header] = value;
+}, send:function (stringData) {
+	this._bodyData = stringData;
+	this._stateId = dojo.io.XhrIframeProxy.send(this);
+	this.readyState = 2;
+}, abort:function () {
+	dojo.io.XhrIframeProxy.destroyState(this._stateId);
+}, getAllResponseHeaders:function () {
+	return this._allResponseHeaders;
+}, getResponseHeader:function (header) {
+	return this._responseHeaders[header];
+}, _setResponseHeaders:function (allHeaders) {
+	if (allHeaders) {
+		this._allResponseHeaders = allHeaders;
+		allHeaders = allHeaders.replace(/\r/g, &quot;&quot;);
+		var nvPairs = allHeaders.split(&quot;\n&quot;);
+		for (var i = 0; i &lt; nvPairs.length; i++) {
+			if (nvPairs[i]) {
+				var nameValue = nvPairs[i].split(&quot;: &quot;);
+				this._responseHeaders[nameValue[0]] = nameValue[1];
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/io/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.io.common&quot;], rhino:[&quot;dojo.io.RhinoIO&quot;], browser:[&quot;dojo.io.BrowserIO&quot;, &quot;dojo.io.cookie&quot;], dashboard:[&quot;dojo.io.BrowserIO&quot;, &quot;dojo.io.cookie&quot;]});
+dojo.provide(&quot;dojo.io.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/io/cometd.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/cometd.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/cometd.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,530 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.io.common&quot;);
+dojo.provide(&quot;dojo.io.cometd&quot;);
+dojo.require(&quot;dojo.AdapterRegistry&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.BrowserIO&quot;);
+dojo.require(&quot;dojo.io.IframeIO&quot;);
+dojo.require(&quot;dojo.io.ScriptSrcIO&quot;);
+dojo.require(&quot;dojo.io.cookie&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+cometd = new function () {
+	this.initialized = false;
+	this.connected = false;
+	this.connectionTypes = new dojo.AdapterRegistry(true);
+	this.version = 0.1;
+	this.minimumVersion = 0.1;
+	this.clientId = null;
+	this._isXD = false;
+	this.handshakeReturn = null;
+	this.currentTransport = null;
+	this.url = null;
+	this.lastMessage = null;
+	this.globalTopicChannels = {};
+	this.backlog = [];
+	this.tunnelInit = function (childLocation, childDomain) {
+	};
+	this.tunnelCollapse = function () {
+		dojo.debug(&quot;tunnel collapsed!&quot;);
+	};
+	this.init = function (props, root, bargs) {
+		props = props || {};
+		props.version = this.version;
+		props.minimumVersion = this.minimumVersion;
+		props.channel = &quot;/meta/handshake&quot;;
+		this.url = root || djConfig[&quot;cometdRoot&quot;];
+		if (!this.url) {
+			dojo.debug(&quot;no cometd root specified in djConfig and no root passed&quot;);
+			return;
+		}
+		var bindArgs = {url:this.url, method:&quot;POST&quot;, mimetype:&quot;text/json&quot;, load:dojo.lang.hitch(this, &quot;finishInit&quot;), content:{&quot;message&quot;:dojo.json.serialize([props])}};
+		var regexp = &quot;^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$&quot;;
+		var r = (&quot;&quot; + window.location).match(new RegExp(regexp));
+		if (r[4]) {
+			var tmp = r[4].split(&quot;:&quot;);
+			var thisHost = tmp[0];
+			var thisPort = tmp[1] || &quot;80&quot;;
+			r = this.url.match(new RegExp(regexp));
+			if (r[4]) {
+				tmp = r[4].split(&quot;:&quot;);
+				var urlHost = tmp[0];
+				var urlPort = tmp[1] || &quot;80&quot;;
+				if ((urlHost != thisHost) || (urlPort != thisPort)) {
+					dojo.debug(thisHost, urlHost);
+					dojo.debug(thisPort, urlPort);
+					this._isXD = true;
+					bindArgs.transport = &quot;ScriptSrcTransport&quot;;
+					bindArgs.jsonParamName = &quot;jsonp&quot;;
+					bindArgs.method = &quot;GET&quot;;
+				}
+			}
+		}
+		if (bargs) {
+			dojo.lang.mixin(bindArgs, bargs);
+		}
+		return dojo.io.bind(bindArgs);
+	};
+	this.finishInit = function (type, data, evt, request) {
+		data = data[0];
+		this.handshakeReturn = data;
+		if (data[&quot;authSuccessful&quot;] == false) {
+			dojo.debug(&quot;cometd authentication failed&quot;);
+			return;
+		}
+		if (data.version &lt; this.minimumVersion) {
+			dojo.debug(&quot;cometd protocol version mismatch. We wanted&quot;, this.minimumVersion, &quot;but got&quot;, data.version);
+			return;
+		}
+		this.currentTransport = this.connectionTypes.match(data.supportedConnectionTypes, data.version, this._isXD);
+		this.currentTransport.version = data.version;
+		this.clientId = data.clientId;
+		this.tunnelInit = dojo.lang.hitch(this.currentTransport, &quot;tunnelInit&quot;);
+		this.tunnelCollapse = dojo.lang.hitch(this.currentTransport, &quot;tunnelCollapse&quot;);
+		this.initialized = true;
+		this.currentTransport.startup(data);
+		while (this.backlog.length != 0) {
+			var cur = this.backlog.shift();
+			var fn = cur.shift();
+			this[fn].apply(this, cur);
+		}
+	};
+	this._getRandStr = function () {
+		return Math.random().toString().substring(2, 10);
+	};
+	this.deliver = function (messages) {
+		dojo.lang.forEach(messages, this._deliver, this);
+	};
+	this._deliver = function (message) {
+		if (!message[&quot;channel&quot;]) {
+			dojo.debug(&quot;cometd error: no channel for message!&quot;);
+			return;
+		}
+		if (!this.currentTransport) {
+			this.backlog.push([&quot;deliver&quot;, message]);
+			return;
+		}
+		this.lastMessage = message;
+		if ((message.channel.length &gt; 5) &amp;&amp; (message.channel.substr(0, 5) == &quot;/meta&quot;)) {
+			switch (message.channel) {
+			  case &quot;/meta/subscribe&quot;:
+				if (!message.successful) {
+					dojo.debug(&quot;cometd subscription error for channel&quot;, message.channel, &quot;:&quot;, message.error);
+					return;
+				}
+				this.subscribed(message.subscription, message);
+				break;
+			  case &quot;/meta/unsubscribe&quot;:
+				if (!message.successful) {
+					dojo.debug(&quot;cometd unsubscription error for channel&quot;, message.channel, &quot;:&quot;, message.error);
+					return;
+				}
+				this.unsubscribed(message.subscription, message);
+				break;
+			}
+		}
+		this.currentTransport.deliver(message);
+		if (message.data) {
+			var tname = (this.globalTopicChannels[message.channel]) ? message.channel : &quot;/cometd&quot; + message.channel;
+			dojo.event.topic.publish(tname, message);
+		}
+	};
+	this.disconnect = function () {
+		if (!this.currentTransport) {
+			dojo.debug(&quot;no current transport to disconnect from&quot;);
+			return;
+		}
+		this.currentTransport.disconnect();
+	};
+	this.publish = function (channel, data, properties) {
+		if (!this.currentTransport) {
+			this.backlog.push([&quot;publish&quot;, channel, data, properties]);
+			return;
+		}
+		var message = {data:data, channel:channel};
+		if (properties) {
+			dojo.lang.mixin(message, properties);
+		}
+		return this.currentTransport.sendMessage(message);
+	};
+	this.subscribe = function (channel, useLocalTopics, objOrFunc, funcName) {
+		if (!this.currentTransport) {
+			this.backlog.push([&quot;subscribe&quot;, channel, useLocalTopics, objOrFunc, funcName]);
+			return;
+		}
+		if (objOrFunc) {
+			var tname = (useLocalTopics) ? channel : &quot;/cometd&quot; + channel;
+			if (useLocalTopics) {
+				this.globalTopicChannels[channel] = true;
+			}
+			dojo.event.topic.subscribe(tname, objOrFunc, funcName);
+		}
+		return this.currentTransport.sendMessage({channel:&quot;/meta/subscribe&quot;, subscription:channel});
+	};
+	this.subscribed = function (channel, message) {
+		dojo.debug(channel);
+		dojo.debugShallow(message);
+	};
+	this.unsubscribe = function (channel, useLocalTopics, objOrFunc, funcName) {
+		if (!this.currentTransport) {
+			this.backlog.push([&quot;unsubscribe&quot;, channel, useLocalTopics, objOrFunc, funcName]);
+			return;
+		}
+		if (objOrFunc) {
+			var tname = (useLocalTopics) ? channel : &quot;/cometd&quot; + channel;
+			dojo.event.topic.unsubscribe(tname, objOrFunc, funcName);
+		}
+		return this.currentTransport.sendMessage({channel:&quot;/meta/unsubscribe&quot;, subscription:channel});
+	};
+	this.unsubscribed = function (channel, message) {
+		dojo.debug(channel);
+		dojo.debugShallow(message);
+	};
+};
+cometd.iframeTransport = new function () {
+	this.connected = false;
+	this.connectionId = null;
+	this.rcvNode = null;
+	this.rcvNodeName = &quot;&quot;;
+	this.phonyForm = null;
+	this.authToken = null;
+	this.lastTimestamp = null;
+	this.lastId = null;
+	this.backlog = [];
+	this.check = function (types, version, xdomain) {
+		return ((!xdomain) &amp;&amp; (!dojo.render.html.safari) &amp;&amp; (dojo.lang.inArray(types, &quot;iframe&quot;)));
+	};
+	this.tunnelInit = function () {
+		this.postToIframe({message:dojo.json.serialize([{channel:&quot;/meta/connect&quot;, clientId:cometd.clientId, connectionType:&quot;iframe&quot;}])});
+	};
+	this.tunnelCollapse = function () {
+		if (this.connected) {
+			this.connected = false;
+			this.postToIframe({message:dojo.json.serialize([{channel:&quot;/meta/reconnect&quot;, clientId:cometd.clientId, connectionId:this.connectionId, timestamp:this.lastTimestamp, id:this.lastId}])});
+		}
+	};
+	this.deliver = function (message) {
+		if (message[&quot;timestamp&quot;]) {
+			this.lastTimestamp = message.timestamp;
+		}
+		if (message[&quot;id&quot;]) {
+			this.lastId = message.id;
+		}
+		if ((message.channel.length &gt; 5) &amp;&amp; (message.channel.substr(0, 5) == &quot;/meta&quot;)) {
+			switch (message.channel) {
+			  case &quot;/meta/connect&quot;:
+				if (!message.successful) {
+					dojo.debug(&quot;cometd connection error:&quot;, message.error);
+					return;
+				}
+				this.connectionId = message.connectionId;
+				this.connected = true;
+				this.processBacklog();
+				break;
+			  case &quot;/meta/reconnect&quot;:
+				if (!message.successful) {
+					dojo.debug(&quot;cometd reconnection error:&quot;, message.error);
+					return;
+				}
+				this.connected = true;
+				break;
+			  case &quot;/meta/subscribe&quot;:
+				if (!message.successful) {
+					dojo.debug(&quot;cometd subscription error for channel&quot;, message.channel, &quot;:&quot;, message.error);
+					return;
+				}
+				dojo.debug(message.channel);
+				break;
+			}
+		}
+	};
+	this.widenDomain = function (domainStr) {
+		var cd = domainStr || document.domain;
+		if (cd.indexOf(&quot;.&quot;) == -1) {
+			return;
+		}
+		var dps = cd.split(&quot;.&quot;);
+		if (dps.length &lt;= 2) {
+			return;
+		}
+		dps = dps.slice(dps.length - 2);
+		document.domain = dps.join(&quot;.&quot;);
+		return document.domain;
+	};
+	this.postToIframe = function (content, url) {
+		if (!this.phonyForm) {
+			if (dojo.render.html.ie) {
+				this.phonyForm = document.createElement(&quot;&lt;form enctype='application/x-www-form-urlencoded' method='POST' style='display: none;'&gt;&quot;);
+				dojo.body().appendChild(this.phonyForm);
+			} else {
+				this.phonyForm = document.createElement(&quot;form&quot;);
+				this.phonyForm.style.display = &quot;none&quot;;
+				dojo.body().appendChild(this.phonyForm);
+				this.phonyForm.enctype = &quot;application/x-www-form-urlencoded&quot;;
+				this.phonyForm.method = &quot;POST&quot;;
+			}
+		}
+		this.phonyForm.action = url || cometd.url;
+		this.phonyForm.target = this.rcvNodeName;
+		this.phonyForm.setAttribute(&quot;target&quot;, this.rcvNodeName);
+		while (this.phonyForm.firstChild) {
+			this.phonyForm.removeChild(this.phonyForm.firstChild);
+		}
+		for (var x in content) {
+			var tn;
+			if (dojo.render.html.ie) {
+				tn = document.createElement(&quot;&lt;input type='hidden' name='&quot; + x + &quot;' value='&quot; + content[x] + &quot;'&gt;&quot;);
+				this.phonyForm.appendChild(tn);
+			} else {
+				tn = document.createElement(&quot;input&quot;);
+				this.phonyForm.appendChild(tn);
+				tn.type = &quot;hidden&quot;;
+				tn.name = x;
+				tn.value = content[x];
+			}
+		}
+		this.phonyForm.submit();
+	};
+	this.processBacklog = function () {
+		while (this.backlog.length &gt; 0) {
+			this.sendMessage(this.backlog.shift(), true);
+		}
+	};
+	this.sendMessage = function (message, bypassBacklog) {
+		if ((bypassBacklog) || (this.connected)) {
+			message.connectionId = this.connectionId;
+			message.clientId = cometd.clientId;
+			var bindArgs = {url:cometd.url || djConfig[&quot;cometdRoot&quot;], method:&quot;POST&quot;, mimetype:&quot;text/json&quot;, content:{message:dojo.json.serialize([message])}};
+			return dojo.io.bind(bindArgs);
+		} else {
+			this.backlog.push(message);
+		}
+	};
+	this.startup = function (handshakeData) {
+		dojo.debug(&quot;startup!&quot;);
+		dojo.debug(dojo.json.serialize(handshakeData));
+		if (this.connected) {
+			return;
+		}
+		this.rcvNodeName = &quot;cometdRcv_&quot; + cometd._getRandStr();
+		var initUrl = cometd.url + &quot;/?tunnelInit=iframe&quot;;
+		if (false &amp;&amp; dojo.render.html.ie) {
+			this.rcvNode = new ActiveXObject(&quot;htmlfile&quot;);
+			this.rcvNode.open();
+			this.rcvNode.write(&quot;&lt;html&gt;&quot;);
+			this.rcvNode.write(&quot;&lt;script&gt;document.domain = '&quot; + document.domain + &quot;'&quot;);
+			this.rcvNode.write(&quot;&lt;/html&gt;&quot;);
+			this.rcvNode.close();
+			var ifrDiv = this.rcvNode.createElement(&quot;div&quot;);
+			this.rcvNode.appendChild(ifrDiv);
+			this.rcvNode.parentWindow.dojo = dojo;
+			ifrDiv.innerHTML = &quot;&lt;iframe src='&quot; + initUrl + &quot;'&gt;&lt;/iframe&gt;&quot;;
+		} else {
+			this.rcvNode = dojo.io.createIFrame(this.rcvNodeName, &quot;&quot;, initUrl);
+		}
+	};
+};
+cometd.mimeReplaceTransport = new function () {
+	this.connected = false;
+	this.connectionId = null;
+	this.xhr = null;
+	this.authToken = null;
+	this.lastTimestamp = null;
+	this.lastId = null;
+	this.backlog = [];
+	this.check = function (types, version, xdomain) {
+		return ((!xdomain) &amp;&amp; (dojo.render.html.mozilla) &amp;&amp; (dojo.lang.inArray(types, &quot;mime-message-block&quot;)));
+	};
+	this.tunnelInit = function () {
+		if (this.connected) {
+			return;
+		}
+		this.openTunnelWith({message:dojo.json.serialize([{channel:&quot;/meta/connect&quot;, clientId:cometd.clientId, connectionType:&quot;mime-message-block&quot;}])});
+		this.connected = true;
+	};
+	this.tunnelCollapse = function () {
+		if (this.connected) {
+			this.connected = false;
+			this.openTunnelWith({message:dojo.json.serialize([{channel:&quot;/meta/reconnect&quot;, clientId:cometd.clientId, connectionId:this.connectionId, timestamp:this.lastTimestamp, id:this.lastId}])});
+		}
+	};
+	this.deliver = cometd.iframeTransport.deliver;
+	this.handleOnLoad = function (resp) {
+		cometd.deliver(dojo.json.evalJson(this.xhr.responseText));
+	};
+	this.openTunnelWith = function (content, url) {
+		this.xhr = dojo.hostenv.getXmlhttpObject();
+		this.xhr.multipart = true;
+		if (dojo.render.html.mozilla) {
+			this.xhr.addEventListener(&quot;load&quot;, dojo.lang.hitch(this, &quot;handleOnLoad&quot;), false);
+		} else {
+			if (dojo.render.html.safari) {
+				dojo.debug(&quot;Webkit is broken with multipart responses over XHR = (&quot;);
+				this.xhr.onreadystatechange = dojo.lang.hitch(this, &quot;handleOnLoad&quot;);
+			} else {
+				this.xhr.onload = dojo.lang.hitch(this, &quot;handleOnLoad&quot;);
+			}
+		}
+		this.xhr.open(&quot;POST&quot;, (url || cometd.url), true);
+		this.xhr.setRequestHeader(&quot;Content-Type&quot;, &quot;application/x-www-form-urlencoded&quot;);
+		dojo.debug(dojo.json.serialize(content));
+		this.xhr.send(dojo.io.argsFromMap(content, &quot;utf8&quot;));
+	};
+	this.processBacklog = function () {
+		while (this.backlog.length &gt; 0) {
+			this.sendMessage(this.backlog.shift(), true);
+		}
+	};
+	this.sendMessage = function (message, bypassBacklog) {
+		if ((bypassBacklog) || (this.connected)) {
+			message.connectionId = this.connectionId;
+			message.clientId = cometd.clientId;
+			var bindArgs = {url:cometd.url || djConfig[&quot;cometdRoot&quot;], method:&quot;POST&quot;, mimetype:&quot;text/json&quot;, content:{message:dojo.json.serialize([message])}};
+			return dojo.io.bind(bindArgs);
+		} else {
+			this.backlog.push(message);
+		}
+	};
+	this.startup = function (handshakeData) {
+		dojo.debugShallow(handshakeData);
+		if (this.connected) {
+			return;
+		}
+		this.tunnelInit();
+	};
+};
+cometd.longPollTransport = new function () {
+	this.connected = false;
+	this.connectionId = null;
+	this.authToken = null;
+	this.lastTimestamp = null;
+	this.lastId = null;
+	this.backlog = [];
+	this.check = function (types, version, xdomain) {
+		return ((!xdomain) &amp;&amp; (dojo.lang.inArray(types, &quot;long-polling&quot;)));
+	};
+	this.tunnelInit = function () {
+		if (this.connected) {
+			return;
+		}
+		this.openTunnelWith({message:dojo.json.serialize([{channel:&quot;/meta/connect&quot;, clientId:cometd.clientId, connectionType:&quot;long-polling&quot;}])});
+		this.connected = true;
+	};
+	this.tunnelCollapse = function () {
+		if (!this.connected) {
+			this.connected = false;
+			dojo.debug(&quot;clientId:&quot;, cometd.clientId);
+			this.openTunnelWith({message:dojo.json.serialize([{channel:&quot;/meta/reconnect&quot;, connectionType:&quot;long-polling&quot;, clientId:cometd.clientId, connectionId:this.connectionId, timestamp:this.lastTimestamp, id:this.lastId}])});
+		}
+	};
+	this.deliver = cometd.iframeTransport.deliver;
+	this.openTunnelWith = function (content, url) {
+		dojo.io.bind({url:(url || cometd.url), method:&quot;post&quot;, content:content, mimetype:&quot;text/json&quot;, load:dojo.lang.hitch(this, function (type, data, evt, args) {
+			cometd.deliver(data);
+			this.connected = false;
+			this.tunnelCollapse();
+		}), error:function () {
+			dojo.debug(&quot;tunnel opening failed&quot;);
+		}});
+		this.connected = true;
+	};
+	this.processBacklog = function () {
+		while (this.backlog.length &gt; 0) {
+			this.sendMessage(this.backlog.shift(), true);
+		}
+	};
+	this.sendMessage = function (message, bypassBacklog) {
+		if ((bypassBacklog) || (this.connected)) {
+			message.connectionId = this.connectionId;
+			message.clientId = cometd.clientId;
+			var bindArgs = {url:cometd.url || djConfig[&quot;cometdRoot&quot;], method:&quot;post&quot;, mimetype:&quot;text/json&quot;, content:{message:dojo.json.serialize([message])}, load:dojo.lang.hitch(this, function (type, data, evt, args) {
+				cometd.deliver(data);
+			})};
+			return dojo.io.bind(bindArgs);
+		} else {
+			this.backlog.push(message);
+		}
+	};
+	this.startup = function (handshakeData) {
+		if (this.connected) {
+			return;
+		}
+		this.tunnelInit();
+	};
+};
+cometd.callbackPollTransport = new function () {
+	this.connected = false;
+	this.connectionId = null;
+	this.authToken = null;
+	this.lastTimestamp = null;
+	this.lastId = null;
+	this.backlog = [];
+	this.check = function (types, version, xdomain) {
+		return dojo.lang.inArray(types, &quot;callback-polling&quot;);
+	};
+	this.tunnelInit = function () {
+		if (this.connected) {
+			return;
+		}
+		this.openTunnelWith({message:dojo.json.serialize([{channel:&quot;/meta/connect&quot;, clientId:cometd.clientId, connectionType:&quot;callback-polling&quot;}])});
+		this.connected = true;
+	};
+	this.tunnelCollapse = function () {
+		if (!this.connected) {
+			this.connected = false;
+			this.openTunnelWith({message:dojo.json.serialize([{channel:&quot;/meta/reconnect&quot;, connectionType:&quot;long-polling&quot;, clientId:cometd.clientId, connectionId:this.connectionId, timestamp:this.lastTimestamp, id:this.lastId}])});
+		}
+	};
+	this.deliver = cometd.iframeTransport.deliver;
+	this.openTunnelWith = function (content, url) {
+		var req = dojo.io.bind({url:(url || cometd.url), content:content, mimetype:&quot;text/json&quot;, transport:&quot;ScriptSrcTransport&quot;, jsonParamName:&quot;jsonp&quot;, load:dojo.lang.hitch(this, function (type, data, evt, args) {
+			cometd.deliver(data);
+			this.connected = false;
+			this.tunnelCollapse();
+		}), error:function () {
+			dojo.debug(&quot;tunnel opening failed&quot;);
+		}});
+		this.connected = true;
+	};
+	this.processBacklog = function () {
+		while (this.backlog.length &gt; 0) {
+			this.sendMessage(this.backlog.shift(), true);
+		}
+	};
+	this.sendMessage = function (message, bypassBacklog) {
+		if ((bypassBacklog) || (this.connected)) {
+			message.connectionId = this.connectionId;
+			message.clientId = cometd.clientId;
+			var bindArgs = {url:cometd.url || djConfig[&quot;cometdRoot&quot;], mimetype:&quot;text/json&quot;, transport:&quot;ScriptSrcTransport&quot;, jsonParamName:&quot;jsonp&quot;, content:{message:dojo.json.serialize([message])}, load:dojo.lang.hitch(this, function (type, data, evt, args) {
+				cometd.deliver(data);
+			})};
+			return dojo.io.bind(bindArgs);
+		} else {
+			this.backlog.push(message);
+		}
+	};
+	this.startup = function (handshakeData) {
+		if (this.connected) {
+			return;
+		}
+		this.tunnelInit();
+	};
+};
+cometd.connectionTypes.register(&quot;mime-message-block&quot;, cometd.mimeReplaceTransport.check, cometd.mimeReplaceTransport);
+cometd.connectionTypes.register(&quot;long-polling&quot;, cometd.longPollTransport.check, cometd.longPollTransport);
+cometd.connectionTypes.register(&quot;callback-polling&quot;, cometd.callbackPollTransport.check, cometd.callbackPollTransport);
+cometd.connectionTypes.register(&quot;iframe&quot;, cometd.iframeTransport.check, cometd.iframeTransport);
+dojo.io.cometd = cometd;
+

Added: tags/parley-0.55/root/static/magic/src/io/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,232 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.common&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.io.transports = [];
+dojo.io.hdlrFuncNames = [&quot;load&quot;, &quot;error&quot;, &quot;timeout&quot;];
+dojo.io.Request = function (url, mimetype, transport, changeUrl) {
+	if ((arguments.length == 1) &amp;&amp; (arguments[0].constructor == Object)) {
+		this.fromKwArgs(arguments[0]);
+	} else {
+		this.url = url;
+		if (mimetype) {
+			this.mimetype = mimetype;
+		}
+		if (transport) {
+			this.transport = transport;
+		}
+		if (arguments.length &gt;= 4) {
+			this.changeUrl = changeUrl;
+		}
+	}
+};
+dojo.lang.extend(dojo.io.Request, {url:&quot;&quot;, mimetype:&quot;text/plain&quot;, method:&quot;GET&quot;, content:undefined, transport:undefined, changeUrl:undefined, formNode:undefined, sync:false, bindSuccess:false, useCache:false, preventCache:false, jsonFilter:function (value) {
+	if ((this.mimetype == &quot;text/json-comment-filtered&quot;) || (this.mimetype == &quot;application/json-comment-filtered&quot;)) {
+		var cStartIdx = value.indexOf(&quot;/*&quot;);
+		var cEndIdx = value.lastIndexOf(&quot;*/&quot;);
+		if ((cStartIdx == -1) || (cEndIdx == -1)) {
+			dojo.debug(&quot;your JSON wasn't comment filtered!&quot;);
+			return &quot;&quot;;
+		}
+		return value.substring(cStartIdx + 2, cEndIdx);
+	}
+	dojo.debug(&quot;please consider using a mimetype of text/json-comment-filtered to avoid potential security issues with JSON endpoints&quot;);
+	return value;
+}, load:function (type, data, transportImplementation, kwArgs) {
+}, error:function (type, error, transportImplementation, kwArgs) {
+}, timeout:function (type, empty, transportImplementation, kwArgs) {
+}, handle:function (type, data, transportImplementation, kwArgs) {
+}, timeoutSeconds:0, abort:function () {
+}, fromKwArgs:function (kwArgs) {
+	if (kwArgs[&quot;url&quot;]) {
+		kwArgs.url = kwArgs.url.toString();
+	}
+	if (kwArgs[&quot;formNode&quot;]) {
+		kwArgs.formNode = dojo.byId(kwArgs.formNode);
+	}
+	if (!kwArgs[&quot;method&quot;] &amp;&amp; kwArgs[&quot;formNode&quot;] &amp;&amp; kwArgs[&quot;formNode&quot;].method) {
+		kwArgs.method = kwArgs[&quot;formNode&quot;].method;
+	}
+	if (!kwArgs[&quot;handle&quot;] &amp;&amp; kwArgs[&quot;handler&quot;]) {
+		kwArgs.handle = kwArgs.handler;
+	}
+	if (!kwArgs[&quot;load&quot;] &amp;&amp; kwArgs[&quot;loaded&quot;]) {
+		kwArgs.load = kwArgs.loaded;
+	}
+	if (!kwArgs[&quot;changeUrl&quot;] &amp;&amp; kwArgs[&quot;changeURL&quot;]) {
+		kwArgs.changeUrl = kwArgs.changeURL;
+	}
+	kwArgs.encoding = dojo.lang.firstValued(kwArgs[&quot;encoding&quot;], djConfig[&quot;bindEncoding&quot;], &quot;&quot;);
+	kwArgs.sendTransport = dojo.lang.firstValued(kwArgs[&quot;sendTransport&quot;], djConfig[&quot;ioSendTransport&quot;], false);
+	var isFunction = dojo.lang.isFunction;
+	for (var x = 0; x &lt; dojo.io.hdlrFuncNames.length; x++) {
+		var fn = dojo.io.hdlrFuncNames[x];
+		if (kwArgs[fn] &amp;&amp; isFunction(kwArgs[fn])) {
+			continue;
+		}
+		if (kwArgs[&quot;handle&quot;] &amp;&amp; isFunction(kwArgs[&quot;handle&quot;])) {
+			kwArgs[fn] = kwArgs.handle;
+		}
+	}
+	dojo.lang.mixin(this, kwArgs);
+}});
+dojo.io.Error = function (msg, type, num) {
+	this.message = msg;
+	this.type = type || &quot;unknown&quot;;
+	this.number = num || 0;
+};
+dojo.io.transports.addTransport = function (name) {
+	this.push(name);
+	this[name] = dojo.io[name];
+};
+dojo.io.bind = function (request) {
+	if (!(request instanceof dojo.io.Request)) {
+		try {
+			request = new dojo.io.Request(request);
+		}
+		catch (e) {
+			dojo.debug(e);
+		}
+	}
+	var tsName = &quot;&quot;;
+	if (request[&quot;transport&quot;]) {
+		tsName = request[&quot;transport&quot;];
+		if (!this[tsName]) {
+			dojo.io.sendBindError(request, &quot;No dojo.io.bind() transport with name '&quot; + request[&quot;transport&quot;] + &quot;'.&quot;);
+			return request;
+		}
+		if (!this[tsName].canHandle(request)) {
+			dojo.io.sendBindError(request, &quot;dojo.io.bind() transport with name '&quot; + request[&quot;transport&quot;] + &quot;' cannot handle this type of request.&quot;);
+			return request;
+		}
+	} else {
+		for (var x = 0; x &lt; dojo.io.transports.length; x++) {
+			var tmp = dojo.io.transports[x];
+			if ((this[tmp]) &amp;&amp; (this[tmp].canHandle(request))) {
+				tsName = tmp;
+				break;
+			}
+		}
+		if (tsName == &quot;&quot;) {
+			dojo.io.sendBindError(request, &quot;None of the loaded transports for dojo.io.bind()&quot; + &quot; can handle the request.&quot;);
+			return request;
+		}
+	}
+	this[tsName].bind(request);
+	request.bindSuccess = true;
+	return request;
+};
+dojo.io.sendBindError = function (request, message) {
+	if ((typeof request.error == &quot;function&quot; || typeof request.handle == &quot;function&quot;) &amp;&amp; (typeof setTimeout == &quot;function&quot; || typeof setTimeout == &quot;object&quot;)) {
+		var errorObject = new dojo.io.Error(message);
+		setTimeout(function () {
+			request[(typeof request.error == &quot;function&quot;) ? &quot;error&quot; : &quot;handle&quot;](&quot;error&quot;, errorObject, null, request);
+		}, 50);
+	} else {
+		dojo.raise(message);
+	}
+};
+dojo.io.queueBind = function (request) {
+	if (!(request instanceof dojo.io.Request)) {
+		try {
+			request = new dojo.io.Request(request);
+		}
+		catch (e) {
+			dojo.debug(e);
+		}
+	}
+	var oldLoad = request.load;
+	request.load = function () {
+		dojo.io._queueBindInFlight = false;
+		var ret = oldLoad.apply(this, arguments);
+		dojo.io._dispatchNextQueueBind();
+		return ret;
+	};
+	var oldErr = request.error;
+	request.error = function () {
+		dojo.io._queueBindInFlight = false;
+		var ret = oldErr.apply(this, arguments);
+		dojo.io._dispatchNextQueueBind();
+		return ret;
+	};
+	dojo.io._bindQueue.push(request);
+	dojo.io._dispatchNextQueueBind();
+	return request;
+};
+dojo.io._dispatchNextQueueBind = function () {
+	if (!dojo.io._queueBindInFlight) {
+		dojo.io._queueBindInFlight = true;
+		if (dojo.io._bindQueue.length &gt; 0) {
+			dojo.io.bind(dojo.io._bindQueue.shift());
+		} else {
+			dojo.io._queueBindInFlight = false;
+		}
+	}
+};
+dojo.io._bindQueue = [];
+dojo.io._queueBindInFlight = false;
+dojo.io.argsFromMap = function (map, encoding, last) {
+	var enc = /utf/i.test(encoding || &quot;&quot;) ? encodeURIComponent : dojo.string.encodeAscii;
+	var mapped = [];
+	var control = new Object();
+	for (var name in map) {
+		var domap = function (elt) {
+			var val = enc(name) + &quot;=&quot; + enc(elt);
+			mapped[(last == name) ? &quot;push&quot; : &quot;unshift&quot;](val);
+		};
+		if (!control[name]) {
+			var value = map[name];
+			if (dojo.lang.isArray(value)) {
+				dojo.lang.forEach(value, domap);
+			} else {
+				domap(value);
+			}
+		}
+	}
+	return mapped.join(&quot;&amp;&quot;);
+};
+dojo.io.setIFrameSrc = function (iframe, src, replace) {
+	try {
+		var r = dojo.render.html;
+		if (!replace) {
+			if (r.safari) {
+				iframe.location = src;
+			} else {
+				frames[iframe.name].location = src;
+			}
+		} else {
+			var idoc;
+			if (r.ie) {
+				idoc = iframe.contentWindow.document;
+			} else {
+				if (r.safari) {
+					idoc = iframe.document;
+				} else {
+					idoc = iframe.contentWindow;
+				}
+			}
+			if (!idoc) {
+				iframe.location = src;
+				return;
+			} else {
+				idoc.location.replace(src);
+			}
+		}
+	}
+	catch (e) {
+		dojo.debug(e);
+		dojo.debug(&quot;setIFrameSrc: &quot; + e);
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/io/cookie.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/cookie.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/cookie.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,104 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io.cookie&quot;);
+dojo.io.cookie.setCookie = function (name, value, days, path, domain, secure) {
+	var expires = -1;
+	if ((typeof days == &quot;number&quot;) &amp;&amp; (days &gt;= 0)) {
+		var d = new Date();
+		d.setTime(d.getTime() + (days * 24 * 60 * 60 * 1000));
+		expires = d.toGMTString();
+	}
+	value = escape(value);
+	document.cookie = name + &quot;=&quot; + value + &quot;;&quot; + (expires != -1 ? &quot; expires=&quot; + expires + &quot;;&quot; : &quot;&quot;) + (path ? &quot;path=&quot; + path : &quot;&quot;) + (domain ? &quot;; domain=&quot; + domain : &quot;&quot;) + (secure ? &quot;; secure&quot; : &quot;&quot;);
+};
+dojo.io.cookie.set = dojo.io.cookie.setCookie;
+dojo.io.cookie.getCookie = function (name) {
+	var idx = document.cookie.lastIndexOf(name + &quot;=&quot;);
+	if (idx == -1) {
+		return null;
+	}
+	var value = document.cookie.substring(idx + name.length + 1);
+	var end = value.indexOf(&quot;;&quot;);
+	if (end == -1) {
+		end = value.length;
+	}
+	value = value.substring(0, end);
+	value = unescape(value);
+	return value;
+};
+dojo.io.cookie.get = dojo.io.cookie.getCookie;
+dojo.io.cookie.deleteCookie = function (name) {
+	dojo.io.cookie.setCookie(name, &quot;-&quot;, 0);
+};
+dojo.io.cookie.setObjectCookie = function (name, obj, days, path, domain, secure, clearCurrent) {
+	if (arguments.length == 5) {
+		clearCurrent = domain;
+		domain = null;
+		secure = null;
+	}
+	var pairs = [], cookie, value = &quot;&quot;;
+	if (!clearCurrent) {
+		cookie = dojo.io.cookie.getObjectCookie(name);
+	}
+	if (days &gt;= 0) {
+		if (!cookie) {
+			cookie = {};
+		}
+		for (var prop in obj) {
+			if (obj[prop] == null) {
+				delete cookie[prop];
+			} else {
+				if ((typeof obj[prop] == &quot;string&quot;) || (typeof obj[prop] == &quot;number&quot;)) {
+					cookie[prop] = obj[prop];
+				}
+			}
+		}
+		prop = null;
+		for (var prop in cookie) {
+			pairs.push(escape(prop) + &quot;=&quot; + escape(cookie[prop]));
+		}
+		value = pairs.join(&quot;&amp;&quot;);
+	}
+	dojo.io.cookie.setCookie(name, value, days, path, domain, secure);
+};
+dojo.io.cookie.getObjectCookie = function (name) {
+	var values = null, cookie = dojo.io.cookie.getCookie(name);
+	if (cookie) {
+		values = {};
+		var pairs = cookie.split(&quot;&amp;&quot;);
+		for (var i = 0; i &lt; pairs.length; i++) {
+			var pair = pairs[i].split(&quot;=&quot;);
+			var value = pair[1];
+			if (isNaN(value)) {
+				value = unescape(pair[1]);
+			}
+			values[unescape(pair[0])] = value;
+		}
+	}
+	return values;
+};
+dojo.io.cookie.isSupported = function () {
+	if (typeof navigator.cookieEnabled != &quot;boolean&quot;) {
+		dojo.io.cookie.setCookie(&quot;__TestingYourBrowserForCookieSupport__&quot;, &quot;CookiesAllowed&quot;, 90, null);
+		var cookieVal = dojo.io.cookie.getCookie(&quot;__TestingYourBrowserForCookieSupport__&quot;);
+		navigator.cookieEnabled = (cookieVal == &quot;CookiesAllowed&quot;);
+		if (navigator.cookieEnabled) {
+			this.deleteCookie(&quot;__TestingYourBrowserForCookieSupport__&quot;);
+		}
+	}
+	return navigator.cookieEnabled;
+};
+if (!dojo.io.cookies) {
+	dojo.io.cookies = dojo.io.cookie;
+}
+

Added: tags/parley-0.55/root/static/magic/src/io/xip_client.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/xip_client.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/xip_client.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,267 @@
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
+	&quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>&quot;&gt;
+
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml">http://www.w3.org/1999/xhtml</A>&quot; xml:lang=&quot;en&quot; lang=&quot;en&quot;&gt;
+&lt;head&gt;
+	&lt;title&gt;&lt;/title&gt;
+	&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;/meta&gt;
+	&lt;!-- Security protection: uncomment the script tag to enable. --&gt;
+	&lt;!-- script type=&quot;text/javascript&quot; --&gt;
+	// &lt;!--
+	/*
+	This file is really focused on just sending one message to the server, and
+	receiving one response. The code does not expect to be re-used for multiple messages.
+	This might be reworked later if performance indicates a need for it.
+	
+	xip fragment identifier/hash values have the form:
+	#id:cmd:realEncodedMessage
+
+	id: some ID that should be unique among messages. No inherent meaning,
+	        just something to make sure the hash value is unique so the message
+	        receiver knows a new message is available.
+	        
+	cmd: command to the receiver. Valid values are:
+	         - init: message used to init the frame. Sent as the first URL when loading
+	                 the page. Contains some config parameters.
+	         - loaded: the remote frame is loaded. Only sent from server to client.
+	         - ok: the message that this page sent was received OK. The next message may
+	               now be sent.
+	         - start: the start message of a block of messages (a complete message may
+	                  need to be segmented into many messages to get around the limitiations
+	                  of the size of an URL that a browser accepts.
+	         - part: indicates this is a part of a message.
+	         - end: the end message of a block of messages. The message can now be acted upon.
+	                If the message is small enough that it doesn't need to be segmented, then
+	                just one hash value message can be sent with &quot;end&quot; as the command.
+	
+	To reassemble a segmented message, the realEncodedMessage parts just have to be concatenated
+	together.
+	*/
+
+	//MSIE has the lowest limit for URLs with fragment identifiers,
+	//at around 4K. Choosing a slightly smaller number for good measure.
+	xipUrlLimit = 4000;
+	xipIdCounter = 1;
+
+	function xipInit(){
+		xipStateId = &quot;&quot;;
+		xipIsSending = false;
+		xipServerUrl = null;
+		xipStateId = null;
+		xipRequestData = null;
+		xipCurrentHash = &quot;&quot;;
+		xipResponseMessage = &quot;&quot;;
+		xipRequestParts = [];
+		xipPartIndex = 0;
+		xipServerWindow = null;
+		xipUseFrameRecursion = false;
+	}
+	xipInit();
+	
+	function send(encodedData){
+		if(xipUseFrameRecursion == &quot;true&quot;){
+			var clientEndPoint = window.open(xipStateId + &quot;_clientEndPoint&quot;);
+			clientEndPoint.send(encodedData);
+		}else{
+			if(!xipIsSending){
+				xipIsSending = true;
+	
+				xipRequestData = encodedData || &quot;&quot;;
+
+				//Get a handle to the server iframe.
+				xipServerWindow = frames[xipStateId + &quot;_frame&quot;];
+				if (!xipServerWindow){
+					xipServerWindow = document.getElementById(xipStateId + &quot;_frame&quot;).contentWindow;
+				}
+	
+				sendRequestStart();
+			}
+		}
+	}
+
+	//Modify the server URL if it is a local path and 
+	//This is done for local/same domain testing.
+	function fixServerUrl(ifpServerUrl){
+		if(ifpServerUrl.indexOf(&quot;..&quot;) == 0){
+			var parts = ifpServerUrl.split(&quot;/&quot;);
+			ifpServerUrl = parts[parts.length - 1];
+		}
+		return ifpServerUrl;
+	}
+	
+	
+	function pollHash(){
+		//Can't use location.hash because at least Firefox does a decodeURIComponent on it.
+		var urlParts = window.location.href.split(&quot;#&quot;);
+		if(urlParts.length == 2){
+			var newHash = urlParts[1];
+			if(newHash != xipCurrentHash){
+				try{
+					messageReceived(newHash);
+				}catch(e){
+					//Make sure to not keep processing the error hash value.
+					xipCurrentHash = newHash;
+					throw e;
+				}
+				xipCurrentHash = newHash;
+			}
+		}
+	}
+
+	function messageReceived(encodedData){
+		var msg = unpackMessage(encodedData);
+
+		switch(msg.command){
+			case &quot;loaded&quot;:
+				xipMasterFrame.dojo.io.XhrIframeProxy.clientFrameLoaded(xipStateId);
+				break;
+			case &quot;ok&quot;:
+				sendRequestPart();
+				break;
+			case &quot;start&quot;:
+				xipResponseMessage = &quot;&quot;;
+				xipResponseMessage += msg.message;
+				setServerUrl(&quot;ok&quot;);
+				break;
+			case &quot;part&quot;:
+				xipResponseMessage += msg.message;			
+				setServerUrl(&quot;ok&quot;);
+				break;
+			case &quot;end&quot;:
+				setServerUrl(&quot;ok&quot;);
+				xipResponseMessage += msg.message;
+				xipMasterFrame.dojo.io.XhrIframeProxy.receive(xipStateId, xipResponseMessage);
+				break;
+		}
+	}
+	
+	function sendRequestStart(){
+		//Break the message into parts, if necessary.
+		xipRequestParts = [];
+		var reqData = xipRequestData;
+		var urlLength = xipServerUrl.length;
+		var partLength = xipUrlLimit - urlLength;
+		var reqIndex = 0;
+
+		while((reqData.length - reqIndex) + urlLength &gt; xipUrlLimit){
+			var part = reqData.substring(reqIndex, reqIndex + partLength);
+			//Safari will do some extra hex escaping unless we keep the original hex
+			//escaping complete.
+			var percentIndex = part.lastIndexOf(&quot;%&quot;);
+			if(percentIndex == part.length - 1 || percentIndex == part.length - 2){
+				part = part.substring(0, percentIndex);
+			}
+			xipRequestParts.push(part);
+			reqIndex += part.length;
+		}
+		xipRequestParts.push(reqData.substring(reqIndex, reqData.length));
+		
+		xipPartIndex = 0;
+		sendRequestPart();
+		
+	}
+	
+	function sendRequestPart(){
+		if(xipPartIndex &lt; xipRequestParts.length){
+			//Get the message part.
+			var partData = xipRequestParts[xipPartIndex];
+
+			//Get the command.
+			var cmd = &quot;part&quot;;
+			if(xipPartIndex + 1 == xipRequestParts.length){
+				cmd = &quot;end&quot;;
+			}else if (xipPartIndex == 0){
+				cmd = &quot;start&quot;;
+			}
+			
+			setServerUrl(cmd, partData);
+			xipPartIndex++;
+		}
+	}
+	
+	function setServerUrl(cmd, message){
+		var serverUrl = makeServerUrl(cmd, message);
+
+		//Safari won't let us replace across domains.
+		if(navigator.userAgent.indexOf(&quot;Safari&quot;) == -1){
+			xipServerWindow.location.replace(serverUrl);
+		}else{
+			xipServerWindow.location = serverUrl;
+		}
+	}
+	
+	function makeServerUrl(cmd, message){
+		var serverUrl = xipServerUrl + &quot;#&quot; + (xipIdCounter++) + &quot;:&quot; + cmd;
+		if(message){
+			serverUrl += &quot;:&quot; + message;
+		}
+		return serverUrl;
+	}
+
+	function unpackMessage(encodedMessage){
+		var parts = encodedMessage.split(&quot;:&quot;);
+		var command = parts[1];
+		encodedMessage = parts[2] || &quot;&quot;;
+
+		var config = null;
+		if(command == &quot;init&quot;){
+			var configParts = encodedMessage.split(&quot;&amp;&quot;);
+			config = {};
+			for(var i = 0; i &lt; configParts.length; i++){
+				var nameValue = configParts[i].split(&quot;=&quot;);
+				config[decodeURIComponent(nameValue[0])] = decodeURIComponent(nameValue[1]);
+			}
+		}
+		return {command: command, message: encodedMessage, config: config};
+	}
+
+	function onClientLoad(){
+		//Decode the init params
+		var config = unpackMessage(window.location.href.split(&quot;#&quot;)[1]).config;
+
+		xipStateId = config.id;
+
+		//Remove the query param for the IE7 recursive case.
+		xipServerUrl = fixServerUrl(config.server).replace(/(\?|\&amp;)dojo\.fr\=1/, &quot;&quot;);
+		
+		//Make sure we don't have a javascript: url, just for good measure.
+		if(xipServerUrl.split(&quot;:&quot;)[0].match(/javascript/i)){
+			throw &quot;Invalid server URL&quot;;
+		}
+
+		xipUseFrameRecursion = config[&quot;fr&quot;];
+		
+		if(xipUseFrameRecursion == &quot;endpoint&quot;){
+			xipMasterFrame = parent.parent;
+		}else{
+			xipMasterFrame = parent;
+		}
+		
+		//Start counter to inspect hash value.
+		setInterval(pollHash, 10);
+
+		var clientUrl = window.location.href.split(&quot;#&quot;)[0];
+		var iframeNode = document.getElementsByTagName(&quot;iframe&quot;)[0];
+		iframeNode.id = xipStateId + &quot;_frame&quot;;
+		iframeNode.src = makeServerUrl(&quot;init&quot;, 'id=' + xipStateId + '&amp;client='
+			+ encodeURIComponent(clientUrl) + '&amp;fr=' + xipUseFrameRecursion);
+	}
+
+	if(typeof(window.addEventListener) == &quot;undefined&quot;){
+		window.attachEvent(&quot;onload&quot;, onClientLoad);
+	}else{
+		window.addEventListener('load', onClientLoad, false);
+	}
+	
+	// --&gt;
+	&lt;/script&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;h4&gt;The Dojo Toolkit -- xip_client.html&lt;/h4&gt;
+
+	&lt;p&gt;This file is used for Dojo's XMLHttpRequest Iframe Proxy. This is the &quot;client&quot; file used
+	internally by dojo.io.XhrIframeProxy.&lt;/p&gt;
+	
+	&lt;iframe src=&quot;javascript:false&quot;&gt;&lt;/iframe&gt;
+&lt;/body&gt;
+&lt;/html&gt;

Added: tags/parley-0.55/root/static/magic/src/io/xip_server.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/io/xip_server.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io/xip_server.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,386 @@
+&lt;!--
+	/*
+		Copyright (c) 2004-2006, The Dojo Foundation
+		All Rights Reserved.
+	
+		Licensed under the Academic Free License version 2.1 or above OR the
+		modified BSD license. For more information on Dojo licensing, see:
+	
+			<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+	*/
+	Pieces taken from Dojo source to make this file stand-alone
+--&gt;
+&lt;html&gt;
+&lt;head&gt;
+	&lt;title&gt;&lt;/title&gt;
+	&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;/meta&gt;
+	&lt;script type=&quot;text/javascript&quot; src=&quot;isAllowed.js&quot;&gt;&lt;/script&gt;
+	&lt;!--
+	BY DEFAULT THIS FILE DOES NOT WORK SO THAT YOU DON'T ACCIDENTALLY EXPOSE
+	ALL OF YOUR XHR-ENABLED SERVICES ON YOUR SITE. 
+	
+	In order for this file to work, you need to uncomment the script element,
+	and you should define a function with the following signature:
+	
+	function isAllowedRequest(request){
+		return false;	
+	}
+	
+	Return true out of the function if you want to allow the cross-domain request.
+	
+	DON'T DEFINE THIS FUNCTION IN THIS FILE! Define it in a separate file called isAllowed.js
+	and include it in this page with a script tag that has a src attribute pointing to the file.
+	See the very first script tag in this file for an example. You do not have to place the
+	script file in the same directory as this file, just update the path above if you move it
+	somewhere else.
+	
+	Customize the isAllowedRequest function to restrict what types of requests are allowed
+	for this server. The request object has the following properties:
+	- requestHeaders: an object with the request headers that are to be added to
+	                  the XHR request.
+	- method: the HTTP method (GET, POST, etc...)
+	- uri: The URI for the request.
+	- data: The URL-encoded data for the request. For a GET request, this would
+	        be the querystring parameters. For a POST request, it wll be the
+	        body data.
+	        
+	See xip_client.html for more info on the xip fragment identifier protocol.	
+	--&gt;
+	
+	&lt;!-- Security protection: uncomment the script tag to enable. --&gt;
+	&lt;!-- script type=&quot;text/javascript&quot; --&gt;
+	// &lt;!--
+		//Core XHR handling taken from Dojo IO code.
+		dojo = {};
+		dojo.hostenv = {};
+		// These are in order of decreasing likelihood; this will change in time.
+		dojo.hostenv._XMLHTTP_PROGIDS = ['Msxml2.XMLHTTP', 'Microsoft.XMLHTTP', 'Msxml2.XMLHTTP.4.0'];
+		
+		dojo.hostenv.getXmlhttpObject = function(){
+				var http = null;
+			var last_e = null;
+			try{ http = new XMLHttpRequest(); }catch(e){}
+				if(!http){
+				for(var i=0; i&lt;3; ++i){
+					var progid = dojo.hostenv._XMLHTTP_PROGIDS[i];
+					try{
+						http = new ActiveXObject(progid);
+					}catch(e){
+						last_e = e;
+					}
+		
+					if(http){
+						dojo.hostenv._XMLHTTP_PROGIDS = [progid];  // so faster next time
+						break;
+					}
+				}
+		
+				/*if(http &amp;&amp; !http.toString) {
+					http.toString = function() { &quot;[object XMLHttpRequest]&quot;; }
+				}*/
+			}
+		
+			if(!http){
+				throw &quot;xip_server.html: XMLHTTP not available: &quot; + last_e;
+			}
+		
+			return http;
+		}
+
+		dojo.setHeaders = function(http, headers){
+			if(headers) {
+				for(var header in headers) {
+					var headerValue = headers[header];
+					http.setRequestHeader(header, headerValue);
+				}
+			}
+		}
+
+	//MSIE has the lowest limit for URLs with fragment identifiers,
+	//at around 4K. Choosing a slightly smaller number for good measure.
+	xipUrlLimit = 4000;
+	xipIdCounter = 1;
+
+	function xipServerInit(){
+		xipStateId = &quot;&quot;;
+		xipCurrentHash = &quot;&quot;;
+		xipRequestMessage = &quot;&quot;;
+		xipResponseParts = [];
+		xipPartIndex = 0;
+	}
+
+	function pollHash(){
+		//Can't use location.hash because at least Firefox does a decodeURIComponent on it.
+		var urlParts = window.location.href.split(&quot;#&quot;);
+		if(urlParts.length == 2){
+			var newHash = urlParts[1];
+			if(newHash != xipCurrentHash){
+				try{
+					messageReceived(newHash);
+				}catch(e){
+					//Make sure to not keep processing the error hash value.
+					xipCurrentHash = newHash;
+					throw e;
+				}
+				xipCurrentHash = newHash;
+			}
+		}
+	}
+
+	function messageReceived(encodedData){
+		var msg = unpackMessage(encodedData);
+		
+		switch(msg.command){
+			case &quot;ok&quot;:
+				sendResponsePart();
+				break;
+			case &quot;start&quot;:
+				xipRequestMessage = &quot;&quot;;
+				xipRequestMessage += msg.message;
+				setClientUrl(&quot;ok&quot;);
+				break;
+			case &quot;part&quot;:
+				xipRequestMessage += msg.message;			
+				setClientUrl(&quot;ok&quot;);
+				break;
+			case &quot;end&quot;:
+				setClientUrl(&quot;ok&quot;);
+				xipRequestMessage += msg.message;
+				sendXhr();
+				break;
+		}
+	}
+
+	function sendResponse(encodedData){
+		//Break the message into parts, if necessary.
+		xipResponseParts = [];
+		var resData = encodedData;
+		var urlLength = xipClientUrl.length;
+		var partLength = xipUrlLimit - urlLength;
+		var resIndex = 0;
+
+		while((resData.length - resIndex) + urlLength &gt; xipUrlLimit){
+			var part = resData.substring(resIndex, resIndex + partLength);
+			//Safari will do some extra hex escaping unless we keep the original hex
+			//escaping complete.
+			var percentIndex = part.lastIndexOf(&quot;%&quot;);
+			if(percentIndex == part.length - 1 || percentIndex == part.length - 2){
+				part = part.substring(0, percentIndex);
+			}
+			xipResponseParts.push(part);
+			resIndex += part.length;
+		}
+		xipResponseParts.push(resData.substring(resIndex, resData.length));
+		
+		xipPartIndex = 0;
+		sendResponsePart();
+	}
+	
+	function sendResponsePart(){
+		if(xipPartIndex &lt; xipResponseParts.length){
+			//Get the message part.
+			var partData = xipResponseParts[xipPartIndex];
+			
+			//Get the command.
+			var cmd = &quot;part&quot;;
+			if(xipPartIndex + 1 == xipResponseParts.length){
+				cmd = &quot;end&quot;;
+			}else if (xipPartIndex == 0){
+				cmd = &quot;start&quot;;
+			}
+
+			setClientUrl(cmd, partData);
+			xipPartIndex++;
+		}else{
+			xipServerInit();
+		}
+	}
+
+	function setClientUrl(cmd, message){
+		var clientUrl = makeClientUrl(cmd, message);
+		//Safari won't let us replace across domains.
+		if(navigator.userAgent.indexOf(&quot;Safari&quot;) == -1){
+			parent.location.replace(clientUrl);
+		}else{
+			parent.location = clientUrl;
+		}
+	}
+
+	function makeClientUrl(cmd, message){
+		var clientUrl = xipClientUrl + &quot;#&quot; + (xipIdCounter++) + &quot;:&quot; + cmd;
+		if(message){
+			clientUrl += &quot;:&quot; + message;
+		}
+		return clientUrl
+	}
+
+	function xhrDone(xhr){
+		/* Need to pull off and return the following data:
+			- responseHeaders
+			- status
+			- statusText
+			- responseText
+		*/
+		var response = {};
+	
+		if(typeof(xhr.getAllResponseHeaders) != &quot;undefined&quot;){
+			var allHeaders = xhr.getAllResponseHeaders();
+			if(allHeaders){
+				response.responseHeaders = allHeaders;
+			}
+		}
+		
+		if(xhr.status == 0 || xhr.status){
+			response.status = xhr.status;
+		}
+		
+		if(xhr.statusText){
+			response.statusText = xhr.statusText;
+		}
+		
+		if(xhr.responseText){
+			response.responseText = xhr.responseText;
+		}
+	
+		//Build a string of the response object.
+		var result = &quot;&quot;;
+		var isFirst = true;
+		for (var param in response){
+			if(isFirst){
+				isFirst = false;
+			}else{
+				result += &quot;&amp;&quot;;
+			}
+			result += param + &quot;=&quot; + encodeURIComponent(response[param]);
+		}
+		sendResponse(result);
+	}
+
+	function sendXhr(){
+		var request = {};
+		var nvPairs = xipRequestMessage.split(&quot;&amp;&quot;);
+		var i = 0;
+		var nameValue = null;
+		for(i = 0; i &lt; nvPairs.length; i++){
+			if(nvPairs[i]){
+				var nameValue = nvPairs[i].split(&quot;=&quot;);
+				request[decodeURIComponent(nameValue[0])] = decodeURIComponent(nameValue[1]);
+			}
+		}
+
+		//Split up the request headers, if any.
+		var headers = {};
+		if(request.requestHeaders){
+			nvPairs = request.requestHeaders.split(&quot;\r\n&quot;);
+			for(i = 0; i &lt; nvPairs.length; i++){
+				if(nvPairs[i]){
+					nameValue = nvPairs[i].split(&quot;: &quot;);
+					headers[decodeURIComponent(nameValue[0])] = decodeURIComponent(nameValue[1]);
+				}
+			}
+
+			request.requestHeaders = headers;
+		}
+		
+		if(isAllowedRequest(request)){
+		
+			//The request is allowed, so set up the XHR object.
+			var xhr = dojo.hostenv.getXmlhttpObject();
+			
+			//Start timer to look for readyState.
+			var xhrIntervalId = setInterval(function(){
+			
+				if(xhr.readyState == 4){
+					clearInterval(xhrIntervalId);
+					xhrDone(xhr);
+				}
+			}, 10);
+
+			//Actually start up the XHR request.
+			xhr.open(request.method, request.uri, true);
+			dojo.setHeaders(xhr, request.requestHeaders);
+			
+			var content = &quot;&quot;;
+			if(request.data){
+				content = request.data;
+			}
+
+			try{
+				xhr.send(content);
+			}catch(e){
+				if(typeof xhr.abort == &quot;function&quot;){
+					xhr.abort();
+					xhrDone({status: 404, statusText: &quot;xip_server.html error: &quot; + e});
+				}
+			}
+		}
+	}
+
+	function unpackMessage(encodedMessage){
+		var parts = encodedMessage.split(&quot;:&quot;);
+		var command = parts[1];
+		encodedMessage = parts[2] || &quot;&quot;;
+
+		var config = null;
+		if(command == &quot;init&quot;){
+			var configParts = encodedMessage.split(&quot;&amp;&quot;);
+			config = {};
+			for(var i = 0; i &lt; configParts.length; i++){
+				var nameValue = configParts[i].split(&quot;=&quot;);
+				config[decodeURIComponent(nameValue[0])] = decodeURIComponent(nameValue[1]);
+			}
+		}
+		return {command: command, message: encodedMessage, config: config};
+	}
+
+	function onServerLoad(){
+		xipServerInit();
+
+		//Decode the init params
+		var config = unpackMessage(window.location.href.split(&quot;#&quot;)[1]).config;
+
+		xipStateId = config.id;
+		xipClientUrl = config.client;
+		
+		//Make sure we don't have a javascript: url, just for good measure.
+		if(xipClientUrl.split(&quot;:&quot;)[0].match(/javascript/i)){
+			throw &quot;Invalid client URL&quot;;
+		}
+		if(!xipStateId.match(/^XhrIframeProxy[0-9]+$/)){
+			throw &quot;Invalid state ID&quot;;
+		}
+
+		xipUseFrameRecursion = config[&quot;fr&quot;];
+
+		setInterval(pollHash, 10);
+		
+		if(xipUseFrameRecursion == &quot;true&quot;){
+			var serverUrl = window.location.href.split(&quot;#&quot;)[0];
+			document.getElementById(&quot;iframeHolder&quot;).innerHTML = '&lt;iframe name=&quot;'
+				+ xipStateId + '_clientEndPoint'
+				+ '&quot; src=&quot;javascript:false&quot;&gt;'
+				+ '&lt;/iframe&gt;';
+			var iframeNode = document.getElementsByTagName(&quot;iframe&quot;)[0];
+			iframeNode.src = makeClientUrl(&quot;init&quot;, 'id=' + xipStateId + '&amp;server='
+				+ encodeURIComponent(serverUrl) + '&amp;fr=endpoint');
+		}else{
+			setClientUrl(&quot;loaded&quot;);
+		}
+	}
+
+	if(typeof(window.addEventListener) == &quot;undefined&quot;){
+		window.attachEvent(&quot;onload&quot;, onServerLoad);
+	}else{
+		window.addEventListener('load', onServerLoad, false);
+	}
+	// --&gt;
+	&lt;/script&gt;
+&lt;/head&gt;
+&lt;body&gt;
+	&lt;h4&gt;The Dojo Toolkit -- xip_server.html&lt;/h4&gt;
+
+	&lt;p&gt;This file is used for Dojo's XMLHttpRequest Iframe Proxy. This is the the file
+	that should go on the server that will actually be doing the XHR request.&lt;/p&gt;
+	&lt;div id=&quot;iframeHolder&quot;&gt;&lt;/div&gt;
+&lt;/body&gt;
+&lt;/html&gt;

Added: tags/parley-0.55/root/static/magic/src/io.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/io.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/io.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.io&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.deprecated(&quot;dojo.io&quot;, &quot;replaced by dojo.io.*&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/json.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/json.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/json.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,98 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.require(&quot;dojo.AdapterRegistry&quot;);
+dojo.json = {jsonRegistry:new dojo.AdapterRegistry(), register:function (name, check, wrap, override) {
+	dojo.json.jsonRegistry.register(name, check, wrap, override);
+}, evalJson:function (json) {
+	try {
+		return eval(&quot;(&quot; + json + &quot;)&quot;);
+	}
+	catch (e) {
+		dojo.debug(e);
+		return json;
+	}
+}, serialize:function (o) {
+	var objtype = typeof (o);
+	if (objtype == &quot;undefined&quot;) {
+		return &quot;undefined&quot;;
+	} else {
+		if ((objtype == &quot;number&quot;) || (objtype == &quot;boolean&quot;)) {
+			return o + &quot;&quot;;
+		} else {
+			if (o === null) {
+				return &quot;null&quot;;
+			}
+		}
+	}
+	if (objtype == &quot;string&quot;) {
+		return dojo.string.escapeString(o);
+	}
+	var me = arguments.callee;
+	var newObj;
+	if (typeof (o.__json__) == &quot;function&quot;) {
+		newObj = o.__json__();
+		if (o !== newObj) {
+			return me(newObj);
+		}
+	}
+	if (typeof (o.json) == &quot;function&quot;) {
+		newObj = o.json();
+		if (o !== newObj) {
+			return me(newObj);
+		}
+	}
+	if (objtype != &quot;function&quot; &amp;&amp; typeof (o.length) == &quot;number&quot;) {
+		var res = [];
+		for (var i = 0; i &lt; o.length; i++) {
+			var val = me(o[i]);
+			if (typeof (val) != &quot;string&quot;) {
+				val = &quot;undefined&quot;;
+			}
+			res.push(val);
+		}
+		return &quot;[&quot; + res.join(&quot;,&quot;) + &quot;]&quot;;
+	}
+	try {
+		window.o = o;
+		newObj = dojo.json.jsonRegistry.match(o);
+		return me(newObj);
+	}
+	catch (e) {
+	}
+	if (objtype == &quot;function&quot;) {
+		return null;
+	}
+	res = [];
+	for (var k in o) {
+		var useKey;
+		if (typeof (k) == &quot;number&quot;) {
+			useKey = &quot;\&quot;&quot; + k + &quot;\&quot;&quot;;
+		} else {
+			if (typeof (k) == &quot;string&quot;) {
+				useKey = dojo.string.escapeString(k);
+			} else {
+				continue;
+			}
+		}
+		val = me(o[k]);
+		if (typeof (val) != &quot;string&quot;) {
+			continue;
+		}
+		res.push(useKey + &quot;:&quot; + val);
+	}
+	return &quot;{&quot; + res.join(&quot;,&quot;) + &quot;}&quot;;
+}};
+

Added: tags/parley-0.55/root/static/magic/src/lang/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.lang.common&quot;, &quot;dojo.lang.assert&quot;, &quot;dojo.lang.array&quot;, &quot;dojo.lang.type&quot;, &quot;dojo.lang.func&quot;, &quot;dojo.lang.extras&quot;, &quot;dojo.lang.repr&quot;, &quot;dojo.lang.declare&quot;]});
+dojo.provide(&quot;dojo.lang.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/lang/array.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/array.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/array.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,176 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.lang.mixin(dojo.lang, {has:function (obj, name) {
+	try {
+		return typeof obj[name] != &quot;undefined&quot;;
+	}
+	catch (e) {
+		return false;
+	}
+}, isEmpty:function (obj) {
+	if (dojo.lang.isObject(obj)) {
+		var tmp = {};
+		var count = 0;
+		for (var x in obj) {
+			if (obj[x] &amp;&amp; (!tmp[x])) {
+				count++;
+				break;
+			}
+		}
+		return count == 0;
+	} else {
+		if (dojo.lang.isArrayLike(obj) || dojo.lang.isString(obj)) {
+			return obj.length == 0;
+		}
+	}
+}, map:function (arr, obj, unary_func) {
+	var isString = dojo.lang.isString(arr);
+	if (isString) {
+		arr = arr.split(&quot;&quot;);
+	}
+	if (dojo.lang.isFunction(obj) &amp;&amp; (!unary_func)) {
+		unary_func = obj;
+		obj = dj_global;
+	} else {
+		if (dojo.lang.isFunction(obj) &amp;&amp; unary_func) {
+			var tmpObj = obj;
+			obj = unary_func;
+			unary_func = tmpObj;
+		}
+	}
+	if (Array.map) {
+		var outArr = Array.map(arr, unary_func, obj);
+	} else {
+		var outArr = [];
+		for (var i = 0; i &lt; arr.length; ++i) {
+			outArr.push(unary_func.call(obj, arr[i]));
+		}
+	}
+	if (isString) {
+		return outArr.join(&quot;&quot;);
+	} else {
+		return outArr;
+	}
+}, reduce:function (arr, initialValue, obj, binary_func) {
+	var reducedValue = initialValue;
+	if (arguments.length == 2) {
+		binary_func = initialValue;
+		reducedValue = arr[0];
+		arr = arr.slice(1);
+	} else {
+		if (arguments.length == 3) {
+			if (dojo.lang.isFunction(obj)) {
+				binary_func = obj;
+				obj = null;
+			}
+		} else {
+			if (dojo.lang.isFunction(obj)) {
+				var tmp = binary_func;
+				binary_func = obj;
+				obj = tmp;
+			}
+		}
+	}
+	var ob = obj || dj_global;
+	dojo.lang.map(arr, function (val) {
+		reducedValue = binary_func.call(ob, reducedValue, val);
+	});
+	return reducedValue;
+}, forEach:function (anArray, callback, thisObject) {
+	if (dojo.lang.isString(anArray)) {
+		anArray = anArray.split(&quot;&quot;);
+	}
+	if (Array.forEach) {
+		Array.forEach(anArray, callback, thisObject);
+	} else {
+		if (!thisObject) {
+			thisObject = dj_global;
+		}
+		for (var i = 0, l = anArray.length; i &lt; l; i++) {
+			callback.call(thisObject, anArray[i], i, anArray);
+		}
+	}
+}, _everyOrSome:function (every, arr, callback, thisObject) {
+	if (dojo.lang.isString(arr)) {
+		arr = arr.split(&quot;&quot;);
+	}
+	if (Array.every) {
+		return Array[every ? &quot;every&quot; : &quot;some&quot;](arr, callback, thisObject);
+	} else {
+		if (!thisObject) {
+			thisObject = dj_global;
+		}
+		for (var i = 0, l = arr.length; i &lt; l; i++) {
+			var result = callback.call(thisObject, arr[i], i, arr);
+			if (every &amp;&amp; !result) {
+				return false;
+			} else {
+				if ((!every) &amp;&amp; (result)) {
+					return true;
+				}
+			}
+		}
+		return Boolean(every);
+	}
+}, every:function (arr, callback, thisObject) {
+	return this._everyOrSome(true, arr, callback, thisObject);
+}, some:function (arr, callback, thisObject) {
+	return this._everyOrSome(false, arr, callback, thisObject);
+}, filter:function (arr, callback, thisObject) {
+	var isString = dojo.lang.isString(arr);
+	if (isString) {
+		arr = arr.split(&quot;&quot;);
+	}
+	var outArr;
+	if (Array.filter) {
+		outArr = Array.filter(arr, callback, thisObject);
+	} else {
+		if (!thisObject) {
+			if (arguments.length &gt;= 3) {
+				dojo.raise(&quot;thisObject doesn't exist!&quot;);
+			}
+			thisObject = dj_global;
+		}
+		outArr = [];
+		for (var i = 0; i &lt; arr.length; i++) {
+			if (callback.call(thisObject, arr[i], i, arr)) {
+				outArr.push(arr[i]);
+			}
+		}
+	}
+	if (isString) {
+		return outArr.join(&quot;&quot;);
+	} else {
+		return outArr;
+	}
+}, unnest:function () {
+	var out = [];
+	for (var i = 0; i &lt; arguments.length; i++) {
+		if (dojo.lang.isArrayLike(arguments[i])) {
+			var add = dojo.lang.unnest.apply(this, arguments[i]);
+			out = out.concat(add);
+		} else {
+			out.push(arguments[i]);
+		}
+	}
+	return out;
+}, toArray:function (arrayLike, startOffset) {
+	var array = [];
+	for (var i = startOffset || 0; i &lt; arrayLike.length; i++) {
+		array.push(arrayLike[i]);
+	}
+	return array;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/lang/assert.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/assert.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/assert.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,59 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.assert&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.type&quot;);
+dojo.lang.assert = function (booleanValue, message) {
+	if (!booleanValue) {
+		var errorMessage = &quot;An assert statement failed.\n&quot; + &quot;The method dojo.lang.assert() was called with a 'false' value.\n&quot;;
+		if (message) {
+			errorMessage += &quot;Here's the assert message:\n&quot; + message + &quot;\n&quot;;
+		}
+		throw new Error(errorMessage);
+	}
+};
+dojo.lang.assertType = function (value, type, keywordParameters) {
+	if (dojo.lang.isString(keywordParameters)) {
+		dojo.deprecated(&quot;dojo.lang.assertType(value, type, \&quot;message\&quot;)&quot;, &quot;use dojo.lang.assertType(value, type) instead&quot;, &quot;0.5&quot;);
+	}
+	if (!dojo.lang.isOfType(value, type, keywordParameters)) {
+		if (!dojo.lang.assertType._errorMessage) {
+			dojo.lang.assertType._errorMessage = &quot;Type mismatch: dojo.lang.assertType() failed.&quot;;
+		}
+		dojo.lang.assert(false, dojo.lang.assertType._errorMessage);
+	}
+};
+dojo.lang.assertValidKeywords = function (object, expectedProperties, message) {
+	var key;
+	if (!message) {
+		if (!dojo.lang.assertValidKeywords._errorMessage) {
+			dojo.lang.assertValidKeywords._errorMessage = &quot;In dojo.lang.assertValidKeywords(), found invalid keyword:&quot;;
+		}
+		message = dojo.lang.assertValidKeywords._errorMessage;
+	}
+	if (dojo.lang.isArray(expectedProperties)) {
+		for (key in object) {
+			if (!dojo.lang.inArray(expectedProperties, key)) {
+				dojo.lang.assert(false, message + &quot; &quot; + key);
+			}
+		}
+	} else {
+		for (key in object) {
+			if (!(key in expectedProperties)) {
+				dojo.lang.assert(false, message + &quot; &quot; + key);
+			}
+		}
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/lang/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,156 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.common&quot;);
+dojo.lang.inherits = function (subclass, superclass) {
+	if (!dojo.lang.isFunction(superclass)) {
+		dojo.raise(&quot;dojo.inherits: superclass argument [&quot; + superclass + &quot;] must be a function (subclass: [&quot; + subclass + &quot;']&quot;);
+	}
+	subclass.prototype = new superclass();
+	subclass.prototype.constructor = subclass;
+	subclass.superclass = superclass.prototype;
+	subclass[&quot;super&quot;] = superclass.prototype;
+};
+dojo.lang._mixin = function (obj, props) {
+	var tobj = {};
+	for (var x in props) {
+		if ((typeof tobj[x] == &quot;undefined&quot;) || (tobj[x] != props[x])) {
+			obj[x] = props[x];
+		}
+	}
+	if (dojo.render.html.ie &amp;&amp; (typeof (props[&quot;toString&quot;]) == &quot;function&quot;) &amp;&amp; (props[&quot;toString&quot;] != obj[&quot;toString&quot;]) &amp;&amp; (props[&quot;toString&quot;] != tobj[&quot;toString&quot;])) {
+		obj.toString = props.toString;
+	}
+	return obj;
+};
+dojo.lang.mixin = function (obj, props) {
+	for (var i = 1, l = arguments.length; i &lt; l; i++) {
+		dojo.lang._mixin(obj, arguments[i]);
+	}
+	return obj;
+};
+dojo.lang.extend = function (constructor, props) {
+	for (var i = 1, l = arguments.length; i &lt; l; i++) {
+		dojo.lang._mixin(constructor.prototype, arguments[i]);
+	}
+	return constructor;
+};
+dojo.inherits = dojo.lang.inherits;
+dojo.mixin = dojo.lang.mixin;
+dojo.extend = dojo.lang.extend;
+dojo.lang.find = function (array, value, identity, findLast) {
+	if (!dojo.lang.isArrayLike(array) &amp;&amp; dojo.lang.isArrayLike(value)) {
+		dojo.deprecated(&quot;dojo.lang.find(value, array)&quot;, &quot;use dojo.lang.find(array, value) instead&quot;, &quot;0.5&quot;);
+		var temp = array;
+		array = value;
+		value = temp;
+	}
+	var isString = dojo.lang.isString(array);
+	if (isString) {
+		array = array.split(&quot;&quot;);
+	}
+	if (findLast) {
+		var step = -1;
+		var i = array.length - 1;
+		var end = -1;
+	} else {
+		var step = 1;
+		var i = 0;
+		var end = array.length;
+	}
+	if (identity) {
+		while (i != end) {
+			if (array[i] === value) {
+				return i;
+			}
+			i += step;
+		}
+	} else {
+		while (i != end) {
+			if (array[i] == value) {
+				return i;
+			}
+			i += step;
+		}
+	}
+	return -1;
+};
+dojo.lang.indexOf = dojo.lang.find;
+dojo.lang.findLast = function (array, value, identity) {
+	return dojo.lang.find(array, value, identity, true);
+};
+dojo.lang.lastIndexOf = dojo.lang.findLast;
+dojo.lang.inArray = function (array, value) {
+	return dojo.lang.find(array, value) &gt; -1;
+};
+dojo.lang.isObject = function (it) {
+	if (typeof it == &quot;undefined&quot;) {
+		return false;
+	}
+	return (typeof it == &quot;object&quot; || it === null || dojo.lang.isArray(it) || dojo.lang.isFunction(it));
+};
+dojo.lang.isArray = function (it) {
+	return (it &amp;&amp; it instanceof Array || typeof it == &quot;array&quot;);
+};
+dojo.lang.isArrayLike = function (it) {
+	if ((!it) || (dojo.lang.isUndefined(it))) {
+		return false;
+	}
+	if (dojo.lang.isString(it)) {
+		return false;
+	}
+	if (dojo.lang.isFunction(it)) {
+		return false;
+	}
+	if (dojo.lang.isArray(it)) {
+		return true;
+	}
+	if ((it.tagName) &amp;&amp; (it.tagName.toLowerCase() == &quot;form&quot;)) {
+		return false;
+	}
+	if (dojo.lang.isNumber(it.length) &amp;&amp; isFinite(it.length)) {
+		return true;
+	}
+	return false;
+};
+dojo.lang.isFunction = function (it) {
+	return (it instanceof Function || typeof it == &quot;function&quot;);
+};
+(function () {
+	if ((dojo.render.html.capable) &amp;&amp; (dojo.render.html[&quot;safari&quot;])) {
+		dojo.lang.isFunction = function (it) {
+			if ((typeof (it) == &quot;function&quot;) &amp;&amp; (it == &quot;[object NodeList]&quot;)) {
+				return false;
+			}
+			return (it instanceof Function || typeof it == &quot;function&quot;);
+		};
+	}
+})();
+dojo.lang.isString = function (it) {
+	return (typeof it == &quot;string&quot; || it instanceof String);
+};
+dojo.lang.isAlien = function (it) {
+	if (!it) {
+		return false;
+	}
+	return !dojo.lang.isFunction(it) &amp;&amp; /\{\s*\[native code\]\s*\}/.test(String(it));
+};
+dojo.lang.isBoolean = function (it) {
+	return (it instanceof Boolean || typeof it == &quot;boolean&quot;);
+};
+dojo.lang.isNumber = function (it) {
+	return (it instanceof Number || typeof it == &quot;number&quot;);
+};
+dojo.lang.isUndefined = function (it) {
+	return ((typeof (it) == &quot;undefined&quot;) &amp;&amp; (it == undefined));
+};
+

Added: tags/parley-0.55/root/static/magic/src/lang/declare.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/declare.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/declare.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,109 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.lang.declare = function (className, superclass, init, props) {
+	if ((dojo.lang.isFunction(props)) || ((!props) &amp;&amp; (!dojo.lang.isFunction(init)))) {
+		var temp = props;
+		props = init;
+		init = temp;
+	}
+	var mixins = [];
+	if (dojo.lang.isArray(superclass)) {
+		mixins = superclass;
+		superclass = mixins.shift();
+	}
+	if (!init) {
+		init = dojo.evalObjPath(className, false);
+		if ((init) &amp;&amp; (!dojo.lang.isFunction(init))) {
+			init = null;
+		}
+	}
+	var ctor = dojo.lang.declare._makeConstructor();
+	var scp = (superclass ? superclass.prototype : null);
+	if (scp) {
+		scp.prototyping = true;
+		ctor.prototype = new superclass();
+		scp.prototyping = false;
+	}
+	ctor.superclass = scp;
+	ctor.mixins = mixins;
+	for (var i = 0, l = mixins.length; i &lt; l; i++) {
+		dojo.lang.extend(ctor, mixins[i].prototype);
+	}
+	ctor.prototype.initializer = null;
+	ctor.prototype.declaredClass = className;
+	if (dojo.lang.isArray(props)) {
+		dojo.lang.extend.apply(dojo.lang, [ctor].concat(props));
+	} else {
+		dojo.lang.extend(ctor, (props) || {});
+	}
+	dojo.lang.extend(ctor, dojo.lang.declare._common);
+	ctor.prototype.constructor = ctor;
+	ctor.prototype.initializer = (ctor.prototype.initializer) || (init) || (function () {
+	});
+	var created = dojo.parseObjPath(className, null, true);
+	created.obj[created.prop] = ctor;
+	return ctor;
+};
+dojo.lang.declare._makeConstructor = function () {
+	return function () {
+		var self = this._getPropContext();
+		var s = self.constructor.superclass;
+		if ((s) &amp;&amp; (s.constructor)) {
+			if (s.constructor == arguments.callee) {
+				this._inherited(&quot;constructor&quot;, arguments);
+			} else {
+				this._contextMethod(s, &quot;constructor&quot;, arguments);
+			}
+		}
+		var ms = (self.constructor.mixins) || ([]);
+		for (var i = 0, m; (m = ms[i]); i++) {
+			(((m.prototype) &amp;&amp; (m.prototype.initializer)) || (m)).apply(this, arguments);
+		}
+		if ((!this.prototyping) &amp;&amp; (self.initializer)) {
+			self.initializer.apply(this, arguments);
+		}
+	};
+};
+dojo.lang.declare._common = {_getPropContext:function () {
+	return (this.___proto || this);
+}, _contextMethod:function (ptype, method, args) {
+	var result, stack = this.___proto;
+	this.___proto = ptype;
+	try {
+		result = ptype[method].apply(this, (args || []));
+	}
+	catch (e) {
+		throw e;
+	}
+	finally {
+		this.___proto = stack;
+	}
+	return result;
+}, _inherited:function (prop, args) {
+	var p = this._getPropContext();
+	do {
+		if ((!p.constructor) || (!p.constructor.superclass)) {
+			return;
+		}
+		p = p.constructor.superclass;
+	} while (!(prop in p));
+	return (dojo.lang.isFunction(p[prop]) ? this._contextMethod(p, prop, args) : p[prop]);
+}, inherited:function (prop, args) {
+	dojo.deprecated(&quot;'inherited' method is dangerous, do not up-call! 'inherited' is slated for removal in 0.5; name your super class (or use superclass property) instead.&quot;, &quot;0.5&quot;);
+	this._inherited(prop, args);
+}};
+dojo.declare = dojo.lang.declare;
+

Added: tags/parley-0.55/root/static/magic/src/lang/extras.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/extras.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/extras.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,96 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.lang.setTimeout = function (func, delay) {
+	var context = window, argsStart = 2;
+	if (!dojo.lang.isFunction(func)) {
+		context = func;
+		func = delay;
+		delay = arguments[2];
+		argsStart++;
+	}
+	if (dojo.lang.isString(func)) {
+		func = context[func];
+	}
+	var args = [];
+	for (var i = argsStart; i &lt; arguments.length; i++) {
+		args.push(arguments[i]);
+	}
+	return dojo.global().setTimeout(function () {
+		func.apply(context, args);
+	}, delay);
+};
+dojo.lang.clearTimeout = function (timer) {
+	dojo.global().clearTimeout(timer);
+};
+dojo.lang.getNameInObj = function (ns, item) {
+	if (!ns) {
+		ns = dj_global;
+	}
+	for (var x in ns) {
+		if (ns[x] === item) {
+			return new String(x);
+		}
+	}
+	return null;
+};
+dojo.lang.shallowCopy = function (obj, deep) {
+	var i, ret;
+	if (obj === null) {
+		return null;
+	}
+	if (dojo.lang.isObject(obj)) {
+		ret = new obj.constructor();
+		for (i in obj) {
+			if (dojo.lang.isUndefined(ret[i])) {
+				ret[i] = deep ? dojo.lang.shallowCopy(obj[i], deep) : obj[i];
+			}
+		}
+	} else {
+		if (dojo.lang.isArray(obj)) {
+			ret = [];
+			for (i = 0; i &lt; obj.length; i++) {
+				ret[i] = deep ? dojo.lang.shallowCopy(obj[i], deep) : obj[i];
+			}
+		} else {
+			ret = obj;
+		}
+	}
+	return ret;
+};
+dojo.lang.firstValued = function () {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		if (typeof arguments[i] != &quot;undefined&quot;) {
+			return arguments[i];
+		}
+	}
+	return undefined;
+};
+dojo.lang.getObjPathValue = function (objpath, context, create) {
+	with (dojo.parseObjPath(objpath, context, create)) {
+		return dojo.evalProp(prop, obj, create);
+	}
+};
+dojo.lang.setObjPathValue = function (objpath, value, context, create) {
+	dojo.deprecated(&quot;dojo.lang.setObjPathValue&quot;, &quot;use dojo.parseObjPath and the '=' operator&quot;, &quot;0.6&quot;);
+	if (arguments.length &lt; 4) {
+		create = true;
+	}
+	with (dojo.parseObjPath(objpath, context, create)) {
+		if (obj &amp;&amp; (create || (prop in obj))) {
+			obj[prop] = value;
+		}
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/lang/func.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/func.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/func.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,135 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.lang.hitch = function (thisObject, method) {
+	var args = [];
+	for (var x = 2; x &lt; arguments.length; x++) {
+		args.push(arguments[x]);
+	}
+	var fcn = (dojo.lang.isString(method) ? thisObject[method] : method) || function () {
+	};
+	return function () {
+		var ta = args.concat([]);
+		for (var x = 0; x &lt; arguments.length; x++) {
+			ta.push(arguments[x]);
+		}
+		return fcn.apply(thisObject, ta);
+	};
+};
+dojo.lang.anonCtr = 0;
+dojo.lang.anon = {};
+dojo.lang.nameAnonFunc = function (anonFuncPtr, thisObj, searchForNames) {
+	var nso = (thisObj || dojo.lang.anon);
+	if ((searchForNames) || ((dj_global[&quot;djConfig&quot;]) &amp;&amp; (djConfig[&quot;slowAnonFuncLookups&quot;] == true))) {
+		for (var x in nso) {
+			try {
+				if (nso[x] === anonFuncPtr) {
+					return x;
+				}
+			}
+			catch (e) {
+			}
+		}
+	}
+	var ret = &quot;__&quot; + dojo.lang.anonCtr++;
+	while (typeof nso[ret] != &quot;undefined&quot;) {
+		ret = &quot;__&quot; + dojo.lang.anonCtr++;
+	}
+	nso[ret] = anonFuncPtr;
+	return ret;
+};
+dojo.lang.forward = function (funcName) {
+	return function () {
+		return this[funcName].apply(this, arguments);
+	};
+};
+dojo.lang.curry = function (thisObj, func) {
+	var outerArgs = [];
+	thisObj = thisObj || dj_global;
+	if (dojo.lang.isString(func)) {
+		func = thisObj[func];
+	}
+	for (var x = 2; x &lt; arguments.length; x++) {
+		outerArgs.push(arguments[x]);
+	}
+	var ecount = (func[&quot;__preJoinArity&quot;] || func.length) - outerArgs.length;
+	function gather(nextArgs, innerArgs, expected) {
+		var texpected = expected;
+		var totalArgs = innerArgs.slice(0);
+		for (var x = 0; x &lt; nextArgs.length; x++) {
+			totalArgs.push(nextArgs[x]);
+		}
+		expected = expected - nextArgs.length;
+		if (expected &lt;= 0) {
+			var res = func.apply(thisObj, totalArgs);
+			expected = texpected;
+			return res;
+		} else {
+			return function () {
+				return gather(arguments, totalArgs, expected);
+			};
+		}
+	}
+	return gather([], outerArgs, ecount);
+};
+dojo.lang.curryArguments = function (thisObj, func, args, offset) {
+	var targs = [];
+	var x = offset || 0;
+	for (x = offset; x &lt; args.length; x++) {
+		targs.push(args[x]);
+	}
+	return dojo.lang.curry.apply(dojo.lang, [thisObj, func].concat(targs));
+};
+dojo.lang.tryThese = function () {
+	for (var x = 0; x &lt; arguments.length; x++) {
+		try {
+			if (typeof arguments[x] == &quot;function&quot;) {
+				var ret = (arguments[x]());
+				if (ret) {
+					return ret;
+				}
+			}
+		}
+		catch (e) {
+			dojo.debug(e);
+		}
+	}
+};
+dojo.lang.delayThese = function (farr, cb, delay, onend) {
+	if (!farr.length) {
+		if (typeof onend == &quot;function&quot;) {
+			onend();
+		}
+		return;
+	}
+	if ((typeof delay == &quot;undefined&quot;) &amp;&amp; (typeof cb == &quot;number&quot;)) {
+		delay = cb;
+		cb = function () {
+		};
+	} else {
+		if (!cb) {
+			cb = function () {
+			};
+			if (!delay) {
+				delay = 0;
+			}
+		}
+	}
+	setTimeout(function () {
+		(farr.shift())();
+		cb();
+		dojo.lang.delayThese(farr, cb, delay, onend);
+	}, delay);
+};
+

Added: tags/parley-0.55/root/static/magic/src/lang/repr.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/repr.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/repr.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,68 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.repr&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.AdapterRegistry&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.lang.reprRegistry = new dojo.AdapterRegistry();
+dojo.lang.registerRepr = function (name, check, wrap, override) {
+	dojo.lang.reprRegistry.register(name, check, wrap, override);
+};
+dojo.lang.repr = function (obj) {
+	if (typeof (obj) == &quot;undefined&quot;) {
+		return &quot;undefined&quot;;
+	} else {
+		if (obj === null) {
+			return &quot;null&quot;;
+		}
+	}
+	try {
+		if (typeof (obj[&quot;__repr__&quot;]) == &quot;function&quot;) {
+			return obj[&quot;__repr__&quot;]();
+		} else {
+			if ((typeof (obj[&quot;repr&quot;]) == &quot;function&quot;) &amp;&amp; (obj.repr != arguments.callee)) {
+				return obj[&quot;repr&quot;]();
+			}
+		}
+		return dojo.lang.reprRegistry.match(obj);
+	}
+	catch (e) {
+		if (typeof (obj.NAME) == &quot;string&quot; &amp;&amp; (obj.toString == Function.prototype.toString || obj.toString == Object.prototype.toString)) {
+			return obj.NAME;
+		}
+	}
+	if (typeof (obj) == &quot;function&quot;) {
+		obj = (obj + &quot;&quot;).replace(/^\s+/, &quot;&quot;);
+		var idx = obj.indexOf(&quot;{&quot;);
+		if (idx != -1) {
+			obj = obj.substr(0, idx) + &quot;{...}&quot;;
+		}
+	}
+	return obj + &quot;&quot;;
+};
+dojo.lang.reprArrayLike = function (arr) {
+	try {
+		var na = dojo.lang.map(arr, dojo.lang.repr);
+		return &quot;[&quot; + na.join(&quot;, &quot;) + &quot;]&quot;;
+	}
+	catch (e) {
+	}
+};
+(function () {
+	var m = dojo.lang;
+	m.registerRepr(&quot;arrayLike&quot;, m.isArrayLike, m.reprArrayLike);
+	m.registerRepr(&quot;string&quot;, m.isString, m.reprString);
+	m.registerRepr(&quot;numbers&quot;, m.isNumber, m.reprNumber);
+	m.registerRepr(&quot;boolean&quot;, m.isBoolean, m.reprNumber);
+})();
+

Added: tags/parley-0.55/root/static/magic/src/lang/timing/Streamer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/timing/Streamer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/timing/Streamer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,67 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.timing.Streamer&quot;);
+dojo.require(&quot;dojo.lang.timing.Timer&quot;);
+dojo.lang.timing.Streamer = function (input, output, interval, minimum, initialData) {
+	var self = this;
+	var queue = [];
+	this.interval = interval || 1000;
+	this.minimumSize = minimum || 10;
+	this.inputFunction = input || function (q) {
+	};
+	this.outputFunction = output || function (point) {
+	};
+	var timer = new dojo.lang.timing.Timer(this.interval);
+	var tick = function () {
+		self.onTick(self);
+		if (queue.length &lt; self.minimumSize) {
+			self.inputFunction(queue);
+		}
+		var obj = queue.shift();
+		while (typeof (obj) == &quot;undefined&quot; &amp;&amp; queue.length &gt; 0) {
+			obj = queue.shift();
+		}
+		if (typeof (obj) == &quot;undefined&quot;) {
+			self.stop();
+			return;
+		}
+		self.outputFunction(obj);
+	};
+	this.setInterval = function (ms) {
+		this.interval = ms;
+		timer.setInterval(ms);
+	};
+	this.onTick = function (obj) {
+	};
+	this.start = function () {
+		if (typeof (this.inputFunction) == &quot;function&quot; &amp;&amp; typeof (this.outputFunction) == &quot;function&quot;) {
+			timer.start();
+			return;
+		}
+		dojo.raise(&quot;You cannot start a Streamer without an input and an output function.&quot;);
+	};
+	this.onStart = function () {
+	};
+	this.stop = function () {
+		timer.stop();
+	};
+	this.onStop = function () {
+	};
+	timer.onTick = this.tick;
+	timer.onStart = this.onStart;
+	timer.onStop = this.onStop;
+	if (initialData) {
+		queue.concat(initialData);
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/lang/timing/Timer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/timing/Timer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/timing/Timer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,44 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.timing.Timer&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.lang.timing.Timer = function (interval) {
+	this.timer = null;
+	this.isRunning = false;
+	this.interval = interval;
+	this.onStart = null;
+	this.onStop = null;
+};
+dojo.extend(dojo.lang.timing.Timer, {onTick:function () {
+}, setInterval:function (interval) {
+	if (this.isRunning) {
+		dj_global.clearInterval(this.timer);
+	}
+	this.interval = interval;
+	if (this.isRunning) {
+		this.timer = dj_global.setInterval(dojo.lang.hitch(this, &quot;onTick&quot;), this.interval);
+	}
+}, start:function () {
+	if (typeof this.onStart == &quot;function&quot;) {
+		this.onStart();
+	}
+	this.isRunning = true;
+	this.timer = dj_global.setInterval(dojo.lang.hitch(this, &quot;onTick&quot;), this.interval);
+}, stop:function () {
+	if (typeof this.onStop == &quot;function&quot;) {
+		this.onStop();
+	}
+	this.isRunning = false;
+	dj_global.clearInterval(this.timer);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/lang/timing/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/timing/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/timing/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,14 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.timing.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/lang/type.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang/type.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang/type.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,145 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang.type&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.lang.whatAmI = function (value) {
+	dojo.deprecated(&quot;dojo.lang.whatAmI&quot;, &quot;use dojo.lang.getType instead&quot;, &quot;0.5&quot;);
+	return dojo.lang.getType(value);
+};
+dojo.lang.whatAmI.custom = {};
+dojo.lang.getType = function (value) {
+	try {
+		if (dojo.lang.isArray(value)) {
+			return &quot;array&quot;;
+		}
+		if (dojo.lang.isFunction(value)) {
+			return &quot;function&quot;;
+		}
+		if (dojo.lang.isString(value)) {
+			return &quot;string&quot;;
+		}
+		if (dojo.lang.isNumber(value)) {
+			return &quot;number&quot;;
+		}
+		if (dojo.lang.isBoolean(value)) {
+			return &quot;boolean&quot;;
+		}
+		if (dojo.lang.isAlien(value)) {
+			return &quot;alien&quot;;
+		}
+		if (dojo.lang.isUndefined(value)) {
+			return &quot;undefined&quot;;
+		}
+		for (var name in dojo.lang.whatAmI.custom) {
+			if (dojo.lang.whatAmI.custom[name](value)) {
+				return name;
+			}
+		}
+		if (dojo.lang.isObject(value)) {
+			return &quot;object&quot;;
+		}
+	}
+	catch (e) {
+	}
+	return &quot;unknown&quot;;
+};
+dojo.lang.isNumeric = function (value) {
+	return (!isNaN(value) &amp;&amp; isFinite(value) &amp;&amp; (value != null) &amp;&amp; !dojo.lang.isBoolean(value) &amp;&amp; !dojo.lang.isArray(value) &amp;&amp; !/^\s*$/.test(value));
+};
+dojo.lang.isBuiltIn = function (value) {
+	return (dojo.lang.isArray(value) || dojo.lang.isFunction(value) || dojo.lang.isString(value) || dojo.lang.isNumber(value) || dojo.lang.isBoolean(value) || (value == null) || (value instanceof Error) || (typeof value == &quot;error&quot;));
+};
+dojo.lang.isPureObject = function (value) {
+	return ((value != null) &amp;&amp; dojo.lang.isObject(value) &amp;&amp; value.constructor == Object);
+};
+dojo.lang.isOfType = function (value, type, keywordParameters) {
+	var optional = false;
+	if (keywordParameters) {
+		optional = keywordParameters[&quot;optional&quot;];
+	}
+	if (optional &amp;&amp; ((value === null) || dojo.lang.isUndefined(value))) {
+		return true;
+	}
+	if (dojo.lang.isArray(type)) {
+		var arrayOfTypes = type;
+		for (var i in arrayOfTypes) {
+			var aType = arrayOfTypes[i];
+			if (dojo.lang.isOfType(value, aType)) {
+				return true;
+			}
+		}
+		return false;
+	} else {
+		if (dojo.lang.isString(type)) {
+			type = type.toLowerCase();
+		}
+		switch (type) {
+		  case Array:
+		  case &quot;array&quot;:
+			return dojo.lang.isArray(value);
+		  case Function:
+		  case &quot;function&quot;:
+			return dojo.lang.isFunction(value);
+		  case String:
+		  case &quot;string&quot;:
+			return dojo.lang.isString(value);
+		  case Number:
+		  case &quot;number&quot;:
+			return dojo.lang.isNumber(value);
+		  case &quot;numeric&quot;:
+			return dojo.lang.isNumeric(value);
+		  case Boolean:
+		  case &quot;boolean&quot;:
+			return dojo.lang.isBoolean(value);
+		  case Object:
+		  case &quot;object&quot;:
+			return dojo.lang.isObject(value);
+		  case &quot;pureobject&quot;:
+			return dojo.lang.isPureObject(value);
+		  case &quot;builtin&quot;:
+			return dojo.lang.isBuiltIn(value);
+		  case &quot;alien&quot;:
+			return dojo.lang.isAlien(value);
+		  case &quot;undefined&quot;:
+			return dojo.lang.isUndefined(value);
+		  case null:
+		  case &quot;null&quot;:
+			return (value === null);
+		  case &quot;optional&quot;:
+			dojo.deprecated(&quot;dojo.lang.isOfType(value, [type, \&quot;optional\&quot;])&quot;, &quot;use dojo.lang.isOfType(value, type, {optional: true} ) instead&quot;, &quot;0.5&quot;);
+			return ((value === null) || dojo.lang.isUndefined(value));
+		  default:
+			if (dojo.lang.isFunction(type)) {
+				return (value instanceof type);
+			} else {
+				dojo.raise(&quot;dojo.lang.isOfType() was passed an invalid type&quot;);
+			}
+		}
+	}
+	dojo.raise(&quot;If we get here, it means a bug was introduced above.&quot;);
+};
+dojo.lang.getObject = function (str) {
+	var parts = str.split(&quot;.&quot;), i = 0, obj = dj_global;
+	do {
+		obj = obj[parts[i++]];
+	} while (i &lt; parts.length &amp;&amp; obj);
+	return (obj != dj_global) ? obj : null;
+};
+dojo.lang.doesObjectExist = function (str) {
+	var parts = str.split(&quot;.&quot;), i = 0, obj = dj_global;
+	do {
+		obj = obj[parts[i++]];
+	} while (i &lt; parts.length &amp;&amp; obj);
+	return (obj &amp;&amp; obj != dj_global);
+};
+

Added: tags/parley-0.55/root/static/magic/src/lang.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lang.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lang.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lang&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.deprecated(&quot;dojo.lang&quot;, &quot;replaced by dojo.lang.common&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/lfx/Animation.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/Animation.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/Animation.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,404 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lfx.Animation&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.lfx.Line = function (start, end) {
+	this.start = start;
+	this.end = end;
+	if (dojo.lang.isArray(start)) {
+		var diff = [];
+		dojo.lang.forEach(this.start, function (s, i) {
+			diff[i] = this.end[i] - s;
+		}, this);
+		this.getValue = function (n) {
+			var res = [];
+			dojo.lang.forEach(this.start, function (s, i) {
+				res[i] = (diff[i] * n) + s;
+			}, this);
+			return res;
+		};
+	} else {
+		var diff = end - start;
+		this.getValue = function (n) {
+			return (diff * n) + this.start;
+		};
+	}
+};
+if ((dojo.render.html.khtml) &amp;&amp; (!dojo.render.html.safari)) {
+	dojo.lfx.easeDefault = function (n) {
+		return (parseFloat(&quot;0.5&quot;) + ((Math.sin((n + parseFloat(&quot;1.5&quot;)) * Math.PI)) / 2));
+	};
+} else {
+	dojo.lfx.easeDefault = function (n) {
+		return (0.5 + ((Math.sin((n + 1.5) * Math.PI)) / 2));
+	};
+}
+dojo.lfx.easeIn = function (n) {
+	return Math.pow(n, 3);
+};
+dojo.lfx.easeOut = function (n) {
+	return (1 - Math.pow(1 - n, 3));
+};
+dojo.lfx.easeInOut = function (n) {
+	return ((3 * Math.pow(n, 2)) - (2 * Math.pow(n, 3)));
+};
+dojo.lfx.IAnimation = function () {
+};
+dojo.lang.extend(dojo.lfx.IAnimation, {curve:null, duration:1000, easing:null, repeatCount:0, rate:10, handler:null, beforeBegin:null, onBegin:null, onAnimate:null, onEnd:null, onPlay:null, onPause:null, onStop:null, play:null, pause:null, stop:null, connect:function (evt, scope, newFunc) {
+	if (!newFunc) {
+		newFunc = scope;
+		scope = this;
+	}
+	newFunc = dojo.lang.hitch(scope, newFunc);
+	var oldFunc = this[evt] || function () {
+	};
+	this[evt] = function () {
+		var ret = oldFunc.apply(this, arguments);
+		newFunc.apply(this, arguments);
+		return ret;
+	};
+	return this;
+}, fire:function (evt, args) {
+	if (this[evt]) {
+		this[evt].apply(this, (args || []));
+	}
+	return this;
+}, repeat:function (count) {
+	this.repeatCount = count;
+	return this;
+}, _active:false, _paused:false});
+dojo.lfx.Animation = function (handlers, duration, curve, easing, repeatCount, rate) {
+	dojo.lfx.IAnimation.call(this);
+	if (dojo.lang.isNumber(handlers) || (!handlers &amp;&amp; duration.getValue)) {
+		rate = repeatCount;
+		repeatCount = easing;
+		easing = curve;
+		curve = duration;
+		duration = handlers;
+		handlers = null;
+	} else {
+		if (handlers.getValue || dojo.lang.isArray(handlers)) {
+			rate = easing;
+			repeatCount = curve;
+			easing = duration;
+			curve = handlers;
+			duration = null;
+			handlers = null;
+		}
+	}
+	if (dojo.lang.isArray(curve)) {
+		this.curve = new dojo.lfx.Line(curve[0], curve[1]);
+	} else {
+		this.curve = curve;
+	}
+	if (duration != null &amp;&amp; duration &gt; 0) {
+		this.duration = duration;
+	}
+	if (repeatCount) {
+		this.repeatCount = repeatCount;
+	}
+	if (rate) {
+		this.rate = rate;
+	}
+	if (handlers) {
+		dojo.lang.forEach([&quot;handler&quot;, &quot;beforeBegin&quot;, &quot;onBegin&quot;, &quot;onEnd&quot;, &quot;onPlay&quot;, &quot;onStop&quot;, &quot;onAnimate&quot;], function (item) {
+			if (handlers[item]) {
+				this.connect(item, handlers[item]);
+			}
+		}, this);
+	}
+	if (easing &amp;&amp; dojo.lang.isFunction(easing)) {
+		this.easing = easing;
+	}
+};
+dojo.inherits(dojo.lfx.Animation, dojo.lfx.IAnimation);
+dojo.lang.extend(dojo.lfx.Animation, {_startTime:null, _endTime:null, _timer:null, _percent:0, _startRepeatCount:0, play:function (delay, gotoStart) {
+	if (gotoStart) {
+		clearTimeout(this._timer);
+		this._active = false;
+		this._paused = false;
+		this._percent = 0;
+	} else {
+		if (this._active &amp;&amp; !this._paused) {
+			return this;
+		}
+	}
+	this.fire(&quot;handler&quot;, [&quot;beforeBegin&quot;]);
+	this.fire(&quot;beforeBegin&quot;);
+	if (delay &gt; 0) {
+		setTimeout(dojo.lang.hitch(this, function () {
+			this.play(null, gotoStart);
+		}), delay);
+		return this;
+	}
+	this._startTime = new Date().valueOf();
+	if (this._paused) {
+		this._startTime -= (this.duration * this._percent / 100);
+	}
+	this._endTime = this._startTime + this.duration;
+	this._active = true;
+	this._paused = false;
+	var step = this._percent / 100;
+	var value = this.curve.getValue(step);
+	if (this._percent == 0) {
+		if (!this._startRepeatCount) {
+			this._startRepeatCount = this.repeatCount;
+		}
+		this.fire(&quot;handler&quot;, [&quot;begin&quot;, value]);
+		this.fire(&quot;onBegin&quot;, [value]);
+	}
+	this.fire(&quot;handler&quot;, [&quot;play&quot;, value]);
+	this.fire(&quot;onPlay&quot;, [value]);
+	this._cycle();
+	return this;
+}, pause:function () {
+	clearTimeout(this._timer);
+	if (!this._active) {
+		return this;
+	}
+	this._paused = true;
+	var value = this.curve.getValue(this._percent / 100);
+	this.fire(&quot;handler&quot;, [&quot;pause&quot;, value]);
+	this.fire(&quot;onPause&quot;, [value]);
+	return this;
+}, gotoPercent:function (pct, andPlay) {
+	clearTimeout(this._timer);
+	this._active = true;
+	this._paused = true;
+	this._percent = pct;
+	if (andPlay) {
+		this.play();
+	}
+	return this;
+}, stop:function (gotoEnd) {
+	clearTimeout(this._timer);
+	var step = this._percent / 100;
+	if (gotoEnd) {
+		step = 1;
+	}
+	var value = this.curve.getValue(step);
+	this.fire(&quot;handler&quot;, [&quot;stop&quot;, value]);
+	this.fire(&quot;onStop&quot;, [value]);
+	this._active = false;
+	this._paused = false;
+	return this;
+}, status:function () {
+	if (this._active) {
+		return this._paused ? &quot;paused&quot; : &quot;playing&quot;;
+	} else {
+		return &quot;stopped&quot;;
+	}
+	return this;
+}, _cycle:function () {
+	clearTimeout(this._timer);
+	if (this._active) {
+		var curr = new Date().valueOf();
+		var step = (curr - this._startTime) / (this._endTime - this._startTime);
+		if (step &gt;= 1) {
+			step = 1;
+			this._percent = 100;
+		} else {
+			this._percent = step * 100;
+		}
+		if ((this.easing) &amp;&amp; (dojo.lang.isFunction(this.easing))) {
+			step = this.easing(step);
+		}
+		var value = this.curve.getValue(step);
+		this.fire(&quot;handler&quot;, [&quot;animate&quot;, value]);
+		this.fire(&quot;onAnimate&quot;, [value]);
+		if (step &lt; 1) {
+			this._timer = setTimeout(dojo.lang.hitch(this, &quot;_cycle&quot;), this.rate);
+		} else {
+			this._active = false;
+			this.fire(&quot;handler&quot;, [&quot;end&quot;]);
+			this.fire(&quot;onEnd&quot;);
+			if (this.repeatCount &gt; 0) {
+				this.repeatCount--;
+				this.play(null, true);
+			} else {
+				if (this.repeatCount == -1) {
+					this.play(null, true);
+				} else {
+					if (this._startRepeatCount) {
+						this.repeatCount = this._startRepeatCount;
+						this._startRepeatCount = 0;
+					}
+				}
+			}
+		}
+	}
+	return this;
+}});
+dojo.lfx.Combine = function (animations) {
+	dojo.lfx.IAnimation.call(this);
+	this._anims = [];
+	this._animsEnded = 0;
+	var anims = arguments;
+	if (anims.length == 1 &amp;&amp; (dojo.lang.isArray(anims[0]) || dojo.lang.isArrayLike(anims[0]))) {
+		anims = anims[0];
+	}
+	dojo.lang.forEach(anims, function (anim) {
+		this._anims.push(anim);
+		anim.connect(&quot;onEnd&quot;, dojo.lang.hitch(this, &quot;_onAnimsEnded&quot;));
+	}, this);
+};
+dojo.inherits(dojo.lfx.Combine, dojo.lfx.IAnimation);
+dojo.lang.extend(dojo.lfx.Combine, {_animsEnded:0, play:function (delay, gotoStart) {
+	if (!this._anims.length) {
+		return this;
+	}
+	this.fire(&quot;beforeBegin&quot;);
+	if (delay &gt; 0) {
+		setTimeout(dojo.lang.hitch(this, function () {
+			this.play(null, gotoStart);
+		}), delay);
+		return this;
+	}
+	if (gotoStart || this._anims[0].percent == 0) {
+		this.fire(&quot;onBegin&quot;);
+	}
+	this.fire(&quot;onPlay&quot;);
+	this._animsCall(&quot;play&quot;, null, gotoStart);
+	return this;
+}, pause:function () {
+	this.fire(&quot;onPause&quot;);
+	this._animsCall(&quot;pause&quot;);
+	return this;
+}, stop:function (gotoEnd) {
+	this.fire(&quot;onStop&quot;);
+	this._animsCall(&quot;stop&quot;, gotoEnd);
+	return this;
+}, _onAnimsEnded:function () {
+	this._animsEnded++;
+	if (this._animsEnded &gt;= this._anims.length) {
+		this.fire(&quot;onEnd&quot;);
+	}
+	return this;
+}, _animsCall:function (funcName) {
+	var args = [];
+	if (arguments.length &gt; 1) {
+		for (var i = 1; i &lt; arguments.length; i++) {
+			args.push(arguments[i]);
+		}
+	}
+	var _this = this;
+	dojo.lang.forEach(this._anims, function (anim) {
+		anim[funcName](args);
+	}, _this);
+	return this;
+}});
+dojo.lfx.Chain = function (animations) {
+	dojo.lfx.IAnimation.call(this);
+	this._anims = [];
+	this._currAnim = -1;
+	var anims = arguments;
+	if (anims.length == 1 &amp;&amp; (dojo.lang.isArray(anims[0]) || dojo.lang.isArrayLike(anims[0]))) {
+		anims = anims[0];
+	}
+	var _this = this;
+	dojo.lang.forEach(anims, function (anim, i, anims_arr) {
+		this._anims.push(anim);
+		if (i &lt; anims_arr.length - 1) {
+			anim.connect(&quot;onEnd&quot;, dojo.lang.hitch(this, &quot;_playNext&quot;));
+		} else {
+			anim.connect(&quot;onEnd&quot;, dojo.lang.hitch(this, function () {
+				this.fire(&quot;onEnd&quot;);
+			}));
+		}
+	}, this);
+};
+dojo.inherits(dojo.lfx.Chain, dojo.lfx.IAnimation);
+dojo.lang.extend(dojo.lfx.Chain, {_currAnim:-1, play:function (delay, gotoStart) {
+	if (!this._anims.length) {
+		return this;
+	}
+	if (gotoStart || !this._anims[this._currAnim]) {
+		this._currAnim = 0;
+	}
+	var currentAnimation = this._anims[this._currAnim];
+	this.fire(&quot;beforeBegin&quot;);
+	if (delay &gt; 0) {
+		setTimeout(dojo.lang.hitch(this, function () {
+			this.play(null, gotoStart);
+		}), delay);
+		return this;
+	}
+	if (currentAnimation) {
+		if (this._currAnim == 0) {
+			this.fire(&quot;handler&quot;, [&quot;begin&quot;, this._currAnim]);
+			this.fire(&quot;onBegin&quot;, [this._currAnim]);
+		}
+		this.fire(&quot;onPlay&quot;, [this._currAnim]);
+		currentAnimation.play(null, gotoStart);
+	}
+	return this;
+}, pause:function () {
+	if (this._anims[this._currAnim]) {
+		this._anims[this._currAnim].pause();
+		this.fire(&quot;onPause&quot;, [this._currAnim]);
+	}
+	return this;
+}, playPause:function () {
+	if (this._anims.length == 0) {
+		return this;
+	}
+	if (this._currAnim == -1) {
+		this._currAnim = 0;
+	}
+	var currAnim = this._anims[this._currAnim];
+	if (currAnim) {
+		if (!currAnim._active || currAnim._paused) {
+			this.play();
+		} else {
+			this.pause();
+		}
+	}
+	return this;
+}, stop:function () {
+	var currAnim = this._anims[this._currAnim];
+	if (currAnim) {
+		currAnim.stop();
+		this.fire(&quot;onStop&quot;, [this._currAnim]);
+	}
+	return currAnim;
+}, _playNext:function () {
+	if (this._currAnim == -1 || this._anims.length == 0) {
+		return this;
+	}
+	this._currAnim++;
+	if (this._anims[this._currAnim]) {
+		this._anims[this._currAnim].play(null, true);
+	}
+	return this;
+}});
+dojo.lfx.combine = function (animations) {
+	var anims = arguments;
+	if (dojo.lang.isArray(arguments[0])) {
+		anims = arguments[0];
+	}
+	if (anims.length == 1) {
+		return anims[0];
+	}
+	return new dojo.lfx.Combine(anims);
+};
+dojo.lfx.chain = function (animations) {
+	var anims = arguments;
+	if (dojo.lang.isArray(arguments[0])) {
+		anims = arguments[0];
+	}
+	if (anims.length == 1) {
+		return anims[0];
+	}
+	return new dojo.lfx.Chain(anims);
+};
+

Added: tags/parley-0.55/root/static/magic/src/lfx/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({browser:[&quot;dojo.lfx.html&quot;], dashboard:[&quot;dojo.lfx.html&quot;]});
+dojo.provide(&quot;dojo.lfx.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/lfx/extras.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/extras.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/extras.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,80 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lfx.extras&quot;);
+dojo.require(&quot;dojo.lfx.html&quot;);
+dojo.require(&quot;dojo.lfx.Animation&quot;);
+dojo.lfx.html.fadeWipeIn = function (nodes, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anim = dojo.lfx.combine(dojo.lfx.fadeIn(nodes, duration, easing), dojo.lfx.wipeIn(nodes, duration, easing));
+	if (callback) {
+		anim.connect(&quot;onEnd&quot;, function () {
+			callback(nodes, anim);
+		});
+	}
+	return anim;
+};
+dojo.lfx.html.fadeWipeOut = function (nodes, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anim = dojo.lfx.combine(dojo.lfx.fadeOut(nodes, duration, easing), dojo.lfx.wipeOut(nodes, duration, easing));
+	if (callback) {
+		anim.connect(&quot;onEnd&quot;, function () {
+			callback(nodes, anim);
+		});
+	}
+	return anim;
+};
+dojo.lfx.html.scale = function (nodes, percentage, scaleContent, fromCenter, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	dojo.lang.forEach(nodes, function (node) {
+		var outer = dojo.html.getMarginBox(node);
+		var actualPct = percentage / 100;
+		var props = [{property:&quot;width&quot;, start:outer.width, end:outer.width * actualPct}, {property:&quot;height&quot;, start:outer.height, end:outer.height * actualPct}];
+		if (scaleContent) {
+			var fontSize = dojo.html.getStyle(node, &quot;font-size&quot;);
+			var fontSizeType = null;
+			if (!fontSize) {
+				fontSize = parseFloat(&quot;100%&quot;);
+				fontSizeType = &quot;%&quot;;
+			} else {
+				dojo.lang.some([&quot;em&quot;, &quot;px&quot;, &quot;%&quot;], function (item, index, arr) {
+					if (fontSize.indexOf(item) &gt; 0) {
+						fontSize = parseFloat(fontSize);
+						fontSizeType = item;
+						return true;
+					}
+				});
+			}
+			props.push({property:&quot;font-size&quot;, start:fontSize, end:fontSize * actualPct, units:fontSizeType});
+		}
+		if (fromCenter) {
+			var positioning = dojo.html.getStyle(node, &quot;position&quot;);
+			var originalTop = node.offsetTop;
+			var originalLeft = node.offsetLeft;
+			var endTop = ((outer.height * actualPct) - outer.height) / 2;
+			var endLeft = ((outer.width * actualPct) - outer.width) / 2;
+			props.push({property:&quot;top&quot;, start:originalTop, end:(positioning == &quot;absolute&quot; ? originalTop - endTop : (-1 * endTop))});
+			props.push({property:&quot;left&quot;, start:originalLeft, end:(positioning == &quot;absolute&quot; ? originalLeft - endLeft : (-1 * endLeft))});
+		}
+		var anim = dojo.lfx.propertyAnimation(node, props, duration, easing);
+		if (callback) {
+			anim.connect(&quot;onEnd&quot;, function () {
+				callback(node, anim);
+			});
+		}
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lang.mixin(dojo.lfx, dojo.lfx.html);
+

Added: tags/parley-0.55/root/static/magic/src/lfx/html.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/html.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/html.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,509 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lfx.html&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.lfx.Animation&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.color&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.lfx.html._byId = function (nodes) {
+	if (!nodes) {
+		return [];
+	}
+	if (dojo.lang.isArrayLike(nodes)) {
+		if (!nodes.alreadyChecked) {
+			var n = [];
+			dojo.lang.forEach(nodes, function (node) {
+				n.push(dojo.byId(node));
+			});
+			n.alreadyChecked = true;
+			return n;
+		} else {
+			return nodes;
+		}
+	} else {
+		var n = [];
+		n.push(dojo.byId(nodes));
+		n.alreadyChecked = true;
+		return n;
+	}
+};
+dojo.lfx.html.propertyAnimation = function (nodes, propertyMap, duration, easing, handlers) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var targs = {&quot;propertyMap&quot;:propertyMap, &quot;nodes&quot;:nodes, &quot;duration&quot;:duration, &quot;easing&quot;:easing || dojo.lfx.easeDefault};
+	var setEmUp = function (args) {
+		if (args.nodes.length == 1) {
+			var pm = args.propertyMap;
+			if (!dojo.lang.isArray(args.propertyMap)) {
+				var parr = [];
+				for (var pname in pm) {
+					pm[pname].property = pname;
+					parr.push(pm[pname]);
+				}
+				pm = args.propertyMap = parr;
+			}
+			dojo.lang.forEach(pm, function (prop) {
+				if (dj_undef(&quot;start&quot;, prop)) {
+					if (prop.property != &quot;opacity&quot;) {
+						prop.start = parseInt(dojo.html.getComputedStyle(args.nodes[0], prop.property));
+					} else {
+						prop.start = dojo.html.getOpacity(args.nodes[0]);
+					}
+				}
+			});
+		}
+	};
+	var coordsAsInts = function (coords) {
+		var cints = [];
+		dojo.lang.forEach(coords, function (c) {
+			cints.push(Math.round(c));
+		});
+		return cints;
+	};
+	var setStyle = function (n, style) {
+		n = dojo.byId(n);
+		if (!n || !n.style) {
+			return;
+		}
+		for (var s in style) {
+			try {
+				if (s == &quot;opacity&quot;) {
+					dojo.html.setOpacity(n, style[s]);
+				} else {
+					n.style[s] = style[s];
+				}
+			}
+			catch (e) {
+				dojo.debug(e);
+			}
+		}
+	};
+	var propLine = function (properties) {
+		this._properties = properties;
+		this.diffs = new Array(properties.length);
+		dojo.lang.forEach(properties, function (prop, i) {
+			if (dojo.lang.isFunction(prop.start)) {
+				prop.start = prop.start(prop, i);
+			}
+			if (dojo.lang.isFunction(prop.end)) {
+				prop.end = prop.end(prop, i);
+			}
+			if (dojo.lang.isArray(prop.start)) {
+				this.diffs[i] = null;
+			} else {
+				if (prop.start instanceof dojo.gfx.color.Color) {
+					prop.startRgb = prop.start.toRgb();
+					prop.endRgb = prop.end.toRgb();
+				} else {
+					this.diffs[i] = prop.end - prop.start;
+				}
+			}
+		}, this);
+		this.getValue = function (n) {
+			var ret = {};
+			dojo.lang.forEach(this._properties, function (prop, i) {
+				var value = null;
+				if (dojo.lang.isArray(prop.start)) {
+				} else {
+					if (prop.start instanceof dojo.gfx.color.Color) {
+						value = (prop.units || &quot;rgb&quot;) + &quot;(&quot;;
+						for (var j = 0; j &lt; prop.startRgb.length; j++) {
+							value += Math.round(((prop.endRgb[j] - prop.startRgb[j]) * n) + prop.startRgb[j]) + (j &lt; prop.startRgb.length - 1 ? &quot;,&quot; : &quot;&quot;);
+						}
+						value += &quot;)&quot;;
+					} else {
+						value = ((this.diffs[i]) * n) + prop.start + (prop.property != &quot;opacity&quot; ? prop.units || &quot;px&quot; : &quot;&quot;);
+					}
+				}
+				ret[dojo.html.toCamelCase(prop.property)] = value;
+			}, this);
+			return ret;
+		};
+	};
+	var anim = new dojo.lfx.Animation({beforeBegin:function () {
+		setEmUp(targs);
+		anim.curve = new propLine(targs.propertyMap);
+	}, onAnimate:function (propValues) {
+		dojo.lang.forEach(targs.nodes, function (node) {
+			setStyle(node, propValues);
+		});
+	}}, targs.duration, null, targs.easing);
+	if (handlers) {
+		for (var x in handlers) {
+			if (dojo.lang.isFunction(handlers[x])) {
+				anim.connect(x, anim, handlers[x]);
+			}
+		}
+	}
+	return anim;
+};
+dojo.lfx.html._makeFadeable = function (nodes) {
+	var makeFade = function (node) {
+		if (dojo.render.html.ie) {
+			if ((node.style.zoom.length == 0) &amp;&amp; (dojo.html.getStyle(node, &quot;zoom&quot;) == &quot;normal&quot;)) {
+				node.style.zoom = &quot;1&quot;;
+			}
+			if ((node.style.width.length == 0) &amp;&amp; (dojo.html.getStyle(node, &quot;width&quot;) == &quot;auto&quot;)) {
+				node.style.width = &quot;auto&quot;;
+			}
+		}
+	};
+	if (dojo.lang.isArrayLike(nodes)) {
+		dojo.lang.forEach(nodes, makeFade);
+	} else {
+		makeFade(nodes);
+	}
+};
+dojo.lfx.html.fade = function (nodes, values, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var props = {property:&quot;opacity&quot;};
+	if (!dj_undef(&quot;start&quot;, values)) {
+		props.start = values.start;
+	} else {
+		props.start = function () {
+			return dojo.html.getOpacity(nodes[0]);
+		};
+	}
+	if (!dj_undef(&quot;end&quot;, values)) {
+		props.end = values.end;
+	} else {
+		dojo.raise(&quot;dojo.lfx.html.fade needs an end value&quot;);
+	}
+	var anim = dojo.lfx.propertyAnimation(nodes, [props], duration, easing);
+	anim.connect(&quot;beforeBegin&quot;, function () {
+		dojo.lfx.html._makeFadeable(nodes);
+	});
+	if (callback) {
+		anim.connect(&quot;onEnd&quot;, function () {
+			callback(nodes, anim);
+		});
+	}
+	return anim;
+};
+dojo.lfx.html.fadeIn = function (nodes, duration, easing, callback) {
+	return dojo.lfx.html.fade(nodes, {end:1}, duration, easing, callback);
+};
+dojo.lfx.html.fadeOut = function (nodes, duration, easing, callback) {
+	return dojo.lfx.html.fade(nodes, {end:0}, duration, easing, callback);
+};
+dojo.lfx.html.fadeShow = function (nodes, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	dojo.lang.forEach(nodes, function (node) {
+		dojo.html.setOpacity(node, 0);
+	});
+	var anim = dojo.lfx.html.fadeIn(nodes, duration, easing, callback);
+	anim.connect(&quot;beforeBegin&quot;, function () {
+		if (dojo.lang.isArrayLike(nodes)) {
+			dojo.lang.forEach(nodes, dojo.html.show);
+		} else {
+			dojo.html.show(nodes);
+		}
+	});
+	return anim;
+};
+dojo.lfx.html.fadeHide = function (nodes, duration, easing, callback) {
+	var anim = dojo.lfx.html.fadeOut(nodes, duration, easing, function () {
+		if (dojo.lang.isArrayLike(nodes)) {
+			dojo.lang.forEach(nodes, dojo.html.hide);
+		} else {
+			dojo.html.hide(nodes);
+		}
+		if (callback) {
+			callback(nodes, anim);
+		}
+	});
+	return anim;
+};
+dojo.lfx.html.wipeIn = function (nodes, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	dojo.lang.forEach(nodes, function (node) {
+		var oprop = {};
+		var origTop, origLeft, origPosition;
+		with (node.style) {
+			origTop = top;
+			origLeft = left;
+			origPosition = position;
+			top = &quot;-9999px&quot;;
+			left = &quot;-9999px&quot;;
+			position = &quot;absolute&quot;;
+			display = &quot;&quot;;
+		}
+		var nodeHeight = dojo.html.getBorderBox(node).height;
+		with (node.style) {
+			top = origTop;
+			left = origLeft;
+			position = origPosition;
+			display = &quot;none&quot;;
+		}
+		var anim = dojo.lfx.propertyAnimation(node, {&quot;height&quot;:{start:1, end:function () {
+			return nodeHeight;
+		}}}, duration, easing);
+		anim.connect(&quot;beforeBegin&quot;, function () {
+			oprop.overflow = node.style.overflow;
+			oprop.height = node.style.height;
+			with (node.style) {
+				overflow = &quot;hidden&quot;;
+				height = &quot;1px&quot;;
+			}
+			dojo.html.show(node);
+		});
+		anim.connect(&quot;onEnd&quot;, function () {
+			with (node.style) {
+				overflow = oprop.overflow;
+				height = oprop.height;
+			}
+			if (callback) {
+				callback(node, anim);
+			}
+		});
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lfx.html.wipeOut = function (nodes, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	dojo.lang.forEach(nodes, function (node) {
+		var oprop = {};
+		var anim = dojo.lfx.propertyAnimation(node, {&quot;height&quot;:{start:function () {
+			return dojo.html.getContentBox(node).height;
+		}, end:1}}, duration, easing, {&quot;beforeBegin&quot;:function () {
+			oprop.overflow = node.style.overflow;
+			oprop.height = node.style.height;
+			with (node.style) {
+				overflow = &quot;hidden&quot;;
+			}
+			dojo.html.show(node);
+		}, &quot;onEnd&quot;:function () {
+			dojo.html.hide(node);
+			with (node.style) {
+				overflow = oprop.overflow;
+				height = oprop.height;
+			}
+			if (callback) {
+				callback(node, anim);
+			}
+		}});
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lfx.html.slideTo = function (nodes, coords, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	var compute = dojo.html.getComputedStyle;
+	if (dojo.lang.isArray(coords)) {
+		dojo.deprecated(&quot;dojo.lfx.html.slideTo(node, array)&quot;, &quot;use dojo.lfx.html.slideTo(node, {top: value, left: value});&quot;, &quot;0.5&quot;);
+		coords = {top:coords[0], left:coords[1]};
+	}
+	dojo.lang.forEach(nodes, function (node) {
+		var top = null;
+		var left = null;
+		var init = (function () {
+			var innerNode = node;
+			return function () {
+				var pos = compute(innerNode, &quot;position&quot;);
+				top = (pos == &quot;absolute&quot; ? node.offsetTop : parseInt(compute(node, &quot;top&quot;)) || 0);
+				left = (pos == &quot;absolute&quot; ? node.offsetLeft : parseInt(compute(node, &quot;left&quot;)) || 0);
+				if (!dojo.lang.inArray([&quot;absolute&quot;, &quot;relative&quot;], pos)) {
+					var ret = dojo.html.abs(innerNode, true);
+					dojo.html.setStyleAttributes(innerNode, &quot;position:absolute;top:&quot; + ret.y + &quot;px;left:&quot; + ret.x + &quot;px;&quot;);
+					top = ret.y;
+					left = ret.x;
+				}
+			};
+		})();
+		init();
+		var anim = dojo.lfx.propertyAnimation(node, {&quot;top&quot;:{start:top, end:(coords.top || 0)}, &quot;left&quot;:{start:left, end:(coords.left || 0)}}, duration, easing, {&quot;beforeBegin&quot;:init});
+		if (callback) {
+			anim.connect(&quot;onEnd&quot;, function () {
+				callback(nodes, anim);
+			});
+		}
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lfx.html.slideBy = function (nodes, coords, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	var compute = dojo.html.getComputedStyle;
+	if (dojo.lang.isArray(coords)) {
+		dojo.deprecated(&quot;dojo.lfx.html.slideBy(node, array)&quot;, &quot;use dojo.lfx.html.slideBy(node, {top: value, left: value});&quot;, &quot;0.5&quot;);
+		coords = {top:coords[0], left:coords[1]};
+	}
+	dojo.lang.forEach(nodes, function (node) {
+		var top = null;
+		var left = null;
+		var init = (function () {
+			var innerNode = node;
+			return function () {
+				var pos = compute(innerNode, &quot;position&quot;);
+				top = (pos == &quot;absolute&quot; ? node.offsetTop : parseInt(compute(node, &quot;top&quot;)) || 0);
+				left = (pos == &quot;absolute&quot; ? node.offsetLeft : parseInt(compute(node, &quot;left&quot;)) || 0);
+				if (!dojo.lang.inArray([&quot;absolute&quot;, &quot;relative&quot;], pos)) {
+					var ret = dojo.html.abs(innerNode, true);
+					dojo.html.setStyleAttributes(innerNode, &quot;position:absolute;top:&quot; + ret.y + &quot;px;left:&quot; + ret.x + &quot;px;&quot;);
+					top = ret.y;
+					left = ret.x;
+				}
+			};
+		})();
+		init();
+		var anim = dojo.lfx.propertyAnimation(node, {&quot;top&quot;:{start:top, end:top + (coords.top || 0)}, &quot;left&quot;:{start:left, end:left + (coords.left || 0)}}, duration, easing).connect(&quot;beforeBegin&quot;, init);
+		if (callback) {
+			anim.connect(&quot;onEnd&quot;, function () {
+				callback(nodes, anim);
+			});
+		}
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lfx.html.explode = function (start, endNode, duration, easing, callback) {
+	var h = dojo.html;
+	start = dojo.byId(start);
+	endNode = dojo.byId(endNode);
+	var startCoords = h.toCoordinateObject(start, true);
+	var outline = document.createElement(&quot;div&quot;);
+	h.copyStyle(outline, endNode);
+	if (endNode.explodeClassName) {
+		outline.className = endNode.explodeClassName;
+	}
+	with (outline.style) {
+		position = &quot;absolute&quot;;
+		display = &quot;none&quot;;
+		var backgroundStyle = h.getStyle(start, &quot;background-color&quot;);
+		backgroundColor = backgroundStyle ? backgroundStyle.toLowerCase() : &quot;transparent&quot;;
+		backgroundColor = (backgroundColor == &quot;transparent&quot;) ? &quot;rgb(221, 221, 221)&quot; : backgroundColor;
+	}
+	dojo.body().appendChild(outline);
+	with (endNode.style) {
+		visibility = &quot;hidden&quot;;
+		display = &quot;block&quot;;
+	}
+	var endCoords = h.toCoordinateObject(endNode, true);
+	with (endNode.style) {
+		display = &quot;none&quot;;
+		visibility = &quot;visible&quot;;
+	}
+	var props = {opacity:{start:0.5, end:1}};
+	dojo.lang.forEach([&quot;height&quot;, &quot;width&quot;, &quot;top&quot;, &quot;left&quot;], function (type) {
+		props[type] = {start:startCoords[type], end:endCoords[type]};
+	});
+	var anim = new dojo.lfx.propertyAnimation(outline, props, duration, easing, {&quot;beforeBegin&quot;:function () {
+		h.setDisplay(outline, &quot;block&quot;);
+	}, &quot;onEnd&quot;:function () {
+		h.setDisplay(endNode, &quot;block&quot;);
+		outline.parentNode.removeChild(outline);
+	}});
+	if (callback) {
+		anim.connect(&quot;onEnd&quot;, function () {
+			callback(endNode, anim);
+		});
+	}
+	return anim;
+};
+dojo.lfx.html.implode = function (startNode, end, duration, easing, callback) {
+	var h = dojo.html;
+	startNode = dojo.byId(startNode);
+	end = dojo.byId(end);
+	var startCoords = dojo.html.toCoordinateObject(startNode, true);
+	var endCoords = dojo.html.toCoordinateObject(end, true);
+	var outline = document.createElement(&quot;div&quot;);
+	dojo.html.copyStyle(outline, startNode);
+	if (startNode.explodeClassName) {
+		outline.className = startNode.explodeClassName;
+	}
+	dojo.html.setOpacity(outline, 0.3);
+	with (outline.style) {
+		position = &quot;absolute&quot;;
+		display = &quot;none&quot;;
+		backgroundColor = h.getStyle(startNode, &quot;background-color&quot;).toLowerCase();
+	}
+	dojo.body().appendChild(outline);
+	var props = {opacity:{start:1, end:0.5}};
+	dojo.lang.forEach([&quot;height&quot;, &quot;width&quot;, &quot;top&quot;, &quot;left&quot;], function (type) {
+		props[type] = {start:startCoords[type], end:endCoords[type]};
+	});
+	var anim = new dojo.lfx.propertyAnimation(outline, props, duration, easing, {&quot;beforeBegin&quot;:function () {
+		dojo.html.hide(startNode);
+		dojo.html.show(outline);
+	}, &quot;onEnd&quot;:function () {
+		outline.parentNode.removeChild(outline);
+	}});
+	if (callback) {
+		anim.connect(&quot;onEnd&quot;, function () {
+			callback(startNode, anim);
+		});
+	}
+	return anim;
+};
+dojo.lfx.html.highlight = function (nodes, startColor, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	dojo.lang.forEach(nodes, function (node) {
+		var color = dojo.html.getBackgroundColor(node);
+		var bg = dojo.html.getStyle(node, &quot;background-color&quot;).toLowerCase();
+		var bgImage = dojo.html.getStyle(node, &quot;background-image&quot;);
+		var wasTransparent = (bg == &quot;transparent&quot; || bg == &quot;rgba(0, 0, 0, 0)&quot;);
+		while (color.length &gt; 3) {
+			color.pop();
+		}
+		var rgb = new dojo.gfx.color.Color(startColor);
+		var endRgb = new dojo.gfx.color.Color(color);
+		var anim = dojo.lfx.propertyAnimation(node, {&quot;background-color&quot;:{start:rgb, end:endRgb}}, duration, easing, {&quot;beforeBegin&quot;:function () {
+			if (bgImage) {
+				node.style.backgroundImage = &quot;none&quot;;
+			}
+			node.style.backgroundColor = &quot;rgb(&quot; + rgb.toRgb().join(&quot;,&quot;) + &quot;)&quot;;
+		}, &quot;onEnd&quot;:function () {
+			if (bgImage) {
+				node.style.backgroundImage = bgImage;
+			}
+			if (wasTransparent) {
+				node.style.backgroundColor = &quot;transparent&quot;;
+			}
+			if (callback) {
+				callback(node, anim);
+			}
+		}});
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lfx.html.unhighlight = function (nodes, endColor, duration, easing, callback) {
+	nodes = dojo.lfx.html._byId(nodes);
+	var anims = [];
+	dojo.lang.forEach(nodes, function (node) {
+		var color = new dojo.gfx.color.Color(dojo.html.getBackgroundColor(node));
+		var rgb = new dojo.gfx.color.Color(endColor);
+		var bgImage = dojo.html.getStyle(node, &quot;background-image&quot;);
+		var anim = dojo.lfx.propertyAnimation(node, {&quot;background-color&quot;:{start:color, end:rgb}}, duration, easing, {&quot;beforeBegin&quot;:function () {
+			if (bgImage) {
+				node.style.backgroundImage = &quot;none&quot;;
+			}
+			node.style.backgroundColor = &quot;rgb(&quot; + color.toRgb().join(&quot;,&quot;) + &quot;)&quot;;
+		}, &quot;onEnd&quot;:function () {
+			if (callback) {
+				callback(node, anim);
+			}
+		}});
+		anims.push(anim);
+	});
+	return dojo.lfx.combine(anims);
+};
+dojo.lang.mixin(dojo.lfx, dojo.lfx.html);
+

Added: tags/parley-0.55/root/static/magic/src/lfx/rounded.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/rounded.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/rounded.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,444 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lfx.rounded&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.lfx.rounded = function (settings) {
+	var options = {validTags:settings.validTags || [&quot;div&quot;], autoPad:settings.autoPad != null ? settings.autoPad : true, antiAlias:settings.antiAlias != null ? settings.antiAlias : true, radii:{tl:(settings.tl &amp;&amp; settings.tl.radius != null) ? settings.tl.radius : 5, tr:(settings.tr &amp;&amp; settings.tr.radius != null) ? settings.tr.radius : 5, bl:(settings.bl &amp;&amp; settings.bl.radius != null) ? settings.bl.radius : 5, br:(settings.br &amp;&amp; settings.br.radius != null) ? settings.br.radius : 5}};
+	var nodes;
+	if (typeof (arguments[1]) == &quot;string&quot;) {
+		nodes = dojo.html.getElementsByClass(arguments[1]);
+	} else {
+		if (dojo.lang.isArrayLike(arguments[1])) {
+			nodes = arguments[1];
+			for (var i = 0; i &lt; nodes.length; i++) {
+				nodes[i] = dojo.byId(nodes[i]);
+			}
+		}
+	}
+	if (nodes.length == 0) {
+		return;
+	}
+	for (var i = 0; i &lt; nodes.length; i++) {
+		dojo.lfx.rounded.applyCorners(options, nodes[i]);
+	}
+};
+dojo.lfx.rounded.applyCorners = function (options, node) {
+	var top = null;
+	var bottom = null;
+	var contentNode = null;
+	var fns = dojo.lfx.rounded._fns;
+	var width = node.offsetWidth;
+	var height = node.offsetHeight;
+	var borderWidth = parseInt(dojo.html.getComputedStyle(node, &quot;border-top-width&quot;));
+	var borderColor = dojo.html.getComputedStyle(node, &quot;border-top-color&quot;);
+	var color = dojo.html.getComputedStyle(node, &quot;background-color&quot;);
+	var bgImage = dojo.html.getComputedStyle(node, &quot;background-image&quot;);
+	var position = dojo.html.getComputedStyle(node, &quot;position&quot;);
+	var padding = parseInt(dojo.html.getComputedStyle(node, &quot;padding-top&quot;));
+	var format = {height:height, width:width, borderWidth:borderWidth, color:fns.getRGB(color), padding:padding, borderColor:fns.getRGB(borderColor), borderString:borderWidth + &quot;px&quot; + &quot; solid &quot; + fns.getRGB(borderColor), bgImage:((bgImage != &quot;none&quot;) ? bgImage : &quot;&quot;), content:node.innerHTML};
+	if (!dojo.html.isPositionAbsolute(node)) {
+		node.style.position = &quot;relative&quot;;
+	}
+	node.style.padding = &quot;0px&quot;;
+	if (dojo.render.html.ie &amp;&amp; width == &quot;auto&quot; &amp;&amp; height == &quot;auto&quot;) {
+		node.style.width = &quot;100%&quot;;
+	}
+	if (options.autoPad &amp;&amp; format.padding &gt; 0) {
+		node.innerHTML = &quot;&quot;;
+	}
+	var topHeight = Math.max(options.radii.tl, options.radii.tr);
+	var bottomHeight = Math.max(options.radii.bl, options.radii.br);
+	if (options.radii.tl || options.radii.tr) {
+		top = document.createElement(&quot;div&quot;);
+		top.style.width = &quot;100%&quot;;
+		top.style.fontSize = &quot;1px&quot;;
+		top.style.overflow = &quot;hidden&quot;;
+		top.style.position = &quot;absolute&quot;;
+		top.style.paddingLeft = format.borderWidth + &quot;px&quot;;
+		top.style.paddingRight = format.borderWidth + &quot;px&quot;;
+		top.style.height = topHeight + &quot;px&quot;;
+		top.style.top = (0 - topHeight) + &quot;px&quot;;
+		top.style.left = (0 - format.borderWidth) + &quot;px&quot;;
+		node.appendChild(top);
+	}
+	if (options.radii.bl || options.radii.br) {
+		bottom = document.createElement(&quot;div&quot;);
+		bottom.style.width = &quot;100%&quot;;
+		bottom.style.fontSize = &quot;1px&quot;;
+		bottom.style.overflow = &quot;hidden&quot;;
+		bottom.style.position = &quot;absolute&quot;;
+		bottom.style.paddingLeft = format.borderWidth + &quot;px&quot;;
+		bottom.style.paddingRight = format.borderWidth + &quot;px&quot;;
+		bottom.style.height = bottomHeight + &quot;px&quot;;
+		bottom.style.bottom = (0 - bottomHeight) + &quot;px&quot;;
+		bottom.style.left = (0 - format.borderWidth) + &quot;px&quot;;
+		node.appendChild(bottom);
+	}
+	if (top) {
+		node.style.borderTopWidth = &quot;0px&quot;;
+	}
+	if (bottom) {
+		node.style.borderBottomWidth = &quot;0px&quot;;
+	}
+	var corners = [&quot;tr&quot;, &quot;tl&quot;, &quot;br&quot;, &quot;bl&quot;];
+	for (var i = 0; i &lt; corners.length; i++) {
+		var cc = corners[i];
+		if (options.radii[cc] == 0) {
+			if ((cc.charAt(0) == &quot;t&quot; &amp;&amp; top) || (cc.charAt(0) == &quot;b&quot; &amp;&amp; bottom)) {
+				var corner = document.createElement(&quot;div&quot;);
+				corner.style.position = &quot;relative&quot;;
+				corner.style.fontSize = &quot;1px;&quot;;
+				corner.style.overflow = &quot;hidden&quot;;
+				if (format.bgImage == &quot;&quot;) {
+					corner.style.backgroundColor = format.color;
+				} else {
+					corner.style.backgroundImage = format.bgImage;
+				}
+				switch (cc) {
+				  case &quot;tl&quot;:
+					corner.style.height = topHeight - format.borderWidth + &quot;px&quot;;
+					corner.style.marginRight = options.radii[cc] - (format.borderWidth * 2) + &quot;px&quot;;
+					corner.style.borderLeft = format.borderString;
+					corner.style.borderTop = format.borderString;
+					corner.style.left = -format.borderWidth + &quot;px&quot;;
+					break;
+				  case &quot;tr&quot;:
+					corner.style.height = topHeight - format.borderWidth + &quot;px&quot;;
+					corner.style.marginLeft = options.radii[cc] - (format.borderWidth * 2) + &quot;px&quot;;
+					corner.style.borderRight = format.borderString;
+					corner.style.borderTop = format.borderString;
+					corner.style.backgroundPosition = &quot;-&quot; + (topHeight - format.borderWidth) + &quot;px 0px&quot;;
+					corner.style.left = format.borderWidth + &quot;px&quot;;
+					break;
+				  case &quot;bl&quot;:
+					corner.style.height = bottomHeight - format.borderWidth + &quot;px&quot;;
+					corner.style.marginRight = options.radii[cc] - (format.borderWidth * 2) + &quot;px&quot;;
+					corner.style.borderLeft = format.borderString;
+					corner.style.borderBottom = format.borderString;
+					corner.style.left = format.borderWidth + &quot;px&quot;;
+					corner.style.backgroundPosition = &quot;-&quot; + format.borderWidth + &quot;px -&quot; + (format.height + (bottomHeight + format.borderWidth)) + &quot;px&quot;;
+					break;
+				  case &quot;br&quot;:
+					corner.style.height = bottomHeight - format.borderWidth + &quot;px&quot;;
+					corner.style.marginLeft = options.radii[cc] - (format.borderWidth * 2) + &quot;px&quot;;
+					corner.style.borderRight = format.borderString;
+					corner.style.borderBottom = format.borderString;
+					corner.style.left = format.borderWidth + &quot;px&quot;;
+					corner.style.backgroundPosition = &quot;-&quot; + (bottomHeight + format.borderWidth) + &quot;px -&quot; + (format.height + (bottomHeight + format.borderWidth)) + &quot;px&quot;;
+					break;
+				}
+			}
+		} else {
+			var corner = document.createElement(&quot;div&quot;);
+			corner.style.height = options.radii[cc] + &quot;px&quot;;
+			corner.style.width = options.radii[cc] + &quot;px&quot;;
+			corner.style.position = &quot;absolute&quot;;
+			corner.style.fontSize = &quot;1px&quot;;
+			corner.style.overflow = &quot;hidden&quot;;
+			var borderRadius = Math.floor(options.radii[cc] - format.borderWidth);
+			for (var x = 0, j = options.radii[cc]; x &lt; j; x++) {
+				var y1 = Math.floor(Math.sqrt(Math.pow(borderRadius, 2) - Math.pow((x + 1), 2))) - 1;
+				if ((x + 1) &gt;= borderRadius) {
+					var y1 = -1;
+				}
+				var y2 = Math.ceil(Math.sqrt(Math.pow(borderRadius, 2) - Math.pow(x, 2)));
+				if (x &gt;= borderRadius) {
+					y2 = -1;
+				}
+				var y3 = Math.floor(Math.sqrt(Math.pow(j, 2) - Math.pow((x + 1), 2))) - 1;
+				if ((x + 1) &gt;= j) {
+					y3 = -1;
+				}
+				var y4 = Math.ceil(Math.sqrt(Math.pow(j, 2) - Math.pow(x, 2)));
+				if (x &gt;= j) {
+					y4 = -1;
+				}
+				if (y1 &gt; -1) {
+					fns.draw(x, 0, format.color, 100, (y1 + 1), corner, -1, j, topHeight, format);
+				}
+				for (var y = (y1 + 1); y &lt; y2; y++) {
+					if (options.antiAlias) {
+						if (format.bgImage != &quot;&quot;) {
+							var fract = fns.fraction(x, y, borderRadius) * 100;
+							if (fract &lt; 30) {
+								fns.draw(x, y, format.borderColor, 100, 1, corner, 0, options.radii[cc], topHeight, format);
+							} else {
+								fns.draw(x, y, format.borderColor, 100, 1, corner, -1, options.radii[cc], topHeight, format);
+							}
+						} else {
+							var clr = fns.blend(format.color, format.borderColor, fns.fraction(x, y, borderRadius));
+							fns.draw(x, y, clr, 100, 1, corner, 0, options.radii[cc], topHeight, format);
+						}
+					}
+				}
+				if (options.antiAlias) {
+					if (y3 &gt;= y2) {
+						if (y2 == -1) {
+							y2 = 0;
+						}
+						fns.draw(x, y2, format.borderColor, 100, (y3 - y2 + 1), corner, 0, 0, topHeight, format);
+					} else {
+						if (y3 &gt;= y1) {
+							fns.draw(x, (y1 + 1), format.borderColor, 100, (y3 - y1), corner, 0, 0, topHeight, format);
+						}
+					}
+					for (var y = (y3 + 1); y &lt; y4; y++) {
+						fns.draw(x, y, format.borderColor, (fns.fraction(x, y, j) * 100), 1, corner, (format.borderWidth &gt; 0 ? 0 : -1), options.radii[cc], topHeight, format);
+					}
+				} else {
+					y3 = y1;
+				}
+			}
+			if (cc != &quot;br&quot;) {
+				for (var t = 0, k = corner.childNodes.length; t &lt; k; t++) {
+					var bar = corner.childNodes[t];
+					var barTop = parseInt(dojo.html.getComputedStyle(bar, &quot;top&quot;));
+					var barLeft = parseInt(dojo.html.getComputedStyle(bar, &quot;left&quot;));
+					var barHeight = parseInt(dojo.html.getComputedStyle(bar, &quot;height&quot;));
+					if (cc.charAt(1) == &quot;l&quot;) {
+						bar.style.left = (options.radii[cc] - barLeft - 1) + &quot;px&quot;;
+					}
+					if (cc == &quot;tr&quot;) {
+						bar.style.top = (options.radii[cc] - barHeight - barTop) + &quot;px&quot;;
+						bar.style.backgroundPosition = &quot;-&quot; + Math.abs((format.width - options.radii[cc] + format.borderWidth) + barLeft) + &quot;px -&quot; + Math.abs(options.radii[cc] - barHeight - barTop - format.borderWidth) + &quot;px&quot;;
+					} else {
+						if (cc == &quot;tl&quot;) {
+							bar.style.top = (options.radii[cc] - barHeight - barTop) + &quot;px&quot;;
+							bar.style.backgroundPosition = &quot;-&quot; + Math.abs((options.radii[cc] - barLeft - 1) - format.borderWidth) + &quot;px -&quot; + Math.abs(options.radii[cc] - barHeight - barTop - format.borderWidth) + &quot;px&quot;;
+						} else {
+							bar.style.backgroundPosition = &quot;-&quot; + Math.abs((options.radii[cc] + barLeft) + format.borderWidth) + &quot;px -&quot; + Math.abs((format.height + options.radii[cc] + barTop) - format.borderWidth) + &quot;px&quot;;
+						}
+					}
+				}
+			}
+		}
+		if (corner) {
+			var psn = [];
+			if (cc.charAt(0) == &quot;t&quot;) {
+				psn.push(&quot;top&quot;);
+			} else {
+				psn.push(&quot;bottom&quot;);
+			}
+			if (cc.charAt(1) == &quot;l&quot;) {
+				psn.push(&quot;left&quot;);
+			} else {
+				psn.push(&quot;right&quot;);
+			}
+			if (corner.style.position == &quot;absolute&quot;) {
+				for (var z = 0; z &lt; psn.length; z++) {
+					corner.style[psn[z]] = &quot;0px&quot;;
+				}
+			}
+			if (psn[0] == &quot;top&quot;) {
+				if (top) {
+					top.appendChild(corner);
+				}
+			} else {
+				if (bottom) {
+					bottom.appendChild(corner);
+				}
+			}
+		}
+	}
+	var diff = {t:Math.abs(options.radii.tl - options.radii.tr), b:Math.abs(options.radii.bl - options.radii.br)};
+	for (var z in diff) {
+		var smaller = (options.radii[z + &quot;l&quot;] &lt; options.radii[z + &quot;r&quot;] ? z + &quot;l&quot; : z + &quot;r&quot;);
+		var filler = document.createElement(&quot;div&quot;);
+		filler.style.height = diff[z] + &quot;px&quot;;
+		filler.style.width = options.radii[smaller] + &quot;px&quot;;
+		filler.style.position = &quot;absolute&quot;;
+		filler.style.fontSize = &quot;1px&quot;;
+		filler.style.overflow = &quot;hidden&quot;;
+		filler.style.backgroundColor = format.color;
+		switch (smaller) {
+		  case &quot;tl&quot;:
+			filler.style.bottom = &quot;0px&quot;;
+			filler.style.left = &quot;0px&quot;;
+			filler.style.borderLeft = format.borderString;
+			top.appendChild(filler);
+			break;
+		  case &quot;tr&quot;:
+			filler.style.bottom = &quot;0px&quot;;
+			filler.style.right = &quot;0px&quot;;
+			filler.style.borderRight = format.borderString;
+			top.appendChild(filler);
+			break;
+		  case &quot;bl&quot;:
+			filler.style.top = &quot;0px&quot;;
+			filler.style.left = &quot;0px&quot;;
+			filler.style.borderLeft = format.borderString;
+			bottom.appendChild(filler);
+			break;
+		  case &quot;br&quot;:
+			filler.style.top = &quot;0px&quot;;
+			filler.style.right = &quot;0px&quot;;
+			filler.style.borderRight = format.borderString;
+			bottom.appendChild(filler);
+			break;
+		}
+		var fillBar = document.createElement(&quot;div&quot;);
+		fillBar.style.position = &quot;relative&quot;;
+		fillBar.style.fontSize = &quot;1px&quot;;
+		fillBar.style.overflow = &quot;hidden&quot;;
+		fillBar.style.backgroundColor = format.color;
+		fillBar.style.backgroundImage = format.bgImage;
+		if (z == &quot;t&quot;) {
+			if (top) {
+				if (options.radii.tl &amp;&amp; options.radii.tr) {
+					fillBar.style.height = (topHeight - format.borderWidth) + &quot;px&quot;;
+					fillBar.style.marginLeft = (options.radii.tl - format.borderWidth) + &quot;px&quot;;
+					fillBar.style.marginRight = (options.radii.tr - format.borderWidth) + &quot;px&quot;;
+					fillBar.style.borderTop = format.borderString;
+					if (format.bgImage != &quot;&quot;) {
+						fillBar.style.backgroundPosition = &quot;-&quot; + (topHeight + format.borderWidth) + &quot;px 0px&quot;;
+					}
+				}
+				top.appendChild(fillBar);
+			}
+		} else {
+			if (bottom) {
+				if (options.radii.bl &amp;&amp; options.radii.br) {
+					fillBar.style.height = (bottomHeight - format.borderWidth) + &quot;px&quot;;
+					fillBar.style.marginLeft = (options.radii.bl - format.borderWidth) + &quot;px&quot;;
+					fillBar.style.marginRight = (options.radii.br - format.borderWidth) + &quot;px&quot;;
+					fillBar.style.borderBottom = format.borderString;
+					if (format.bgImage != &quot;&quot;) {
+						fillBar.style.backgroundPosition = &quot;-&quot; + (bottomHeight + format.borderWidth) + &quot;px -&quot; + (format.height + (topHeight + format.borderWidth)) + &quot;px&quot;;
+					}
+				}
+				bottom.appendChild(fillBar);
+			}
+		}
+	}
+	if (options.autoPad &amp;&amp; format.padding &gt; 0) {
+		var content = document.createElement(&quot;div&quot;);
+		content.style.position = &quot;relative&quot;;
+		content.innerHTML = format.content;
+		content.className = &quot;autoPadDiv&quot;;
+		if (topHeight &lt; format.padding) {
+			content.style.paddingTop = Math.abs(topHeight - format.padding) + &quot;px&quot;;
+		}
+		if (bottomHeight &lt; format.padding) {
+			content.style.paddingBottom = Math.abs(bottomHeight - format.padding) + &quot;px&quot;;
+		}
+		content.style.paddingLeft = format.padding + &quot;px&quot;;
+		content.style.paddingRight = format.padding + &quot;px&quot;;
+		node.appendChild(content);
+	}
+};
+var count = 0;
+dojo.lfx.rounded._fns = {blend:function (clr1, clr2, frac) {
+	var c1 = {r:parseInt(clr1.substr(1, 2), 16), g:parseInt(clr1.substr(3, 2), 16), b:parseInt(clr1.substr(5, 2), 16)};
+	var c2 = {r:parseInt(clr2.substr(1, 2), 16), g:parseInt(clr2.substr(3, 2), 16), b:parseInt(clr2.substr(5, 2), 16)};
+	if (frac &gt; 1 || frac &lt; 0) {
+		frac = 1;
+	}
+	var ret = [Math.min(Math.max(Math.round((c1.r * frac) + (c2.r * (1 - frac))), 0), 255), Math.min(Math.max(Math.round((c1.g * frac) + (c2.g * (1 - frac))), 0), 255), Math.min(Math.max(Math.round((c1.b * frac) + (c2.b * (1 - frac))), 0), 255)];
+	for (var i = 0; i &lt; ret.length; i++) {
+		var n = ret[i].toString(16);
+		if (n.length &lt; 2) {
+			n = &quot;0&quot; + n;
+		}
+		ret[i] = n;
+	}
+	return &quot;#&quot; + ret.join(&quot;&quot;);
+}, fraction:function (x, y, r) {
+	var frac = 0;
+	var xval = [];
+	var yval = [];
+	var point = 0;
+	var whatsides = &quot;&quot;;
+	var intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(x, 2)));
+	if (intersect &gt;= y &amp;&amp; intersect &lt; (y + 1)) {
+		whatsides = &quot;Left&quot;;
+		xval[point] = 0;
+		yval[point++] = intersect - y;
+	}
+	intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(y + 1, 2)));
+	if (intersect &gt;= x &amp;&amp; intersect &lt; (x + 1)) {
+		whatsides += &quot;Top&quot;;
+		xval[point] = intersect - x;
+		yval[point++] = 1;
+	}
+	intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(x + 1, 2)));
+	if (intersect &gt;= y &amp;&amp; intersect &lt; (y + 1)) {
+		whatsides += &quot;Right&quot;;
+		xval[point] = 1;
+		yval[point++] = intersect - y;
+	}
+	intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(y, 2)));
+	if (intersect &gt;= x &amp;&amp; intersect &lt; (x + 1)) {
+		whatsides += &quot;Bottom&quot;;
+		xval[point] = intersect - x;
+		yval[point] = 1;
+	}
+	switch (whatsides) {
+	  case &quot;LeftRight&quot;:
+		return Math.min(yval[0], yval[1]) + ((Math.max(yval[0], yval[1]) - Math.min(yval[0], yval[1])) / 2);
+	  case &quot;TopRight&quot;:
+		return 1 - (((1 - xval[0]) * (1 - yval[1])) / 2);
+	  case &quot;TopBottom&quot;:
+		return Math.min(xval[0], xval[1]) + ((Math.max(xval[0], xval[1]) - Math.min(xval[0], xval[1])) / 2);
+	  case &quot;LeftBottom&quot;:
+		return (yval[0] * xval[1]) / 2;
+	  default:
+		return 1;
+	}
+}, draw:function (x, y, color, opac, height, corner, image, radius, top, format) {
+	var px = document.createElement(&quot;div&quot;);
+	px.style.height = height + &quot;px&quot;;
+	px.style.width = &quot;1px&quot;;
+	px.style.position = &quot;absolute&quot;;
+	px.style.fontSize = &quot;1px&quot;;
+	px.style.overflow = &quot;hidden&quot;;
+	if (image == -1 &amp;&amp; format.bgImage != &quot;&quot;) {
+		px.style.backgroundImage = format.bgImage;
+		px.style.backgroundPosition = &quot;-&quot; + (format.width - (radius - x) + format.borderWidth) + &quot;px -&quot; + ((format.height + top + y) - format.borderWidth) + &quot;px&quot;;
+	} else {
+		px.style.backgroundColor = color;
+	}
+	if (opac != 100) {
+		dojo.html.setOpacity(px, (opac / 100));
+	}
+	px.style.top = y + &quot;px&quot;;
+	px.style.left = x + &quot;px&quot;;
+	corner.appendChild(px);
+}, getRGB:function (clr) {
+	var ret = &quot;#ffffff&quot;;
+	if (clr != &quot;&quot; &amp;&amp; clr != &quot;transparent&quot;) {
+		if (clr.substr(0, 3) == &quot;rgb&quot;) {
+			var t = clr.substring(4, clr.indexOf(&quot;)&quot;));
+			t = t.split(&quot;,&quot;);
+			for (var i = 0; i &lt; t.length; i++) {
+				var n = parseInt(t[i]).toString(16);
+				if (n.length &lt; 2) {
+					n = &quot;0&quot; + n;
+				}
+				t[i] = n;
+			}
+			ret = &quot;#&quot; + t.join(&quot;&quot;);
+		} else {
+			if (clr.length == 4) {
+				ret = &quot;#&quot; + clr.substring(1, 2) + clr.substring(1, 2) + clr.substring(2, 3) + clr.substring(2, 3) + clr.substring(3, 4) + clr.substring(3, 4);
+			} else {
+				ret = clr;
+			}
+		}
+	}
+	return ret;
+}};
+

Added: tags/parley-0.55/root/static/magic/src/lfx/shadow.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/shadow.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/shadow.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,75 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lfx.shadow&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.lfx.shadow = function (node) {
+	this.shadowPng = dojo.uri.moduleUri(&quot;dojo.html&quot;, &quot;images/shadow&quot;);
+	this.shadowThickness = 8;
+	this.shadowOffset = 15;
+	this.init(node);
+};
+dojo.extend(dojo.lfx.shadow, {init:function (node) {
+	this.node = node;
+	this.pieces = {};
+	var x1 = -1 * this.shadowThickness;
+	var y0 = this.shadowOffset;
+	var y1 = this.shadowOffset + this.shadowThickness;
+	this._makePiece(&quot;tl&quot;, &quot;top&quot;, y0, &quot;left&quot;, x1);
+	this._makePiece(&quot;l&quot;, &quot;top&quot;, y1, &quot;left&quot;, x1, &quot;scale&quot;);
+	this._makePiece(&quot;tr&quot;, &quot;top&quot;, y0, &quot;left&quot;, 0);
+	this._makePiece(&quot;r&quot;, &quot;top&quot;, y1, &quot;left&quot;, 0, &quot;scale&quot;);
+	this._makePiece(&quot;bl&quot;, &quot;top&quot;, 0, &quot;left&quot;, x1);
+	this._makePiece(&quot;b&quot;, &quot;top&quot;, 0, &quot;left&quot;, 0, &quot;crop&quot;);
+	this._makePiece(&quot;br&quot;, &quot;top&quot;, 0, &quot;left&quot;, 0);
+}, _makePiece:function (name, vertAttach, vertCoord, horzAttach, horzCoord, sizing) {
+	var img;
+	var url = this.shadowPng + name.toUpperCase() + &quot;.png&quot;;
+	if (dojo.render.html.ie55 || dojo.render.html.ie60) {
+		img = dojo.doc().createElement(&quot;div&quot;);
+		img.style.filter = &quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(src='&quot; + url + &quot;'&quot; + (sizing ? &quot;, sizingMethod='&quot; + sizing + &quot;'&quot; : &quot;&quot;) + &quot;)&quot;;
+	} else {
+		img = dojo.doc().createElement(&quot;img&quot;);
+		img.src = url;
+	}
+	img.style.position = &quot;absolute&quot;;
+	img.style[vertAttach] = vertCoord + &quot;px&quot;;
+	img.style[horzAttach] = horzCoord + &quot;px&quot;;
+	img.style.width = this.shadowThickness + &quot;px&quot;;
+	img.style.height = this.shadowThickness + &quot;px&quot;;
+	this.pieces[name] = img;
+	this.node.appendChild(img);
+}, size:function (width, height) {
+	var sideHeight = height - (this.shadowOffset + this.shadowThickness + 1);
+	if (sideHeight &lt; 0) {
+		sideHeight = 0;
+	}
+	if (height &lt; 1) {
+		height = 1;
+	}
+	if (width &lt; 1) {
+		width = 1;
+	}
+	with (this.pieces) {
+		l.style.height = sideHeight + &quot;px&quot;;
+		r.style.height = sideHeight + &quot;px&quot;;
+		b.style.width = (width - 1) + &quot;px&quot;;
+		bl.style.top = (height - 1) + &quot;px&quot;;
+		b.style.top = (height - 1) + &quot;px&quot;;
+		br.style.top = (height - 1) + &quot;px&quot;;
+		tr.style.left = (width - 1) + &quot;px&quot;;
+		r.style.left = (width - 1) + &quot;px&quot;;
+		br.style.left = (width - 1) + &quot;px&quot;;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/lfx/toggle.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/lfx/toggle.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/lfx/toggle.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,41 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.lfx.toggle&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.lfx.toggle.plain = {show:function (node, duration, easing, callback) {
+	dojo.html.show(node);
+	if (dojo.lang.isFunction(callback)) {
+		callback();
+	}
+}, hide:function (node, duration, easing, callback) {
+	dojo.html.hide(node);
+	if (dojo.lang.isFunction(callback)) {
+		callback();
+	}
+}};
+dojo.lfx.toggle.fade = {show:function (node, duration, easing, callback) {
+	dojo.lfx.fadeShow(node, duration, easing, callback).play();
+}, hide:function (node, duration, easing, callback) {
+	dojo.lfx.fadeHide(node, duration, easing, callback).play();
+}};
+dojo.lfx.toggle.wipe = {show:function (node, duration, easing, callback) {
+	dojo.lfx.wipeIn(node, duration, easing, callback).play();
+}, hide:function (node, duration, easing, callback) {
+	dojo.lfx.wipeOut(node, duration, easing, callback).play();
+}};
+dojo.lfx.toggle.explode = {show:function (node, duration, easing, callback, explodeSrc) {
+	dojo.lfx.explode(explodeSrc || {x:0, y:0, width:0, height:0}, node, duration, easing, callback).play();
+}, hide:function (node, duration, easing, callback, explodeSrc) {
+	dojo.lfx.implode(node, explodeSrc || {x:0, y:0, width:0, height:0}, duration, easing, callback).play();
+}};
+

Added: tags/parley-0.55/root/static/magic/src/loader.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/loader.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/loader.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,448 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+(function () {
+	var _addHostEnv = {pkgFileName:&quot;__package__&quot;, loading_modules_:{}, loaded_modules_:{}, addedToLoadingCount:[], removedFromLoadingCount:[], inFlightCount:0, modulePrefixes_:{dojo:{name:&quot;dojo&quot;, value:&quot;src&quot;}}, setModulePrefix:function (module, prefix) {
+		this.modulePrefixes_[module] = {name:module, value:prefix};
+	}, moduleHasPrefix:function (module) {
+		var mp = this.modulePrefixes_;
+		return Boolean(mp[module] &amp;&amp; mp[module].value);
+	}, getModulePrefix:function (module) {
+		if (this.moduleHasPrefix(module)) {
+			return this.modulePrefixes_[module].value;
+		}
+		return module;
+	}, getTextStack:[], loadUriStack:[], loadedUris:[], post_load_:false, modulesLoadedListeners:[], unloadListeners:[], loadNotifying:false};
+	for (var param in _addHostEnv) {
+		dojo.hostenv[param] = _addHostEnv[param];
+	}
+})();
+dojo.hostenv.loadPath = function (relpath, module, cb) {
+	var uri;
+	if (relpath.charAt(0) == &quot;/&quot; || relpath.match(/^\w+:/)) {
+		uri = relpath;
+	} else {
+		uri = this.getBaseScriptUri() + relpath;
+	}
+	if (djConfig.cacheBust &amp;&amp; dojo.render.html.capable) {
+		uri += &quot;?&quot; + String(djConfig.cacheBust).replace(/\W+/g, &quot;&quot;);
+	}
+	try {
+		return !module ? this.loadUri(uri, cb) : this.loadUriAndCheck(uri, module, cb);
+	}
+	catch (e) {
+		dojo.debug(e);
+		return false;
+	}
+};
+dojo.hostenv.loadUri = function (uri, cb) {
+	if (this.loadedUris[uri]) {
+		return true;
+	}
+	var contents = this.getText(uri, null, true);
+	if (!contents) {
+		return false;
+	}
+	this.loadedUris[uri] = true;
+	if (cb) {
+		contents = &quot;(&quot; + contents + &quot;)&quot;;
+	}
+	var value = dj_eval(contents);
+	if (cb) {
+		cb(value);
+	}
+	return true;
+};
+dojo.hostenv.loadUriAndCheck = function (uri, moduleName, cb) {
+	var ok = true;
+	try {
+		ok = this.loadUri(uri, cb);
+	}
+	catch (e) {
+		dojo.debug(&quot;failed loading &quot;, uri, &quot; with error: &quot;, e);
+	}
+	return Boolean(ok &amp;&amp; this.findModule(moduleName, false));
+};
+dojo.loaded = function () {
+};
+dojo.unloaded = function () {
+};
+dojo.hostenv.loaded = function () {
+	this.loadNotifying = true;
+	this.post_load_ = true;
+	var mll = this.modulesLoadedListeners;
+	for (var x = 0; x &lt; mll.length; x++) {
+		mll[x]();
+	}
+	this.modulesLoadedListeners = [];
+	this.loadNotifying = false;
+	dojo.loaded();
+};
+dojo.hostenv.unloaded = function () {
+	var mll = this.unloadListeners;
+	while (mll.length) {
+		(mll.pop())();
+	}
+	dojo.unloaded();
+};
+dojo.addOnLoad = function (obj, functionName) {
+	var dh = dojo.hostenv;
+	if (arguments.length == 1) {
+		dh.modulesLoadedListeners.push(obj);
+	} else {
+		if (arguments.length &gt; 1) {
+			dh.modulesLoadedListeners.push(function () {
+				obj[functionName]();
+			});
+		}
+	}
+	if (dh.post_load_ &amp;&amp; dh.inFlightCount == 0 &amp;&amp; !dh.loadNotifying) {
+		dh.callLoaded();
+	}
+};
+dojo.addOnUnload = function (obj, functionName) {
+	var dh = dojo.hostenv;
+	if (arguments.length == 1) {
+		dh.unloadListeners.push(obj);
+	} else {
+		if (arguments.length &gt; 1) {
+			dh.unloadListeners.push(function () {
+				obj[functionName]();
+			});
+		}
+	}
+};
+dojo.hostenv.modulesLoaded = function () {
+	if (this.post_load_) {
+		return;
+	}
+	if (this.loadUriStack.length == 0 &amp;&amp; this.getTextStack.length == 0) {
+		if (this.inFlightCount &gt; 0) {
+			dojo.debug(&quot;files still in flight!&quot;);
+			return;
+		}
+		dojo.hostenv.callLoaded();
+	}
+};
+dojo.hostenv.callLoaded = function () {
+	if (typeof setTimeout == &quot;object&quot; || (djConfig[&quot;useXDomain&quot;] &amp;&amp; dojo.render.html.opera)) {
+		setTimeout(&quot;dojo.hostenv.loaded();&quot;, 0);
+	} else {
+		dojo.hostenv.loaded();
+	}
+};
+dojo.hostenv.getModuleSymbols = function (modulename) {
+	var syms = modulename.split(&quot;.&quot;);
+	for (var i = syms.length; i &gt; 0; i--) {
+		var parentModule = syms.slice(0, i).join(&quot;.&quot;);
+		if ((i == 1) &amp;&amp; !this.moduleHasPrefix(parentModule)) {
+			syms[0] = &quot;../&quot; + syms[0];
+		} else {
+			var parentModulePath = this.getModulePrefix(parentModule);
+			if (parentModulePath != parentModule) {
+				syms.splice(0, i, parentModulePath);
+				break;
+			}
+		}
+	}
+	return syms;
+};
+dojo.hostenv._global_omit_module_check = false;
+dojo.hostenv.loadModule = function (moduleName, exactOnly, omitModuleCheck) {
+	if (!moduleName) {
+		return;
+	}
+	omitModuleCheck = this._global_omit_module_check || omitModuleCheck;
+	var module = this.findModule(moduleName, false);
+	if (module) {
+		return module;
+	}
+	if (dj_undef(moduleName, this.loading_modules_)) {
+		this.addedToLoadingCount.push(moduleName);
+	}
+	this.loading_modules_[moduleName] = 1;
+	var relpath = moduleName.replace(/\./g, &quot;/&quot;) + &quot;.js&quot;;
+	var nsyms = moduleName.split(&quot;.&quot;);
+	var syms = this.getModuleSymbols(moduleName);
+	var startedRelative = ((syms[0].charAt(0) != &quot;/&quot;) &amp;&amp; !syms[0].match(/^\w+:/));
+	var last = syms[syms.length - 1];
+	var ok;
+	if (last == &quot;*&quot;) {
+		moduleName = nsyms.slice(0, -1).join(&quot;.&quot;);
+		while (syms.length) {
+			syms.pop();
+			syms.push(this.pkgFileName);
+			relpath = syms.join(&quot;/&quot;) + &quot;.js&quot;;
+			if (startedRelative &amp;&amp; relpath.charAt(0) == &quot;/&quot;) {
+				relpath = relpath.slice(1);
+			}
+			ok = this.loadPath(relpath, !omitModuleCheck ? moduleName : null);
+			if (ok) {
+				break;
+			}
+			syms.pop();
+		}
+	} else {
+		relpath = syms.join(&quot;/&quot;) + &quot;.js&quot;;
+		moduleName = nsyms.join(&quot;.&quot;);
+		var modArg = !omitModuleCheck ? moduleName : null;
+		ok = this.loadPath(relpath, modArg);
+		if (!ok &amp;&amp; !exactOnly) {
+			syms.pop();
+			while (syms.length) {
+				relpath = syms.join(&quot;/&quot;) + &quot;.js&quot;;
+				ok = this.loadPath(relpath, modArg);
+				if (ok) {
+					break;
+				}
+				syms.pop();
+				relpath = syms.join(&quot;/&quot;) + &quot;/&quot; + this.pkgFileName + &quot;.js&quot;;
+				if (startedRelative &amp;&amp; relpath.charAt(0) == &quot;/&quot;) {
+					relpath = relpath.slice(1);
+				}
+				ok = this.loadPath(relpath, modArg);
+				if (ok) {
+					break;
+				}
+			}
+		}
+		if (!ok &amp;&amp; !omitModuleCheck) {
+			dojo.raise(&quot;Could not load '&quot; + moduleName + &quot;'; last tried '&quot; + relpath + &quot;'&quot;);
+		}
+	}
+	if (!omitModuleCheck &amp;&amp; !this[&quot;isXDomain&quot;]) {
+		module = this.findModule(moduleName, false);
+		if (!module) {
+			dojo.raise(&quot;symbol '&quot; + moduleName + &quot;' is not defined after loading '&quot; + relpath + &quot;'&quot;);
+		}
+	}
+	return module;
+};
+dojo.hostenv.startPackage = function (packageName) {
+	var fullPkgName = String(packageName);
+	var strippedPkgName = fullPkgName;
+	var syms = packageName.split(/\./);
+	if (syms[syms.length - 1] == &quot;*&quot;) {
+		syms.pop();
+		strippedPkgName = syms.join(&quot;.&quot;);
+	}
+	var evaledPkg = dojo.evalObjPath(strippedPkgName, true);
+	this.loaded_modules_[fullPkgName] = evaledPkg;
+	this.loaded_modules_[strippedPkgName] = evaledPkg;
+	return evaledPkg;
+};
+dojo.hostenv.findModule = function (moduleName, mustExist) {
+	var lmn = String(moduleName);
+	if (this.loaded_modules_[lmn]) {
+		return this.loaded_modules_[lmn];
+	}
+	if (mustExist) {
+		dojo.raise(&quot;no loaded module named '&quot; + moduleName + &quot;'&quot;);
+	}
+	return null;
+};
+dojo.kwCompoundRequire = function (modMap) {
+	var common = modMap[&quot;common&quot;] || [];
+	var result = modMap[dojo.hostenv.name_] ? common.concat(modMap[dojo.hostenv.name_] || []) : common.concat(modMap[&quot;default&quot;] || []);
+	for (var x = 0; x &lt; result.length; x++) {
+		var curr = result[x];
+		if (curr.constructor == Array) {
+			dojo.hostenv.loadModule.apply(dojo.hostenv, curr);
+		} else {
+			dojo.hostenv.loadModule(curr);
+		}
+	}
+};
+dojo.require = function (resourceName) {
+	dojo.hostenv.loadModule.apply(dojo.hostenv, arguments);
+};
+dojo.requireIf = function (condition, resourceName) {
+	var arg0 = arguments[0];
+	if ((arg0 === true) || (arg0 == &quot;common&quot;) || (arg0 &amp;&amp; dojo.render[arg0].capable)) {
+		var args = [];
+		for (var i = 1; i &lt; arguments.length; i++) {
+			args.push(arguments[i]);
+		}
+		dojo.require.apply(dojo, args);
+	}
+};
+dojo.requireAfterIf = dojo.requireIf;
+dojo.provide = function (resourceName) {
+	return dojo.hostenv.startPackage.apply(dojo.hostenv, arguments);
+};
+dojo.registerModulePath = function (module, prefix) {
+	return dojo.hostenv.setModulePrefix(module, prefix);
+};
+if (djConfig[&quot;modulePaths&quot;]) {
+	for (var param in djConfig[&quot;modulePaths&quot;]) {
+		dojo.registerModulePath(param, djConfig[&quot;modulePaths&quot;][param]);
+	}
+}
+dojo.setModulePrefix = function (module, prefix) {
+	dojo.deprecated(&quot;dojo.setModulePrefix(\&quot;&quot; + module + &quot;\&quot;, \&quot;&quot; + prefix + &quot;\&quot;)&quot;, &quot;replaced by dojo.registerModulePath&quot;, &quot;0.5&quot;);
+	return dojo.registerModulePath(module, prefix);
+};
+dojo.exists = function (obj, name) {
+	var p = name.split(&quot;.&quot;);
+	for (var i = 0; i &lt; p.length; i++) {
+		if (!obj[p[i]]) {
+			return false;
+		}
+		obj = obj[p[i]];
+	}
+	return true;
+};
+dojo.hostenv.normalizeLocale = function (locale) {
+	var result = locale ? locale.toLowerCase() : dojo.locale;
+	if (result == &quot;root&quot;) {
+		result = &quot;ROOT&quot;;
+	}
+	return result;
+};
+dojo.hostenv.searchLocalePath = function (locale, down, searchFunc) {
+	locale = dojo.hostenv.normalizeLocale(locale);
+	var elements = locale.split(&quot;-&quot;);
+	var searchlist = [];
+	for (var i = elements.length; i &gt; 0; i--) {
+		searchlist.push(elements.slice(0, i).join(&quot;-&quot;));
+	}
+	searchlist.push(false);
+	if (down) {
+		searchlist.reverse();
+	}
+	for (var j = searchlist.length - 1; j &gt;= 0; j--) {
+		var loc = searchlist[j] || &quot;ROOT&quot;;
+		var stop = searchFunc(loc);
+		if (stop) {
+			break;
+		}
+	}
+};
+dojo.hostenv.localesGenerated;
+dojo.hostenv.registerNlsPrefix = function () {
+	dojo.registerModulePath(&quot;nls&quot;, &quot;nls&quot;);
+};
+dojo.hostenv.preloadLocalizations = function () {
+	if (dojo.hostenv.localesGenerated) {
+		dojo.hostenv.registerNlsPrefix();
+		function preload(locale) {
+			locale = dojo.hostenv.normalizeLocale(locale);
+			dojo.hostenv.searchLocalePath(locale, true, function (loc) {
+				for (var i = 0; i &lt; dojo.hostenv.localesGenerated.length; i++) {
+					if (dojo.hostenv.localesGenerated[i] == loc) {
+						dojo[&quot;require&quot;](&quot;nls.dojo_&quot; + loc);
+						return true;
+					}
+				}
+				return false;
+			});
+		}
+		preload();
+		var extra = djConfig.extraLocale || [];
+		for (var i = 0; i &lt; extra.length; i++) {
+			preload(extra[i]);
+		}
+	}
+	dojo.hostenv.preloadLocalizations = function () {
+	};
+};
+dojo.requireLocalization = function (moduleName, bundleName, locale, availableFlatLocales) {
+	dojo.hostenv.preloadLocalizations();
+	var targetLocale = dojo.hostenv.normalizeLocale(locale);
+	var bundlePackage = [moduleName, &quot;nls&quot;, bundleName].join(&quot;.&quot;);
+	var bestLocale = &quot;&quot;;
+	if (availableFlatLocales) {
+		var flatLocales = availableFlatLocales.split(&quot;,&quot;);
+		for (var i = 0; i &lt; flatLocales.length; i++) {
+			if (targetLocale.indexOf(flatLocales[i]) == 0) {
+				if (flatLocales[i].length &gt; bestLocale.length) {
+					bestLocale = flatLocales[i];
+				}
+			}
+		}
+		if (!bestLocale) {
+			bestLocale = &quot;ROOT&quot;;
+		}
+	}
+	var tempLocale = availableFlatLocales ? bestLocale : targetLocale;
+	var bundle = dojo.hostenv.findModule(bundlePackage);
+	var localizedBundle = null;
+	if (bundle) {
+		if (djConfig.localizationComplete &amp;&amp; bundle._built) {
+			return;
+		}
+		var jsLoc = tempLocale.replace(&quot;-&quot;, &quot;_&quot;);
+		var translationPackage = bundlePackage + &quot;.&quot; + jsLoc;
+		localizedBundle = dojo.hostenv.findModule(translationPackage);
+	}
+	if (!localizedBundle) {
+		bundle = dojo.hostenv.startPackage(bundlePackage);
+		var syms = dojo.hostenv.getModuleSymbols(moduleName);
+		var modpath = syms.concat(&quot;nls&quot;).join(&quot;/&quot;);
+		var parent;
+		dojo.hostenv.searchLocalePath(tempLocale, availableFlatLocales, function (loc) {
+			var jsLoc = loc.replace(&quot;-&quot;, &quot;_&quot;);
+			var translationPackage = bundlePackage + &quot;.&quot; + jsLoc;
+			var loaded = false;
+			if (!dojo.hostenv.findModule(translationPackage)) {
+				dojo.hostenv.startPackage(translationPackage);
+				var module = [modpath];
+				if (loc != &quot;ROOT&quot;) {
+					module.push(loc);
+				}
+				module.push(bundleName);
+				var filespec = module.join(&quot;/&quot;) + &quot;.js&quot;;
+				loaded = dojo.hostenv.loadPath(filespec, null, function (hash) {
+					var clazz = function () {
+					};
+					clazz.prototype = parent;
+					bundle[jsLoc] = new clazz();
+					for (var j in hash) {
+						bundle[jsLoc][j] = hash[j];
+					}
+				});
+			} else {
+				loaded = true;
+			}
+			if (loaded &amp;&amp; bundle[jsLoc]) {
+				parent = bundle[jsLoc];
+			} else {
+				bundle[jsLoc] = parent;
+			}
+			if (availableFlatLocales) {
+				return true;
+			}
+		});
+	}
+	if (availableFlatLocales &amp;&amp; targetLocale != bestLocale) {
+		bundle[targetLocale.replace(&quot;-&quot;, &quot;_&quot;)] = bundle[bestLocale.replace(&quot;-&quot;, &quot;_&quot;)];
+	}
+};
+(function () {
+	var extra = djConfig.extraLocale;
+	if (extra) {
+		if (!extra instanceof Array) {
+			extra = [extra];
+		}
+		var req = dojo.requireLocalization;
+		dojo.requireLocalization = function (m, b, locale, availableFlatLocales) {
+			req(m, b, locale, availableFlatLocales);
+			if (locale) {
+				return;
+			}
+			for (var i = 0; i &lt; extra.length; i++) {
+				req(m, b, extra[i], availableFlatLocales);
+			}
+		};
+	}
+})();
+

Added: tags/parley-0.55/root/static/magic/src/loader_xd.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/loader_xd.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/loader_xd.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,408 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.hostenv.resetXd = function () {
+	this.isXDomain = djConfig.useXDomain || false;
+	this.xdTimer = 0;
+	this.xdInFlight = {};
+	this.xdOrderedReqs = [];
+	this.xdDepMap = {};
+	this.xdContents = [];
+	this.xdDefList = [];
+};
+dojo.hostenv.resetXd();
+dojo.hostenv.createXdPackage = function (contents, resourceName, resourcePath) {
+	var deps = [];
+	var depRegExp = /dojo.(requireLocalization|require|requireIf|requireAll|provide|requireAfterIf|requireAfter|kwCompoundRequire|conditionalRequire|hostenv\.conditionalLoadModule|.hostenv\.loadModule|hostenv\.moduleLoaded)\(([\w\W]*?)\)/mg;
+	var match;
+	while ((match = depRegExp.exec(contents)) != null) {
+		if (match[1] == &quot;requireLocalization&quot;) {
+			eval(match[0]);
+		} else {
+			deps.push(&quot;\&quot;&quot; + match[1] + &quot;\&quot;, &quot; + match[2]);
+		}
+	}
+	var output = [];
+	output.push(&quot;dojo.hostenv.packageLoaded({\n&quot;);
+	if (deps.length &gt; 0) {
+		output.push(&quot;depends: [&quot;);
+		for (var i = 0; i &lt; deps.length; i++) {
+			if (i &gt; 0) {
+				output.push(&quot;,\n&quot;);
+			}
+			output.push(&quot;[&quot; + deps[i] + &quot;]&quot;);
+		}
+		output.push(&quot;],&quot;);
+	}
+	output.push(&quot;\ndefinePackage: function(dojo){&quot;);
+	output.push(contents);
+	output.push(&quot;\n}, resourceName: '&quot; + resourceName + &quot;', resourcePath: '&quot; + resourcePath + &quot;'});&quot;);
+	return output.join(&quot;&quot;);
+};
+dojo.hostenv.loadPath = function (relpath, module, cb) {
+	var colonIndex = relpath.indexOf(&quot;:&quot;);
+	var slashIndex = relpath.indexOf(&quot;/&quot;);
+	var uri;
+	var currentIsXDomain = false;
+	if (colonIndex &gt; 0 &amp;&amp; colonIndex &lt; slashIndex) {
+		uri = relpath;
+		this.isXDomain = currentIsXDomain = true;
+	} else {
+		uri = this.getBaseScriptUri() + relpath;
+		colonIndex = uri.indexOf(&quot;:&quot;);
+		slashIndex = uri.indexOf(&quot;/&quot;);
+		if (colonIndex &gt; 0 &amp;&amp; colonIndex &lt; slashIndex &amp;&amp; (!location.host || uri.indexOf(&quot;<A HREF="http://">http://</A>&quot; + location.host) != 0)) {
+			this.isXDomain = currentIsXDomain = true;
+		}
+	}
+	if (djConfig.cacheBust &amp;&amp; dojo.render.html.capable) {
+		uri += &quot;?&quot; + String(djConfig.cacheBust).replace(/\W+/g, &quot;&quot;);
+	}
+	try {
+		return ((!module || this.isXDomain) ? this.loadUri(uri, cb, currentIsXDomain, module) : this.loadUriAndCheck(uri, module, cb));
+	}
+	catch (e) {
+		dojo.debug(e);
+		return false;
+	}
+};
+dojo.hostenv.loadUri = function (uri, cb, currentIsXDomain, module) {
+	if (this.loadedUris[uri]) {
+		return 1;
+	}
+	if (this.isXDomain &amp;&amp; module) {
+		if (uri.indexOf(&quot;__package__&quot;) != -1) {
+			module += &quot;.*&quot;;
+		}
+		this.xdOrderedReqs.push(module);
+		if (currentIsXDomain || uri.indexOf(&quot;/nls/&quot;) == -1) {
+			this.xdInFlight[module] = true;
+			this.inFlightCount++;
+		}
+		if (!this.xdTimer) {
+			this.xdTimer = setInterval(&quot;dojo.hostenv.watchInFlightXDomain();&quot;, 100);
+		}
+		this.xdStartTime = (new Date()).getTime();
+	}
+	if (currentIsXDomain) {
+		var lastIndex = uri.lastIndexOf(&quot;.&quot;);
+		if (lastIndex &lt;= 0) {
+			lastIndex = uri.length - 1;
+		}
+		var xdUri = uri.substring(0, lastIndex) + &quot;.xd&quot;;
+		if (lastIndex != uri.length - 1) {
+			xdUri += uri.substring(lastIndex, uri.length);
+		}
+		var element = document.createElement(&quot;script&quot;);
+		element.type = &quot;text/javascript&quot;;
+		element.src = xdUri;
+		if (!this.headElement) {
+			this.headElement = document.getElementsByTagName(&quot;head&quot;)[0];
+			if (!this.headElement) {
+				this.headElement = document.getElementsByTagName(&quot;html&quot;)[0];
+			}
+		}
+		this.headElement.appendChild(element);
+	} else {
+		var contents = this.getText(uri, null, true);
+		if (contents == null) {
+			return 0;
+		}
+		if (this.isXDomain &amp;&amp; uri.indexOf(&quot;/nls/&quot;) == -1) {
+			var pkg = this.createXdPackage(contents, module, uri);
+			dj_eval(pkg);
+		} else {
+			if (cb) {
+				contents = &quot;(&quot; + contents + &quot;)&quot;;
+			}
+			var value = dj_eval(contents);
+			if (cb) {
+				cb(value);
+			}
+		}
+	}
+	this.loadedUris[uri] = true;
+	return 1;
+};
+dojo.hostenv.packageLoaded = function (pkg) {
+	var deps = pkg.depends;
+	var requireList = null;
+	var requireAfterList = null;
+	var provideList = [];
+	if (deps &amp;&amp; deps.length &gt; 0) {
+		var dep = null;
+		var insertHint = 0;
+		var attachedPackage = false;
+		for (var i = 0; i &lt; deps.length; i++) {
+			dep = deps[i];
+			if (dep[0] == &quot;provide&quot; || dep[0] == &quot;hostenv.moduleLoaded&quot;) {
+				provideList.push(dep[1]);
+			} else {
+				if (!requireList) {
+					requireList = [];
+				}
+				if (!requireAfterList) {
+					requireAfterList = [];
+				}
+				var unpackedDeps = this.unpackXdDependency(dep);
+				if (unpackedDeps.requires) {
+					requireList = requireList.concat(unpackedDeps.requires);
+				}
+				if (unpackedDeps.requiresAfter) {
+					requireAfterList = requireAfterList.concat(unpackedDeps.requiresAfter);
+				}
+			}
+			var depType = dep[0];
+			var objPath = depType.split(&quot;.&quot;);
+			if (objPath.length == 2) {
+				dojo[objPath[0]][objPath[1]].apply(dojo[objPath[0]], dep.slice(1));
+			} else {
+				dojo[depType].apply(dojo, dep.slice(1));
+			}
+		}
+		var contentIndex = this.xdContents.push({content:pkg.definePackage, resourceName:pkg[&quot;resourceName&quot;], resourcePath:pkg[&quot;resourcePath&quot;], isDefined:false}) - 1;
+		for (var i = 0; i &lt; provideList.length; i++) {
+			this.xdDepMap[provideList[i]] = {requires:requireList, requiresAfter:requireAfterList, contentIndex:contentIndex};
+		}
+		for (var i = 0; i &lt; provideList.length; i++) {
+			this.xdInFlight[provideList[i]] = false;
+		}
+	}
+};
+dojo.hostenv.xdLoadFlattenedBundle = function (moduleName, bundleName, locale, bundleData) {
+	locale = locale || &quot;root&quot;;
+	var jsLoc = dojo.hostenv.normalizeLocale(locale).replace(&quot;-&quot;, &quot;_&quot;);
+	var bundlePackage = [moduleName, &quot;nls&quot;, bundleName].join(&quot;.&quot;);
+	var bundle = dojo.hostenv.startPackage(bundlePackage);
+	bundle[jsLoc] = bundleData;
+	var mapName = [moduleName, jsLoc, bundleName].join(&quot;.&quot;);
+	var bundleMap = dojo.hostenv.xdBundleMap[mapName];
+	if (bundleMap) {
+		for (var param in bundleMap) {
+			bundle[param] = bundleData;
+		}
+	}
+};
+dojo.hostenv.xdBundleMap = {};
+dojo.xdRequireLocalization = function (moduleName, bundleName, locale, availableFlatLocales) {
+	var locales = availableFlatLocales.split(&quot;,&quot;);
+	var jsLoc = dojo.hostenv.normalizeLocale(locale);
+	var bestLocale = &quot;&quot;;
+	for (var i = 0; i &lt; locales.length; i++) {
+		if (jsLoc.indexOf(locales[i]) == 0) {
+			if (locales[i].length &gt; bestLocale.length) {
+				bestLocale = locales[i];
+			}
+		}
+	}
+	var fixedBestLocale = bestLocale.replace(&quot;-&quot;, &quot;_&quot;);
+	var bundlePackage = dojo.evalObjPath([moduleName, &quot;nls&quot;, bundleName].join(&quot;.&quot;));
+	if (bundlePackage &amp;&amp; bundlePackage[fixedBestLocale]) {
+		bundle[jsLoc.replace(&quot;-&quot;, &quot;_&quot;)] = bundlePackage[fixedBestLocale];
+	} else {
+		var mapName = [moduleName, (fixedBestLocale || &quot;root&quot;), bundleName].join(&quot;.&quot;);
+		var bundleMap = dojo.hostenv.xdBundleMap[mapName];
+		if (!bundleMap) {
+			bundleMap = dojo.hostenv.xdBundleMap[mapName] = {};
+		}
+		bundleMap[jsLoc.replace(&quot;-&quot;, &quot;_&quot;)] = true;
+		dojo.require(moduleName + &quot;.nls&quot; + (bestLocale ? &quot;.&quot; + bestLocale : &quot;&quot;) + &quot;.&quot; + bundleName);
+	}
+};
+(function () {
+	var extra = djConfig.extraLocale;
+	if (extra) {
+		if (!extra instanceof Array) {
+			extra = [extra];
+		}
+		dojo._xdReqLoc = dojo.xdRequireLocalization;
+		dojo.xdRequireLocalization = function (m, b, locale, fLocales) {
+			dojo._xdReqLoc(m, b, locale, fLocales);
+			if (locale) {
+				return;
+			}
+			for (var i = 0; i &lt; extra.length; i++) {
+				dojo._xdReqLoc(m, b, extra[i], fLocales);
+			}
+		};
+	}
+})();
+dojo.hostenv.unpackXdDependency = function (dep) {
+	var newDeps = null;
+	var newAfterDeps = null;
+	switch (dep[0]) {
+	  case &quot;requireIf&quot;:
+	  case &quot;requireAfterIf&quot;:
+	  case &quot;conditionalRequire&quot;:
+		if ((dep[1] === true) || (dep[1] == &quot;common&quot;) || (dep[1] &amp;&amp; dojo.render[dep[1]].capable)) {
+			newDeps = [{name:dep[2], content:null}];
+		}
+		break;
+	  case &quot;requireAll&quot;:
+		dep.shift();
+		newDeps = dep;
+		dojo.hostenv.flattenRequireArray(newDeps);
+		break;
+	  case &quot;kwCompoundRequire&quot;:
+	  case &quot;hostenv.conditionalLoadModule&quot;:
+		var modMap = dep[1];
+		var common = modMap[&quot;common&quot;] || [];
+		var newDeps = (modMap[dojo.hostenv.name_]) ? common.concat(modMap[dojo.hostenv.name_] || []) : common.concat(modMap[&quot;default&quot;] || []);
+		dojo.hostenv.flattenRequireArray(newDeps);
+		break;
+	  case &quot;require&quot;:
+	  case &quot;requireAfter&quot;:
+	  case &quot;hostenv.loadModule&quot;:
+		newDeps = [{name:dep[1], content:null}];
+		break;
+	}
+	if (dep[0] == &quot;requireAfterIf&quot; || dep[0] == &quot;requireIf&quot;) {
+		newAfterDeps = newDeps;
+		newDeps = null;
+	}
+	return {requires:newDeps, requiresAfter:newAfterDeps};
+};
+dojo.hostenv.xdWalkReqs = function () {
+	var reqChain = null;
+	var req;
+	for (var i = 0; i &lt; this.xdOrderedReqs.length; i++) {
+		req = this.xdOrderedReqs[i];
+		if (this.xdDepMap[req]) {
+			reqChain = [req];
+			reqChain[req] = true;
+			this.xdEvalReqs(reqChain);
+		}
+	}
+};
+dojo.hostenv.xdEvalReqs = function (reqChain) {
+	while (reqChain.length &gt; 0) {
+		var req = reqChain[reqChain.length - 1];
+		var pkg = this.xdDepMap[req];
+		if (pkg) {
+			var reqs = pkg.requires;
+			if (reqs &amp;&amp; reqs.length &gt; 0) {
+				var nextReq;
+				for (var i = 0; i &lt; reqs.length; i++) {
+					nextReq = reqs[i].name;
+					if (nextReq &amp;&amp; !reqChain[nextReq]) {
+						reqChain.push(nextReq);
+						reqChain[nextReq] = true;
+						this.xdEvalReqs(reqChain);
+					}
+				}
+			}
+			var contents = this.xdContents[pkg.contentIndex];
+			if (!contents.isDefined) {
+				var content = contents.content;
+				content[&quot;resourceName&quot;] = contents[&quot;resourceName&quot;];
+				content[&quot;resourcePath&quot;] = contents[&quot;resourcePath&quot;];
+				this.xdDefList.push(content);
+				contents.isDefined = true;
+			}
+			this.xdDepMap[req] = null;
+			var reqs = pkg.requiresAfter;
+			if (reqs &amp;&amp; reqs.length &gt; 0) {
+				var nextReq;
+				for (var i = 0; i &lt; reqs.length; i++) {
+					nextReq = reqs[i].name;
+					if (nextReq &amp;&amp; !reqChain[nextReq]) {
+						reqChain.push(nextReq);
+						reqChain[nextReq] = true;
+						this.xdEvalReqs(reqChain);
+					}
+				}
+			}
+		}
+		reqChain.pop();
+	}
+};
+dojo.hostenv.clearXdInterval = function () {
+	clearInterval(this.xdTimer);
+	this.xdTimer = 0;
+};
+dojo.hostenv.watchInFlightXDomain = function () {
+	var waitInterval = (djConfig.xdWaitSeconds || 15) * 1000;
+	if (this.xdStartTime + waitInterval &lt; (new Date()).getTime()) {
+		this.clearXdInterval();
+		var noLoads = &quot;&quot;;
+		for (var param in this.xdInFlight) {
+			if (this.xdInFlight[param]) {
+				noLoads += param + &quot; &quot;;
+			}
+		}
+		dojo.raise(&quot;Could not load cross-domain packages: &quot; + noLoads);
+	}
+	for (var param in this.xdInFlight) {
+		if (this.xdInFlight[param]) {
+			return;
+		}
+	}
+	this.clearXdInterval();
+	this.xdWalkReqs();
+	var defLength = this.xdDefList.length;
+	for (var i = 0; i &lt; defLength; i++) {
+		var content = dojo.hostenv.xdDefList[i];
+		if (djConfig[&quot;debugAtAllCosts&quot;] &amp;&amp; content[&quot;resourceName&quot;]) {
+			if (!this[&quot;xdDebugQueue&quot;]) {
+				this.xdDebugQueue = [];
+			}
+			this.xdDebugQueue.push({resourceName:content.resourceName, resourcePath:content.resourcePath});
+		} else {
+			content(dojo);
+		}
+	}
+	for (var i = 0; i &lt; this.xdContents.length; i++) {
+		var current = this.xdContents[i];
+		if (current.content &amp;&amp; !current.isDefined) {
+			current.content(dojo);
+		}
+	}
+	this.resetXd();
+	if (this[&quot;xdDebugQueue&quot;] &amp;&amp; this.xdDebugQueue.length &gt; 0) {
+		this.xdDebugFileLoaded();
+	} else {
+		this.xdNotifyLoaded();
+	}
+};
+dojo.hostenv.xdNotifyLoaded = function () {
+	this.inFlightCount = 0;
+	if (this._djInitFired &amp;&amp; !this.loadNotifying) {
+		this.callLoaded();
+	}
+};
+dojo.hostenv.flattenRequireArray = function (target) {
+	if (target) {
+		for (var i = 0; i &lt; target.length; i++) {
+			if (target[i] instanceof Array) {
+				target[i] = {name:target[i][0], content:null};
+			} else {
+				target[i] = {name:target[i], content:null};
+			}
+		}
+	}
+};
+dojo.hostenv.xdHasCalledPreload = false;
+dojo.hostenv.xdRealCallLoaded = dojo.hostenv.callLoaded;
+dojo.hostenv.callLoaded = function () {
+	if (this.xdHasCalledPreload || dojo.hostenv.getModulePrefix(&quot;dojo&quot;) == &quot;src&quot; || !this.localesGenerated) {
+		this.xdRealCallLoaded();
+	} else {
+		if (this.localesGenerated) {
+			this.registerNlsPrefix = function () {
+				dojo.registerModulePath(&quot;nls&quot;, dojo.hostenv.getModulePrefix(&quot;dojo&quot;) + &quot;/../nls&quot;);
+			};
+			this.preloadLocalizations();
+		}
+	}
+	this.xdHasCalledPreload = true;
+};
+

Added: tags/parley-0.55/root/static/magic/src/logging/ConsoleLogger.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/logging/ConsoleLogger.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/logging/ConsoleLogger.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,86 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.logging.ConsoleLogger&quot;);
+dojo.require(&quot;dojo.logging.Logger&quot;);
+dojo.lang.extend(dojo.logging.MemoryLogHandler, {debug:function () {
+	dojo.hostenv.println.apply(this, arguments);
+}, info:function () {
+	dojo.hostenv.println.apply(this, arguments);
+}, warn:function () {
+	dojo.hostenv.println.apply(this, arguments);
+}, error:function () {
+	dojo.hostenv.println.apply(this, arguments);
+}, critical:function () {
+	dojo.hostenv.println.apply(this, arguments);
+}, emit:function (record) {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	var funcName = null;
+	switch (record.level) {
+	  case 1:
+		funcName = &quot;debug&quot;;
+		break;
+	  case 2:
+		funcName = &quot;info&quot;;
+		break;
+	  case 3:
+		funcName = &quot;warn&quot;;
+		break;
+	  case 4:
+		funcName = &quot;error&quot;;
+		break;
+	  case 5:
+		funcName = &quot;critical&quot;;
+		break;
+	  default:
+		funcName = &quot;debug&quot;;
+	}
+	var logStr = String(dojo.log.getLevelName(record.level) + &quot;: &quot; + record.time.toLocaleTimeString()) + &quot;: &quot; + record.message;
+	if (record.msgArgs &amp;&amp; record.msgArgs.length &gt; 0) {
+		this[funcName].call(this, logStr, record.msgArgs);
+	} else {
+		this[funcName].call(this, logStr);
+	}
+	this.data.push(record);
+	if (this.numRecords != -1) {
+		while (this.data.length &gt; this.numRecords) {
+			this.data.shift();
+		}
+	}
+}});
+if (!dj_undef(&quot;console&quot;) &amp;&amp; !dj_undef(&quot;info&quot;, console)) {
+	dojo.lang.extend(dojo.logging.MemoryLogHandler, {debug:function () {
+		console.debug.apply(this, arguments);
+	}, info:function () {
+		console.info.apply(this, arguments);
+	}, warn:function () {
+		console.warn.apply(this, arguments);
+	}, error:function () {
+		console.error.apply(this, arguments);
+	}, critical:function () {
+		console.error.apply(this, arguments);
+	}});
+	dojo.lang.extend(dojo.logging.Logger, {exception:function (msg, e, squelch) {
+		var args = [msg];
+		if (e) {
+			msg += &quot; : &quot; + e.name + &quot; &quot; + (e.description || e.message);
+			args.push(e);
+		}
+		this.logType(&quot;ERROR&quot;, args);
+		if (!squelch) {
+			throw e;
+		}
+	}});
+}
+

Added: tags/parley-0.55/root/static/magic/src/logging/Logger.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/logging/Logger.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/logging/Logger.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,216 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.logging.Logger&quot;);
+dojo.provide(&quot;dojo.logging.LogFilter&quot;);
+dojo.provide(&quot;dojo.logging.Record&quot;);
+dojo.provide(&quot;dojo.log&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.logging.Record = function (logLevel, message) {
+	this.level = logLevel;
+	this.message = &quot;&quot;;
+	this.msgArgs = [];
+	this.time = new Date();
+	if (dojo.lang.isArray(message)) {
+		if (message.length &gt; 0 &amp;&amp; dojo.lang.isString(message[0])) {
+			this.message = message.shift();
+		}
+		this.msgArgs = message;
+	} else {
+		this.message = message;
+	}
+};
+dojo.logging.LogFilter = function (loggerChain) {
+	this.passChain = loggerChain || &quot;&quot;;
+	this.filter = function (record) {
+		return true;
+	};
+};
+dojo.logging.Logger = function () {
+	this.cutOffLevel = 0;
+	this.propagate = true;
+	this.parent = null;
+	this.data = [];
+	this.filters = [];
+	this.handlers = [];
+};
+dojo.extend(dojo.logging.Logger, {_argsToArr:function (args) {
+	var ret = [];
+	for (var x = 0; x &lt; args.length; x++) {
+		ret.push(args[x]);
+	}
+	return ret;
+}, setLevel:function (lvl) {
+	this.cutOffLevel = parseInt(lvl);
+}, isEnabledFor:function (lvl) {
+	return parseInt(lvl) &gt;= this.cutOffLevel;
+}, getEffectiveLevel:function () {
+	if ((this.cutOffLevel == 0) &amp;&amp; (this.parent)) {
+		return this.parent.getEffectiveLevel();
+	}
+	return this.cutOffLevel;
+}, addFilter:function (flt) {
+	this.filters.push(flt);
+	return this.filters.length - 1;
+}, removeFilterByIndex:function (fltIndex) {
+	if (this.filters[fltIndex]) {
+		delete this.filters[fltIndex];
+		return true;
+	}
+	return false;
+}, removeFilter:function (fltRef) {
+	for (var x = 0; x &lt; this.filters.length; x++) {
+		if (this.filters[x] === fltRef) {
+			delete this.filters[x];
+			return true;
+		}
+	}
+	return false;
+}, removeAllFilters:function () {
+	this.filters = [];
+}, filter:function (rec) {
+	for (var x = 0; x &lt; this.filters.length; x++) {
+		if ((this.filters[x][&quot;filter&quot;]) &amp;&amp; (!this.filters[x].filter(rec)) || (rec.level &lt; this.cutOffLevel)) {
+			return false;
+		}
+	}
+	return true;
+}, addHandler:function (hdlr) {
+	this.handlers.push(hdlr);
+	return this.handlers.length - 1;
+}, handle:function (rec) {
+	if ((!this.filter(rec)) || (rec.level &lt; this.cutOffLevel)) {
+		return false;
+	}
+	for (var x = 0; x &lt; this.handlers.length; x++) {
+		if (this.handlers[x][&quot;handle&quot;]) {
+			this.handlers[x].handle(rec);
+		}
+	}
+	return true;
+}, log:function (lvl, msg) {
+	if ((this.propagate) &amp;&amp; (this.parent) &amp;&amp; (this.parent.rec.level &gt;= this.cutOffLevel)) {
+		this.parent.log(lvl, msg);
+		return false;
+	}
+	this.handle(new dojo.logging.Record(lvl, msg));
+	return true;
+}, debug:function (msg) {
+	return this.logType(&quot;DEBUG&quot;, this._argsToArr(arguments));
+}, info:function (msg) {
+	return this.logType(&quot;INFO&quot;, this._argsToArr(arguments));
+}, warning:function (msg) {
+	return this.logType(&quot;WARNING&quot;, this._argsToArr(arguments));
+}, error:function (msg) {
+	return this.logType(&quot;ERROR&quot;, this._argsToArr(arguments));
+}, critical:function (msg) {
+	return this.logType(&quot;CRITICAL&quot;, this._argsToArr(arguments));
+}, exception:function (msg, e, squelch) {
+	if (e) {
+		var eparts = [e.name, (e.description || e.message)];
+		if (e.fileName) {
+			eparts.push(e.fileName);
+			eparts.push(&quot;line &quot; + e.lineNumber);
+		}
+		msg += &quot; &quot; + eparts.join(&quot; : &quot;);
+	}
+	this.logType(&quot;ERROR&quot;, msg);
+	if (!squelch) {
+		throw e;
+	}
+}, logType:function (type, args) {
+	return this.log.apply(this, [dojo.logging.log.getLevel(type), args]);
+}, warn:function () {
+	this.warning.apply(this, arguments);
+}, err:function () {
+	this.error.apply(this, arguments);
+}, crit:function () {
+	this.critical.apply(this, arguments);
+}});
+dojo.logging.LogHandler = function (level) {
+	this.cutOffLevel = (level) ? level : 0;
+	this.formatter = null;
+	this.data = [];
+	this.filters = [];
+};
+dojo.lang.extend(dojo.logging.LogHandler, {setFormatter:function (formatter) {
+	dojo.unimplemented(&quot;setFormatter&quot;);
+}, flush:function () {
+}, close:function () {
+}, handleError:function () {
+	dojo.deprecated(&quot;dojo.logging.LogHandler.handleError&quot;, &quot;use handle()&quot;, &quot;0.6&quot;);
+}, handle:function (record) {
+	if ((this.filter(record)) &amp;&amp; (record.level &gt;= this.cutOffLevel)) {
+		this.emit(record);
+	}
+}, emit:function (record) {
+	dojo.unimplemented(&quot;emit&quot;);
+}});
+void (function () {
+	var names = [&quot;setLevel&quot;, &quot;addFilter&quot;, &quot;removeFilterByIndex&quot;, &quot;removeFilter&quot;, &quot;removeAllFilters&quot;, &quot;filter&quot;];
+	var tgt = dojo.logging.LogHandler.prototype;
+	var src = dojo.logging.Logger.prototype;
+	for (var x = 0; x &lt; names.length; x++) {
+		tgt[names[x]] = src[names[x]];
+	}
+})();
+dojo.logging.log = new dojo.logging.Logger();
+dojo.logging.log.levels = [{&quot;name&quot;:&quot;DEBUG&quot;, &quot;level&quot;:1}, {&quot;name&quot;:&quot;INFO&quot;, &quot;level&quot;:2}, {&quot;name&quot;:&quot;WARNING&quot;, &quot;level&quot;:3}, {&quot;name&quot;:&quot;ERROR&quot;, &quot;level&quot;:4}, {&quot;name&quot;:&quot;CRITICAL&quot;, &quot;level&quot;:5}];
+dojo.logging.log.loggers = {};
+dojo.logging.log.getLogger = function (name) {
+	if (!this.loggers[name]) {
+		this.loggers[name] = new dojo.logging.Logger();
+		this.loggers[name].parent = this;
+	}
+	return this.loggers[name];
+};
+dojo.logging.log.getLevelName = function (lvl) {
+	for (var x = 0; x &lt; this.levels.length; x++) {
+		if (this.levels[x].level == lvl) {
+			return this.levels[x].name;
+		}
+	}
+	return null;
+};
+dojo.logging.log.getLevel = function (name) {
+	for (var x = 0; x &lt; this.levels.length; x++) {
+		if (this.levels[x].name.toUpperCase() == name.toUpperCase()) {
+			return this.levels[x].level;
+		}
+	}
+	return null;
+};
+dojo.declare(&quot;dojo.logging.MemoryLogHandler&quot;, dojo.logging.LogHandler, {initializer:function (level, recordsToKeep, postType, postInterval) {
+	dojo.logging.LogHandler.call(this, level);
+	this.numRecords = (typeof djConfig[&quot;loggingNumRecords&quot;] != &quot;undefined&quot;) ? djConfig[&quot;loggingNumRecords&quot;] : ((recordsToKeep) ? recordsToKeep : -1);
+	this.postType = (typeof djConfig[&quot;loggingPostType&quot;] != &quot;undefined&quot;) ? djConfig[&quot;loggingPostType&quot;] : (postType || -1);
+	this.postInterval = (typeof djConfig[&quot;loggingPostInterval&quot;] != &quot;undefined&quot;) ? djConfig[&quot;loggingPostInterval&quot;] : (postType || -1);
+}, emit:function (record) {
+	if (!djConfig.isDebug) {
+		return;
+	}
+	var logStr = String(dojo.log.getLevelName(record.level) + &quot;: &quot; + record.time.toLocaleTimeString()) + &quot;: &quot; + record.message;
+	if (!dj_undef(&quot;println&quot;, dojo.hostenv)) {
+		dojo.hostenv.println(logStr, record.msgArgs);
+	}
+	this.data.push(record);
+	if (this.numRecords != -1) {
+		while (this.data.length &gt; this.numRecords) {
+			this.data.shift();
+		}
+	}
+}});
+dojo.logging.logQueueHandler = new dojo.logging.MemoryLogHandler(0, 50, 0, 10000);
+dojo.logging.log.addHandler(dojo.logging.logQueueHandler);
+dojo.log = dojo.logging.log;
+

Added: tags/parley-0.55/root/static/magic/src/logging/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/logging/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/logging/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[[&quot;dojo.logging.Logger&quot;, false, false]], rhino:[&quot;dojo.logging.RhinoLogger&quot;]});
+dojo.provide(&quot;dojo.logging.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/math/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/math/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/math/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[[&quot;dojo.math&quot;, false, false], [&quot;dojo.math.curves&quot;, false, false], [&quot;dojo.math.points&quot;, false, false]]});
+dojo.provide(&quot;dojo.math.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/math/curves.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/math/curves.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/math/curves.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,184 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.math.curves&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.math.curves = {Line:function (start, end) {
+	this.start = start;
+	this.end = end;
+	this.dimensions = start.length;
+	for (var i = 0; i &lt; start.length; i++) {
+		start[i] = Number(start[i]);
+	}
+	for (var i = 0; i &lt; end.length; i++) {
+		end[i] = Number(end[i]);
+	}
+	this.getValue = function (n) {
+		var retVal = new Array(this.dimensions);
+		for (var i = 0; i &lt; this.dimensions; i++) {
+			retVal[i] = ((this.end[i] - this.start[i]) * n) + this.start[i];
+		}
+		return retVal;
+	};
+	return this;
+}, Bezier:function (pnts) {
+	this.getValue = function (step) {
+		if (step &gt;= 1) {
+			return this.p[this.p.length - 1];
+		}
+		if (step &lt;= 0) {
+			return this.p[0];
+		}
+		var retVal = new Array(this.p[0].length);
+		for (var k = 0; j &lt; this.p[0].length; k++) {
+			retVal[k] = 0;
+		}
+		for (var j = 0; j &lt; this.p[0].length; j++) {
+			var C = 0;
+			var D = 0;
+			for (var i = 0; i &lt; this.p.length; i++) {
+				C += this.p[i][j] * this.p[this.p.length - 1][0] * dojo.math.bernstein(step, this.p.length, i);
+			}
+			for (var l = 0; l &lt; this.p.length; l++) {
+				D += this.p[this.p.length - 1][0] * dojo.math.bernstein(step, this.p.length, l);
+			}
+			retVal[j] = C / D;
+		}
+		return retVal;
+	};
+	this.p = pnts;
+	return this;
+}, CatmullRom:function (pnts, c) {
+	this.getValue = function (step) {
+		var percent = step * (this.p.length - 1);
+		var node = Math.floor(percent);
+		var progress = percent - node;
+		var i0 = node - 1;
+		if (i0 &lt; 0) {
+			i0 = 0;
+		}
+		var i = node;
+		var i1 = node + 1;
+		if (i1 &gt;= this.p.length) {
+			i1 = this.p.length - 1;
+		}
+		var i2 = node + 2;
+		if (i2 &gt;= this.p.length) {
+			i2 = this.p.length - 1;
+		}
+		var u = progress;
+		var u2 = progress * progress;
+		var u3 = progress * progress * progress;
+		var retVal = new Array(this.p[0].length);
+		for (var k = 0; k &lt; this.p[0].length; k++) {
+			var x1 = (-this.c * this.p[i0][k]) + ((2 - this.c) * this.p[i][k]) + ((this.c - 2) * this.p[i1][k]) + (this.c * this.p[i2][k]);
+			var x2 = (2 * this.c * this.p[i0][k]) + ((this.c - 3) * this.p[i][k]) + ((3 - 2 * this.c) * this.p[i1][k]) + (-this.c * this.p[i2][k]);
+			var x3 = (-this.c * this.p[i0][k]) + (this.c * this.p[i1][k]);
+			var x4 = this.p[i][k];
+			retVal[k] = x1 * u3 + x2 * u2 + x3 * u + x4;
+		}
+		return retVal;
+	};
+	if (!c) {
+		this.c = 0.7;
+	} else {
+		this.c = c;
+	}
+	this.p = pnts;
+	return this;
+}, Arc:function (start, end, ccw) {
+	var center = dojo.math.points.midpoint(start, end);
+	var sides = dojo.math.points.translate(dojo.math.points.invert(center), start);
+	var rad = Math.sqrt(Math.pow(sides[0], 2) + Math.pow(sides[1], 2));
+	var theta = dojo.math.radToDeg(Math.atan(sides[1] / sides[0]));
+	if (sides[0] &lt; 0) {
+		theta -= 90;
+	} else {
+		theta += 90;
+	}
+	dojo.math.curves.CenteredArc.call(this, center, rad, theta, theta + (ccw ? -180 : 180));
+}, CenteredArc:function (center, radius, start, end) {
+	this.center = center;
+	this.radius = radius;
+	this.start = start || 0;
+	this.end = end;
+	this.getValue = function (n) {
+		var retVal = new Array(2);
+		var theta = dojo.math.degToRad(this.start + ((this.end - this.start) * n));
+		retVal[0] = this.center[0] + this.radius * Math.sin(theta);
+		retVal[1] = this.center[1] - this.radius * Math.cos(theta);
+		return retVal;
+	};
+	return this;
+}, Circle:function (center, radius) {
+	dojo.math.curves.CenteredArc.call(this, center, radius, 0, 360);
+	return this;
+}, Path:function () {
+	var curves = [];
+	var weights = [];
+	var ranges = [];
+	var totalWeight = 0;
+	this.add = function (curve, weight) {
+		if (weight &lt; 0) {
+			dojo.raise(&quot;dojo.math.curves.Path.add: weight cannot be less than 0&quot;);
+		}
+		curves.push(curve);
+		weights.push(weight);
+		totalWeight += weight;
+		computeRanges();
+	};
+	this.remove = function (curve) {
+		for (var i = 0; i &lt; curves.length; i++) {
+			if (curves[i] == curve) {
+				curves.splice(i, 1);
+				totalWeight -= weights.splice(i, 1)[0];
+				break;
+			}
+		}
+		computeRanges();
+	};
+	this.removeAll = function () {
+		curves = [];
+		weights = [];
+		totalWeight = 0;
+	};
+	this.getValue = function (n) {
+		var found = false, value = 0;
+		for (var i = 0; i &lt; ranges.length; i++) {
+			var r = ranges[i];
+			if (n &gt;= r[0] &amp;&amp; n &lt; r[1]) {
+				var subN = (n - r[0]) / r[2];
+				value = curves[i].getValue(subN);
+				found = true;
+				break;
+			}
+		}
+		if (!found) {
+			value = curves[curves.length - 1].getValue(1);
+		}
+		for (var j = 0; j &lt; i; j++) {
+			value = dojo.math.points.translate(value, curves[j].getValue(1));
+		}
+		return value;
+	};
+	function computeRanges() {
+		var start = 0;
+		for (var i = 0; i &lt; weights.length; i++) {
+			var end = start + weights[i] / totalWeight;
+			var len = end - start;
+			ranges[i] = [start, end, len];
+			start = end;
+		}
+	}
+	return this;
+}};
+

Added: tags/parley-0.55/root/static/magic/src/math/matrix.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/math/matrix.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/math/matrix.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,303 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.math.matrix&quot;);
+dojo.math.matrix.iDF = 0;
+dojo.math.matrix.ALMOST_ZERO = 1e-10;
+dojo.math.matrix.multiply = function (a, b) {
+	var ay = a.length;
+	var ax = a[0].length;
+	var by = b.length;
+	var bx = b[0].length;
+	if (ax != by) {
+		dojo.debug(&quot;Can't multiply matricies of sizes &quot; + ax + &quot;,&quot; + ay + &quot; and &quot; + bx + &quot;,&quot; + by);
+		return [[0]];
+	}
+	var c = [];
+	for (var k = 0; k &lt; ay; k++) {
+		c[k] = [];
+		for (var i = 0; i &lt; bx; i++) {
+			c[k][i] = 0;
+			for (var m = 0; m &lt; ax; m++) {
+				c[k][i] += a[k][m] * b[m][i];
+			}
+		}
+	}
+	return c;
+};
+dojo.math.matrix.product = function () {
+	if (arguments.length == 0) {
+		dojo.debug(&quot;can't multiply 0 matrices!&quot;);
+		return 1;
+	}
+	var result = arguments[0];
+	for (var i = 1; i &lt; arguments.length; i++) {
+		result = dojo.math.matrix.multiply(result, arguments[i]);
+	}
+	return result;
+};
+dojo.math.matrix.sum = function () {
+	if (arguments.length == 0) {
+		dojo.debug(&quot;can't sum 0 matrices!&quot;);
+		return 0;
+	}
+	var result = dojo.math.matrix.copy(arguments[0]);
+	var rows = result.length;
+	if (rows == 0) {
+		dojo.debug(&quot;can't deal with matrices of 0 rows!&quot;);
+		return 0;
+	}
+	var cols = result[0].length;
+	if (cols == 0) {
+		dojo.debug(&quot;can't deal with matrices of 0 cols!&quot;);
+		return 0;
+	}
+	for (var i = 1; i &lt; arguments.length; ++i) {
+		var arg = arguments[i];
+		if (arg.length != rows || arg[0].length != cols) {
+			dojo.debug(&quot;can't add matrices of different dimensions: first dimensions were &quot; + rows + &quot;x&quot; + cols + &quot;, current dimensions are &quot; + arg.length + &quot;x&quot; + arg[0].length);
+			return 0;
+		}
+		for (var r = 0; r &lt; rows; r++) {
+			for (var c = 0; c &lt; cols; c++) {
+				result[r][c] += arg[r][c];
+			}
+		}
+	}
+	return result;
+};
+dojo.math.matrix.inverse = function (a) {
+	if (a.length == 1 &amp;&amp; a[0].length == 1) {
+		return [[1 / a[0][0]]];
+	}
+	var tms = a.length;
+	var m = dojo.math.matrix.create(tms, tms);
+	var mm = dojo.math.matrix.adjoint(a);
+	var det = dojo.math.matrix.determinant(a);
+	var dd = 0;
+	if (det == 0) {
+		dojo.debug(&quot;Determinant Equals 0, Not Invertible.&quot;);
+		return [[0]];
+	} else {
+		dd = 1 / det;
+	}
+	for (var i = 0; i &lt; tms; i++) {
+		for (var j = 0; j &lt; tms; j++) {
+			m[i][j] = dd * mm[i][j];
+		}
+	}
+	return m;
+};
+dojo.math.matrix.determinant = function (a) {
+	if (a.length != a[0].length) {
+		dojo.debug(&quot;Can't calculate the determiant of a non-squre matrix!&quot;);
+		return 0;
+	}
+	var tms = a.length;
+	var det = 1;
+	var b = dojo.math.matrix.upperTriangle(a);
+	for (var i = 0; i &lt; tms; i++) {
+		var bii = b[i][i];
+		if (Math.abs(bii) &lt; dojo.math.matrix.ALMOST_ZERO) {
+			return 0;
+		}
+		det *= bii;
+	}
+	det = det * dojo.math.matrix.iDF;
+	return det;
+};
+dojo.math.matrix.upperTriangle = function (m) {
+	m = dojo.math.matrix.copy(m);
+	var f1 = 0;
+	var temp = 0;
+	var tms = m.length;
+	var v = 1;
+	dojo.math.matrix.iDF = 1;
+	for (var col = 0; col &lt; tms - 1; col++) {
+		if (typeof m[col][col] != &quot;number&quot;) {
+			dojo.debug(&quot;non-numeric entry found in a numeric matrix: m[&quot; + col + &quot;][&quot; + col + &quot;]=&quot; + m[col][col]);
+		}
+		v = 1;
+		var stop_loop = 0;
+		while ((m[col][col] == 0) &amp;&amp; !stop_loop) {
+			if (col + v &gt;= tms) {
+				dojo.math.matrix.iDF = 0;
+				stop_loop = 1;
+			} else {
+				for (var r = 0; r &lt; tms; r++) {
+					temp = m[col][r];
+					m[col][r] = m[col + v][r];
+					m[col + v][r] = temp;
+				}
+				v++;
+				dojo.math.matrix.iDF *= -1;
+			}
+		}
+		for (var row = col + 1; row &lt; tms; row++) {
+			if (typeof m[row][col] != &quot;number&quot;) {
+				dojo.debug(&quot;non-numeric entry found in a numeric matrix: m[&quot; + row + &quot;][&quot; + col + &quot;]=&quot; + m[row][col]);
+			}
+			if (typeof m[col][row] != &quot;number&quot;) {
+				dojo.debug(&quot;non-numeric entry found in a numeric matrix: m[&quot; + col + &quot;][&quot; + row + &quot;]=&quot; + m[col][row]);
+			}
+			if (m[col][col] != 0) {
+				var f1 = (-1) * m[row][col] / m[col][col];
+				for (var i = col; i &lt; tms; i++) {
+					m[row][i] = f1 * m[col][i] + m[row][i];
+				}
+			}
+		}
+	}
+	return m;
+};
+dojo.math.matrix.create = function (a, b, value) {
+	if (!value) {
+		value = 0;
+	}
+	var m = [];
+	for (var i = 0; i &lt; b; i++) {
+		m[i] = [];
+		for (var j = 0; j &lt; a; j++) {
+			m[i][j] = value;
+		}
+	}
+	return m;
+};
+dojo.math.matrix.ones = function (a, b) {
+	return dojo.math.matrix.create(a, b, 1);
+};
+dojo.math.matrix.zeros = function (a, b) {
+	return dojo.math.matrix.create(a, b, 0);
+};
+dojo.math.matrix.identity = function (size, scale) {
+	if (!scale) {
+		scale = 1;
+	}
+	var m = [];
+	for (var i = 0; i &lt; size; i++) {
+		m[i] = [];
+		for (var j = 0; j &lt; size; j++) {
+			m[i][j] = (i == j ? scale : 0);
+		}
+	}
+	return m;
+};
+dojo.math.matrix.adjoint = function (a) {
+	var tms = a.length;
+	if (tms &lt;= 1) {
+		dojo.debug(&quot;Can't find the adjoint of a matrix with a dimension less than 2&quot;);
+		return [[0]];
+	}
+	if (a.length != a[0].length) {
+		dojo.debug(&quot;Can't find the adjoint of a non-square matrix&quot;);
+		return [[0]];
+	}
+	var m = dojo.math.matrix.create(tms, tms);
+	var ii = 0;
+	var jj = 0;
+	var ia = 0;
+	var ja = 0;
+	var det = 0;
+	var ap = dojo.math.matrix.create(tms - 1, tms - 1);
+	for (var i = 0; i &lt; tms; i++) {
+		for (var j = 0; j &lt; tms; j++) {
+			ia = 0;
+			for (ii = 0; ii &lt; tms; ii++) {
+				if (ii == i) {
+					continue;
+				}
+				ja = 0;
+				for (jj = 0; jj &lt; tms; jj++) {
+					if (jj == j) {
+						continue;
+					}
+					ap[ia][ja] = a[ii][jj];
+					ja++;
+				}
+				ia++;
+			}
+			det = dojo.math.matrix.determinant(ap);
+			m[i][j] = Math.pow(-1, (i + j)) * det;
+		}
+	}
+	m = dojo.math.matrix.transpose(m);
+	return m;
+};
+dojo.math.matrix.transpose = function (a) {
+	var m = dojo.math.matrix.create(a.length, a[0].length);
+	for (var i = 0; i &lt; a.length; i++) {
+		for (var j = 0; j &lt; a[i].length; j++) {
+			m[j][i] = a[i][j];
+		}
+	}
+	return m;
+};
+dojo.math.matrix.format = function (a, decimal_points) {
+	if (arguments.length &lt;= 1) {
+		decimal_points = 5;
+	}
+	function format_int(x, dp) {
+		var fac = Math.pow(10, dp);
+		var a = Math.round(x * fac) / fac;
+		var b = a.toString();
+		if (b.charAt(0) != &quot;-&quot;) {
+			b = &quot; &quot; + b;
+		}
+		var has_dp = 0;
+		for (var i = 1; i &lt; b.length; i++) {
+			if (b.charAt(i) == &quot;.&quot;) {
+				has_dp = 1;
+			}
+		}
+		if (!has_dp) {
+			b += &quot;.&quot;;
+		}
+		while (b.length &lt; dp + 3) {
+			b += &quot;0&quot;;
+		}
+		return b;
+	}
+	var ya = a.length;
+	var xa = ya &gt; 0 ? a[0].length : 0;
+	var buffer = &quot;&quot;;
+	for (var y = 0; y &lt; ya; y++) {
+		buffer += &quot;| &quot;;
+		for (var x = 0; x &lt; xa; x++) {
+			buffer += format_int(a[y][x], decimal_points) + &quot; &quot;;
+		}
+		buffer += &quot;|\n&quot;;
+	}
+	return buffer;
+};
+dojo.math.matrix.copy = function (a) {
+	var ya = a.length;
+	var xa = a[0].length;
+	var m = dojo.math.matrix.create(xa, ya);
+	for (var y = 0; y &lt; ya; y++) {
+		for (var x = 0; x &lt; xa; x++) {
+			m[y][x] = a[y][x];
+		}
+	}
+	return m;
+};
+dojo.math.matrix.scale = function (k, a) {
+	a = dojo.math.matrix.copy(a);
+	var ya = a.length;
+	var xa = a[0].length;
+	for (var y = 0; y &lt; ya; y++) {
+		for (var x = 0; x &lt; xa; x++) {
+			a[y][x] *= k;
+		}
+	}
+	return a;
+};
+

Added: tags/parley-0.55/root/static/magic/src/math/points.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/math/points.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/math/points.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,42 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.math.points&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.math.points = {translate:function (a, b) {
+	if (a.length != b.length) {
+		dojo.raise(&quot;dojo.math.translate: points not same size (a:[&quot; + a + &quot;], b:[&quot; + b + &quot;])&quot;);
+	}
+	var c = new Array(a.length);
+	for (var i = 0; i &lt; a.length; i++) {
+		c[i] = a[i] + b[i];
+	}
+	return c;
+}, midpoint:function (a, b) {
+	if (a.length != b.length) {
+		dojo.raise(&quot;dojo.math.midpoint: points not same size (a:[&quot; + a + &quot;], b:[&quot; + b + &quot;])&quot;);
+	}
+	var c = new Array(a.length);
+	for (var i = 0; i &lt; a.length; i++) {
+		c[i] = (a[i] + b[i]) / 2;
+	}
+	return c;
+}, invert:function (a) {
+	var b = new Array(a.length);
+	for (var i = 0; i &lt; a.length; i++) {
+		b[i] = -a[i];
+	}
+	return b;
+}, distance:function (a, b) {
+	return Math.sqrt(Math.pow(b[0] - a[0], 2) + Math.pow(b[1] - a[1], 2));
+}};
+

Added: tags/parley-0.55/root/static/magic/src/math.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/math.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/math.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,108 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.math&quot;);
+dojo.math.degToRad = function (x) {
+	return (x * Math.PI) / 180;
+};
+dojo.math.radToDeg = function (x) {
+	return (x * 180) / Math.PI;
+};
+dojo.math.factorial = function (n) {
+	if (n &lt; 1) {
+		return 0;
+	}
+	var retVal = 1;
+	for (var i = 1; i &lt;= n; i++) {
+		retVal *= i;
+	}
+	return retVal;
+};
+dojo.math.permutations = function (n, k) {
+	if (n == 0 || k == 0) {
+		return 1;
+	}
+	return (dojo.math.factorial(n) / dojo.math.factorial(n - k));
+};
+dojo.math.combinations = function (n, r) {
+	if (n == 0 || r == 0) {
+		return 1;
+	}
+	return (dojo.math.factorial(n) / (dojo.math.factorial(n - r) * dojo.math.factorial(r)));
+};
+dojo.math.bernstein = function (t, n, i) {
+	return (dojo.math.combinations(n, i) * Math.pow(t, i) * Math.pow(1 - t, n - i));
+};
+dojo.math.gaussianRandom = function () {
+	var k = 2;
+	do {
+		var i = 2 * Math.random() - 1;
+		var j = 2 * Math.random() - 1;
+		k = i * i + j * j;
+	} while (k &gt;= 1);
+	k = Math.sqrt((-2 * Math.log(k)) / k);
+	return i * k;
+};
+dojo.math.mean = function () {
+	var array = dojo.lang.isArray(arguments[0]) ? arguments[0] : arguments;
+	var mean = 0;
+	for (var i = 0; i &lt; array.length; i++) {
+		mean += array[i];
+	}
+	return mean / array.length;
+};
+dojo.math.round = function (number, places) {
+	if (!places) {
+		var shift = 1;
+	} else {
+		var shift = Math.pow(10, places);
+	}
+	return Math.round(number * shift) / shift;
+};
+dojo.math.sd = dojo.math.standardDeviation = function () {
+	var array = dojo.lang.isArray(arguments[0]) ? arguments[0] : arguments;
+	return Math.sqrt(dojo.math.variance(array));
+};
+dojo.math.variance = function () {
+	var array = dojo.lang.isArray(arguments[0]) ? arguments[0] : arguments;
+	var mean = 0, squares = 0;
+	for (var i = 0; i &lt; array.length; i++) {
+		mean += array[i];
+		squares += Math.pow(array[i], 2);
+	}
+	return (squares / array.length) - Math.pow(mean / array.length, 2);
+};
+dojo.math.range = function (a, b, step) {
+	if (arguments.length &lt; 2) {
+		b = a;
+		a = 0;
+	}
+	if (arguments.length &lt; 3) {
+		step = 1;
+	}
+	var range = [];
+	if (step &gt; 0) {
+		for (var i = a; i &lt; b; i += step) {
+			range.push(i);
+		}
+	} else {
+		if (step &lt; 0) {
+			for (var i = a; i &gt; b; i += step) {
+				range.push(i);
+			}
+		} else {
+			throw new Error(&quot;dojo.math.range: step must be non-zero&quot;);
+		}
+	}
+	return range;
+};
+

Added: tags/parley-0.55/root/static/magic/src/namespaces/dojo.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/namespaces/dojo.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/namespaces/dojo.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,163 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+dojo.provide(&quot;dojo.namespaces.dojo&quot;);
+dojo.require(&quot;dojo.ns&quot;);
+
+(function(){
+	// Mapping of all widget short names to their full package names
+	// This is used for widget autoloading - no dojo.require() is necessary.
+	// If you use a widget in markup or create one dynamically, then this
+	// mapping is used to find and load any dependencies not already loaded.
+	// You should use your own namespace for any custom widgets.
+	// For extra widgets you use, dojo.declare() may be used to explicitly load them.
+	// Experimental and deprecated widgets are not included in this table
+	var map = {
+		html: {
+			&quot;accordioncontainer&quot;: &quot;dojo.widget.AccordionContainer&quot;,
+			&quot;animatedpng&quot;: &quot;dojo.widget.AnimatedPng&quot;,
+			&quot;button&quot;: &quot;dojo.widget.Button&quot;,
+			&quot;chart&quot;: &quot;dojo.widget.Chart&quot;,
+			&quot;checkbox&quot;: &quot;dojo.widget.Checkbox&quot;,
+			&quot;clock&quot;: &quot;dojo.widget.Clock&quot;,
+			&quot;colorpalette&quot;: &quot;dojo.widget.ColorPalette&quot;,
+			&quot;combobox&quot;: &quot;dojo.widget.ComboBox&quot;,
+			&quot;combobutton&quot;: &quot;dojo.widget.Button&quot;,
+			&quot;contentpane&quot;: &quot;dojo.widget.ContentPane&quot;,
+			&quot;currencytextbox&quot;: &quot;dojo.widget.CurrencyTextbox&quot;,
+			&quot;datepicker&quot;: &quot;dojo.widget.DatePicker&quot;,
+			&quot;datetextbox&quot;: &quot;dojo.widget.DateTextbox&quot;,
+			&quot;debugconsole&quot;: &quot;dojo.widget.DebugConsole&quot;,
+			&quot;dialog&quot;: &quot;dojo.widget.Dialog&quot;,
+			&quot;dropdownbutton&quot;: &quot;dojo.widget.Button&quot;,
+			&quot;dropdowndatepicker&quot;: &quot;dojo.widget.DropdownDatePicker&quot;,
+			&quot;dropdowntimepicker&quot;: &quot;dojo.widget.DropdownTimePicker&quot;,
+			&quot;emaillisttextbox&quot;: &quot;dojo.widget.InternetTextbox&quot;,
+			&quot;emailtextbox&quot;: &quot;dojo.widget.InternetTextbox&quot;,
+			&quot;editor&quot;: &quot;dojo.widget.Editor&quot;,
+			&quot;editor2&quot;: &quot;dojo.widget.Editor2&quot;,
+			&quot;filteringtable&quot;: &quot;dojo.widget.FilteringTable&quot;,
+			&quot;fisheyelist&quot;: &quot;dojo.widget.FisheyeList&quot;,
+			&quot;fisheyelistitem&quot;: &quot;dojo.widget.FisheyeList&quot;,
+			&quot;floatingpane&quot;: &quot;dojo.widget.FloatingPane&quot;,
+			&quot;modalfloatingpane&quot;: &quot;dojo.widget.FloatingPane&quot;,
+			&quot;form&quot;: &quot;dojo.widget.Form&quot;,
+			&quot;googlemap&quot;: &quot;dojo.widget.GoogleMap&quot;,
+			&quot;inlineeditbox&quot;: &quot;dojo.widget.InlineEditBox&quot;,
+			&quot;integerspinner&quot;: &quot;dojo.widget.Spinner&quot;,
+			&quot;integertextbox&quot;: &quot;dojo.widget.IntegerTextbox&quot;,
+			&quot;ipaddresstextbox&quot;: &quot;dojo.widget.InternetTextbox&quot;,
+			&quot;layoutcontainer&quot;: &quot;dojo.widget.LayoutContainer&quot;,
+			&quot;linkpane&quot;: &quot;dojo.widget.LinkPane&quot;,
+			&quot;popupmenu2&quot;: &quot;dojo.widget.Menu2&quot;,
+			&quot;menuitem2&quot;: &quot;dojo.widget.Menu2&quot;,
+			&quot;menuseparator2&quot;: &quot;dojo.widget.Menu2&quot;,
+			&quot;menubar2&quot;: &quot;dojo.widget.Menu2&quot;,
+			&quot;menubaritem2&quot;: &quot;dojo.widget.Menu2&quot;,
+			&quot;pagecontainer&quot;: &quot;dojo.widget.PageContainer&quot;,
+			&quot;pagecontroller&quot;: &quot;dojo.widget.PageContainer&quot;,
+			&quot;popupcontainer&quot;: &quot;dojo.widget.PopupContainer&quot;,
+			&quot;progressbar&quot;: &quot;dojo.widget.ProgressBar&quot;,
+			&quot;radiogroup&quot;: &quot;dojo.widget.RadioGroup&quot;,
+			&quot;realnumbertextbox&quot;: &quot;dojo.widget.RealNumberTextbox&quot;,
+			&quot;regexptextbox&quot;: &quot;dojo.widget.RegexpTextbox&quot;,
+			&quot;repeater&quot;: &quot;dojo.widget.Repeater&quot;, 
+			&quot;resizabletextarea&quot;: &quot;dojo.widget.ResizableTextarea&quot;,
+			&quot;richtext&quot;: &quot;dojo.widget.RichText&quot;,
+			&quot;select&quot;: &quot;dojo.widget.Select&quot;,
+			&quot;show&quot;: &quot;dojo.widget.Show&quot;,
+			&quot;showaction&quot;: &quot;dojo.widget.ShowAction&quot;,
+			&quot;showslide&quot;: &quot;dojo.widget.ShowSlide&quot;,
+			&quot;slidervertical&quot;: &quot;dojo.widget.Slider&quot;,
+			&quot;sliderhorizontal&quot;: &quot;dojo.widget.Slider&quot;,
+			&quot;slider&quot;:&quot;dojo.widget.Slider&quot;,
+			&quot;slideshow&quot;: &quot;dojo.widget.SlideShow&quot;,
+			&quot;sortabletable&quot;: &quot;dojo.widget.SortableTable&quot;,
+			&quot;splitcontainer&quot;: &quot;dojo.widget.SplitContainer&quot;,
+			&quot;tabcontainer&quot;: &quot;dojo.widget.TabContainer&quot;,
+			&quot;tabcontroller&quot;: &quot;dojo.widget.TabContainer&quot;,
+			&quot;taskbar&quot;: &quot;dojo.widget.TaskBar&quot;,
+			&quot;textbox&quot;: &quot;dojo.widget.Textbox&quot;,
+			&quot;timepicker&quot;: &quot;dojo.widget.TimePicker&quot;,
+			&quot;timetextbox&quot;: &quot;dojo.widget.DateTextbox&quot;,
+			&quot;titlepane&quot;: &quot;dojo.widget.TitlePane&quot;,
+			&quot;toaster&quot;: &quot;dojo.widget.Toaster&quot;,
+			&quot;toggler&quot;: &quot;dojo.widget.Toggler&quot;,
+			&quot;toolbar&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarcontainer&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbaritem&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarbuttongroup&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarbutton&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbardialog&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarmenu&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarseparator&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarspace&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarselect&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;toolbarcolordialog&quot;: &quot;dojo.widget.Toolbar&quot;,
+			&quot;tooltip&quot;: &quot;dojo.widget.Tooltip&quot;,
+			&quot;tree&quot;: &quot;dojo.widget.Tree&quot;,
+			&quot;treebasiccontroller&quot;: &quot;dojo.widget.TreeBasicController&quot;,
+			&quot;treecontextmenu&quot;: &quot;dojo.widget.TreeContextMenu&quot;,
+			&quot;treedisablewrapextension&quot;: &quot;dojo.widget.TreeDisableWrapExtension&quot;,
+			&quot;treedociconextension&quot;: &quot;dojo.widget.TreeDocIconExtension&quot;,
+			&quot;treeeditor&quot;: &quot;dojo.widget.TreeEditor&quot;,
+			&quot;treeemphasizeonselect&quot;: &quot;dojo.widget.TreeEmphasizeOnSelect&quot;,
+			&quot;treeexpandtonodeonselect&quot;: &quot;dojo.widget.TreeExpandToNodeOnSelect&quot;,
+			&quot;treelinkextension&quot;: &quot;dojo.widget.TreeLinkExtension&quot;,
+			&quot;treeloadingcontroller&quot;: &quot;dojo.widget.TreeLoadingController&quot;,
+			&quot;treemenuitem&quot;: &quot;dojo.widget.TreeContextMenu&quot;,
+			&quot;treenode&quot;: &quot;dojo.widget.TreeNode&quot;,
+			&quot;treerpccontroller&quot;: &quot;dojo.widget.TreeRPCController&quot;,
+			&quot;treeselector&quot;: &quot;dojo.widget.TreeSelector&quot;,
+			&quot;treetoggleonselect&quot;: &quot;dojo.widget.TreeToggleOnSelect&quot;,
+			&quot;treev3&quot;: &quot;dojo.widget.TreeV3&quot;,
+			&quot;treebasiccontrollerv3&quot;: &quot;dojo.widget.TreeBasicControllerV3&quot;,
+			&quot;treecontextmenuv3&quot;: &quot;dojo.widget.TreeContextMenuV3&quot;,
+			&quot;treedndcontrollerv3&quot;: &quot;dojo.widget.TreeDndControllerV3&quot;,
+			&quot;treeloadingcontrollerv3&quot;: &quot;dojo.widget.TreeLoadingControllerV3&quot;,
+			&quot;treemenuitemv3&quot;: &quot;dojo.widget.TreeContextMenuV3&quot;,
+			&quot;treerpccontrollerv3&quot;: &quot;dojo.widget.TreeRpcControllerV3&quot;,
+			&quot;treeselectorv3&quot;: &quot;dojo.widget.TreeSelectorV3&quot;,
+			&quot;urltextbox&quot;: &quot;dojo.widget.InternetTextbox&quot;,
+			&quot;usphonenumbertextbox&quot;: &quot;dojo.widget.UsTextbox&quot;,
+			&quot;ussocialsecuritynumbertextbox&quot;: &quot;dojo.widget.UsTextbox&quot;,
+			&quot;usstatetextbox&quot;: &quot;dojo.widget.UsTextbox&quot;,
+			&quot;usziptextbox&quot;: &quot;dojo.widget.UsTextbox&quot;,
+			&quot;validationtextbox&quot;: &quot;dojo.widget.ValidationTextbox&quot;,
+			&quot;treeloadingcontroller&quot;: &quot;dojo.widget.TreeLoadingController&quot;,
+			&quot;wizardcontainer&quot;: &quot;dojo.widget.Wizard&quot;,
+			&quot;wizardpane&quot;: &quot;dojo.widget.Wizard&quot;,
+			&quot;yahoomap&quot;: &quot;dojo.widget.YahooMap&quot;
+		},
+		svg: {
+			&quot;chart&quot;: &quot;dojo.widget.svg.Chart&quot;
+		},
+		vml: {
+			&quot;chart&quot;: &quot;dojo.widget.vml.Chart&quot;
+		}
+	};
+
+	dojo.addDojoNamespaceMapping = function(/*String*/shortName, /*String*/packageName){
+	// summary:
+	//	Add an entry to the mapping table for the dojo: namespace
+	//
+	// shortName: the name to be used as the widget's tag name in the dojo: namespace
+	// packageName: the path to the Javascript module in dotted package notation
+		map[shortName]=packageName;    
+	};
+	
+	function dojoNamespaceResolver(name, domain){
+		if(!domain){ domain=&quot;html&quot;; }
+		if(!map[domain]){ return null; }
+		return map[domain][name];    
+	}
+
+	dojo.registerNamespaceResolver(&quot;dojo&quot;, dojoNamespaceResolver);
+})();

Added: tags/parley-0.55/root/static/magic/src/ns.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/ns.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/ns.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,100 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.ns&quot;);
+dojo.ns = {namespaces:{}, failed:{}, loading:{}, loaded:{}, register:function (name, module, resolver, noOverride) {
+	if (!noOverride || !this.namespaces[name]) {
+		this.namespaces[name] = new dojo.ns.Ns(name, module, resolver);
+	}
+}, allow:function (name) {
+	if (this.failed[name]) {
+		return false;
+	}
+	if ((djConfig.excludeNamespace) &amp;&amp; (dojo.lang.inArray(djConfig.excludeNamespace, name))) {
+		return false;
+	}
+	return ((name == this.dojo) || (!djConfig.includeNamespace) || (dojo.lang.inArray(djConfig.includeNamespace, name)));
+}, get:function (name) {
+	return this.namespaces[name];
+}, require:function (name) {
+	var ns = this.namespaces[name];
+	if ((ns) &amp;&amp; (this.loaded[name])) {
+		return ns;
+	}
+	if (!this.allow(name)) {
+		return false;
+	}
+	if (this.loading[name]) {
+		dojo.debug(&quot;dojo.namespace.require: re-entrant request to load namespace \&quot;&quot; + name + &quot;\&quot; must fail.&quot;);
+		return false;
+	}
+	var req = dojo.require;
+	this.loading[name] = true;
+	try {
+		if (name == &quot;dojo&quot;) {
+			req(&quot;dojo.namespaces.dojo&quot;);
+		} else {
+			if (!dojo.hostenv.moduleHasPrefix(name)) {
+				dojo.registerModulePath(name, &quot;../&quot; + name);
+			}
+			req([name, &quot;manifest&quot;].join(&quot;.&quot;), false, true);
+		}
+		if (!this.namespaces[name]) {
+			this.failed[name] = true;
+		}
+	}
+	finally {
+		this.loading[name] = false;
+	}
+	return this.namespaces[name];
+}};
+dojo.ns.Ns = function (name, module, resolver) {
+	this.name = name;
+	this.module = module;
+	this.resolver = resolver;
+	this._loaded = [];
+	this._failed = [];
+};
+dojo.ns.Ns.prototype.resolve = function (name, domain, omitModuleCheck) {
+	if (!this.resolver || djConfig[&quot;skipAutoRequire&quot;]) {
+		return false;
+	}
+	var fullName = this.resolver(name, domain);
+	if ((fullName) &amp;&amp; (!this._loaded[fullName]) &amp;&amp; (!this._failed[fullName])) {
+		var req = dojo.require;
+		req(fullName, false, true);
+		if (dojo.hostenv.findModule(fullName, false)) {
+			this._loaded[fullName] = true;
+		} else {
+			if (!omitModuleCheck) {
+				dojo.raise(&quot;dojo.ns.Ns.resolve: module '&quot; + fullName + &quot;' not found after loading via namespace '&quot; + this.name + &quot;'&quot;);
+			}
+			this._failed[fullName] = true;
+		}
+	}
+	return Boolean(this._loaded[fullName]);
+};
+dojo.registerNamespace = function (name, module, resolver) {
+	dojo.ns.register.apply(dojo.ns, arguments);
+};
+dojo.registerNamespaceResolver = function (name, resolver) {
+	var n = dojo.ns.namespaces[name];
+	if (n) {
+		n.resolver = resolver;
+	}
+};
+dojo.registerNamespaceManifest = function (module, path, name, widgetModule, resolver) {
+	dojo.registerModulePath(name, path);
+	dojo.registerNamespace(name, widgetModule, resolver);
+};
+dojo.registerNamespace(&quot;dojo&quot;, &quot;dojo.widget&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/profile.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/profile.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/profile.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,104 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.profile&quot;);
+dojo.profile = {_profiles:{}, _pns:[], start:function (name) {
+	if (!this._profiles[name]) {
+		this._profiles[name] = {iters:0, total:0};
+		this._pns[this._pns.length] = name;
+	} else {
+		if (this._profiles[name][&quot;start&quot;]) {
+			this.end(name);
+		}
+	}
+	this._profiles[name].end = null;
+	this._profiles[name].start = new Date();
+}, end:function (name) {
+	var ed = new Date();
+	if ((this._profiles[name]) &amp;&amp; (this._profiles[name][&quot;start&quot;])) {
+		with (this._profiles[name]) {
+			end = ed;
+			total += (end - start);
+			start = null;
+			iters++;
+		}
+	} else {
+		return true;
+	}
+}, dump:function (appendToDoc) {
+	var tbl = document.createElement(&quot;table&quot;);
+	with (tbl.style) {
+		border = &quot;1px solid black&quot;;
+		borderCollapse = &quot;collapse&quot;;
+	}
+	var hdr = tbl.createTHead();
+	var hdrtr = hdr.insertRow(0);
+	var cols = [&quot;Identifier&quot;, &quot;Calls&quot;, &quot;Total&quot;, &quot;Avg&quot;];
+	for (var x = 0; x &lt; cols.length; x++) {
+		var ntd = hdrtr.insertCell(x);
+		with (ntd.style) {
+			backgroundColor = &quot;#225d94&quot;;
+			color = &quot;white&quot;;
+			borderBottom = &quot;1px solid black&quot;;
+			borderRight = &quot;1px solid black&quot;;
+			fontFamily = &quot;tahoma&quot;;
+			fontWeight = &quot;bolder&quot;;
+			paddingLeft = paddingRight = &quot;5px&quot;;
+		}
+		ntd.appendChild(document.createTextNode(cols[x]));
+	}
+	for (var x = 0; x &lt; this._pns.length; x++) {
+		var prf = this._profiles[this._pns[x]];
+		this.end(this._pns[x]);
+		if (prf.iters &gt; 0) {
+			var bdytr = tbl.insertRow(true);
+			var vals = [this._pns[x], prf.iters, prf.total, parseInt(prf.total / prf.iters)];
+			for (var y = 0; y &lt; vals.length; y++) {
+				var cc = bdytr.insertCell(y);
+				cc.appendChild(document.createTextNode(vals[y]));
+				with (cc.style) {
+					borderBottom = &quot;1px solid gray&quot;;
+					paddingLeft = paddingRight = &quot;5px&quot;;
+					if (x % 2) {
+						backgroundColor = &quot;#e1f1ff&quot;;
+					}
+					if (y &gt; 0) {
+						textAlign = &quot;right&quot;;
+						borderRight = &quot;1px solid gray&quot;;
+					} else {
+						borderRight = &quot;1px solid black&quot;;
+					}
+				}
+			}
+		}
+	}
+	if (appendToDoc) {
+		var ne = document.createElement(&quot;div&quot;);
+		ne.id = &quot;profileOutputTable&quot;;
+		with (ne.style) {
+			fontFamily = &quot;Courier New, monospace&quot;;
+			fontSize = &quot;12px&quot;;
+			lineHeight = &quot;16px&quot;;
+			borderTop = &quot;1px solid black&quot;;
+			padding = &quot;10px&quot;;
+		}
+		if (document.getElementById(&quot;profileOutputTable&quot;)) {
+			dojo.body().replaceChild(ne, document.getElementById(&quot;profileOutputTable&quot;));
+		} else {
+			dojo.body().appendChild(ne);
+		}
+		ne.appendChild(tbl);
+	}
+	return tbl;
+}};
+dojo.profile.stop = dojo.profile.end;
+

Added: tags/parley-0.55/root/static/magic/src/regexp.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/regexp.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/regexp.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,365 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.regexp&quot;);
+dojo.evalObjPath(&quot;dojo.regexp.us&quot;, true);
+dojo.regexp.tld = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.allowCC != &quot;boolean&quot;) {
+		flags.allowCC = true;
+	}
+	if (typeof flags.allowInfra != &quot;boolean&quot;) {
+		flags.allowInfra = true;
+	}
+	if (typeof flags.allowGeneric != &quot;boolean&quot;) {
+		flags.allowGeneric = true;
+	}
+	var infraRE = &quot;arpa&quot;;
+	var genericRE = &quot;aero|biz|com|coop|edu|gov|info|int|mil|museum|name|net|org|pro|travel|xxx|jobs|mobi|post&quot;;
+	var ccRE = &quot;ac|ad|ae|af|ag|ai|al|am|an|ao|aq|ar|as|at|au|aw|az|ba|bb|bd|be|bf|bg|bh|bi|bj|bm|bn|bo|br|&quot; + &quot;bs|bt|bv|bw|by|bz|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|&quot; + &quot;ec|ee|eg|er|eu|es|et|fi|fj|fk|fm|fo|fr|ga|gd|ge|gf|gg|gh|gi|gl|gm|gn|gp|gq|gr|gs|gt|gu|gw|&quot; + &quot;gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|in|io|ir|is|it|je|jm|jo|jp|ke|kg|kh|ki|km|kn|kr|kw|ky|kz|&quot; + &quot;la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|mg|mh|mk|ml|mm|mn|mo|mp|mq|mr|ms|mt|mu|mv|mw|mx|&quot; + &quot;my|mz|na|nc|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|pa|pe|pf|pg|ph|pk|pl|pm|pn|pr|ps|pt|pw|py|qa|&quot; + &quot;re|ro|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sk|sl|sm|sn|sr|st|su|sv|sy|sz|tc|td|tf|tg|th|tj|tk|tm|&quot; + &quot;tn|to|tr|tt|tv|tw|tz|ua|ug|uk|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|ye|yt|yu|za|zm|zw&quot;;
+	var a = [];
+	if (flags.allowInfra) {
+		a.push(infraRE);
+	}
+	if (flags.allowGeneric) {
+		a.push(genericRE);
+	}
+	if (flags.allowCC) {
+		a.push(ccRE);
+	}
+	var tldRE = &quot;&quot;;
+	if (a.length &gt; 0) {
+		tldRE = &quot;(&quot; + a.join(&quot;|&quot;) + &quot;)&quot;;
+	}
+	return tldRE;
+};
+dojo.regexp.ipAddress = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.allowDottedDecimal != &quot;boolean&quot;) {
+		flags.allowDottedDecimal = true;
+	}
+	if (typeof flags.allowDottedHex != &quot;boolean&quot;) {
+		flags.allowDottedHex = true;
+	}
+	if (typeof flags.allowDottedOctal != &quot;boolean&quot;) {
+		flags.allowDottedOctal = true;
+	}
+	if (typeof flags.allowDecimal != &quot;boolean&quot;) {
+		flags.allowDecimal = true;
+	}
+	if (typeof flags.allowHex != &quot;boolean&quot;) {
+		flags.allowHex = true;
+	}
+	if (typeof flags.allowIPv6 != &quot;boolean&quot;) {
+		flags.allowIPv6 = true;
+	}
+	if (typeof flags.allowHybrid != &quot;boolean&quot;) {
+		flags.allowHybrid = true;
+	}
+	var dottedDecimalRE = &quot;((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])&quot;;
+	var dottedHexRE = &quot;(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]&quot;;
+	var dottedOctalRE = &quot;(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]&quot;;
+	var decimalRE = &quot;(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|&quot; + &quot;4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])&quot;;
+	var hexRE = &quot;0[xX]0*[\\da-fA-F]{1,8}&quot;;
+	var ipv6RE = &quot;([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}&quot;;
+	var hybridRE = &quot;([\\da-fA-F]{1,4}\\:){6}&quot; + &quot;((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])&quot;;
+	var a = [];
+	if (flags.allowDottedDecimal) {
+		a.push(dottedDecimalRE);
+	}
+	if (flags.allowDottedHex) {
+		a.push(dottedHexRE);
+	}
+	if (flags.allowDottedOctal) {
+		a.push(dottedOctalRE);
+	}
+	if (flags.allowDecimal) {
+		a.push(decimalRE);
+	}
+	if (flags.allowHex) {
+		a.push(hexRE);
+	}
+	if (flags.allowIPv6) {
+		a.push(ipv6RE);
+	}
+	if (flags.allowHybrid) {
+		a.push(hybridRE);
+	}
+	var ipAddressRE = &quot;&quot;;
+	if (a.length &gt; 0) {
+		ipAddressRE = &quot;(&quot; + a.join(&quot;|&quot;) + &quot;)&quot;;
+	}
+	return ipAddressRE;
+};
+dojo.regexp.host = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.allowIP != &quot;boolean&quot;) {
+		flags.allowIP = true;
+	}
+	if (typeof flags.allowLocal != &quot;boolean&quot;) {
+		flags.allowLocal = false;
+	}
+	if (typeof flags.allowPort != &quot;boolean&quot;) {
+		flags.allowPort = true;
+	}
+	var domainNameRE = &quot;([0-9a-zA-Z]([-0-9a-zA-Z]{0,61}[0-9a-zA-Z])?\\.)+&quot; + dojo.regexp.tld(flags);
+	var portRE = (flags.allowPort) ? &quot;(\\:&quot; + dojo.regexp.integer({signed:false}) + &quot;)?&quot; : &quot;&quot;;
+	var hostNameRE = domainNameRE;
+	if (flags.allowIP) {
+		hostNameRE += &quot;|&quot; + dojo.regexp.ipAddress(flags);
+	}
+	if (flags.allowLocal) {
+		hostNameRE += &quot;|localhost&quot;;
+	}
+	return &quot;(&quot; + hostNameRE + &quot;)&quot; + portRE;
+};
+dojo.regexp.url = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.scheme == &quot;undefined&quot;) {
+		flags.scheme = [true, false];
+	}
+	var protocolRE = dojo.regexp.buildGroupRE(flags.scheme, function (q) {
+		if (q) {
+			return &quot;(https?|ftps?)\\://&quot;;
+		}
+		return &quot;&quot;;
+	});
+	var pathRE = &quot;(/([^?#\\s/]+/)*)?([^?#\\s/]+(\\?[^?#\\s/]*)?(#[A-Za-z][\\w.:-]*)?)?&quot;;
+	return protocolRE + dojo.regexp.host(flags) + pathRE;
+};
+dojo.regexp.emailAddress = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.allowCruft != &quot;boolean&quot;) {
+		flags.allowCruft = false;
+	}
+	flags.allowPort = false;
+	var usernameRE = &quot;([\\da-z]+[-._+&amp;'])*[\\da-z]+&quot;;
+	var emailAddressRE = usernameRE + &quot;@&quot; + dojo.regexp.host(flags);
+	if (flags.allowCruft) {
+		emailAddressRE = &quot;&lt;?(mailto\\:)?&quot; + emailAddressRE + &quot;&gt;?&quot;;
+	}
+	return emailAddressRE;
+};
+dojo.regexp.emailAddressList = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.listSeparator != &quot;string&quot;) {
+		flags.listSeparator = &quot;\\s;,&quot;;
+	}
+	var emailAddressRE = dojo.regexp.emailAddress(flags);
+	var emailAddressListRE = &quot;(&quot; + emailAddressRE + &quot;\\s*[&quot; + flags.listSeparator + &quot;]\\s*)*&quot; + emailAddressRE + &quot;\\s*[&quot; + flags.listSeparator + &quot;]?\\s*&quot;;
+	return emailAddressListRE;
+};
+dojo.regexp.integer = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.signed == &quot;undefined&quot;) {
+		flags.signed = [true, false];
+	}
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = &quot;&quot;;
+	} else {
+		if (typeof flags.groupSize == &quot;undefined&quot;) {
+			flags.groupSize = 3;
+		}
+	}
+	var signRE = dojo.regexp.buildGroupRE(flags.signed, function (q) {
+		return q ? &quot;[-+]&quot; : &quot;&quot;;
+	});
+	var numberRE = dojo.regexp.buildGroupRE(flags.separator, function (sep) {
+		if (sep == &quot;&quot;) {
+			return &quot;(0|[1-9]\\d*)&quot;;
+		}
+		var grp = flags.groupSize, grp2 = flags.groupSize2;
+		if (typeof grp2 != &quot;undefined&quot;) {
+			var grp2RE = &quot;(0|[1-9]\\d{0,&quot; + (grp2 - 1) + &quot;}([&quot; + sep + &quot;]\\d{&quot; + grp2 + &quot;})*[&quot; + sep + &quot;]\\d{&quot; + grp + &quot;})&quot;;
+			return ((grp - grp2) &gt; 0) ? &quot;(&quot; + grp2RE + &quot;|(0|[1-9]\\d{0,&quot; + (grp - 1) + &quot;}))&quot; : grp2RE;
+		}
+		return &quot;(0|[1-9]\\d{0,&quot; + (grp - 1) + &quot;}([&quot; + sep + &quot;]\\d{&quot; + grp + &quot;})*)&quot;;
+	});
+	return signRE + numberRE;
+};
+dojo.regexp.realNumber = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.places != &quot;number&quot;) {
+		flags.places = Infinity;
+	}
+	if (typeof flags.decimal != &quot;string&quot;) {
+		flags.decimal = &quot;.&quot;;
+	}
+	if (typeof flags.fractional == &quot;undefined&quot;) {
+		flags.fractional = [true, false];
+	}
+	if (typeof flags.exponent == &quot;undefined&quot;) {
+		flags.exponent = [true, false];
+	}
+	if (typeof flags.eSigned == &quot;undefined&quot;) {
+		flags.eSigned = [true, false];
+	}
+	var integerRE = dojo.regexp.integer(flags);
+	var decimalRE = dojo.regexp.buildGroupRE(flags.fractional, function (q) {
+		var re = &quot;&quot;;
+		if (q &amp;&amp; (flags.places &gt; 0)) {
+			re = &quot;\\&quot; + flags.decimal;
+			if (flags.places == Infinity) {
+				re = &quot;(&quot; + re + &quot;\\d+)?&quot;;
+			} else {
+				re = re + &quot;\\d{&quot; + flags.places + &quot;}&quot;;
+			}
+		}
+		return re;
+	});
+	var exponentRE = dojo.regexp.buildGroupRE(flags.exponent, function (q) {
+		if (q) {
+			return &quot;([eE]&quot; + dojo.regexp.integer({signed:flags.eSigned}) + &quot;)&quot;;
+		}
+		return &quot;&quot;;
+	});
+	return integerRE + decimalRE + exponentRE;
+};
+dojo.regexp.currency = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.signed == &quot;undefined&quot;) {
+		flags.signed = [true, false];
+	}
+	if (typeof flags.symbol == &quot;undefined&quot;) {
+		flags.symbol = &quot;$&quot;;
+	}
+	if (typeof flags.placement != &quot;string&quot;) {
+		flags.placement = &quot;before&quot;;
+	}
+	if (typeof flags.signPlacement != &quot;string&quot;) {
+		flags.signPlacement = &quot;before&quot;;
+	}
+	if (typeof flags.separator == &quot;undefined&quot;) {
+		flags.separator = &quot;,&quot;;
+	}
+	if (typeof flags.fractional == &quot;undefined&quot; &amp;&amp; typeof flags.cents != &quot;undefined&quot;) {
+		dojo.deprecated(&quot;dojo.regexp.currency: flags.cents&quot;, &quot;use flags.fractional instead&quot;, &quot;0.5&quot;);
+		flags.fractional = flags.cents;
+	}
+	if (typeof flags.decimal != &quot;string&quot;) {
+		flags.decimal = &quot;.&quot;;
+	}
+	var signRE = dojo.regexp.buildGroupRE(flags.signed, function (q) {
+		if (q) {
+			return &quot;[-+]&quot;;
+		}
+		return &quot;&quot;;
+	});
+	var symbolRE = dojo.regexp.buildGroupRE(flags.symbol, function (symbol) {
+		return &quot;\\s?&quot; + symbol.replace(/([.$?*!=:|\\\/^])/g, &quot;\\$1&quot;) + &quot;\\s?&quot;;
+	});
+	switch (flags.signPlacement) {
+	  case &quot;before&quot;:
+		symbolRE = signRE + symbolRE;
+		break;
+	  case &quot;after&quot;:
+		symbolRE = symbolRE + signRE;
+		break;
+	}
+	var flagsCopy = flags;
+	flagsCopy.signed = false;
+	flagsCopy.exponent = false;
+	var numberRE = dojo.regexp.realNumber(flagsCopy);
+	var currencyRE;
+	switch (flags.placement) {
+	  case &quot;before&quot;:
+		currencyRE = symbolRE + numberRE;
+		break;
+	  case &quot;after&quot;:
+		currencyRE = numberRE + symbolRE;
+		break;
+	}
+	switch (flags.signPlacement) {
+	  case &quot;around&quot;:
+		currencyRE = &quot;(&quot; + currencyRE + &quot;|&quot; + &quot;\\(&quot; + currencyRE + &quot;\\)&quot; + &quot;)&quot;;
+		break;
+	  case &quot;begin&quot;:
+		currencyRE = signRE + currencyRE;
+		break;
+	  case &quot;end&quot;:
+		currencyRE = currencyRE + signRE;
+		break;
+	}
+	return currencyRE;
+};
+dojo.regexp.us.state = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.allowTerritories != &quot;boolean&quot;) {
+		flags.allowTerritories = true;
+	}
+	if (typeof flags.allowMilitary != &quot;boolean&quot;) {
+		flags.allowMilitary = true;
+	}
+	var statesRE = &quot;AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|&quot; + &quot;NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY&quot;;
+	var territoriesRE = &quot;AS|FM|GU|MH|MP|PW|PR|VI&quot;;
+	var militaryRE = &quot;AA|AE|AP&quot;;
+	if (flags.allowTerritories) {
+		statesRE += &quot;|&quot; + territoriesRE;
+	}
+	if (flags.allowMilitary) {
+		statesRE += &quot;|&quot; + militaryRE;
+	}
+	return &quot;(&quot; + statesRE + &quot;)&quot;;
+};
+dojo.regexp.time = function (flags) {
+	dojo.deprecated(&quot;dojo.regexp.time&quot;, &quot;Use dojo.date.parse instead&quot;, &quot;0.5&quot;);
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.format == &quot;undefined&quot;) {
+		flags.format = &quot;h:mm:ss t&quot;;
+	}
+	if (typeof flags.amSymbol != &quot;string&quot;) {
+		flags.amSymbol = &quot;AM&quot;;
+	}
+	if (typeof flags.pmSymbol != &quot;string&quot;) {
+		flags.pmSymbol = &quot;PM&quot;;
+	}
+	var timeRE = function (format) {
+		format = format.replace(/([.$?*!=:|{}\(\)\[\]\\\/^])/g, &quot;\\$1&quot;);
+		var amRE = flags.amSymbol.replace(/([.$?*!=:|{}\(\)\[\]\\\/^])/g, &quot;\\$1&quot;);
+		var pmRE = flags.pmSymbol.replace(/([.$?*!=:|{}\(\)\[\]\\\/^])/g, &quot;\\$1&quot;);
+		format = format.replace(&quot;hh&quot;, &quot;(0[1-9]|1[0-2])&quot;);
+		format = format.replace(&quot;h&quot;, &quot;([1-9]|1[0-2])&quot;);
+		format = format.replace(&quot;HH&quot;, &quot;([01][0-9]|2[0-3])&quot;);
+		format = format.replace(&quot;H&quot;, &quot;([0-9]|1[0-9]|2[0-3])&quot;);
+		format = format.replace(&quot;mm&quot;, &quot;([0-5][0-9])&quot;);
+		format = format.replace(&quot;m&quot;, &quot;([1-5][0-9]|[0-9])&quot;);
+		format = format.replace(&quot;ss&quot;, &quot;([0-5][0-9])&quot;);
+		format = format.replace(&quot;s&quot;, &quot;([1-5][0-9]|[0-9])&quot;);
+		format = format.replace(&quot;t&quot;, &quot;\\s?(&quot; + amRE + &quot;|&quot; + pmRE + &quot;)\\s?&quot;);
+		return format;
+	};
+	return dojo.regexp.buildGroupRE(flags.format, timeRE);
+};
+dojo.regexp.numberFormat = function (flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (typeof flags.format == &quot;undefined&quot;) {
+		flags.format = &quot;###-###-####&quot;;
+	}
+	var digitRE = function (format) {
+		format = format.replace(/([.$*!=:|{}\(\)\[\]\\\/^])/g, &quot;\\$1&quot;);
+		format = format.replace(/\?/g, &quot;\\d?&quot;);
+		format = format.replace(/#/g, &quot;\\d&quot;);
+		return format;
+	};
+	return dojo.regexp.buildGroupRE(flags.format, digitRE);
+};
+dojo.regexp.buildGroupRE = function (a, re) {
+	if (!(a instanceof Array)) {
+		return re(a);
+	}
+	var b = [];
+	for (var i = 0; i &lt; a.length; i++) {
+		b.push(re(a[i]));
+	}
+	return &quot;(&quot; + b.join(&quot;|&quot;) + &quot;)&quot;;
+};
+

Added: tags/parley-0.55/root/static/magic/src/rpc/Deferred.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/Deferred.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/Deferred.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,18 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.rpc.Deferred&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.deprecated(&quot;dojo.rpc.Deferred&quot;, &quot;replaced by dojo.Deferred&quot;, &quot;0.6&quot;);
+dojo.rpc.Deferred = dojo.Deferred;
+dojo.rpc.Deferred.prototype = dojo.Deferred.prototype;
+

Added: tags/parley-0.55/root/static/magic/src/rpc/JotService.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/JotService.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/JotService.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,27 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.rpc.JotService&quot;);
+dojo.require(&quot;dojo.rpc.RpcService&quot;);
+dojo.require(&quot;dojo.rpc.JsonService&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.rpc.JotService = function () {
+	this.serviceUrl = &quot;/_/jsonrpc&quot;;
+};
+dojo.inherits(dojo.rpc.JotService, dojo.rpc.JsonService);
+dojo.lang.extend(dojo.rpc.JotService, {bind:function (method, parameters, deferredRequestHandler, url) {
+	dojo.io.bind({url:url || this.serviceUrl, content:{json:this.createRequest(method, parameters)}, method:&quot;POST&quot;, mimetype:&quot;text/json&quot;, load:this.resultCallback(deferredRequestHandler), error:this.errorCallback(deferredRequestHandler), preventCache:true});
+}, createRequest:function (method, params) {
+	var req = {&quot;params&quot;:params, &quot;method&quot;:method, &quot;id&quot;:this.lastSubmissionId++};
+	return dojo.json.serialize(req);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/rpc/JsonService.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/JsonService.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/JsonService.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,71 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.rpc.JsonService&quot;);
+dojo.require(&quot;dojo.rpc.RpcService&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.rpc.JsonService = function (args) {
+	if (args) {
+		if (dojo.lang.isString(args)) {
+			this.connect(args);
+		} else {
+			if (args[&quot;smdUrl&quot;]) {
+				this.connect(args.smdUrl);
+			}
+			if (args[&quot;smdStr&quot;]) {
+				this.processSmd(dj_eval(&quot;(&quot; + args.smdStr + &quot;)&quot;));
+			}
+			if (args[&quot;smdObj&quot;]) {
+				this.processSmd(args.smdObj);
+			}
+			if (args[&quot;serviceUrl&quot;]) {
+				this.serviceUrl = args.serviceUrl;
+			}
+			if (typeof args[&quot;strictArgChecks&quot;] != &quot;undefined&quot;) {
+				this.strictArgChecks = args.strictArgChecks;
+			}
+		}
+	}
+};
+dojo.inherits(dojo.rpc.JsonService, dojo.rpc.RpcService);
+dojo.extend(dojo.rpc.JsonService, {bustCache:false, contentType:&quot;application/json-rpc&quot;, lastSubmissionId:0, callRemote:function (method, params) {
+	var deferred = new dojo.Deferred();
+	this.bind(method, params, deferred);
+	return deferred;
+}, bind:function (method, parameters, deferredRequestHandler, url) {
+	dojo.io.bind({url:url || this.serviceUrl, postContent:this.createRequest(method, parameters), method:&quot;POST&quot;, contentType:this.contentType, mimetype:&quot;text/json&quot;, load:this.resultCallback(deferredRequestHandler), error:this.errorCallback(deferredRequestHandler), preventCache:this.bustCache});
+}, createRequest:function (method, params) {
+	var req = {&quot;params&quot;:params, &quot;method&quot;:method, &quot;id&quot;:++this.lastSubmissionId};
+	var data = dojo.json.serialize(req);
+	dojo.debug(&quot;JsonService: JSON-RPC Request: &quot; + data);
+	return data;
+}, parseResults:function (obj) {
+	if (!obj) {
+		return;
+	}
+	if (obj[&quot;Result&quot;] != null) {
+		return obj[&quot;Result&quot;];
+	} else {
+		if (obj[&quot;result&quot;] != null) {
+			return obj[&quot;result&quot;];
+		} else {
+			if (obj[&quot;ResultSet&quot;]) {
+				return obj[&quot;ResultSet&quot;];
+			} else {
+				return obj;
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/rpc/RpcService.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/RpcService.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/RpcService.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,74 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.rpc.RpcService&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.rpc.RpcService = function (url) {
+	if (url) {
+		this.connect(url);
+	}
+};
+dojo.lang.extend(dojo.rpc.RpcService, {strictArgChecks:true, serviceUrl:&quot;&quot;, parseResults:function (obj) {
+	return obj;
+}, errorCallback:function (deferredRequestHandler) {
+	return function (type, e) {
+		deferredRequestHandler.errback(new Error(e.message));
+	};
+}, resultCallback:function (deferredRequestHandler) {
+	var tf = dojo.lang.hitch(this, function (type, obj, e) {
+		if (obj[&quot;error&quot;] != null) {
+			var err = new Error(obj.error);
+			err.id = obj.id;
+			deferredRequestHandler.errback(err);
+		} else {
+			var results = this.parseResults(obj);
+			deferredRequestHandler.callback(results);
+		}
+	});
+	return tf;
+}, generateMethod:function (method, parameters, url) {
+	return dojo.lang.hitch(this, function () {
+		var deferredRequestHandler = new dojo.Deferred();
+		if ((this.strictArgChecks) &amp;&amp; (parameters != null) &amp;&amp; (arguments.length != parameters.length)) {
+			dojo.raise(&quot;Invalid number of parameters for remote method.&quot;);
+		} else {
+			this.bind(method, arguments, deferredRequestHandler, url);
+		}
+		return deferredRequestHandler;
+	});
+}, processSmd:function (object) {
+	dojo.debug(&quot;RpcService: Processing returned SMD.&quot;);
+	if (object.methods) {
+		dojo.lang.forEach(object.methods, function (m) {
+			if (m &amp;&amp; m[&quot;name&quot;]) {
+				dojo.debug(&quot;RpcService: Creating Method: this.&quot;, m.name, &quot;()&quot;);
+				this[m.name] = this.generateMethod(m.name, m.parameters, m[&quot;url&quot;] || m[&quot;serviceUrl&quot;] || m[&quot;serviceURL&quot;]);
+				if (dojo.lang.isFunction(this[m.name])) {
+					dojo.debug(&quot;RpcService: Successfully created&quot;, m.name, &quot;()&quot;);
+				} else {
+					dojo.debug(&quot;RpcService: Failed to create&quot;, m.name, &quot;()&quot;);
+				}
+			}
+		}, this);
+	}
+	this.serviceUrl = object.serviceUrl || object.serviceURL;
+	dojo.debug(&quot;RpcService: Dojo RpcService is ready for use.&quot;);
+}, connect:function (smdUrl) {
+	dojo.debug(&quot;RpcService: Attempting to load SMD document from:&quot;, smdUrl);
+	dojo.io.bind({url:smdUrl, mimetype:&quot;text/json&quot;, load:dojo.lang.hitch(this, function (type, object, e) {
+		return this.processSmd(object);
+	}), sync:true});
+}});
+

Added: tags/parley-0.55/root/static/magic/src/rpc/YahooService.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/YahooService.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/YahooService.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,41 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.rpc.YahooService&quot;);
+dojo.require(&quot;dojo.rpc.RpcService&quot;);
+dojo.require(&quot;dojo.rpc.JsonService&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.require(&quot;dojo.io.ScriptSrcIO&quot;);
+dojo.rpc.YahooService = function (appId) {
+	this.appId = appId;
+	if (!appId) {
+		this.appId = &quot;dojotoolkit&quot;;
+		dojo.debug(&quot;please initialize the YahooService class with your own&quot;, &quot;application ID. Using the default may cause problems during&quot;, &quot;deployment of your application&quot;);
+	}
+	if (djConfig[&quot;useXDomain&quot;] &amp;&amp; !djConfig[&quot;yahooServiceSmdUrl&quot;]) {
+		dojo.debug(&quot;dojo.rpc.YahooService: When using cross-domain Dojo builds,&quot; + &quot; please save yahoo.smd to your domain and set djConfig.yahooServiceSmdUrl&quot; + &quot; to the path on your domain to yahoo.smd&quot;);
+	}
+	this.connect(djConfig[&quot;yahooServiceSmdUrl&quot;] || dojo.uri.moduleUri(&quot;dojo.rpc&quot;, &quot;yahoo.smd&quot;));
+	this.strictArgChecks = false;
+};
+dojo.inherits(dojo.rpc.YahooService, dojo.rpc.JsonService);
+dojo.lang.extend(dojo.rpc.YahooService, {strictArgChecks:false, bind:function (method, parameters, deferredRequestHandler, url) {
+	var params = parameters;
+	if ((dojo.lang.isArrayLike(parameters)) &amp;&amp; (parameters.length == 1)) {
+		params = parameters[0];
+	}
+	params.output = &quot;json&quot;;
+	params.appid = this.appId;
+	dojo.io.bind({url:url || this.serviceUrl, transport:&quot;ScriptSrcTransport&quot;, content:params, jsonParamName:&quot;callback&quot;, mimetype:&quot;text/json&quot;, load:this.resultCallback(deferredRequestHandler), error:this.errorCallback(deferredRequestHandler), preventCache:true});
+}});
+

Added: tags/parley-0.55/root/static/magic/src/rpc/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[[&quot;dojo.rpc.JsonService&quot;, false, false]]});
+dojo.provide(&quot;dojo.rpc.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/rpc/yahoo.smd
===================================================================
--- tags/parley-0.55/root/static/magic/src/rpc/yahoo.smd	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/rpc/yahoo.smd	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,289 @@
+{
+	&quot;SMDVersion&quot;:&quot;.1&quot;,
+	&quot;objectName&quot;:&quot;yahoo&quot;,
+	&quot;serviceType&quot;:&quot;JSON-P&quot;,
+	&quot;methods&quot;:[
+		//
+		// MAPS 
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/maps/rest/V1/mapImage.html">http://developer.yahoo.com/maps/rest/V1/mapImage.html</A>
+			&quot;name&quot;:&quot;mapImage&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.local.yahoo.com/MapsService/V1/mapImage">http://api.local.yahoo.com/MapsService/V1/mapImage</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;street&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;city&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;zip&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;location&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;longitude&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;latitude&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;image_type&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;image_width&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;image_height&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;zoom&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;radius&quot;, &quot;type&quot;:&quot;INTEGER&quot; }
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/traffic/rest/V1/index.html">http://developer.yahoo.com/traffic/rest/V1/index.html</A>
+			&quot;name&quot;:&quot;trafficData&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.local.yahoo.com/MapsService/V1/trafficData">http://api.local.yahoo.com/MapsService/V1/trafficData</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;street&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;city&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;zip&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;location&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;longitude&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;latitude&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;severity&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;include_map&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;image_type&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;image_width&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;image_height&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;zoom&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;radius&quot;, &quot;type&quot;:&quot;INTEGER&quot; }
+			]
+		},
+		/*
+			// Yahoo's geocoding service is f'd for JSON and Y! advises that it
+			// may not be returning
+		{
+			// <A HREF="http://developer.yahoo.com/maps/rest/V1/geocode.html">http://developer.yahoo.com/maps/rest/V1/geocode.html</A>
+			&quot;name&quot;:&quot;geocode&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.local.yahoo.com/MapsService/V1/geocode">http://api.local.yahoo.com/MapsService/V1/geocode</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;street&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;city&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;zip&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;location&quot;, &quot;type&quot;:&quot;STRING&quot; }
+			]
+		},
+		*/
+		//
+		// LOCAL SEARCH
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/search/local/V3/localSearch.html">http://developer.yahoo.com/search/local/V3/localSearch.html</A>
+			&quot;name&quot;:&quot;localSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.local.yahoo.com/LocalSearchService/V3/localSearch">http://api.local.yahoo.com/LocalSearchService/V3/localSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;street&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;city&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;zip&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;location&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;listing_id&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;sort&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;relevence&quot;, &quot;title&quot;, &quot;distance&quot;, or &quot;rating&quot;
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;radius&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // 1-50, defaults to 10
+				{ &quot;name&quot;:&quot;longitude&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;latitude&quot;, &quot;type&quot;:&quot;FLOAT&quot; },
+				{ &quot;name&quot;:&quot;category&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;omit_category&quot;, &quot;type&quot;:&quot;INTEGER&quot; },
+				{ &quot;name&quot;:&quot;minimum_rating&quot;, &quot;type&quot;:&quot;INTEGER&quot; }
+			]
+		},
+		//
+		// WEB SEARCH
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/search/web/V1/webSearch.html">http://developer.yahoo.com/search/web/V1/webSearch.html</A> 
+			&quot;name&quot;:&quot;webSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/WebSearchService/V1/webSearch">http://api.search.yahoo.com/WebSearchService/V1/webSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;all&quot;
+				{ &quot;name&quot;:&quot;region&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;us&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 1
+				{ &quot;name&quot;:&quot;format&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;any&quot;, can be &quot;html&quot;, &quot;msword&quot;, &quot;pdf&quot;, &quot;ppt&quot;, &quot;rst&quot;, &quot;txt&quot;, or &quot;xls&quot;
+				{ &quot;name&quot;:&quot;adult_ok&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;similar_ok&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;language&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;country&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;site&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;subscription&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;license&quot;, &quot;type&quot;:&quot;STRING&quot; } // defaults to &quot;any&quot;
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/web/V1/spellingSuggestion.html">http://developer.yahoo.com/search/web/V1/spellingSuggestion.html</A>
+			&quot;name&quot;:&quot;spellingSuggestion&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/WebSearchService/V1/spellingSuggestion">http://api.search.yahoo.com/WebSearchService/V1/spellingSuggestion</A>&quot;,
+			&quot;parameters&quot;:[ { &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; } ]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/web/V1/relatedSuggestion.html">http://developer.yahoo.com/search/web/V1/relatedSuggestion.html</A>
+			&quot;name&quot;:&quot;spellingSuggestion&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/WebSearchService/V1/relatedSuggestion">http://api.search.yahoo.com/WebSearchService/V1/relatedSuggestion</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; } // 1-50, defaults to 10
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/content/V1/termExtraction.html">http://developer.yahoo.com/search/content/V1/termExtraction.html</A>
+			&quot;name&quot;:&quot;termExtraction&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://search.yahooapis.com/ContentAnalysisService/V1/termExtraction">http://search.yahooapis.com/ContentAnalysisService/V1/termExtraction</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;context&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; } // 1-50, defaults to 10
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/web/V1/contextSearch.html">http://developer.yahoo.com/search/web/V1/contextSearch.html</A>
+			&quot;name&quot;:&quot;contextSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://search.yahooapis.com/WebSearchService/V1/contextSearch">http://search.yahooapis.com/WebSearchService/V1/contextSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;context&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;all&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 1
+				{ &quot;name&quot;:&quot;format&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;any&quot;, can be &quot;html&quot;, &quot;msword&quot;, &quot;pdf&quot;, &quot;ppt&quot;, &quot;rst&quot;, &quot;txt&quot;, or &quot;xls&quot;
+				{ &quot;name&quot;:&quot;adult_ok&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;similar_ok&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;language&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;country&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;site&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;license&quot;, &quot;type&quot;:&quot;STRING&quot; } // defaults to &quot;any&quot;, could be &quot;cc_any&quot;, &quot;cc_commercial&quot;, &quot;cc_modifiable&quot;
+			]
+		},
+		//
+		// IMAGE SEARCH
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/search/image/V1/imageSearch.html">http://developer.yahoo.com/search/image/V1/imageSearch.html</A>
+			&quot;name&quot;:&quot;imageSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/ImageSearchService/V1/imageSearch">http://api.search.yahoo.com/ImageSearchService/V1/imageSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;all&quot;, can by &quot;any&quot; or &quot;phrase&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 1
+				{ &quot;name&quot;:&quot;format&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;any&quot;, can be &quot;bmp&quot;, &quot;gif&quot;, &quot;jpeg&quot;, or &quot;png&quot;
+				{ &quot;name&quot;:&quot;adult_ok&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;coloration&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;any&quot;, &quot;color&quot;, or &quot;bw&quot;
+				{ &quot;name&quot;:&quot;site&quot;, &quot;type&quot;:&quot;STRING&quot; } // defaults to null
+			]
+		},
+		//
+		// SITE EXPLORER
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/search/siteexplorer/V1/inlinkData.html">http://developer.yahoo.com/search/siteexplorer/V1/inlinkData.html</A> 
+			&quot;name&quot;:&quot;inlinkData&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/SiteExplorerService/V1/inlinkData">http://api.search.yahoo.com/SiteExplorerService/V1/inlinkData</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;all&quot;, can by &quot;any&quot; or &quot;phrase&quot;
+				{ &quot;name&quot;:&quot;entire_site&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;omit_inlinks&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;domain&quot; or &quot;subdomain&quot;, defaults to null
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 50
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 1
+				{ &quot;name&quot;:&quot;site&quot;, &quot;type&quot;:&quot;STRING&quot; } // defaults to null
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/siteexplorer/V1/pageData.html">http://developer.yahoo.com/search/siteexplorer/V1/pageData.html</A>
+			&quot;name&quot;:&quot;pageData&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/SiteExplorerService/V1/pageData">http://api.search.yahoo.com/SiteExplorerService/V1/pageData</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;all&quot;, can by &quot;any&quot; or &quot;phrase&quot;
+				{ &quot;name&quot;:&quot;domain_only&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 50
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 1
+				{ &quot;name&quot;:&quot;site&quot;, &quot;type&quot;:&quot;STRING&quot; } // defaults to null
+			]
+		},
+		//
+		// MUSIC SEARCH
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/search/audio/V1/artistSearch.html">http://developer.yahoo.com/search/audio/V1/artistSearch.html</A>
+			&quot;name&quot;:&quot;artistSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/AudioSearchService/V1/artistSearch">http://api.search.yahoo.com/AudioSearchService/V1/artistSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;artist&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;artistid&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;all&quot;, &quot;any&quot;, or &quot;phrase&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // 1-50, defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; } // defaults to 1
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/audio/V1/albumSearch.html">http://developer.yahoo.com/search/audio/V1/albumSearch.html</A>
+			&quot;name&quot;:&quot;albumSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/AudioSearchService/V1/albumSearch">http://api.search.yahoo.com/AudioSearchService/V1/albumSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;artist&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;artistid&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;album&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;all&quot;, &quot;any&quot;, or &quot;phrase&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // 1-50, defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; } // defaults to 1
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/audio/V1/songSearch.html">http://developer.yahoo.com/search/audio/V1/songSearch.html</A>
+			&quot;name&quot;:&quot;songSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/AudioSearchService/V1/songSearch">http://api.search.yahoo.com/AudioSearchService/V1/songSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;artist&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;artistid&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;album&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;albumid&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;song&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;songid&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;all&quot;, &quot;any&quot;, or &quot;phrase&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // 1-50, defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; } // defaults to 1
+			]
+		},
+		{
+			// <A HREF="http://developer.yahoo.com/search/audio/V1/songDownloadLocation.html">http://developer.yahoo.com/search/audio/V1/songDownloadLocation.html</A>
+			&quot;name&quot;:&quot;songDownloadLocation&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/AudioSearchService/V1/songDownloadLocation">http://api.search.yahoo.com/AudioSearchService/V1/songDownloadLocation</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;songid&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				// &quot;source&quot; can contain:
+				//	audiolunchbox artistdirect buymusic dmusic
+				//	emusic epitonic garageband itunes yahoo
+				//	livedownloads mp34u msn musicmatch mapster passalong
+				//	rhapsody soundclick theweb
+				{ &quot;name&quot;:&quot;source&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // 1-50, defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; } // defaults to 1
+			]
+		},
+		//
+		// NEWS SEARCH
+		//
+		{
+			// <A HREF="http://developer.yahoo.com/search/news/V1/newsSearch.html">http://developer.yahoo.com/search/news/V1/newsSearch.html</A>
+			&quot;name&quot;:&quot;newsSearch&quot;,
+			&quot;serviceURL&quot;: &quot;<A HREF="http://api.search.yahoo.com/NewsSearchService/V1/newsSearch">http://api.search.yahoo.com/NewsSearchService/V1/newsSearch</A>&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;query&quot;, &quot;type&quot;:&quot;STRING&quot; },
+				{ &quot;name&quot;:&quot;type&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to &quot;all&quot;
+				{ &quot;name&quot;:&quot;results&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 10
+				{ &quot;name&quot;:&quot;start&quot;, &quot;type&quot;:&quot;INTEGER&quot; }, // defaults to 1
+				{ &quot;name&quot;:&quot;sort&quot;, &quot;type&quot;:&quot;STRING&quot; }, // &quot;rank&quot; or &quot;date&quot;
+				{ &quot;name&quot;:&quot;language&quot;, &quot;type&quot;:&quot;STRING&quot; }, // defaults to null
+				{ &quot;name&quot;:&quot;site&quot;, &quot;type&quot;:&quot;STRING&quot; } // defaults to null
+			]
+		}
+		/*
+		{
+			// 
+			&quot;name&quot;:&quot;&quot;,
+			&quot;serviceURL&quot;: &quot;&quot;,
+			&quot;parameters&quot;:[
+				{ &quot;name&quot;:&quot;street&quot;, &quot;type&quot;:&quot;STRING&quot; },
+			]
+		}
+		*/
+	]
+}

Added: tags/parley-0.55/root/static/magic/src/selection/Selection.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/selection/Selection.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/selection/Selection.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,316 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.selection.Selection&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.declare(&quot;dojo.selection.Selection&quot;, null, {initializer:function (items, isCollection) {
+	this.items = [];
+	this.selection = [];
+	this._pivotItems = [];
+	this.clearItems();
+	if (items) {
+		if (isCollection) {
+			this.setItemsCollection(items);
+		} else {
+			this.setItems(items);
+		}
+	}
+}, items:null, selection:null, lastSelected:null, allowImplicit:true, length:0, isGrowable:true, _pivotItems:null, _pivotItem:null, onSelect:function (item) {
+}, onDeselect:function (item) {
+}, onSelectChange:function (item, selected) {
+}, _find:function (item, inSelection) {
+	if (inSelection) {
+		return dojo.lang.find(this.selection, item);
+	} else {
+		return dojo.lang.find(this.items, item);
+	}
+}, isSelectable:function (item) {
+	return true;
+}, setItems:function () {
+	this.clearItems();
+	this.addItems.call(this, arguments);
+}, setItemsCollection:function (collection) {
+	this.items = collection;
+}, addItems:function () {
+	var args = dojo.lang.unnest(arguments);
+	for (var i = 0; i &lt; args.length; i++) {
+		this.items.push(args[i]);
+	}
+}, addItemsAt:function (item, before) {
+	if (this.items.length == 0) {
+		return this.addItems(dojo.lang.toArray(arguments, 2));
+	}
+	if (!this.isItem(item)) {
+		item = this.items[item];
+	}
+	if (!item) {
+		throw new Error(&quot;addItemsAt: item doesn't exist&quot;);
+	}
+	var idx = this._find(item);
+	if (idx &gt; 0 &amp;&amp; before) {
+		idx--;
+	}
+	for (var i = 2; i &lt; arguments.length; i++) {
+		if (!this.isItem(arguments[i])) {
+			this.items.splice(idx++, 0, arguments[i]);
+		}
+	}
+}, removeItem:function (item) {
+	var idx = this._find(item);
+	if (idx &gt; -1) {
+		this.items.splice(idx, 1);
+	}
+	idx = this._find(item, true);
+	if (idx &gt; -1) {
+		this.selection.splice(idx, 1);
+	}
+}, clearItems:function () {
+	this.items = [];
+	this.deselectAll();
+}, isItem:function (item) {
+	return this._find(item) &gt; -1;
+}, isSelected:function (item) {
+	return this._find(item, true) &gt; -1;
+}, selectFilter:function (item, selection, add, grow) {
+	return true;
+}, update:function (item, add, grow, noToggle) {
+	if (!this.isItem(item)) {
+		return false;
+	}
+	if (this.isGrowable &amp;&amp; grow) {
+		if ((!this.isSelected(item)) &amp;&amp; this.selectFilter(item, this.selection, false, true)) {
+			this.grow(item);
+			this.lastSelected = item;
+		}
+	} else {
+		if (add) {
+			if (this.selectFilter(item, this.selection, true, false)) {
+				if (noToggle) {
+					if (this.select(item)) {
+						this.lastSelected = item;
+					}
+				} else {
+					if (this.toggleSelected(item)) {
+						this.lastSelected = item;
+					}
+				}
+			}
+		} else {
+			this.deselectAll();
+			this.select(item);
+		}
+	}
+	this.length = this.selection.length;
+	return true;
+}, grow:function (toItem, fromItem) {
+	if (!this.isGrowable) {
+		return;
+	}
+	if (arguments.length == 1) {
+		fromItem = this._pivotItem;
+		if (!fromItem &amp;&amp; this.allowImplicit) {
+			fromItem = this.items[0];
+		}
+	}
+	if (!toItem || !fromItem) {
+		return false;
+	}
+	var fromIdx = this._find(fromItem);
+	var toDeselect = {};
+	var lastIdx = -1;
+	if (this.lastSelected) {
+		lastIdx = this._find(this.lastSelected);
+		var step = fromIdx &lt; lastIdx ? -1 : 1;
+		var range = dojo.math.range(lastIdx, fromIdx, step);
+		for (var i = 0; i &lt; range.length; i++) {
+			toDeselect[range[i]] = true;
+		}
+	}
+	var toIdx = this._find(toItem);
+	var step = fromIdx &lt; toIdx ? -1 : 1;
+	var shrink = lastIdx &gt;= 0 &amp;&amp; step == 1 ? lastIdx &lt; toIdx : lastIdx &gt; toIdx;
+	var range = dojo.math.range(toIdx, fromIdx, step);
+	if (range.length) {
+		for (var i = range.length - 1; i &gt;= 0; i--) {
+			var item = this.items[range[i]];
+			if (this.selectFilter(item, this.selection, false, true)) {
+				if (this.select(item, true) || shrink) {
+					this.lastSelected = item;
+				}
+				if (range[i] in toDeselect) {
+					delete toDeselect[range[i]];
+				}
+			}
+		}
+	} else {
+		this.lastSelected = fromItem;
+	}
+	for (var i in toDeselect) {
+		if (this.items[i] == this.lastSelected) {
+		}
+		this.deselect(this.items[i]);
+	}
+	this._updatePivot();
+}, growUp:function () {
+	if (!this.isGrowable) {
+		return;
+	}
+	var idx = this._find(this.lastSelected) - 1;
+	while (idx &gt;= 0) {
+		if (this.selectFilter(this.items[idx], this.selection, false, true)) {
+			this.grow(this.items[idx]);
+			break;
+		}
+		idx--;
+	}
+}, growDown:function () {
+	if (!this.isGrowable) {
+		return;
+	}
+	var idx = this._find(this.lastSelected);
+	if (idx &lt; 0 &amp;&amp; this.allowImplicit) {
+		this.select(this.items[0]);
+		idx = 0;
+	}
+	idx++;
+	while (idx &gt; 0 &amp;&amp; idx &lt; this.items.length) {
+		if (this.selectFilter(this.items[idx], this.selection, false, true)) {
+			this.grow(this.items[idx]);
+			break;
+		}
+		idx++;
+	}
+}, toggleSelected:function (item, noPivot) {
+	if (this.isItem(item)) {
+		if (this.select(item, noPivot)) {
+			return 1;
+		}
+		if (this.deselect(item)) {
+			return -1;
+		}
+	}
+	return 0;
+}, select:function (item, noPivot) {
+	if (this.isItem(item) &amp;&amp; !this.isSelected(item) &amp;&amp; this.isSelectable(item)) {
+		this.selection.push(item);
+		this.lastSelected = item;
+		this.onSelect(item);
+		this.onSelectChange(item, true);
+		if (!noPivot) {
+			this._addPivot(item);
+		}
+		this.length = this.selection.length;
+		return true;
+	}
+	return false;
+}, deselect:function (item) {
+	var idx = this._find(item, true);
+	if (idx &gt; -1) {
+		this.selection.splice(idx, 1);
+		this.onDeselect(item);
+		this.onSelectChange(item, false);
+		if (item == this.lastSelected) {
+			this.lastSelected = null;
+		}
+		this._removePivot(item);
+		this.length = this.selection.length;
+		return true;
+	}
+	return false;
+}, selectAll:function () {
+	for (var i = 0; i &lt; this.items.length; i++) {
+		this.select(this.items[i]);
+	}
+}, deselectAll:function () {
+	while (this.selection &amp;&amp; this.selection.length) {
+		this.deselect(this.selection[0]);
+	}
+}, selectNext:function () {
+	var idx = this._find(this.lastSelected);
+	while (idx &gt; -1 &amp;&amp; ++idx &lt; this.items.length) {
+		if (this.isSelectable(this.items[idx])) {
+			this.deselectAll();
+			this.select(this.items[idx]);
+			return true;
+		}
+	}
+	return false;
+}, selectPrevious:function () {
+	var idx = this._find(this.lastSelected);
+	while (idx-- &gt; 0) {
+		if (this.isSelectable(this.items[idx])) {
+			this.deselectAll();
+			this.select(this.items[idx]);
+			return true;
+		}
+	}
+	return false;
+}, selectFirst:function () {
+	this.deselectAll();
+	var idx = 0;
+	while (this.items[idx] &amp;&amp; !this.select(this.items[idx])) {
+		idx++;
+	}
+	return this.items[idx] ? true : false;
+}, selectLast:function () {
+	this.deselectAll();
+	var idx = this.items.length - 1;
+	while (this.items[idx] &amp;&amp; !this.select(this.items[idx])) {
+		idx--;
+	}
+	return this.items[idx] ? true : false;
+}, _addPivot:function (item, andClear) {
+	this._pivotItem = item;
+	if (andClear) {
+		this._pivotItems = [item];
+	} else {
+		this._pivotItems.push(item);
+	}
+}, _removePivot:function (item) {
+	var i = dojo.lang.find(this._pivotItems, item);
+	if (i &gt; -1) {
+		this._pivotItems.splice(i, 1);
+		this._pivotItem = this._pivotItems[this._pivotItems.length - 1];
+	}
+	this._updatePivot();
+}, _updatePivot:function () {
+	if (this._pivotItems.length == 0) {
+		if (this.lastSelected) {
+			this._addPivot(this.lastSelected);
+		}
+	}
+}, sorted:function () {
+	return dojo.lang.toArray(this.selection).sort(dojo.lang.hitch(this, function (a, b) {
+		var A = this._find(a), B = this._find(b);
+		if (A &gt; B) {
+			return 1;
+		} else {
+			if (A &lt; B) {
+				return -1;
+			} else {
+				return 0;
+			}
+		}
+	}));
+}, updateSelected:function () {
+	for (var i = 0; i &lt; this.selection.length; i++) {
+		if (this._find(this.selection[i]) &lt; 0) {
+			var removed = this.selection.splice(i, 1);
+			this._removePivot(removed[0]);
+		}
+	}
+	this.length = this.selection.length;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/storage/Storage.as
===================================================================
--- tags/parley-0.55/root/static/magic/src/storage/Storage.as	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/storage/Storage.as	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,146 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+import DojoExternalInterface;
+
+class Storage {
+	public static var SUCCESS = &quot;success&quot;;
+	public static var FAILED = &quot;failed&quot;;
+	public static var PENDING = &quot;pending&quot;;
+	
+	public var so;
+	
+	public function Storage(){
+		//getURL(&quot;javascript:dojo.debug('FLASH:Storage constructor')&quot;);
+		DojoExternalInterface.initialize();
+		DojoExternalInterface.addCallback(&quot;put&quot;, this, put);
+		DojoExternalInterface.addCallback(&quot;get&quot;, this, get);
+		DojoExternalInterface.addCallback(&quot;showSettings&quot;, this, showSettings);
+		DojoExternalInterface.addCallback(&quot;clear&quot;, this, clear);
+		DojoExternalInterface.addCallback(&quot;getKeys&quot;, this, getKeys);
+		DojoExternalInterface.addCallback(&quot;remove&quot;, this, remove);
+		DojoExternalInterface.loaded();
+		
+		// preload the System Settings finished button movie for offline
+		// access so it is in the cache
+		_root.createEmptyMovieClip(&quot;_settingsBackground&quot;, 1);
+		// getURL(&quot;javascript:alert('&quot;+DojoExternalInterface.dojoPath+&quot;');&quot;);
+		_root._settingsBackground.loadMovie(DojoExternalInterface.dojoPath + &quot;storage_dialog.swf&quot;);
+	}
+
+	public function put(keyName, keyValue, namespace){
+		// Get the SharedObject for these values and save it
+		so = SharedObject.getLocal(namespace);
+		
+		// prepare a storage status handler
+		var self = this;
+		so.onStatus = function(infoObject:Object){
+			//getURL(&quot;javascript:dojo.debug('FLASH: onStatus, infoObject=&quot;+infoObject.code+&quot;')&quot;);
+			
+			// delete the data value if the request was denied
+			if (infoObject.code == &quot;SharedObject.Flush.Failed&quot;){
+				delete self.so.data[keyName];
+			}
+			
+			var statusResults;
+			if(infoObject.code == &quot;SharedObject.Flush.Failed&quot;){
+				statusResults = Storage.FAILED;
+			}else if(infoObject.code == &quot;SharedObject.Flush.Pending&quot;){
+				statusResults = Storage.PENDING;
+			}else if(infoObject.code == &quot;SharedObject.Flush.Success&quot;){
+				statusResults = Storage.SUCCESS;
+			}
+			//getURL(&quot;javascript:dojo.debug('FLASH: onStatus, statusResults=&quot;+statusResults+&quot;')&quot;);
+			
+			// give the status results to JavaScript
+			DojoExternalInterface.call(&quot;dojo.storage._onStatus&quot;, null, statusResults, 
+																 keyName);
+		}
+		
+		// save the key and value
+		so.data[keyName] = keyValue;
+		var flushResults = so.flush();
+		
+		// return results of this command to JavaScript
+		var statusResults;
+		if(flushResults == true){
+			statusResults = Storage.SUCCESS;
+		}else if(flushResults == &quot;pending&quot;){
+			statusResults = Storage.PENDING;
+		}else{
+			statusResults = Storage.FAILED;
+		}
+		
+		DojoExternalInterface.call(&quot;dojo.storage._onStatus&quot;, null, statusResults, 
+															 keyName);
+	}
+
+	public function get(keyName, namespace){
+		// Get the SharedObject for these values and save it
+		so = SharedObject.getLocal(namespace);
+		var results = so.data[keyName];
+		
+		return results;
+	}
+	
+	public function showSettings(){
+		// Show the configuration options for the Flash player, opened to the
+		// section for local storage controls (pane 1)
+		System.showSettings(1);
+		
+		// there is no way we can intercept when the Close button is pressed, allowing us
+		// to hide the Flash dialog. Instead, we need to load a movie in the
+		// background that we can show a close button on.
+		_root.createEmptyMovieClip(&quot;_settingsBackground&quot;, 1);
+		_root._settingsBackground.loadMovie(DojoExternalInterface.dojoPath + &quot;storage_dialog.swf&quot;);
+	}
+	
+	public function clear(namespace){
+		so = SharedObject.getLocal(namespace);
+		so.clear();
+		so.flush();
+	}
+	
+	public function getKeys(namespace){
+		// Returns a list of the available keys in this namespace
+		
+		// get the storage object
+		so = SharedObject.getLocal(namespace);
+		
+		// get all of the keys
+		var results = new Array();
+		for(var i in so.data)
+			results.push(i);	
+		
+		// join the keys together in a comma seperated string
+		results = results.join(&quot;,&quot;);
+		
+		return results;
+	}
+	
+	public function remove(keyName, namespace){
+		// Removes a key
+
+		// get the storage object
+		so = SharedObject.getLocal(namespace);
+		
+		// delete this value
+		delete so.data[keyName];
+		
+		// save the changes
+		so.flush();
+	}
+
+	static function main(mc){
+		//getURL(&quot;javascript:dojo.debug('FLASH: storage loaded')&quot;);
+		_root.app = new Storage(); 
+	}
+}
+

Added: tags/parley-0.55/root/static/magic/src/storage/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/storage/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/storage/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.storage&quot;], browser:[&quot;dojo.storage.browser&quot;]});
+dojo.provide(&quot;dojo.storage.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/storage/browser.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/storage/browser.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/storage/browser.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,550 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.storage.browser&quot;);
+dojo.require(&quot;dojo.storage&quot;);
+dojo.require(&quot;dojo.flash&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.storage.browser.FileStorageProvider = function () {
+};
+dojo.inherits(dojo.storage.browser.FileStorageProvider, dojo.storage);
+dojo.storage.browser.FileStorageProvider._KEY_INDEX_FILENAME = &quot;__dojoAllKeys&quot;;
+dojo.storage.browser.FileStorageProvider._APPLET_ID = &quot;__dojoFileJavaObj&quot;;
+dojo.lang.extend(dojo.storage.browser.FileStorageProvider, {namespace:&quot;default&quot;, initialized:false, _available:null, _statusHandler:null, _keyIndex:new Array(), initialize:function () {
+	if (djConfig[&quot;disableFileStorage&quot;] == true) {
+		return;
+	}
+	this._loadKeyIndex();
+	this.initialized = true;
+	dojo.storage.manager.loaded();
+}, isAvailable:function () {
+	this._available = false;
+	var protocol = window.location.protocol;
+	if (protocol.indexOf(&quot;file&quot;) != -1 || protocol.indexOf(&quot;chrome&quot;) != -1) {
+		this._available = this._isAvailableXPCOM();
+		if (this._available == false) {
+			this._available = this._isAvailableActiveX();
+		}
+	}
+	return this._available;
+}, put:function (key, value, resultsHandler) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	this._statusHandler = resultsHandler;
+	try {
+		this._save(key, value);
+		resultsHandler.call(null, dojo.storage.SUCCESS, key);
+	}
+	catch (e) {
+		this._statusHandler.call(null, dojo.storage.FAILED, key, e.toString());
+	}
+}, get:function (key) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	var results = this._load(key);
+	return results;
+}, getKeys:function () {
+	return this._keyIndex;
+}, hasKey:function (key) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	this._loadKeyIndex();
+	var exists = false;
+	for (var i = 0; i &lt; this._keyIndex.length; i++) {
+		if (this._keyIndex[i] == key) {
+			exists = true;
+		}
+	}
+	return exists;
+}, clear:function () {
+	this._loadKeyIndex();
+	var keyIndex = new Array();
+	for (var i = 0; i &lt; this._keyIndex.length; i++) {
+		keyIndex[keyIndex.length] = new String(this._keyIndex[i]);
+	}
+	for (var i = 0; i &lt; keyIndex.length; i++) {
+		this.remove(keyIndex[i]);
+	}
+}, remove:function (key) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	this._loadKeyIndex();
+	for (var i = 0; i &lt; this._keyIndex.length; i++) {
+		if (this._keyIndex[i] == key) {
+			this._keyIndex.splice(i, 1);
+			break;
+		}
+	}
+	this._save(dojo.storage.browser.FileStorageProvider._KEY_INDEX_FILENAME, this._keyIndex, false);
+	var fullPath = this._getPagePath() + key + &quot;.txt&quot;;
+	if (this._isAvailableXPCOM()) {
+		this._removeXPCOM(fullPath);
+	} else {
+		if (this._isAvailableActiveX()) {
+			this._removeActiveX(fullPath);
+		}
+	}
+}, isPermanent:function () {
+	return true;
+}, getMaximumSize:function () {
+	return dojo.storage.SIZE_NO_LIMIT;
+}, hasSettingsUI:function () {
+	return false;
+}, showSettingsUI:function () {
+	dojo.raise(this.getType() + &quot; does not support a storage settings user-interface&quot;);
+}, hideSettingsUI:function () {
+	dojo.raise(this.getType() + &quot; does not support a storage settings user-interface&quot;);
+}, getType:function () {
+	return &quot;dojo.storage.browser.FileStorageProvider&quot;;
+}, _save:function (key, value, updateKeyIndex) {
+	if (typeof updateKeyIndex == &quot;undefined&quot;) {
+		updateKeyIndex = true;
+	}
+	if (dojo.lang.isString(value) == false) {
+		value = dojo.json.serialize(value);
+		value = &quot;/* JavaScript */\n&quot; + value + &quot;\n\n&quot;;
+	}
+	var fullPath = this._getPagePath() + key + &quot;.txt&quot;;
+	if (this._isAvailableXPCOM()) {
+		this._saveFileXPCOM(fullPath, value);
+	} else {
+		if (this._isAvailableActiveX()) {
+			this._saveFileActiveX(fullPath, value);
+		}
+	}
+	if (updateKeyIndex) {
+		this._updateKeyIndex(key);
+	}
+}, _load:function (key) {
+	var fullPath = this._getPagePath() + key + &quot;.txt&quot;;
+	var results = null;
+	if (this._isAvailableXPCOM()) {
+		results = this._loadFileXPCOM(fullPath);
+	} else {
+		if (this._isAvailableActiveX()) {
+			results = this._loadFileActiveX(fullPath);
+		} else {
+			if (this._isAvailableJava()) {
+				results = this._loadFileJava(fullPath);
+			}
+		}
+	}
+	if (results == null) {
+		return null;
+	}
+	if (!dojo.lang.isUndefined(results) &amp;&amp; results != null &amp;&amp; /^\/\* JavaScript \*\//.test(results)) {
+		results = dojo.json.evalJson(results);
+	}
+	return results;
+}, _updateKeyIndex:function (key) {
+	this._loadKeyIndex();
+	var alreadyAdded = false;
+	for (var i = 0; i &lt; this._keyIndex.length; i++) {
+		if (this._keyIndex[i] == key) {
+			alreadyAdded = true;
+			break;
+		}
+	}
+	if (alreadyAdded == false) {
+		this._keyIndex[this._keyIndex.length] = key;
+	}
+	this._save(dojo.storage.browser.FileStorageProvider._KEY_INDEX_FILENAME, this._keyIndex, false);
+}, _loadKeyIndex:function () {
+	var indexContents = this._load(dojo.storage.browser.FileStorageProvider._KEY_INDEX_FILENAME);
+	if (indexContents == null) {
+		this._keyIndex = new Array();
+	} else {
+		this._keyIndex = indexContents;
+	}
+}, _saveFileXPCOM:function (filename, value) {
+	try {
+		netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
+		var f = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
+		f.initWithPath(filename);
+		var ouputStream = Components.classes[&quot;@mozilla.org/network/file-output-stream;1&quot;].createInstance(Components.interfaces.nsIFileOutputStream);
+		ouputStream.init(f, 32 | 4 | 8, 256 + 128, null);
+		ouputStream.write(value, value.length);
+		ouputStream.close();
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._saveFileXPCOM(): &quot; + msg);
+	}
+}, _loadFileXPCOM:function (filename) {
+	try {
+		netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
+		var f = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
+		f.initWithPath(filename);
+		if (f.exists() == false) {
+			return null;
+		}
+		var inp = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;].createInstance(Components.interfaces.nsIFileInputStream);
+		inp.init(f, 1, 4, null);
+		var inputStream = Components.classes[&quot;@mozilla.org/scriptableinputstream;1&quot;].createInstance(Components.interfaces.nsIScriptableInputStream);
+		inputStream.init(inp);
+		var results = inputStream.read(inputStream.available());
+		return results;
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._loadFileXPCOM(): &quot; + msg);
+	}
+	return null;
+}, _saveFileActiveX:function (filename, value) {
+	try {
+		var fileSystem = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
+		var f = fileSystem.OpenTextFile(filename, 2, true);
+		f.Write(value);
+		f.Close();
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._saveFileActiveX(): &quot; + msg);
+	}
+}, _loadFileActiveX:function (filename) {
+	try {
+		var fileSystem = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
+		if (fileSystem.FileExists(filename) == false) {
+			return null;
+		}
+		var f = fileSystem.OpenTextFile(filename, 1);
+		var results = f.ReadAll();
+		f.Close();
+		return results;
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._loadFileActiveX(): &quot; + msg);
+	}
+}, _saveFileJava:function (filename, value) {
+	try {
+		var applet = dojo.byId(dojo.storage.browser.FileStorageProvider._APPLET_ID);
+		applet.save(filename, value);
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._saveFileJava(): &quot; + msg);
+	}
+}, _loadFileJava:function (filename) {
+	try {
+		var applet = dojo.byId(dojo.storage.browser.FileStorageProvider._APPLET_ID);
+		var results = applet.load(filename);
+		return results;
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._loadFileJava(): &quot; + msg);
+	}
+}, _isAvailableActiveX:function () {
+	try {
+		if (window.ActiveXObject) {
+			var fileSystem = new window.ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
+			return true;
+		}
+	}
+	catch (e) {
+		dojo.debug(e);
+	}
+	return false;
+}, _isAvailableXPCOM:function () {
+	try {
+		if (window.Components) {
+			netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
+			Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
+			return true;
+		}
+	}
+	catch (e) {
+		dojo.debug(e);
+	}
+	return false;
+}, _isAvailableJava:function () {
+	try {
+		if (dojo.render.html.safari == true || dojo.render.html.opera == true()) {
+			if (navigator.javaEnabled() == true) {
+				return true;
+			}
+		}
+	}
+	catch (e) {
+		dojo.debug(e);
+	}
+	return false;
+}, _getPagePath:function () {
+	var path = window.location.pathname;
+	if (/\.html?$/i.test(path)) {
+		path = path.replace(/(?:\/|\\)?[^\.\/\\]*\.html?$/, &quot;&quot;);
+	}
+	if (/^\/?[a-z]+\:/i.test(path)) {
+		path = path.replace(/^\/?/, &quot;&quot;);
+		path = path.replace(/\//g, &quot;\\&quot;);
+	} else {
+		if (/^[\/\\]{2,3}[^\/]/.test(path)) {
+			path = path.replace(/^[\/\\]{2,3}/, &quot;&quot;);
+			path = path.replace(/\//g, &quot;\\&quot;);
+			path = &quot;\\\\&quot; + path;
+		}
+	}
+	if (/\/$/.test(path) == false &amp;&amp; /\\$/.test(path) == false) {
+		if (/\//.test(path)) {
+			path += &quot;/&quot;;
+		} else {
+			path += &quot;\\&quot;;
+		}
+	}
+	path = unescape(path);
+	return path;
+}, _removeXPCOM:function (filename) {
+	try {
+		netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;);
+		var f = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
+		f.initWithPath(filename);
+		if (f.exists() == false || f.isDirectory()) {
+			return;
+		}
+		if (f.isFile()) {
+			f.remove(false);
+		}
+	}
+	catch (e) {
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider.remove(): &quot; + e.toString());
+	}
+}, _removeActiveX:function (filename) {
+	try {
+		var fileSystem = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
+		fileSystem.DeleteFile(filename);
+	}
+	catch (e) {
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider.remove(): &quot; + e.toString());
+	}
+}, _removeJava:function (filename) {
+	try {
+		var applet = dojo.byId(dojo.storage.browser.FileStorageProvider._APPLET_ID);
+		applet.remove(filename);
+	}
+	catch (e) {
+		var msg = e.toString();
+		if (e.name &amp;&amp; e.message) {
+			msg = e.name + &quot;: &quot; + e.message;
+		}
+		dojo.raise(&quot;dojo.storage.browser.FileStorageProvider._removeJava(): &quot; + msg);
+	}
+}, _writeApplet:function () {
+	var archive = dojo.uri.moduleUri(&quot;dojo&quot;, &quot;../DojoFileStorageProvider.jar&quot;).toString();
+	var tag = &quot;&lt;applet &quot; + &quot;id='&quot; + dojo.storage.browser.FileStorageProvider._APPLET_ID + &quot;' &quot; + &quot;style='position: absolute; top: -500px; left: -500px; width: 1px; height: 1px;' &quot; + &quot;code='DojoFileStorageProvider.class' &quot; + &quot;archive='&quot; + archive + &quot;' &quot; + &quot;width='1' &quot; + &quot;height='1' &quot; + &quot;&gt;&quot; + &quot;&lt;/applet&gt;&quot;;
+	document.writeln(tag);
+}});
+dojo.storage.browser.WhatWGStorageProvider = function () {
+};
+dojo.inherits(dojo.storage.browser.WhatWGStorageProvider, dojo.storage);
+dojo.lang.extend(dojo.storage.browser.WhatWGStorageProvider, {namespace:&quot;default&quot;, initialized:false, _domain:null, _available:null, _statusHandler:null, initialize:function () {
+	if (djConfig[&quot;disableWhatWGStorage&quot;] == true) {
+		return;
+	}
+	this._domain = location.hostname;
+	this.initialized = true;
+	dojo.storage.manager.loaded();
+}, isAvailable:function () {
+	try {
+		var myStorage = globalStorage[location.hostname];
+	}
+	catch (e) {
+		this._available = false;
+		return this._available;
+	}
+	this._available = true;
+	return this._available;
+}, put:function (key, value, resultsHandler) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	this._statusHandler = resultsHandler;
+	if (dojo.lang.isString(value)) {
+		value = &quot;string:&quot; + value;
+	} else {
+		value = dojo.json.serialize(value);
+	}
+	window.addEventListener(&quot;storage&quot;, function (evt) {
+		resultsHandler.call(null, dojo.storage.SUCCESS, key);
+	}, false);
+	try {
+		var myStorage = globalStorage[this._domain];
+		myStorage.setItem(key, value);
+	}
+	catch (e) {
+		this._statusHandler.call(null, dojo.storage.FAILED, key, e.toString());
+	}
+}, get:function (key) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	var myStorage = globalStorage[this._domain];
+	var results = myStorage.getItem(key);
+	if (results == null) {
+		return null;
+	}
+	results = results.value;
+	if (!dojo.lang.isUndefined(results) &amp;&amp; results != null &amp;&amp; /^string:/.test(results)) {
+		results = results.substring(&quot;string:&quot;.length);
+	} else {
+		results = dojo.json.evalJson(results);
+	}
+	return results;
+}, getKeys:function () {
+	var myStorage = globalStorage[this._domain];
+	var keysArray = new Array();
+	for (i = 0; i &lt; myStorage.length; i++) {
+		keysArray[i] = myStorage.key(i);
+	}
+	return keysArray;
+}, clear:function () {
+	var myStorage = globalStorage[this._domain];
+	var keys = new Array();
+	for (var i = 0; i &lt; myStorage.length; i++) {
+		keys[keys.length] = myStorage.key(i);
+	}
+	for (var i = 0; i &lt; keys.length; i++) {
+		myStorage.removeItem(keys[i]);
+	}
+}, remove:function (key) {
+	var myStorage = globalStorage[this._domain];
+	myStorage.removeItem(key);
+}, isPermanent:function () {
+	return true;
+}, getMaximumSize:function () {
+	return dojo.storage.SIZE_NO_LIMIT;
+}, hasSettingsUI:function () {
+	return false;
+}, showSettingsUI:function () {
+	dojo.raise(this.getType() + &quot; does not support a storage settings user-interface&quot;);
+}, hideSettingsUI:function () {
+	dojo.raise(this.getType() + &quot; does not support a storage settings user-interface&quot;);
+}, getType:function () {
+	return &quot;dojo.storage.browser.WhatWGProvider&quot;;
+}});
+dojo.storage.browser.FlashStorageProvider = function () {
+};
+dojo.inherits(dojo.storage.browser.FlashStorageProvider, dojo.storage);
+dojo.lang.extend(dojo.storage.browser.FlashStorageProvider, {namespace:&quot;default&quot;, initialized:false, _available:null, _statusHandler:null, initialize:function () {
+	if (djConfig[&quot;disableFlashStorage&quot;] == true) {
+		return;
+	}
+	var loadedListener = function () {
+		dojo.storage._flashLoaded();
+	};
+	dojo.flash.addLoadedListener(loadedListener);
+	var swfloc6 = dojo.uri.moduleUri(&quot;dojo&quot;, &quot;../Storage_version6.swf&quot;).toString();
+	var swfloc8 = dojo.uri.moduleUri(&quot;dojo&quot;, &quot;../Storage_version8.swf&quot;).toString();
+	dojo.flash.setSwf({flash6:swfloc6, flash8:swfloc8, visible:false});
+}, isAvailable:function () {
+	if (djConfig[&quot;disableFlashStorage&quot;] == true) {
+		this._available = false;
+	} else {
+		this._available = true;
+	}
+	return this._available;
+}, put:function (key, value, resultsHandler) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	this._statusHandler = resultsHandler;
+	if (dojo.lang.isString(value)) {
+		value = &quot;string:&quot; + value;
+	} else {
+		value = dojo.json.serialize(value);
+	}
+	dojo.flash.comm.put(key, value, this.namespace);
+}, get:function (key) {
+	if (this.isValidKey(key) == false) {
+		dojo.raise(&quot;Invalid key given: &quot; + key);
+	}
+	var results = dojo.flash.comm.get(key, this.namespace);
+	if (results == &quot;&quot;) {
+		return null;
+	}
+	if (!dojo.lang.isUndefined(results) &amp;&amp; results != null &amp;&amp; /^string:/.test(results)) {
+		results = results.substring(&quot;string:&quot;.length);
+	} else {
+		results = dojo.json.evalJson(results);
+	}
+	return results;
+}, getKeys:function () {
+	var results = dojo.flash.comm.getKeys(this.namespace);
+	if (results == &quot;&quot;) {
+		return [];
+	}
+	return results.split(&quot;,&quot;);
+}, clear:function () {
+	dojo.flash.comm.clear(this.namespace);
+}, remove:function (key) {
+	dojo.unimplemented(&quot;dojo.storage.browser.FlashStorageProvider.remove&quot;);
+}, isPermanent:function () {
+	return true;
+}, getMaximumSize:function () {
+	return dojo.storage.SIZE_NO_LIMIT;
+}, hasSettingsUI:function () {
+	return true;
+}, showSettingsUI:function () {
+	dojo.flash.comm.showSettings();
+	dojo.flash.obj.setVisible(true);
+	dojo.flash.obj.center();
+}, hideSettingsUI:function () {
+	dojo.flash.obj.setVisible(false);
+	if (dojo.storage.onHideSettingsUI != null &amp;&amp; !dojo.lang.isUndefined(dojo.storage.onHideSettingsUI)) {
+		dojo.storage.onHideSettingsUI.call(null);
+	}
+}, getType:function () {
+	return &quot;dojo.storage.browser.FlashStorageProvider&quot;;
+}, _flashLoaded:function () {
+	this._initialized = true;
+	dojo.storage.manager.loaded();
+}, _onStatus:function (statusResult, key) {
+	var ds = dojo.storage;
+	var dfo = dojo.flash.obj;
+	if (statusResult == ds.PENDING) {
+		dfo.center();
+		dfo.setVisible(true);
+	} else {
+		dfo.setVisible(false);
+	}
+	if ((!dj_undef(&quot;_statusHandler&quot;, ds)) &amp;&amp; (ds._statusHandler != null)) {
+		ds._statusHandler.call(null, statusResult, key);
+	}
+}});
+dojo.storage.manager.register(&quot;dojo.storage.browser.FileStorageProvider&quot;, new dojo.storage.browser.FileStorageProvider());
+dojo.storage.manager.register(&quot;dojo.storage.browser.WhatWGStorageProvider&quot;, new dojo.storage.browser.WhatWGStorageProvider());
+dojo.storage.manager.register(&quot;dojo.storage.browser.FlashStorageProvider&quot;, new dojo.storage.browser.FlashStorageProvider());
+dojo.storage.manager.initialize();
+

Added: tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.class
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.class
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.java
===================================================================
--- tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.java	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/storage/java/DojoFileStorageProvider.java	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+/**
+	This is a simple class that can load, save, and remove 
+	files from the native file system. It is needed by Safari and Opera
+	for the dojo.storage.browser.FileStorageProvider, since both of
+	these platforms have no native way to talk to the file system
+	for <A HREF="file://">file://</A> URLs. Safari supports LiveConnect, but only for talking
+	to an applet, not for generic scripting by JavaScript, so we must
+	have an applet.
+
+	@author Brad Neuberg, <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">bkn3 at columbia.edu</A>
+*/
+
+import java.io.*;
+import java.util.*;
+
+public class DojoFileStorageProvider{
+	public String load(String filePath) 
+			throws IOException, FileNotFoundException{
+		StringBuffer results = new StringBuffer();
+		BufferedReader reader = new BufferedReader(
+					new FileReader(filePath));	
+		String line = null;
+		while((line = reader.readLine()) != null){
+			results.append(line);
+		}
+
+		reader.close();
+
+		return results.toString();
+	}
+
+	public void save(String filePath, String content) 
+			throws IOException, FileNotFoundException{
+		PrintWriter writer = new PrintWriter(
+					new BufferedWriter(
+						new FileWriter(filePath, false)));
+		writer.print(content);
+
+		writer.close();
+	}
+
+	public void remove(String filePath)
+			throws IOException, FileNotFoundException{
+		File f = new File(filePath);
+
+		if(f.exists() == false || f.isDirectory()){
+			return;
+		}
+
+		if(f.exists() &amp;&amp; f.isFile()){
+			f.delete();
+		}
+	}
+}

Added: tags/parley-0.55/root/static/magic/src/storage/storage_dialog.fla
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/storage/storage_dialog.fla
___________________________________________________________________
Name: svn:mime-type
   + application/octet-stream

Added: tags/parley-0.55/root/static/magic/src/storage.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/storage.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/storage.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,127 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.storage&quot;);
+dojo.require(&quot;dojo.lang.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.storage = new function () {
+};
+dojo.declare(&quot;dojo.storage&quot;, null, {SUCCESS:&quot;success&quot;, FAILED:&quot;failed&quot;, PENDING:&quot;pending&quot;, SIZE_NOT_AVAILABLE:&quot;Size not available&quot;, SIZE_NO_LIMIT:&quot;No size limit&quot;, namespace:&quot;default&quot;, onHideSettingsUI:null, initialize:function () {
+	dojo.unimplemented(&quot;dojo.storage.initialize&quot;);
+}, isAvailable:function () {
+	dojo.unimplemented(&quot;dojo.storage.isAvailable&quot;);
+}, put:function (key, value, resultsHandler) {
+	dojo.unimplemented(&quot;dojo.storage.put&quot;);
+}, get:function (key) {
+	dojo.unimplemented(&quot;dojo.storage.get&quot;);
+}, hasKey:function (key) {
+	return (this.get(key) != null);
+}, getKeys:function () {
+	dojo.unimplemented(&quot;dojo.storage.getKeys&quot;);
+}, clear:function () {
+	dojo.unimplemented(&quot;dojo.storage.clear&quot;);
+}, remove:function (key) {
+	dojo.unimplemented(&quot;dojo.storage.remove&quot;);
+}, isPermanent:function () {
+	dojo.unimplemented(&quot;dojo.storage.isPermanent&quot;);
+}, getMaximumSize:function () {
+	dojo.unimplemented(&quot;dojo.storage.getMaximumSize&quot;);
+}, hasSettingsUI:function () {
+	return false;
+}, showSettingsUI:function () {
+	dojo.unimplemented(&quot;dojo.storage.showSettingsUI&quot;);
+}, hideSettingsUI:function () {
+	dojo.unimplemented(&quot;dojo.storage.hideSettingsUI&quot;);
+}, getType:function () {
+	dojo.unimplemented(&quot;dojo.storage.getType&quot;);
+}, isValidKey:function (keyName) {
+	if ((keyName == null) || (typeof keyName == &quot;undefined&quot;)) {
+		return false;
+	}
+	return /^[0-9A-Za-z_]*$/.test(keyName);
+}});
+dojo.storage.manager = new function () {
+	this.currentProvider = null;
+	this.available = false;
+	this._initialized = false;
+	this._providers = [];
+	this.namespace = &quot;default&quot;;
+	this.initialize = function () {
+		this.autodetect();
+	};
+	this.register = function (name, instance) {
+		this._providers[this._providers.length] = instance;
+		this._providers[name] = instance;
+	};
+	this.setProvider = function (storageClass) {
+	};
+	this.autodetect = function () {
+		if (this._initialized == true) {
+			return;
+		}
+		var providerToUse = null;
+		for (var i = 0; i &lt; this._providers.length; i++) {
+			providerToUse = this._providers[i];
+			if (dojo.lang.isUndefined(djConfig[&quot;forceStorageProvider&quot;]) == false &amp;&amp; providerToUse.getType() == djConfig[&quot;forceStorageProvider&quot;]) {
+				providerToUse.isAvailable();
+				break;
+			} else {
+				if (dojo.lang.isUndefined(djConfig[&quot;forceStorageProvider&quot;]) == true &amp;&amp; providerToUse.isAvailable()) {
+					break;
+				}
+			}
+		}
+		if (providerToUse == null) {
+			this._initialized = true;
+			this.available = false;
+			this.currentProvider = null;
+			dojo.raise(&quot;No storage provider found for this platform&quot;);
+		}
+		this.currentProvider = providerToUse;
+		for (var i in providerToUse) {
+			dojo.storage[i] = providerToUse[i];
+		}
+		dojo.storage.manager = this;
+		dojo.storage.initialize();
+		this._initialized = true;
+		this.available = true;
+	};
+	this.isAvailable = function () {
+		return this.available;
+	};
+	this.isInitialized = function () {
+		if (this.currentProvider.getType() == &quot;dojo.storage.browser.FlashStorageProvider&quot; &amp;&amp; dojo.flash.ready == false) {
+			return false;
+		} else {
+			return this._initialized;
+		}
+	};
+	this.supportsProvider = function (storageClass) {
+		try {
+			var provider = eval(&quot;new &quot; + storageClass + &quot;()&quot;);
+			var results = provider.isAvailable();
+			if (results == null || typeof results == &quot;undefined&quot;) {
+				return false;
+			}
+			return results;
+		}
+		catch (exception) {
+			return false;
+		}
+	};
+	this.getProvider = function () {
+		return this.currentProvider;
+	};
+	this.loaded = function () {
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/string/Builder.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/string/Builder.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/string/Builder.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,104 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.string.Builder&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.string.Builder = function (str) {
+	this.arrConcat = (dojo.render.html.capable &amp;&amp; dojo.render.html[&quot;ie&quot;]);
+	var a = [];
+	var b = &quot;&quot;;
+	var length = this.length = b.length;
+	if (this.arrConcat) {
+		if (b.length &gt; 0) {
+			a.push(b);
+		}
+		b = &quot;&quot;;
+	}
+	this.toString = this.valueOf = function () {
+		return (this.arrConcat) ? a.join(&quot;&quot;) : b;
+	};
+	this.append = function () {
+		for (var x = 0; x &lt; arguments.length; x++) {
+			var s = arguments[x];
+			if (dojo.lang.isArrayLike(s)) {
+				this.append.apply(this, s);
+			} else {
+				if (this.arrConcat) {
+					a.push(s);
+				} else {
+					b += s;
+				}
+				length += s.length;
+				this.length = length;
+			}
+		}
+		return this;
+	};
+	this.clear = function () {
+		a = [];
+		b = &quot;&quot;;
+		length = this.length = 0;
+		return this;
+	};
+	this.remove = function (f, l) {
+		var s = &quot;&quot;;
+		if (this.arrConcat) {
+			b = a.join(&quot;&quot;);
+		}
+		a = [];
+		if (f &gt; 0) {
+			s = b.substring(0, (f - 1));
+		}
+		b = s + b.substring(f + l);
+		length = this.length = b.length;
+		if (this.arrConcat) {
+			a.push(b);
+			b = &quot;&quot;;
+		}
+		return this;
+	};
+	this.replace = function (o, n) {
+		if (this.arrConcat) {
+			b = a.join(&quot;&quot;);
+		}
+		a = [];
+		b = b.replace(o, n);
+		length = this.length = b.length;
+		if (this.arrConcat) {
+			a.push(b);
+			b = &quot;&quot;;
+		}
+		return this;
+	};
+	this.insert = function (idx, s) {
+		if (this.arrConcat) {
+			b = a.join(&quot;&quot;);
+		}
+		a = [];
+		if (idx == 0) {
+			b = s + b;
+		} else {
+			var t = b.split(&quot;&quot;);
+			t.splice(idx, 0, s);
+			b = t.join(&quot;&quot;);
+		}
+		length = this.length = b.length;
+		if (this.arrConcat) {
+			a.push(b);
+			b = &quot;&quot;;
+		}
+		return this;
+	};
+	this.append.apply(this, arguments);
+};
+

Added: tags/parley-0.55/root/static/magic/src/string/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/string/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/string/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.string&quot;, &quot;dojo.string.common&quot;, &quot;dojo.string.extras&quot;, &quot;dojo.string.Builder&quot;]});
+dojo.provide(&quot;dojo.string.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/string/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/string/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/string/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,63 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.string.common&quot;);
+dojo.string.trim = function (str, wh) {
+	if (!str.replace) {
+		return str;
+	}
+	if (!str.length) {
+		return str;
+	}
+	var re = (wh &gt; 0) ? (/^\s+/) : (wh &lt; 0) ? (/\s+$/) : (/^\s+|\s+$/g);
+	return str.replace(re, &quot;&quot;);
+};
+dojo.string.trimStart = function (str) {
+	return dojo.string.trim(str, 1);
+};
+dojo.string.trimEnd = function (str) {
+	return dojo.string.trim(str, -1);
+};
+dojo.string.repeat = function (str, count, separator) {
+	var out = &quot;&quot;;
+	for (var i = 0; i &lt; count; i++) {
+		out += str;
+		if (separator &amp;&amp; i &lt; count - 1) {
+			out += separator;
+		}
+	}
+	return out;
+};
+dojo.string.pad = function (str, len, c, dir) {
+	var out = String(str);
+	if (!c) {
+		c = &quot;0&quot;;
+	}
+	if (!dir) {
+		dir = 1;
+	}
+	while (out.length &lt; len) {
+		if (dir &gt; 0) {
+			out = c + out;
+		} else {
+			out += c;
+		}
+	}
+	return out;
+};
+dojo.string.padLeft = function (str, len, c) {
+	return dojo.string.pad(str, len, c, 1);
+};
+dojo.string.padRight = function (str, len, c) {
+	return dojo.string.pad(str, len, c, -1);
+};
+

Added: tags/parley-0.55/root/static/magic/src/string/extras.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/string/extras.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/string/extras.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,178 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.string.extras&quot;);
+dojo.require(&quot;dojo.string.common&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.string.substituteParams = function (template, hash) {
+	var map = (typeof hash == &quot;object&quot;) ? hash : dojo.lang.toArray(arguments, 1);
+	return template.replace(/\%\{(\w+)\}/g, function (match, key) {
+		if (typeof (map[key]) != &quot;undefined&quot; &amp;&amp; map[key] != null) {
+			return map[key];
+		}
+		dojo.raise(&quot;Substitution not found: &quot; + key);
+	});
+};
+dojo.string.capitalize = function (str) {
+	if (!dojo.lang.isString(str)) {
+		return &quot;&quot;;
+	}
+	if (arguments.length == 0) {
+		str = this;
+	}
+	var words = str.split(&quot; &quot;);
+	for (var i = 0; i &lt; words.length; i++) {
+		words[i] = words[i].charAt(0).toUpperCase() + words[i].substring(1);
+	}
+	return words.join(&quot; &quot;);
+};
+dojo.string.isBlank = function (str) {
+	if (!dojo.lang.isString(str)) {
+		return true;
+	}
+	return (dojo.string.trim(str).length == 0);
+};
+dojo.string.encodeAscii = function (str) {
+	if (!dojo.lang.isString(str)) {
+		return str;
+	}
+	var ret = &quot;&quot;;
+	var value = escape(str);
+	var match, re = /%u([0-9A-F]{4})/i;
+	while ((match = value.match(re))) {
+		var num = Number(&quot;0x&quot; + match[1]);
+		var newVal = escape(&quot;&amp;#&quot; + num + &quot;;&quot;);
+		ret += value.substring(0, match.index) + newVal;
+		value = value.substring(match.index + match[0].length);
+	}
+	ret += value.replace(/\+/g, &quot;%2B&quot;);
+	return ret;
+};
+dojo.string.escape = function (type, str) {
+	var args = dojo.lang.toArray(arguments, 1);
+	switch (type.toLowerCase()) {
+	  case &quot;xml&quot;:
+	  case &quot;html&quot;:
+	  case &quot;xhtml&quot;:
+		return dojo.string.escapeXml.apply(this, args);
+	  case &quot;sql&quot;:
+		return dojo.string.escapeSql.apply(this, args);
+	  case &quot;regexp&quot;:
+	  case &quot;regex&quot;:
+		return dojo.string.escapeRegExp.apply(this, args);
+	  case &quot;javascript&quot;:
+	  case &quot;jscript&quot;:
+	  case &quot;js&quot;:
+		return dojo.string.escapeJavaScript.apply(this, args);
+	  case &quot;ascii&quot;:
+		return dojo.string.encodeAscii.apply(this, args);
+	  default:
+		return str;
+	}
+};
+dojo.string.escapeXml = function (str, noSingleQuotes) {
+	str = str.replace(/&amp;/gm, &quot;&amp;&quot;).replace(/&lt;/gm, &quot;&lt;&quot;).replace(/&gt;/gm, &quot;&gt;&quot;).replace(/&quot;/gm, &quot;&quot;&quot;);
+	if (!noSingleQuotes) {
+		str = str.replace(/'/gm, &quot;&#39;&quot;);
+	}
+	return str;
+};
+dojo.string.escapeSql = function (str) {
+	return str.replace(/'/gm, &quot;''&quot;);
+};
+dojo.string.escapeRegExp = function (str) {
+	return str.replace(/\\/gm, &quot;\\\\&quot;).replace(/([\f\b\n\t\r[\^$|?*+(){}])/gm, &quot;\\$1&quot;);
+};
+dojo.string.escapeJavaScript = function (str) {
+	return str.replace(/([&quot;'\f\b\n\t\r])/gm, &quot;\\$1&quot;);
+};
+dojo.string.escapeString = function (str) {
+	return (&quot;\&quot;&quot; + str.replace(/([&quot;\\])/g, &quot;\\$1&quot;) + &quot;\&quot;&quot;).replace(/[\f]/g, &quot;\\f&quot;).replace(/[\b]/g, &quot;\\b&quot;).replace(/[\n]/g, &quot;\\n&quot;).replace(/[\t]/g, &quot;\\t&quot;).replace(/[\r]/g, &quot;\\r&quot;);
+};
+dojo.string.summary = function (str, len) {
+	if (!len || str.length &lt;= len) {
+		return str;
+	}
+	return str.substring(0, len).replace(/\.+$/, &quot;&quot;) + &quot;...&quot;;
+};
+dojo.string.endsWith = function (str, end, ignoreCase) {
+	if (ignoreCase) {
+		str = str.toLowerCase();
+		end = end.toLowerCase();
+	}
+	if ((str.length - end.length) &lt; 0) {
+		return false;
+	}
+	return str.lastIndexOf(end) == str.length - end.length;
+};
+dojo.string.endsWithAny = function (str) {
+	for (var i = 1; i &lt; arguments.length; i++) {
+		if (dojo.string.endsWith(str, arguments[i])) {
+			return true;
+		}
+	}
+	return false;
+};
+dojo.string.startsWith = function (str, start, ignoreCase) {
+	if (ignoreCase) {
+		str = str.toLowerCase();
+		start = start.toLowerCase();
+	}
+	return str.indexOf(start) == 0;
+};
+dojo.string.startsWithAny = function (str) {
+	for (var i = 1; i &lt; arguments.length; i++) {
+		if (dojo.string.startsWith(str, arguments[i])) {
+			return true;
+		}
+	}
+	return false;
+};
+dojo.string.has = function (str) {
+	for (var i = 1; i &lt; arguments.length; i++) {
+		if (str.indexOf(arguments[i]) &gt; -1) {
+			return true;
+		}
+	}
+	return false;
+};
+dojo.string.normalizeNewlines = function (text, newlineChar) {
+	if (newlineChar == &quot;\n&quot;) {
+		text = text.replace(/\r\n/g, &quot;\n&quot;);
+		text = text.replace(/\r/g, &quot;\n&quot;);
+	} else {
+		if (newlineChar == &quot;\r&quot;) {
+			text = text.replace(/\r\n/g, &quot;\r&quot;);
+			text = text.replace(/\n/g, &quot;\r&quot;);
+		} else {
+			text = text.replace(/([^\r])\n/g, &quot;$1\r\n&quot;).replace(/\r([^\n])/g, &quot;\r\n$1&quot;);
+		}
+	}
+	return text;
+};
+dojo.string.splitEscaped = function (str, charac) {
+	var components = [];
+	for (var i = 0, prevcomma = 0; i &lt; str.length; i++) {
+		if (str.charAt(i) == &quot;\\&quot;) {
+			i++;
+			continue;
+		}
+		if (str.charAt(i) == charac) {
+			components.push(str.substring(prevcomma, i));
+			prevcomma = i + 1;
+		}
+	}
+	components.push(str.substr(prevcomma));
+	return components;
+};
+

Added: tags/parley-0.55/root/static/magic/src/string.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/string.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/string.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.string.common&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/style.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/style.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/style.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,18 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.style&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.kwCompoundRequire({browser:[&quot;dojo.html.style&quot;]});
+dojo.deprecated(&quot;dojo.style&quot;, &quot;replaced by dojo.html.style&quot;, &quot;0.5&quot;);
+dojo.lang.mixin(dojo.style, dojo.html);
+

Added: tags/parley-0.55/root/static/magic/src/svg.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/svg.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/svg.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,259 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.svg&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.mixin(dojo.svg, dojo.dom);
+dojo.svg.graphics = dojo.svg.g = new function (d) {
+	this.suspend = function () {
+		try {
+			d.documentElement.suspendRedraw(0);
+		}
+		catch (e) {
+		}
+	};
+	this.resume = function () {
+		try {
+			d.documentElement.unsuspendRedraw(0);
+		}
+		catch (e) {
+		}
+	};
+	this.force = function () {
+		try {
+			d.documentElement.forceRedraw();
+		}
+		catch (e) {
+		}
+	};
+}(document);
+dojo.svg.animations = dojo.svg.anim = new function (d) {
+	this.arePaused = function () {
+		try {
+			return d.documentElement.animationsPaused();
+		}
+		catch (e) {
+			return false;
+		}
+	};
+	this.pause = function () {
+		try {
+			d.documentElement.pauseAnimations();
+		}
+		catch (e) {
+		}
+	};
+	this.resume = function () {
+		try {
+			d.documentElement.unpauseAnimations();
+		}
+		catch (e) {
+		}
+	};
+}(document);
+dojo.svg.toCamelCase = function (selector) {
+	var arr = selector.split(&quot;-&quot;), cc = arr[0];
+	for (var i = 1; i &lt; arr.length; i++) {
+		cc += arr[i].charAt(0).toUpperCase() + arr[i].substring(1);
+	}
+	return cc;
+};
+dojo.svg.toSelectorCase = function (selector) {
+	return selector.replace(/([A-Z])/g, &quot;-$1&quot;).toLowerCase();
+};
+dojo.svg.getStyle = function (node, cssSelector) {
+	return document.defaultView.getComputedStyle(node, cssSelector);
+};
+dojo.svg.getNumericStyle = function (node, cssSelector) {
+	return parseFloat(dojo.svg.getStyle(node, cssSelector));
+};
+dojo.svg.getOpacity = function (node) {
+	return Math.min(1, dojo.svg.getNumericStyle(node, &quot;fill-opacity&quot;));
+};
+dojo.svg.setOpacity = function (node, opacity) {
+	node.setAttributeNS(this.xmlns.svg, &quot;fill-opacity&quot;, opacity);
+	node.setAttributeNS(this.xmlns.svg, &quot;stroke-opacity&quot;, opacity);
+};
+dojo.svg.clearOpacity = function (node) {
+	node.setAttributeNS(this.xmlns.svg, &quot;fill-opacity&quot;, &quot;1.0&quot;);
+	node.setAttributeNS(this.xmlns.svg, &quot;stroke-opacity&quot;, &quot;1.0&quot;);
+};
+dojo.svg.getCoords = function (node) {
+	if (node.getBBox) {
+		var box = node.getBBox();
+		return {x:box.x, y:box.y};
+	}
+	return null;
+};
+dojo.svg.setCoords = function (node, coords) {
+	var p = dojo.svg.getCoords();
+	if (!p) {
+		return;
+	}
+	var dx = p.x - coords.x;
+	var dy = p.y - coords.y;
+	dojo.svg.translate(node, dx, dy);
+};
+dojo.svg.getDimensions = function (node) {
+	if (node.getBBox) {
+		var box = node.getBBox();
+		return {width:box.width, height:box.height};
+	}
+	return null;
+};
+dojo.svg.setDimensions = function (node, dim) {
+	if (node.width) {
+		node.width.baseVal.value = dim.width;
+		node.height.baseVal.value = dim.height;
+	} else {
+		if (node.r) {
+			node.r.baseVal.value = Math.min(dim.width, dim.height) / 2;
+		} else {
+			if (node.rx) {
+				node.rx.baseVal.value = dim.width / 2;
+				node.ry.baseVal.value = dim.height / 2;
+			}
+		}
+	}
+};
+dojo.svg.translate = function (node, dx, dy) {
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var t = node.ownerSVGElement.createSVGTransform();
+		t.setTranslate(dx, dy);
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.scale = function (node, scaleX, scaleY) {
+	if (!scaleY) {
+		var scaleY = scaleX;
+	}
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var t = node.ownerSVGElement.createSVGTransform();
+		t.setScale(scaleX, scaleY);
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.rotate = function (node, ang, cx, cy) {
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var t = node.ownerSVGElement.createSVGTransform();
+		if (cx == null) {
+			t.setMatrix(t.matrix.rotate(ang));
+		} else {
+			t.setRotate(ang, cx, cy);
+		}
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.skew = function (node, ang, axis) {
+	var dir = axis || &quot;x&quot;;
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var t = node.ownerSVGElement.createSVGTransform();
+		if (dir != &quot;x&quot;) {
+			t.setSkewY(ang);
+		} else {
+			t.setSkewX(ang);
+		}
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.flip = function (node, axis) {
+	var dir = axis || &quot;x&quot;;
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var t = node.ownerSVGElement.createSVGTransform();
+		t.setMatrix((dir != &quot;x&quot;) ? t.matrix.flipY() : t.matrix.flipX());
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.invert = function (node) {
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var t = node.ownerSVGElement.createSVGTransform();
+		t.setMatrix(t.matrix.inverse());
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.applyMatrix = function (node, a, b, c, d, e, f) {
+	if (node.transform &amp;&amp; node.ownerSVGElement &amp;&amp; node.ownerSVGElement.createSVGTransform) {
+		var m;
+		if (b) {
+			var m = node.ownerSVGElement.createSVGMatrix();
+			m.a = a;
+			m.b = b;
+			m.c = c;
+			m.d = d;
+			m.e = e;
+			m.f = f;
+		} else {
+			m = a;
+		}
+		var t = node.ownerSVGElement.createSVGTransform();
+		t.setMatrix(m);
+		node.transform.baseVal.appendItem(t);
+	}
+};
+dojo.svg.group = function (nodes) {
+	var p = nodes.item(0).parentNode;
+	var g = document.createElementNS(this.xmlns.svg, &quot;g&quot;);
+	for (var i = 0; i &lt; nodes.length; i++) {
+		g.appendChild(nodes.item(i));
+	}
+	p.appendChild(g);
+	return g;
+};
+dojo.svg.ungroup = function (g) {
+	var p = g.parentNode;
+	while (g.childNodes.length &gt; 0) {
+		p.appendChild(g.childNodes.item(0));
+	}
+	p.removeChild(g);
+};
+dojo.svg.getGroup = function (node) {
+	var a = this.getAncestors(node);
+	for (var i = 0; i &lt; a.length; i++) {
+		if (a[i].nodeType == this.ELEMENT_NODE &amp;&amp; a[i].nodeName.toLowerCase() == &quot;g&quot;) {
+			return a[i];
+		}
+	}
+	return null;
+};
+dojo.svg.bringToFront = function (node) {
+	var n = this.getGroup(node) || node;
+	n.ownerSVGElement.appendChild(n);
+};
+dojo.svg.sendToBack = function (node) {
+	var n = this.getGroup(node) || node;
+	n.ownerSVGElement.insertBefore(n, n.ownerSVGElement.firstChild);
+};
+dojo.svg.bringForward = function (node) {
+	var n = this.getGroup(node) || node;
+	if (this.getLastChildElement(n.parentNode) != n) {
+		this.insertAfter(n, this.getNextSiblingElement(n), true);
+	}
+};
+dojo.svg.sendBackward = function (node) {
+	var n = this.getGroup(node) || node;
+	if (this.getFirstChildElement(n.parentNode) != n) {
+		this.insertBefore(n, this.getPreviousSiblingElement(n), true);
+	}
+};
+dojo.svg.createNodesFromText = function (txt, wrap) {
+	var docFrag = (new DOMParser()).parseFromString(txt, &quot;text/xml&quot;).normalize();
+	if (wrap) {
+		return [docFrag.firstChild.cloneNode(true)];
+	}
+	var nodes = [];
+	for (var x = 0; x &lt; docFrag.childNodes.length; x++) {
+		nodes.push(docFrag.childNodes.item(x).cloneNode(true));
+	}
+	return nodes;
+};
+

Added: tags/parley-0.55/root/static/magic/src/text/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/text/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/text/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.text.String&quot;, &quot;dojo.text.Builder&quot;]});
+dojo.deprecated(&quot;dojo.text&quot;, &quot;textDirectory moved to cal, text.String and text.Builder havne't been here for awhile&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/text/textDirectory.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/text/textDirectory.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/text/textDirectory.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.cal.textDirectory&quot;);
+dojo.deprecate(&quot;dojo.text.textDirectory&quot;, &quot;use dojo.cal.textDirectory&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/undo/Manager.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/undo/Manager.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/undo/Manager.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,150 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.undo.Manager&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.undo.Manager = function (parent) {
+	this.clear();
+	this._parent = parent;
+};
+dojo.extend(dojo.undo.Manager, {_parent:null, _undoStack:null, _redoStack:null, _currentManager:null, canUndo:false, canRedo:false, isUndoing:false, isRedoing:false, onUndo:function (manager, item) {
+}, onRedo:function (manager, item) {
+}, onUndoAny:function (manager, item) {
+}, onRedoAny:function (manager, item) {
+}, _updateStatus:function () {
+	this.canUndo = this._undoStack.length &gt; 0;
+	this.canRedo = this._redoStack.length &gt; 0;
+}, clear:function () {
+	this._undoStack = [];
+	this._redoStack = [];
+	this._currentManager = this;
+	this.isUndoing = false;
+	this.isRedoing = false;
+	this._updateStatus();
+}, undo:function () {
+	if (!this.canUndo) {
+		return false;
+	}
+	this.endAllTransactions();
+	this.isUndoing = true;
+	var top = this._undoStack.pop();
+	if (top instanceof dojo.undo.Manager) {
+		top.undoAll();
+	} else {
+		top.undo();
+	}
+	if (top.redo) {
+		this._redoStack.push(top);
+	}
+	this.isUndoing = false;
+	this._updateStatus();
+	this.onUndo(this, top);
+	if (!(top instanceof dojo.undo.Manager)) {
+		this.getTop().onUndoAny(this, top);
+	}
+	return true;
+}, redo:function () {
+	if (!this.canRedo) {
+		return false;
+	}
+	this.isRedoing = true;
+	var top = this._redoStack.pop();
+	if (top instanceof dojo.undo.Manager) {
+		top.redoAll();
+	} else {
+		top.redo();
+	}
+	this._undoStack.push(top);
+	this.isRedoing = false;
+	this._updateStatus();
+	this.onRedo(this, top);
+	if (!(top instanceof dojo.undo.Manager)) {
+		this.getTop().onRedoAny(this, top);
+	}
+	return true;
+}, undoAll:function () {
+	while (this._undoStack.length &gt; 0) {
+		this.undo();
+	}
+}, redoAll:function () {
+	while (this._redoStack.length &gt; 0) {
+		this.redo();
+	}
+}, push:function (undo, redo, description) {
+	if (!undo) {
+		return;
+	}
+	if (this._currentManager == this) {
+		this._undoStack.push({undo:undo, redo:redo, description:description});
+	} else {
+		this._currentManager.push.apply(this._currentManager, arguments);
+	}
+	this._redoStack = [];
+	this._updateStatus();
+}, concat:function (manager) {
+	if (!manager) {
+		return;
+	}
+	if (this._currentManager == this) {
+		for (var x = 0; x &lt; manager._undoStack.length; x++) {
+			this._undoStack.push(manager._undoStack[x]);
+		}
+		if (manager._undoStack.length &gt; 0) {
+			this._redoStack = [];
+		}
+		this._updateStatus();
+	} else {
+		this._currentManager.concat.apply(this._currentManager, arguments);
+	}
+}, beginTransaction:function (description) {
+	if (this._currentManager == this) {
+		var mgr = new dojo.undo.Manager(this);
+		mgr.description = description ? description : &quot;&quot;;
+		this._undoStack.push(mgr);
+		this._currentManager = mgr;
+		return mgr;
+	} else {
+		this._currentManager = this._currentManager.beginTransaction.apply(this._currentManager, arguments);
+	}
+}, endTransaction:function (flatten) {
+	if (this._currentManager == this) {
+		if (this._parent) {
+			this._parent._currentManager = this._parent;
+			if (this._undoStack.length == 0 || flatten) {
+				var idx = dojo.lang.find(this._parent._undoStack, this);
+				if (idx &gt;= 0) {
+					this._parent._undoStack.splice(idx, 1);
+					if (flatten) {
+						for (var x = 0; x &lt; this._undoStack.length; x++) {
+							this._parent._undoStack.splice(idx++, 0, this._undoStack[x]);
+						}
+						this._updateStatus();
+					}
+				}
+			}
+			return this._parent;
+		}
+	} else {
+		this._currentManager = this._currentManager.endTransaction.apply(this._currentManager, arguments);
+	}
+}, endAllTransactions:function () {
+	while (this._currentManager != this) {
+		this.endTransaction();
+	}
+}, getTop:function () {
+	if (this._parent) {
+		return this._parent.getTop();
+	} else {
+		return this;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/undo/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/undo/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/undo/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.undo.Manager&quot;);
+dojo.provide(&quot;dojo.undo.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/undo/browser.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/undo/browser.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/undo/browser.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,203 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.undo.browser&quot;);
+dojo.require(&quot;dojo.io.common&quot;);
+try {
+	if ((!djConfig[&quot;preventBackButtonFix&quot;]) &amp;&amp; (!dojo.hostenv.post_load_)) {
+		document.write(&quot;&lt;iframe style='border: 0px; width: 1px; height: 1px; position: absolute; bottom: 0px; right: 0px; visibility: visible;' name='djhistory' id='djhistory' src='&quot; + (djConfig[&quot;dojoIframeHistoryUrl&quot;] || dojo.hostenv.getBaseScriptUri() + &quot;iframe_history.html&quot;) + &quot;'&gt;&lt;/iframe&gt;&quot;);
+	}
+}
+catch (e) {
+}
+if (dojo.render.html.opera) {
+	dojo.debug(&quot;Opera is not supported with dojo.undo.browser, so back/forward detection will not work.&quot;);
+}
+dojo.undo.browser = {initialHref:(!dj_undef(&quot;window&quot;)) ? window.location.href : &quot;&quot;, initialHash:(!dj_undef(&quot;window&quot;)) ? window.location.hash : &quot;&quot;, moveForward:false, historyStack:[], forwardStack:[], historyIframe:null, bookmarkAnchor:null, locationTimer:null, setInitialState:function (args) {
+	this.initialState = this._createState(this.initialHref, args, this.initialHash);
+}, addToHistory:function (args) {
+	this.forwardStack = [];
+	var hash = null;
+	var url = null;
+	if (!this.historyIframe) {
+		if (djConfig[&quot;useXDomain&quot;] &amp;&amp; !djConfig[&quot;dojoIframeHistoryUrl&quot;]) {
+			dojo.debug(&quot;dojo.undo.browser: When using cross-domain Dojo builds,&quot; + &quot; please save iframe_history.html to your domain and set djConfig.dojoIframeHistoryUrl&quot; + &quot; to the path on your domain to iframe_history.html&quot;);
+		}
+		this.historyIframe = window.frames[&quot;djhistory&quot;];
+	}
+	if (!this.bookmarkAnchor) {
+		this.bookmarkAnchor = document.createElement(&quot;a&quot;);
+		dojo.body().appendChild(this.bookmarkAnchor);
+		this.bookmarkAnchor.style.display = &quot;none&quot;;
+	}
+	if (args[&quot;changeUrl&quot;]) {
+		hash = &quot;#&quot; + ((args[&quot;changeUrl&quot;] !== true) ? args[&quot;changeUrl&quot;] : (new Date()).getTime());
+		if (this.historyStack.length == 0 &amp;&amp; this.initialState.urlHash == hash) {
+			this.initialState = this._createState(url, args, hash);
+			return;
+		} else {
+			if (this.historyStack.length &gt; 0 &amp;&amp; this.historyStack[this.historyStack.length - 1].urlHash == hash) {
+				this.historyStack[this.historyStack.length - 1] = this._createState(url, args, hash);
+				return;
+			}
+		}
+		this.changingUrl = true;
+		setTimeout(&quot;window.location.href = '&quot; + hash + &quot;'; dojo.undo.browser.changingUrl = false;&quot;, 1);
+		this.bookmarkAnchor.href = hash;
+		if (dojo.render.html.ie) {
+			url = this._loadIframeHistory();
+			var oldCB = args[&quot;back&quot;] || args[&quot;backButton&quot;] || args[&quot;handle&quot;];
+			var tcb = function (handleName) {
+				if (window.location.hash != &quot;&quot;) {
+					setTimeout(&quot;window.location.href = '&quot; + hash + &quot;';&quot;, 1);
+				}
+				oldCB.apply(this, [handleName]);
+			};
+			if (args[&quot;back&quot;]) {
+				args.back = tcb;
+			} else {
+				if (args[&quot;backButton&quot;]) {
+					args.backButton = tcb;
+				} else {
+					if (args[&quot;handle&quot;]) {
+						args.handle = tcb;
+					}
+				}
+			}
+			var oldFW = args[&quot;forward&quot;] || args[&quot;forwardButton&quot;] || args[&quot;handle&quot;];
+			var tfw = function (handleName) {
+				if (window.location.hash != &quot;&quot;) {
+					window.location.href = hash;
+				}
+				if (oldFW) {
+					oldFW.apply(this, [handleName]);
+				}
+			};
+			if (args[&quot;forward&quot;]) {
+				args.forward = tfw;
+			} else {
+				if (args[&quot;forwardButton&quot;]) {
+					args.forwardButton = tfw;
+				} else {
+					if (args[&quot;handle&quot;]) {
+						args.handle = tfw;
+					}
+				}
+			}
+		} else {
+			if (dojo.render.html.moz) {
+				if (!this.locationTimer) {
+					this.locationTimer = setInterval(&quot;dojo.undo.browser.checkLocation();&quot;, 200);
+				}
+			}
+		}
+	} else {
+		url = this._loadIframeHistory();
+	}
+	this.historyStack.push(this._createState(url, args, hash));
+}, checkLocation:function () {
+	if (!this.changingUrl) {
+		var hsl = this.historyStack.length;
+		if ((window.location.hash == this.initialHash || window.location.href == this.initialHref) &amp;&amp; (hsl == 1)) {
+			this.handleBackButton();
+			return;
+		}
+		if (this.forwardStack.length &gt; 0) {
+			if (this.forwardStack[this.forwardStack.length - 1].urlHash == window.location.hash) {
+				this.handleForwardButton();
+				return;
+			}
+		}
+		if ((hsl &gt;= 2) &amp;&amp; (this.historyStack[hsl - 2])) {
+			if (this.historyStack[hsl - 2].urlHash == window.location.hash) {
+				this.handleBackButton();
+				return;
+			}
+		}
+	}
+}, iframeLoaded:function (evt, ifrLoc) {
+	if (!dojo.render.html.opera) {
+		var query = this._getUrlQuery(ifrLoc.href);
+		if (query == null) {
+			if (this.historyStack.length == 1) {
+				this.handleBackButton();
+			}
+			return;
+		}
+		if (this.moveForward) {
+			this.moveForward = false;
+			return;
+		}
+		if (this.historyStack.length &gt;= 2 &amp;&amp; query == this._getUrlQuery(this.historyStack[this.historyStack.length - 2].url)) {
+			this.handleBackButton();
+		} else {
+			if (this.forwardStack.length &gt; 0 &amp;&amp; query == this._getUrlQuery(this.forwardStack[this.forwardStack.length - 1].url)) {
+				this.handleForwardButton();
+			}
+		}
+	}
+}, handleBackButton:function () {
+	var current = this.historyStack.pop();
+	if (!current) {
+		return;
+	}
+	var last = this.historyStack[this.historyStack.length - 1];
+	if (!last &amp;&amp; this.historyStack.length == 0) {
+		last = this.initialState;
+	}
+	if (last) {
+		if (last.kwArgs[&quot;back&quot;]) {
+			last.kwArgs[&quot;back&quot;]();
+		} else {
+			if (last.kwArgs[&quot;backButton&quot;]) {
+				last.kwArgs[&quot;backButton&quot;]();
+			} else {
+				if (last.kwArgs[&quot;handle&quot;]) {
+					last.kwArgs.handle(&quot;back&quot;);
+				}
+			}
+		}
+	}
+	this.forwardStack.push(current);
+}, handleForwardButton:function () {
+	var last = this.forwardStack.pop();
+	if (!last) {
+		return;
+	}
+	if (last.kwArgs[&quot;forward&quot;]) {
+		last.kwArgs.forward();
+	} else {
+		if (last.kwArgs[&quot;forwardButton&quot;]) {
+			last.kwArgs.forwardButton();
+		} else {
+			if (last.kwArgs[&quot;handle&quot;]) {
+				last.kwArgs.handle(&quot;forward&quot;);
+			}
+		}
+	}
+	this.historyStack.push(last);
+}, _createState:function (url, args, hash) {
+	return {&quot;url&quot;:url, &quot;kwArgs&quot;:args, &quot;urlHash&quot;:hash};
+}, _getUrlQuery:function (url) {
+	var segments = url.split(&quot;?&quot;);
+	if (segments.length &lt; 2) {
+		return null;
+	} else {
+		return segments[1];
+	}
+}, _loadIframeHistory:function () {
+	var url = (djConfig[&quot;dojoIframeHistoryUrl&quot;] || dojo.hostenv.getBaseScriptUri() + &quot;iframe_history.html&quot;) + &quot;?&quot; + (new Date()).getTime();
+	this.moveForward = true;
+	dojo.io.setIFrameSrc(this.historyIframe, url, false);
+	return url;
+}};
+

Added: tags/parley-0.55/root/static/magic/src/uri/Uri.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uri/Uri.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uri/Uri.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,115 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uri.Uri&quot;);
+dojo.uri = new function () {
+	this.dojoUri = function (uri) {
+		return new dojo.uri.Uri(dojo.hostenv.getBaseScriptUri(), uri);
+	};
+	this.moduleUri = function (module, uri) {
+		var loc = dojo.hostenv.getModuleSymbols(module).join(&quot;/&quot;);
+		if (!loc) {
+			return null;
+		}
+		if (loc.lastIndexOf(&quot;/&quot;) != loc.length - 1) {
+			loc += &quot;/&quot;;
+		}
+		var colonIndex = loc.indexOf(&quot;:&quot;);
+		var slashIndex = loc.indexOf(&quot;/&quot;);
+		if (loc.charAt(0) != &quot;/&quot; &amp;&amp; (colonIndex == -1 || colonIndex &gt; slashIndex)) {
+			loc = dojo.hostenv.getBaseScriptUri() + loc;
+		}
+		return new dojo.uri.Uri(loc, uri);
+	};
+	this.Uri = function () {
+		var uri = arguments[0];
+		for (var i = 1; i &lt; arguments.length; i++) {
+			if (!arguments[i]) {
+				continue;
+			}
+			var relobj = new dojo.uri.Uri(arguments[i].toString());
+			var uriobj = new dojo.uri.Uri(uri.toString());
+			if ((relobj.path == &quot;&quot;) &amp;&amp; (relobj.scheme == null) &amp;&amp; (relobj.authority == null) &amp;&amp; (relobj.query == null)) {
+				if (relobj.fragment != null) {
+					uriobj.fragment = relobj.fragment;
+				}
+				relobj = uriobj;
+			} else {
+				if (relobj.scheme == null) {
+					relobj.scheme = uriobj.scheme;
+					if (relobj.authority == null) {
+						relobj.authority = uriobj.authority;
+						if (relobj.path.charAt(0) != &quot;/&quot;) {
+							var path = uriobj.path.substring(0, uriobj.path.lastIndexOf(&quot;/&quot;) + 1) + relobj.path;
+							var segs = path.split(&quot;/&quot;);
+							for (var j = 0; j &lt; segs.length; j++) {
+								if (segs[j] == &quot;.&quot;) {
+									if (j == segs.length - 1) {
+										segs[j] = &quot;&quot;;
+									} else {
+										segs.splice(j, 1);
+										j--;
+									}
+								} else {
+									if (j &gt; 0 &amp;&amp; !(j == 1 &amp;&amp; segs[0] == &quot;&quot;) &amp;&amp; segs[j] == &quot;..&quot; &amp;&amp; segs[j - 1] != &quot;..&quot;) {
+										if (j == segs.length - 1) {
+											segs.splice(j, 1);
+											segs[j - 1] = &quot;&quot;;
+										} else {
+											segs.splice(j - 1, 2);
+											j -= 2;
+										}
+									}
+								}
+							}
+							relobj.path = segs.join(&quot;/&quot;);
+						}
+					}
+				}
+			}
+			uri = &quot;&quot;;
+			if (relobj.scheme != null) {
+				uri += relobj.scheme + &quot;:&quot;;
+			}
+			if (relobj.authority != null) {
+				uri += &quot;//&quot; + relobj.authority;
+			}
+			uri += relobj.path;
+			if (relobj.query != null) {
+				uri += &quot;?&quot; + relobj.query;
+			}
+			if (relobj.fragment != null) {
+				uri += &quot;#&quot; + relobj.fragment;
+			}
+		}
+		this.uri = uri.toString();
+		var regexp = &quot;^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?$&quot;;
+		var r = this.uri.match(new RegExp(regexp));
+		this.scheme = r[2] || (r[1] ? &quot;&quot; : null);
+		this.authority = r[4] || (r[3] ? &quot;&quot; : null);
+		this.path = r[5];
+		this.query = r[7] || (r[6] ? &quot;&quot; : null);
+		this.fragment = r[9] || (r[8] ? &quot;&quot; : null);
+		if (this.authority != null) {
+			regexp = &quot;^((([^:]+:)?([^@]+))@)?([^:]*)(:([0-9]+))?$&quot;;
+			r = this.authority.match(new RegExp(regexp));
+			this.user = r[3] || null;
+			this.password = r[4] || null;
+			this.host = r[5];
+			this.port = r[7] || null;
+		}
+		this.toString = function () {
+			return this.uri;
+		};
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/uri/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uri/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uri/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[[&quot;dojo.uri.Uri&quot;, false, false]]});
+dojo.provide(&quot;dojo.uri.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/uri/cache.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uri/cache.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uri/cache.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,32 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uri.cache&quot;);
+dojo.uri.cache = {_cache:{}, set:function (uri, content) {
+	this._cache[uri.toString()] = content;
+	return uri;
+}, remove:function (uri) {
+	delete this._cache[uri.toString()];
+}, get:function (uri) {
+	var key = uri.toString();
+	var value = this._cache[key];
+	if (!value) {
+		value = dojo.hostenv.getText(key);
+		if (value) {
+			this._cache[key] = value;
+		}
+	}
+	return value;
+}, allow:function (uri) {
+	return uri;
+}};
+

Added: tags/parley-0.55/root/static/magic/src/uuid/LightweightGenerator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/LightweightGenerator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/LightweightGenerator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,42 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uuid.LightweightGenerator&quot;);
+dojo.uuid.LightweightGenerator = new function () {
+	var HEX_RADIX = 16;
+	function _generateRandomEightCharacterHexString() {
+		var random32bitNumber = Math.floor((Math.random() % 1) * Math.pow(2, 32));
+		var eightCharacterHexString = random32bitNumber.toString(HEX_RADIX);
+		while (eightCharacterHexString.length &lt; 8) {
+			eightCharacterHexString = &quot;0&quot; + eightCharacterHexString;
+		}
+		return eightCharacterHexString;
+	}
+	this.generate = function (returnType) {
+		var hyphen = &quot;-&quot;;
+		var versionCodeForRandomlyGeneratedUuids = &quot;4&quot;;
+		var variantCodeForDCEUuids = &quot;8&quot;;
+		var a = _generateRandomEightCharacterHexString();
+		var b = _generateRandomEightCharacterHexString();
+		b = b.substring(0, 4) + hyphen + versionCodeForRandomlyGeneratedUuids + b.substring(5, 8);
+		var c = _generateRandomEightCharacterHexString();
+		c = variantCodeForDCEUuids + c.substring(1, 4) + hyphen + c.substring(4, 8);
+		var d = _generateRandomEightCharacterHexString();
+		var returnValue = a + hyphen + b + hyphen + c + d;
+		returnValue = returnValue.toLowerCase();
+		if (returnType &amp;&amp; (returnType != String)) {
+			returnValue = new returnType(returnValue);
+		}
+		return returnValue;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/uuid/NameBasedGenerator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/NameBasedGenerator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/NameBasedGenerator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uuid.NameBasedGenerator&quot;);
+dojo.uuid.NameBasedGenerator = new function () {
+	this.generate = function (returnType) {
+		dojo.unimplemented(&quot;dojo.uuid.NameBasedGenerator.generate&quot;);
+		var returnValue = &quot;00000000-0000-0000-0000-000000000000&quot;;
+		if (returnType &amp;&amp; (returnType != String)) {
+			returnValue = new returnType(returnValue);
+		}
+		return returnValue;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/uuid/NilGenerator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/NilGenerator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/NilGenerator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uuid.NilGenerator&quot;);
+dojo.uuid.NilGenerator = new function () {
+	this.generate = function (returnType) {
+		var returnValue = &quot;00000000-0000-0000-0000-000000000000&quot;;
+		if (returnType &amp;&amp; (returnType != String)) {
+			returnValue = new returnType(returnValue);
+		}
+		return returnValue;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/uuid/RandomGenerator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/RandomGenerator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/RandomGenerator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uuid.RandomGenerator&quot;);
+dojo.uuid.RandomGenerator = new function () {
+	this.generate = function (returnType) {
+		dojo.unimplemented(&quot;dojo.uuid.RandomGenerator.generate&quot;);
+		var returnValue = &quot;00000000-0000-0000-0000-000000000000&quot;;
+		if (returnType &amp;&amp; (returnType != String)) {
+			returnValue = new returnType(returnValue);
+		}
+		return returnValue;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/uuid/TimeBasedGenerator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/TimeBasedGenerator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/TimeBasedGenerator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,245 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uuid.TimeBasedGenerator&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.type&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.uuid.TimeBasedGenerator = new function () {
+	this.GREGORIAN_CHANGE_OFFSET_IN_HOURS = 3394248;
+	var _uuidPseudoNodeString = null;
+	var _uuidClockSeqString = null;
+	var _dateValueOfPreviousUuid = null;
+	var _nextIntraMillisecondIncrement = 0;
+	var _cachedMillisecondsBetween1582and1970 = null;
+	var _cachedHundredNanosecondIntervalsPerMillisecond = null;
+	var _uniformNode = null;
+	var HEX_RADIX = 16;
+	function _carry(arrayA) {
+		arrayA[2] += arrayA[3] &gt;&gt;&gt; 16;
+		arrayA[3] &amp;= 65535;
+		arrayA[1] += arrayA[2] &gt;&gt;&gt; 16;
+		arrayA[2] &amp;= 65535;
+		arrayA[0] += arrayA[1] &gt;&gt;&gt; 16;
+		arrayA[1] &amp;= 65535;
+		dojo.lang.assert((arrayA[0] &gt;&gt;&gt; 16) === 0);
+	}
+	function _get64bitArrayFromFloat(x) {
+		var result = new Array(0, 0, 0, 0);
+		result[3] = x % 65536;
+		x -= result[3];
+		x /= 65536;
+		result[2] = x % 65536;
+		x -= result[2];
+		x /= 65536;
+		result[1] = x % 65536;
+		x -= result[1];
+		x /= 65536;
+		result[0] = x;
+		return result;
+	}
+	function _addTwo64bitArrays(arrayA, arrayB) {
+		dojo.lang.assertType(arrayA, Array);
+		dojo.lang.assertType(arrayB, Array);
+		dojo.lang.assert(arrayA.length == 4);
+		dojo.lang.assert(arrayB.length == 4);
+		var result = new Array(0, 0, 0, 0);
+		result[3] = arrayA[3] + arrayB[3];
+		result[2] = arrayA[2] + arrayB[2];
+		result[1] = arrayA[1] + arrayB[1];
+		result[0] = arrayA[0] + arrayB[0];
+		_carry(result);
+		return result;
+	}
+	function _multiplyTwo64bitArrays(arrayA, arrayB) {
+		dojo.lang.assertType(arrayA, Array);
+		dojo.lang.assertType(arrayB, Array);
+		dojo.lang.assert(arrayA.length == 4);
+		dojo.lang.assert(arrayB.length == 4);
+		var overflow = false;
+		if (arrayA[0] * arrayB[0] !== 0) {
+			overflow = true;
+		}
+		if (arrayA[0] * arrayB[1] !== 0) {
+			overflow = true;
+		}
+		if (arrayA[0] * arrayB[2] !== 0) {
+			overflow = true;
+		}
+		if (arrayA[1] * arrayB[0] !== 0) {
+			overflow = true;
+		}
+		if (arrayA[1] * arrayB[1] !== 0) {
+			overflow = true;
+		}
+		if (arrayA[2] * arrayB[0] !== 0) {
+			overflow = true;
+		}
+		dojo.lang.assert(!overflow);
+		var result = new Array(0, 0, 0, 0);
+		result[0] += arrayA[0] * arrayB[3];
+		_carry(result);
+		result[0] += arrayA[1] * arrayB[2];
+		_carry(result);
+		result[0] += arrayA[2] * arrayB[1];
+		_carry(result);
+		result[0] += arrayA[3] * arrayB[0];
+		_carry(result);
+		result[1] += arrayA[1] * arrayB[3];
+		_carry(result);
+		result[1] += arrayA[2] * arrayB[2];
+		_carry(result);
+		result[1] += arrayA[3] * arrayB[1];
+		_carry(result);
+		result[2] += arrayA[2] * arrayB[3];
+		_carry(result);
+		result[2] += arrayA[3] * arrayB[2];
+		_carry(result);
+		result[3] += arrayA[3] * arrayB[3];
+		_carry(result);
+		return result;
+	}
+	function _padWithLeadingZeros(string, desiredLength) {
+		while (string.length &lt; desiredLength) {
+			string = &quot;0&quot; + string;
+		}
+		return string;
+	}
+	function _generateRandomEightCharacterHexString() {
+		var random32bitNumber = Math.floor((Math.random() % 1) * Math.pow(2, 32));
+		var eightCharacterString = random32bitNumber.toString(HEX_RADIX);
+		while (eightCharacterString.length &lt; 8) {
+			eightCharacterString = &quot;0&quot; + eightCharacterString;
+		}
+		return eightCharacterString;
+	}
+	function _generateUuidString(node) {
+		dojo.lang.assertType(node, String, {optional:true});
+		if (node) {
+			dojo.lang.assert(node.length == 12);
+		} else {
+			if (_uniformNode) {
+				node = _uniformNode;
+			} else {
+				if (!_uuidPseudoNodeString) {
+					var pseudoNodeIndicatorBit = 32768;
+					var random15bitNumber = Math.floor((Math.random() % 1) * Math.pow(2, 15));
+					var leftmost4HexCharacters = (pseudoNodeIndicatorBit | random15bitNumber).toString(HEX_RADIX);
+					_uuidPseudoNodeString = leftmost4HexCharacters + _generateRandomEightCharacterHexString();
+				}
+				node = _uuidPseudoNodeString;
+			}
+		}
+		if (!_uuidClockSeqString) {
+			var variantCodeForDCEUuids = 32768;
+			var random14bitNumber = Math.floor((Math.random() % 1) * Math.pow(2, 14));
+			_uuidClockSeqString = (variantCodeForDCEUuids | random14bitNumber).toString(HEX_RADIX);
+		}
+		var now = new Date();
+		var millisecondsSince1970 = now.valueOf();
+		var nowArray = _get64bitArrayFromFloat(millisecondsSince1970);
+		if (!_cachedMillisecondsBetween1582and1970) {
+			var arraySecondsPerHour = _get64bitArrayFromFloat(60 * 60);
+			var arrayHoursBetween1582and1970 = _get64bitArrayFromFloat(dojo.uuid.TimeBasedGenerator.GREGORIAN_CHANGE_OFFSET_IN_HOURS);
+			var arraySecondsBetween1582and1970 = _multiplyTwo64bitArrays(arrayHoursBetween1582and1970, arraySecondsPerHour);
+			var arrayMillisecondsPerSecond = _get64bitArrayFromFloat(1000);
+			_cachedMillisecondsBetween1582and1970 = _multiplyTwo64bitArrays(arraySecondsBetween1582and1970, arrayMillisecondsPerSecond);
+			_cachedHundredNanosecondIntervalsPerMillisecond = _get64bitArrayFromFloat(10000);
+		}
+		var arrayMillisecondsSince1970 = nowArray;
+		var arrayMillisecondsSince1582 = _addTwo64bitArrays(_cachedMillisecondsBetween1582and1970, arrayMillisecondsSince1970);
+		var arrayHundredNanosecondIntervalsSince1582 = _multiplyTwo64bitArrays(arrayMillisecondsSince1582, _cachedHundredNanosecondIntervalsPerMillisecond);
+		if (now.valueOf() == _dateValueOfPreviousUuid) {
+			arrayHundredNanosecondIntervalsSince1582[3] += _nextIntraMillisecondIncrement;
+			_carry(arrayHundredNanosecondIntervalsSince1582);
+			_nextIntraMillisecondIncrement += 1;
+			if (_nextIntraMillisecondIncrement == 10000) {
+				while (now.valueOf() == _dateValueOfPreviousUuid) {
+					now = new Date();
+				}
+			}
+		} else {
+			_dateValueOfPreviousUuid = now.valueOf();
+			_nextIntraMillisecondIncrement = 1;
+		}
+		var hexTimeLowLeftHalf = arrayHundredNanosecondIntervalsSince1582[2].toString(HEX_RADIX);
+		var hexTimeLowRightHalf = arrayHundredNanosecondIntervalsSince1582[3].toString(HEX_RADIX);
+		var hexTimeLow = _padWithLeadingZeros(hexTimeLowLeftHalf, 4) + _padWithLeadingZeros(hexTimeLowRightHalf, 4);
+		var hexTimeMid = arrayHundredNanosecondIntervalsSince1582[1].toString(HEX_RADIX);
+		hexTimeMid = _padWithLeadingZeros(hexTimeMid, 4);
+		var hexTimeHigh = arrayHundredNanosecondIntervalsSince1582[0].toString(HEX_RADIX);
+		hexTimeHigh = _padWithLeadingZeros(hexTimeHigh, 3);
+		var hyphen = &quot;-&quot;;
+		var versionCodeForTimeBasedUuids = &quot;1&quot;;
+		var resultUuid = hexTimeLow + hyphen + hexTimeMid + hyphen + versionCodeForTimeBasedUuids + hexTimeHigh + hyphen + _uuidClockSeqString + hyphen + node;
+		resultUuid = resultUuid.toLowerCase();
+		return resultUuid;
+	}
+	this.setNode = function (node) {
+		dojo.lang.assert((node === null) || (node.length == 12));
+		_uniformNode = node;
+	};
+	this.getNode = function () {
+		return _uniformNode;
+	};
+	this.generate = function (input) {
+		var nodeString = null;
+		var returnType = null;
+		if (input) {
+			if (dojo.lang.isObject(input) &amp;&amp; !dojo.lang.isBuiltIn(input)) {
+				var namedParameters = input;
+				dojo.lang.assertValidKeywords(namedParameters, [&quot;node&quot;, &quot;hardwareNode&quot;, &quot;pseudoNode&quot;, &quot;returnType&quot;]);
+				var node = namedParameters[&quot;node&quot;];
+				var hardwareNode = namedParameters[&quot;hardwareNode&quot;];
+				var pseudoNode = namedParameters[&quot;pseudoNode&quot;];
+				nodeString = (node || pseudoNode || hardwareNode);
+				if (nodeString) {
+					var firstCharacter = nodeString.charAt(0);
+					var firstDigit = parseInt(firstCharacter, HEX_RADIX);
+					if (hardwareNode) {
+						dojo.lang.assert((firstDigit &gt;= 0) &amp;&amp; (firstDigit &lt;= 7));
+					}
+					if (pseudoNode) {
+						dojo.lang.assert((firstDigit &gt;= 8) &amp;&amp; (firstDigit &lt;= 15));
+					}
+				}
+				returnType = namedParameters[&quot;returnType&quot;];
+				dojo.lang.assertType(returnType, Function, {optional:true});
+			} else {
+				if (dojo.lang.isString(input)) {
+					nodeString = input;
+					returnType = null;
+				} else {
+					if (dojo.lang.isFunction(input)) {
+						nodeString = null;
+						returnType = input;
+					}
+				}
+			}
+			if (nodeString) {
+				dojo.lang.assert(nodeString.length == 12);
+				var integer = parseInt(nodeString, HEX_RADIX);
+				dojo.lang.assert(isFinite(integer));
+			}
+			dojo.lang.assertType(returnType, Function, {optional:true});
+		}
+		var uuidString = _generateUuidString(nodeString);
+		var returnValue;
+		if (returnType &amp;&amp; (returnType != String)) {
+			returnValue = new returnType(uuidString);
+		} else {
+			returnValue = uuidString;
+		}
+		return returnValue;
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/uuid/Uuid.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/Uuid.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/Uuid.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,215 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.uuid.Uuid&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.assert&quot;);
+dojo.uuid.Uuid = function (input) {
+	this._uuidString = dojo.uuid.Uuid.NIL_UUID;
+	if (input) {
+		if (dojo.lang.isString(input)) {
+			this._uuidString = input.toLowerCase();
+			dojo.lang.assert(this.isValid());
+		} else {
+			if (dojo.lang.isObject(input) &amp;&amp; input.generate) {
+				var generator = input;
+				this._uuidString = generator.generate();
+				dojo.lang.assert(this.isValid());
+			} else {
+				dojo.lang.assert(false, &quot;The dojo.uuid.Uuid() constructor must be initializated with a UUID string.&quot;);
+			}
+		}
+	} else {
+		var ourGenerator = dojo.uuid.Uuid.getGenerator();
+		if (ourGenerator) {
+			this._uuidString = ourGenerator.generate();
+			dojo.lang.assert(this.isValid());
+		}
+	}
+};
+dojo.uuid.Uuid.NIL_UUID = &quot;00000000-0000-0000-0000-000000000000&quot;;
+dojo.uuid.Uuid.Version = {UNKNOWN:0, TIME_BASED:1, DCE_SECURITY:2, NAME_BASED_MD5:3, RANDOM:4, NAME_BASED_SHA1:5};
+dojo.uuid.Uuid.Variant = {NCS:&quot;0&quot;, DCE:&quot;10&quot;, MICROSOFT:&quot;110&quot;, UNKNOWN:&quot;111&quot;};
+dojo.uuid.Uuid.HEX_RADIX = 16;
+dojo.uuid.Uuid.compare = function (uuidOne, uuidTwo) {
+	var uuidStringOne = uuidOne.toString();
+	var uuidStringTwo = uuidTwo.toString();
+	if (uuidStringOne &gt; uuidStringTwo) {
+		return 1;
+	}
+	if (uuidStringOne &lt; uuidStringTwo) {
+		return -1;
+	}
+	return 0;
+};
+dojo.uuid.Uuid.setGenerator = function (generator) {
+	dojo.lang.assert(!generator || (dojo.lang.isObject(generator) &amp;&amp; generator.generate));
+	dojo.uuid.Uuid._ourGenerator = generator;
+};
+dojo.uuid.Uuid.getGenerator = function () {
+	return dojo.uuid.Uuid._ourGenerator;
+};
+dojo.uuid.Uuid.prototype.toString = function (format) {
+	if (format) {
+		switch (format) {
+		  case &quot;{}&quot;:
+			return &quot;{&quot; + this._uuidString + &quot;}&quot;;
+			break;
+		  case &quot;()&quot;:
+			return &quot;(&quot; + this._uuidString + &quot;)&quot;;
+			break;
+		  case &quot;\&quot;\&quot;&quot;:
+			return &quot;\&quot;&quot; + this._uuidString + &quot;\&quot;&quot;;
+			break;
+		  case &quot;''&quot;:
+			return &quot;'&quot; + this._uuidString + &quot;'&quot;;
+			break;
+		  case &quot;urn&quot;:
+			return &quot;urn:uuid:&quot; + this._uuidString;
+			break;
+		  case &quot;!-&quot;:
+			return this._uuidString.split(&quot;-&quot;).join(&quot;&quot;);
+			break;
+		  default:
+			dojo.lang.assert(false, &quot;The toString() method of dojo.uuid.Uuid was passed a bogus format.&quot;);
+		}
+	} else {
+		return this._uuidString;
+	}
+};
+dojo.uuid.Uuid.prototype.compare = function (otherUuid) {
+	return dojo.uuid.Uuid.compare(this, otherUuid);
+};
+dojo.uuid.Uuid.prototype.isEqual = function (otherUuid) {
+	return (this.compare(otherUuid) == 0);
+};
+dojo.uuid.Uuid.prototype.isValid = function () {
+	try {
+		dojo.lang.assertType(this._uuidString, String);
+		dojo.lang.assert(this._uuidString.length == 36);
+		dojo.lang.assert(this._uuidString == this._uuidString.toLowerCase());
+		var arrayOfParts = this._uuidString.split(&quot;-&quot;);
+		dojo.lang.assert(arrayOfParts.length == 5);
+		dojo.lang.assert(arrayOfParts[0].length == 8);
+		dojo.lang.assert(arrayOfParts[1].length == 4);
+		dojo.lang.assert(arrayOfParts[2].length == 4);
+		dojo.lang.assert(arrayOfParts[3].length == 4);
+		dojo.lang.assert(arrayOfParts[4].length == 12);
+		for (var i in arrayOfParts) {
+			var part = arrayOfParts[i];
+			var integer = parseInt(part, dojo.uuid.Uuid.HEX_RADIX);
+			dojo.lang.assert(isFinite(integer));
+		}
+		return true;
+	}
+	catch (e) {
+		return false;
+	}
+};
+dojo.uuid.Uuid.prototype.getVariant = function () {
+	var variantCharacter = this._uuidString.charAt(19);
+	var variantNumber = parseInt(variantCharacter, dojo.uuid.Uuid.HEX_RADIX);
+	dojo.lang.assert((variantNumber &gt;= 0) &amp;&amp; (variantNumber &lt;= 16));
+	if (!dojo.uuid.Uuid._ourVariantLookupTable) {
+		var Variant = dojo.uuid.Uuid.Variant;
+		var lookupTable = [];
+		lookupTable[0] = Variant.NCS;
+		lookupTable[1] = Variant.NCS;
+		lookupTable[2] = Variant.NCS;
+		lookupTable[3] = Variant.NCS;
+		lookupTable[4] = Variant.NCS;
+		lookupTable[5] = Variant.NCS;
+		lookupTable[6] = Variant.NCS;
+		lookupTable[7] = Variant.NCS;
+		lookupTable[8] = Variant.DCE;
+		lookupTable[9] = Variant.DCE;
+		lookupTable[10] = Variant.DCE;
+		lookupTable[11] = Variant.DCE;
+		lookupTable[12] = Variant.MICROSOFT;
+		lookupTable[13] = Variant.MICROSOFT;
+		lookupTable[14] = Variant.UNKNOWN;
+		lookupTable[15] = Variant.UNKNOWN;
+		dojo.uuid.Uuid._ourVariantLookupTable = lookupTable;
+	}
+	return dojo.uuid.Uuid._ourVariantLookupTable[variantNumber];
+};
+dojo.uuid.Uuid.prototype.getVersion = function () {
+	if (!this._versionNumber) {
+		var errorMessage = &quot;Called getVersion() on a dojo.uuid.Uuid that was not a DCE Variant UUID.&quot;;
+		dojo.lang.assert(this.getVariant() == dojo.uuid.Uuid.Variant.DCE, errorMessage);
+		var versionCharacter = this._uuidString.charAt(14);
+		this._versionNumber = parseInt(versionCharacter, dojo.uuid.Uuid.HEX_RADIX);
+	}
+	return this._versionNumber;
+};
+dojo.uuid.Uuid.prototype.getNode = function () {
+	if (!this._nodeString) {
+		var errorMessage = &quot;Called getNode() on a dojo.uuid.Uuid that was not a TIME_BASED UUID.&quot;;
+		dojo.lang.assert(this.getVersion() == dojo.uuid.Uuid.Version.TIME_BASED, errorMessage);
+		var arrayOfStrings = this._uuidString.split(&quot;-&quot;);
+		this._nodeString = arrayOfStrings[4];
+	}
+	return this._nodeString;
+};
+dojo.uuid.Uuid.prototype.getTimestamp = function (returnType) {
+	var errorMessage = &quot;Called getTimestamp() on a dojo.uuid.Uuid that was not a TIME_BASED UUID.&quot;;
+	dojo.lang.assert(this.getVersion() == dojo.uuid.Uuid.Version.TIME_BASED, errorMessage);
+	if (!returnType) {
+		returnType = null;
+	}
+	switch (returnType) {
+	  case &quot;string&quot;:
+	  case String:
+		return this.getTimestamp(Date).toUTCString();
+		break;
+	  case &quot;hex&quot;:
+		if (!this._timestampAsHexString) {
+			var arrayOfStrings = this._uuidString.split(&quot;-&quot;);
+			var hexTimeLow = arrayOfStrings[0];
+			var hexTimeMid = arrayOfStrings[1];
+			var hexTimeHigh = arrayOfStrings[2];
+			hexTimeHigh = hexTimeHigh.slice(1);
+			this._timestampAsHexString = hexTimeHigh + hexTimeMid + hexTimeLow;
+			dojo.lang.assert(this._timestampAsHexString.length == 15);
+		}
+		return this._timestampAsHexString;
+		break;
+	  case null:
+	  case &quot;date&quot;:
+	  case Date:
+		if (!this._timestampAsDate) {
+			var GREGORIAN_CHANGE_OFFSET_IN_HOURS = 3394248;
+			var arrayOfParts = this._uuidString.split(&quot;-&quot;);
+			var timeLow = parseInt(arrayOfParts[0], dojo.uuid.Uuid.HEX_RADIX);
+			var timeMid = parseInt(arrayOfParts[1], dojo.uuid.Uuid.HEX_RADIX);
+			var timeHigh = parseInt(arrayOfParts[2], dojo.uuid.Uuid.HEX_RADIX);
+			var hundredNanosecondIntervalsSince1582 = timeHigh &amp; 4095;
+			hundredNanosecondIntervalsSince1582 &lt;&lt;= 16;
+			hundredNanosecondIntervalsSince1582 += timeMid;
+			hundredNanosecondIntervalsSince1582 *= 4294967296;
+			hundredNanosecondIntervalsSince1582 += timeLow;
+			var millisecondsSince1582 = hundredNanosecondIntervalsSince1582 / 10000;
+			var secondsPerHour = 60 * 60;
+			var hoursBetween1582and1970 = GREGORIAN_CHANGE_OFFSET_IN_HOURS;
+			var secondsBetween1582and1970 = hoursBetween1582and1970 * secondsPerHour;
+			var millisecondsBetween1582and1970 = secondsBetween1582and1970 * 1000;
+			var millisecondsSince1970 = millisecondsSince1582 - millisecondsBetween1582and1970;
+			this._timestampAsDate = new Date(millisecondsSince1970);
+		}
+		return this._timestampAsDate;
+		break;
+	  default:
+		dojo.lang.assert(false, &quot;The getTimestamp() method dojo.uuid.Uuid was passed a bogus returnType: &quot; + returnType);
+		break;
+	}
+};
+

Added: tags/parley-0.55/root/static/magic/src/uuid/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/uuid/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/uuid/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.uuid.Uuid&quot;, &quot;dojo.uuid.LightweightGenerator&quot;, &quot;dojo.uuid.RandomGenerator&quot;, &quot;dojo.uuid.TimeBasedGenerator&quot;, &quot;dojo.uuid.NameBasedGenerator&quot;, &quot;dojo.uuid.NilGenerator&quot;]});
+dojo.provide(&quot;dojo.uuid.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/validate/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.validate&quot;);
+dojo.kwCompoundRequire({common:[&quot;dojo.validate.check&quot;, &quot;dojo.validate.datetime&quot;, &quot;dojo.validate.de&quot;, &quot;dojo.validate.jp&quot;, &quot;dojo.validate.us&quot;, &quot;dojo.validate.web&quot;]});
+dojo.provide(&quot;dojo.validate.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/validate/check.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/check.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/check.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,234 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.check&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.validate.check = function (form, profile) {
+	var missing = [];
+	var invalid = [];
+	var results = {isSuccessful:function () {
+		return (!this.hasInvalid() &amp;&amp; !this.hasMissing());
+	}, hasMissing:function () {
+		return (missing.length &gt; 0);
+	}, getMissing:function () {
+		return missing;
+	}, isMissing:function (elemname) {
+		for (var i = 0; i &lt; missing.length; i++) {
+			if (elemname == missing[i]) {
+				return true;
+			}
+		}
+		return false;
+	}, hasInvalid:function () {
+		return (invalid.length &gt; 0);
+	}, getInvalid:function () {
+		return invalid;
+	}, isInvalid:function (elemname) {
+		for (var i = 0; i &lt; invalid.length; i++) {
+			if (elemname == invalid[i]) {
+				return true;
+			}
+		}
+		return false;
+	}};
+	if (profile.trim instanceof Array) {
+		for (var i = 0; i &lt; profile.trim.length; i++) {
+			var elem = form[profile.trim[i]];
+			if (dj_undef(&quot;type&quot;, elem) || elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) {
+				continue;
+			}
+			elem.value = elem.value.replace(/(^\s*|\s*$)/g, &quot;&quot;);
+		}
+	}
+	if (profile.uppercase instanceof Array) {
+		for (var i = 0; i &lt; profile.uppercase.length; i++) {
+			var elem = form[profile.uppercase[i]];
+			if (dj_undef(&quot;type&quot;, elem) || elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) {
+				continue;
+			}
+			elem.value = elem.value.toUpperCase();
+		}
+	}
+	if (profile.lowercase instanceof Array) {
+		for (var i = 0; i &lt; profile.lowercase.length; i++) {
+			var elem = form[profile.lowercase[i]];
+			if (dj_undef(&quot;type&quot;, elem) || elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) {
+				continue;
+			}
+			elem.value = elem.value.toLowerCase();
+		}
+	}
+	if (profile.ucfirst instanceof Array) {
+		for (var i = 0; i &lt; profile.ucfirst.length; i++) {
+			var elem = form[profile.ucfirst[i]];
+			if (dj_undef(&quot;type&quot;, elem) || elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) {
+				continue;
+			}
+			elem.value = elem.value.replace(/\b\w+\b/g, function (word) {
+				return word.substring(0, 1).toUpperCase() + word.substring(1).toLowerCase();
+			});
+		}
+	}
+	if (profile.digit instanceof Array) {
+		for (var i = 0; i &lt; profile.digit.length; i++) {
+			var elem = form[profile.digit[i]];
+			if (dj_undef(&quot;type&quot;, elem) || elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) {
+				continue;
+			}
+			elem.value = elem.value.replace(/\D/g, &quot;&quot;);
+		}
+	}
+	if (profile.required instanceof Array) {
+		for (var i = 0; i &lt; profile.required.length; i++) {
+			if (!dojo.lang.isString(profile.required[i])) {
+				continue;
+			}
+			var elem = form[profile.required[i]];
+			if (!dj_undef(&quot;type&quot;, elem) &amp;&amp; (elem.type == &quot;text&quot; || elem.type == &quot;textarea&quot; || elem.type == &quot;password&quot;) &amp;&amp; /^\s*$/.test(elem.value)) {
+				missing[missing.length] = elem.name;
+			} else {
+				if (!dj_undef(&quot;type&quot;, elem) &amp;&amp; (elem.type == &quot;select-one&quot; || elem.type == &quot;select-multiple&quot;) &amp;&amp; (elem.selectedIndex == -1 || /^\s*$/.test(elem.options[elem.selectedIndex].value))) {
+					missing[missing.length] = elem.name;
+				} else {
+					if (elem instanceof Array) {
+						var checked = false;
+						for (var j = 0; j &lt; elem.length; j++) {
+							if (elem[j].checked) {
+								checked = true;
+							}
+						}
+						if (!checked) {
+							missing[missing.length] = elem[0].name;
+						}
+					}
+				}
+			}
+		}
+	}
+	if (profile.required instanceof Array) {
+		for (var i = 0; i &lt; profile.required.length; i++) {
+			if (!dojo.lang.isObject(profile.required[i])) {
+				continue;
+			}
+			var elem, numRequired;
+			for (var name in profile.required[i]) {
+				elem = form[name];
+				numRequired = profile.required[i][name];
+			}
+			if (elem instanceof Array) {
+				var checked = 0;
+				for (var j = 0; j &lt; elem.length; j++) {
+					if (elem[j].checked) {
+						checked++;
+					}
+				}
+				if (checked &lt; numRequired) {
+					missing[missing.length] = elem[0].name;
+				}
+			} else {
+				if (!dj_undef(&quot;type&quot;, elem) &amp;&amp; elem.type == &quot;select-multiple&quot;) {
+					var selected = 0;
+					for (var j = 0; j &lt; elem.options.length; j++) {
+						if (elem.options[j].selected &amp;&amp; !/^\s*$/.test(elem.options[j].value)) {
+							selected++;
+						}
+					}
+					if (selected &lt; numRequired) {
+						missing[missing.length] = elem.name;
+					}
+				}
+			}
+		}
+	}
+	if (dojo.lang.isObject(profile.dependencies) || dojo.lang.isObject(profile.dependancies)) {
+		if (profile[&quot;dependancies&quot;]) {
+			dojo.deprecated(&quot;dojo.validate.check&quot;, &quot;profile 'dependancies' is deprecated, please use &quot; + &quot;'dependencies'&quot;, &quot;0.5&quot;);
+			profile.dependencies = profile.dependancies;
+		}
+		for (name in profile.dependencies) {
+			var elem = form[name];
+			if (dj_undef(&quot;type&quot;, elem)) {
+				continue;
+			}
+			if (elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) {
+				continue;
+			}
+			if (/\S+/.test(elem.value)) {
+				continue;
+			}
+			if (results.isMissing(elem.name)) {
+				continue;
+			}
+			var target = form[profile.dependencies[name]];
+			if (target.type != &quot;text&quot; &amp;&amp; target.type != &quot;textarea&quot; &amp;&amp; target.type != &quot;password&quot;) {
+				continue;
+			}
+			if (/^\s*$/.test(target.value)) {
+				continue;
+			}
+			missing[missing.length] = elem.name;
+		}
+	}
+	if (dojo.lang.isObject(profile.constraints)) {
+		for (name in profile.constraints) {
+			var elem = form[name];
+			if (!elem) {
+				continue;
+			}
+			if (!dj_undef(&quot;tagName&quot;, elem) &amp;&amp; (elem.tagName.toLowerCase().indexOf(&quot;input&quot;) &gt;= 0 || elem.tagName.toLowerCase().indexOf(&quot;textarea&quot;) &gt;= 0) &amp;&amp; /^\s*$/.test(elem.value)) {
+				continue;
+			}
+			var isValid = true;
+			if (dojo.lang.isFunction(profile.constraints[name])) {
+				isValid = profile.constraints[name](elem.value);
+			} else {
+				if (dojo.lang.isArray(profile.constraints[name])) {
+					if (dojo.lang.isArray(profile.constraints[name][0])) {
+						for (var i = 0; i &lt; profile.constraints[name].length; i++) {
+							isValid = dojo.validate.evaluateConstraint(profile, profile.constraints[name][i], name, elem);
+							if (!isValid) {
+								break;
+							}
+						}
+					} else {
+						isValid = dojo.validate.evaluateConstraint(profile, profile.constraints[name], name, elem);
+					}
+				}
+			}
+			if (!isValid) {
+				invalid[invalid.length] = elem.name;
+			}
+		}
+	}
+	if (dojo.lang.isObject(profile.confirm)) {
+		for (name in profile.confirm) {
+			var elem = form[name];
+			var target = form[profile.confirm[name]];
+			if (dj_undef(&quot;type&quot;, elem) || dj_undef(&quot;type&quot;, target) || (elem.type != &quot;text&quot; &amp;&amp; elem.type != &quot;textarea&quot; &amp;&amp; elem.type != &quot;password&quot;) || (target.type != elem.type) || (target.value == elem.value) || (results.isInvalid(elem.name)) || (/^\s*$/.test(target.value))) {
+				continue;
+			}
+			invalid[invalid.length] = elem.name;
+		}
+	}
+	return results;
+};
+dojo.validate.evaluateConstraint = function (profile, constraint, fieldName, elem) {
+	var isValidSomething = constraint[0];
+	var params = constraint.slice(1);
+	params.unshift(elem.value);
+	if (typeof isValidSomething != &quot;undefined&quot;) {
+		return isValidSomething.apply(null, params);
+	}
+	return false;
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/common.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/common.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/common.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,96 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.common&quot;);
+dojo.require(&quot;dojo.regexp&quot;);
+dojo.validate.isText = function (value, flags) {
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	if (/^\s*$/.test(value)) {
+		return false;
+	}
+	if (typeof flags.length == &quot;number&quot; &amp;&amp; flags.length != value.length) {
+		return false;
+	}
+	if (typeof flags.minlength == &quot;number&quot; &amp;&amp; flags.minlength &gt; value.length) {
+		return false;
+	}
+	if (typeof flags.maxlength == &quot;number&quot; &amp;&amp; flags.maxlength &lt; value.length) {
+		return false;
+	}
+	return true;
+};
+dojo.validate.isInteger = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.integer(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+dojo.validate.isRealNumber = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.realNumber(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+dojo.validate.isCurrency = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.currency(flags) + &quot;$&quot;);
+	return re.test(value);
+};
+dojo.validate._isInRangeCache = {};
+dojo.validate.isInRange = function (value, flags) {
+	value = value.replace(dojo.lang.has(flags, &quot;separator&quot;) ? flags.separator : &quot;,&quot;, &quot;&quot;, &quot;g&quot;).replace(dojo.lang.has(flags, &quot;symbol&quot;) ? flags.symbol : &quot;$&quot;, &quot;&quot;);
+	if (isNaN(value)) {
+		return false;
+	}
+	flags = (typeof flags == &quot;object&quot;) ? flags : {};
+	var max = (typeof flags.max == &quot;number&quot;) ? flags.max : Infinity;
+	var min = (typeof flags.min == &quot;number&quot;) ? flags.min : -Infinity;
+	var dec = (typeof flags.decimal == &quot;string&quot;) ? flags.decimal : &quot;.&quot;;
+	var cache = dojo.validate._isInRangeCache;
+	var cacheIdx = value + &quot;max&quot; + max + &quot;min&quot; + min + &quot;dec&quot; + dec;
+	if (typeof cache[cacheIdx] != &quot;undefined&quot;) {
+		return cache[cacheIdx];
+	}
+	var pattern = &quot;[^&quot; + dec + &quot;\\deE+-]&quot;;
+	value = value.replace(RegExp(pattern, &quot;g&quot;), &quot;&quot;);
+	value = value.replace(/^([+-]?)(\D*)/, &quot;$1&quot;);
+	value = value.replace(/(\D*)$/, &quot;&quot;);
+	pattern = &quot;(\\d)[&quot; + dec + &quot;](\\d)&quot;;
+	value = value.replace(RegExp(pattern, &quot;g&quot;), &quot;$1.$2&quot;);
+	value = Number(value);
+	if (value &lt; min || value &gt; max) {
+		cache[cacheIdx] = false;
+		return false;
+	}
+	cache[cacheIdx] = true;
+	return true;
+};
+dojo.validate.isNumberFormat = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.numberFormat(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.isValidLuhn = function (value) {
+	var sum, parity, curDigit;
+	if (typeof value != &quot;string&quot;) {
+		value = String(value);
+	}
+	value = value.replace(/[- ]/g, &quot;&quot;);
+	parity = value.length % 2;
+	sum = 0;
+	for (var i = 0; i &lt; value.length; i++) {
+		curDigit = parseInt(value.charAt(i));
+		if (i % 2 == parity) {
+			curDigit *= 2;
+		}
+		if (curDigit &gt; 9) {
+			curDigit -= 9;
+		}
+		sum += curDigit;
+	}
+	return !(sum % 10);
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/creditCard.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/creditCard.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/creditCard.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,64 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.creditCard&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.validate.isValidCreditCard = function (value, ccType) {
+	if (value &amp;&amp; ccType &amp;&amp; ((ccType.toLowerCase() == &quot;er&quot; || dojo.validate.isValidLuhn(value)) &amp;&amp; (dojo.validate.isValidCreditCardNumber(value, ccType.toLowerCase())))) {
+		return true;
+	}
+	return false;
+};
+dojo.validate.isValidCreditCardNumber = function (value, ccType) {
+	if (typeof value != &quot;string&quot;) {
+		value = String(value);
+	}
+	value = value.replace(/[- ]/g, &quot;&quot;);
+	var results = [];
+	var cardinfo = {&quot;mc&quot;:&quot;5[1-5][0-9]{14}&quot;, &quot;ec&quot;:&quot;5[1-5][0-9]{14}&quot;, &quot;vi&quot;:&quot;4([0-9]{12}|[0-9]{15})&quot;, &quot;ax&quot;:&quot;3[47][0-9]{13}&quot;, &quot;dc&quot;:&quot;3(0[0-5][0-9]{11}|[68][0-9]{12})&quot;, &quot;bl&quot;:&quot;3(0[0-5][0-9]{11}|[68][0-9]{12})&quot;, &quot;di&quot;:&quot;6011[0-9]{12}&quot;, &quot;jcb&quot;:&quot;(3[0-9]{15}|(2131|1800)[0-9]{11})&quot;, &quot;er&quot;:&quot;2(014|149)[0-9]{11}&quot;};
+	if (ccType &amp;&amp; dojo.lang.has(cardinfo, ccType.toLowerCase())) {
+		return Boolean(value.match(cardinfo[ccType.toLowerCase()]));
+	} else {
+		for (var p in cardinfo) {
+			if (value.match(&quot;^&quot; + cardinfo[p] + &quot;$&quot;) != null) {
+				results.push(p);
+			}
+		}
+		return (results.length) ? results.join(&quot;|&quot;) : false;
+	}
+};
+dojo.validate.isValidCvv = function (value, ccType) {
+	if (typeof value != &quot;string&quot;) {
+		value = String(value);
+	}
+	var format;
+	switch (ccType.toLowerCase()) {
+	  case &quot;mc&quot;:
+	  case &quot;ec&quot;:
+	  case &quot;vi&quot;:
+	  case &quot;di&quot;:
+		format = &quot;###&quot;;
+		break;
+	  case &quot;ax&quot;:
+		format = &quot;####&quot;;
+		break;
+	  default:
+		return false;
+	}
+	var flags = {format:format};
+	if ((value.length == format.length) &amp;&amp; (dojo.validate.isNumberFormat(value, flags))) {
+		return true;
+	}
+	return false;
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/datetime.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/datetime.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/datetime.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,92 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.datetime&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.validate.isValidTime = function (value, flags) {
+	dojo.deprecated(&quot;dojo.validate.datetime&quot;, &quot;use dojo.date.parse instead&quot;, &quot;0.5&quot;);
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.time(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.is12HourTime = function (value) {
+	dojo.deprecated(&quot;dojo.validate.datetime&quot;, &quot;use dojo.date.parse instead&quot;, &quot;0.5&quot;);
+	return dojo.validate.isValidTime(value, {format:[&quot;h:mm:ss t&quot;, &quot;h:mm t&quot;]});
+};
+dojo.validate.is24HourTime = function (value) {
+	dojo.deprecated(&quot;dojo.validate.datetime&quot;, &quot;use dojo.date.parse instead&quot;, &quot;0.5&quot;);
+	return dojo.validate.isValidTime(value, {format:[&quot;HH:mm:ss&quot;, &quot;HH:mm&quot;]});
+};
+dojo.validate.isValidDate = function (dateValue, format) {
+	dojo.deprecated(&quot;dojo.validate.datetime&quot;, &quot;use dojo.date.parse instead&quot;, &quot;0.5&quot;);
+	if (typeof format == &quot;object&quot; &amp;&amp; typeof format.format == &quot;string&quot;) {
+		format = format.format;
+	}
+	if (typeof format != &quot;string&quot;) {
+		format = &quot;MM/DD/YYYY&quot;;
+	}
+	var reLiteral = format.replace(/([$^.*+?=!:|\/\\\(\)\[\]\{\}])/g, &quot;\\$1&quot;);
+	reLiteral = reLiteral.replace(&quot;YYYY&quot;, &quot;([0-9]{4})&quot;);
+	reLiteral = reLiteral.replace(&quot;MM&quot;, &quot;(0[1-9]|10|11|12)&quot;);
+	reLiteral = reLiteral.replace(&quot;M&quot;, &quot;([1-9]|10|11|12)&quot;);
+	reLiteral = reLiteral.replace(&quot;DDD&quot;, &quot;(00[1-9]|0[1-9][0-9]|[12][0-9][0-9]|3[0-5][0-9]|36[0-6])&quot;);
+	reLiteral = reLiteral.replace(&quot;DD&quot;, &quot;(0[1-9]|[12][0-9]|30|31)&quot;);
+	reLiteral = reLiteral.replace(&quot;D&quot;, &quot;([1-9]|[12][0-9]|30|31)&quot;);
+	reLiteral = reLiteral.replace(&quot;ww&quot;, &quot;(0[1-9]|[1-4][0-9]|5[0-3])&quot;);
+	reLiteral = reLiteral.replace(&quot;d&quot;, &quot;([1-7])&quot;);
+	reLiteral = &quot;^&quot; + reLiteral + &quot;$&quot;;
+	var re = new RegExp(reLiteral);
+	if (!re.test(dateValue)) {
+		return false;
+	}
+	var year = 0, month = 1, date = 1, dayofyear = 1, week = 1, day = 1;
+	var tokens = format.match(/(YYYY|MM|M|DDD|DD|D|ww|d)/g);
+	var values = re.exec(dateValue);
+	for (var i = 0; i &lt; tokens.length; i++) {
+		switch (tokens[i]) {
+		  case &quot;YYYY&quot;:
+			year = Number(values[i + 1]);
+			break;
+		  case &quot;M&quot;:
+		  case &quot;MM&quot;:
+			month = Number(values[i + 1]);
+			break;
+		  case &quot;D&quot;:
+		  case &quot;DD&quot;:
+			date = Number(values[i + 1]);
+			break;
+		  case &quot;DDD&quot;:
+			dayofyear = Number(values[i + 1]);
+			break;
+		  case &quot;ww&quot;:
+			week = Number(values[i + 1]);
+			break;
+		  case &quot;d&quot;:
+			day = Number(values[i + 1]);
+			break;
+		}
+	}
+	var leapyear = (year % 4 == 0 &amp;&amp; (year % 100 != 0 || year % 400 == 0));
+	if (date == 31 &amp;&amp; (month == 4 || month == 6 || month == 9 || month == 11)) {
+		return false;
+	}
+	if (date &gt;= 30 &amp;&amp; month == 2) {
+		return false;
+	}
+	if (date == 29 &amp;&amp; month == 2 &amp;&amp; !leapyear) {
+		return false;
+	}
+	if (dayofyear == 366 &amp;&amp; !leapyear) {
+		return false;
+	}
+	return true;
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/de.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/de.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/de.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.de&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.validate.isGermanCurrency = function (value) {
+	var flags = {symbol:&quot;\u20ac&quot;, placement:&quot;after&quot;, signPlacement:&quot;begin&quot;, decimal:&quot;,&quot;, separator:&quot;.&quot;};
+	return dojo.validate.isCurrency(value, flags);
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/jp.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/jp.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/jp.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.jp&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.validate.isJapaneseCurrency = function (value) {
+	var flags = {symbol:&quot;\xa5&quot;, fractional:false};
+	return dojo.validate.isCurrency(value, flags);
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/us.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/us.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/us.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,34 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.us&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.validate.us.isCurrency = function (value, flags) {
+	return dojo.validate.isCurrency(value, flags);
+};
+dojo.validate.us.isState = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.us.state(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.us.isPhoneNumber = function (value) {
+	var flags = {format:[&quot;###-###-####&quot;, &quot;(###) ###-####&quot;, &quot;(###) ### ####&quot;, &quot;###.###.####&quot;, &quot;###/###-####&quot;, &quot;### ### ####&quot;, &quot;###-###-#### x#???&quot;, &quot;(###) ###-#### x#???&quot;, &quot;(###) ### #### x#???&quot;, &quot;###.###.#### x#???&quot;, &quot;###/###-#### x#???&quot;, &quot;### ### #### x#???&quot;, &quot;##########&quot;]};
+	return dojo.validate.isNumberFormat(value, flags);
+};
+dojo.validate.us.isSocialSecurityNumber = function (value) {
+	var flags = {format:[&quot;###-##-####&quot;, &quot;### ## ####&quot;, &quot;#########&quot;]};
+	return dojo.validate.isNumberFormat(value, flags);
+};
+dojo.validate.us.isZipCode = function (value) {
+	var flags = {format:[&quot;#####-####&quot;, &quot;##### ####&quot;, &quot;#########&quot;, &quot;#####&quot;]};
+	return dojo.validate.isNumberFormat(value, flags);
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate/web.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate/web.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate/web.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,43 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate.web&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.validate.isIpAddress = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.ipAddress(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.isUrl = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.url(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.isEmailAddress = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.emailAddress(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.isEmailAddressList = function (value, flags) {
+	var re = new RegExp(&quot;^&quot; + dojo.regexp.emailAddressList(flags) + &quot;$&quot;, &quot;i&quot;);
+	return re.test(value);
+};
+dojo.validate.getEmailAddressList = function (value, flags) {
+	if (!flags) {
+		flags = {};
+	}
+	if (!flags.listSeparator) {
+		flags.listSeparator = &quot;\\s;,&quot;;
+	}
+	if (dojo.validate.isEmailAddressList(value, flags)) {
+		return value.split(new RegExp(&quot;\\s*[&quot; + flags.listSeparator + &quot;]\\s*&quot;));
+	}
+	return [];
+};
+

Added: tags/parley-0.55/root/static/magic/src/validate.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/validate.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/validate.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.validate&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/AccordionContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/AccordionContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/AccordionContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,128 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.AccordionContainer&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.lfx.html&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.widget.html.layout&quot;);
+dojo.require(&quot;dojo.widget.PageContainer&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.AccordionContainer&quot;, dojo.widget.HtmlWidget, {isContainer:true, labelNodeClass:&quot;label&quot;, containerNodeClass:&quot;accBody&quot;, duration:250, fillInTemplate:function () {
+	with (this.domNode.style) {
+		if (position != &quot;absolute&quot;) {
+			position = &quot;relative&quot;;
+		}
+		overflow = &quot;hidden&quot;;
+	}
+}, addChild:function (widget) {
+	var child = this._addChild(widget);
+	this._setSizes();
+	return child;
+}, _addChild:function (widget) {
+	if (widget.open) {
+		dojo.deprecated(&quot;open parameter deprecated, use 'selected=true' instead will be removed in &quot;, &quot;0.5&quot;);
+		dojo.debug(widget.widgetId + &quot;: open == &quot; + widget.open);
+		widget.selected = true;
+	}
+	if (widget.widgetType != &quot;AccordionPane&quot;) {
+		var wrapper = dojo.widget.createWidget(&quot;AccordionPane&quot;, {label:widget.label, selected:widget.selected, labelNodeClass:this.labelNodeClass, containerNodeClass:this.containerNodeClass, allowCollapse:this.allowCollapse});
+		wrapper.addChild(widget);
+		this.addWidgetAsDirectChild(wrapper);
+		this.registerChild(wrapper, this.children.length);
+		return wrapper;
+	} else {
+		dojo.html.addClass(widget.containerNode, this.containerNodeClass);
+		dojo.html.addClass(widget.labelNode, this.labelNodeClass);
+		this.addWidgetAsDirectChild(widget);
+		this.registerChild(widget, this.children.length);
+		return widget;
+	}
+}, postCreate:function () {
+	var tmpChildren = this.children;
+	this.children = [];
+	dojo.html.removeChildren(this.domNode);
+	dojo.lang.forEach(tmpChildren, dojo.lang.hitch(this, &quot;_addChild&quot;));
+	this._setSizes();
+}, removeChild:function (widget) {
+	dojo.widget.AccordionContainer.superclass.removeChild.call(this, widget);
+	this._setSizes();
+}, onResized:function () {
+	this._setSizes();
+}, _setSizes:function () {
+	var totalCollapsedHeight = 0;
+	var openIdx = 0;
+	dojo.lang.forEach(this.children, function (child, idx) {
+		totalCollapsedHeight += child.getLabelHeight();
+		if (child.selected) {
+			openIdx = idx;
+		}
+	});
+	var mySize = dojo.html.getContentBox(this.domNode);
+	var y = 0;
+	dojo.lang.forEach(this.children, function (child, idx) {
+		var childCollapsedHeight = child.getLabelHeight();
+		child.resizeTo(mySize.width, mySize.height - totalCollapsedHeight + childCollapsedHeight);
+		child.domNode.style.zIndex = idx + 1;
+		child.domNode.style.position = &quot;absolute&quot;;
+		child.domNode.style.top = y + &quot;px&quot;;
+		y += (idx == openIdx) ? dojo.html.getBorderBox(child.domNode).height : childCollapsedHeight;
+	});
+}, selectChild:function (page) {
+	dojo.lang.forEach(this.children, function (child) {
+		child.setSelected(child == page);
+	});
+	var y = 0;
+	var anims = [];
+	dojo.lang.forEach(this.children, function (child, idx) {
+		if (child.domNode.style.top != (y + &quot;px&quot;)) {
+			anims.push(dojo.lfx.html.slideTo(child.domNode, {top:y, left:0}, this.duration));
+		}
+		y += child.selected ? dojo.html.getBorderBox(child.domNode).height : child.getLabelHeight();
+	}, this);
+	dojo.lfx.combine(anims).play();
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.AccordionPane&quot;, dojo.widget.HtmlWidget, {label:&quot;&quot;, &quot;class&quot;:&quot;dojoAccordionPane&quot;, labelNodeClass:&quot;label&quot;, containerNodeClass:&quot;accBody&quot;, selected:false, templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n&lt;div dojoAttachPoint=\&quot;labelNode\&quot; dojoAttachEvent=\&quot;onclick: onLabelClick\&quot; class=\&quot;${this.labelNodeClass}\&quot;&gt;${this.label}&lt;/div&gt;\n&lt;div dojoAttachPoint=\&quot;containerNode\&quot; style=\&quot;overflow: hidden;\&quot; class=\&quot;${this.containerNodeClass}\&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.dojoAccordionPane .label {\n\tcolor: #000;\n\tfont-weight: bold;\n\tbackground: url(\&quot;images/soriaAccordionOff.gif\&quot;) repeat-x top left #85aeec;\n\tborder:1px solid #d9d9d9;\n\tfont-size:0.9em;\n}\n\n.dojoAccordionPane-selected .label {\n\tbackground: url(\&quot;images/soriaAccordionSelected.gif\&quot;) repeat-x top left #85aeec;\n\tborder:1px solid #84a3d1;\n}\n\n.dojoAccordionPane .label:hover {\n\tcursor: pointer;\n}\n\n.dojoAccordionPane .accBody {\n\tbackground: #fff;\n\tover!
 flow: auto;\n\tborder:1px solid #84a3d1;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/AccordionPane.css&quot;), isContainer:true, fillInTemplate:function () {
+	dojo.html.addClass(this.domNode, this[&quot;class&quot;]);
+	dojo.widget.AccordionPane.superclass.fillInTemplate.call(this);
+	dojo.html.disableSelection(this.labelNode);
+	this.setSelected(this.selected);
+}, setLabel:function (label) {
+	this.labelNode.innerHTML = label;
+}, resizeTo:function (width, height) {
+	dojo.html.setMarginBox(this.domNode, {width:width, height:height});
+	var children = [{domNode:this.labelNode, layoutAlign:&quot;top&quot;}, {domNode:this.containerNode, layoutAlign:&quot;client&quot;}];
+	dojo.widget.html.layout(this.domNode, children);
+	var childSize = dojo.html.getContentBox(this.containerNode);
+	this.children[0].resizeTo(childSize.width, childSize.height);
+}, getLabelHeight:function () {
+	return dojo.html.getMarginBox(this.labelNode).height;
+}, onLabelClick:function () {
+	this.parent.selectChild(this);
+}, setSelected:function (isSelected) {
+	this.selected = isSelected;
+	(isSelected ? dojo.html.addClass : dojo.html.removeClass)(this.domNode, this[&quot;class&quot;] + &quot;-selected&quot;);
+	var child = this.children[0];
+	if (child) {
+		if (isSelected) {
+			if (!child.isShowing()) {
+				child.show();
+			} else {
+				child.onShow();
+			}
+		} else {
+			child.onHide();
+		}
+	}
+}});
+dojo.lang.extend(dojo.widget.Widget, {open:false});
+

Added: tags/parley-0.55/root/static/magic/src/widget/AnimatedPng.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/AnimatedPng.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/AnimatedPng.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,47 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.AnimatedPng&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.AnimatedPng&quot;, dojo.widget.HtmlWidget, {isContainer:false, width:0, height:0, aniSrc:&quot;&quot;, interval:100, _blankSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/blank.gif&quot;), templateString:&quot;&lt;img class=\&quot;dojoAnimatedPng\&quot; /&gt;&quot;, postCreate:function () {
+	this.cellWidth = this.width;
+	this.cellHeight = this.height;
+	var img = new Image();
+	var self = this;
+	img.onload = function () {
+		self._initAni(img.width, img.height);
+	};
+	img.src = this.aniSrc;
+}, _initAni:function (w, h) {
+	this.domNode.src = this._blankSrc;
+	this.domNode.width = this.cellWidth;
+	this.domNode.height = this.cellHeight;
+	this.domNode.style.backgroundImage = &quot;url(&quot; + this.aniSrc + &quot;)&quot;;
+	this.domNode.style.backgroundRepeat = &quot;no-repeat&quot;;
+	this.aniCols = Math.floor(w / this.cellWidth);
+	this.aniRows = Math.floor(h / this.cellHeight);
+	this.aniCells = this.aniCols * this.aniRows;
+	this.aniFrame = 0;
+	window.setInterval(dojo.lang.hitch(this, &quot;_tick&quot;), this.interval);
+}, _tick:function () {
+	this.aniFrame++;
+	if (this.aniFrame == this.aniCells) {
+		this.aniFrame = 0;
+	}
+	var col = this.aniFrame % this.aniCols;
+	var row = Math.floor(this.aniFrame / this.aniCols);
+	var bx = -1 * col * this.cellWidth;
+	var by = -1 * row * this.cellHeight;
+	this.domNode.style.backgroundPosition = bx + &quot;px &quot; + by + &quot;px&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Button.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Button.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Button.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,259 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Button&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Button&quot;, dojo.widget.HtmlWidget, {isContainer:true, caption:&quot;&quot;, templateString:&quot;&lt;div dojoAttachPoint=\&quot;buttonNode\&quot; class=\&quot;dojoButton\&quot; style=\&quot;position:relative;\&quot; dojoAttachEvent=\&quot;onMouseOver; onMouseOut; onMouseDown; onMouseUp; onClick:buttonClick; onKey:onKey; onFocus;\&quot;&gt;\n  &lt;div class=\&quot;dojoButtonContents\&quot; align=center dojoAttachPoint=\&quot;containerNode\&quot; style=\&quot;position:absolute;z-index:2;\&quot;&gt;&lt;/div&gt;\n  &lt;img dojoAttachPoint=\&quot;leftImage\&quot; style=\&quot;position:absolute;left:0px;\&quot;&gt;\n  &lt;img dojoAttachPoint=\&quot;centerImage\&quot; style=\&quot;position:absolute;z-index:1;\&quot;&gt;\n  &lt;img dojoAttachPoint=\&quot;rightImage\&quot; style=\&quot;position:absolute;top:0px;right:0px;\&quot;&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;/* ---- button --- */\n.dojoButton {\n\tpadding: 0 0 0 0;\n\tfont-size: 8pt;\n\twhite-space: nowrap;\n\tcursor: pointer;\n\tfont-family: Myriad, Tahoma, Verdana, sans-serif;\n}\n\n.dojoButton .dojoButtonContents {\n\tpadding: 2px 2px 2px 2px;\n\ttext-align: center;\!
 t\t/* if icon and label are split across two lines, center icon */\n\tcolor: white;\n}\n\n.dojoButtonLeftPart .dojoButtonContents {\n\tpadding-right: 8px;\n}\n\n.dojoButtonDisabled {\n\tcursor: url(\&quot;images/no.gif\&quot;), default;\n}\n\n\n.dojoButtonContents img {\n\tvertical-align: middle;\t/* if icon and label are on same line, center them */\n}\n\n/* -------- colors ------------ */\n\n.dojoButtonHover .dojoButtonContents {\n}\n\n.dojoButtonDepressed .dojoButtonContents {\n\tcolor: #293a4b;\n}\n\n.dojoButtonDisabled .dojoButtonContents {\n\tcolor: #aaa;\n}\n\n\n/* ---------- drop down button specific ---------- */\n\n/* border between label and arrow (for drop down buttons */\n.dojoButton .border {\n\twidth: 1px;\n\tbackground: gray;\n}\n\n/* button arrow */\n.dojoButton .downArrow {\n\tpadding-left: 10px;\n\ttext-align: center;\n}\n\n.dojoButton.disabled .downArrow {\n\tcursor : default;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/ButtonTemplate.css&quot;)!
 , inactiveImg:&quot;templates/images/soriaButton-&quot;, activeImg:&quot;temp!
 lates/im
ages/soriaActive-&quot;, pressedImg:&quot;templates/images/soriaPressed-&quot;, disabledImg:&quot;templates/images/soriaDisabled-&quot;, width2height:1 / 3, fillInTemplate:function () {
+	if (this.caption) {
+		this.containerNode.appendChild(document.createTextNode(this.caption));
+	}
+	dojo.html.disableSelection(this.containerNode);
+}, postCreate:function () {
+	this._sizeMyself();
+}, _sizeMyself:function () {
+	if (this.domNode.parentNode) {
+		var placeHolder = document.createElement(&quot;span&quot;);
+		dojo.html.insertBefore(placeHolder, this.domNode);
+	}
+	dojo.body().appendChild(this.domNode);
+	this._sizeMyselfHelper();
+	if (placeHolder) {
+		dojo.html.insertBefore(this.domNode, placeHolder);
+		dojo.html.removeNode(placeHolder);
+	}
+}, _sizeMyselfHelper:function () {
+	var mb = dojo.html.getMarginBox(this.containerNode);
+	this.height = mb.height;
+	this.containerWidth = mb.width;
+	var endWidth = this.height * this.width2height;
+	this.containerNode.style.left = endWidth + &quot;px&quot;;
+	this.leftImage.height = this.rightImage.height = this.centerImage.height = this.height;
+	this.leftImage.width = this.rightImage.width = endWidth + 1;
+	this.centerImage.width = this.containerWidth;
+	this.centerImage.style.left = endWidth + &quot;px&quot;;
+	this._setImage(this.disabled ? this.disabledImg : this.inactiveImg);
+	if (this.disabled) {
+		dojo.html.prependClass(this.domNode, &quot;dojoButtonDisabled&quot;);
+		this.domNode.removeAttribute(&quot;tabIndex&quot;);
+		dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;disabled&quot;, true);
+	} else {
+		dojo.html.removeClass(this.domNode, &quot;dojoButtonDisabled&quot;);
+		this.domNode.setAttribute(&quot;tabIndex&quot;, &quot;0&quot;);
+		dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;disabled&quot;, false);
+	}
+	this.domNode.style.height = this.height + &quot;px&quot;;
+	this.domNode.style.width = (this.containerWidth + 2 * endWidth) + &quot;px&quot;;
+}, onMouseOver:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	if (!dojo.html.hasClass(this.buttonNode, &quot;dojoButtonHover&quot;)) {
+		dojo.html.prependClass(this.buttonNode, &quot;dojoButtonHover&quot;);
+	}
+	this._setImage(this.activeImg);
+}, onMouseDown:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.prependClass(this.buttonNode, &quot;dojoButtonDepressed&quot;);
+	dojo.html.removeClass(this.buttonNode, &quot;dojoButtonHover&quot;);
+	this._setImage(this.pressedImg);
+}, onMouseUp:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.prependClass(this.buttonNode, &quot;dojoButtonHover&quot;);
+	dojo.html.removeClass(this.buttonNode, &quot;dojoButtonDepressed&quot;);
+	this._setImage(this.activeImg);
+}, onMouseOut:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	if (e.toElement &amp;&amp; dojo.html.isDescendantOf(e.toElement, this.buttonNode)) {
+		return;
+	}
+	dojo.html.removeClass(this.buttonNode, &quot;dojoButtonHover&quot;);
+	dojo.html.removeClass(this.buttonNode, &quot;dojoButtonDepressed&quot;);
+	this._setImage(this.inactiveImg);
+}, onKey:function (e) {
+	if (!e.key) {
+		return;
+	}
+	var menu = dojo.widget.getWidgetById(this.menuId);
+	if (e.key == e.KEY_ENTER || e.key == &quot; &quot;) {
+		this.onMouseDown(e);
+		this.buttonClick(e);
+		dojo.lang.setTimeout(this, &quot;onMouseUp&quot;, 75, e);
+		dojo.event.browser.stopEvent(e);
+	}
+	if (menu &amp;&amp; menu.isShowingNow &amp;&amp; e.key == e.KEY_DOWN_ARROW) {
+		dojo.event.disconnect(this.domNode, &quot;onblur&quot;, this, &quot;onBlur&quot;);
+	}
+}, onFocus:function (e) {
+	var menu = dojo.widget.getWidgetById(this.menuId);
+	if (menu) {
+		dojo.event.connectOnce(this.domNode, &quot;onblur&quot;, this, &quot;onBlur&quot;);
+	}
+}, onBlur:function (e) {
+	var menu = dojo.widget.getWidgetById(this.menuId);
+	if (!menu) {
+		return;
+	}
+	if (menu.close &amp;&amp; menu.isShowingNow) {
+		menu.close();
+	}
+}, buttonClick:function (e) {
+	if (!this.disabled) {
+		try {
+			this.domNode.focus();
+		}
+		catch (e2) {
+		}
+		this.onClick(e);
+	}
+}, onClick:function (e) {
+}, _setImage:function (prefix) {
+	this.leftImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;l.gif&quot;);
+	this.centerImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;c.gif&quot;);
+	this.rightImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;r.gif&quot;);
+}, _toggleMenu:function (menuId) {
+	var menu = dojo.widget.getWidgetById(menuId);
+	if (!menu) {
+		return;
+	}
+	if (menu.open &amp;&amp; !menu.isShowingNow) {
+		var pos = dojo.html.getAbsolutePosition(this.domNode, false);
+		menu.open(pos.x, pos.y + this.height, this);
+		dojo.event.disconnect(this.domNode, &quot;onblur&quot;, this, &quot;onBlur&quot;);
+	} else {
+		if (menu.close &amp;&amp; menu.isShowingNow) {
+			menu.close();
+		} else {
+			menu.toggle();
+		}
+	}
+}, setCaption:function (content) {
+	this.caption = content;
+	this.containerNode.innerHTML = content;
+	this._sizeMyself();
+}, setDisabled:function (disabled) {
+	this.disabled = disabled;
+	this._sizeMyself();
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.DropDownButton&quot;, dojo.widget.Button, {menuId:&quot;&quot;, downArrow:&quot;templates/images/whiteDownArrow.gif&quot;, disabledDownArrow:&quot;templates/images/whiteDownArrow.gif&quot;, fillInTemplate:function () {
+	dojo.widget.DropDownButton.superclass.fillInTemplate.apply(this, arguments);
+	this.arrow = document.createElement(&quot;img&quot;);
+	dojo.html.setClass(this.arrow, &quot;downArrow&quot;);
+	dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;haspopup&quot;, this.menuId);
+}, _sizeMyselfHelper:function () {
+	this.arrow.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, this.disabled ? this.disabledDownArrow : this.downArrow);
+	this.containerNode.appendChild(this.arrow);
+	dojo.widget.DropDownButton.superclass._sizeMyselfHelper.call(this);
+}, onClick:function (e) {
+	this._toggleMenu(this.menuId);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ComboButton&quot;, dojo.widget.Button, {menuId:&quot;&quot;, templateString:&quot;&lt;div class=\&quot;dojoButton\&quot; style=\&quot;position:relative;top:0px;left:0px; text-align:none;\&quot; dojoAttachEvent=\&quot;onKey;onFocus\&quot;&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;buttonNode\&quot; class=\&quot;dojoButtonLeftPart\&quot; style=\&quot;position:absolute;left:0px;top:0px;\&quot;\n\t\tdojoAttachEvent=\&quot;onMouseOver; onMouseOut; onMouseDown; onMouseUp; onClick:buttonClick;\&quot;&gt;\n\t\t&lt;div class=\&quot;dojoButtonContents\&quot; dojoAttachPoint=\&quot;containerNode\&quot; style=\&quot;position:absolute;top:0px;right:0px;z-index:2;\&quot;&gt;&lt;/div&gt;\n\t\t&lt;img dojoAttachPoint=\&quot;leftImage\&quot; style=\&quot;position:absolute;left:0px;top:0px;\&quot;&gt;\n\t\t&lt;img dojoAttachPoint=\&quot;centerImage\&quot; style=\&quot;position:absolute;right:0px;top:0px;z-index:1;\&quot;&gt;\n\t&lt;/div&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;rightPart\&quot; class=\&quot;dojoButtonRightPart\&quot; style=\&quot;position:absolute;top:0px;right:0px;\&quot;\n\t\tdojoAttachEvent=\&quot;onMouseOver:rightOver; onMouseOut:rightOut; onMouseDown:rightDown; onMouseUp:r!
 ightUp; onClick:rightClick;\&quot;&gt;\n\t\t&lt;img dojoAttachPoint=\&quot;arrowBackgroundImage\&quot; style=\&quot;position:absolute;top:0px;left:0px;z-index:1;\&quot;&gt;\n\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/images/whiteDownArrow.gif\&quot;\n\t\t  \t\tstyle=\&quot;z-index:2;position:absolute;left:3px;top:50%;\&quot;&gt;\n\t\t&lt;img dojoAttachPoint=\&quot;rightImage\&quot; style=\&quot;position:absolute;top:0px;right:0px;\&quot;&gt;\n\t&lt;/div&gt;\n\n&lt;/div&gt;\n&quot;, splitWidth:2, arrowWidth:5, _sizeMyselfHelper:function (e) {
+	var mb = dojo.html.getMarginBox(this.containerNode);
+	this.height = mb.height;
+	this.containerWidth = mb.width;
+	var endWidth = this.height / 3;
+	if (this.disabled) {
+		dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;disabled&quot;, true);
+		this.domNode.removeAttribute(&quot;tabIndex&quot;);
+	} else {
+		dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;disabled&quot;, false);
+		this.domNode.setAttribute(&quot;tabIndex&quot;, &quot;0&quot;);
+	}
+	this.leftImage.height = this.rightImage.height = this.centerImage.height = this.arrowBackgroundImage.height = this.height;
+	this.leftImage.width = endWidth + 1;
+	this.centerImage.width = this.containerWidth;
+	this.buttonNode.style.height = this.height + &quot;px&quot;;
+	this.buttonNode.style.width = endWidth + this.containerWidth + &quot;px&quot;;
+	this._setImage(this.disabled ? this.disabledImg : this.inactiveImg);
+	this.arrowBackgroundImage.width = this.arrowWidth;
+	this.rightImage.width = endWidth + 1;
+	this.rightPart.style.height = this.height + &quot;px&quot;;
+	this.rightPart.style.width = this.arrowWidth + endWidth + &quot;px&quot;;
+	this._setImageR(this.disabled ? this.disabledImg : this.inactiveImg);
+	this.domNode.style.height = this.height + &quot;px&quot;;
+	var totalWidth = this.containerWidth + this.splitWidth + this.arrowWidth + 2 * endWidth;
+	this.domNode.style.width = totalWidth + &quot;px&quot;;
+}, _setImage:function (prefix) {
+	this.leftImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;l.gif&quot;);
+	this.centerImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;c.gif&quot;);
+}, rightOver:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.prependClass(this.rightPart, &quot;dojoButtonHover&quot;);
+	this._setImageR(this.activeImg);
+}, rightDown:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.prependClass(this.rightPart, &quot;dojoButtonDepressed&quot;);
+	dojo.html.removeClass(this.rightPart, &quot;dojoButtonHover&quot;);
+	this._setImageR(this.pressedImg);
+}, rightUp:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.prependClass(this.rightPart, &quot;dojoButtonHover&quot;);
+	dojo.html.removeClass(this.rightPart, &quot;dojoButtonDepressed&quot;);
+	this._setImageR(this.activeImg);
+}, rightOut:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.removeClass(this.rightPart, &quot;dojoButtonHover&quot;);
+	dojo.html.removeClass(this.rightPart, &quot;dojoButtonDepressed&quot;);
+	this._setImageR(this.inactiveImg);
+}, rightClick:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	try {
+		this.domNode.focus();
+	}
+	catch (e2) {
+	}
+	this._toggleMenu(this.menuId);
+}, _setImageR:function (prefix) {
+	this.arrowBackgroundImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;c.gif&quot;);
+	this.rightImage.src = dojo.uri.moduleUri(&quot;dojo.widget&quot;, prefix + &quot;r.gif&quot;);
+}, onKey:function (e) {
+	if (!e.key) {
+		return;
+	}
+	var menu = dojo.widget.getWidgetById(this.menuId);
+	if (e.key == e.KEY_ENTER || e.key == &quot; &quot;) {
+		this.onMouseDown(e);
+		this.buttonClick(e);
+		dojo.lang.setTimeout(this, &quot;onMouseUp&quot;, 75, e);
+		dojo.event.browser.stopEvent(e);
+	} else {
+		if (e.key == e.KEY_DOWN_ARROW &amp;&amp; e.altKey) {
+			this.rightDown(e);
+			this.rightClick(e);
+			dojo.lang.setTimeout(this, &quot;rightUp&quot;, 75, e);
+			dojo.event.browser.stopEvent(e);
+		} else {
+			if (menu &amp;&amp; menu.isShowingNow &amp;&amp; e.key == e.KEY_DOWN_ARROW) {
+				dojo.event.disconnect(this.domNode, &quot;onblur&quot;, this, &quot;onBlur&quot;);
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Chart.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Chart.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Chart.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,233 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Chart&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.gfx.color.hsl&quot;);
+dojo.declare(&quot;dojo.widget.Chart&quot;, null, function () {
+	this.series = [];
+}, {isContainer:false, assignColors:function () {
+	var hue = 30;
+	var sat = 120;
+	var lum = 120;
+	var steps = Math.round(330 / this.series.length);
+	for (var i = 0; i &lt; this.series.length; i++) {
+		var c = dojo.gfx.color.hsl2rgb(hue, sat, lum);
+		if (!this.series[i].color) {
+			this.series[i].color = dojo.gfx.color.rgb2hex(c[0], c[1], c[2]);
+		}
+		hue += steps;
+	}
+}, parseData:function (table) {
+	var thead = table.getElementsByTagName(&quot;thead&quot;)[0];
+	var tbody = table.getElementsByTagName(&quot;tbody&quot;)[0];
+	if (!(thead &amp;&amp; tbody)) {
+		dojo.raise(&quot;dojo.widget.Chart: supplied table must define a head and a body.&quot;);
+	}
+	var columns = thead.getElementsByTagName(&quot;tr&quot;)[0].getElementsByTagName(&quot;th&quot;);
+	for (var i = 1; i &lt; columns.length; i++) {
+		var key = &quot;column&quot; + i;
+		var label = columns[i].innerHTML;
+		var plotType = columns[i].getAttribute(&quot;plotType&quot;) || &quot;line&quot;;
+		var color = columns[i].getAttribute(&quot;color&quot;);
+		var ds = new dojo.widget.Chart.DataSeries(key, label, plotType, color);
+		this.series.push(ds);
+	}
+	var rows = tbody.rows;
+	var xMin = Number.MAX_VALUE, xMax = Number.MIN_VALUE;
+	var yMin = Number.MAX_VALUE, yMax = Number.MIN_VALUE;
+	var ignore = [&quot;accesskey&quot;, &quot;align&quot;, &quot;bgcolor&quot;, &quot;class&quot;, &quot;colspan&quot;, &quot;height&quot;, &quot;id&quot;, &quot;nowrap&quot;, &quot;rowspan&quot;, &quot;style&quot;, &quot;tabindex&quot;, &quot;title&quot;, &quot;valign&quot;, &quot;width&quot;];
+	for (var i = 0; i &lt; rows.length; i++) {
+		var row = rows[i];
+		var cells = row.cells;
+		var x = Number.MIN_VALUE;
+		for (var j = 0; j &lt; cells.length; j++) {
+			if (j == 0) {
+				x = parseFloat(cells[j].innerHTML);
+				xMin = Math.min(xMin, x);
+				xMax = Math.max(xMax, x);
+			} else {
+				var ds = this.series[j - 1];
+				var y = parseFloat(cells[j].innerHTML);
+				yMin = Math.min(yMin, y);
+				yMax = Math.max(yMax, y);
+				var o = {x:x, value:y};
+				var attrs = cells[j].attributes;
+				for (var k = 0; k &lt; attrs.length; k++) {
+					var attr = attrs.item(k);
+					var bIgnore = false;
+					for (var l = 0; l &lt; ignore.length; l++) {
+						if (attr.nodeName.toLowerCase() == ignore[l]) {
+							bIgnore = true;
+							break;
+						}
+					}
+					if (!bIgnore) {
+						o[attr.nodeName] = attr.nodeValue;
+					}
+				}
+				ds.add(o);
+			}
+		}
+	}
+	return {x:{min:xMin, max:xMax}, y:{min:yMin, max:yMax}};
+}});
+dojo.declare(&quot;dojo.widget.Chart.DataSeries&quot;, null, function (key, label, plotType, color) {
+	this.id = &quot;DataSeries&quot; + dojo.widget.Chart.DataSeries.count++;
+	this.key = key;
+	this.label = label || this.id;
+	this.plotType = plotType || &quot;line&quot;;
+	this.color = color;
+	this.values = [];
+}, {add:function (v) {
+	if (v.x == null || v.value == null) {
+		dojo.raise(&quot;dojo.widget.Chart.DataSeries.add: v must have both an 'x' and 'value' property.&quot;);
+	}
+	this.values.push(v);
+}, clear:function () {
+	this.values = [];
+}, createRange:function (len) {
+	var idx = this.values.length - 1;
+	var length = (len || this.values.length);
+	return {&quot;index&quot;:idx, &quot;length&quot;:length, &quot;start&quot;:Math.max(idx - length, 0)};
+}, getMean:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var t = 0;
+	var c = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			t += n;
+			c++;
+		}
+	}
+	t /= Math.max(c, 1);
+	return t;
+}, getMovingAverage:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var t = 0;
+	var c = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			t += n;
+			c++;
+		}
+	}
+	t /= Math.max(c, 1);
+	return t;
+}, getVariance:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var t = 0;
+	var s = 0;
+	var c = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			t += n;
+			s += Math.pow(n, 2);
+			c++;
+		}
+	}
+	return (s / c) - Math.pow(t / c, 2);
+}, getStandardDeviation:function (len) {
+	return Math.sqrt(this.getVariance(len));
+}, getMax:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var t = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			t = Math.max(n, t);
+		}
+	}
+	return t;
+}, getMin:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var t = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			t = Math.min(n, t);
+		}
+	}
+	return t;
+}, getMedian:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var a = [];
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			var b = false;
+			for (var j = 0; j &lt; a.length &amp;&amp; !b; j++) {
+				if (n == a[j]) {
+					b = true;
+				}
+			}
+			if (!b) {
+				a.push(n);
+			}
+		}
+	}
+	a.sort();
+	if (a.length &gt; 0) {
+		return a[Math.ceil(a.length / 2)];
+	}
+	return 0;
+}, getMode:function (len) {
+	var range = this.createRange(len);
+	if (range.index &lt; 0) {
+		return 0;
+	}
+	var o = {};
+	var ret = 0;
+	var m = 0;
+	for (var i = range.index; i &gt;= range.start; i--) {
+		var n = parseFloat(this.values[i].value);
+		if (!isNaN(n)) {
+			if (!o[this.values[i].value]) {
+				o[this.values[i].value] = 1;
+			} else {
+				o[this.values[i].value]++;
+			}
+		}
+	}
+	for (var p in o) {
+		if (m &lt; o[p]) {
+			m = o[p];
+			ret = p;
+		}
+	}
+	return parseFloat(ret);
+}});
+dojo.requireIf(dojo.render.svg.capable, &quot;dojo.widget.svg.Chart&quot;);
+dojo.requireIf(!dojo.render.svg.capable &amp;&amp; dojo.render.vml.capable, &quot;dojo.widget.vml.Chart&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/Checkbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Checkbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Checkbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,103 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Checkbox&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Checkbox&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;span style=\&quot;display: inline-block;\&quot; tabIndex=\&quot;${this.tabIndex}\&quot; waiRole=\&quot;checkbox\&quot; id=\&quot;${this.id}\&quot;&gt;\n\t&lt;img dojoAttachPoint=\&quot;imageNode\&quot; class=\&quot;dojoHtmlCheckbox\&quot; src=\&quot;${dojoWidgetModuleUri}templates/images/blank.gif\&quot; alt=\&quot;\&quot; /&gt;\n\t&lt;input type=\&quot;checkbox\&quot; name=\&quot;${this.name}\&quot; style=\&quot;display: none\&quot; value=\&quot;${this.value}\&quot;\n\t\tdojoAttachPoint=\&quot;inputNode\&quot;&gt;\n&lt;/span&gt;\n&quot;, templateCssString:&quot;.dojoHtmlCheckbox {\n\tborder: 0px;\n\twidth: 16px;\n\theight: 16px;\n\tmargin: 2px;\n\tvertical-align: middle;\n}\n\n.dojoHtmlCheckboxOn {\n\tbackground: url(check.gif) 0px 0px;\n}\n.dojoHtmlCheckboxOff {\n\tbackground: url(check.gif) -16px 0px;\n}\n.dojoHtmlCheckboxDisabledOn {\n\tbackground: url(check.gif) -32px 0px;\n}\n.dojoHtmlCheckboxDisabledOff {\n\tbackground: url(check.gif) -48px 0px;\n}\n.dojoHtmlCheckboxOnHover {\n\tbackground: url(check.gif) -64px 0px;\n}\n.dojoHtmlCheckb!
 oxOffHover {\n\tbackground: url(check.gif) -80px 0px;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Checkbox.css&quot;), name:&quot;&quot;, id:&quot;&quot;, checked:false, tabIndex:&quot;&quot;, value:&quot;on&quot;, postMixInProperties:function () {
+	dojo.widget.Checkbox.superclass.postMixInProperties.apply(this, arguments);
+	if (!this.disabled &amp;&amp; this.tabIndex == &quot;&quot;) {
+		this.tabIndex = &quot;0&quot;;
+	}
+}, fillInTemplate:function () {
+	this._setInfo();
+}, postCreate:function () {
+	var notcon = true;
+	this.id = this.id != &quot;&quot; ? this.id : this.widgetId;
+	if (this.id != &quot;&quot;) {
+		var labels = document.getElementsByTagName(&quot;label&quot;);
+		if (labels != null &amp;&amp; labels.length &gt; 0) {
+			for (var i = 0; i &lt; labels.length; i++) {
+				if (labels[i].htmlFor == this.id) {
+					labels[i].id = (labels[i].htmlFor + &quot;label&quot;);
+					this._connectEvents(labels[i]);
+					dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;labelledby&quot;, labels[i].id);
+					break;
+				}
+			}
+		}
+	}
+	this._connectEvents(this.domNode);
+	this.inputNode.checked = this.checked;
+}, _connectEvents:function (node) {
+	dojo.event.connect(node, &quot;onmouseover&quot;, this, &quot;mouseOver&quot;);
+	dojo.event.connect(node, &quot;onmouseout&quot;, this, &quot;mouseOut&quot;);
+	dojo.event.connect(node, &quot;onkey&quot;, this, &quot;onKey&quot;);
+	dojo.event.connect(node, &quot;onclick&quot;, this, &quot;_onClick&quot;);
+	dojo.html.disableSelection(node);
+}, _onClick:function (e) {
+	if (this.disabled == false) {
+		this.checked = !this.checked;
+		this._setInfo();
+	}
+	e.preventDefault();
+	e.stopPropagation();
+	this.onClick();
+}, setValue:function (bool) {
+	if (this.disabled == false) {
+		this.checked = bool;
+		this._setInfo();
+	}
+}, onClick:function () {
+}, onKey:function (e) {
+	var k = dojo.event.browser.keys;
+	if (e.key == &quot; &quot;) {
+		this._onClick(e);
+	}
+}, mouseOver:function (e) {
+	this._hover(e, true);
+}, mouseOut:function (e) {
+	this._hover(e, false);
+}, _hover:function (e, isOver) {
+	if (this.disabled == false) {
+		var state = this.checked ? &quot;On&quot; : &quot;Off&quot;;
+		var style = &quot;dojoHtmlCheckbox&quot; + state + &quot;Hover&quot;;
+		if (isOver) {
+			dojo.html.addClass(this.imageNode, style);
+		} else {
+			dojo.html.removeClass(this.imageNode, style);
+		}
+	}
+}, _setInfo:function () {
+	var state = &quot;dojoHtmlCheckbox&quot; + (this.disabled ? &quot;Disabled&quot; : &quot;&quot;) + (this.checked ? &quot;On&quot; : &quot;Off&quot;);
+	dojo.html.setClass(this.imageNode, &quot;dojoHtmlCheckbox &quot; + state);
+	this.inputNode.checked = this.checked;
+	if (this.disabled) {
+		this.inputNode.setAttribute(&quot;disabled&quot;, true);
+	} else {
+		this.inputNode.removeAttribute(&quot;disabled&quot;);
+	}
+	dojo.widget.wai.setAttr(this.domNode, &quot;waiState&quot;, &quot;checked&quot;, this.checked);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.a11y.Checkbox&quot;, dojo.widget.Checkbox, {templateString:&quot;&lt;span class='dojoHtmlCheckbox'&gt;\n\t&lt;input type=\&quot;checkbox\&quot; name=\&quot;${this.name}\&quot; tabIndex=\&quot;${this.tabIndex}\&quot; id=\&quot;${this.id}\&quot; value=\&quot;${this.value}\&quot;\n\t\t dojoAttachEvent=\&quot;onClick: _onClick;\&quot; dojoAttachPoint=\&quot;inputNode\&quot;&gt; \n&lt;/span&gt;\n&quot;, fillInTemplate:function () {
+}, postCreate:function (args, frag) {
+	this.inputNode.checked = this.checked;
+	if (this.disabled) {
+		this.inputNode.setAttribute(&quot;disabled&quot;, true);
+	}
+}, _onClick:function () {
+	this.onClick();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Clock.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Clock.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Clock.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,142 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Clock&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.gfx.*&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.timing.Timer&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Clock&quot;, dojo.widget.HtmlWidget, function () {
+	var self = this;
+	this.timeZoneOffset = 0;
+	this.label = &quot;&quot;;
+	this.date = new Date();
+	this.handColor = &quot;#788598&quot;;
+	this.handStroke = &quot;#6f7b8c&quot;;
+	this.secondHandColor = [201, 4, 5, 0.8];
+	this.topLabelColor = &quot;#efefef&quot;;
+	this.labelColor = &quot;#fff&quot;;
+	this.timer = new dojo.lang.timing.Timer(1000);
+	this.center = {x:75, y:75};
+	this.hands = {hour:null, minute:null, second:null};
+	this.shadows = {hour:{shadow:null, shift:{dx:2, dy:2}}, minute:{shadow:null, shift:{dx:2, dy:3}}, second:{shadow:null, shift:{dx:4, dy:4}}};
+	this.image = dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/clock.png&quot;);
+	this.surface = null;
+	this.labelNode = null;
+	this.topLabelNode = null;
+	this.draw = function () {
+		self.date = new Date();
+		var h = (self.date.getHours() + self.timeZoneOffset) % 12;
+		var m = self.date.getMinutes();
+		var s = self.date.getSeconds();
+		self.placeHour(h, m, s);
+		self.placeMinute(m, s);
+		self.placeSecond(s);
+		self.topLabelNode.innerHTML = ((self.date.getHours() + self.timeZoneOffset) &gt; 11) ? &quot;PM&quot; : &quot;AM&quot;;
+	};
+	this.timer.onTick = self.draw;
+}, {set:function (dt) {
+	this.date = dt;
+	if (!this.timer.isRunning) {
+		this.draw();
+	}
+}, start:function () {
+	this.timer.start();
+}, stop:function () {
+	this.timer.stop();
+}, _initPoly:function (parent, points) {
+	var path = parent.createPath();
+	var first = true;
+	dojo.lang.forEach(points, function (c) {
+		if (first) {
+			path.moveTo(c.x, c.y);
+			first = false;
+		} else {
+			path.lineTo(c.x, c.y);
+		}
+	});
+	return path;
+}, _placeHand:function (shape, angle, shift) {
+	var move = {dx:this.center.x + (shift ? shift.dx : 0), dy:this.center.y + (shift ? shift.dy : 0)};
+	return shape.setTransform([move, dojo.gfx.matrix.rotateg(-angle)]);
+}, placeHour:function (h, m, s) {
+	var angle = 30 * (h + m / 60 + s / 3600);
+	this._placeHand(this.hands.hour, angle);
+	this._placeHand(this.shadows.hour.shadow, angle, this.shadows.hour.shift);
+}, placeMinute:function (m, s) {
+	var angle = 6 * (m + s / 60);
+	this._placeHand(this.hands.minute, angle);
+	this._placeHand(this.shadows.minute.shadow, angle, this.shadows.minute.shift);
+}, placeSecond:function (s) {
+	var angle = 6 * s;
+	this._placeHand(this.hands.second, angle);
+	this._placeHand(this.shadows.second.shadow, angle, this.shadows.second.shift);
+}, init:function () {
+	if (this.domNode.style.position != &quot;absolute&quot;) {
+		this.domNode.style.position = &quot;relative&quot;;
+	}
+	while (this.domNode.childNodes.length &gt; 0) {
+		this.domNode.removeChild(this.domNode.childNodes[0]);
+	}
+	this.domNode.style.width = &quot;150px&quot;;
+	this.domNode.style.height = &quot;150px&quot;;
+	this.surface = dojo.gfx.createSurface(this.domNode, 150, 150);
+	this.surface.createRect({width:150, height:150});
+	this.surface.createImage({width:150, height:150, src:this.image + &quot;&quot;});
+	var hP = [{x:-3, y:-4}, {x:3, y:-4}, {x:1, y:-27}, {x:-1, y:-27}, {x:-3, y:-4}];
+	var mP = [{x:-3, y:-4}, {x:3, y:-4}, {x:1, y:-38}, {x:-1, y:-38}, {x:-3, y:-4}];
+	var sP = [{x:-2, y:-2}, {x:2, y:-2}, {x:1, y:-45}, {x:-1, y:-45}, {x:-2, y:-2}];
+	this.shadows.hour.shadow = this._initPoly(this.surface, hP).setFill([0, 0, 0, 0.1]);
+	this.hands.hour = this._initPoly(this.surface, hP).setStroke({color:this.handStroke, width:1}).setFill({type:&quot;linear&quot;, x1:0, y1:0, x2:0, y2:-27, colors:[{offset:0, color:&quot;#fff&quot;}, {offset:0.33, color:this.handColor}]});
+	this.shadows.minute.shadow = this._initPoly(this.surface, mP).setFill([0, 0, 0, 0.1]);
+	this.hands.minute = this._initPoly(this.surface, mP).setStroke({color:this.handStroke, width:1}).setFill({type:&quot;linear&quot;, x1:0, y1:0, x2:0, y2:-38, colors:[{offset:0, color:&quot;#fff&quot;}, {offset:0.33, color:this.handColor}]});
+	this.surface.createCircle({r:6}).setStroke({color:this.handStroke, width:2}).setFill(&quot;#fff&quot;).setTransform({dx:75, dy:75});
+	this.shadows.second.shadow = this._initPoly(this.surface, sP).setFill([0, 0, 0, 0.1]);
+	this.hands.second = this._initPoly(this.surface, sP).setFill(this.secondHandColor);
+	this.surface.createCircle({r:4}).setFill(this.secondHandColor).setTransform({dx:75, dy:75});
+	this.topLabelNode = document.createElement(&quot;div&quot;);
+	with (this.topLabelNode.style) {
+		position = &quot;absolute&quot;;
+		top = &quot;3px&quot;;
+		left = &quot;0px&quot;;
+		color = this.topLabelColor;
+		textAlign = &quot;center&quot;;
+		width = &quot;150px&quot;;
+		fontFamily = &quot;sans-serif&quot;;
+		fontSize = &quot;11px&quot;;
+		textTransform = &quot;uppercase&quot;;
+		fontWeight = &quot;bold&quot;;
+	}
+	this.topLabelNode.innerHTML = ((this.date.getHours() + this.timeZoneOffset) &gt; 11) ? &quot;PM&quot; : &quot;AM&quot;;
+	this.domNode.appendChild(this.topLabelNode);
+	this.labelNode = document.createElement(&quot;div&quot;);
+	with (this.labelNode.style) {
+		position = &quot;absolute&quot;;
+		top = &quot;134px&quot;;
+		left = &quot;0px&quot;;
+		color = this.labelColor;
+		textAlign = &quot;center&quot;;
+		width = &quot;150px&quot;;
+		fontFamily = &quot;sans-serif&quot;;
+		fontSize = &quot;10px&quot;;
+		textTransform = &quot;uppercase&quot;;
+		fontWeight = &quot;bold&quot;;
+	}
+	this.labelNode.innerHTML = this.label || &quot;&nbsp;&quot;;
+	this.domNode.appendChild(this.labelNode);
+	this.draw();
+}, postCreate:function () {
+	this.init();
+	this.start();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ColorPalette.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ColorPalette.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ColorPalette.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,60 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ColorPalette&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ColorPalette&quot;, dojo.widget.HtmlWidget, {palette:&quot;7x10&quot;, _palettes:{&quot;7x10&quot;:[[&quot;fff&quot;, &quot;fcc&quot;, &quot;fc9&quot;, &quot;ff9&quot;, &quot;ffc&quot;, &quot;9f9&quot;, &quot;9ff&quot;, &quot;cff&quot;, &quot;ccf&quot;, &quot;fcf&quot;], [&quot;ccc&quot;, &quot;f66&quot;, &quot;f96&quot;, &quot;ff6&quot;, &quot;ff3&quot;, &quot;6f9&quot;, &quot;3ff&quot;, &quot;6ff&quot;, &quot;99f&quot;, &quot;f9f&quot;], [&quot;c0c0c0&quot;, &quot;f00&quot;, &quot;f90&quot;, &quot;fc6&quot;, &quot;ff0&quot;, &quot;3f3&quot;, &quot;6cc&quot;, &quot;3cf&quot;, &quot;66c&quot;, &quot;c6c&quot;], [&quot;999&quot;, &quot;c00&quot;, &quot;f60&quot;, &quot;fc3&quot;, &quot;fc0&quot;, &quot;3c0&quot;, &quot;0cc&quot;, &quot;36f&quot;, &quot;63f&quot;, &quot;c3c&quot;], [&quot;666&quot;, &quot;900&quot;, &quot;c60&quot;, &quot;c93&quot;, &quot;990&quot;, &quot;090&quot;, &quot;399&quot;, &quot;33f&quot;, &quot;60c&quot;, &quot;939&quot;], [&quot;333&quot;, &quot;600&quot;, &quot;930&quot;, &quot;963&quot;, &quot;660&quot;, &quot;060&quot;, &quot;366&quot;, &quot;009&quot;, &quot;339&quot;, &quot;636&quot;], [&quot;000&quot;, &quot;300&quot;, &quot;630&quot;, &quot;633&quot;, &quot;330&quot;, &quot;030&quot;, &quot;033&quot;, &quot;006&quot;, &quot;309&quot;, &quot;303&quot;]], &quot;3x4&quot;:[[&quot;ffffff&quot;, &quot;00ff00&quot;, &quot;008000&quot;, &quot;0000ff&quot;], [&quot;c0c0c0&quot;, &quot;ffff00&quot;, &quot;ff00ff&quot;, &quot;000080&quot;], [&quot;808080&quot;, &quot;ff0000&quot;, &quot;800080&quot;, &quot;000000&quot;]]}, buildRendering:function () {
+	this.domNode = document.createElement(&quot;table&quot;);
+	dojo.html.disableSelection(this.domNode);
+	dojo.event.connect(this.domNode, &quot;onmousedown&quot;, function (e) {
+		e.preventDefault();
+	});
+	with (this.domNode) {
+		cellPadding = &quot;0&quot;;
+		cellSpacing = &quot;1&quot;;
+		border = &quot;1&quot;;
+		style.backgroundColor = &quot;white&quot;;
+	}
+	var colors = this._palettes[this.palette];
+	for (var i = 0; i &lt; colors.length; i++) {
+		var tr = this.domNode.insertRow(-1);
+		for (var j = 0; j &lt; colors[i].length; j++) {
+			if (colors[i][j].length == 3) {
+				colors[i][j] = colors[i][j].replace(/(.)(.)(.)/, &quot;$1$1$2$2$3$3&quot;);
+			}
+			var td = tr.insertCell(-1);
+			with (td.style) {
+				backgroundColor = &quot;#&quot; + colors[i][j];
+				border = &quot;1px solid gray&quot;;
+				width = height = &quot;15px&quot;;
+				fontSize = &quot;1px&quot;;
+			}
+			td.color = &quot;#&quot; + colors[i][j];
+			td.onmouseover = function (e) {
+				this.style.borderColor = &quot;white&quot;;
+			};
+			td.onmouseout = function (e) {
+				this.style.borderColor = &quot;gray&quot;;
+			};
+			dojo.event.connect(td, &quot;onmousedown&quot;, this, &quot;onClick&quot;);
+			td.innerHTML = &quot;&nbsp;&quot;;
+		}
+	}
+}, onClick:function (e) {
+	this.onColorSelect(e.currentTarget.color);
+	e.currentTarget.style.borderColor = &quot;gray&quot;;
+}, onColorSelect:function (color) {
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ComboBox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ComboBox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ComboBox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,558 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ComboBox&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.widget.html.stabile&quot;);
+dojo.require(&quot;dojo.widget.PopupContainer&quot;);
+dojo.declare(&quot;dojo.widget.incrementalComboBoxDataProvider&quot;, null, function (options) {
+	this.searchUrl = options.dataUrl;
+	this._cache = {};
+	this._inFlight = false;
+	this._lastRequest = null;
+	this.allowCache = false;
+}, {_addToCache:function (keyword, data) {
+	if (this.allowCache) {
+		this._cache[keyword] = data;
+	}
+}, startSearch:function (searchStr, callback) {
+	if (this._inFlight) {
+	}
+	var tss = encodeURIComponent(searchStr);
+	var realUrl = dojo.string.substituteParams(this.searchUrl, {&quot;searchString&quot;:tss});
+	var _this = this;
+	var request = this._lastRequest = dojo.io.bind({url:realUrl, method:&quot;get&quot;, mimetype:&quot;text/json&quot;, load:function (type, data, evt) {
+		_this._inFlight = false;
+		if (!dojo.lang.isArray(data)) {
+			var arrData = [];
+			for (var key in data) {
+				arrData.push([data[key], key]);
+			}
+			data = arrData;
+		}
+		_this._addToCache(searchStr, data);
+		if (request == _this._lastRequest) {
+			callback(data);
+		}
+	}});
+	this._inFlight = true;
+}});
+dojo.declare(&quot;dojo.widget.basicComboBoxDataProvider&quot;, null, function (options, node) {
+	this._data = [];
+	this.searchLimit = 30;
+	this.searchType = &quot;STARTSTRING&quot;;
+	this.caseSensitive = false;
+	if (!dj_undef(&quot;dataUrl&quot;, options) &amp;&amp; !dojo.string.isBlank(options.dataUrl)) {
+		this._getData(options.dataUrl);
+	} else {
+		if ((node) &amp;&amp; (node.nodeName.toLowerCase() == &quot;select&quot;)) {
+			var opts = node.getElementsByTagName(&quot;option&quot;);
+			var ol = opts.length;
+			var data = [];
+			for (var x = 0; x &lt; ol; x++) {
+				var text = opts[x].textContent || opts[x].innerText || opts[x].innerHTML;
+				var keyValArr = [String(text), String(opts[x].value)];
+				data.push(keyValArr);
+				if (opts[x].selected) {
+					options.setAllValues(keyValArr[0], keyValArr[1]);
+				}
+			}
+			this.setData(data);
+		}
+	}
+}, {_getData:function (url) {
+	dojo.io.bind({url:url, load:dojo.lang.hitch(this, function (type, data, evt) {
+		if (!dojo.lang.isArray(data)) {
+			var arrData = [];
+			for (var key in data) {
+				arrData.push([data[key], key]);
+			}
+			data = arrData;
+		}
+		this.setData(data);
+	}), mimetype:&quot;text/json&quot;});
+}, startSearch:function (searchStr, callback) {
+	this._performSearch(searchStr, callback);
+}, _performSearch:function (searchStr, callback) {
+	var st = this.searchType;
+	var ret = [];
+	if (!this.caseSensitive) {
+		searchStr = searchStr.toLowerCase();
+	}
+	for (var x = 0; x &lt; this._data.length; x++) {
+		if ((this.searchLimit &gt; 0) &amp;&amp; (ret.length &gt;= this.searchLimit)) {
+			break;
+		}
+		var dataLabel = new String((!this.caseSensitive) ? this._data[x][0].toLowerCase() : this._data[x][0]);
+		if (dataLabel.length &lt; searchStr.length) {
+			continue;
+		}
+		if (st == &quot;STARTSTRING&quot;) {
+			if (searchStr == dataLabel.substr(0, searchStr.length)) {
+				ret.push(this._data[x]);
+			}
+		} else {
+			if (st == &quot;SUBSTRING&quot;) {
+				if (dataLabel.indexOf(searchStr) &gt;= 0) {
+					ret.push(this._data[x]);
+				}
+			} else {
+				if (st == &quot;STARTWORD&quot;) {
+					var idx = dataLabel.indexOf(searchStr);
+					if (idx == 0) {
+						ret.push(this._data[x]);
+					}
+					if (idx &lt;= 0) {
+						continue;
+					}
+					var matches = false;
+					while (idx != -1) {
+						if (&quot; ,/(&quot;.indexOf(dataLabel.charAt(idx - 1)) != -1) {
+							matches = true;
+							break;
+						}
+						idx = dataLabel.indexOf(searchStr, idx + 1);
+					}
+					if (!matches) {
+						continue;
+					} else {
+						ret.push(this._data[x]);
+					}
+				}
+			}
+		}
+	}
+	callback(ret);
+}, setData:function (pdata) {
+	this._data = pdata;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ComboBox&quot;, dojo.widget.HtmlWidget, {forceValidOption:false, searchType:&quot;stringstart&quot;, dataProvider:null, autoComplete:true, searchDelay:100, dataUrl:&quot;&quot;, fadeTime:200, maxListLength:8, mode:&quot;local&quot;, selectedResult:null, dataProviderClass:&quot;&quot;, buttonSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/combo_box_arrow.png&quot;), dropdownToggle:&quot;fade&quot;, templateString:&quot;&lt;span _=\&quot;whitespace and CR's between tags adds &nbsp; in FF\&quot;\n\tclass=\&quot;dojoComboBoxOuter\&quot;\n\t&gt;&lt;input style=\&quot;display:none\&quot;  tabindex=\&quot;-1\&quot; name=\&quot;\&quot; value=\&quot;\&quot; \n\t\tdojoAttachPoint=\&quot;comboBoxValue\&quot;\n\t&gt;&lt;input style=\&quot;display:none\&quot;  tabindex=\&quot;-1\&quot; name=\&quot;\&quot; value=\&quot;\&quot; \n\t\tdojoAttachPoint=\&quot;comboBoxSelectionValue\&quot;\n\t&gt;&lt;input type=\&quot;text\&quot; autocomplete=\&quot;off\&quot; class=\&quot;dojoComboBox\&quot;\n\t\tdojoAttachEvent=\&quot;key:_handleKeyEvents; keyUp: onKeyUp; compositionEnd; onResize;\&quot;\n\t\tdojoAttachPoint=\&quot;textInputNode\&quot;\n\t&gt;&lt;img hspace=\&quot;0\&quot;\n\t\tvspace=\&quot;0\&quot;\n\t\tclass=\&quot;dojoComb!
 oBox\&quot;\n\t\tdojoAttachPoint=\&quot;downArrowNode\&quot;\n\t\tdojoAttachEvent=\&quot;onMouseUp: handleArrowClick; onResize;\&quot;\n\t\tsrc=\&quot;${this.buttonSrc}\&quot;\n&gt;&lt;/span&gt;\n&quot;, templateCssString:&quot;.dojoComboBoxOuter {\n\tborder: 0px !important;\n\tmargin: 0px !important;\n\tpadding: 0px !important;\n\tbackground: transparent !important;\n\twhite-space: nowrap !important;\n}\n\n.dojoComboBox {\n\tborder: 1px inset #afafaf;\n\tmargin: 0px;\n\tpadding: 0px;\n\tvertical-align: middle !important;\n\tfloat: none !important;\n\tposition: static !important;\n\tdisplay: inline !important;\n}\n\n/* the input box */\ninput.dojoComboBox {\n\tborder-right-width: 0px !important; \n\tmargin-right: 0px !important;\n\tpadding-right: 0px !important;\n}\n\n/* the down arrow */\nimg.dojoComboBox {\n\tborder-left-width: 0px !important;\n\tpadding-left: 0px !important;\n\tmargin-left: 0px !important;\n}\n\n/* IE vertical-alignment calculations can be off by +-1 but these margins are collapsed away */\n.dj_ie img.dojoC!
 omboBox {\n\tmargin-top: 1px; \n\tmargin-bottom: 1px; \n}\n\n/!
 * the dr
op down */\n.dojoComboBoxOptions {\n\tfont-family: Verdana, Helvetica, Garamond, sans-serif;\n\t/* font-size: 0.7em; */\n\tbackground-color: white;\n\tborder: 1px solid #afafaf;\n\tposition: absolute;\n\tz-index: 1000; \n\toverflow: auto;\n\tcursor: default;\n}\n\n.dojoComboBoxItem {\n\tpadding-left: 2px;\n\tpadding-top: 2px;\n\tmargin: 0px;\n}\n\n.dojoComboBoxItemEven {\n\tbackground-color: #f4f4f4;\n}\n\n.dojoComboBoxItemOdd {\n\tbackground-color: white;\n}\n\n.dojoComboBoxItemHighlight {\n\tbackground-color: #63709A;\n\tcolor: white;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/ComboBox.css&quot;), setValue:function (value) {
+	this.comboBoxValue.value = value;
+	if (this.textInputNode.value != value) {
+		this.textInputNode.value = value;
+		dojo.widget.html.stabile.setState(this.widgetId, this.getState(), true);
+		this.onValueChanged(value);
+	}
+}, onValueChanged:function (value) {
+}, getValue:function () {
+	return this.comboBoxValue.value;
+}, getState:function () {
+	return {value:this.getValue()};
+}, setState:function (state) {
+	this.setValue(state.value);
+}, enable:function () {
+	this.disabled = false;
+	this.textInputNode.removeAttribute(&quot;disabled&quot;);
+}, disable:function () {
+	this.disabled = true;
+	this.textInputNode.setAttribute(&quot;disabled&quot;, true);
+}, _getCaretPos:function (element) {
+	if (dojo.lang.isNumber(element.selectionStart)) {
+		return element.selectionStart;
+	} else {
+		if (dojo.render.html.ie) {
+			var tr = document.selection.createRange().duplicate();
+			var ntr = element.createTextRange();
+			tr.move(&quot;character&quot;, 0);
+			ntr.move(&quot;character&quot;, 0);
+			try {
+				ntr.setEndPoint(&quot;EndToEnd&quot;, tr);
+				return String(ntr.text).replace(/\r/g, &quot;&quot;).length;
+			}
+			catch (e) {
+				return 0;
+			}
+		}
+	}
+}, _setCaretPos:function (element, location) {
+	location = parseInt(location);
+	this._setSelectedRange(element, location, location);
+}, _setSelectedRange:function (element, start, end) {
+	if (!end) {
+		end = element.value.length;
+	}
+	if (element.setSelectionRange) {
+		element.focus();
+		element.setSelectionRange(start, end);
+	} else {
+		if (element.createTextRange) {
+			var range = element.createTextRange();
+			with (range) {
+				collapse(true);
+				moveEnd(&quot;character&quot;, end);
+				moveStart(&quot;character&quot;, start);
+				select();
+			}
+		} else {
+			element.value = element.value;
+			element.blur();
+			element.focus();
+			var dist = parseInt(element.value.length) - end;
+			var tchar = String.fromCharCode(37);
+			var tcc = tchar.charCodeAt(0);
+			for (var x = 0; x &lt; dist; x++) {
+				var te = document.createEvent(&quot;KeyEvents&quot;);
+				te.initKeyEvent(&quot;keypress&quot;, true, true, null, false, false, false, false, tcc, tcc);
+				element.dispatchEvent(te);
+			}
+		}
+	}
+}, _handleKeyEvents:function (evt) {
+	if (evt.ctrlKey || evt.altKey || !evt.key) {
+		return;
+	}
+	this._prev_key_backspace = false;
+	this._prev_key_esc = false;
+	var k = dojo.event.browser.keys;
+	var doSearch = true;
+	switch (evt.key) {
+	  case k.KEY_DOWN_ARROW:
+		if (!this.popupWidget.isShowingNow) {
+			this._startSearchFromInput();
+		}
+		this._highlightNextOption();
+		dojo.event.browser.stopEvent(evt);
+		return;
+	  case k.KEY_UP_ARROW:
+		this._highlightPrevOption();
+		dojo.event.browser.stopEvent(evt);
+		return;
+	  case k.KEY_TAB:
+		if (!this.autoComplete &amp;&amp; this.popupWidget.isShowingNow &amp;&amp; this._highlighted_option) {
+			dojo.event.browser.stopEvent(evt);
+			this._selectOption({&quot;target&quot;:this._highlighted_option, &quot;noHide&quot;:false});
+			this._setSelectedRange(this.textInputNode, this.textInputNode.value.length, null);
+		} else {
+			this._selectOption();
+			return;
+		}
+		break;
+	  case k.KEY_ENTER:
+		if (this.popupWidget.isShowingNow) {
+			dojo.event.browser.stopEvent(evt);
+		}
+		if (this.autoComplete) {
+			this._selectOption();
+			return;
+		}
+	  case &quot; &quot;:
+		if (this.popupWidget.isShowingNow &amp;&amp; this._highlighted_option) {
+			dojo.event.browser.stopEvent(evt);
+			this._selectOption();
+			this._hideResultList();
+			return;
+		}
+		break;
+	  case k.KEY_ESCAPE:
+		this._hideResultList();
+		this._prev_key_esc = true;
+		return;
+	  case k.KEY_BACKSPACE:
+		this._prev_key_backspace = true;
+		if (!this.textInputNode.value.length) {
+			this.setAllValues(&quot;&quot;, &quot;&quot;);
+			this._hideResultList();
+			doSearch = false;
+		}
+		break;
+	  case k.KEY_RIGHT_ARROW:
+	  case k.KEY_LEFT_ARROW:
+		doSearch = false;
+		break;
+	  default:
+		if (evt.charCode == 0) {
+			doSearch = false;
+		}
+	}
+	if (this.searchTimer) {
+		clearTimeout(this.searchTimer);
+	}
+	if (doSearch) {
+		this._blurOptionNode();
+		this.searchTimer = setTimeout(dojo.lang.hitch(this, this._startSearchFromInput), this.searchDelay);
+	}
+}, compositionEnd:function (evt) {
+	evt.key = evt.keyCode;
+	this._handleKeyEvents(evt);
+}, onKeyUp:function (evt) {
+	this.setValue(this.textInputNode.value);
+}, setSelectedValue:function (value) {
+	this.comboBoxSelectionValue.value = value;
+}, setAllValues:function (value1, value2) {
+	this.setSelectedValue(value2);
+	this.setValue(value1);
+}, _focusOptionNode:function (node) {
+	if (this._highlighted_option != node) {
+		this._blurOptionNode();
+		this._highlighted_option = node;
+		dojo.html.addClass(this._highlighted_option, &quot;dojoComboBoxItemHighlight&quot;);
+	}
+}, _blurOptionNode:function () {
+	if (this._highlighted_option) {
+		dojo.html.removeClass(this._highlighted_option, &quot;dojoComboBoxItemHighlight&quot;);
+		this._highlighted_option = null;
+	}
+}, _highlightNextOption:function () {
+	if ((!this._highlighted_option) || !this._highlighted_option.parentNode) {
+		this._focusOptionNode(this.optionsListNode.firstChild);
+	} else {
+		if (this._highlighted_option.nextSibling) {
+			this._focusOptionNode(this._highlighted_option.nextSibling);
+		}
+	}
+	dojo.html.scrollIntoView(this._highlighted_option);
+}, _highlightPrevOption:function () {
+	if (this._highlighted_option &amp;&amp; this._highlighted_option.previousSibling) {
+		this._focusOptionNode(this._highlighted_option.previousSibling);
+	} else {
+		this._highlighted_option = null;
+		this._hideResultList();
+		return;
+	}
+	dojo.html.scrollIntoView(this._highlighted_option);
+}, _itemMouseOver:function (evt) {
+	if (evt.target === this.optionsListNode) {
+		return;
+	}
+	this._focusOptionNode(evt.target);
+	dojo.html.addClass(this._highlighted_option, &quot;dojoComboBoxItemHighlight&quot;);
+}, _itemMouseOut:function (evt) {
+	if (evt.target === this.optionsListNode) {
+		return;
+	}
+	this._blurOptionNode();
+}, onResize:function () {
+	var inputSize = dojo.html.getContentBox(this.textInputNode);
+	if (inputSize.height &lt;= 0) {
+		dojo.lang.setTimeout(this, &quot;onResize&quot;, 100);
+		return;
+	}
+	var buttonSize = {width:inputSize.height, height:inputSize.height};
+	dojo.html.setContentBox(this.downArrowNode, buttonSize);
+}, fillInTemplate:function (args, frag) {
+	dojo.html.applyBrowserClass(this.domNode);
+	var source = this.getFragNodeRef(frag);
+	if (!this.name &amp;&amp; source.name) {
+		this.name = source.name;
+	}
+	this.comboBoxValue.name = this.name;
+	this.comboBoxSelectionValue.name = this.name + &quot;_selected&quot;;
+	dojo.html.copyStyle(this.domNode, source);
+	dojo.html.copyStyle(this.textInputNode, source);
+	dojo.html.copyStyle(this.downArrowNode, source);
+	with (this.downArrowNode.style) {
+		width = &quot;0px&quot;;
+		height = &quot;0px&quot;;
+	}
+	var dpClass;
+	if (this.dataProviderClass) {
+		if (typeof this.dataProviderClass == &quot;string&quot;) {
+			dpClass = dojo.evalObjPath(this.dataProviderClass);
+		} else {
+			dpClass = this.dataProviderClass;
+		}
+	} else {
+		if (this.mode == &quot;remote&quot;) {
+			dpClass = dojo.widget.incrementalComboBoxDataProvider;
+		} else {
+			dpClass = dojo.widget.basicComboBoxDataProvider;
+		}
+	}
+	this.dataProvider = new dpClass(this, this.getFragNodeRef(frag));
+	this.popupWidget = new dojo.widget.createWidget(&quot;PopupContainer&quot;, {toggle:this.dropdownToggle, toggleDuration:this.toggleDuration});
+	dojo.event.connect(this, &quot;destroy&quot;, this.popupWidget, &quot;destroy&quot;);
+	this.optionsListNode = this.popupWidget.domNode;
+	this.domNode.appendChild(this.optionsListNode);
+	dojo.html.addClass(this.optionsListNode, &quot;dojoComboBoxOptions&quot;);
+	dojo.event.connect(this.optionsListNode, &quot;onclick&quot;, this, &quot;_selectOption&quot;);
+	dojo.event.connect(this.optionsListNode, &quot;onmouseover&quot;, this, &quot;_onMouseOver&quot;);
+	dojo.event.connect(this.optionsListNode, &quot;onmouseout&quot;, this, &quot;_onMouseOut&quot;);
+	dojo.event.connect(this.optionsListNode, &quot;onmouseover&quot;, this, &quot;_itemMouseOver&quot;);
+	dojo.event.connect(this.optionsListNode, &quot;onmouseout&quot;, this, &quot;_itemMouseOut&quot;);
+}, _openResultList:function (results) {
+	if (this.disabled) {
+		return;
+	}
+	this._clearResultList();
+	if (!results.length) {
+		this._hideResultList();
+	}
+	if ((this.autoComplete) &amp;&amp; (results.length) &amp;&amp; (!this._prev_key_backspace) &amp;&amp; (this.textInputNode.value.length &gt; 0)) {
+		var cpos = this._getCaretPos(this.textInputNode);
+		if ((cpos + 1) &gt; this.textInputNode.value.length) {
+			this.textInputNode.value += results[0][0].substr(cpos);
+			this._setSelectedRange(this.textInputNode, cpos, this.textInputNode.value.length);
+		}
+	}
+	var even = true;
+	while (results.length) {
+		var tr = results.shift();
+		if (tr) {
+			var td = document.createElement(&quot;div&quot;);
+			td.appendChild(document.createTextNode(tr[0]));
+			td.setAttribute(&quot;resultName&quot;, tr[0]);
+			td.setAttribute(&quot;resultValue&quot;, tr[1]);
+			td.className = &quot;dojoComboBoxItem &quot; + ((even) ? &quot;dojoComboBoxItemEven&quot; : &quot;dojoComboBoxItemOdd&quot;);
+			even = (!even);
+			this.optionsListNode.appendChild(td);
+		}
+	}
+	this._showResultList();
+}, _onFocusInput:function () {
+	this._hasFocus = true;
+}, _onBlurInput:function () {
+	this._hasFocus = false;
+	this._handleBlurTimer(true, 500);
+}, _handleBlurTimer:function (clear, millisec) {
+	if (this.blurTimer &amp;&amp; (clear || millisec)) {
+		clearTimeout(this.blurTimer);
+	}
+	if (millisec) {
+		this.blurTimer = dojo.lang.setTimeout(this, &quot;_checkBlurred&quot;, millisec);
+	}
+}, _onMouseOver:function (evt) {
+	if (!this._mouseover_list) {
+		this._handleBlurTimer(true, 0);
+		this._mouseover_list = true;
+	}
+}, _onMouseOut:function (evt) {
+	var relTarget = evt.relatedTarget;
+	try {
+		if (!relTarget || relTarget.parentNode != this.optionsListNode) {
+			this._mouseover_list = false;
+			this._handleBlurTimer(true, 100);
+			this._tryFocus();
+		}
+	}
+	catch (e) {
+	}
+}, _isInputEqualToResult:function (result) {
+	var input = this.textInputNode.value;
+	if (!this.dataProvider.caseSensitive) {
+		input = input.toLowerCase();
+		result = result.toLowerCase();
+	}
+	return (input == result);
+}, _isValidOption:function () {
+	var tgt = dojo.html.firstElement(this.optionsListNode);
+	var isValidOption = false;
+	while (!isValidOption &amp;&amp; tgt) {
+		if (this._isInputEqualToResult(tgt.getAttribute(&quot;resultName&quot;))) {
+			isValidOption = true;
+		} else {
+			tgt = dojo.html.nextElement(tgt);
+		}
+	}
+	return isValidOption;
+}, _checkBlurred:function () {
+	if (!this._hasFocus &amp;&amp; !this._mouseover_list) {
+		this._hideResultList();
+		if (!this.textInputNode.value.length) {
+			this.setAllValues(&quot;&quot;, &quot;&quot;);
+			return;
+		}
+		var isValidOption = this._isValidOption();
+		if (this.forceValidOption &amp;&amp; !isValidOption) {
+			this.setAllValues(&quot;&quot;, &quot;&quot;);
+			return;
+		}
+		if (!isValidOption) {
+			this.setSelectedValue(&quot;&quot;);
+		}
+	}
+}, _selectOption:function (evt) {
+	var tgt = null;
+	if (!evt) {
+		evt = {target:this._highlighted_option};
+	}
+	if (!dojo.html.isDescendantOf(evt.target, this.optionsListNode)) {
+		if (!this.textInputNode.value.length) {
+			return;
+		}
+		tgt = dojo.html.firstElement(this.optionsListNode);
+		if (!tgt || !this._isInputEqualToResult(tgt.getAttribute(&quot;resultName&quot;))) {
+			return;
+		}
+	} else {
+		tgt = evt.target;
+	}
+	while ((tgt.nodeType != 1) || (!tgt.getAttribute(&quot;resultName&quot;))) {
+		tgt = tgt.parentNode;
+		if (tgt === dojo.body()) {
+			return false;
+		}
+	}
+	this.selectedResult = [tgt.getAttribute(&quot;resultName&quot;), tgt.getAttribute(&quot;resultValue&quot;)];
+	this.setAllValues(tgt.getAttribute(&quot;resultName&quot;), tgt.getAttribute(&quot;resultValue&quot;));
+	if (!evt.noHide) {
+		this._hideResultList();
+		this._setSelectedRange(this.textInputNode, 0, null);
+	}
+	this._tryFocus();
+}, _clearResultList:function () {
+	if (this.optionsListNode.innerHTML) {
+		this.optionsListNode.innerHTML = &quot;&quot;;
+	}
+}, _hideResultList:function () {
+	this.popupWidget.close();
+}, _showResultList:function () {
+	var childs = this.optionsListNode.childNodes;
+	if (childs.length) {
+		var visibleCount = Math.min(childs.length, this.maxListLength);
+		with (this.optionsListNode.style) {
+			display = &quot;&quot;;
+			if (visibleCount == childs.length) {
+				height = &quot;&quot;;
+			} else {
+				height = visibleCount * dojo.html.getMarginBox(childs[0]).height + &quot;px&quot;;
+			}
+			width = (dojo.html.getMarginBox(this.domNode).width - 2) + &quot;px&quot;;
+		}
+		this.popupWidget.open(this.domNode, this, this.downArrowNode);
+	} else {
+		this._hideResultList();
+	}
+}, handleArrowClick:function () {
+	this._handleBlurTimer(true, 0);
+	this._tryFocus();
+	if (this.popupWidget.isShowingNow) {
+		this._hideResultList();
+	} else {
+		this._startSearch(&quot;&quot;);
+	}
+}, _tryFocus:function () {
+	try {
+		this.textInputNode.focus();
+	}
+	catch (e) {
+	}
+}, _startSearchFromInput:function () {
+	this._startSearch(this.textInputNode.value);
+}, _startSearch:function (key) {
+	this.dataProvider.startSearch(key, dojo.lang.hitch(this, &quot;_openResultList&quot;));
+}, postCreate:function () {
+	this.onResize();
+	dojo.event.connect(this.textInputNode, &quot;onblur&quot;, this, &quot;_onBlurInput&quot;);
+	dojo.event.connect(this.textInputNode, &quot;onfocus&quot;, this, &quot;_onFocusInput&quot;);
+	if (this.disabled) {
+		this.disable();
+	}
+	var s = dojo.widget.html.stabile.getState(this.widgetId);
+	if (s) {
+		this.setState(s);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ContentPane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ContentPane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ContentPane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,441 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ContentPane&quot;, dojo.widget.HtmlWidget, function () {
+	this._styleNodes = [];
+	this._onLoadStack = [];
+	this._onUnloadStack = [];
+	this._callOnUnload = false;
+	this._ioBindObj;
+	this.scriptScope;
+	this.bindArgs = {};
+}, {isContainer:true, adjustPaths:true, href:&quot;&quot;, extractContent:true, parseContent:true, cacheContent:true, preload:false, refreshOnShow:false, handler:&quot;&quot;, executeScripts:false, scriptSeparation:true, loadingMessage:&quot;Loading...&quot;, isLoaded:false, postCreate:function (args, frag, parentComp) {
+	if (this.handler !== &quot;&quot;) {
+		this.setHandler(this.handler);
+	}
+	if (this.isShowing() || this.preload) {
+		this.loadContents();
+	}
+}, show:function () {
+	if (this.refreshOnShow) {
+		this.refresh();
+	} else {
+		this.loadContents();
+	}
+	dojo.widget.ContentPane.superclass.show.call(this);
+}, refresh:function () {
+	this.isLoaded = false;
+	this.loadContents();
+}, loadContents:function () {
+	if (this.isLoaded) {
+		return;
+	}
+	if (dojo.lang.isFunction(this.handler)) {
+		this._runHandler();
+	} else {
+		if (this.href != &quot;&quot;) {
+			this._downloadExternalContent(this.href, this.cacheContent &amp;&amp; !this.refreshOnShow);
+		}
+	}
+}, setUrl:function (url) {
+	this.href = url;
+	this.isLoaded = false;
+	if (this.preload || this.isShowing()) {
+		this.loadContents();
+	}
+}, abort:function () {
+	var bind = this._ioBindObj;
+	if (!bind || !bind.abort) {
+		return;
+	}
+	bind.abort();
+	delete this._ioBindObj;
+}, _downloadExternalContent:function (url, useCache) {
+	this.abort();
+	this._handleDefaults(this.loadingMessage, &quot;onDownloadStart&quot;);
+	var self = this;
+	this._ioBindObj = dojo.io.bind(this._cacheSetting({url:url, mimetype:&quot;text/html&quot;, handler:function (type, data, xhr) {
+		delete self._ioBindObj;
+		if (type == &quot;load&quot;) {
+			self.onDownloadEnd.call(self, url, data);
+		} else {
+			var e = {responseText:xhr.responseText, status:xhr.status, statusText:xhr.statusText, responseHeaders:xhr.getAllResponseHeaders(), text:&quot;Error loading '&quot; + url + &quot;' (&quot; + xhr.status + &quot; &quot; + xhr.statusText + &quot;)&quot;};
+			self._handleDefaults.call(self, e, &quot;onDownloadError&quot;);
+			self.onLoad();
+		}
+	}}, useCache));
+}, _cacheSetting:function (bindObj, useCache) {
+	for (var x in this.bindArgs) {
+		if (dojo.lang.isUndefined(bindObj[x])) {
+			bindObj[x] = this.bindArgs[x];
+		}
+	}
+	if (dojo.lang.isUndefined(bindObj.useCache)) {
+		bindObj.useCache = useCache;
+	}
+	if (dojo.lang.isUndefined(bindObj.preventCache)) {
+		bindObj.preventCache = !useCache;
+	}
+	if (dojo.lang.isUndefined(bindObj.mimetype)) {
+		bindObj.mimetype = &quot;text/html&quot;;
+	}
+	return bindObj;
+}, onLoad:function (e) {
+	this._runStack(&quot;_onLoadStack&quot;);
+	this.isLoaded = true;
+}, onUnLoad:function (e) {
+	dojo.deprecated(this.widgetType + &quot;.onUnLoad, use .onUnload (lowercased load)&quot;, 0.5);
+}, onUnload:function (e) {
+	this._runStack(&quot;_onUnloadStack&quot;);
+	delete this.scriptScope;
+	if (this.onUnLoad !== dojo.widget.ContentPane.prototype.onUnLoad) {
+		this.onUnLoad.apply(this, arguments);
+	}
+}, _runStack:function (stName) {
+	var st = this[stName];
+	var err = &quot;&quot;;
+	var scope = this.scriptScope || window;
+	for (var i = 0; i &lt; st.length; i++) {
+		try {
+			st[i].call(scope);
+		}
+		catch (e) {
+			err += &quot;\n&quot; + st[i] + &quot; failed: &quot; + e.description;
+		}
+	}
+	this[stName] = [];
+	if (err.length) {
+		var name = (stName == &quot;_onLoadStack&quot;) ? &quot;addOnLoad&quot; : &quot;addOnUnLoad&quot;;
+		this._handleDefaults(name + &quot; failure\n &quot; + err, &quot;onExecError&quot;, &quot;debug&quot;);
+	}
+}, addOnLoad:function (obj, func) {
+	this._pushOnStack(this._onLoadStack, obj, func);
+}, addOnUnload:function (obj, func) {
+	this._pushOnStack(this._onUnloadStack, obj, func);
+}, addOnUnLoad:function () {
+	dojo.deprecated(this.widgetType + &quot;.addOnUnLoad, use addOnUnload instead. (lowercased Load)&quot;, 0.5);
+	this.addOnUnload.apply(this, arguments);
+}, _pushOnStack:function (stack, obj, func) {
+	if (typeof func == &quot;undefined&quot;) {
+		stack.push(obj);
+	} else {
+		stack.push(function () {
+			obj[func]();
+		});
+	}
+}, destroy:function () {
+	this.onUnload();
+	dojo.widget.ContentPane.superclass.destroy.call(this);
+}, onExecError:function (e) {
+}, onContentError:function (e) {
+}, onDownloadError:function (e) {
+}, onDownloadStart:function (e) {
+}, onDownloadEnd:function (url, data) {
+	data = this.splitAndFixPaths(data, url);
+	this.setContent(data);
+}, _handleDefaults:function (e, handler, messType) {
+	if (!handler) {
+		handler = &quot;onContentError&quot;;
+	}
+	if (dojo.lang.isString(e)) {
+		e = {text:e};
+	}
+	if (!e.text) {
+		e.text = e.toString();
+	}
+	e.toString = function () {
+		return this.text;
+	};
+	if (typeof e.returnValue != &quot;boolean&quot;) {
+		e.returnValue = true;
+	}
+	if (typeof e.preventDefault != &quot;function&quot;) {
+		e.preventDefault = function () {
+			this.returnValue = false;
+		};
+	}
+	this[handler](e);
+	if (e.returnValue) {
+		switch (messType) {
+		  case true:
+		  case &quot;alert&quot;:
+			alert(e.toString());
+			break;
+		  case &quot;debug&quot;:
+			dojo.debug(e.toString());
+			break;
+		  default:
+			if (this._callOnUnload) {
+				this.onUnload();
+			}
+			this._callOnUnload = false;
+			if (arguments.callee._loopStop) {
+				dojo.debug(e.toString());
+			} else {
+				arguments.callee._loopStop = true;
+				this._setContent(e.toString());
+			}
+		}
+	}
+	arguments.callee._loopStop = false;
+}, splitAndFixPaths:function (s, url) {
+	var titles = [], scripts = [], tmp = [];
+	var match = [], requires = [], attr = [], styles = [];
+	var str = &quot;&quot;, path = &quot;&quot;, fix = &quot;&quot;, tagFix = &quot;&quot;, tag = &quot;&quot;, origPath = &quot;&quot;;
+	if (!url) {
+		url = &quot;./&quot;;
+	}
+	if (s) {
+		var regex = /&lt;title[^&gt;]*&gt;([\s\S]*?)&lt;\/title&gt;/i;
+		while (match = regex.exec(s)) {
+			titles.push(match[1]);
+			s = s.substring(0, match.index) + s.substr(match.index + match[0].length);
+		}
+		if (this.adjustPaths) {
+			var regexFindTag = /&lt;[a-z][a-z0-9]*[^&gt;]*\s(?:(?:src|href|style)=[^&gt;])+[^&gt;]*&gt;/i;
+			var regexFindAttr = /\s(src|href|style)=(['&quot;]?)([\w()\[\]\/.,\\'&quot;-:;#=&amp;?\s@]+?)\2/i;
+			var regexProtocols = /^(?:[#]|(?:(?:https?|ftps?|file|javascript|mailto|news):))/;
+			while (tag = regexFindTag.exec(s)) {
+				str += s.substring(0, tag.index);
+				s = s.substring((tag.index + tag[0].length), s.length);
+				tag = tag[0];
+				tagFix = &quot;&quot;;
+				while (attr = regexFindAttr.exec(tag)) {
+					path = &quot;&quot;;
+					origPath = attr[3];
+					switch (attr[1].toLowerCase()) {
+					  case &quot;src&quot;:
+					  case &quot;href&quot;:
+						if (regexProtocols.exec(origPath)) {
+							path = origPath;
+						} else {
+							path = (new dojo.uri.Uri(url, origPath).toString());
+						}
+						break;
+					  case &quot;style&quot;:
+						path = dojo.html.fixPathsInCssText(origPath, url);
+						break;
+					  default:
+						path = origPath;
+					}
+					fix = &quot; &quot; + attr[1] + &quot;=&quot; + attr[2] + path + attr[2];
+					tagFix += tag.substring(0, attr.index) + fix;
+					tag = tag.substring((attr.index + attr[0].length), tag.length);
+				}
+				str += tagFix + tag;
+			}
+			s = str + s;
+		}
+		regex = /(?:&lt;(style)[^&gt;]*&gt;([\s\S]*?)&lt;\/style&gt;|&lt;link ([^&gt;]*rel=['&quot;]?stylesheet['&quot;]?[^&gt;]*)&gt;)/i;
+		while (match = regex.exec(s)) {
+			if (match[1] &amp;&amp; match[1].toLowerCase() == &quot;style&quot;) {
+				styles.push(dojo.html.fixPathsInCssText(match[2], url));
+			} else {
+				if (attr = match[3].match(/href=(['&quot;]?)([^'&quot;&gt;]*)\1/i)) {
+					styles.push({path:attr[2]});
+				}
+			}
+			s = s.substring(0, match.index) + s.substr(match.index + match[0].length);
+		}
+		var regex = /&lt;script([^&gt;]*)&gt;([\s\S]*?)&lt;\/script&gt;/i;
+		var regexSrc = /src=(['&quot;]?)([^&quot;']*)\1/i;
+		var regexDojoJs = /.*(\bdojo\b\.js(?:\.uncompressed\.js)?)$/;
+		var regexInvalid = /(?:var )?\bdjConfig\b(?:[\s]*=[\s]*\{[^}]+\}|\.[\w]*[\s]*=[\s]*[^;\n]*)?;?|dojo\.hostenv\.writeIncludes\(\s*\);?/g;
+		var regexRequires = /dojo\.(?:(?:require(?:After)?(?:If)?)|(?:widget\.(?:manager\.)?registerWidgetPackage)|(?:(?:hostenv\.)?setModulePrefix|registerModulePath)|defineNamespace)\((['&quot;]).*?\1\)\s*;?/;
+		while (match = regex.exec(s)) {
+			if (this.executeScripts &amp;&amp; match[1]) {
+				if (attr = regexSrc.exec(match[1])) {
+					if (regexDojoJs.exec(attr[2])) {
+						dojo.debug(&quot;Security note! inhibit:&quot; + attr[2] + &quot; from  being loaded again.&quot;);
+					} else {
+						scripts.push({path:attr[2]});
+					}
+				}
+			}
+			if (match[2]) {
+				var sc = match[2].replace(regexInvalid, &quot;&quot;);
+				if (!sc) {
+					continue;
+				}
+				while (tmp = regexRequires.exec(sc)) {
+					requires.push(tmp[0]);
+					sc = sc.substring(0, tmp.index) + sc.substr(tmp.index + tmp[0].length);
+				}
+				if (this.executeScripts) {
+					scripts.push(sc);
+				}
+			}
+			s = s.substr(0, match.index) + s.substr(match.index + match[0].length);
+		}
+		if (this.extractContent) {
+			match = s.match(/&lt;body[^&gt;]*&gt;\s*([\s\S]+)\s*&lt;\/body&gt;/im);
+			if (match) {
+				s = match[1];
+			}
+		}
+		if (this.executeScripts &amp;&amp; this.scriptSeparation) {
+			var regex = /(&lt;[a-zA-Z][a-zA-Z0-9]*\s[^&gt;]*?\S=)((['&quot;])[^&gt;]*scriptScope[^&gt;]*&gt;)/;
+			var regexAttr = /([\s'&quot;;:\(])scriptScope(.*)/;
+			str = &quot;&quot;;
+			while (tag = regex.exec(s)) {
+				tmp = ((tag[3] == &quot;'&quot;) ? &quot;\&quot;&quot; : &quot;'&quot;);
+				fix = &quot;&quot;;
+				str += s.substring(0, tag.index) + tag[1];
+				while (attr = regexAttr.exec(tag[2])) {
+					tag[2] = tag[2].substring(0, attr.index) + attr[1] + &quot;dojo.widget.byId(&quot; + tmp + this.widgetId + tmp + &quot;).scriptScope&quot; + attr[2];
+				}
+				str += tag[2];
+				s = s.substr(tag.index + tag[0].length);
+			}
+			s = str + s;
+		}
+	}
+	return {&quot;xml&quot;:s, &quot;styles&quot;:styles, &quot;titles&quot;:titles, &quot;requires&quot;:requires, &quot;scripts&quot;:scripts, &quot;url&quot;:url};
+}, _setContent:function (cont) {
+	this.destroyChildren();
+	for (var i = 0; i &lt; this._styleNodes.length; i++) {
+		if (this._styleNodes[i] &amp;&amp; this._styleNodes[i].parentNode) {
+			this._styleNodes[i].parentNode.removeChild(this._styleNodes[i]);
+		}
+	}
+	this._styleNodes = [];
+	try {
+		var node = this.containerNode || this.domNode;
+		while (node.firstChild) {
+			dojo.html.destroyNode(node.firstChild);
+		}
+		if (typeof cont != &quot;string&quot;) {
+			node.appendChild(cont);
+		} else {
+			node.innerHTML = cont;
+		}
+	}
+	catch (e) {
+		e.text = &quot;Couldn't load content:&quot; + e.description;
+		this._handleDefaults(e, &quot;onContentError&quot;);
+	}
+}, setContent:function (data) {
+	this.abort();
+	if (this._callOnUnload) {
+		this.onUnload();
+	}
+	this._callOnUnload = true;
+	if (!data || dojo.html.isNode(data)) {
+		this._setContent(data);
+		this.onResized();
+		this.onLoad();
+	} else {
+		if (typeof data.xml != &quot;string&quot;) {
+			this.href = &quot;&quot;;
+			data = this.splitAndFixPaths(data);
+		}
+		this._setContent(data.xml);
+		for (var i = 0; i &lt; data.styles.length; i++) {
+			if (data.styles[i].path) {
+				this._styleNodes.push(dojo.html.insertCssFile(data.styles[i].path, dojo.doc(), false, true));
+			} else {
+				this._styleNodes.push(dojo.html.insertCssText(data.styles[i]));
+			}
+		}
+		if (this.parseContent) {
+			for (var i = 0; i &lt; data.requires.length; i++) {
+				try {
+					eval(data.requires[i]);
+				}
+				catch (e) {
+					e.text = &quot;ContentPane: error in package loading calls, &quot; + (e.description || e);
+					this._handleDefaults(e, &quot;onContentError&quot;, &quot;debug&quot;);
+				}
+			}
+		}
+		var _self = this;
+		function asyncParse() {
+			if (_self.executeScripts) {
+				_self._executeScripts(data.scripts);
+			}
+			if (_self.parseContent) {
+				var node = _self.containerNode || _self.domNode;
+				var parser = new dojo.xml.Parse();
+				var frag = parser.parseElement(node, null, true);
+				dojo.widget.getParser().createSubComponents(frag, _self);
+			}
+			_self.onResized();
+			_self.onLoad();
+		}
+		if (dojo.hostenv.isXDomain &amp;&amp; data.requires.length) {
+			dojo.addOnLoad(asyncParse);
+		} else {
+			asyncParse();
+		}
+	}
+}, setHandler:function (handler) {
+	var fcn = dojo.lang.isFunction(handler) ? handler : window[handler];
+	if (!dojo.lang.isFunction(fcn)) {
+		this._handleDefaults(&quot;Unable to set handler, '&quot; + handler + &quot;' not a function.&quot;, &quot;onExecError&quot;, true);
+		return;
+	}
+	this.handler = function () {
+		return fcn.apply(this, arguments);
+	};
+}, _runHandler:function () {
+	var ret = true;
+	if (dojo.lang.isFunction(this.handler)) {
+		this.handler(this, this.domNode);
+		ret = false;
+	}
+	this.onLoad();
+	return ret;
+}, _executeScripts:function (scripts) {
+	var self = this;
+	var tmp = &quot;&quot;, code = &quot;&quot;;
+	for (var i = 0; i &lt; scripts.length; i++) {
+		if (scripts[i].path) {
+			dojo.io.bind(this._cacheSetting({&quot;url&quot;:scripts[i].path, &quot;load&quot;:function (type, scriptStr) {
+				dojo.lang.hitch(self, tmp = &quot;;&quot; + scriptStr);
+			}, &quot;error&quot;:function (type, error) {
+				error.text = type + &quot; downloading remote script&quot;;
+				self._handleDefaults.call(self, error, &quot;onExecError&quot;, &quot;debug&quot;);
+			}, &quot;mimetype&quot;:&quot;text/plain&quot;, &quot;sync&quot;:true}, this.cacheContent));
+			code += tmp;
+		} else {
+			code += scripts[i];
+		}
+	}
+	try {
+		if (this.scriptSeparation) {
+			delete this.scriptScope;
+			this.scriptScope = new (new Function(&quot;_container_&quot;, code + &quot;; return this;&quot;))(self);
+		} else {
+			var djg = dojo.global();
+			if (djg.execScript) {
+				djg.execScript(code);
+			} else {
+				var djd = dojo.doc();
+				var sc = djd.createElement(&quot;script&quot;);
+				sc.appendChild(djd.createTextNode(code));
+				(this.containerNode || this.domNode).appendChild(sc);
+			}
+		}
+	}
+	catch (e) {
+		e.text = &quot;Error running scripts from content:\n&quot; + e.description;
+		this._handleDefaults(e, &quot;onExecError&quot;, &quot;debug&quot;);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/CurrencyTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/CurrencyTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/CurrencyTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,40 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.CurrencyTextbox&quot;);
+dojo.require(&quot;dojo.widget.IntegerTextbox&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.CurrencyTextbox&quot;, dojo.widget.IntegerTextbox, {mixInProperties:function (localProperties, frag) {
+	dojo.widget.CurrencyTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.fractional) {
+		this.flags.fractional = (localProperties.fractional == &quot;true&quot;);
+	} else {
+		if (localProperties.cents) {
+			dojo.deprecated(&quot;dojo.widget.IntegerTextbox&quot;, &quot;use fractional attr instead of cents&quot;, &quot;0.5&quot;);
+			this.flags.fractional = (localProperties.cents == &quot;true&quot;);
+		}
+	}
+	if (localProperties.symbol) {
+		this.flags.symbol = localProperties.symbol;
+	}
+	if (localProperties.min) {
+		this.flags.min = parseFloat(localProperties.min);
+	}
+	if (localProperties.max) {
+		this.flags.max = parseFloat(localProperties.max);
+	}
+}, isValid:function () {
+	return dojo.validate.isCurrency(this.textbox.value, this.flags);
+}, isInRange:function () {
+	return dojo.validate.isInRange(this.textbox.value, this.flags);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DatePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DatePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DatePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,349 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DatePicker&quot;);
+dojo.require(&quot;dojo.date.common&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.date.serialize&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.DatePicker&quot;, dojo.widget.HtmlWidget, {value:&quot;&quot;, name:&quot;&quot;, displayWeeks:6, adjustWeeks:false, startDate:&quot;1492-10-12&quot;, endDate:&quot;2941-10-12&quot;, weekStartsOn:&quot;&quot;, staticDisplay:false, dayWidth:&quot;narrow&quot;, classNames:{previous:&quot;previousMonth&quot;, disabledPrevious:&quot;previousMonthDisabled&quot;, current:&quot;currentMonth&quot;, disabledCurrent:&quot;currentMonthDisabled&quot;, next:&quot;nextMonth&quot;, disabledNext:&quot;nextMonthDisabled&quot;, currentDate:&quot;currentDate&quot;, selectedDate:&quot;selectedDate&quot;}, templateString:&quot;&lt;div class=\&quot;datePickerContainer\&quot; dojoAttachPoint=\&quot;datePickerContainerNode\&quot;&gt;\n\t&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; class=\&quot;calendarContainer\&quot;&gt;\n\t\t&lt;thead&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td class=\&quot;monthWrapper\&quot; valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t&lt;table class=\&quot;monthContainer\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td class=\&quot;monthCurve monthCurveTL\&quot; valign=\&quot;top\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=\&quot;monthLabelContainer\&quot; valign=\&quot;top\&quot;&gt;\n\t\!
 t\t\t\t\t\t\t&lt;span dojoAttachPoint=\&quot;increaseWeekNode\&quot; \n\t\t\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementWeek;\&quot; \n\t\t\t\t\t\t\t\t\tclass=\&quot;incrementControl increase\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/images/incrementMonth.png\&quot; \n\t\t\t\t\t\t\t\t\talt=\&quot;&darr;\&quot; style=\&quot;width:7px;height:5px;\&quot; /&gt;\n\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;span \n\t\t\t\t\t\t\t\t\tdojoAttachPoint=\&quot;increaseMonthNode\&quot; \n\t\t\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementMonth;\&quot; class=\&quot;incrementControl increase\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/images/incrementMonth.png\&quot; \n\t\t\t\t\t\t\t\t\t\talt=\&quot;&darr;\&quot;  dojoAttachPoint=\&quot;incrementMonthImageNode\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;span \n\t\t\t\t\t\t\t\t\tdojoAttachPoint=\&quot;decreaseWeekNode\&quot; \n\t\t\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementWeek;\&quot; \n\t\t\t\t\t\t\t\t\tclass=\&quot;incrementControl decrease\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\&quot;${dojoWi!
 dgetModuleUri}templates/images/decrementMonth.png\&quot; alt=\&quot;&amp;uar!
 r;\&quot; sty
le=\&quot;width:7px;height:5px;\&quot; /&gt;\n\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;span \n\t\t\t\t\t\t\t\t\tdojoAttachPoint=\&quot;decreaseMonthNode\&quot; \n\t\t\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementMonth;\&quot; class=\&quot;incrementControl decrease\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/images/decrementMonth.png\&quot; \n\t\t\t\t\t\t\t\t\t\talt=\&quot;&uarr;\&quot; dojoAttachPoint=\&quot;decrementMonthImageNode\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;span dojoAttachPoint=\&quot;monthLabelNode\&quot; class=\&quot;month\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=\&quot;monthCurve monthCurveTR\&quot; valign=\&quot;top\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/thead&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td colspan=\&quot;3\&quot;&gt;\n\t\t\t\t\t&lt;table class=\&quot;calendarBodyContainer\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t\t\t&lt;thead&gt;\n\t\t\t\t\t\t\t&lt;tr dojoAttachPoint=\&quot;dayLabelsRow\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t!
 \t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/thead&gt;\n\t\t\t\t\t\t&lt;tbody dojoAttachPoint=\&quot;calendarDatesContainerNode\&quot; \n\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: _handleUiClick;\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarWeekTemplate\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/tbody&gt;\n\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t\t&lt;tfoot&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td colspan=\&quot;3\&quot; class=\&quot;yearWrapper\&quot;&gt;\n\t\t\t\t\t&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot; class=\&quot;yearContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t&lt;td class=\&quot;curveBL\&quot; valign=\&quot;top\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;h3 class=\&quot;yearLabel\&quot;&gt;\n\t\t\t\t\t\t\t\t!
 \t&lt;span dojoAttachPoint=\&quot;previousYearLabelNode\&quot;\n\t\t\t\t\t\!
 t\t\t\t\
tdojoAttachEvent=\&quot;onClick: onIncrementYear;\&quot; class=\&quot;previousYear\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;selectedYear\&quot; dojoAttachPoint=\&quot;currentYearLabelNode\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;span dojoAttachPoint=\&quot;nextYearLabelNode\&quot; \n\t\t\t\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementYear;\&quot; class=\&quot;nextYear\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/h3&gt;\n\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;td class=\&quot;curveBR\&quot; valign=\&quot;top\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tfoot&gt;\n\t&lt;/table&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.datePickerContainer {\n\twidth:164px; /* needed for proper user styling */\n}\n\n.calendarContainer {\n/*\tborder:1px solid #566f8f;*/\n}\n\n.calendarBodyContainer {\n\twidth:100%; /* needed for the explode effect (explain?) */\n\tbackground: #7591bc url(\&quot;images/dpBg.gif\&quot;) top left repeat-x;\n}\n\n.calendarBodyContainer thead tr td {\n\tcolor:#293a4b;\n\tfont:bold 0.75em Helvetica, Arial, Verdana, sans-serif;\n\ttext-align:!
 center;\n\tpadding:0.25em;\n\tbackground: url(\&quot;images/dpHorizLine.gif\&quot;) bottom left repeat-x;\n}\n\n.calendarBodyContainer tbody tr td {\n\tcolor:#fff;\n\tfont:bold 0.7em Helvetica, Arial, Verdana, sans-serif;\n\ttext-align:center;\n\tpadding:0.4em;\n\tbackground: url(\&quot;images/dpVertLine.gif\&quot;) top right repeat-y;\n\tcursor:pointer;\n\tcursor:hand;\n}\n\n\n.monthWrapper {\n\tpadding-bottom:2px;\n\tbackground: url(\&quot;images/dpHorizLine.gif\&quot;) bottom left repeat-x;\n}\n\n.monthContainer {\n\twidth:100%;\n}\n\n.monthLabelContainer {\n\ttext-align:center;\n\tfont:bold 0.75em Helvetica, Arial, Verdana, sans-serif;\n\tbackground: url(\&quot;images/dpMonthBg.png\&quot;) repeat-x top left !important;\n\tcolor:#293a4b;\n\tpadding:0.25em;\n}\n\n.monthCurve {\n\twidth:12px;\n}\n\n.monthCurveTL {\n\tbackground: url(\&quot;images/dpCurveTL.png\&quot;) no-repeat top left !important;\n}\n\n.monthCurveTR {\n\t\tbackground: url(\&quot;images/dpCurveTR.png\&quot;) no-repeat top right !important;\n}\n\n\n.yearWrapper {\n!
 \tbackground: url(\&quot;images/dpHorizLineFoot.gif\&quot;) top left rep!
 eat-x;\n
\tpadding-top:2px;\n}\n\n.yearContainer {\n\twidth:100%;\n}\n\n.yearContainer td {\n\tbackground:url(\&quot;images/dpYearBg.png\&quot;) top left repeat-x;\n}\n\n.yearContainer .yearLabel {\n\tmargin:0;\n\tpadding:0.45em 0 0.45em 0;\n\tcolor:#fff;\n\tfont:bold 0.75em Helvetica, Arial, Verdana, sans-serif;\n\ttext-align:center;\n}\n\n.curveBL {\n\tbackground: url(\&quot;images/dpCurveBL.png\&quot;) bottom left no-repeat !important;\n\twidth:9px !important;\n\tpadding:0;\n\tmargin:0;\n}\n\n.curveBR {\n\tbackground: url(\&quot;images/dpCurveBR.png\&quot;) bottom right no-repeat !important;\n\twidth:9px !important;\n\tpadding:0;\n\tmargin:0;\n}\n\n\n.previousMonth {\n\tbackground-color:#6782a8 !important;\n}\n\n.previousMonthDisabled {\n\tbackground-color:#a4a5a6 !important;\n\tcursor:default !important\n}\n.currentMonth {\n}\n\n.currentMonthDisabled {\n\tbackground-color:#bbbbbc !important;\n\tcursor:default !important\n}\n.nextMonth {\n\tbackground-color:#6782a8 !important;\n}\n.nextMonthDisabled {\n\tbackg!
 round-color:#a4a5a6 !important;\n\tcursor:default !important;\n}\n\n.currentDate {\n\ttext-decoration:underline;\n\tfont-style:italic;\n}\n\n.selectedDate {\n\tbackground-color:#fff !important;\n\tcolor:#6782a8 !important;\n}\n\n.yearLabel .selectedYear {\n\tpadding:0.2em;\n\tbackground-color:#9ec3fb !important;\n}\n\n.nextYear, .previousYear {\n\tcursor:pointer;cursor:hand;\n\tpadding:0;\n}\n\n.nextYear {\n\tmargin:0 0 0 0.55em;\n}\n\n.previousYear {\n\tmargin:0 0.55em 0 0;\n}\n\n.incrementControl {\n\tcursor:pointer;cursor:hand;\n\twidth:1em;\n}\n\n.increase {\n\tfloat:right;\n}\n\n.decrease {\n\tfloat:left;\n}\n\n.lastColumn {\n\tbackground-image:none !important;\n}\n\n\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/DatePicker.css&quot;), postMixInProperties:function () {
+	dojo.widget.DatePicker.superclass.postMixInProperties.apply(this, arguments);
+	if (!this.weekStartsOn) {
+		this.weekStartsOn = dojo.date.getFirstDayOfWeek(this.lang);
+	}
+	this.today = new Date();
+	this.today.setHours(0, 0, 0, 0);
+	if (typeof (this.value) == &quot;string&quot; &amp;&amp; this.value.toLowerCase() == &quot;today&quot;) {
+		this.value = new Date();
+	} else {
+		if (this.value &amp;&amp; (typeof this.value == &quot;string&quot;) &amp;&amp; (this.value.split(&quot;-&quot;).length &gt; 2)) {
+			this.value = dojo.date.fromRfc3339(this.value);
+			this.value.setHours(0, 0, 0, 0);
+		}
+	}
+}, fillInTemplate:function (args, frag) {
+	dojo.widget.DatePicker.superclass.fillInTemplate.apply(this, arguments);
+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+	this.weekTemplate = dojo.dom.removeNode(this.calendarWeekTemplate);
+	this._preInitUI(this.value ? this.value : this.today, false, true);
+	var dayLabels = dojo.lang.unnest(dojo.date.getNames(&quot;days&quot;, this.dayWidth, &quot;standAlone&quot;, this.lang));
+	if (this.weekStartsOn &gt; 0) {
+		for (var i = 0; i &lt; this.weekStartsOn; i++) {
+			dayLabels.push(dayLabels.shift());
+		}
+	}
+	var dayLabelNodes = this.dayLabelsRow.getElementsByTagName(&quot;td&quot;);
+	for (i = 0; i &lt; 7; i++) {
+		dayLabelNodes.item(i).innerHTML = dayLabels[i];
+	}
+	if (this.value) {
+		this.setValue(this.value);
+	}
+}, getValue:function () {
+	return dojo.date.toRfc3339(new Date(this.value), &quot;dateOnly&quot;);
+}, getDate:function () {
+	return this.value;
+}, setValue:function (rfcDate) {
+	this.setDate(rfcDate);
+}, setDate:function (dateObj) {
+	if (dateObj == &quot;&quot;) {
+		this.value = &quot;&quot;;
+		this._preInitUI(this.curMonth, false, true);
+	} else {
+		if (typeof dateObj == &quot;string&quot;) {
+			this.value = dojo.date.fromRfc3339(dateObj);
+			this.value.setHours(0, 0, 0, 0);
+		} else {
+			this.value = new Date(dateObj);
+			this.value.setHours(0, 0, 0, 0);
+		}
+	}
+	if (this.selectedNode != null) {
+		dojo.html.removeClass(this.selectedNode, this.classNames.selectedDate);
+	}
+	if (this.clickedNode != null) {
+		dojo.debug(&quot;adding selectedDate&quot;);
+		dojo.html.addClass(this.clickedNode, this.classNames.selectedDate);
+		this.selectedNode = this.clickedNode;
+	} else {
+		this._preInitUI(this.value, false, true);
+	}
+	this.clickedNode = null;
+	this.onValueChanged(this.value);
+}, _preInitUI:function (dateObj, initFirst, initUI) {
+	if (typeof (this.startDate) == &quot;string&quot;) {
+		this.startDate = dojo.date.fromRfc3339(this.startDate);
+	}
+	if (typeof (this.endDate) == &quot;string&quot;) {
+		this.endDate = dojo.date.fromRfc3339(this.endDate);
+	}
+	this.startDate.setHours(0, 0, 0, 0);
+	this.endDate.setHours(24, 0, 0, -1);
+	if (dateObj &lt; this.startDate || dateObj &gt; this.endDate) {
+		dateObj = new Date((dateObj &lt; this.startDate) ? this.startDate : this.endDate);
+	}
+	this.firstDay = this._initFirstDay(dateObj, initFirst);
+	this.selectedIsUsed = false;
+	this.currentIsUsed = false;
+	var nextDate = new Date(this.firstDay);
+	var tmpMonth = nextDate.getMonth();
+	this.curMonth = new Date(nextDate);
+	this.curMonth.setDate(nextDate.getDate() + 6);
+	this.curMonth.setDate(1);
+	if (this.displayWeeks == &quot;&quot; || this.adjustWeeks) {
+		this.adjustWeeks = true;
+		this.displayWeeks = Math.ceil((dojo.date.getDaysInMonth(this.curMonth) + this._getAdjustedDay(this.curMonth)) / 7);
+	}
+	var days = this.displayWeeks * 7;
+	if (dojo.date.diff(this.startDate, this.endDate, dojo.date.dateParts.DAY) &lt; days) {
+		this.staticDisplay = true;
+		if (dojo.date.diff(nextDate, this.endDate, dojo.date.dateParts.DAY) &gt; days) {
+			this._preInitUI(this.startDate, true, false);
+			nextDate = new Date(this.firstDay);
+		}
+		this.curMonth = new Date(nextDate);
+		this.curMonth.setDate(nextDate.getDate() + 6);
+		this.curMonth.setDate(1);
+		var curClass = (nextDate.getMonth() == this.curMonth.getMonth()) ? &quot;current&quot; : &quot;previous&quot;;
+	}
+	if (initUI) {
+		this._initUI(days);
+	}
+}, _initUI:function (days) {
+	dojo.dom.removeChildren(this.calendarDatesContainerNode);
+	for (var i = 0; i &lt; this.displayWeeks; i++) {
+		this.calendarDatesContainerNode.appendChild(this.weekTemplate.cloneNode(true));
+	}
+	var nextDate = new Date(this.firstDay);
+	this._setMonthLabel(this.curMonth.getMonth());
+	this._setYearLabels(this.curMonth.getFullYear());
+	var calendarNodes = this.calendarDatesContainerNode.getElementsByTagName(&quot;td&quot;);
+	var calendarRows = this.calendarDatesContainerNode.getElementsByTagName(&quot;tr&quot;);
+	var currentCalendarNode;
+	for (i = 0; i &lt; days; i++) {
+		currentCalendarNode = calendarNodes.item(i);
+		currentCalendarNode.innerHTML = nextDate.getDate();
+		currentCalendarNode.setAttribute(&quot;djDateValue&quot;, nextDate.valueOf());
+		var curClass = (nextDate.getMonth() != this.curMonth.getMonth() &amp;&amp; Number(nextDate) &lt; Number(this.curMonth)) ? &quot;previous&quot; : (nextDate.getMonth() == this.curMonth.getMonth()) ? &quot;current&quot; : &quot;next&quot;;
+		var mappedClass = curClass;
+		if (this._isDisabledDate(nextDate)) {
+			var classMap = {previous:&quot;disabledPrevious&quot;, current:&quot;disabledCurrent&quot;, next:&quot;disabledNext&quot;};
+			mappedClass = classMap[curClass];
+		}
+		dojo.html.setClass(currentCalendarNode, this._getDateClassName(nextDate, mappedClass));
+		if (dojo.html.hasClass(currentCalendarNode, this.classNames.selectedDate)) {
+			this.selectedNode = currentCalendarNode;
+		}
+		nextDate = dojo.date.add(nextDate, dojo.date.dateParts.DAY, 1);
+	}
+	this.lastDay = dojo.date.add(nextDate, dojo.date.dateParts.DAY, -1);
+	this._initControls();
+}, _initControls:function () {
+	var d = this.firstDay;
+	var d2 = this.lastDay;
+	var decWeek, incWeek, decMonth, incMonth, decYear, incYear;
+	decWeek = incWeek = decMonth = incMonth = decYear = incYear = !this.staticDisplay;
+	with (dojo.date.dateParts) {
+		var add = dojo.date.add;
+		if (decWeek &amp;&amp; add(d, DAY, (-1 * (this._getAdjustedDay(d) + 1))) &lt; this.startDate) {
+			decWeek = decMonth = decYear = false;
+		}
+		if (incWeek &amp;&amp; d2 &gt; this.endDate) {
+			incWeek = incMonth = incYear = false;
+		}
+		if (decMonth &amp;&amp; add(d, DAY, -1) &lt; this.startDate) {
+			decMonth = decYear = false;
+		}
+		if (incMonth &amp;&amp; add(d2, DAY, 1) &gt; this.endDate) {
+			incMonth = incYear = false;
+		}
+		if (decYear &amp;&amp; add(d2, YEAR, -1) &lt; this.startDate) {
+			decYear = false;
+		}
+		if (incYear &amp;&amp; add(d, YEAR, 1) &gt; this.endDate) {
+			incYear = false;
+		}
+	}
+	function enableControl(node, enabled) {
+		dojo.html.setVisibility(node, enabled ? &quot;&quot; : &quot;hidden&quot;);
+	}
+	enableControl(this.decreaseWeekNode, decWeek);
+	enableControl(this.increaseWeekNode, incWeek);
+	enableControl(this.decreaseMonthNode, decMonth);
+	enableControl(this.increaseMonthNode, incMonth);
+	enableControl(this.previousYearLabelNode, decYear);
+	enableControl(this.nextYearLabelNode, incYear);
+}, _incrementWeek:function (evt) {
+	var d = new Date(this.firstDay);
+	switch (evt.target) {
+	  case this.increaseWeekNode.getElementsByTagName(&quot;img&quot;).item(0):
+	  case this.increaseWeekNode:
+		var tmpDate = dojo.date.add(d, dojo.date.dateParts.WEEK, 1);
+		if (tmpDate &lt; this.endDate) {
+			d = dojo.date.add(d, dojo.date.dateParts.WEEK, 1);
+		}
+		break;
+	  case this.decreaseWeekNode.getElementsByTagName(&quot;img&quot;).item(0):
+	  case this.decreaseWeekNode:
+		if (d &gt;= this.startDate) {
+			d = dojo.date.add(d, dojo.date.dateParts.WEEK, -1);
+		}
+		break;
+	}
+	this._preInitUI(d, true, true);
+}, _incrementMonth:function (evt) {
+	var d = new Date(this.curMonth);
+	var tmpDate = new Date(this.firstDay);
+	switch (evt.currentTarget) {
+	  case this.increaseMonthNode.getElementsByTagName(&quot;img&quot;).item(0):
+	  case this.increaseMonthNode:
+		tmpDate = dojo.date.add(tmpDate, dojo.date.dateParts.DAY, this.displayWeeks * 7);
+		if (tmpDate &lt; this.endDate) {
+			d = dojo.date.add(d, dojo.date.dateParts.MONTH, 1);
+		} else {
+			var revertToEndDate = true;
+		}
+		break;
+	  case this.decreaseMonthNode.getElementsByTagName(&quot;img&quot;).item(0):
+	  case this.decreaseMonthNode:
+		if (tmpDate &gt; this.startDate) {
+			d = dojo.date.add(d, dojo.date.dateParts.MONTH, -1);
+		} else {
+			var revertToStartDate = true;
+		}
+		break;
+	}
+	if (revertToStartDate) {
+		d = new Date(this.startDate);
+	} else {
+		if (revertToEndDate) {
+			d = new Date(this.endDate);
+		}
+	}
+	this._preInitUI(d, false, true);
+}, _incrementYear:function (evt) {
+	var year = this.curMonth.getFullYear();
+	var tmpDate = new Date(this.firstDay);
+	switch (evt.target) {
+	  case this.nextYearLabelNode:
+		tmpDate = dojo.date.add(tmpDate, dojo.date.dateParts.YEAR, 1);
+		if (tmpDate &lt; this.endDate) {
+			year++;
+		} else {
+			var revertToEndDate = true;
+		}
+		break;
+	  case this.previousYearLabelNode:
+		tmpDate = dojo.date.add(tmpDate, dojo.date.dateParts.YEAR, -1);
+		if (tmpDate &gt; this.startDate) {
+			year--;
+		} else {
+			var revertToStartDate = true;
+		}
+		break;
+	}
+	var d;
+	if (revertToStartDate) {
+		d = new Date(this.startDate);
+	} else {
+		if (revertToEndDate) {
+			d = new Date(this.endDate);
+		} else {
+			d = new Date(year, this.curMonth.getMonth(), 1);
+		}
+	}
+	this._preInitUI(d, false, true);
+}, onIncrementWeek:function (evt) {
+	evt.stopPropagation();
+	if (!this.staticDisplay) {
+		this._incrementWeek(evt);
+	}
+}, onIncrementMonth:function (evt) {
+	evt.stopPropagation();
+	if (!this.staticDisplay) {
+		this._incrementMonth(evt);
+	}
+}, onIncrementYear:function (evt) {
+	evt.stopPropagation();
+	if (!this.staticDisplay) {
+		this._incrementYear(evt);
+	}
+}, _setMonthLabel:function (monthIndex) {
+	this.monthLabelNode.innerHTML = dojo.date.getNames(&quot;months&quot;, &quot;wide&quot;, &quot;standAlone&quot;, this.lang)[monthIndex];
+}, _setYearLabels:function (year) {
+	var y = year - 1;
+	var that = this;
+	function f(n) {
+		that[n + &quot;YearLabelNode&quot;].innerHTML = dojo.date.format(new Date(y++, 0), {formatLength:&quot;yearOnly&quot;, locale:that.lang});
+	}
+	f(&quot;previous&quot;);
+	f(&quot;current&quot;);
+	f(&quot;next&quot;);
+}, _getDateClassName:function (date, monthState) {
+	var currentClassName = this.classNames[monthState];
+	if ((!this.selectedIsUsed &amp;&amp; this.value) &amp;&amp; (Number(date) == Number(this.value))) {
+		currentClassName = this.classNames.selectedDate + &quot; &quot; + currentClassName;
+		this.selectedIsUsed = true;
+	}
+	if ((!this.currentIsUsed) &amp;&amp; (Number(date) == Number(this.today))) {
+		currentClassName = currentClassName + &quot; &quot; + this.classNames.currentDate;
+		this.currentIsUsed = true;
+	}
+	return currentClassName;
+}, onClick:function (evt) {
+	dojo.event.browser.stopEvent(evt);
+}, _handleUiClick:function (evt) {
+	var eventTarget = evt.target;
+	if (eventTarget.nodeType != dojo.dom.ELEMENT_NODE) {
+		eventTarget = eventTarget.parentNode;
+	}
+	dojo.event.browser.stopEvent(evt);
+	this.selectedIsUsed = this.todayIsUsed = false;
+	if (dojo.html.hasClass(eventTarget, this.classNames[&quot;disabledPrevious&quot;]) || dojo.html.hasClass(eventTarget, this.classNames[&quot;disabledCurrent&quot;]) || dojo.html.hasClass(eventTarget, this.classNames[&quot;disabledNext&quot;])) {
+		return;
+	}
+	this.clickedNode = eventTarget;
+	this.setDate(new Date(Number(dojo.html.getAttribute(eventTarget, &quot;djDateValue&quot;))));
+}, onValueChanged:function (date) {
+}, _isDisabledDate:function (dateObj) {
+	if (dateObj &lt; this.startDate || dateObj &gt; this.endDate) {
+		return true;
+	}
+	return this.isDisabledDate(dateObj, this.lang);
+}, isDisabledDate:function (dateObj, locale) {
+	return false;
+}, _initFirstDay:function (dateObj, adj) {
+	var d = new Date(dateObj);
+	if (!adj) {
+		d.setDate(1);
+	}
+	d.setDate(d.getDate() - this._getAdjustedDay(d, this.weekStartsOn));
+	d.setHours(0, 0, 0, 0);
+	return d;
+}, _getAdjustedDay:function (dateObj) {
+	var days = [0, 1, 2, 3, 4, 5, 6];
+	if (this.weekStartsOn &gt; 0) {
+		for (var i = 0; i &lt; this.weekStartsOn; i++) {
+			days.unshift(days.pop());
+		}
+	}
+	return days[dateObj.getDay()];
+}, destroy:function () {
+	dojo.widget.DatePicker.superclass.destroy.apply(this, arguments);
+	dojo.html.destroyNode(this.weekTemplate);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DateTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DateTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DateTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,47 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DateTextbox&quot;);
+dojo.require(&quot;dojo.widget.ValidationTextbox&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.validate.datetime&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.DateTextbox&quot;, dojo.widget.ValidationTextbox, {displayFormat:&quot;&quot;, formatLength:&quot;short&quot;, mixInProperties:function (localProperties) {
+	dojo.widget.DateTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.format) {
+		this.flags.format = localProperties.format;
+	}
+}, isValid:function () {
+	if (this.flags.format) {
+		dojo.deprecated(&quot;dojo.widget.DateTextbox&quot;, &quot;format attribute is deprecated; use displayFormat or formatLength instead&quot;, &quot;0.5&quot;);
+		return dojo.validate.isValidDate(this.textbox.value, this.flags.format);
+	}
+	return dojo.date.parse(this.textbox.value, {formatLength:this.formatLength, selector:&quot;dateOnly&quot;, locale:this.lang, datePattern:this.displayFormat});
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TimeTextbox&quot;, dojo.widget.ValidationTextbox, {displayFormat:&quot;&quot;, formatLength:&quot;short&quot;, mixInProperties:function (localProperties) {
+	dojo.widget.TimeTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.format) {
+		this.flags.format = localProperties.format;
+	}
+	if (localProperties.amsymbol) {
+		this.flags.amSymbol = localProperties.amsymbol;
+	}
+	if (localProperties.pmsymbol) {
+		this.flags.pmSymbol = localProperties.pmsymbol;
+	}
+}, isValid:function () {
+	if (this.flags.format) {
+		dojo.deprecated(&quot;dojo.widget.TimeTextbox&quot;, &quot;format attribute is deprecated; use displayFormat or formatLength instead&quot;, &quot;0.5&quot;);
+		return dojo.validate.isValidTime(this.textbox.value, this.flags);
+	}
+	return dojo.date.parse(this.textbox.value, {formatLength:this.formatLength, selector:&quot;timeOnly&quot;, locale:this.lang, timePattern:this.displayFormat});
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DebugConsole.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DebugConsole.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DebugConsole.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DebugConsole&quot;);
+dojo.require(&quot;dojo.widget.Widget&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.FloatingPane&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.DebugConsole&quot;, dojo.widget.FloatingPane, {fillInTemplate:function () {
+	dojo.widget.DebugConsole.superclass.fillInTemplate.apply(this, arguments);
+	this.containerNode.id = &quot;debugConsoleClientPane&quot;;
+	djConfig.isDebug = true;
+	djConfig.debugContainerId = this.containerNode.id;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Dialog.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Dialog.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Dialog.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,300 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Dialog&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.iframe&quot;);
+dojo.declare(&quot;dojo.widget.ModalDialogBase&quot;, null, {isContainer:true, focusElement:&quot;&quot;, bgColor:&quot;black&quot;, bgOpacity:0.4, followScroll:true, closeOnBackgroundClick:false, trapTabs:function (e) {
+	if (e.target == this.tabStartOuter) {
+		if (this._fromTrap) {
+			this.tabStart.focus();
+			this._fromTrap = false;
+		} else {
+			this._fromTrap = true;
+			this.tabEnd.focus();
+		}
+	} else {
+		if (e.target == this.tabStart) {
+			if (this._fromTrap) {
+				this._fromTrap = false;
+			} else {
+				this._fromTrap = true;
+				this.tabEnd.focus();
+			}
+		} else {
+			if (e.target == this.tabEndOuter) {
+				if (this._fromTrap) {
+					this.tabEnd.focus();
+					this._fromTrap = false;
+				} else {
+					this._fromTrap = true;
+					this.tabStart.focus();
+				}
+			} else {
+				if (e.target == this.tabEnd) {
+					if (this._fromTrap) {
+						this._fromTrap = false;
+					} else {
+						this._fromTrap = true;
+						this.tabStart.focus();
+					}
+				}
+			}
+		}
+	}
+}, clearTrap:function (e) {
+	var _this = this;
+	setTimeout(function () {
+		_this._fromTrap = false;
+	}, 100);
+}, postCreate:function () {
+	with (this.domNode.style) {
+		position = &quot;absolute&quot;;
+		zIndex = 999;
+		display = &quot;none&quot;;
+		overflow = &quot;visible&quot;;
+	}
+	var b = dojo.body();
+	b.appendChild(this.domNode);
+	this.bg = document.createElement(&quot;div&quot;);
+	this.bg.className = &quot;dialogUnderlay&quot;;
+	with (this.bg.style) {
+		position = &quot;absolute&quot;;
+		left = top = &quot;0px&quot;;
+		zIndex = 998;
+		display = &quot;none&quot;;
+	}
+	b.appendChild(this.bg);
+	this.setBackgroundColor(this.bgColor);
+	this.bgIframe = new dojo.html.BackgroundIframe();
+	if (this.bgIframe.iframe) {
+		with (this.bgIframe.iframe.style) {
+			position = &quot;absolute&quot;;
+			left = top = &quot;0px&quot;;
+			zIndex = 90;
+			display = &quot;none&quot;;
+		}
+	}
+	if (this.closeOnBackgroundClick) {
+		dojo.event.kwConnect({srcObj:this.bg, srcFunc:&quot;onclick&quot;, adviceObj:this, adviceFunc:&quot;onBackgroundClick&quot;, once:true});
+	}
+}, uninitialize:function () {
+	this.bgIframe.remove();
+	dojo.html.removeNode(this.bg, true);
+}, setBackgroundColor:function (color) {
+	if (arguments.length &gt;= 3) {
+		color = new dojo.gfx.color.Color(arguments[0], arguments[1], arguments[2]);
+	} else {
+		color = new dojo.gfx.color.Color(color);
+	}
+	this.bg.style.backgroundColor = color.toString();
+	return this.bgColor = color;
+}, setBackgroundOpacity:function (op) {
+	if (arguments.length == 0) {
+		op = this.bgOpacity;
+	}
+	dojo.html.setOpacity(this.bg, op);
+	try {
+		this.bgOpacity = dojo.html.getOpacity(this.bg);
+	}
+	catch (e) {
+		this.bgOpacity = op;
+	}
+	return this.bgOpacity;
+}, _sizeBackground:function () {
+	if (this.bgOpacity &gt; 0) {
+		var viewport = dojo.html.getViewport();
+		var h = viewport.height;
+		var w = viewport.width;
+		with (this.bg.style) {
+			width = w + &quot;px&quot;;
+			height = h + &quot;px&quot;;
+		}
+		var scroll_offset = dojo.html.getScroll().offset;
+		this.bg.style.top = scroll_offset.y + &quot;px&quot;;
+		this.bg.style.left = scroll_offset.x + &quot;px&quot;;
+		var viewport = dojo.html.getViewport();
+		if (viewport.width != w) {
+			this.bg.style.width = viewport.width + &quot;px&quot;;
+		}
+		if (viewport.height != h) {
+			this.bg.style.height = viewport.height + &quot;px&quot;;
+		}
+	}
+	this.bgIframe.size(this.bg);
+}, _showBackground:function () {
+	if (this.bgOpacity &gt; 0) {
+		this.bg.style.display = &quot;block&quot;;
+	}
+	if (this.bgIframe.iframe) {
+		this.bgIframe.iframe.style.display = &quot;block&quot;;
+	}
+}, placeModalDialog:function () {
+	var scroll_offset = dojo.html.getScroll().offset;
+	var viewport_size = dojo.html.getViewport();
+	var mb;
+	if (this.isShowing()) {
+		mb = dojo.html.getMarginBox(this.domNode);
+	} else {
+		dojo.html.setVisibility(this.domNode, false);
+		dojo.html.show(this.domNode);
+		mb = dojo.html.getMarginBox(this.domNode);
+		dojo.html.hide(this.domNode);
+		dojo.html.setVisibility(this.domNode, true);
+	}
+	var x = scroll_offset.x + (viewport_size.width - mb.width) / 2;
+	var y = scroll_offset.y + (viewport_size.height - mb.height) / 2;
+	with (this.domNode.style) {
+		left = x + &quot;px&quot;;
+		top = y + &quot;px&quot;;
+	}
+}, _onKey:function (evt) {
+	if (evt.key) {
+		var node = evt.target;
+		while (node != null) {
+			if (node == this.domNode) {
+				return;
+			}
+			node = node.parentNode;
+		}
+		if (evt.key != evt.KEY_TAB) {
+			dojo.event.browser.stopEvent(evt);
+		} else {
+			if (!dojo.render.html.opera) {
+				try {
+					this.tabStart.focus();
+				}
+				catch (e) {
+				}
+			}
+		}
+	}
+}, showModalDialog:function () {
+	if (this.followScroll &amp;&amp; !this._scrollConnected) {
+		this._scrollConnected = true;
+		dojo.event.connect(window, &quot;onscroll&quot;, this, &quot;_onScroll&quot;);
+	}
+	dojo.event.connect(document.documentElement, &quot;onkey&quot;, this, &quot;_onKey&quot;);
+	this.placeModalDialog();
+	this.setBackgroundOpacity();
+	this._sizeBackground();
+	this._showBackground();
+	this._fromTrap = true;
+	setTimeout(dojo.lang.hitch(this, function () {
+		try {
+			this.tabStart.focus();
+		}
+		catch (e) {
+		}
+	}), 50);
+}, hideModalDialog:function () {
+	if (this.focusElement) {
+		dojo.byId(this.focusElement).focus();
+		dojo.byId(this.focusElement).blur();
+	}
+	this.bg.style.display = &quot;none&quot;;
+	this.bg.style.width = this.bg.style.height = &quot;1px&quot;;
+	if (this.bgIframe.iframe) {
+		this.bgIframe.iframe.style.display = &quot;none&quot;;
+	}
+	dojo.event.disconnect(document.documentElement, &quot;onkey&quot;, this, &quot;_onKey&quot;);
+	if (this._scrollConnected) {
+		this._scrollConnected = false;
+		dojo.event.disconnect(window, &quot;onscroll&quot;, this, &quot;_onScroll&quot;);
+	}
+}, _onScroll:function () {
+	var scroll_offset = dojo.html.getScroll().offset;
+	this.bg.style.top = scroll_offset.y + &quot;px&quot;;
+	this.bg.style.left = scroll_offset.x + &quot;px&quot;;
+	this.placeModalDialog();
+}, checkSize:function () {
+	if (this.isShowing()) {
+		this._sizeBackground();
+		this.placeModalDialog();
+		this.onResized();
+	}
+}, onBackgroundClick:function () {
+	if (this.lifetime - this.timeRemaining &gt;= this.blockDuration) {
+		return;
+	}
+	this.hide();
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.Dialog&quot;, [dojo.widget.ContentPane, dojo.widget.ModalDialogBase], {templateString:&quot;&lt;div id=\&quot;${this.widgetId}\&quot; class=\&quot;dojoDialog\&quot; dojoattachpoint=\&quot;wrapper\&quot;&gt;\n\t&lt;span dojoattachpoint=\&quot;tabStartOuter\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot;\ttabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;span dojoattachpoint=\&quot;tabStart\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot; tabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;div dojoattachpoint=\&quot;containerNode\&quot; style=\&quot;position: relative; z-index: 2;\&quot;&gt;&lt;/div&gt;\n\t&lt;span dojoattachpoint=\&quot;tabEnd\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot; tabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;span dojoattachpoint=\&quot;tabEndOuter\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot; tabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n&lt;/div&gt;\n&quot;, blockDuration:0, lifetime:0, closeNode:&quot;&quot;, postMixInProperties:function () {
+	dojo.widget.Dialog.superclass.postMixInProperties.apply(this, arguments);
+	if (this.closeNode) {
+		this.setCloseControl(this.closeNode);
+	}
+}, postCreate:function () {
+	dojo.widget.Dialog.superclass.postCreate.apply(this, arguments);
+	dojo.widget.ModalDialogBase.prototype.postCreate.apply(this, arguments);
+}, show:function () {
+	if (this.lifetime) {
+		this.timeRemaining = this.lifetime;
+		if (this.timerNode) {
+			this.timerNode.innerHTML = Math.ceil(this.timeRemaining / 1000);
+		}
+		if (this.blockDuration &amp;&amp; this.closeNode) {
+			if (this.lifetime &gt; this.blockDuration) {
+				this.closeNode.style.visibility = &quot;hidden&quot;;
+			} else {
+				this.closeNode.style.display = &quot;none&quot;;
+			}
+		}
+		if (this.timer) {
+			clearInterval(this.timer);
+		}
+		this.timer = setInterval(dojo.lang.hitch(this, &quot;_onTick&quot;), 100);
+	}
+	this.showModalDialog();
+	dojo.widget.Dialog.superclass.show.call(this);
+}, onLoad:function () {
+	this.placeModalDialog();
+	dojo.widget.Dialog.superclass.onLoad.call(this);
+}, fillInTemplate:function () {
+}, hide:function () {
+	this.hideModalDialog();
+	dojo.widget.Dialog.superclass.hide.call(this);
+	if (this.timer) {
+		clearInterval(this.timer);
+	}
+}, setTimerNode:function (node) {
+	this.timerNode = node;
+}, setCloseControl:function (node) {
+	this.closeNode = dojo.byId(node);
+	dojo.event.connect(this.closeNode, &quot;onclick&quot;, this, &quot;hide&quot;);
+}, setShowControl:function (node) {
+	node = dojo.byId(node);
+	dojo.event.connect(node, &quot;onclick&quot;, this, &quot;show&quot;);
+}, _onTick:function () {
+	if (this.timer) {
+		this.timeRemaining -= 100;
+		if (this.lifetime - this.timeRemaining &gt;= this.blockDuration) {
+			if (this.closeNode) {
+				this.closeNode.style.visibility = &quot;visible&quot;;
+			}
+		}
+		if (!this.timeRemaining) {
+			clearInterval(this.timer);
+			this.hide();
+		} else {
+			if (this.timerNode) {
+				this.timerNode.innerHTML = Math.ceil(this.timeRemaining / 1000);
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DocPane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DocPane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DocPane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,262 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DocPane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.Editor2&quot;);
+dojo.require(&quot;dojo.widget.Dialog&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.widget.DocPane = function () {
+	dojo.event.topic.subscribe(&quot;/docs/function/results&quot;, this, &quot;onDocResults&quot;);
+	dojo.event.topic.subscribe(&quot;/docs/package/results&quot;, this, &quot;onPkgResults&quot;);
+	dojo.event.topic.subscribe(&quot;/docs/function/detail&quot;, this, &quot;onDocSelectFunction&quot;);
+};
+dojo.widget.defineWidget(&quot;dojo.widget.DocPane&quot;, dojo.widget.HtmlWidget, {dialog:null, dialogBg:null, dialogFg:null, logIn:null, edit:null, save:null, cancel:null, detail:null, result:null, packag:null, fn:null, fnLink:null, count:null, row:null, summary:null, description:null, variables:null, vRow:null, vLink:null, vDesc:null, methods:null, mRow:null, mLink:null, mDesc:null, requires:null, rRow:null, rRow2:null, rH3:null, rLink:null, parameters:null, pRow:null, pLink:null, pDesc:null, pOpt:null, pType:null, sType:null, sName:null, sParams:null, sPType:null, sPTypeSave:null, sPName:null, sPNameSave:null, pkgDescription:null, _appends:[], templateString:&quot;&lt;div class=\&quot;dojoDocPane\&quot;&gt;\n\t&lt;div dojoAttachPoint=\&quot;containerNode\&quot; class=\&quot;container\&quot;&gt;&lt;/div&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;dialog\&quot; class=\&quot;dialog\&quot;&gt;\n\t\t&lt;div class=\&quot;container\&quot; dojoAttachPoint=\&quot;dialogBg\&quot;&gt;\n\t\t\t&lt;div class=\&quot;docDialog\&quot; dojoAttachPoint=\&quot;dialogFg\&quot;&gt;\n\t\t\t\t&lt;h2&gt;Log In&lt;/h2&gt;\n\t\t\t\t&lt;p&gt;&lt;input id=\&quot;dojo!
 DocUserName\&quot; dojoAttachPoint=\&quot;userName\&quot;&gt;&lt;label for=\&quot;dojoDocUserName\&quot;&gt;User Name:&lt;/label&gt;&lt;/p&gt;\n\t\t\t\t&lt;p&gt;&lt;input id=\&quot;dojoDocPassword\&quot; dojoAttachPoint=\&quot;password\&quot; type=\&quot;password\&quot;&gt;&lt;label for=\&quot;dojoDocPassword\&quot;&gt;Password:&lt;/label&gt;&lt;/p&gt;\n\t\t\t\t&lt;p&gt;&lt;input type=\&quot;button\&quot; dojoAttachPoint=\&quot;cancel\&quot; value=\&quot;cancel\&quot;&gt; &lt;input type=\&quot;button\&quot; dojoAttachPoint=\&quot;logIn\&quot; value=\&quot;Log In\&quot;&gt;&lt;/p&gt;\n\t\t\t\t&lt;p&gt;&lt;/p&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;nav\&quot; class=\&quot;nav\&quot;&gt;&lt;span&gt;Detail&lt;/span&gt; | &lt;span&gt;Source&lt;/span&gt; | &lt;span&gt;Examples&lt;/span&gt; | &lt;span&gt;Walkthrough&lt;/span&gt;&lt;/div&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;detail\&quot; class=\&quot;detail\&quot;&gt;\n\t\t&lt;h1&gt;Detail: &lt;span class=\&quot;fn\&quot; dojoAttachPoint=\&quot;fn\&quot;&gt;dojo.select&lt;/span&gt;&lt;/h1&gt;\n\t\t&lt;div class=\&quot;description\&quot; dojoAttachPoint=\&quot;description\&quot;&gt;Description&lt;/div&gt;\n\t\t&lt;div class=\&quot;params\&quot; dojoAttachPoint=\&quot;parameters\&quot;&gt;\n\t\t\t&lt;h2&gt;Parameters&lt;/h2&gt;\n\t\t\t&lt;div class=\&quot;row\&quot; dojoAttachPoint=\&quot;pRow\&quot;&gt;\n\t\t\t\t&lt;span dojoAttachPoint=\&quot;pOpt\&quot;&gt;!
 &lt;em&gt;optional&lt;/em&gt; &lt;/span&gt;\n\t\t\t\t&lt;span&gt;&lt;span dojoAttachPoint!
 =\&quot;pType
\&quot;&gt;type&lt;/span&gt; &lt;/span&gt;\n\t\t\t\t&lt;a href=\&quot;#\&quot; dojoAttachPoint=\&quot;pLink\&quot;&gt;variable&lt;/a&gt;\n\t\t\t\t&lt;span&gt; - &lt;span dojoAttachPoint=\&quot;pDesc\&quot;&gt;&lt;/span&gt;&lt;/span&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t\t&lt;div class=\&quot;variables\&quot; dojoAttachPoint=\&quot;variables\&quot;&gt;\n\t\t\t&lt;h2&gt;Variables&lt;/h2&gt;\n\t\t\t&lt;div class\&quot;row\&quot; dojoAttachPoint=\&quot;vRow\&quot;&gt;\n\t\t\t\t&lt;a href=\&quot;#\&quot; dojoAttachPoint=\&quot;vLink\&quot;&gt;variable&lt;/a&gt;&lt;span&gt; - &lt;span dojoAttachPoint=\&quot;vDesc\&quot;&gt;&lt;/span&gt;&lt;/span&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t\t&lt;div class=\&quot;signature\&quot;&gt;\n\t\t\t&lt;h2&gt;Signature&lt;/h2&gt;\n\t\t\t&lt;div class=\&quot;source\&quot;&gt;\n\t\t\t\t&lt;span class=\&quot;return\&quot; dojoAttachPoint=\&quot;sType\&quot;&gt;returnType&lt;/span&gt; \n\t\t\t\t&lt;span class=\&quot;function\&quot; dojoAttachPoint=\&quot;sName\&quot;&gt;foo&lt;/span&gt;\n\t\t\t\t(&lt;span class=\&quot;params\&quot; dojoAttachPoint=\&quot;sParams\&quot;&gt;\n\t\t\t\t\t&lt;span class=\&quot;type\&quot; dojoAttachPoint=\&quot;sPType\&quot;&gt;type &lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;name\&quot; dojoAttachPoint=\&quot;sPName\&quot;&gt;paramName&lt;/span&gt;\n\t\t\t\t&lt;/span&gt;)\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n\t\n\t&lt;div dojoAttachPoint=\&quot;res!
 ult\&quot; class=\&quot;result\&quot;&gt;\n\t\t&lt;h1&gt;Search Results: &lt;span dojoAttachPoint=\&quot;count\&quot;&gt;0&lt;/span&gt; matches&lt;/h1&gt;\n\t\t&lt;div class=\&quot;row\&quot; dojoAttachPoint=\&quot;row\&quot;&gt;\n\t\t\t&lt;a href=\&quot;#\&quot; dojoAttachPoint=\&quot;fnLink\&quot;&gt;dojo.fnLink&lt;/a&gt;\n\t\t\t&lt;span&gt; - &lt;span class=\&quot;summary\&quot; dojoAttachPoint=\&quot;summary\&quot;&gt;summary&lt;/span&gt;&lt;/span&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;packag\&quot; class=\&quot;package\&quot;&gt;\n\t\t&lt;h1&gt;Package: \n\t\t\t&lt;span class=\&quot;pkg\&quot; dojoAttachPoint=\&quot;pkg\&quot;&gt;dojo.package&lt;/span&gt; \n\t\t\t&lt;span class=\&quot;edit\&quot; dojoAttachPoint=\&quot;edit\&quot;&gt;[edit]&lt;/span&gt; \n\t\t\t&lt;span class=\&quot;save\&quot; dojoAttachPoint=\&quot;save\&quot;&gt;[save]&lt;/span&gt;\n\t\t&lt;/h1&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;pkgDescription\&quot; class=\&quot;description\&quot;&gt;Description&lt;/div&gt;\n\t\t&lt;div class=\&quot;methods\&quot; dojoAttachPoint=\&quot;methods\&quot;&gt;\n\t\t\t&lt;h2&gt;Methods&lt;/h2&gt;\n\t\t\t&lt;div class=\&quot;row\&quot; dojoAttachPoint=\&quot;mRow\&quot;&gt;\n\t\t\t\t&lt;a href=\&quot;#\&quot; dojoAttachPoint=\&quot;mLink\&quot;&gt;method&lt;/a&gt;\n\t\t\t\t&lt;span&gt; - &lt;span class=\&quot;description\&quot; dojoAttachPoint=\&quot;mDesc\&quot;&gt;&lt;/span&gt;&lt;/span&gt;\n\!
 t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t\t&lt;div class=\&quot;requires\&quot; dojoAttac!
 hPoint=\
&quot;requires\&quot;&gt;\n\t\t\t&lt;h2&gt;Requires&lt;/h2&gt;\n\t\t\t&lt;div class=\&quot;row\&quot; dojoAttachPoint=\&quot;rRow\&quot;&gt;\n\t\t\t\t&lt;h3 dojoAttachPoint=\&quot;rH3\&quot;&gt;Environment&lt;/h3&gt;\n\t\t\t\t&lt;div dojoAttachPoint=\&quot;rRow2\&quot;&gt;&lt;a href=\&quot;#\&quot; dojoAttachPoint=\&quot;rLink\&quot; class=\&quot;package\&quot;&gt;require&lt;/a&gt;&lt;/div&gt;\n\t\t\t&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.dojoDocPane { padding:1em; font: 1em Georgia,Times,\&quot;Times New Roman\&quot;,serif; }\n\n.dojoDocPane .container{ }\n\n.dojoDocPane .dialog{ }\n.dojoDocPane .dialog .container{ padding: 0.5em; background: #fff; border: 2px solid #333; }\n.dojoDocPane .dialog .docDialog{ background: transparent; width: 20em; }\n.dojoDocPane .dialog .docDialog h2{ margin-top: 0; padding-top: 0; }\n.dojoDocPane .dialog .docDialog input { float: right; margin-right: 1em; }\n.dojoDocPane .dialog .docDialog p{ clear: both; }\n#dojoDocUserName, #dojoDocPassword { width: 10em; }\n\n.dojoDocPane .nav{ }\n.dojoDocPane .nav span{ }\n\n.dojoDocPane .detail{ }\n.dojoDocPane .detail h1{ }\!
 n.dojoDocPane .detail h1 span.fn{ }\n.dojoDocPane .detail .description{ }\n.dojoDocPane .detail .params{ }\n.dojoDocPane .detail .params .row{ }\n.dojoDocPane .detail .params .row span{ }\n.dojoDocPane .detail .variables{ }\n.dojoDocPane .detail .variables .row{ }\n.dojoDocPane .detail .signature{ }\n.dojoDocPane .detail .signature .source{ white-space: pre; font: 0.8em Monaco, Courier, \&quot;Courier New\&quot;, monospace; }\n.dojoDocPane .detail .signature .source .return{ color:#369; }\n.dojoDocPane .detail .signature .source .function{ color: #98543F; font-weight: bold; }\n.dojoDocPane .detail .signature .source .params{ }\n.dojoDocPane .detail .signature .source .params .type{ font-style: italic; color: #d17575; }\n.dojoDocPane .detail .signature .source .params .name{ color: #d14040; }\n\n.dojoDocPane .result{ }\n.dojoDocPane .result h1{ }\n.dojoDocPane .result .row{ }\n.dojoDocPane .result .row .summary{ }\n\n.dojoDocPane .package{ }\n.dojoDocPane .package h1{ }\n.dojoDocPane !
 .package .row{ }\n.dojoDocPane .package .row .summary{ }\n.doj!
 oDocPane
 .package .description{ }\n.dojoDocPane .package .methods{ }\n.dojoDocPane .package .methods h2{ }\n.dojoDocPane .package .methods .row{ }\n.dojoDocPane .package .methods .row .description{ }\n.dojoDocPane .package .requires{ }\n.dojoDocPane .package .requires h2{ }\n.dojoDocPane .package .requires .row{ }\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/DocPane.css&quot;), isContainer:true, fillInTemplate:function () {
+	this.requires = dojo.html.removeNode(this.requires);
+	this.rRow.style.display = &quot;none&quot;;
+	this.rRow2.style.display = &quot;none&quot;;
+	this.methods = dojo.html.removeNode(this.methods);
+	this.mRow.style.display = &quot;none&quot;;
+	this.dialog = dojo.widget.createWidget(&quot;dialog&quot;, {}, this.dialog);
+	this.dialog.setCloseControl(this.cancel);
+	dojo.html.setOpacity(this.dialogBg, 0.8);
+	dojo.html.setOpacity(this.dialogFg, 1);
+	dojo.event.connect(this.edit, &quot;onclick&quot;, dojo.lang.hitch(this, function () {
+		if (!this._isLoggedIn) {
+			this.dialog.show();
+		}
+	}));
+	dojo.event.connect(this.logIn, &quot;onclick&quot;, this, &quot;_logIn&quot;);
+	dojo.event.connect(this.save, &quot;onclick&quot;, this, &quot;_save&quot;);
+	dojo.event.connect(dojo.docs, &quot;logInSuccess&quot;, this, &quot;_loggedIn&quot;);
+	this.homeSave = this.containerNode.cloneNode(true);
+	this.detailSave = dojo.html.removeNode(this.detail);
+	this.resultSave = dojo.html.removeNode(this.result);
+	this.packageSave = dojo.html.removeNode(this.packag);
+	this.results = dojo.html.removeNode(this.results);
+	this.rowParent = this.row.parentNode;
+	this.rowSave = dojo.html.removeNode(this.row);
+	this.vParent = this.vRow.parentNode;
+	this.vSave = dojo.html.removeNode(this.vRow);
+	this.pParent = this.pRow.parentNode;
+	this.pSave = dojo.html.removeNode(this.pRow);
+	this.sPTypeSave = dojo.html.removeNode(this.sPType);
+	this.sPNameSave = dojo.html.removeNode(this.sPName);
+	this.navSave = dojo.html.removeNode(this.nav);
+}, _logIn:function () {
+	dojo.docs.setUserName(this.userName.value);
+	dojo.docs.setPassword(this.password.value);
+}, _loggedIn:function () {
+	this._isLoggedIn = true;
+	this.dialog.hide();
+	this.pkgEditor = dojo.widget.createWidget(&quot;editor2&quot;, {toolbarAlwaysVisible:true}, this.pkgDescription);
+}, _save:function () {
+	if (this.pkgEditor) {
+		dojo.docs.savePackage(this._pkgPath, {description:this.pkgEditor.getEditorContent()});
+	}
+}, onDocSelectFunction:function (message) {
+	dojo.debug(&quot;onDocSelectFunction()&quot;);
+	for (var key in message) {
+		dojo.debug(key + &quot;: &quot; + dojo.json.serialize(message[key]));
+	}
+	var meta = message.meta;
+	if (meta) {
+		var variables = meta.variables;
+		var this_variables = meta.this_variables;
+		var child_variables = meta.child_variables;
+		var parameters = meta.parameters;
+	}
+	var doc = message.doc;
+	dojo.debug(dojo.json.serialize(doc));
+	var appends = this._appends;
+	dojo.html.removeChildren(this.domNode);
+	this.fn.innerHTML = message.name;
+	this.variables.style.display = &quot;block&quot;;
+	var all = [];
+	if (variables) {
+		all = variables;
+	}
+	if (this_variables) {
+		all = all.concat(this_variables);
+	}
+	if (child_variables) {
+		all = all.concat(child_variables);
+	}
+	if (!all.length) {
+		this.variables.style.display = &quot;none&quot;;
+	} else {
+		for (var i = 0, one; one = all[i]; i++) {
+			this.vLink.innerHTML = one;
+			this.vDesc.parentNode.style.display = &quot;none&quot;;
+			appends.push(this.vParent.appendChild(this.vSave.cloneNode(true)));
+		}
+	}
+	this.sParams.innerHTML = &quot;&quot;;
+	var first = true;
+	for (var param in parameters) {
+		var paramType = parameters[param].type;
+		var paramSummary = parameters[param].summary;
+		var paramName = param;
+		this.parameters.style.display = &quot;block&quot;;
+		this.pLink.innerHTML = paramName;
+		this.pOpt.style.display = &quot;none&quot;;
+		if (parameters[param].opt) {
+			this.pOpt.style.display = &quot;inline&quot;;
+		}
+		this.pType.parentNode.style.display = &quot;none&quot;;
+		if (parameters[param][0]) {
+			this.pType.parentNode.style.display = &quot;inline&quot;;
+			this.pType.innerHTML = paramType;
+		}
+		this.pDesc.parentNode.style.display = &quot;none&quot;;
+		if (paramSummary) {
+			this.pDesc.parentNode.style.display = &quot;inline&quot;;
+			this.pDesc.innerHTML = paramSummary;
+		}
+		appends.push(this.pParent.appendChild(this.pSave.cloneNode(true)));
+		if (!first) {
+			this.sParams.appendChild(document.createTextNode(&quot;, &quot;));
+		}
+		first = false;
+		if (paramType) {
+			dojo.debug(this.sPTypeSave);
+			this.sPTypeSave.innerHTML = paramType;
+			this.sParams.appendChild(this.sPTypeSave.cloneNode(true));
+			this.sParams.appendChild(document.createTextNode(&quot; &quot;));
+		}
+		dojo.debug(this.sPNameSave);
+		this.sPNameSave.innerHTML = paramName;
+		this.sParams.appendChild(this.sPNameSave.cloneNode(true));
+	}
+	if (message.returns) {
+		this.sType.innerHTML = message.returns;
+	} else {
+		this.sType.innerHTML = &quot;void&quot;;
+	}
+	this.sName.innerHTML = message.name;
+	this.domNode.appendChild(this.navSave);
+	this.domNode.appendChild(this.detailSave.cloneNode(true));
+	for (var i = 0, append; append = appends[i]; i++) {
+		dojo.html.removeNode(append);
+	}
+}, onPkgResult:function (results) {
+	if (this.pkgEditor) {
+		this.pkgEditor.close(true);
+		dojo.debug(this.pkgDescription);
+	}
+	var methods = results.methods;
+	var requires = results.requires;
+	var description = results.description;
+	this._pkgPath = results.path;
+	var requireLinks = [];
+	var appends = this._appends;
+	while (appends.length) {
+		dojo.html.removeNode(appends.shift());
+	}
+	dojo.html.removeChildren(this.domNode);
+	this.pkg.innerHTML = results.pkg;
+	var hasRequires = false;
+	for (var env in requires) {
+		hasRequires = true;
+		this.rH3.style.display = &quot;none&quot;;
+		if (env != &quot;common&quot;) {
+			this.rH3.style.display = &quot;&quot;;
+			this.rH3.innerHTML = env;
+		}
+		for (var i = 0, require; require = requires[env][i]; i++) {
+			requireLinks.push({name:require});
+			this.rLink.innerHTML = require;
+			this.rLink.href = &quot;#&quot; + require;
+			var rRow2 = this.rRow2.parentNode.insertBefore(this.rRow2.cloneNode(true), this.rRow2);
+			rRow2.style.display = &quot;&quot;;
+			appends.push(rRow2);
+		}
+		var rRow = this.rRow.parentNode.insertBefore(this.rRow.cloneNode(true), this.rRow);
+		rRow.style.display = &quot;&quot;;
+		appends.push(rRow);
+	}
+	if (hasRequires) {
+		appends.push(this.packageSave.appendChild(this.requires.cloneNode(true)));
+	}
+	if (results.size) {
+		for (var i = 0, method; method = methods[i]; i++) {
+			this.mLink.innerHTML = method.name;
+			this.mLink.href = &quot;#&quot; + method.name;
+			this.mDesc.parentNode.style.display = &quot;none&quot;;
+			if (method.summary) {
+				this.mDesc.parentNode.style.display = &quot;inline&quot;;
+				this.mDesc.innerHTML = method.summary;
+			}
+			var mRow = this.mRow.parentNode.insertBefore(this.mRow.cloneNode(true), this.mRow);
+			mRow.style.display = &quot;&quot;;
+			appends.push(mRow);
+		}
+		appends.push(this.packageSave.appendChild(this.methods.cloneNode(true)));
+	}
+	this.domNode.appendChild(this.packageSave);
+	this.pkgDescription.innerHTML = description;
+	function makeSelect(fOrP, x) {
+		return function (e) {
+			dojo.event.topic.publish(&quot;/docs/&quot; + fOrP + &quot;/select&quot;, x);
+		};
+	}
+	var as = this.domNode.getElementsByTagName(&quot;a&quot;);
+	for (var i = 0, a; a = as[i]; i++) {
+		if (a.className == &quot;docMLink&quot;) {
+			dojo.event.connect(a, &quot;onclick&quot;, makeSelect(&quot;function&quot;, methods[i]));
+		} else {
+			if (a.className == &quot;docRLink&quot;) {
+				dojo.event.connect(a, &quot;onclick&quot;, makeSelect(&quot;package&quot;, requireLinks[i]));
+			}
+		}
+	}
+}, onDocResults:function (fns) {
+	dojo.debug(&quot;onDocResults(): called&quot;);
+	if (fns.length == 1) {
+		dojo.event.topic.publish(&quot;/docs/function/select&quot;, fns[0]);
+		return;
+	}
+	dojo.html.removeChildren(this.domNode);
+	this.count.innerHTML = fns.length;
+	var appends = [];
+	for (var i = 0, fn; fn = fns[i]; i++) {
+		this.fnLink.innerHTML = fn.name;
+		this.fnLink.href = &quot;#&quot; + fn.name;
+		if (fn.id) {
+			this.fnLink.href = this.fnLink.href + &quot;,&quot; + fn.id;
+		}
+		this.summary.parentNode.style.display = &quot;none&quot;;
+		if (fn.summary) {
+			this.summary.parentNode.style.display = &quot;inline&quot;;
+			this.summary.innerHTML = fn.summary;
+		}
+		appends.push(this.rowParent.appendChild(this.rowSave.cloneNode(true)));
+	}
+	function makeSelect(x) {
+		return function (e) {
+			dojo.event.topic.publish(&quot;/docs/function/select&quot;, x);
+		};
+	}
+	this.domNode.appendChild(this.resultSave.cloneNode(true));
+	var as = this.domNode.getElementsByTagName(&quot;a&quot;);
+	for (var i = 0, a; a = as[i]; i++) {
+		dojo.event.connect(a, &quot;onclick&quot;, makeSelect(fns[i]));
+	}
+	for (var i = 0, append; append = appends[i]; i++) {
+		this.rowParent.removeChild(append);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DomWidget.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DomWidget.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DomWidget.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,507 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DomWidget&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.Widget&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.xml.Parse&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.widget._cssFiles = {};
+dojo.widget._cssStrings = {};
+dojo.widget._templateCache = {};
+dojo.widget.defaultStrings = {dojoRoot:dojo.hostenv.getBaseScriptUri(), dojoWidgetModuleUri:dojo.uri.moduleUri(&quot;dojo.widget&quot;), baseScriptUri:dojo.hostenv.getBaseScriptUri()};
+dojo.widget.fillFromTemplateCache = function (obj, templatePath, templateString, avoidCache) {
+	var tpath = templatePath || obj.templatePath;
+	var tmplts = dojo.widget._templateCache;
+	if (!tpath &amp;&amp; !obj[&quot;widgetType&quot;]) {
+		do {
+			var dummyName = &quot;__dummyTemplate__&quot; + dojo.widget._templateCache.dummyCount++;
+		} while (tmplts[dummyName]);
+		obj.widgetType = dummyName;
+	}
+	var wt = tpath ? tpath.toString() : obj.widgetType;
+	var ts = tmplts[wt];
+	if (!ts) {
+		tmplts[wt] = {&quot;string&quot;:null, &quot;node&quot;:null};
+		if (avoidCache) {
+			ts = {};
+		} else {
+			ts = tmplts[wt];
+		}
+	}
+	if ((!obj.templateString) &amp;&amp; (!avoidCache)) {
+		obj.templateString = templateString || ts[&quot;string&quot;];
+	}
+	if (obj.templateString) {
+		obj.templateString = this._sanitizeTemplateString(obj.templateString);
+	}
+	if ((!obj.templateNode) &amp;&amp; (!avoidCache)) {
+		obj.templateNode = ts[&quot;node&quot;];
+	}
+	if ((!obj.templateNode) &amp;&amp; (!obj.templateString) &amp;&amp; (tpath)) {
+		var tstring = this._sanitizeTemplateString(dojo.hostenv.getText(tpath));
+		obj.templateString = tstring;
+		if (!avoidCache) {
+			tmplts[wt][&quot;string&quot;] = tstring;
+		}
+	}
+	if ((!ts[&quot;string&quot;]) &amp;&amp; (!avoidCache)) {
+		ts.string = obj.templateString;
+	}
+};
+dojo.widget._sanitizeTemplateString = function (tString) {
+	if (tString) {
+		tString = tString.replace(/^\s*&lt;\?xml(\s)+version=[\'\&quot;](\d)*.(\d)*[\'\&quot;](\s)*\?&gt;/im, &quot;&quot;);
+		var matches = tString.match(/&lt;body[^&gt;]*&gt;\s*([\s\S]+)\s*&lt;\/body&gt;/im);
+		if (matches) {
+			tString = matches[1];
+		}
+	} else {
+		tString = &quot;&quot;;
+	}
+	return tString;
+};
+dojo.widget._templateCache.dummyCount = 0;
+dojo.widget.attachProperties = [&quot;dojoAttachPoint&quot;, &quot;id&quot;];
+dojo.widget.eventAttachProperty = &quot;dojoAttachEvent&quot;;
+dojo.widget.onBuildProperty = &quot;dojoOnBuild&quot;;
+dojo.widget.waiNames = [&quot;waiRole&quot;, &quot;waiState&quot;];
+dojo.widget.wai = {waiRole:{name:&quot;waiRole&quot;, &quot;namespace&quot;:&quot;<A HREF="http://www.w3.org/TR/xhtml2">http://www.w3.org/TR/xhtml2</A>&quot;, alias:&quot;x2&quot;, prefix:&quot;wairole:&quot;}, waiState:{name:&quot;waiState&quot;, &quot;namespace&quot;:&quot;<A HREF="http://www.w3.org/2005/07/aaa">http://www.w3.org/2005/07/aaa</A>&quot;, alias:&quot;aaa&quot;, prefix:&quot;&quot;}, setAttr:function (node, ns, attr, value) {
+	if (dojo.render.html.ie) {
+		node.setAttribute(this[ns].alias + &quot;:&quot; + attr, this[ns].prefix + value);
+	} else {
+		node.setAttributeNS(this[ns][&quot;namespace&quot;], attr, this[ns].prefix + value);
+	}
+}, getAttr:function (node, ns, attr) {
+	if (dojo.render.html.ie) {
+		return node.getAttribute(this[ns].alias + &quot;:&quot; + attr);
+	} else {
+		return node.getAttributeNS(this[ns][&quot;namespace&quot;], attr);
+	}
+}, removeAttr:function (node, ns, attr) {
+	var success = true;
+	if (dojo.render.html.ie) {
+		success = node.removeAttribute(this[ns].alias + &quot;:&quot; + attr);
+	} else {
+		node.removeAttributeNS(this[ns][&quot;namespace&quot;], attr);
+	}
+	return success;
+}};
+dojo.widget.attachTemplateNodes = function (rootNode, targetObj, events) {
+	var elementNodeType = dojo.dom.ELEMENT_NODE;
+	function trim(str) {
+		return str.replace(/^\s+|\s+$/g, &quot;&quot;);
+	}
+	if (!rootNode) {
+		rootNode = targetObj.domNode;
+	}
+	if (rootNode.nodeType != elementNodeType) {
+		return;
+	}
+	var nodes = rootNode.all || rootNode.getElementsByTagName(&quot;*&quot;);
+	var _this = targetObj;
+	for (var x = -1; x &lt; nodes.length; x++) {
+		var baseNode = (x == -1) ? rootNode : nodes[x];
+		var attachPoint = [];
+		if (!targetObj.widgetsInTemplate || !baseNode.getAttribute(&quot;dojoType&quot;)) {
+			for (var y = 0; y &lt; this.attachProperties.length; y++) {
+				var tmpAttachPoint = baseNode.getAttribute(this.attachProperties[y]);
+				if (tmpAttachPoint) {
+					attachPoint = tmpAttachPoint.split(&quot;;&quot;);
+					for (var z = 0; z &lt; attachPoint.length; z++) {
+						if (dojo.lang.isArray(targetObj[attachPoint[z]])) {
+							targetObj[attachPoint[z]].push(baseNode);
+						} else {
+							targetObj[attachPoint[z]] = baseNode;
+						}
+					}
+					break;
+				}
+			}
+			var attachEvent = baseNode.getAttribute(this.eventAttachProperty);
+			if (attachEvent) {
+				var evts = attachEvent.split(&quot;;&quot;);
+				for (var y = 0; y &lt; evts.length; y++) {
+					if ((!evts[y]) || (!evts[y].length)) {
+						continue;
+					}
+					var thisFunc = null;
+					var tevt = trim(evts[y]);
+					if (evts[y].indexOf(&quot;:&quot;) &gt;= 0) {
+						var funcNameArr = tevt.split(&quot;:&quot;);
+						tevt = trim(funcNameArr[0]);
+						thisFunc = trim(funcNameArr[1]);
+					}
+					if (!thisFunc) {
+						thisFunc = tevt;
+					}
+					var tf = function () {
+						var ntf = new String(thisFunc);
+						return function (evt) {
+							if (_this[ntf]) {
+								_this[ntf](dojo.event.browser.fixEvent(evt, this));
+							}
+						};
+					}();
+					dojo.event.browser.addListener(baseNode, tevt, tf, false, true);
+				}
+			}
+			for (var y = 0; y &lt; events.length; y++) {
+				var evtVal = baseNode.getAttribute(events[y]);
+				if ((evtVal) &amp;&amp; (evtVal.length)) {
+					var thisFunc = null;
+					var domEvt = events[y].substr(4);
+					thisFunc = trim(evtVal);
+					var funcs = [thisFunc];
+					if (thisFunc.indexOf(&quot;;&quot;) &gt;= 0) {
+						funcs = dojo.lang.map(thisFunc.split(&quot;;&quot;), trim);
+					}
+					for (var z = 0; z &lt; funcs.length; z++) {
+						if (!funcs[z].length) {
+							continue;
+						}
+						var tf = function () {
+							var ntf = new String(funcs[z]);
+							return function (evt) {
+								if (_this[ntf]) {
+									_this[ntf](dojo.event.browser.fixEvent(evt, this));
+								}
+							};
+						}();
+						dojo.event.browser.addListener(baseNode, domEvt, tf, false, true);
+					}
+				}
+			}
+		}
+		var tmpltPoint = baseNode.getAttribute(this.templateProperty);
+		if (tmpltPoint) {
+			targetObj[tmpltPoint] = baseNode;
+		}
+		dojo.lang.forEach(dojo.widget.waiNames, function (name) {
+			var wai = dojo.widget.wai[name];
+			var val = baseNode.getAttribute(wai.name);
+			if (val) {
+				if (val.indexOf(&quot;-&quot;) == -1) {
+					dojo.widget.wai.setAttr(baseNode, wai.name, &quot;role&quot;, val);
+				} else {
+					var statePair = val.split(&quot;-&quot;);
+					dojo.widget.wai.setAttr(baseNode, wai.name, statePair[0], statePair[1]);
+				}
+			}
+		}, this);
+		var onBuild = baseNode.getAttribute(this.onBuildProperty);
+		if (onBuild) {
+			eval(&quot;var node = baseNode; var widget = targetObj; &quot; + onBuild);
+		}
+	}
+};
+dojo.widget.getDojoEventsFromStr = function (str) {
+	var re = /(dojoOn([a-z]+)(\s?))=/gi;
+	var evts = str ? str.match(re) || [] : [];
+	var ret = [];
+	var lem = {};
+	for (var x = 0; x &lt; evts.length; x++) {
+		if (evts[x].length &lt; 1) {
+			continue;
+		}
+		var cm = evts[x].replace(/\s/, &quot;&quot;);
+		cm = (cm.slice(0, cm.length - 1));
+		if (!lem[cm]) {
+			lem[cm] = true;
+			ret.push(cm);
+		}
+	}
+	return ret;
+};
+dojo.declare(&quot;dojo.widget.DomWidget&quot;, dojo.widget.Widget, function () {
+	if ((arguments.length &gt; 0) &amp;&amp; (typeof arguments[0] == &quot;object&quot;)) {
+		this.create(arguments[0]);
+	}
+}, {templateNode:null, templateString:null, templateCssString:null, preventClobber:false, domNode:null, containerNode:null, widgetsInTemplate:false, addChild:function (widget, overrideContainerNode, pos, ref, insertIndex) {
+	if (!this.isContainer) {
+		dojo.debug(&quot;dojo.widget.DomWidget.addChild() attempted on non-container widget&quot;);
+		return null;
+	} else {
+		if (insertIndex == undefined) {
+			insertIndex = this.children.length;
+		}
+		this.addWidgetAsDirectChild(widget, overrideContainerNode, pos, ref, insertIndex);
+		this.registerChild(widget, insertIndex);
+	}
+	return widget;
+}, addWidgetAsDirectChild:function (widget, overrideContainerNode, pos, ref, insertIndex) {
+	if ((!this.containerNode) &amp;&amp; (!overrideContainerNode)) {
+		this.containerNode = this.domNode;
+	}
+	var cn = (overrideContainerNode) ? overrideContainerNode : this.containerNode;
+	if (!pos) {
+		pos = &quot;after&quot;;
+	}
+	if (!ref) {
+		if (!cn) {
+			cn = dojo.body();
+		}
+		ref = cn.lastChild;
+	}
+	if (!insertIndex) {
+		insertIndex = 0;
+	}
+	widget.domNode.setAttribute(&quot;dojoinsertionindex&quot;, insertIndex);
+	if (!ref) {
+		cn.appendChild(widget.domNode);
+	} else {
+		if (pos == &quot;insertAtIndex&quot;) {
+			dojo.dom.insertAtIndex(widget.domNode, ref.parentNode, insertIndex);
+		} else {
+			if ((pos == &quot;after&quot;) &amp;&amp; (ref === cn.lastChild)) {
+				cn.appendChild(widget.domNode);
+			} else {
+				dojo.dom.insertAtPosition(widget.domNode, cn, pos);
+			}
+		}
+	}
+}, registerChild:function (widget, insertionIndex) {
+	widget.dojoInsertionIndex = insertionIndex;
+	var idx = -1;
+	for (var i = 0; i &lt; this.children.length; i++) {
+		if (this.children[i].dojoInsertionIndex &lt;= insertionIndex) {
+			idx = i;
+		}
+	}
+	this.children.splice(idx + 1, 0, widget);
+	widget.parent = this;
+	widget.addedTo(this, idx + 1);
+	delete dojo.widget.manager.topWidgets[widget.widgetId];
+}, removeChild:function (widget) {
+	dojo.dom.removeNode(widget.domNode);
+	return dojo.widget.DomWidget.superclass.removeChild.call(this, widget);
+}, getFragNodeRef:function (frag) {
+	if (!frag) {
+		return null;
+	}
+	if (!frag[this.getNamespacedType()]) {
+		dojo.raise(&quot;Error: no frag for widget type &quot; + this.getNamespacedType() + &quot;, id &quot; + this.widgetId + &quot; (maybe a widget has set it's type incorrectly)&quot;);
+	}
+	return frag[this.getNamespacedType()][&quot;nodeRef&quot;];
+}, postInitialize:function (args, frag, parentComp) {
+	var sourceNodeRef = this.getFragNodeRef(frag);
+	if (parentComp &amp;&amp; (parentComp.snarfChildDomOutput || !sourceNodeRef)) {
+		parentComp.addWidgetAsDirectChild(this, &quot;&quot;, &quot;insertAtIndex&quot;, &quot;&quot;, args[&quot;dojoinsertionindex&quot;], sourceNodeRef);
+	} else {
+		if (sourceNodeRef) {
+			if (this.domNode &amp;&amp; (this.domNode !== sourceNodeRef)) {
+				this._sourceNodeRef = dojo.dom.replaceNode(sourceNodeRef, this.domNode);
+			}
+		}
+	}
+	if (parentComp) {
+		parentComp.registerChild(this, args.dojoinsertionindex);
+	} else {
+		dojo.widget.manager.topWidgets[this.widgetId] = this;
+	}
+	if (this.widgetsInTemplate) {
+		var parser = new dojo.xml.Parse();
+		var subContainerNode;
+		var subnodes = this.domNode.getElementsByTagName(&quot;*&quot;);
+		for (var i = 0; i &lt; subnodes.length; i++) {
+			if (subnodes[i].getAttribute(&quot;dojoAttachPoint&quot;) == &quot;subContainerWidget&quot;) {
+				subContainerNode = subnodes[i];
+			}
+			if (subnodes[i].getAttribute(&quot;dojoType&quot;)) {
+				subnodes[i].setAttribute(&quot;isSubWidget&quot;, true);
+			}
+		}
+		if (this.isContainer &amp;&amp; !this.containerNode) {
+			if (subContainerNode) {
+				var src = this.getFragNodeRef(frag);
+				if (src) {
+					dojo.dom.moveChildren(src, subContainerNode);
+					frag[&quot;dojoDontFollow&quot;] = true;
+				}
+			} else {
+				dojo.debug(&quot;No subContainerWidget node can be found in template file for widget &quot; + this);
+			}
+		}
+		var templatefrag = parser.parseElement(this.domNode, null, true);
+		dojo.widget.getParser().createSubComponents(templatefrag, this);
+		var subwidgets = [];
+		var stack = [this];
+		var w;
+		while ((w = stack.pop())) {
+			for (var i = 0; i &lt; w.children.length; i++) {
+				var cwidget = w.children[i];
+				if (cwidget._processedSubWidgets || !cwidget.extraArgs[&quot;issubwidget&quot;]) {
+					continue;
+				}
+				subwidgets.push(cwidget);
+				if (cwidget.isContainer) {
+					stack.push(cwidget);
+				}
+			}
+		}
+		for (var i = 0; i &lt; subwidgets.length; i++) {
+			var widget = subwidgets[i];
+			if (widget._processedSubWidgets) {
+				dojo.debug(&quot;This should not happen: widget._processedSubWidgets is already true!&quot;);
+				return;
+			}
+			widget._processedSubWidgets = true;
+			if (widget.extraArgs[&quot;dojoattachevent&quot;]) {
+				var evts = widget.extraArgs[&quot;dojoattachevent&quot;].split(&quot;;&quot;);
+				for (var j = 0; j &lt; evts.length; j++) {
+					var thisFunc = null;
+					var tevt = dojo.string.trim(evts[j]);
+					if (tevt.indexOf(&quot;:&quot;) &gt;= 0) {
+						var funcNameArr = tevt.split(&quot;:&quot;);
+						tevt = dojo.string.trim(funcNameArr[0]);
+						thisFunc = dojo.string.trim(funcNameArr[1]);
+					}
+					if (!thisFunc) {
+						thisFunc = tevt;
+					}
+					if (dojo.lang.isFunction(widget[tevt])) {
+						dojo.event.kwConnect({srcObj:widget, srcFunc:tevt, targetObj:this, targetFunc:thisFunc});
+					} else {
+						alert(tevt + &quot; is not a function in widget &quot; + widget);
+					}
+				}
+			}
+			if (widget.extraArgs[&quot;dojoattachpoint&quot;]) {
+				this[widget.extraArgs[&quot;dojoattachpoint&quot;]] = widget;
+			}
+		}
+	}
+	if (this.isContainer &amp;&amp; !frag[&quot;dojoDontFollow&quot;]) {
+		dojo.widget.getParser().createSubComponents(frag, this);
+	}
+}, buildRendering:function (args, frag) {
+	var ts = dojo.widget._templateCache[this.widgetType];
+	if (args[&quot;templatecsspath&quot;]) {
+		args[&quot;templateCssPath&quot;] = args[&quot;templatecsspath&quot;];
+	}
+	var cpath = args[&quot;templateCssPath&quot;] || this.templateCssPath;
+	if (cpath &amp;&amp; !dojo.widget._cssFiles[cpath.toString()]) {
+		if ((!this.templateCssString) &amp;&amp; (cpath)) {
+			this.templateCssString = dojo.hostenv.getText(cpath);
+			this.templateCssPath = null;
+		}
+		dojo.widget._cssFiles[cpath.toString()] = true;
+	}
+	if ((this[&quot;templateCssString&quot;]) &amp;&amp; (!dojo.widget._cssStrings[this.templateCssString])) {
+		dojo.html.insertCssText(this.templateCssString, null, cpath);
+		dojo.widget._cssStrings[this.templateCssString] = true;
+	}
+	if ((!this.preventClobber) &amp;&amp; ((this.templatePath) || (this.templateNode) || ((this[&quot;templateString&quot;]) &amp;&amp; (this.templateString.length)) || ((typeof ts != &quot;undefined&quot;) &amp;&amp; ((ts[&quot;string&quot;]) || (ts[&quot;node&quot;]))))) {
+		this.buildFromTemplate(args, frag);
+	} else {
+		this.domNode = this.getFragNodeRef(frag);
+	}
+	this.fillInTemplate(args, frag);
+}, buildFromTemplate:function (args, frag) {
+	var avoidCache = false;
+	if (args[&quot;templatepath&quot;]) {
+		args[&quot;templatePath&quot;] = args[&quot;templatepath&quot;];
+	}
+	dojo.widget.fillFromTemplateCache(this, args[&quot;templatePath&quot;], null, avoidCache);
+	var ts = dojo.widget._templateCache[this.templatePath ? this.templatePath.toString() : this.widgetType];
+	if ((ts) &amp;&amp; (!avoidCache)) {
+		if (!this.templateString.length) {
+			this.templateString = ts[&quot;string&quot;];
+		}
+		if (!this.templateNode) {
+			this.templateNode = ts[&quot;node&quot;];
+		}
+	}
+	var matches = false;
+	var node = null;
+	var tstr = this.templateString;
+	if ((!this.templateNode) &amp;&amp; (this.templateString)) {
+		matches = this.templateString.match(/\$\{([^\}]+)\}/g);
+		if (matches) {
+			var hash = this.strings || {};
+			for (var key in dojo.widget.defaultStrings) {
+				if (dojo.lang.isUndefined(hash[key])) {
+					hash[key] = dojo.widget.defaultStrings[key];
+				}
+			}
+			for (var i = 0; i &lt; matches.length; i++) {
+				var key = matches[i];
+				key = key.substring(2, key.length - 1);
+				var kval = (key.substring(0, 5) == &quot;this.&quot;) ? dojo.lang.getObjPathValue(key.substring(5), this) : hash[key];
+				var value;
+				if ((kval) || (dojo.lang.isString(kval))) {
+					value = new String((dojo.lang.isFunction(kval)) ? kval.call(this, key, this.templateString) : kval);
+					while (value.indexOf(&quot;\&quot;&quot;) &gt; -1) {
+						value = value.replace(&quot;\&quot;&quot;, &quot;&quot;&quot;);
+					}
+					tstr = tstr.replace(matches[i], value);
+				}
+			}
+		} else {
+			this.templateNode = this.createNodesFromText(this.templateString, true)[0];
+			if (!avoidCache) {
+				ts.node = this.templateNode;
+			}
+		}
+	}
+	if ((!this.templateNode) &amp;&amp; (!matches)) {
+		dojo.debug(&quot;DomWidget.buildFromTemplate: could not create template&quot;);
+		return false;
+	} else {
+		if (!matches) {
+			node = this.templateNode.cloneNode(true);
+			if (!node) {
+				return false;
+			}
+		} else {
+			node = this.createNodesFromText(tstr, true)[0];
+		}
+	}
+	this.domNode = node;
+	this.attachTemplateNodes();
+	if (this.isContainer &amp;&amp; this.containerNode) {
+		var src = this.getFragNodeRef(frag);
+		if (src) {
+			dojo.dom.moveChildren(src, this.containerNode);
+		}
+	}
+}, attachTemplateNodes:function (baseNode, targetObj) {
+	if (!baseNode) {
+		baseNode = this.domNode;
+	}
+	if (!targetObj) {
+		targetObj = this;
+	}
+	return dojo.widget.attachTemplateNodes(baseNode, targetObj, dojo.widget.getDojoEventsFromStr(this.templateString));
+}, fillInTemplate:function () {
+}, destroyRendering:function () {
+	try {
+		dojo.dom.destroyNode(this.domNode);
+		delete this.domNode;
+	}
+	catch (e) {
+	}
+	if (this._sourceNodeRef) {
+		try {
+			dojo.dom.destroyNode(this._sourceNodeRef);
+		}
+		catch (e) {
+		}
+	}
+}, createNodesFromText:function () {
+	dojo.unimplemented(&quot;dojo.widget.DomWidget.createNodesFromText&quot;);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DropdownContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DropdownContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DropdownContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,65 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DropdownContainer&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.PopupContainer&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.iframe&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.DropdownContainer&quot;, dojo.widget.HtmlWidget, {inputWidth:&quot;7em&quot;, id:&quot;&quot;, inputId:&quot;&quot;, inputName:&quot;&quot;, iconURL:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/combo_box_arrow.png&quot;), copyClasses:false, iconAlt:&quot;&quot;, containerToggle:&quot;plain&quot;, containerToggleDuration:150, templateString:&quot;&lt;span style=\&quot;white-space:nowrap\&quot;&gt;&lt;input type=\&quot;hidden\&quot; name=\&quot;\&quot; value=\&quot;\&quot; dojoAttachPoint=\&quot;valueNode\&quot; /&gt;&lt;input name=\&quot;\&quot; type=\&quot;text\&quot; value=\&quot;\&quot; style=\&quot;vertical-align:middle;\&quot; dojoAttachPoint=\&quot;inputNode\&quot; autocomplete=\&quot;off\&quot; /&gt; &lt;img src=\&quot;${this.iconURL}\&quot; alt=\&quot;${this.iconAlt}\&quot; dojoAttachEvent=\&quot;onclick:onIconClick\&quot; dojoAttachPoint=\&quot;buttonNode\&quot; style=\&quot;vertical-align:middle; cursor:pointer; cursor:hand\&quot; /&gt;&lt;/span&gt;&quot;, templateCssPath:&quot;&quot;, isContainer:true, attachTemplateNodes:function () {
+	dojo.widget.DropdownContainer.superclass.attachTemplateNodes.apply(this, arguments);
+	this.popup = dojo.widget.createWidget(&quot;PopupContainer&quot;, {toggle:this.containerToggle, toggleDuration:this.containerToggleDuration});
+	this.containerNode = this.popup.domNode;
+}, fillInTemplate:function (args, frag) {
+	this.domNode.appendChild(this.popup.domNode);
+	if (this.id) {
+		this.domNode.id = this.id;
+	}
+	if (this.inputId) {
+		this.inputNode.id = this.inputId;
+	}
+	if (this.inputName) {
+		this.inputNode.name = this.inputName;
+	}
+	this.inputNode.style.width = this.inputWidth;
+	this.inputNode.disabled = this.disabled;
+	if (this.copyClasses) {
+		this.inputNode.style = &quot;&quot;;
+		this.inputNode.className = this.getFragNodeRef(frag).className;
+	}
+	dojo.event.connect(this.inputNode, &quot;onchange&quot;, this, &quot;onInputChange&quot;);
+}, onIconClick:function (evt) {
+	if (this.disabled) {
+		return;
+	}
+	if (!this.popup.isShowingNow) {
+		this.popup.open(this.inputNode, this, this.buttonNode);
+	} else {
+		this.popup.close();
+	}
+}, hideContainer:function () {
+	if (this.popup.isShowingNow) {
+		this.popup.close();
+	}
+}, onInputChange:function () {
+}, enable:function () {
+	this.inputNode.disabled = false;
+	dojo.widget.DropdownContainer.superclass.enable.apply(this, arguments);
+}, disable:function () {
+	this.inputNode.disabled = true;
+	dojo.widget.DropdownContainer.superclass.disable.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DropdownDatePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DropdownDatePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DropdownDatePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,110 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DropdownDatePicker&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.DropdownContainer&quot;);
+dojo.require(&quot;dojo.widget.DatePicker&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.date.serialize&quot;);
+dojo.require(&quot;dojo.string.common&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.requireLocalization(&quot;dojo.widget&quot;, &quot;DropdownDatePicker&quot;, null, &quot;ROOT&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.DropdownDatePicker&quot;, dojo.widget.DropdownContainer, {iconURL:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/dateIcon.gif&quot;), formatLength:&quot;short&quot;, displayFormat:&quot;&quot;, saveFormat:&quot;&quot;, value:&quot;&quot;, name:&quot;&quot;, displayWeeks:6, adjustWeeks:false, startDate:&quot;1492-10-12&quot;, endDate:&quot;2941-10-12&quot;, weekStartsOn:&quot;&quot;, staticDisplay:false, postMixInProperties:function (localProperties, frag) {
+	dojo.widget.DropdownDatePicker.superclass.postMixInProperties.apply(this, arguments);
+	var messages = dojo.i18n.getLocalization(&quot;dojo.widget&quot;, &quot;DropdownDatePicker&quot;, this.lang);
+	this.iconAlt = messages.selectDate;
+	if (typeof (this.value) == &quot;string&quot; &amp;&amp; this.value.toLowerCase() == &quot;today&quot;) {
+		this.value = new Date();
+	}
+	if (this.value &amp;&amp; isNaN(this.value)) {
+		var orig = this.value;
+		this.value = dojo.date.fromRfc3339(this.value);
+		if (!this.value) {
+			this.value = new Date(orig);
+			dojo.deprecated(&quot;dojo.widget.DropdownDatePicker&quot;, &quot;date attributes must be passed in Rfc3339 format&quot;, &quot;0.5&quot;);
+		}
+	}
+	if (this.value &amp;&amp; !isNaN(this.value)) {
+		this.value = new Date(this.value);
+	}
+}, fillInTemplate:function (args, frag) {
+	dojo.widget.DropdownDatePicker.superclass.fillInTemplate.call(this, args, frag);
+	var dpArgs = {widgetContainerId:this.widgetId, lang:this.lang, value:this.value, startDate:this.startDate, endDate:this.endDate, displayWeeks:this.displayWeeks, weekStartsOn:this.weekStartsOn, adjustWeeks:this.adjustWeeks, staticDisplay:this.staticDisplay};
+	this.datePicker = dojo.widget.createWidget(&quot;DatePicker&quot;, dpArgs, this.containerNode, &quot;child&quot;);
+	dojo.event.connect(this.datePicker, &quot;onValueChanged&quot;, this, &quot;_updateText&quot;);
+	dojo.event.connect(this.inputNode, &quot;onChange&quot;, this, &quot;_updateText&quot;);
+	if (this.value) {
+		this._updateText();
+	}
+	this.containerNode.explodeClassName = &quot;calendarBodyContainer&quot;;
+	this.valueNode.name = this.name;
+}, getValue:function () {
+	return this.valueNode.value;
+}, getDate:function () {
+	return this.datePicker.value;
+}, setValue:function (rfcDate) {
+	this.setDate(rfcDate);
+}, setDate:function (dateObj) {
+	this.datePicker.setDate(dateObj);
+	this._syncValueNode();
+}, _updateText:function () {
+	this.inputNode.value = this.datePicker.value ? dojo.date.format(this.datePicker.value, {formatLength:this.formatLength, datePattern:this.displayFormat, selector:&quot;dateOnly&quot;, locale:this.lang}) : &quot;&quot;;
+	if (this.value &lt; this.datePicker.startDate || this.value &gt; this.datePicker.endDate) {
+		this.inputNode.value = &quot;&quot;;
+	}
+	this._syncValueNode();
+	this.onValueChanged(this.getDate());
+	this.hideContainer();
+}, onValueChanged:function (dateObj) {
+}, onInputChange:function () {
+	var input = dojo.string.trim(this.inputNode.value);
+	if (input) {
+		var inputDate = dojo.date.parse(input, {formatLength:this.formatLength, datePattern:this.displayFormat, selector:&quot;dateOnly&quot;, locale:this.lang});
+		if (!this.datePicker._isDisabledDate(inputDate)) {
+			this.setDate(inputDate);
+		}
+	} else {
+		if (input == &quot;&quot;) {
+			this.datePicker.setDate(&quot;&quot;);
+		}
+		this.valueNode.value = input;
+	}
+	if (input) {
+		this._updateText();
+	}
+}, _syncValueNode:function () {
+	var date = this.datePicker.value;
+	var value = &quot;&quot;;
+	switch (this.saveFormat.toLowerCase()) {
+	  case &quot;rfc&quot;:
+	  case &quot;iso&quot;:
+	  case &quot;&quot;:
+		value = dojo.date.toRfc3339(date, &quot;dateOnly&quot;);
+		break;
+	  case &quot;posix&quot;:
+	  case &quot;unix&quot;:
+		value = Number(date);
+		break;
+	  default:
+		if (date) {
+			value = dojo.date.format(date, {datePattern:this.saveFormat, selector:&quot;dateOnly&quot;, locale:this.lang});
+		}
+	}
+	this.valueNode.value = value;
+}, destroy:function (finalize) {
+	this.datePicker.destroy(finalize);
+	dojo.widget.DropdownDatePicker.superclass.destroy.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/DropdownTimePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/DropdownTimePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/DropdownTimePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,156 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.DropdownTimePicker&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.DropdownContainer&quot;);
+dojo.require(&quot;dojo.widget.TimePicker&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.date.serialize&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.requireLocalization(&quot;dojo.widget&quot;, &quot;DropdownTimePicker&quot;, null, &quot;ROOT&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.DropdownTimePicker&quot;, dojo.widget.DropdownContainer, {iconURL:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/timeIcon.gif&quot;), formatLength:&quot;short&quot;, displayFormat:&quot;&quot;, timeFormat:&quot;&quot;, saveFormat:&quot;&quot;, value:&quot;&quot;, name:&quot;&quot;, postMixInProperties:function () {
+	dojo.widget.DropdownTimePicker.superclass.postMixInProperties.apply(this, arguments);
+	var messages = dojo.i18n.getLocalization(&quot;dojo.widget&quot;, &quot;DropdownTimePicker&quot;, this.lang);
+	this.iconAlt = messages.selectTime;
+	if (typeof (this.value) == &quot;string&quot; &amp;&amp; this.value.toLowerCase() == &quot;today&quot;) {
+		this.value = new Date();
+	}
+	if (this.value &amp;&amp; isNaN(this.value)) {
+		var orig = this.value;
+		this.value = dojo.date.fromRfc3339(this.value);
+		if (!this.value) {
+			var d = dojo.date.format(new Date(), {selector:&quot;dateOnly&quot;, datePattern:&quot;yyyy-MM-dd&quot;});
+			var c = orig.split(&quot;:&quot;);
+			for (var i = 0; i &lt; c.length; ++i) {
+				if (c[i].length == 1) {
+					c[i] = &quot;0&quot; + c[i];
+				}
+			}
+			orig = c.join(&quot;:&quot;);
+			this.value = dojo.date.fromRfc3339(d + &quot;T&quot; + orig);
+			dojo.deprecated(&quot;dojo.widget.DropdownTimePicker&quot;, &quot;time attributes must be passed in Rfc3339 format&quot;, &quot;0.5&quot;);
+		}
+	}
+	if (this.value &amp;&amp; !isNaN(this.value)) {
+		this.value = new Date(this.value);
+	}
+}, fillInTemplate:function () {
+	dojo.widget.DropdownTimePicker.superclass.fillInTemplate.apply(this, arguments);
+	var value = &quot;&quot;;
+	if (this.value instanceof Date) {
+		value = this.value;
+	} else {
+		if (this.value) {
+			var orig = this.value;
+			var d = dojo.date.format(new Date(), {selector:&quot;dateOnly&quot;, datePattern:&quot;yyyy-MM-dd&quot;});
+			var c = orig.split(&quot;:&quot;);
+			for (var i = 0; i &lt; c.length; ++i) {
+				if (c[i].length == 1) {
+					c[i] = &quot;0&quot; + c[i];
+				}
+			}
+			orig = c.join(&quot;:&quot;);
+			value = dojo.date.fromRfc3339(d + &quot;T&quot; + orig);
+		}
+	}
+	var tpArgs = {widgetContainerId:this.widgetId, lang:this.lang, value:value};
+	this.timePicker = dojo.widget.createWidget(&quot;TimePicker&quot;, tpArgs, this.containerNode, &quot;child&quot;);
+	dojo.event.connect(this.timePicker, &quot;onValueChanged&quot;, this, &quot;_updateText&quot;);
+	if (this.value) {
+		this._updateText();
+	}
+	this.containerNode.style.zIndex = this.zIndex;
+	this.containerNode.explodeClassName = &quot;timeContainer&quot;;
+	this.valueNode.name = this.name;
+}, getValue:function () {
+	return this.valueNode.value;
+}, getTime:function () {
+	return this.timePicker.storedTime;
+}, setValue:function (rfcDate) {
+	this.setTime(rfcDate);
+}, setTime:function (dateObj) {
+	var value = &quot;&quot;;
+	if (dateObj instanceof Date) {
+		value = dateObj;
+	} else {
+		if (this.value) {
+			var orig = this.value;
+			var d = dojo.date.format(new Date(), {selector:&quot;dateOnly&quot;, datePattern:&quot;yyyy-MM-dd&quot;});
+			var c = orig.split(&quot;:&quot;);
+			for (var i = 0; i &lt; c.length; ++i) {
+				if (c[i].length == 1) {
+					c[i] = &quot;0&quot; + c[i];
+				}
+			}
+			orig = c.join(&quot;:&quot;);
+			value = dojo.date.fromRfc3339(d + &quot;T&quot; + orig);
+		}
+	}
+	this.timePicker.setTime(value);
+	this._syncValueNode();
+}, _updateText:function () {
+	if (this.timePicker.selectedTime.anyTime) {
+		this.inputNode.value = &quot;&quot;;
+	} else {
+		if (this.timeFormat) {
+			dojo.deprecated(&quot;dojo.widget.DropdownTimePicker&quot;, &quot;Must use displayFormat attribute instead of timeFormat.  See dojo.date.format for specification.&quot;, &quot;0.5&quot;);
+			this.inputNode.value = dojo.date.strftime(this.timePicker.time, this.timeFormat, this.lang);
+		} else {
+			this.inputNode.value = dojo.date.format(this.timePicker.time, {formatLength:this.formatLength, timePattern:this.displayFormat, selector:&quot;timeOnly&quot;, locale:this.lang});
+		}
+	}
+	this._syncValueNode();
+	this.onValueChanged(this.getTime());
+	this.hideContainer();
+}, onValueChanged:function (dateObj) {
+}, onInputChange:function () {
+	if (this.dateFormat) {
+		dojo.deprecated(&quot;dojo.widget.DropdownTimePicker&quot;, &quot;Cannot parse user input.  Must use displayFormat attribute instead of dateFormat.  See dojo.date.format for specification.&quot;, &quot;0.5&quot;);
+	} else {
+		var input = dojo.string.trim(this.inputNode.value);
+		if (input) {
+			var inputTime = dojo.date.parse(input, {formatLength:this.formatLength, timePattern:this.displayFormat, selector:&quot;timeOnly&quot;, locale:this.lang});
+			if (inputTime) {
+				this.setTime(inputTime);
+			}
+		} else {
+			this.valueNode.value = input;
+		}
+	}
+	if (input) {
+		this._updateText();
+	}
+}, _syncValueNode:function () {
+	var time = this.timePicker.time;
+	var value;
+	switch (this.saveFormat.toLowerCase()) {
+	  case &quot;rfc&quot;:
+	  case &quot;iso&quot;:
+	  case &quot;&quot;:
+		value = dojo.date.toRfc3339(time, &quot;timeOnly&quot;);
+		break;
+	  case &quot;posix&quot;:
+	  case &quot;unix&quot;:
+		value = Number(time);
+		break;
+	  default:
+		value = dojo.date.format(time, {datePattern:this.saveFormat, selector:&quot;timeOnly&quot;, locale:this.lang});
+	}
+	this.valueNode.value = value;
+}, destroy:function (finalize) {
+	this.timePicker.destroy(finalize);
+	dojo.widget.DropdownTimePicker.superclass.destroy.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,390 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor&quot;);
+dojo.deprecated(&quot;dojo.widget.Editor&quot;, &quot;is replaced by dojo.widget.Editor2&quot;, &quot;0.5&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.Toolbar&quot;);
+dojo.require(&quot;dojo.widget.RichText&quot;);
+dojo.require(&quot;dojo.widget.ColorPalette&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.widget.tags.addParseTreeHandler(&quot;dojo:Editor&quot;);
+dojo.widget.Editor = function () {
+	dojo.widget.HtmlWidget.call(this);
+	this.contentFilters = [];
+	this._toolbars = [];
+};
+dojo.inherits(dojo.widget.Editor, dojo.widget.HtmlWidget);
+dojo.widget.Editor.itemGroups = {textGroup:[&quot;bold&quot;, &quot;italic&quot;, &quot;underline&quot;, &quot;strikethrough&quot;], blockGroup:[&quot;formatBlock&quot;, &quot;fontName&quot;, &quot;fontSize&quot;], justifyGroup:[&quot;justifyleft&quot;, &quot;justifycenter&quot;, &quot;justifyright&quot;], commandGroup:[&quot;save&quot;, &quot;cancel&quot;], colorGroup:[&quot;forecolor&quot;, &quot;hilitecolor&quot;], listGroup:[&quot;insertorderedlist&quot;, &quot;insertunorderedlist&quot;], indentGroup:[&quot;outdent&quot;, &quot;indent&quot;], linkGroup:[&quot;createlink&quot;, &quot;insertimage&quot;, &quot;inserthorizontalrule&quot;]};
+dojo.widget.Editor.formatBlockValues = {&quot;Normal&quot;:&quot;p&quot;, &quot;Main heading&quot;:&quot;h2&quot;, &quot;Sub heading&quot;:&quot;h3&quot;, &quot;Sub sub heading&quot;:&quot;h4&quot;, &quot;Preformatted&quot;:&quot;pre&quot;};
+dojo.widget.Editor.fontNameValues = {&quot;Arial&quot;:&quot;Arial, Helvetica, sans-serif&quot;, &quot;Verdana&quot;:&quot;Verdana, sans-serif&quot;, &quot;Times New Roman&quot;:&quot;Times New Roman, serif&quot;, &quot;Courier&quot;:&quot;Courier New, monospace&quot;};
+dojo.widget.Editor.fontSizeValues = {&quot;1 (8 pt)&quot;:&quot;1&quot;, &quot;2 (10 pt)&quot;:&quot;2&quot;, &quot;3 (12 pt)&quot;:&quot;3&quot;, &quot;4 (14 pt)&quot;:&quot;4&quot;, &quot;5 (18 pt)&quot;:&quot;5&quot;, &quot;6 (24 pt)&quot;:&quot;6&quot;, &quot;7 (36 pt)&quot;:&quot;7&quot;};
+dojo.widget.Editor.defaultItems = [&quot;commandGroup&quot;, &quot;|&quot;, &quot;blockGroup&quot;, &quot;|&quot;, &quot;textGroup&quot;, &quot;|&quot;, &quot;colorGroup&quot;, &quot;|&quot;, &quot;justifyGroup&quot;, &quot;|&quot;, &quot;listGroup&quot;, &quot;indentGroup&quot;, &quot;|&quot;, &quot;linkGroup&quot;];
+dojo.widget.Editor.supportedCommands = [&quot;save&quot;, &quot;cancel&quot;, &quot;|&quot;, &quot;-&quot;, &quot;/&quot;, &quot; &quot;];
+dojo.lang.extend(dojo.widget.Editor, {widgetType:&quot;Editor&quot;, saveUrl:&quot;&quot;, saveMethod:&quot;post&quot;, saveArgName:&quot;editorContent&quot;, closeOnSave:false, items:dojo.widget.Editor.defaultItems, formatBlockItems:dojo.lang.shallowCopy(dojo.widget.Editor.formatBlockValues), fontNameItems:dojo.lang.shallowCopy(dojo.widget.Editor.fontNameValues), fontSizeItems:dojo.lang.shallowCopy(dojo.widget.Editor.fontSizeValues), getItemProperties:function (name) {
+	var props = {};
+	switch (name.toLowerCase()) {
+	  case &quot;bold&quot;:
+	  case &quot;italic&quot;:
+	  case &quot;underline&quot;:
+	  case &quot;strikethrough&quot;:
+		props.toggleItem = true;
+		break;
+	  case &quot;justifygroup&quot;:
+		props.defaultButton = &quot;justifyleft&quot;;
+		props.preventDeselect = true;
+		props.buttonGroup = true;
+		break;
+	  case &quot;listgroup&quot;:
+		props.buttonGroup = true;
+		break;
+	  case &quot;save&quot;:
+	  case &quot;cancel&quot;:
+		props.label = dojo.string.capitalize(name);
+		break;
+	  case &quot;forecolor&quot;:
+	  case &quot;hilitecolor&quot;:
+		props.name = name;
+		props.toggleItem = true;
+		props.icon = this.getCommandImage(name);
+		break;
+	  case &quot;formatblock&quot;:
+		props.name = &quot;formatBlock&quot;;
+		props.values = this.formatBlockItems;
+		break;
+	  case &quot;fontname&quot;:
+		props.name = &quot;fontName&quot;;
+		props.values = this.fontNameItems;
+	  case &quot;fontsize&quot;:
+		props.name = &quot;fontSize&quot;;
+		props.values = this.fontSizeItems;
+	}
+	return props;
+}, validateItems:true, focusOnLoad:true, minHeight:&quot;1em&quot;, _richText:null, _richTextType:&quot;RichText&quot;, _toolbarContainer:null, _toolbarContainerType:&quot;ToolbarContainer&quot;, _toolbars:[], _toolbarType:&quot;Toolbar&quot;, _toolbarItemType:&quot;ToolbarItem&quot;, buildRendering:function (args, frag) {
+	var node = frag[&quot;dojo:&quot; + this.widgetType.toLowerCase()][&quot;nodeRef&quot;];
+	var trt = dojo.widget.createWidget(this._richTextType, {focusOnLoad:this.focusOnLoad, minHeight:this.minHeight}, node);
+	var _this = this;
+	setTimeout(function () {
+		_this.setRichText(trt);
+		_this.initToolbar();
+		_this.fillInTemplate(args, frag);
+	}, 0);
+}, setRichText:function (richText) {
+	if (this._richText &amp;&amp; this._richText == richText) {
+		dojo.debug(&quot;Already set the richText to this richText!&quot;);
+		return;
+	}
+	if (this._richText &amp;&amp; !this._richText.isClosed) {
+		dojo.debug(&quot;You are switching richTexts yet you haven't closed the current one. Losing reference!&quot;);
+	}
+	this._richText = richText;
+	dojo.event.connect(this._richText, &quot;close&quot;, this, &quot;onClose&quot;);
+	dojo.event.connect(this._richText, &quot;onLoad&quot;, this, &quot;onLoad&quot;);
+	dojo.event.connect(this._richText, &quot;onDisplayChanged&quot;, this, &quot;updateToolbar&quot;);
+	if (this._toolbarContainer) {
+		this._toolbarContainer.enable();
+		this.updateToolbar(true);
+	}
+}, initToolbar:function () {
+	if (this._toolbarContainer) {
+		return;
+	}
+	this._toolbarContainer = dojo.widget.createWidget(this._toolbarContainerType);
+	var tb = this.addToolbar();
+	var last = true;
+	for (var i = 0; i &lt; this.items.length; i++) {
+		if (this.items[i] == &quot;\n&quot;) {
+			tb = this.addToolbar();
+		} else {
+			if ((this.items[i] == &quot;|&quot;) &amp;&amp; (!last)) {
+				last = true;
+			} else {
+				last = this.addItem(this.items[i], tb);
+			}
+		}
+	}
+	this.insertToolbar(this._toolbarContainer.domNode, this._richText.domNode);
+}, insertToolbar:function (tbNode, richTextNode) {
+	dojo.html.insertBefore(tbNode, richTextNode);
+}, addToolbar:function (toolbar) {
+	this.initToolbar();
+	if (!(toolbar instanceof dojo.widget.Toolbar)) {
+		toolbar = dojo.widget.createWidget(this._toolbarType);
+	}
+	this._toolbarContainer.addChild(toolbar);
+	this._toolbars.push(toolbar);
+	return toolbar;
+}, addItem:function (item, tb, dontValidate) {
+	if (!tb) {
+		tb = this._toolbars[0];
+	}
+	var cmd = ((item) &amp;&amp; (!dojo.lang.isUndefined(item[&quot;getValue&quot;]))) ? cmd = item[&quot;getValue&quot;]() : item;
+	var groups = dojo.widget.Editor.itemGroups;
+	if (item instanceof dojo.widget.ToolbarItem) {
+		tb.addChild(item);
+	} else {
+		if (groups[cmd]) {
+			var group = groups[cmd];
+			var worked = true;
+			if (cmd == &quot;justifyGroup&quot; || cmd == &quot;listGroup&quot;) {
+				var btnGroup = [cmd];
+				for (var i = 0; i &lt; group.length; i++) {
+					if (dontValidate || this.isSupportedCommand(group[i])) {
+						btnGroup.push(this.getCommandImage(group[i]));
+					} else {
+						worked = false;
+					}
+				}
+				if (btnGroup.length) {
+					var btn = tb.addChild(btnGroup, null, this.getItemProperties(cmd));
+					dojo.event.connect(btn, &quot;onClick&quot;, this, &quot;_action&quot;);
+					dojo.event.connect(btn, &quot;onChangeSelect&quot;, this, &quot;_action&quot;);
+				}
+				return worked;
+			} else {
+				for (var i = 0; i &lt; group.length; i++) {
+					if (!this.addItem(group[i], tb)) {
+						worked = false;
+					}
+				}
+				return worked;
+			}
+		} else {
+			if ((!dontValidate) &amp;&amp; (!this.isSupportedCommand(cmd))) {
+				return false;
+			}
+			if (dontValidate || this.isSupportedCommand(cmd)) {
+				cmd = cmd.toLowerCase();
+				if (cmd == &quot;formatblock&quot;) {
+					var select = dojo.widget.createWidget(&quot;ToolbarSelect&quot;, {name:&quot;formatBlock&quot;, values:this.formatBlockItems});
+					tb.addChild(select);
+					var _this = this;
+					dojo.event.connect(select, &quot;onSetValue&quot;, function (item, value) {
+						_this.onAction(&quot;formatBlock&quot;, value);
+					});
+				} else {
+					if (cmd == &quot;fontname&quot;) {
+						var select = dojo.widget.createWidget(&quot;ToolbarSelect&quot;, {name:&quot;fontName&quot;, values:this.fontNameItems});
+						tb.addChild(select);
+						dojo.event.connect(select, &quot;onSetValue&quot;, dojo.lang.hitch(this, function (item, value) {
+							this.onAction(&quot;fontName&quot;, value);
+						}));
+					} else {
+						if (cmd == &quot;fontsize&quot;) {
+							var select = dojo.widget.createWidget(&quot;ToolbarSelect&quot;, {name:&quot;fontSize&quot;, values:this.fontSizeItems});
+							tb.addChild(select);
+							dojo.event.connect(select, &quot;onSetValue&quot;, dojo.lang.hitch(this, function (item, value) {
+								this.onAction(&quot;fontSize&quot;, value);
+							}));
+						} else {
+							if (dojo.lang.inArray(cmd, [&quot;forecolor&quot;, &quot;hilitecolor&quot;])) {
+								var btn = tb.addChild(dojo.widget.createWidget(&quot;ToolbarColorDialog&quot;, this.getItemProperties(cmd)));
+								dojo.event.connect(btn, &quot;onSetValue&quot;, this, &quot;_setValue&quot;);
+							} else {
+								var btn = tb.addChild(this.getCommandImage(cmd), null, this.getItemProperties(cmd));
+								if (cmd == &quot;save&quot;) {
+									dojo.event.connect(btn, &quot;onClick&quot;, this, &quot;_save&quot;);
+								} else {
+									if (cmd == &quot;cancel&quot;) {
+										dojo.event.connect(btn, &quot;onClick&quot;, this, &quot;_close&quot;);
+									} else {
+										dojo.event.connect(btn, &quot;onClick&quot;, this, &quot;_action&quot;);
+										dojo.event.connect(btn, &quot;onChangeSelect&quot;, this, &quot;_action&quot;);
+									}
+								}
+							}
+						}
+					}
+				}
+			}
+		}
+	}
+	return true;
+}, enableToolbar:function () {
+	if (this._toolbarContainer) {
+		this._toolbarContainer.domNode.style.display = &quot;&quot;;
+		this._toolbarContainer.enable();
+	}
+}, disableToolbar:function (hide) {
+	if (hide) {
+		if (this._toolbarContainer) {
+			this._toolbarContainer.domNode.style.display = &quot;none&quot;;
+		}
+	} else {
+		if (this._toolbarContainer) {
+			this._toolbarContainer.disable();
+		}
+	}
+}, _updateToolbarLastRan:null, _updateToolbarTimer:null, _updateToolbarFrequency:500, updateToolbar:function (force) {
+	if (!this._toolbarContainer) {
+		return;
+	}
+	var diff = new Date() - this._updateToolbarLastRan;
+	if (!force &amp;&amp; this._updateToolbarLastRan &amp;&amp; (diff &lt; this._updateToolbarFrequency)) {
+		clearTimeout(this._updateToolbarTimer);
+		var _this = this;
+		this._updateToolbarTimer = setTimeout(function () {
+			_this.updateToolbar();
+		}, this._updateToolbarFrequency / 2);
+		return;
+	} else {
+		this._updateToolbarLastRan = new Date();
+	}
+	var items = this._toolbarContainer.getItems();
+	for (var i = 0; i &lt; items.length; i++) {
+		var item = items[i];
+		if (item instanceof dojo.widget.ToolbarSeparator) {
+			continue;
+		}
+		var cmd = item._name;
+		if (cmd == &quot;save&quot; || cmd == &quot;cancel&quot;) {
+			continue;
+		} else {
+			if (cmd == &quot;justifyGroup&quot;) {
+				try {
+					if (!this._richText.queryCommandEnabled(&quot;justifyleft&quot;)) {
+						item.disable(false, true);
+					} else {
+						item.enable(false, true);
+						var jitems = item.getItems();
+						for (var j = 0; j &lt; jitems.length; j++) {
+							var name = jitems[j]._name;
+							var value = this._richText.queryCommandValue(name);
+							if (typeof value == &quot;boolean&quot; &amp;&amp; value) {
+								value = name;
+								break;
+							} else {
+								if (typeof value == &quot;string&quot;) {
+									value = &quot;justify&quot; + value;
+								} else {
+									value = null;
+								}
+							}
+						}
+						if (!value) {
+							value = &quot;justifyleft&quot;;
+						}
+						item.setValue(value, false, true);
+					}
+				}
+				catch (err) {
+				}
+			} else {
+				if (cmd == &quot;listGroup&quot;) {
+					var litems = item.getItems();
+					for (var j = 0; j &lt; litems.length; j++) {
+						this.updateItem(litems[j]);
+					}
+				} else {
+					this.updateItem(item);
+				}
+			}
+		}
+	}
+}, updateItem:function (item) {
+	try {
+		var cmd = item._name;
+		var enabled = this._richText.queryCommandEnabled(cmd);
+		item.setEnabled(enabled, false, true);
+		var active = this._richText.queryCommandState(cmd);
+		if (active &amp;&amp; cmd == &quot;underline&quot;) {
+			active = !this._richText.queryCommandEnabled(&quot;unlink&quot;);
+		}
+		item.setSelected(active, false, true);
+		return true;
+	}
+	catch (err) {
+		return false;
+	}
+}, supportedCommands:dojo.widget.Editor.supportedCommands.concat(), isSupportedCommand:function (cmd) {
+	var yes = dojo.lang.inArray(cmd, this.supportedCommands);
+	if (!yes) {
+		try {
+			var richText = this._richText || dojo.widget.HtmlRichText.prototype;
+			yes = richText.queryCommandAvailable(cmd);
+		}
+		catch (E) {
+		}
+	}
+	return yes;
+}, getCommandImage:function (cmd) {
+	if (cmd == &quot;|&quot;) {
+		return cmd;
+	} else {
+		return dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/buttons/&quot; + cmd + &quot;.gif&quot;);
+	}
+}, _action:function (e) {
+	this._fire(&quot;onAction&quot;, e.getValue());
+}, _setValue:function (a, b) {
+	this._fire(&quot;onAction&quot;, a.getValue(), b);
+}, _save:function (e) {
+	if (!this._richText.isClosed) {
+		if (this.saveUrl.length) {
+			var content = {};
+			content[this.saveArgName] = this.getHtml();
+			dojo.io.bind({method:this.saveMethod, url:this.saveUrl, content:content});
+		} else {
+			dojo.debug(&quot;please set a saveUrl for the editor&quot;);
+		}
+		if (this.closeOnSave) {
+			this._richText.close(e.getName().toLowerCase() == &quot;save&quot;);
+		}
+	}
+}, _close:function (e) {
+	if (!this._richText.isClosed) {
+		this._richText.close(e.getName().toLowerCase() == &quot;save&quot;);
+	}
+}, onAction:function (cmd, value) {
+	switch (cmd) {
+	  case &quot;createlink&quot;:
+		if (!(value = prompt(&quot;Please enter the URL of the link:&quot;, &quot;<A HREF="http://">http://</A>&quot;))) {
+			return;
+		}
+		break;
+	  case &quot;insertimage&quot;:
+		if (!(value = prompt(&quot;Please enter the URL of the image:&quot;, &quot;<A HREF="http://">http://</A>&quot;))) {
+			return;
+		}
+		break;
+	}
+	this._richText.execCommand(cmd, value);
+}, fillInTemplate:function (args, frag) {
+}, _fire:function (eventName) {
+	if (dojo.lang.isFunction(this[eventName])) {
+		var args = [];
+		if (arguments.length == 1) {
+			args.push(this);
+		} else {
+			for (var i = 1; i &lt; arguments.length; i++) {
+				args.push(arguments[i]);
+			}
+		}
+		this[eventName].apply(this, args);
+	}
+}, getHtml:function () {
+	this._richText.contentFilters = this._richText.contentFilters.concat(this.contentFilters);
+	return this._richText.getEditorContent();
+}, getEditorContent:function () {
+	return this.getHtml();
+}, onClose:function (save, hide) {
+	this.disableToolbar(hide);
+	if (save) {
+		this._fire(&quot;onSave&quot;);
+	} else {
+		this._fire(&quot;onCancel&quot;);
+	}
+}, onLoad:function () {
+}, onSave:function () {
+}, onCancel:function () {
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,412 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.RichText&quot;);
+dojo.require(&quot;dojo.widget.Editor2Toolbar&quot;);
+dojo.require(&quot;dojo.uri.cache&quot;);
+dojo.widget.Editor2Manager = new dojo.widget.HandlerManager;
+dojo.lang.mixin(dojo.widget.Editor2Manager, {_currentInstance:null, commandState:{Disabled:0, Latched:1, Enabled:2}, getCurrentInstance:function () {
+	return this._currentInstance;
+}, setCurrentInstance:function (inst) {
+	this._currentInstance = inst;
+}, getCommand:function (editor, name) {
+	var oCommand;
+	name = name.toLowerCase();
+	for (var i = 0; i &lt; this._registeredHandlers.length; i++) {
+		oCommand = this._registeredHandlers[i](editor, name);
+		if (oCommand) {
+			return oCommand;
+		}
+	}
+	switch (name) {
+	  case &quot;htmltoggle&quot;:
+		oCommand = new dojo.widget.Editor2BrowserCommand(editor, name);
+		break;
+	  case &quot;formatblock&quot;:
+		oCommand = new dojo.widget.Editor2FormatBlockCommand(editor, name);
+		break;
+	  case &quot;anchor&quot;:
+		oCommand = new dojo.widget.Editor2Command(editor, name);
+		break;
+	  case &quot;createlink&quot;:
+		oCommand = new dojo.widget.Editor2DialogCommand(editor, name, {contentFile:&quot;dojo.widget.Editor2Plugin.CreateLinkDialog&quot;, contentClass:&quot;Editor2CreateLinkDialog&quot;, title:&quot;Insert/Edit Link&quot;, width:&quot;300px&quot;, height:&quot;200px&quot;});
+		break;
+	  case &quot;insertimage&quot;:
+		oCommand = new dojo.widget.Editor2DialogCommand(editor, name, {contentFile:&quot;dojo.widget.Editor2Plugin.InsertImageDialog&quot;, contentClass:&quot;Editor2InsertImageDialog&quot;, title:&quot;Insert/Edit Image&quot;, width:&quot;400px&quot;, height:&quot;270px&quot;});
+		break;
+	  default:
+		var curtInst = this.getCurrentInstance();
+		if ((curtInst &amp;&amp; curtInst.queryCommandAvailable(name)) || (!curtInst &amp;&amp; dojo.widget.Editor2.prototype.queryCommandAvailable(name))) {
+			oCommand = new dojo.widget.Editor2BrowserCommand(editor, name);
+		} else {
+			dojo.debug(&quot;dojo.widget.Editor2Manager.getCommand: Unknown command &quot; + name);
+			return;
+		}
+	}
+	return oCommand;
+}, destroy:function () {
+	this._currentInstance = null;
+	dojo.widget.HandlerManager.prototype.destroy.call(this);
+}});
+dojo.addOnUnload(dojo.widget.Editor2Manager, &quot;destroy&quot;);
+dojo.lang.declare(&quot;dojo.widget.Editor2Command&quot;, null, function (editor, name) {
+	this._editor = editor;
+	this._updateTime = 0;
+	this._name = name;
+}, {_text:&quot;Unknown&quot;, execute:function (para) {
+	dojo.unimplemented(&quot;dojo.widget.Editor2Command.execute&quot;);
+}, getText:function () {
+	return this._text;
+}, getState:function () {
+	return dojo.widget.Editor2Manager.commandState.Enabled;
+}, destroy:function () {
+}});
+dojo.widget.Editor2BrowserCommandNames = {&quot;bold&quot;:&quot;Bold&quot;, &quot;copy&quot;:&quot;Copy&quot;, &quot;cut&quot;:&quot;Cut&quot;, &quot;Delete&quot;:&quot;Delete&quot;, &quot;indent&quot;:&quot;Indent&quot;, &quot;inserthorizontalrule&quot;:&quot;Horizental Rule&quot;, &quot;insertorderedlist&quot;:&quot;Numbered List&quot;, &quot;insertunorderedlist&quot;:&quot;Bullet List&quot;, &quot;italic&quot;:&quot;Italic&quot;, &quot;justifycenter&quot;:&quot;Align Center&quot;, &quot;justifyfull&quot;:&quot;Justify&quot;, &quot;justifyleft&quot;:&quot;Align Left&quot;, &quot;justifyright&quot;:&quot;Align Right&quot;, &quot;outdent&quot;:&quot;Outdent&quot;, &quot;paste&quot;:&quot;Paste&quot;, &quot;redo&quot;:&quot;Redo&quot;, &quot;removeformat&quot;:&quot;Remove Format&quot;, &quot;selectall&quot;:&quot;Select All&quot;, &quot;strikethrough&quot;:&quot;Strikethrough&quot;, &quot;subscript&quot;:&quot;Subscript&quot;, &quot;superscript&quot;:&quot;Superscript&quot;, &quot;underline&quot;:&quot;Underline&quot;, &quot;undo&quot;:&quot;Undo&quot;, &quot;unlink&quot;:&quot;Remove Link&quot;, &quot;createlink&quot;:&quot;Create Link&quot;, &quot;insertimage&quot;:&quot;Insert Image&quot;, &quot;htmltoggle&quot;:&quot;HTML Source&quot;, &quot;forecolor&quot;:&quot;Foreground Color&quot;, &quot;hilitecolor&quot;:&quot;Background Color&quot;, &quot;plainformatblock&quot;:&quot;Paragraph Style&quot;, &quot;formatblock&quot;:&quot;Paragraph Style&quot;, &quot;fontsize&quot;:&quot;Font Size&quot;, &quot;fontname&quot;:&quot;Font Name&quot;};
+dojo.lang.declare(&quot;dojo.widget.Editor2BrowserCommand&quot;, dojo.widget.Editor2Command, function (editor, name) {
+	var text = dojo.widget.Editor2BrowserCommandNames[name.toLowerCase()];
+	if (text) {
+		this._text = text;
+	}
+}, {execute:function (para) {
+	this._editor.execCommand(this._name, para);
+}, getState:function () {
+	if (this._editor._lastStateTimestamp &gt; this._updateTime || this._state == undefined) {
+		this._updateTime = this._editor._lastStateTimestamp;
+		try {
+			if (this._editor.queryCommandEnabled(this._name)) {
+				if (this._editor.queryCommandState(this._name)) {
+					this._state = dojo.widget.Editor2Manager.commandState.Latched;
+				} else {
+					this._state = dojo.widget.Editor2Manager.commandState.Enabled;
+				}
+			} else {
+				this._state = dojo.widget.Editor2Manager.commandState.Disabled;
+			}
+		}
+		catch (e) {
+			this._state = dojo.widget.Editor2Manager.commandState.Enabled;
+		}
+	}
+	return this._state;
+}, getValue:function () {
+	try {
+		return this._editor.queryCommandValue(this._name);
+	}
+	catch (e) {
+	}
+}});
+dojo.lang.declare(&quot;dojo.widget.Editor2FormatBlockCommand&quot;, dojo.widget.Editor2BrowserCommand, {});
+dojo.require(&quot;dojo.widget.FloatingPane&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2Dialog&quot;, [dojo.widget.HtmlWidget, dojo.widget.FloatingPaneBase, dojo.widget.ModalDialogBase], {templateString:&quot;&lt;div id=\&quot;${this.widgetId}\&quot; class=\&quot;dojoFloatingPane\&quot;&gt;\n\t&lt;span dojoattachpoint=\&quot;tabStartOuter\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot;\ttabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;span dojoattachpoint=\&quot;tabStart\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot; tabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;div dojoAttachPoint=\&quot;titleBar\&quot; class=\&quot;dojoFloatingPaneTitleBar\&quot;  style=\&quot;display:none\&quot;&gt;\n\t  \t&lt;img dojoAttachPoint=\&quot;titleBarIcon\&quot;  class=\&quot;dojoFloatingPaneTitleBarIcon\&quot;&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;closeAction\&quot; dojoAttachEvent=\&quot;onClick:hide\&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneCloseIcon\&quot;&gt;&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;restoreAction\&quot; dojoAttachEvent=\&quot;onClick:restoreWindow\&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneRestoreIcon\&quot;&gt;&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;maximizeAction\&quot; dojoAttachEvent=\&quot;onClick:maximizeWindow\&quot;\n  !
  \t  \t\tclass=\&quot;dojoFloatingPaneMaximizeIcon\&quot;&gt;&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;minimizeAction\&quot; dojoAttachEvent=\&quot;onClick:minimizeWindow\&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneMinimizeIcon\&quot;&gt;&lt;/div&gt;\n\t  \t&lt;div dojoAttachPoint=\&quot;titleBarText\&quot; class=\&quot;dojoFloatingPaneTitleText\&quot;&gt;${this.title}&lt;/div&gt;\n\t&lt;/div&gt;\n\n\t&lt;div id=\&quot;${this.widgetId}_container\&quot; dojoAttachPoint=\&quot;containerNode\&quot; class=\&quot;dojoFloatingPaneClient\&quot;&gt;&lt;/div&gt;\n\t&lt;span dojoattachpoint=\&quot;tabEnd\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot; tabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;span dojoattachpoint=\&quot;tabEndOuter\&quot; dojoonfocus=\&quot;trapTabs\&quot; dojoonblur=\&quot;clearTrap\&quot; tabindex=\&quot;0\&quot;&gt;&lt;/span&gt;\n\t&lt;div dojoAttachPoint=\&quot;resizeBar\&quot; class=\&quot;dojoFloatingPaneResizebar\&quot; style=\&quot;display:none\&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, modal:true, width:&quot;&quot;, height:&quot;&quot;, windowState:&quot;minimized&quot;, displayCloseAction:true, contentFile:&quot;&quot;, contentClass:&quot;&quot;, fillInTemplate:function (args, frag) {
+	this.fillInFloatingPaneTemplate(args, frag);
+	dojo.widget.Editor2Dialog.superclass.fillInTemplate.call(this, args, frag);
+}, postCreate:function () {
+	if (this.contentFile) {
+		dojo.require(this.contentFile);
+	}
+	if (this.modal) {
+		dojo.widget.ModalDialogBase.prototype.postCreate.call(this);
+	} else {
+		with (this.domNode.style) {
+			zIndex = 999;
+			display = &quot;none&quot;;
+		}
+	}
+	dojo.widget.FloatingPaneBase.prototype.postCreate.apply(this, arguments);
+	dojo.widget.Editor2Dialog.superclass.postCreate.call(this);
+	if (this.width &amp;&amp; this.height) {
+		with (this.domNode.style) {
+			width = this.width;
+			height = this.height;
+		}
+	}
+}, createContent:function () {
+	if (!this.contentWidget &amp;&amp; this.contentClass) {
+		this.contentWidget = dojo.widget.createWidget(this.contentClass);
+		this.addChild(this.contentWidget);
+	}
+}, show:function () {
+	if (!this.contentWidget) {
+		dojo.widget.Editor2Dialog.superclass.show.apply(this, arguments);
+		this.createContent();
+		dojo.widget.Editor2Dialog.superclass.hide.call(this);
+	}
+	if (!this.contentWidget || !this.contentWidget.loadContent()) {
+		return;
+	}
+	this.showFloatingPane();
+	dojo.widget.Editor2Dialog.superclass.show.apply(this, arguments);
+	if (this.modal) {
+		this.showModalDialog();
+	}
+	if (this.modal) {
+		this.bg.style.zIndex = this.domNode.style.zIndex - 1;
+	}
+}, onShow:function () {
+	dojo.widget.Editor2Dialog.superclass.onShow.call(this);
+	this.onFloatingPaneShow();
+}, closeWindow:function () {
+	this.hide();
+	dojo.widget.Editor2Dialog.superclass.closeWindow.apply(this, arguments);
+}, hide:function () {
+	if (this.modal) {
+		this.hideModalDialog();
+	}
+	dojo.widget.Editor2Dialog.superclass.hide.call(this);
+}, checkSize:function () {
+	if (this.isShowing()) {
+		if (this.modal) {
+			this._sizeBackground();
+		}
+		this.placeModalDialog();
+		this.onResized();
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2DialogContent&quot;, dojo.widget.HtmlWidget, {widgetsInTemplate:true, loadContent:function () {
+	return true;
+}, cancel:function () {
+	this.parent.hide();
+}});
+dojo.lang.declare(&quot;dojo.widget.Editor2DialogCommand&quot;, dojo.widget.Editor2BrowserCommand, function (editor, name, dialogParas) {
+	this.dialogParas = dialogParas;
+}, {execute:function () {
+	if (!this.dialog) {
+		if (!this.dialogParas.contentFile || !this.dialogParas.contentClass) {
+			alert(&quot;contentFile and contentClass should be set for dojo.widget.Editor2DialogCommand.dialogParas!&quot;);
+			return;
+		}
+		this.dialog = dojo.widget.createWidget(&quot;Editor2Dialog&quot;, this.dialogParas);
+		dojo.body().appendChild(this.dialog.domNode);
+		dojo.event.connect(this, &quot;destroy&quot;, this.dialog, &quot;destroy&quot;);
+	}
+	this.dialog.show();
+}, getText:function () {
+	return this.dialogParas.title || dojo.widget.Editor2DialogCommand.superclass.getText.call(this);
+}});
+dojo.widget.Editor2ToolbarGroups = {};
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2&quot;, dojo.widget.RichText, function () {
+	this._loadedCommands = {};
+}, {toolbarAlwaysVisible:false, toolbarWidget:null, scrollInterval:null, toolbarTemplatePath:dojo.uri.cache.set(dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/EditorToolbarOneline.html&quot;), &quot;&lt;div class=\&quot;EditorToolbarDomNode EditorToolbarSmallBg\&quot;&gt;\n\t&lt;table cellpadding=\&quot;1\&quot; cellspacing=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr valign=\&quot;top\&quot; align=\&quot;left\&quot;&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;htmltoggle\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon\&quot; \n\t\t\t\t\t\tstyle=\&quot;background-image: none; width: 30px;\&quot; &gt;&lt;h&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;copy\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Copy\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;paste\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon!
 _Paste\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;undo\&quot;&gt;\n\t\t\t\t\t\t&lt;!-- FIXME: should we have the text \&quot;undo\&quot; here? --&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Undo\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;redo\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Redo\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td isSpacer=\&quot;true\&quot;&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Sep\&quot;\tstyle=\&quot;width: 5px; min-width: 5px;\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;createlink\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Link\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;!
 \n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\!
 &quot; dojoET
ItemName=\&quot;insertimage\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Image\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;inserthorizontalrule\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_HorizontalLine \&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;bold\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Bold\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;italic\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Italic\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;underline\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Underline\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t!
 \t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;strikethrough\&quot;&gt;\n\t\t\t\t\t\t&lt;span \n\t\t\t\t\t\t\tclass=\&quot;dojoE2TBIcon dojoE2TBIcon_StrikeThrough\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td isSpacer=\&quot;true\&quot;&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Sep\&quot; \n\t\t\t\t\t\t\tstyle=\&quot;width: 5px; min-width: 5px;\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;insertunorderedlist\&quot;&gt;\n\t\t\t\t\t\t&lt;span \n\t\t\t\t\t\t\tclass=\&quot;dojoE2TBIcon dojoE2TBIcon_BulletedList\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;insertorderedlist\&quot;&gt;\n\t\t\t\t\t\t&lt;span \n\t\t\t\t\t\t\tclass=\&quot;dojoE2TBIcon dojoE2TBIcon_NumberedList\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t!
 \t&lt;/td&gt;\n\t\t\t\t&lt;td isSpacer=\&quot;true\&quot;&gt;\n\t\t\t\t\t&lt;span class!
 =\&quot;iconC
ontainer\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Sep\&quot; style=\&quot;width: 5px; min-width: 5px;\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;indent\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Indent\&quot; \n\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;outdent\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Outdent\&quot; \n\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td isSpacer=\&quot;true\&quot;&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Sep\&quot; style=\&quot;width: 5px; min-width: 5px;\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;forecolor\&quot;&gt;\n\t\t\t\t\t\t&lt;sp!
 an class=\&quot;dojoE2TBIcon dojoE2TBIcon_TextColor\&quot; \n\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;hilitecolor\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_BackgroundColor\&quot; \n\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td isSpacer=\&quot;true\&quot;&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Sep\&quot; style=\&quot;width: 5px; min-width: 5px;\&quot;&gt;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;justifyleft\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_LeftJustify\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;justifycenter\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon doj!
 oE2TBIcon_CenterJustify\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t!
 \t\t\t&lt;/
td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;justifyright\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_RightJustify\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;justifyfull\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_BlockJustify\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\t\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;select class=\&quot;dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;plainformatblock\&quot;&gt;\n\t\t\t\t\t\t&lt;!-- FIXME: using \&quot;p\&quot; here inserts a paragraph in most cases! --&gt;\n\t\t\t\t\t\t&lt;option value=\&quot;\&quot;&gt;-- format --&lt;/option&gt;\n\t\t\t\t\t\t&lt;option value=\&quot;p\&quot;&gt;Normal&lt;/option&gt;\n\t\t\t\t\t\t&lt;option value=\&quot;pre\&quot;&gt;Fixed Font&lt;/option&gt;\n\t\t\t\t\t\t&lt;option value=\&quot;h1\&quot;&gt;Main Heading&lt;/option&gt;\n\t\t\t\t\t\t&lt;option value=\&quot;h2\&quot;&gt;Section Heading&lt;/option&gt;\n\t\t\t\t\t\t&lt;option value=\&quot;h3\&quot;&gt;Sub-Heading&lt;/option&gt;\n\t\t\t\t\t\t&lt;!-- &lt;op!
 tion value=\&quot;blockquote\&quot;&gt;Block Quote&lt;/option&gt; --&gt;\n\t\t\t\t\t&lt;/select&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;!-- uncomment to enable save button --&gt;\n\t\t\t\t\t&lt;!-- save --&gt;\n\t\t\t\t\t&lt;!--span class=\&quot;iconContainer dojoEditorToolbarItem\&quot; dojoETItemName=\&quot;save\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;dojoE2TBIcon dojoE2TBIcon_Save\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span--&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td width=\&quot;*\&quot;&gt;&nbsp;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t&lt;/table&gt;\n&lt;/div&gt;\n&quot;), toolbarTemplateCssPath:null, toolbarPlaceHolder:&quot;&quot;, _inSourceMode:false, _htmlEditNode:null, toolbarGroup:&quot;&quot;, shareToolbar:false, contextMenuGroupSet:&quot;&quot;, editorOnLoad:function () {
+	dojo.event.topic.publish(&quot;dojo.widget.Editor2::preLoadingToolbar&quot;, this);
+	if (this.toolbarAlwaysVisible) {
+		dojo.require(&quot;dojo.widget.Editor2Plugin.AlwaysShowToolbar&quot;);
+	}
+	if (this.toolbarWidget) {
+		this.toolbarWidget.show();
+		dojo.html.insertBefore(this.toolbarWidget.domNode, this.domNode.firstChild);
+	} else {
+		if (this.shareToolbar) {
+			dojo.deprecated(&quot;Editor2:shareToolbar is deprecated in favor of toolbarGroup&quot;, &quot;0.5&quot;);
+			this.toolbarGroup = &quot;defaultDojoToolbarGroup&quot;;
+		}
+		if (this.toolbarGroup) {
+			if (dojo.widget.Editor2ToolbarGroups[this.toolbarGroup]) {
+				this.toolbarWidget = dojo.widget.Editor2ToolbarGroups[this.toolbarGroup];
+			}
+		}
+		if (!this.toolbarWidget) {
+			var tbOpts = {shareGroup:this.toolbarGroup, parent:this};
+			tbOpts.templateString = dojo.uri.cache.get(this.toolbarTemplatePath);
+			if (this.toolbarTemplateCssPath) {
+				tbOpts.templateCssPath = this.toolbarTemplateCssPath;
+				tbOpts.templateCssString = dojo.uri.cache.get(this.toolbarTemplateCssPath);
+			}
+			if (this.toolbarPlaceHolder) {
+				this.toolbarWidget = dojo.widget.createWidget(&quot;Editor2Toolbar&quot;, tbOpts, dojo.byId(this.toolbarPlaceHolder), &quot;after&quot;);
+			} else {
+				this.toolbarWidget = dojo.widget.createWidget(&quot;Editor2Toolbar&quot;, tbOpts, this.domNode.firstChild, &quot;before&quot;);
+			}
+			if (this.toolbarGroup) {
+				dojo.widget.Editor2ToolbarGroups[this.toolbarGroup] = this.toolbarWidget;
+			}
+			dojo.event.connect(this, &quot;close&quot;, this.toolbarWidget, &quot;hide&quot;);
+			this.toolbarLoaded();
+		}
+	}
+	dojo.event.topic.registerPublisher(&quot;Editor2.clobberFocus&quot;, this, &quot;clobberFocus&quot;);
+	dojo.event.topic.subscribe(&quot;Editor2.clobberFocus&quot;, this, &quot;setBlur&quot;);
+	dojo.event.topic.publish(&quot;dojo.widget.Editor2::onLoad&quot;, this);
+}, toolbarLoaded:function () {
+}, registerLoadedPlugin:function (obj) {
+	if (!this.loadedPlugins) {
+		this.loadedPlugins = [];
+	}
+	this.loadedPlugins.push(obj);
+}, unregisterLoadedPlugin:function (obj) {
+	for (var i in this.loadedPlugins) {
+		if (this.loadedPlugins[i] === obj) {
+			delete this.loadedPlugins[i];
+			return;
+		}
+	}
+	dojo.debug(&quot;dojo.widget.Editor2.unregisterLoadedPlugin: unknow plugin object: &quot; + obj);
+}, execCommand:function (command, argument) {
+	switch (command.toLowerCase()) {
+	  case &quot;htmltoggle&quot;:
+		this.toggleHtmlEditing();
+		break;
+	  default:
+		dojo.widget.Editor2.superclass.execCommand.apply(this, arguments);
+	}
+}, queryCommandEnabled:function (command, argument) {
+	switch (command.toLowerCase()) {
+	  case &quot;htmltoggle&quot;:
+		return true;
+	  default:
+		if (this._inSourceMode) {
+			return false;
+		}
+		return dojo.widget.Editor2.superclass.queryCommandEnabled.apply(this, arguments);
+	}
+}, queryCommandState:function (command, argument) {
+	switch (command.toLowerCase()) {
+	  case &quot;htmltoggle&quot;:
+		return this._inSourceMode;
+	  default:
+		return dojo.widget.Editor2.superclass.queryCommandState.apply(this, arguments);
+	}
+}, onClick:function (e) {
+	dojo.widget.Editor2.superclass.onClick.call(this, e);
+	if (dojo.widget.PopupManager) {
+		if (!e) {
+			e = this.window.event;
+		}
+		dojo.widget.PopupManager.onClick(e);
+	}
+}, clobberFocus:function () {
+}, toggleHtmlEditing:function () {
+	if (this === dojo.widget.Editor2Manager.getCurrentInstance()) {
+		if (!this._inSourceMode) {
+			var html = this.getEditorContent();
+			this._inSourceMode = true;
+			if (!this._htmlEditNode) {
+				this._htmlEditNode = dojo.doc().createElement(&quot;textarea&quot;);
+				dojo.html.insertAfter(this._htmlEditNode, this.editorObject);
+			}
+			this._htmlEditNode.style.display = &quot;&quot;;
+			this._htmlEditNode.style.width = &quot;100%&quot;;
+			this._htmlEditNode.style.height = dojo.html.getBorderBox(this.editNode).height + &quot;px&quot;;
+			this._htmlEditNode.value = html;
+			with (this.editorObject.style) {
+				position = &quot;absolute&quot;;
+				left = &quot;-2000px&quot;;
+				top = &quot;-2000px&quot;;
+			}
+		} else {
+			this._inSourceMode = false;
+			this._htmlEditNode.blur();
+			with (this.editorObject.style) {
+				position = &quot;&quot;;
+				left = &quot;&quot;;
+				top = &quot;&quot;;
+			}
+			var html = this._htmlEditNode.value;
+			dojo.lang.setTimeout(this, &quot;replaceEditorContent&quot;, 1, html);
+			this._htmlEditNode.style.display = &quot;none&quot;;
+			this.focus();
+		}
+		this.onDisplayChanged(null, true);
+	}
+}, setFocus:function () {
+	if (dojo.widget.Editor2Manager.getCurrentInstance() === this) {
+		return;
+	}
+	this.clobberFocus();
+	dojo.widget.Editor2Manager.setCurrentInstance(this);
+}, setBlur:function () {
+}, saveSelection:function () {
+	this._bookmark = null;
+	this._bookmark = dojo.withGlobal(this.window, dojo.html.selection.getBookmark);
+}, restoreSelection:function () {
+	if (this._bookmark) {
+		this.focus();
+		dojo.withGlobal(this.window, &quot;moveToBookmark&quot;, dojo.html.selection, [this._bookmark]);
+		this._bookmark = null;
+	} else {
+		dojo.debug(&quot;restoreSelection: no saved selection is found!&quot;);
+	}
+}, _updateToolbarLastRan:null, _updateToolbarTimer:null, _updateToolbarFrequency:500, updateToolbar:function (force) {
+	if ((!this.isLoaded) || (!this.toolbarWidget)) {
+		return;
+	}
+	var diff = new Date() - this._updateToolbarLastRan;
+	if ((!force) &amp;&amp; (this._updateToolbarLastRan) &amp;&amp; ((diff &lt; this._updateToolbarFrequency))) {
+		clearTimeout(this._updateToolbarTimer);
+		var _this = this;
+		this._updateToolbarTimer = setTimeout(function () {
+			_this.updateToolbar();
+		}, this._updateToolbarFrequency / 2);
+		return;
+	} else {
+		this._updateToolbarLastRan = new Date();
+	}
+	if (dojo.widget.Editor2Manager.getCurrentInstance() !== this) {
+		return;
+	}
+	this.toolbarWidget.update();
+}, destroy:function (finalize) {
+	this._htmlEditNode = null;
+	dojo.event.disconnect(this, &quot;close&quot;, this.toolbarWidget, &quot;hide&quot;);
+	if (!finalize) {
+		this.toolbarWidget.destroy();
+	}
+	dojo.widget.Editor2.superclass.destroy.call(this);
+}, _lastStateTimestamp:0, onDisplayChanged:function (e, forceUpdate) {
+	this._lastStateTimestamp = (new Date()).getTime();
+	dojo.widget.Editor2.superclass.onDisplayChanged.call(this, e);
+	this.updateToolbar(forceUpdate);
+}, onLoad:function () {
+	try {
+		dojo.widget.Editor2.superclass.onLoad.call(this);
+	}
+	catch (e) {
+		dojo.debug(e);
+	}
+	this.editorOnLoad();
+}, onFocus:function () {
+	dojo.widget.Editor2.superclass.onFocus.call(this);
+	this.setFocus();
+}, getEditorContent:function () {
+	if (this._inSourceMode) {
+		return this._htmlEditNode.value;
+	}
+	return dojo.widget.Editor2.superclass.getEditorContent.call(this);
+}, replaceEditorContent:function (html) {
+	if (this._inSourceMode) {
+		this._htmlEditNode.value = html;
+		return;
+	}
+	dojo.widget.Editor2.superclass.replaceEditorContent.apply(this, arguments);
+}, getCommand:function (name) {
+	if (this._loadedCommands[name]) {
+		return this._loadedCommands[name];
+	}
+	var cmd = dojo.widget.Editor2Manager.getCommand(this, name);
+	this._loadedCommands[name] = cmd;
+	return cmd;
+}, shortcuts:[[&quot;bold&quot;], [&quot;italic&quot;], [&quot;underline&quot;], [&quot;selectall&quot;, &quot;a&quot;], [&quot;insertunorderedlist&quot;, &quot;\\&quot;]], setupDefaultShortcuts:function () {
+	var exec = function (cmd) {
+		return function () {
+			cmd.execute();
+		};
+	};
+	var self = this;
+	dojo.lang.forEach(this.shortcuts, function (item) {
+		var cmd = self.getCommand(item[0]);
+		if (cmd) {
+			self.addKeyHandler(item[1] ? item[1] : item[0].charAt(0), item[2] == undefined ? self.KEY_CTRL : item[2], exec(cmd));
+		}
+	});
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/AlwaysShowToolbar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/AlwaysShowToolbar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/AlwaysShowToolbar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,118 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.AlwaysShowToolbar&quot;);
+dojo.event.topic.subscribe(&quot;dojo.widget.Editor2::onLoad&quot;, function (editor) {
+	if (editor.toolbarAlwaysVisible) {
+		var p = new dojo.widget.Editor2Plugin.AlwaysShowToolbar(editor);
+	}
+});
+dojo.declare(&quot;dojo.widget.Editor2Plugin.AlwaysShowToolbar&quot;, null, function (editor) {
+	this.editor = editor;
+	this.editor.registerLoadedPlugin(this);
+	this.setup();
+}, {_scrollSetUp:false, _fixEnabled:false, _scrollThreshold:false, _handleScroll:true, setup:function () {
+	var tdn = this.editor.toolbarWidget;
+	if (!tdn.tbBgIframe) {
+		tdn.tbBgIframe = new dojo.html.BackgroundIframe(tdn.domNode);
+		tdn.tbBgIframe.onResized();
+	}
+	this.scrollInterval = setInterval(dojo.lang.hitch(this, &quot;globalOnScrollHandler&quot;), 100);
+	dojo.event.connect(&quot;before&quot;, this.editor.toolbarWidget, &quot;destroy&quot;, this, &quot;destroy&quot;);
+}, globalOnScrollHandler:function () {
+	var isIE = dojo.render.html.ie;
+	if (!this._handleScroll) {
+		return;
+	}
+	var dh = dojo.html;
+	var tdn = this.editor.toolbarWidget.domNode;
+	var db = dojo.body();
+	if (!this._scrollSetUp) {
+		this._scrollSetUp = true;
+		var editorWidth = dh.getMarginBox(this.editor.domNode).width;
+		this._scrollThreshold = dh.abs(tdn, true).y;
+		if ((isIE) &amp;&amp; (db) &amp;&amp; (dh.getStyle(db, &quot;background-image&quot;) == &quot;none&quot;)) {
+			with (db.style) {
+				backgroundImage = &quot;url(&quot; + dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/blank.gif&quot;) + &quot;)&quot;;
+				backgroundAttachment = &quot;fixed&quot;;
+			}
+		}
+	}
+	var scrollPos = (window[&quot;pageYOffset&quot;]) ? window[&quot;pageYOffset&quot;] : (document[&quot;documentElement&quot;] || document[&quot;body&quot;]).scrollTop;
+	if (scrollPos &gt; this._scrollThreshold) {
+		if (!this._fixEnabled) {
+			var tdnbox = dojo.html.getMarginBox(tdn);
+			this.editor.editorObject.style.marginTop = tdnbox.height + &quot;px&quot;;
+			if (isIE) {
+				tdn.style.left = dojo.html.abs(tdn, dojo.html.boxSizing.MARGIN_BOX).x;
+				if (tdn.previousSibling) {
+					this._IEOriginalPos = [&quot;after&quot;, tdn.previousSibling];
+				} else {
+					if (tdn.nextSibling) {
+						this._IEOriginalPos = [&quot;before&quot;, tdn.nextSibling];
+					} else {
+						this._IEOriginalPos = [&quot;&quot;, tdn.parentNode];
+					}
+				}
+				dojo.body().appendChild(tdn);
+				dojo.html.addClass(tdn, &quot;IEFixedToolbar&quot;);
+			} else {
+				with (tdn.style) {
+					position = &quot;fixed&quot;;
+					top = &quot;0px&quot;;
+				}
+			}
+			tdn.style.width = tdnbox.width + &quot;px&quot;;
+			tdn.style.zIndex = 1000;
+			this._fixEnabled = true;
+		}
+		if (!dojo.render.html.safari) {
+			var eHeight = (this.height) ? parseInt(this.editor.height) : this.editor._lastHeight;
+			if (scrollPos &gt; (this._scrollThreshold + eHeight)) {
+				tdn.style.display = &quot;none&quot;;
+			} else {
+				tdn.style.display = &quot;&quot;;
+			}
+		}
+	} else {
+		if (this._fixEnabled) {
+			(this.editor.object || this.editor.iframe).style.marginTop = null;
+			with (tdn.style) {
+				position = &quot;&quot;;
+				top = &quot;&quot;;
+				zIndex = &quot;&quot;;
+				display = &quot;&quot;;
+			}
+			if (isIE) {
+				tdn.style.left = &quot;&quot;;
+				dojo.html.removeClass(tdn, &quot;IEFixedToolbar&quot;);
+				if (this._IEOriginalPos) {
+					dojo.html.insertAtPosition(tdn, this._IEOriginalPos[1], this._IEOriginalPos[0]);
+					this._IEOriginalPos = null;
+				} else {
+					dojo.html.insertBefore(tdn, this.editor.object || this.editor.iframe);
+				}
+			}
+			tdn.style.width = &quot;&quot;;
+			this._fixEnabled = false;
+		}
+	}
+}, destroy:function () {
+	this._IEOriginalPos = null;
+	this._handleScroll = false;
+	clearInterval(this.scrollInterval);
+	this.editor.unregisterLoadedPlugin(this);
+	if (dojo.render.html.ie) {
+		dojo.html.removeClass(this.editor.toolbarWidget.domNode, &quot;IEFixedToolbar&quot;);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ContextMenu.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ContextMenu.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ContextMenu.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,203 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.ContextMenu&quot;);
+dojo.require(&quot;dojo.widget.Menu2&quot;);
+dojo.event.topic.subscribe(&quot;dojo.widget.Editor2::onLoad&quot;, function (editor) {
+	dojo.widget.Editor2Plugin.ContextMenuManager.getContextMenu(editor);
+});
+dojo.widget.Editor2Plugin.ContextMenuManager = {menuGroups:[&quot;Generic&quot;, &quot;Link&quot;, &quot;Anchor&quot;, &quot;Image&quot;, &quot;List&quot;, &quot;Table&quot;], _contextMenuGroupSets:{}, _registeredGroups:{}, _menus:{}, registerGroup:function (name, handler) {
+	if (this._registeredGroups[name]) {
+		alert(&quot;dojo.widget.Editor2Plugin.ContextMenuManager.registerGroup: menu group &quot; + name + &quot;is already registered. Ignored.&quot;);
+		return;
+	}
+	this._registeredGroups[name] = handler;
+}, removeGroup:function (name) {
+	delete this._registeredGroups[name];
+}, getGroup:function (name, contextmenuplugin) {
+	if (this._registeredGroups[name]) {
+		var item = this._registeredGroups[name](name, contextmenuplugin);
+		if (item) {
+			return item;
+		}
+	}
+	switch (name) {
+	  case &quot;Generic&quot;:
+	  case &quot;Link&quot;:
+	  case &quot;Image&quot;:
+		return new dojo.widget.Editor2Plugin[name + &quot;ContextMenuGroup&quot;](contextmenuplugin);
+	  case &quot;Anchor&quot;:
+	  case &quot;List&quot;:
+	}
+}, registerGroupSet:function (name, set) {
+	this._contextMenuGroupSets[name] = set;
+}, removeGroupSet:function (name) {
+	var set = this._contextMenuGroupSets[name];
+	delete this._contextMenuGroupSets[name];
+	return set;
+}, getContextMenu:function (editor) {
+	var set = editor.contextMenuGroupSet || &quot;defaultDojoEditor2MenuGroupSet&quot;;
+	if (this._menus[set]) {
+		this._menus[set].bindEditor(editor);
+		return this._menus[set];
+	}
+	var gs = (editor.contextMenuGroupSet &amp;&amp; this._contextMenuGroupSets[editor.contextMenuGroupSet]) || this.menuGroups;
+	var menu = new dojo.widget.Editor2Plugin.ContextMenu(editor, gs);
+	this._menus[set] = menu;
+	return menu;
+}};
+dojo.declare(&quot;dojo.widget.Editor2Plugin.ContextMenu&quot;, null, function (editor, gs) {
+	this.groups = [];
+	this.separators = [];
+	this.editor = editor;
+	this.editor.registerLoadedPlugin(this);
+	this.contextMenu = dojo.widget.createWidget(&quot;PopupMenu2&quot;, {});
+	dojo.body().appendChild(this.contextMenu.domNode);
+	this.bindEditor(this.editor);
+	dojo.event.connect(this.contextMenu, &quot;aboutToShow&quot;, this, &quot;aboutToShow&quot;);
+	dojo.event.connect(this.editor, &quot;destroy&quot;, this, &quot;destroy&quot;);
+	this.setup(gs);
+}, {bindEditor:function (editor) {
+	this.contextMenu.bindDomNode(editor.document.body);
+}, setup:function (gs) {
+	for (var i in gs) {
+		var g = dojo.widget.Editor2Plugin.ContextMenuManager.getGroup(gs[i], this);
+		if (g) {
+			this.groups.push(g);
+		}
+	}
+}, aboutToShow:function () {
+	var first = true;
+	for (var i in this.groups) {
+		if (i &gt; 0 &amp;&amp; this.separators.length != this.groups.length - 1) {
+			this.separators.push(dojo.widget.createWidget(&quot;MenuSeparator2&quot;, {}));
+			this.contextMenu.addChild(this.separators[this.separators.length - 1]);
+		}
+		if (this.groups[i].refresh()) {
+			if (i &gt; 0) {
+				if (first) {
+					this.separators[i - 1].hide();
+				} else {
+					this.separators[i - 1].show();
+				}
+			}
+			if (first) {
+				first = false;
+			}
+		} else {
+			if (i &gt; 0) {
+				this.separators[i - 1].hide();
+			}
+		}
+	}
+}, destroy:function () {
+	this.editor.unregisterLoadedPlugin(this);
+	delete this.groups;
+	delete this.separators;
+	this.contextMenu.destroy();
+	delete this.contextMenu;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2ContextMenuItem&quot;, dojo.widget.MenuItem2, {command:&quot;&quot;, buildRendering:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	this.caption = curInst.getCommand(this.command).getText();
+	dojo.widget.Editor2ContextMenuItem.superclass.buildRendering.apply(this, arguments);
+}, onClick:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	if (curInst) {
+		var _command = curInst.getCommand(this.command);
+		if (_command) {
+			_command.execute();
+		}
+	}
+}, refresh:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	if (curInst) {
+		var _command = curInst.getCommand(this.command);
+		if (_command) {
+			if (_command.getState() == dojo.widget.Editor2Manager.commandState.Disabled) {
+				this.disable();
+				return false;
+			} else {
+				this.enable();
+				return true;
+			}
+		}
+	}
+}, hide:function () {
+	this.domNode.style.display = &quot;none&quot;;
+}, show:function () {
+	this.domNode.style.display = &quot;&quot;;
+}});
+dojo.declare(&quot;dojo.widget.Editor2Plugin.SimpleContextMenuGroup&quot;, null, function (contextmenuplugin) {
+	this.contextMenu = contextmenuplugin.contextMenu;
+	this.items = [];
+	dojo.event.connect(contextmenuplugin, &quot;destroy&quot;, this, &quot;destroy&quot;);
+}, {refresh:function () {
+	if (!this.items.length) {
+		this.createItems();
+		for (var i in this.items) {
+			this.contextMenu.addChild(this.items[i]);
+		}
+	}
+	return this.checkVisibility();
+}, destroy:function () {
+	this.contextmenu = null;
+	delete this.items;
+	delete this.contextMenu;
+}, createItems:function () {
+}, checkVisibility:function () {
+	var show = false;
+	for (var i in this.items) {
+		show = show || this.items[i].refresh();
+	}
+	var action = show ? &quot;show&quot; : &quot;hide&quot;;
+	for (var i in this.items) {
+		this.items[i][action]();
+	}
+	return show;
+}});
+dojo.declare(&quot;dojo.widget.Editor2Plugin.GenericContextMenuGroup&quot;, dojo.widget.Editor2Plugin.SimpleContextMenuGroup, {createItems:function () {
+	this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {command:&quot;cut&quot;, iconClass:&quot;dojoE2TBIcon dojoE2TBIcon_Cut&quot;}));
+	this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {command:&quot;copy&quot;, iconClass:&quot;dojoE2TBIcon dojoE2TBIcon_Copy&quot;}));
+	this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {command:&quot;paste&quot;, iconClass:&quot;dojoE2TBIcon dojoE2TBIcon_Paste&quot;}));
+}});
+dojo.declare(&quot;dojo.widget.Editor2Plugin.LinkContextMenuGroup&quot;, dojo.widget.Editor2Plugin.SimpleContextMenuGroup, {createItems:function () {
+	this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {command:&quot;createlink&quot;, iconClass:&quot;dojoE2TBIcon dojoE2TBIcon_Link&quot;}));
+	this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {command:&quot;unlink&quot;, iconClass:&quot;dojoE2TBIcon dojoE2TBIcon_UnLink&quot;}));
+}, checkVisibility:function () {
+	var show = this.items[1].refresh();
+	if (show) {
+		this.items[0].refresh();
+		for (var i in this.items) {
+			this.items[i].show();
+		}
+	} else {
+		for (var i in this.items) {
+			this.items[i].hide();
+		}
+	}
+	return show;
+}});
+dojo.declare(&quot;dojo.widget.Editor2Plugin.ImageContextMenuGroup&quot;, dojo.widget.Editor2Plugin.SimpleContextMenuGroup, {createItems:function () {
+	this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {command:&quot;insertimage&quot;, iconClass:&quot;dojoE2TBIcon dojoE2TBIcon_Image&quot;}));
+}, checkVisibility:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	var img = dojo.withGlobal(curInst.window, &quot;getSelectedElement&quot;, dojo.html.selection);
+	if (img &amp;&amp; img.tagName.toLowerCase() == &quot;img&quot;) {
+		this.items[0].show();
+		return true;
+	} else {
+		this.items[0].hide();
+		return false;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/CreateLinkDialog.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/CreateLinkDialog.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/CreateLinkDialog.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,63 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.CreateLinkDialog&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2CreateLinkDialog&quot;, dojo.widget.Editor2DialogContent, {templateString:&quot;&lt;table&gt;\n&lt;tr&gt;&lt;td&gt;URL&lt;/td&gt;&lt;td&gt; &lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;link_href\&quot; name=\&quot;dojo_createLink_href\&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Target &lt;/td&gt;&lt;td&gt;&lt;select dojoAttachPoint=\&quot;link_target\&quot;&gt;\n\t&lt;option value=\&quot;\&quot;&gt;Self&lt;/option&gt;\n\t&lt;option value=\&quot;_blank\&quot;&gt;New Window&lt;/option&gt;\n\t&lt;option value=\&quot;_top\&quot;&gt;Top Window&lt;/option&gt;\n\t&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Class &lt;/td&gt;&lt;td&gt;&lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;link_class\&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan=\&quot;2\&quot;&gt;\n\t&lt;table&gt;&lt;tr&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:ok'&gt;OK&lt;/button&gt;&lt;/td&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Cancel&lt;/button&gt;&lt;/td&gt;\n\t&lt;/tr&gt;&lt;/table&gt;\n\t&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&quot;, editableAttributes:[&quot;href&quot;, &quot;target&quot;, &quot;class&quot;], loadContent:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	curInst.saveSelection();
+	this.linkNode = dojo.withGlobal(curInst.window, &quot;getAncestorElement&quot;, dojo.html.selection, [&quot;a&quot;]);
+	var linkAttributes = {};
+	this.extraAttribText = &quot;&quot;;
+	if (this.linkNode) {
+		var attrs = this.linkNode.attributes;
+		for (var i = 0; i &lt; attrs.length; i++) {
+			if (dojo.lang.find(this.editableAttributes, attrs[i].name.toLowerCase()) &gt; -1) {
+				linkAttributes[attrs[i].name] = attrs[i].value;
+			} else {
+				if (attrs[i].specified == undefined || attrs[i].specified) {
+					this.extraAttribText += attrs[i].name + &quot;=\&quot;&quot; + attrs[i].value + &quot;\&quot; &quot;;
+				}
+			}
+		}
+	} else {
+		var html = dojo.withGlobal(curInst.window, &quot;getSelectedText&quot;, dojo.html.selection);
+		if (html == null || html.length == 0) {
+			alert(&quot;Please select some text to create a link.&quot;);
+			return false;
+		}
+	}
+	for (var i = 0; i &lt; this.editableAttributes.length; ++i) {
+		name = this.editableAttributes[i];
+		this[&quot;link_&quot; + name].value = (linkAttributes[name] == undefined) ? &quot;&quot; : linkAttributes[name];
+	}
+	return true;
+}, ok:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	curInst.restoreSelection();
+	if (!this.linkNode) {
+		var html = dojo.withGlobal(curInst.window, &quot;getSelectedHtml&quot;, dojo.html.selection);
+	} else {
+		var html = this.linkNode.innerHTML;
+		dojo.withGlobal(curInst.window, &quot;selectElement&quot;, dojo.html.selection, [this.linkNode]);
+	}
+	var attstr = &quot;&quot;;
+	for (var i = 0; i &lt; this.editableAttributes.length; ++i) {
+		name = this.editableAttributes[i];
+		var value = this[&quot;link_&quot; + name].value;
+		if (value.length &gt; 0) {
+			attstr += name + &quot;=\&quot;&quot; + value + &quot;\&quot; &quot;;
+		}
+	}
+	curInst.execCommand(&quot;inserthtml&quot;, &quot;&lt;a &quot; + attstr + this.extraAttribText + &quot;&gt;&quot; + html + &quot;&lt;/a&gt;&quot;);
+	this.cancel();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplace.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplace.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplace.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,61 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.FindReplace&quot;);
+dojo.require(&quot;dojo.widget.Editor2&quot;);
+dojo.declare(&quot;dojo.widget.Editor2Plugin.FindCommand&quot;, dojo.widget.Editor2DialogCommand, {SearchOption:{CaseSensitive:4, SearchBackwards:64, WholeWord:2, WrapSearch:128}, find:function (text, option) {
+	this._editor.focus();
+	if (window.find) {
+		this._editor.window.find(text, option &amp; this.SearchOption.CaseSensitive ? true : false, option &amp; this.SearchOption.SearchBackwards ? true : false, option &amp; this.SearchOption.WrapSearch ? true : false, option &amp; this.SearchOption.WholeWord ? true : false);
+	} else {
+		if (dojo.body().createTextRange) {
+			var range = this._editor.document.body.createTextRange();
+			var found = range.findText(text, (option &amp; this.SearchOption.SearchBackwards) ? 1 : -1, option);
+			if (found) {
+				range.scrollIntoView();
+				range.select();
+			} else {
+				alert(&quot;Can not find &quot; + text + &quot; in the document&quot;);
+			}
+		} else {
+			alert(&quot;No idea how to search in this browser. Please submit patch if you know.&quot;);
+		}
+	}
+}, getText:function () {
+	return &quot;Find&quot;;
+}});
+dojo.widget.Editor2Plugin.FindReplace = {getCommand:function (editor, name) {
+	var name = name.toLowerCase();
+	var command;
+	if (name == &quot;find&quot;) {
+		command = new dojo.widget.Editor2Plugin.FindCommand(editor, &quot;find&quot;, {contentFile:&quot;dojo.widget.Editor2Plugin.FindReplaceDialog&quot;, contentClass:&quot;Editor2FindDialog&quot;, title:&quot;Find&quot;, width:&quot;350px&quot;, height:&quot;150px&quot;, modal:false});
+	} else {
+		if (name == &quot;replace&quot;) {
+			command = new dojo.widget.Editor2DialogCommand(editor, &quot;replace&quot;, {contentFile:&quot;dojo.widget.Editor2Plugin.FindReplaceDialog&quot;, contentClass:&quot;Editor2ReplaceDialog&quot;, href:dojo.uri.cache.set(dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/Dialog/replace.html&quot;), &quot;&lt;table style=\&quot;white-space: nowrap;\&quot;&gt;\n&lt;tr&gt;&lt;td&gt;Find: &lt;/td&gt;&lt;td&gt; &lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;replace_text\&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Replace with: &lt;/td&gt;&lt;td&gt; &lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;replace_text\&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan='2'&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;replace_option_casesens\&quot; id=\&quot;dojo_replace_option_casesens\&quot; /&gt;\n\t\t&lt;label for=\&quot;dojo_replace_option_casesens\&quot;&gt;Case Sensitive&lt;/label&gt;&lt;/td&gt;\n\t\t\t&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;replace_option_backwards\&quot; id=\&quot;dojo_replace_option_backwards\&quot; /&gt;\n\t\t&lt;label for=\&quot;dojo_replace_option_backwards\&quot;&gt;Search Backwards&lt;/label&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;\n!
 &lt;tr&gt;&lt;td colspan=2\&quot;&gt;\n\t&lt;table&gt;&lt;tr&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:replace'&gt;Replace&lt;/button&gt;&lt;/td&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:replaceAll'&gt;Replace All&lt;/button&gt;&lt;/td&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Close&lt;/button&gt;&lt;/td&gt;\n\t&lt;/tr&gt;&lt;/table&gt;\n\t&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&quot;), title:&quot;Replace&quot;, width:&quot;350px&quot;, height:&quot;200px&quot;, modal:false});
+		}
+	}
+	return command;
+}, getToolbarItem:function (name) {
+	var name = name.toLowerCase();
+	var item;
+	if (name == &quot;replace&quot;) {
+		item = new dojo.widget.Editor2ToolbarButton(&quot;Replace&quot;);
+	} else {
+		if (name == &quot;find&quot;) {
+			item = new dojo.widget.Editor2ToolbarButton(&quot;Find&quot;);
+		}
+	}
+	return item;
+}};
+dojo.widget.Editor2Manager.registerHandler(dojo.widget.Editor2Plugin.FindReplace.getCommand);
+dojo.widget.Editor2ToolbarItemManager.registerHandler(dojo.widget.Editor2Plugin.FindReplace.getToolbarItem);
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplaceDialog.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplaceDialog.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/FindReplaceDialog.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,34 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.FindReplaceDialog&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2FindDialog&quot;, dojo.widget.Editor2DialogContent, {templateString:&quot;&lt;table style=\&quot;white-space: nowrap;\&quot;&gt;\n&lt;tr&gt;&lt;td colspan='2'&gt;Find: &lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;find_text\&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;find_option_casesens\&quot; /&gt;\n\t\t&lt;label for=\&quot;find_option_casesens\&quot;&gt;Case Sensitive&lt;/label&gt;&lt;/td&gt;\n\t\t\t&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;find_option_backwards\&quot; /&gt;\n\t\t&lt;label for=\&quot;find_option_backwards\&quot;&gt;Search Backwards&lt;/label&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td style=\&quot;display: none;\&quot;&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;find_option_wholeword\&quot; /&gt;\n\t\t&lt;label for=\&quot;find_option_wholeword\&quot;&gt;Whole Word&lt;/label&gt;&lt;/td&gt;\n&lt;tr&gt;&lt;td colspan=\&quot;1\&quot;&gt;\n\t&lt;table&gt;&lt;tr&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:find'&gt;Find&lt;/button&gt;&lt;/td&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Close&lt;/button&gt;&lt;/td&gt;\!
 n\t&lt;/tr&gt;&lt;/table&gt;\n\t&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&quot;, find:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	var findcmd = curInst.getCommand(&quot;find&quot;);
+	var option = 0;
+	if (this[&quot;find_option_casesens&quot;].checked) {
+		option |= findcmd.SearchOption.CaseSensitive;
+	}
+	if (this[&quot;find_option_backwards&quot;].checked) {
+		option |= findcmd.SearchOption.SearchBackwards;
+	}
+	if (this[&quot;find_option_wholeword&quot;].checked) {
+		option |= findcmd.SearchOption.WholeWord;
+	}
+	findcmd.find(this[&quot;find_text&quot;].value, option);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2ReplaceDialog&quot;, dojo.widget.Editor2DialogContent, {templateString:&quot;&lt;table style=\&quot;white-space: nowrap;\&quot;&gt;\n&lt;tr&gt;&lt;td&gt;Find: &lt;/td&gt;&lt;td&gt; &lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;replace_text\&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td&gt;Replace with: &lt;/td&gt;&lt;td&gt; &lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;replace_text\&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan='2'&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;replace_option_casesens\&quot; id=\&quot;dojo_replace_option_casesens\&quot; /&gt;\n\t\t&lt;label for=\&quot;dojo_replace_option_casesens\&quot;&gt;Case Sensitive&lt;/label&gt;&lt;/td&gt;\n\t\t\t&lt;td&gt;&lt;input type=\&quot;checkbox\&quot; dojoType=\&quot;CheckBox\&quot; dojoAttachPoint=\&quot;replace_option_backwards\&quot; id=\&quot;dojo_replace_option_backwards\&quot; /&gt;\n\t\t&lt;label for=\&quot;dojo_replace_option_backwards\&quot;&gt;Search Backwards&lt;/label&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;\n&lt;tr&gt;&lt;td colspan=2\&quot;&gt;\n\t&lt;table&gt;&lt;tr&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:replace'&gt;Replace&lt;/button&gt;&lt;/td&gt;\n\t&lt;td&gt;&lt;button dojoType='Butto!
 n' dojoAttachEvent='onClick:replaceAll'&gt;Replace All&lt;/button&gt;&lt;/td&gt;\n\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Close&lt;/button&gt;&lt;/td&gt;\n\t&lt;/tr&gt;&lt;/table&gt;\n\t&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&quot;, replace:function () {
+	alert(&quot;not implemented yet&quot;);
+}, replaceAll:function () {
+	alert(&quot;not implemented yet&quot;);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertImageDialog.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertImageDialog.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertImageDialog.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,55 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.InsertImageDialog&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2InsertImageDialog&quot;, dojo.widget.Editor2DialogContent, {templateString:&quot;&lt;table cellspacing=\&quot;1\&quot; cellpadding=\&quot;1\&quot; border=\&quot;0\&quot; width=\&quot;100%\&quot; height=\&quot;100%\&quot;&gt;\n\t&lt;tr&gt;\n\t\t&lt;td&gt;\n\t\t\t&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; width=\&quot;100%\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td width=\&quot;100%\&quot;&gt;\n\t\t\t\t\t\t&lt;span&gt;URL&lt;/span&gt;\n\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t&lt;td style=\&quot;display: none\&quot; nowrap=\&quot;nowrap\&quot; rowspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t\t&lt;!--input id=\&quot;btnBrowse\&quot; onclick=\&quot;BrowseServer();\&quot; type=\&quot;button\&quot; value=\&quot;Browse Server\&quot;/--&gt;\n\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t\t&lt;input dojoAttachPoint=\&quot;image_src\&quot; style=\&quot;width: 100%\&quot; type=\&quot;text\&quot; /&gt;\n\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t&lt;/table&gt;\n\t\t&lt;/td&gt;\n\t&lt;/tr&gt;\n\t&lt;tr&gt;\n\t\t&lt;td&gt;\n\t\t\t&lt;span&gt;Alternative Text&lt;/span&gt;&lt;br /&gt;\n\t\t\t&lt;input dojoAttachPoint=\&quot;image_alt\&quot; style=\&quot;width: 100%\&quot; type=\&quot;text\&quot; /&gt;&lt;br /&gt;\n\t\t&lt;/td&gt;\n\t&lt;/tr&gt;\n\t&lt;tr&gt;!
 \n\t\t&lt;td valign=\&quot;top\&quot;&gt;\n\t\t\t&lt;table&gt;&lt;tr&gt;&lt;td&gt;\n\t\t\t\t\t\t&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td nowrap=\&quot;nowrap\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;span&gt;Width&lt;/span&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;input type=\&quot;text\&quot; size=\&quot;3\&quot; dojoAttachPoint=\&quot;image_width\&quot; /&gt;&lt;/td&gt;\n\n\t\t\t\t\t\t\t\t&lt;td rowspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;!--div id=\&quot;btnLockSizes\&quot; class=\&quot;BtnLocked\&quot; onmouseover=\&quot;this.className = (bLockRatio ? 'BtnLocked' : 'BtnUnlocked' ) + ' BtnOver';\&quot;\n\t\t\t\t\t\t\t\t\t\tonmouseout=\&quot;this.className = (bLockRatio ? 'BtnLocked' : 'BtnUnlocked' );\&quot; title=\&quot;Lock Sizes\&quot;\n\t\t\t\t\t\t\t\t\t\tonclick=\&quot;SwitchLock(this);\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;/div--&gt;\n\t\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td rowspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;!--div id=\&quot;btnResetSize\&quot; class=\&quot;BtnReset\&quot; onmouseover=\&quot;this.className='BtnReset BtnOver';\&quot;\n\t\t\t\t\t\t\t\t\t\tonmouseout=\&quot;this.className='BtnReset';\&quot; title=\&quot;Reset!
  Size\&quot; onclick=\&quot;ResetSizes();\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;/div--&gt;!
 \n\t\t\t
\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td nowrap=\&quot;nowrap\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;span&gt;Height&lt;/span&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;input type=\&quot;text\&quot; size=\&quot;3\&quot; dojoAttachPoint=\&quot;image_height\&quot; /&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t\t&lt;/td&gt;&lt;td&gt;\n\n\t\t\t\t\t\t&lt;table cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\n\t\t\t\t\t\t\t\t&lt;td nowrap=\&quot;nowrap\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;span &gt;HSpace&lt;/span&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;input type=\&quot;text\&quot; size=\&quot;2\&quot; dojoAttachPoint=\&quot;image_hspace\&quot;/&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td nowrap=\&quot;nowrap\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;span &gt;VSpace&lt;/span&gt;&nbsp;&lt;/td&gt;\n\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;input type=\&quot;text\&quot; size=\&quot;2\&quot; dojoAttachPoint=\&quot;image_vspace\&quot; /&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t\t&lt;/td&gt;&lt;/tr&gt;\n\t\t\t\t\t&lt;tr&gt;&lt;td colspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t\t&lt;tab!
 le cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td nowrap=\&quot;nowrap\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;span&gt;Border&lt;/span&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;input type=\&quot;text\&quot; size=\&quot;2\&quot; value=\&quot;\&quot; dojoAttachPoint=\&quot;image_border\&quot; /&gt;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;&nbsp;&nbsp;&nbsp;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td nowrap=\&quot;nowrap\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;span &gt;Align&lt;/span&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;select dojoAttachPoint=\&quot;image_align\&quot;&gt;\n\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;\&quot; selected=\&quot;selected\&quot;&gt;&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;left\&quot;&gt;Left&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;absBottom\&quot;&gt;Abs Bottom&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;absMiddle\&quot;&gt;Abs Middle&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;baseline\&quot;&gt;Baseline&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;bottom\&quot;&gt;Bottom&lt;/option&gt;\n\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;middle\&quot;&gt;Middle&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t!
 &lt;option value=\&quot;right\&quot;&gt;Right&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;o!
 ption va
lue=\&quot;textTop\&quot;&gt;Text Top&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;option value=\&quot;top\&quot;&gt;Top&lt;/option&gt;\n\t\t\t\t\t\t\t\t\t&lt;/select&gt;\n\t\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;&lt;/table&gt;\n\t\t&lt;/td&gt;\n\t&lt;/tr&gt;\n\t&lt;tr&gt;&lt;td&gt;\n\t\t&lt;table&gt;&lt;tr&gt;\n\t\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:ok'&gt;OK&lt;/button&gt;&lt;/td&gt;\n\t\t&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Cancel&lt;/button&gt;&lt;/td&gt;\n\t\t&lt;/tr&gt;&lt;/table&gt;\n\t&lt;/td&gt;&lt;/tr&gt;\n&lt;/table&gt;\n&quot;, editableAttributes:[&quot;src&quot;, &quot;alt&quot;, &quot;width&quot;, &quot;height&quot;, &quot;hspace&quot;, &quot;vspace&quot;, &quot;border&quot;, &quot;align&quot;], loadContent:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	this.imageNode = dojo.withGlobal(curInst.window, &quot;getSelectedElement&quot;, dojo.html.selection);
+	if (!this.imageNode) {
+		this.imageNode = dojo.withGlobal(curInst.window, &quot;getAncestorElement&quot;, dojo.html.selection, [&quot;img&quot;]);
+	}
+	var imageAttributes = {};
+	this.extraAttribText = &quot;&quot;;
+	if (this.imageNode) {
+		var attrs = this.imageNode.attributes;
+		for (var i = 0; i &lt; attrs.length; i++) {
+			if (dojo.lang.find(this.editableAttributes, attrs[i].name.toLowerCase()) &gt; -1) {
+				imageAttributes[attrs[i].name] = attrs[i].value;
+			} else {
+				this.extraAttribText += attrs[i].name + &quot;=\&quot;&quot; + attrs[i].value + &quot;\&quot; &quot;;
+			}
+		}
+	}
+	for (var i = 0; i &lt; this.editableAttributes.length; ++i) {
+		name = this.editableAttributes[i];
+		this[&quot;image_&quot; + name].value = (imageAttributes[name] == undefined) ? &quot;&quot; : imageAttributes[name];
+	}
+	return true;
+}, ok:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	var insertcmd = curInst.getCommand(&quot;inserthtml&quot;);
+	var option = 0;
+	var attstr = &quot;&quot;;
+	for (var i = 0; i &lt; this.editableAttributes.length; ++i) {
+		name = this.editableAttributes[i];
+		var value = this[&quot;image_&quot; + name].value;
+		if (value.length &gt; 0) {
+			attstr += name + &quot;=\&quot;&quot; + value + &quot;\&quot; &quot;;
+		}
+	}
+	if (this.imageNode) {
+		dojo.withGlobal(curInst.window, &quot;selectElement&quot;, dojo.html.selection, [this.imageNode]);
+	}
+	insertcmd.execute(&quot;&lt;img &quot; + attstr + this.extraAttribText + &quot;/&gt;&quot;);
+	this.cancel();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertTableDialog.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertTableDialog.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/InsertTableDialog.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,131 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.InsertTableDialog&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2InsertTableDialog&quot;, dojo.widget.Editor2DialogContent, {templateString:&quot;&lt;div&gt;\n&lt;table cellSpacing=\&quot;1\&quot; cellPadding=\&quot;1\&quot; width=\&quot;100%\&quot; border=\&quot;0\&quot;&gt;\n\t&lt;tr&gt;\n\t\t&lt;td valign=\&quot;top\&quot;&gt;\n\t\t\t&lt;table cellSpacing=\&quot;0\&quot; cellPadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t&lt;tr&gt;\n\n\t\t\t\t\t&lt;td&gt;&lt;span&gt;Rows&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=\&quot;table_rows\&quot; type=\&quot;text\&quot; maxLength=\&quot;3\&quot; size=\&quot;2\&quot; value=\&quot;3\&quot;&gt;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&lt;span&gt;Columns&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=\&quot;table_cols\&quot; type=\&quot;text\&quot; maxLength=\&quot;2\&quot; size=\&quot;2\&quot; value=\&quot;2\&quot;&gt;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&lt;span&gt;Border size&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;INPUT dojoAttachPoint=\&quot;table_border\&quot; type=\&quot;text\&quot; maxLength=\&quot;2\&quot; size=\&quot;2\&quot; value=\&quot;1\&quot;&gt;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&lt;span&gt;Al!
 ignment&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;select dojoAttachPoint=\&quot;table_align\&quot;&gt;\n\t\t\t\t\t\t\t&lt;option value=\&quot;\&quot; selected&gt;&lt;Not set&gt;&lt;/option&gt;\n\t\t\t\t\t\t\t&lt;option value=\&quot;left\&quot;&gt;Left&lt;/option&gt;\n\t\t\t\t\t\t\t&lt;option value=\&quot;center\&quot;&gt;Center&lt;/option&gt;\n\t\t\t\t\t\t\t&lt;option value=\&quot;right\&quot;&gt;Right&lt;/option&gt;\n\t\t\t\t\t\t&lt;/select&gt;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t&lt;/table&gt;\n\t\t&lt;/td&gt;\n\t\t&lt;td&gt;&nbsp;&nbsp;&nbsp;&lt;/td&gt;\n\t\t&lt;td align=\&quot;right\&quot; valign=\&quot;top\&quot;&gt;\n\t\t\t&lt;table cellSpacing=\&quot;0\&quot; cellPadding=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&lt;span&gt;Width&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=\&quot;table_width\&quot; type=\&quot;text\&quot; maxLength=\&quot;4\&quot; size=\&quot;3\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;select dojoAttachPoint=\&quot;table_widthtype\&quot;&gt;\n\t\t\t\t\t\t\t&lt;option value=\&quot;percent\&quot; selected&gt;percent&lt;/option&gt;\n\t\t\t\t\t\t\t&lt;option value=\&quot;pixels\&quot;&gt;pixels&lt;/option&gt;\n\t\t\t\t\t\t&lt;/select&gt;&lt;/td&gt;\n\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&lt;span&gt;Height&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&amp;n!
 bsp;&lt;INPUT dojoAttachPoint=\&quot;table_height\&quot; type=\&quot;text\&quot; maxL!
 ength=\&quot;
4\&quot; size=\&quot;3\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;span&gt;pixels&lt;/span&gt;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td nowrap&gt;&lt;span&gt;Cell spacing&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=\&quot;table_cellspacing\&quot; type=\&quot;text\&quot; maxLength=\&quot;2\&quot; size=\&quot;2\&quot; value=\&quot;1\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\n\t\t\t\t&lt;/tr&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td nowrap&gt;&lt;span&gt;Cell padding&lt;/span&gt;:&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=\&quot;table_cellpadding\&quot; type=\&quot;text\&quot; maxLength=\&quot;2\&quot; size=\&quot;2\&quot; value=\&quot;1\&quot;&gt;&lt;/td&gt;\n\t\t\t\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t&lt;/table&gt;\n\t\t&lt;/td&gt;\n\t&lt;/tr&gt;\n&lt;/table&gt;\n&lt;table cellSpacing=\&quot;0\&quot; cellPadding=\&quot;0\&quot; width=\&quot;100%\&quot; border=\&quot;0\&quot;&gt;\n\t&lt;tr&gt;\n\t\t&lt;td nowrap&gt;&lt;span&gt;Caption&lt;/span&gt;:&lt;/td&gt;\n\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t&lt;td width=\&quot;100%\&quot; nowrap&gt;&nbsp;\n\t\t\t&lt;input dojoAttachPoint=\&quot;table_caption\&quot; type=\&quot;text\&quot; style=\&quot;WIDTH: 90%\&quot;&gt;&lt;/td&gt;\n\t&lt;/tr!
 &gt;\n\t&lt;tr&gt;\n\t\t&lt;td nowrap&gt;&lt;span&gt;Summary&lt;/span&gt;:&lt;/td&gt;\n\t\t&lt;td&gt;&nbsp;&lt;/td&gt;\n\t\t&lt;td width=\&quot;100%\&quot; nowrap&gt;&nbsp;\n\t\t\t&lt;input dojoAttachPoint=\&quot;table_summary\&quot; type=\&quot;text\&quot; style=\&quot;WIDTH: 90%\&quot;&gt;&lt;/td&gt;\n\t&lt;/tr&gt;\n&lt;/table&gt;\n&lt;table&gt;&lt;tr&gt;\n&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:ok'&gt;Ok&lt;/button&gt;&lt;/td&gt;\n&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Cancel&lt;/button&gt;&lt;/td&gt;\n&lt;/tr&gt;&lt;/table&gt;\n&lt;/div&gt;\n&quot;, editableAttributes:[&quot;summary&quot;, &quot;height&quot;, &quot;cellspacing&quot;, &quot;cellpadding&quot;, &quot;border&quot;, &quot;align&quot;], loadContent:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	curInst.saveSelection();
+	this.tableNode = dojo.withGlobal(curInst.window, &quot;getSelectedElement&quot;, dojo.html.selection);
+	if (!this.tableNode || this.tableNode.tagName.toLowerCase() != &quot;table&quot;) {
+		this.tableNode = dojo.withGlobal(curInst.window, &quot;getAncestorElement&quot;, dojo.html.selection, [&quot;table&quot;]);
+	}
+	var tableAttributes = {};
+	this.extraAttribText = &quot;&quot;;
+	if (this.tableNode) {
+		this[&quot;table_rows&quot;].value = this.tableNode.rows.length;
+		this[&quot;table_rows&quot;].disabled = true;
+		this[&quot;table_cols&quot;].value = this.tableNode.rows[0].cells.length;
+		this[&quot;table_cols&quot;].disabled = true;
+		if (this.tableNode.caption) {
+			this[&quot;table_caption&quot;].value = this.tableNode.caption.innerHTML;
+		} else {
+			this[&quot;table_caption&quot;].value = &quot;&quot;;
+		}
+		var width = this.tableNode.style.width || this.tableNode.width;
+		if (width) {
+			this[&quot;table_width&quot;].value = parseInt(width);
+			if (width.indexOf(&quot;%&quot;) &gt; -1) {
+				this[&quot;table_widthtype&quot;].value = &quot;percent&quot;;
+			} else {
+				this[&quot;table_widthtype&quot;].value = &quot;pixels&quot;;
+			}
+		} else {
+			this[&quot;table_width&quot;].value = &quot;100&quot;;
+		}
+		var height = this.tableNode.style.height || this.tableNode.height;
+		if (height) {
+			this[&quot;table_height&quot;].value = parseInt(width);
+		} else {
+			this[&quot;table_height&quot;].value = &quot;&quot;;
+		}
+		var attrs = this.tableNode.attributes;
+		for (var i = 0; i &lt; attrs.length; i++) {
+			if (dojo.lang.find(this.editableAttributes, attrs[i].name.toLowerCase()) &gt; -1) {
+				tableAttributes[attrs[i].name] = attrs[i].value;
+			} else {
+				this.extraAttribText += attrs[i].name + &quot;=\&quot;&quot; + attrs[i].value + &quot;\&quot; &quot;;
+			}
+		}
+	} else {
+		this[&quot;table_rows&quot;].value = 3;
+		this[&quot;table_rows&quot;].disabled = false;
+		this[&quot;table_cols&quot;].value = 2;
+		this[&quot;table_cols&quot;].disabled = false;
+		this[&quot;table_width&quot;].value = 100;
+		this[&quot;table_widthtype&quot;].value = &quot;percent&quot;;
+		this[&quot;table_height&quot;].value = &quot;&quot;;
+	}
+	for (var i = 0; i &lt; this.editableAttributes.length; ++i) {
+		name = this.editableAttributes[i];
+		this[&quot;table_&quot; + name].value = (tableAttributes[name] == undefined) ? &quot;&quot; : tableAttributes[name];
+		if (name == &quot;height&quot; &amp;&amp; tableAttributes[name] != undefined) {
+			this[&quot;table_&quot; + name].value = tableAttributes[name];
+		}
+	}
+	return true;
+}, ok:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	var args = {};
+	args[&quot;rows&quot;] = this[&quot;table_rows&quot;].value;
+	args[&quot;cols&quot;] = this[&quot;table_cols&quot;].value;
+	args[&quot;caption&quot;] = this[&quot;table_caption&quot;].value;
+	args[&quot;tableattrs&quot;] = &quot;&quot;;
+	if (this[&quot;table_widthtype&quot;].value == &quot;percent&quot;) {
+		args[&quot;tableattrs&quot;] += &quot;width=\&quot;&quot; + this[&quot;table_width&quot;].value + &quot;%\&quot; &quot;;
+	} else {
+		args[&quot;tableattrs&quot;] += &quot;width=\&quot;&quot; + this[&quot;table_width&quot;].value + &quot;px\&quot; &quot;;
+	}
+	for (var i = 0; i &lt; this.editableAttributes.length; ++i) {
+		var name = this.editableAttributes[i];
+		var value = this[&quot;table_&quot; + name].value;
+		if (value.length &gt; 0) {
+			args[&quot;tableattrs&quot;] += name + &quot;=\&quot;&quot; + value + &quot;\&quot; &quot;;
+		}
+	}
+	if (!args[&quot;tableattrs&quot;]) {
+		args[&quot;tableattrs&quot;] = &quot;&quot;;
+	}
+	if (dojo.render.html.ie &amp;&amp; !this[&quot;table_border&quot;].value) {
+		args[&quot;tableattrs&quot;] += &quot;class=\&quot;dojoShowIETableBorders\&quot; &quot;;
+	}
+	var html = &quot;&lt;table &quot; + args[&quot;tableattrs&quot;] + &quot;&gt;&quot;;
+	if (args[&quot;caption&quot;]) {
+		html += &quot;&lt;caption&gt;&quot; + args[&quot;caption&quot;] + &quot;&lt;/caption&gt;&quot;;
+	}
+	var outertbody = &quot;&lt;tbody&gt;&quot;;
+	if (this.tableNode) {
+		var tbody = this.tableNode.getElementsByTagName(&quot;tbody&quot;)[0];
+		outertbody = tbody.outerHTML;
+		if (!outertbody) {
+			var cnode = tbody.cloneNode(true);
+			var tmpnode = tbody.ownerDocument.createElement(&quot;div&quot;);
+			tmpnode.appendChild(cnode);
+			outertbody = tmpnode.innerHTML;
+		}
+		dojo.withGlobal(curInst.window, &quot;selectElement&quot;, dojo.html.selection, [this.tableNode]);
+	} else {
+		var cols = &quot;&lt;tr&gt;&quot;;
+		for (var i = 0; i &lt; +args.cols; i++) {
+			cols += &quot;&lt;td&gt;&lt;/td&gt;&quot;;
+		}
+		cols += &quot;&lt;/tr&gt;&quot;;
+		for (var i = 0; i &lt; args.rows; i++) {
+			outertbody += cols;
+		}
+		outertbody += &quot;&lt;/tbody&gt;&quot;;
+	}
+	html += outertbody + &quot;&lt;/table&gt;&quot;;
+	curInst.restoreSelection();
+	curInst.execCommand(&quot;inserthtml&quot;, html);
+	this.cancel();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/SimpleSignalCommands.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/SimpleSignalCommands.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/SimpleSignalCommands.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,52 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.SimpleSignalCommands&quot;);
+dojo.require(&quot;dojo.widget.Editor2&quot;);
+dojo.declare(&quot;dojo.widget.Editor2Plugin.SimpleSignalCommand&quot;, dojo.widget.Editor2Command, function (editor, name) {
+	if (dojo.widget.Editor2.prototype[name] == undefined) {
+		dojo.widget.Editor2.prototype[name] = function () {
+		};
+	}
+}, {execute:function () {
+	this._editor[this._name]();
+}});
+if (dojo.widget.Editor2Plugin[&quot;SimpleSignalCommands&quot;]) {
+	dojo.widget.Editor2Plugin[&quot;_SimpleSignalCommands&quot;] = dojo.widget.Editor2Plugin[&quot;SimpleSignalCommands&quot;];
+}
+dojo.widget.Editor2Plugin.SimpleSignalCommands = {signals:[&quot;save&quot;, &quot;insertImage&quot;], Handler:function (name) {
+	if (name.toLowerCase() == &quot;save&quot;) {
+		return new dojo.widget.Editor2ToolbarButton(&quot;Save&quot;);
+	} else {
+		if (name.toLowerCase() == &quot;insertimage&quot;) {
+			return new dojo.widget.Editor2ToolbarButton(&quot;InsertImage&quot;);
+		}
+	}
+}, getCommand:function (editor, name) {
+	var signal;
+	dojo.lang.every(this.signals, function (s) {
+		if (s.toLowerCase() == name.toLowerCase()) {
+			signal = s;
+			return false;
+		}
+		return true;
+	});
+	if (signal) {
+		return new dojo.widget.Editor2Plugin.SimpleSignalCommand(editor, signal);
+	}
+}};
+if (dojo.widget.Editor2Plugin[&quot;_SimpleSignalCommands&quot;]) {
+	dojo.lang.mixin(dojo.widget.Editor2Plugin.SimpleSignalCommands, dojo.widget.Editor2Plugin[&quot;_SimpleSignalCommands&quot;]);
+}
+dojo.widget.Editor2Manager.registerHandler(dojo.widget.Editor2Plugin.SimpleSignalCommands, &quot;getCommand&quot;);
+dojo.widget.Editor2ToolbarItemManager.registerHandler(dojo.widget.Editor2Plugin.SimpleSignalCommands.Handler);
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/TableOperation.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/TableOperation.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/TableOperation.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,120 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.TableOperation&quot;);
+dojo.require(&quot;dojo.widget.Editor2&quot;);
+dojo.event.topic.subscribe(&quot;dojo.widget.RichText::init&quot;, function (editor) {
+	if (dojo.render.html.ie) {
+		editor.contentDomPreFilters.push(dojo.widget.Editor2Plugin.TableOperation.showIETableBorder);
+		editor.contentDomPostFilters.push(dojo.widget.Editor2Plugin.TableOperation.removeIEFakeClass);
+	}
+	editor.getCommand(&quot;toggletableborder&quot;);
+});
+dojo.lang.declare(&quot;dojo.widget.Editor2Plugin.deleteTableCommand&quot;, dojo.widget.Editor2Command, {execute:function () {
+	var table = dojo.withGlobal(this._editor.window, &quot;getAncestorElement&quot;, dojo.html.selection, [&quot;table&quot;]);
+	if (table) {
+		dojo.withGlobal(this._editor.window, &quot;selectElement&quot;, dojo.html.selection, [table]);
+		this._editor.execCommand(&quot;inserthtml&quot;, &quot; &quot;);
+	}
+}, getState:function () {
+	if (this._editor._lastStateTimestamp &gt; this._updateTime || this._state == undefined) {
+		this._updateTime = this._editor._lastStateTimestamp;
+		var table = dojo.withGlobal(this._editor.window, &quot;hasAncestorElement&quot;, dojo.html.selection, [&quot;table&quot;]);
+		this._state = table ? dojo.widget.Editor2Manager.commandState.Enabled : dojo.widget.Editor2Manager.commandState.Disabled;
+	}
+	return this._state;
+}, getText:function () {
+	return &quot;Delete Table&quot;;
+}});
+dojo.lang.declare(&quot;dojo.widget.Editor2Plugin.toggleTableBorderCommand&quot;, dojo.widget.Editor2Command, function () {
+	this._showTableBorder = false;
+	dojo.event.connect(this._editor, &quot;editorOnLoad&quot;, this, &quot;execute&quot;);
+}, {execute:function () {
+	if (this._showTableBorder) {
+		this._showTableBorder = false;
+		if (dojo.render.html.moz) {
+			this._editor.removeStyleSheet(dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/showtableborder_gecko.css&quot;));
+		} else {
+			if (dojo.render.html.ie) {
+				this._editor.removeStyleSheet(dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/showtableborder_ie.css&quot;));
+			}
+		}
+	} else {
+		this._showTableBorder = true;
+		if (dojo.render.html.moz) {
+			this._editor.addStyleSheet(dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/showtableborder_gecko.css&quot;));
+		} else {
+			if (dojo.render.html.ie) {
+				this._editor.addStyleSheet(dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/showtableborder_ie.css&quot;));
+			}
+		}
+	}
+}, getText:function () {
+	return &quot;Toggle Table Border&quot;;
+}, getState:function () {
+	return this._showTableBorder ? dojo.widget.Editor2Manager.commandState.Latched : dojo.widget.Editor2Manager.commandState.Enabled;
+}});
+dojo.widget.Editor2Plugin.TableOperation = {getCommand:function (editor, name) {
+	switch (name.toLowerCase()) {
+	  case &quot;toggletableborder&quot;:
+		return new dojo.widget.Editor2Plugin.toggleTableBorderCommand(editor, name);
+	  case &quot;inserttable&quot;:
+		return new dojo.widget.Editor2DialogCommand(editor, &quot;inserttable&quot;, {contentFile:&quot;dojo.widget.Editor2Plugin.InsertTableDialog&quot;, contentClass:&quot;Editor2InsertTableDialog&quot;, title:&quot;Insert/Edit Table&quot;, width:&quot;450px&quot;, height:&quot;250px&quot;});
+	  case &quot;deletetable&quot;:
+		return new dojo.widget.Editor2Plugin.deleteTableCommand(editor, name);
+	}
+}, getToolbarItem:function (name) {
+	var name = name.toLowerCase();
+	var item;
+	switch (name) {
+	  case &quot;inserttable&quot;:
+	  case &quot;toggletableborder&quot;:
+		item = new dojo.widget.Editor2ToolbarButton(name);
+	}
+	return item;
+}, getContextMenuGroup:function (name, contextmenuplugin) {
+	return new dojo.widget.Editor2Plugin.TableContextMenuGroup(contextmenuplugin);
+}, showIETableBorder:function (dom) {
+	var tables = dom.getElementsByTagName(&quot;table&quot;);
+	dojo.lang.forEach(tables, function (t) {
+		dojo.html.addClass(t, &quot;dojoShowIETableBorders&quot;);
+	});
+	return dom;
+}, removeIEFakeClass:function (dom) {
+	var tables = dom.getElementsByTagName(&quot;table&quot;);
+	dojo.lang.forEach(tables, function (t) {
+		dojo.html.removeClass(t, &quot;dojoShowIETableBorders&quot;);
+	});
+	return dom;
+}};
+dojo.widget.Editor2Manager.registerHandler(dojo.widget.Editor2Plugin.TableOperation.getCommand);
+dojo.widget.Editor2ToolbarItemManager.registerHandler(dojo.widget.Editor2Plugin.TableOperation.getToolbarItem);
+if (dojo.widget.Editor2Plugin.ContextMenuManager) {
+	dojo.widget.Editor2Plugin.ContextMenuManager.registerGroup(&quot;Table&quot;, dojo.widget.Editor2Plugin.TableOperation.getContextMenuGroup);
+	dojo.declare(&quot;dojo.widget.Editor2Plugin.TableContextMenuGroup&quot;, dojo.widget.Editor2Plugin.SimpleContextMenuGroup, {createItems:function () {
+		this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {caption:&quot;Delete Table&quot;, command:&quot;deletetable&quot;}));
+		this.items.push(dojo.widget.createWidget(&quot;Editor2ContextMenuItem&quot;, {caption:&quot;Table Property&quot;, command:&quot;inserttable&quot;, iconClass:&quot;TB_Button_Icon TB_Button_Table&quot;}));
+	}, checkVisibility:function () {
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		var table = dojo.withGlobal(curInst.window, &quot;hasAncestorElement&quot;, dojo.html.selection, [&quot;table&quot;]);
+		if (dojo.withGlobal(curInst.window, &quot;hasAncestorElement&quot;, dojo.html.selection, [&quot;table&quot;])) {
+			this.items[0].show();
+			this.items[1].show();
+			return true;
+		} else {
+			this.items[0].hide();
+			this.items[1].hide();
+			return false;
+		}
+	}});
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ToolbarDndSupport.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ToolbarDndSupport.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/ToolbarDndSupport.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,46 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Plugin.ToolbarDndSupport&quot;);
+dojo.require(&quot;dojo.dnd.*&quot;);
+dojo.event.topic.subscribe(&quot;dojo.widget.Editor2::preLoadingToolbar&quot;, function (editor) {
+	dojo.dnd.dragManager.nestedTargets = true;
+	var p = new dojo.widget.Editor2Plugin.ToolbarDndSupport(editor);
+});
+dojo.declare(&quot;dojo.widget.Editor2Plugin.ToolbarDndSupport&quot;, null, {lookForClass:&quot;dojoEditorToolbarDnd TB_ToolbarSet TB_Toolbar&quot;, initializer:function (editor) {
+	this.editor = editor;
+	dojo.event.connect(this.editor, &quot;toolbarLoaded&quot;, this, &quot;setup&quot;);
+	this.editor.registerLoadedPlugin(this);
+}, setup:function () {
+	dojo.event.disconnect(this.editor, &quot;toolbarLoaded&quot;, this, &quot;setup&quot;);
+	var tbw = this.editor.toolbarWidget;
+	dojo.event.connect(&quot;before&quot;, tbw, &quot;destroy&quot;, this, &quot;destroy&quot;);
+	var nodes = dojo.html.getElementsByClass(this.lookForClass, tbw.domNode, null, dojo.html.classMatchType.ContainsAny);
+	if (!nodes) {
+		dojo.debug(&quot;dojo.widget.Editor2Plugin.ToolbarDndSupport: No dom node with class in &quot; + this.lookForClass);
+		return;
+	}
+	for (var i = 0; i &lt; nodes.length; i++) {
+		var node = nodes[i];
+		var droptarget = node.getAttribute(&quot;dojoETDropTarget&quot;);
+		if (droptarget) {
+			(new dojo.dnd.HtmlDropTarget(node, [droptarget + tbw.widgetId])).vertical = true;
+		}
+		var dragsource = node.getAttribute(&quot;dojoETDragSource&quot;);
+		if (dragsource) {
+			new dojo.dnd.HtmlDragSource(node, dragsource + tbw.widgetId);
+		}
+	}
+}, destroy:function () {
+	this.editor.unregisterLoadedPlugin(this);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Plugin/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.widget.Editor2&quot;, &quot;dojo.widget.Editor2Toolbar&quot;]});
+dojo.provide(&quot;dojo.widget.Editor2Plugin.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/Editor2Toolbar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Editor2Toolbar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Editor2Toolbar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,496 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Editor2Toolbar&quot;);
+dojo.require(&quot;dojo.lang.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.widget.RichText&quot;);
+dojo.require(&quot;dojo.widget.PopupContainer&quot;);
+dojo.require(&quot;dojo.widget.ColorPalette&quot;);
+dojo.lang.declare(&quot;dojo.widget.HandlerManager&quot;, null, function () {
+	this._registeredHandlers = [];
+}, {registerHandler:function (obj, func) {
+	if (arguments.length == 2) {
+		this._registeredHandlers.push(function () {
+			return obj[func].apply(obj, arguments);
+		});
+	} else {
+		this._registeredHandlers.push(obj);
+	}
+}, removeHandler:function (func) {
+	for (var i = 0; i &lt; this._registeredHandlers.length; i++) {
+		if (func === this._registeredHandlers[i]) {
+			delete this._registeredHandlers[i];
+			return;
+		}
+	}
+	dojo.debug(&quot;HandlerManager handler &quot; + func + &quot; is not registered, can not remove.&quot;);
+}, destroy:function () {
+	for (var i = 0; i &lt; this._registeredHandlers.length; i++) {
+		delete this._registeredHandlers[i];
+	}
+}});
+dojo.widget.Editor2ToolbarItemManager = new dojo.widget.HandlerManager;
+dojo.lang.mixin(dojo.widget.Editor2ToolbarItemManager, {getToolbarItem:function (name) {
+	var item;
+	name = name.toLowerCase();
+	for (var i = 0; i &lt; this._registeredHandlers.length; i++) {
+		item = this._registeredHandlers[i](name);
+		if (item) {
+			return item;
+		}
+	}
+	switch (name) {
+	  case &quot;bold&quot;:
+	  case &quot;copy&quot;:
+	  case &quot;cut&quot;:
+	  case &quot;delete&quot;:
+	  case &quot;indent&quot;:
+	  case &quot;inserthorizontalrule&quot;:
+	  case &quot;insertorderedlist&quot;:
+	  case &quot;insertunorderedlist&quot;:
+	  case &quot;italic&quot;:
+	  case &quot;justifycenter&quot;:
+	  case &quot;justifyfull&quot;:
+	  case &quot;justifyleft&quot;:
+	  case &quot;justifyright&quot;:
+	  case &quot;outdent&quot;:
+	  case &quot;paste&quot;:
+	  case &quot;redo&quot;:
+	  case &quot;removeformat&quot;:
+	  case &quot;selectall&quot;:
+	  case &quot;strikethrough&quot;:
+	  case &quot;subscript&quot;:
+	  case &quot;superscript&quot;:
+	  case &quot;underline&quot;:
+	  case &quot;undo&quot;:
+	  case &quot;unlink&quot;:
+	  case &quot;createlink&quot;:
+	  case &quot;insertimage&quot;:
+	  case &quot;htmltoggle&quot;:
+		item = new dojo.widget.Editor2ToolbarButton(name);
+		break;
+	  case &quot;forecolor&quot;:
+	  case &quot;hilitecolor&quot;:
+		item = new dojo.widget.Editor2ToolbarColorPaletteButton(name);
+		break;
+	  case &quot;plainformatblock&quot;:
+		item = new dojo.widget.Editor2ToolbarFormatBlockPlainSelect(&quot;formatblock&quot;);
+		break;
+	  case &quot;formatblock&quot;:
+		item = new dojo.widget.Editor2ToolbarFormatBlockSelect(&quot;formatblock&quot;);
+		break;
+	  case &quot;fontsize&quot;:
+		item = new dojo.widget.Editor2ToolbarFontSizeSelect(&quot;fontsize&quot;);
+		break;
+	  case &quot;fontname&quot;:
+		item = new dojo.widget.Editor2ToolbarFontNameSelect(&quot;fontname&quot;);
+		break;
+	  case &quot;inserttable&quot;:
+	  case &quot;insertcell&quot;:
+	  case &quot;insertcol&quot;:
+	  case &quot;insertrow&quot;:
+	  case &quot;deletecells&quot;:
+	  case &quot;deletecols&quot;:
+	  case &quot;deleterows&quot;:
+	  case &quot;mergecells&quot;:
+	  case &quot;splitcell&quot;:
+		dojo.debug(name + &quot; is implemented in dojo.widget.Editor2Plugin.TableOperation, please require it first.&quot;);
+		break;
+	  case &quot;inserthtml&quot;:
+	  case &quot;blockdirltr&quot;:
+	  case &quot;blockdirrtl&quot;:
+	  case &quot;dirltr&quot;:
+	  case &quot;dirrtl&quot;:
+	  case &quot;inlinedirltr&quot;:
+	  case &quot;inlinedirrtl&quot;:
+		dojo.debug(&quot;Not yet implemented toolbar item: &quot; + name);
+		break;
+	  default:
+		dojo.debug(&quot;dojo.widget.Editor2ToolbarItemManager.getToolbarItem: Unknown toolbar item: &quot; + name);
+	}
+	return item;
+}});
+dojo.addOnUnload(dojo.widget.Editor2ToolbarItemManager, &quot;destroy&quot;);
+dojo.declare(&quot;dojo.widget.Editor2ToolbarButton&quot;, null, function (name) {
+	this._name = name;
+}, {create:function (node, toolbar, nohover) {
+	this._domNode = node;
+	var cmd = toolbar.parent.getCommand(this._name);
+	if (cmd) {
+		this._domNode.title = cmd.getText();
+	}
+	this.disableSelection(this._domNode);
+	this._parentToolbar = toolbar;
+	dojo.event.connect(this._domNode, &quot;onclick&quot;, this, &quot;onClick&quot;);
+	if (!nohover) {
+		dojo.event.connect(this._domNode, &quot;onmouseover&quot;, this, &quot;onMouseOver&quot;);
+		dojo.event.connect(this._domNode, &quot;onmouseout&quot;, this, &quot;onMouseOut&quot;);
+	}
+}, disableSelection:function (rootnode) {
+	dojo.html.disableSelection(rootnode);
+	var nodes = rootnode.all || rootnode.getElementsByTagName(&quot;*&quot;);
+	for (var x = 0; x &lt; nodes.length; x++) {
+		dojo.html.disableSelection(nodes[x]);
+	}
+}, onMouseOver:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	if (curInst) {
+		var _command = curInst.getCommand(this._name);
+		if (_command &amp;&amp; _command.getState() != dojo.widget.Editor2Manager.commandState.Disabled) {
+			this.highlightToolbarItem();
+		}
+	}
+}, onMouseOut:function () {
+	this.unhighlightToolbarItem();
+}, destroy:function () {
+	this._domNode = null;
+	this._parentToolbar = null;
+}, onClick:function (e) {
+	if (this._domNode &amp;&amp; !this._domNode.disabled &amp;&amp; this._parentToolbar.checkAvailability()) {
+		e.preventDefault();
+		e.stopPropagation();
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		if (curInst) {
+			var _command = curInst.getCommand(this._name);
+			if (_command) {
+				_command.execute();
+			}
+		}
+	}
+}, refreshState:function () {
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	var em = dojo.widget.Editor2Manager;
+	if (curInst) {
+		var _command = curInst.getCommand(this._name);
+		if (_command) {
+			var state = _command.getState();
+			if (state != this._lastState) {
+				switch (state) {
+				  case em.commandState.Latched:
+					this.latchToolbarItem();
+					break;
+				  case em.commandState.Enabled:
+					this.enableToolbarItem();
+					break;
+				  case em.commandState.Disabled:
+				  default:
+					this.disableToolbarItem();
+				}
+				this._lastState = state;
+			}
+		}
+	}
+	return em.commandState.Enabled;
+}, latchToolbarItem:function () {
+	this._domNode.disabled = false;
+	this.removeToolbarItemStyle(this._domNode);
+	dojo.html.addClass(this._domNode, this._parentToolbar.ToolbarLatchedItemStyle);
+}, enableToolbarItem:function () {
+	this._domNode.disabled = false;
+	this.removeToolbarItemStyle(this._domNode);
+	dojo.html.addClass(this._domNode, this._parentToolbar.ToolbarEnabledItemStyle);
+}, disableToolbarItem:function () {
+	this._domNode.disabled = true;
+	this.removeToolbarItemStyle(this._domNode);
+	dojo.html.addClass(this._domNode, this._parentToolbar.ToolbarDisabledItemStyle);
+}, highlightToolbarItem:function () {
+	dojo.html.addClass(this._domNode, this._parentToolbar.ToolbarHighlightedItemStyle);
+}, unhighlightToolbarItem:function () {
+	dojo.html.removeClass(this._domNode, this._parentToolbar.ToolbarHighlightedItemStyle);
+}, removeToolbarItemStyle:function () {
+	dojo.html.removeClass(this._domNode, this._parentToolbar.ToolbarEnabledItemStyle);
+	dojo.html.removeClass(this._domNode, this._parentToolbar.ToolbarLatchedItemStyle);
+	dojo.html.removeClass(this._domNode, this._parentToolbar.ToolbarDisabledItemStyle);
+	this.unhighlightToolbarItem();
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarDropDownButton&quot;, dojo.widget.Editor2ToolbarButton, {onClick:function () {
+	if (this._domNode &amp;&amp; !this._domNode.disabled &amp;&amp; this._parentToolbar.checkAvailability()) {
+		if (!this._dropdown) {
+			this._dropdown = dojo.widget.createWidget(&quot;PopupContainer&quot;, {});
+			this._domNode.appendChild(this._dropdown.domNode);
+		}
+		if (this._dropdown.isShowingNow) {
+			this._dropdown.close();
+		} else {
+			this.onDropDownShown();
+			this._dropdown.open(this._domNode, null, this._domNode);
+		}
+	}
+}, destroy:function () {
+	this.onDropDownDestroy();
+	if (this._dropdown) {
+		this._dropdown.destroy();
+	}
+	dojo.widget.Editor2ToolbarDropDownButton.superclass.destroy.call(this);
+}, onDropDownShown:function () {
+}, onDropDownDestroy:function () {
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarColorPaletteButton&quot;, dojo.widget.Editor2ToolbarDropDownButton, {onDropDownShown:function () {
+	if (!this._colorpalette) {
+		this._colorpalette = dojo.widget.createWidget(&quot;ColorPalette&quot;, {});
+		this._dropdown.addChild(this._colorpalette);
+		this.disableSelection(this._dropdown.domNode);
+		this.disableSelection(this._colorpalette.domNode);
+		dojo.event.connect(this._colorpalette, &quot;onColorSelect&quot;, this, &quot;setColor&quot;);
+		dojo.event.connect(this._dropdown, &quot;open&quot;, this, &quot;latchToolbarItem&quot;);
+		dojo.event.connect(this._dropdown, &quot;close&quot;, this, &quot;enableToolbarItem&quot;);
+	}
+}, setColor:function (color) {
+	this._dropdown.close();
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	if (curInst) {
+		var _command = curInst.getCommand(this._name);
+		if (_command) {
+			_command.execute(color);
+		}
+	}
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarFormatBlockPlainSelect&quot;, dojo.widget.Editor2ToolbarButton, {create:function (node, toolbar) {
+	this._domNode = node;
+	this._parentToolbar = toolbar;
+	this._domNode = node;
+	this.disableSelection(this._domNode);
+	dojo.event.connect(this._domNode, &quot;onchange&quot;, this, &quot;onChange&quot;);
+}, destroy:function () {
+	this._domNode = null;
+}, onChange:function () {
+	if (this._parentToolbar.checkAvailability()) {
+		var sv = this._domNode.value.toLowerCase();
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		if (curInst) {
+			var _command = curInst.getCommand(this._name);
+			if (_command) {
+				_command.execute(sv);
+			}
+		}
+	}
+}, refreshState:function () {
+	if (this._domNode) {
+		dojo.widget.Editor2ToolbarFormatBlockPlainSelect.superclass.refreshState.call(this);
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		if (curInst) {
+			var _command = curInst.getCommand(this._name);
+			if (_command) {
+				var format = _command.getValue();
+				if (!format) {
+					format = &quot;&quot;;
+				}
+				dojo.lang.forEach(this._domNode.options, function (item) {
+					if (item.value.toLowerCase() == format.toLowerCase()) {
+						item.selected = true;
+					}
+				});
+			}
+		}
+	}
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarComboItem&quot;, dojo.widget.Editor2ToolbarDropDownButton, {href:null, create:function (node, toolbar) {
+	dojo.widget.Editor2ToolbarComboItem.superclass.create.apply(this, arguments);
+	if (!this._contentPane) {
+		dojo.require(&quot;dojo.widget.ContentPane&quot;);
+		this._contentPane = dojo.widget.createWidget(&quot;ContentPane&quot;, {preload:&quot;true&quot;});
+		this._contentPane.addOnLoad(this, &quot;setup&quot;);
+		this._contentPane.setUrl(this.href);
+	}
+}, onMouseOver:function (e) {
+	if (this._lastState != dojo.widget.Editor2Manager.commandState.Disabled) {
+		dojo.html.addClass(e.currentTarget, this._parentToolbar.ToolbarHighlightedSelectStyle);
+	}
+}, onMouseOut:function (e) {
+	dojo.html.removeClass(e.currentTarget, this._parentToolbar.ToolbarHighlightedSelectStyle);
+}, onDropDownShown:function () {
+	if (!this._dropdown.__addedContentPage) {
+		this._dropdown.addChild(this._contentPane);
+		this._dropdown.__addedContentPage = true;
+	}
+}, setup:function () {
+}, onChange:function (e) {
+	if (this._parentToolbar.checkAvailability()) {
+		var name = e.currentTarget.getAttribute(&quot;dropDownItemName&quot;);
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		if (curInst) {
+			var _command = curInst.getCommand(this._name);
+			if (_command) {
+				_command.execute(name);
+			}
+		}
+	}
+	this._dropdown.close();
+}, onMouseOverItem:function (e) {
+	dojo.html.addClass(e.currentTarget, this._parentToolbar.ToolbarHighlightedSelectItemStyle);
+}, onMouseOutItem:function (e) {
+	dojo.html.removeClass(e.currentTarget, this._parentToolbar.ToolbarHighlightedSelectItemStyle);
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarFormatBlockSelect&quot;, dojo.widget.Editor2ToolbarComboItem, {href:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/EditorToolbar_FormatBlock.html&quot;), setup:function () {
+	dojo.widget.Editor2ToolbarFormatBlockSelect.superclass.setup.call(this);
+	var nodes = this._contentPane.domNode.all || this._contentPane.domNode.getElementsByTagName(&quot;*&quot;);
+	this._blockNames = {};
+	this._blockDisplayNames = {};
+	for (var x = 0; x &lt; nodes.length; x++) {
+		var node = nodes[x];
+		dojo.html.disableSelection(node);
+		var name = node.getAttribute(&quot;dropDownItemName&quot;);
+		if (name) {
+			this._blockNames[name] = node;
+			var childrennodes = node.getElementsByTagName(name);
+			this._blockDisplayNames[name] = childrennodes[childrennodes.length - 1].innerHTML;
+		}
+	}
+	for (var name in this._blockNames) {
+		dojo.event.connect(this._blockNames[name], &quot;onclick&quot;, this, &quot;onChange&quot;);
+		dojo.event.connect(this._blockNames[name], &quot;onmouseover&quot;, this, &quot;onMouseOverItem&quot;);
+		dojo.event.connect(this._blockNames[name], &quot;onmouseout&quot;, this, &quot;onMouseOutItem&quot;);
+	}
+}, onDropDownDestroy:function () {
+	if (this._blockNames) {
+		for (var name in this._blockNames) {
+			delete this._blockNames[name];
+			delete this._blockDisplayNames[name];
+		}
+	}
+}, refreshState:function () {
+	dojo.widget.Editor2ToolbarFormatBlockSelect.superclass.refreshState.call(this);
+	if (this._lastState != dojo.widget.Editor2Manager.commandState.Disabled) {
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		if (curInst) {
+			var _command = curInst.getCommand(this._name);
+			if (_command) {
+				var format = _command.getValue();
+				if (format == this._lastSelectedFormat &amp;&amp; this._blockDisplayNames) {
+					return this._lastState;
+				}
+				this._lastSelectedFormat = format;
+				var label = this._domNode.getElementsByTagName(&quot;label&quot;)[0];
+				var isSet = false;
+				if (this._blockDisplayNames) {
+					for (var name in this._blockDisplayNames) {
+						if (name == format) {
+							label.innerHTML = this._blockDisplayNames[name];
+							isSet = true;
+							break;
+						}
+					}
+					if (!isSet) {
+						label.innerHTML = &quot;&nbsp;&quot;;
+					}
+				}
+			}
+		}
+	}
+	return this._lastState;
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarFontSizeSelect&quot;, dojo.widget.Editor2ToolbarComboItem, {href:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/EditorToolbar_FontSize.html&quot;), setup:function () {
+	dojo.widget.Editor2ToolbarFormatBlockSelect.superclass.setup.call(this);
+	var nodes = this._contentPane.domNode.all || this._contentPane.domNode.getElementsByTagName(&quot;*&quot;);
+	this._fontsizes = {};
+	this._fontSizeDisplayNames = {};
+	for (var x = 0; x &lt; nodes.length; x++) {
+		var node = nodes[x];
+		dojo.html.disableSelection(node);
+		var name = node.getAttribute(&quot;dropDownItemName&quot;);
+		if (name) {
+			this._fontsizes[name] = node;
+			this._fontSizeDisplayNames[name] = node.getElementsByTagName(&quot;font&quot;)[0].innerHTML;
+		}
+	}
+	for (var name in this._fontsizes) {
+		dojo.event.connect(this._fontsizes[name], &quot;onclick&quot;, this, &quot;onChange&quot;);
+		dojo.event.connect(this._fontsizes[name], &quot;onmouseover&quot;, this, &quot;onMouseOverItem&quot;);
+		dojo.event.connect(this._fontsizes[name], &quot;onmouseout&quot;, this, &quot;onMouseOutItem&quot;);
+	}
+}, onDropDownDestroy:function () {
+	if (this._fontsizes) {
+		for (var name in this._fontsizes) {
+			delete this._fontsizes[name];
+			delete this._fontSizeDisplayNames[name];
+		}
+	}
+}, refreshState:function () {
+	dojo.widget.Editor2ToolbarFormatBlockSelect.superclass.refreshState.call(this);
+	if (this._lastState != dojo.widget.Editor2Manager.commandState.Disabled) {
+		var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+		if (curInst) {
+			var _command = curInst.getCommand(this._name);
+			if (_command) {
+				var size = _command.getValue();
+				if (size == this._lastSelectedSize &amp;&amp; this._fontSizeDisplayNames) {
+					return this._lastState;
+				}
+				this._lastSelectedSize = size;
+				var label = this._domNode.getElementsByTagName(&quot;label&quot;)[0];
+				var isSet = false;
+				if (this._fontSizeDisplayNames) {
+					for (var name in this._fontSizeDisplayNames) {
+						if (name == size) {
+							label.innerHTML = this._fontSizeDisplayNames[name];
+							isSet = true;
+							break;
+						}
+					}
+					if (!isSet) {
+						label.innerHTML = &quot;&nbsp;&quot;;
+					}
+				}
+			}
+		}
+	}
+	return this._lastState;
+}});
+dojo.declare(&quot;dojo.widget.Editor2ToolbarFontNameSelect&quot;, dojo.widget.Editor2ToolbarFontSizeSelect, {href:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Editor2/EditorToolbar_FontName.html&quot;)});
+dojo.widget.defineWidget(&quot;dojo.widget.Editor2Toolbar&quot;, dojo.widget.HtmlWidget, function () {
+	dojo.event.connect(this, &quot;fillInTemplate&quot;, dojo.lang.hitch(this, function () {
+		if (dojo.render.html.ie) {
+			this.domNode.style.zoom = 1;
+		}
+	}));
+}, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot; class=\&quot;EditorToolbarDomNode\&quot; unselectable=\&quot;on\&quot;&gt;\n\t&lt;table cellpadding=\&quot;3\&quot; cellspacing=\&quot;0\&quot; border=\&quot;0\&quot;&gt;\n\t\t&lt;!--\n\t\t\tour toolbar should look something like:\n\n\t\t\t+=======+=======+=======+=============================================+\n\t\t\t| w   w | style | copy  | bo | it | un | le | ce | ri |\n\t\t\t| w w w | style |=======|==============|==============|\n\t\t\t|  w w  | style | paste |  undo | redo | change style |\n\t\t\t+=======+=======+=======+=============================================+\n\t\t--&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr valign=\&quot;top\&quot;&gt;\n\t\t\t\t&lt;td rowspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t&lt;div class=\&quot;bigIcon\&quot; dojoAttachPoint=\&quot;wikiWordButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;wikiWordClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span style=\&quot;font-size: 30px; margin-left: 5px;\&quot;&gt;\n\t\t\t\t\t\t\tW\n\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td rowspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t&lt;div class=\&quot;bigIcon\&quot; dojoAttachPoint!
 =\&quot;styleDropdownButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;styleDropdownClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span unselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\tstyle=\&quot;font-size: 30px; margin-left: 5px;\&quot;&gt;\n\t\t\t\t\t\t\tS\n\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;div class=\&quot;StyleDropdownContainer\&quot; style=\&quot;display: none;\&quot;\n\t\t\t\t\t\tdojoAttachPoint=\&quot;styleDropdownContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;table cellpadding=\&quot;0\&quot; cellspacing=\&quot;0\&quot; border=\&quot;0\&quot;\n\t\t\t\t\t\t\theight=\&quot;100%\&quot; width=\&quot;100%\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;td rowspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t\t\t\t\t&lt;div style=\&quot;height: 245px; overflow: auto;\&quot;&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;normalTextClick\&quot;&gt;normal&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;h1 class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;h1TextClick\&quot;&gt;Heading 1&lt;/h1&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;h2 class=\&quot;he!
 adingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\!
 t\t\t\t\
t\t\t\t\t\t\tdojoOnClick=\&quot;h2TextClick\&quot;&gt;Heading 2&lt;/h2&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;h3 class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;h3TextClick\&quot;&gt;Heading 3&lt;/h3&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;h4 class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;h4TextClick\&quot;&gt;Heading 4&lt;/h4&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;blahTextClick\&quot;&gt;blah&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;blahTextClick\&quot;&gt;blah&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;\n\t\t\t\t\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\t\t\t\t\tdojoOnClick=\&quot;blahTextClick\&quot;&gt;blah&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;&gt;blah&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;&gt;blah&lt;/div&gt;\n\t!
 \t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;&gt;blah&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;div class=\&quot;headingContainer\&quot;&gt;blah&lt;/div&gt;\n\t\t\t\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;!--\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoOnClick=\&quot;buttonClick;\&quot;&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;icon justifyleft\&quot; \n\t\t\t\t\t\t\t\t\t\t\tstyle=\&quot;float: left;\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoOnClick=\&quot;buttonClick;\&quot;&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;icon justifycenter\&quot; \n\t\t\t\t\t\t\t\t\t\t\tstyle=\&quot;float: left;\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoOnClick=\&quot;buttonClick;\&quot;&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;icon justifyright\&quot; \n\t\t\t\t\t\t\t\t\t\t\tstyle=\&quot;float: left;\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoOnClick=\&quot;buttonClick;\&quot;&gt;\n\t\t\t\t\t\t\t\t\t\t&lt;spa!
 n class=\&quot;icon justifyfull\&quot; \n\t\t\t\t\t\t\t\t\t\t\tstyle=\&quot;f!
 loat: le
ft;\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t\t--&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;\n\t\t\t\t\t\t\t\t\tthud\n\t\t\t\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;!-- copy --&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;copyButton\&quot;\n\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;copyClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon copy\&quot; \n\t\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\t\tstyle=\&quot;float: left;\&quot;&gt;&nbsp;&lt;/span&gt; copy\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;!-- \&quot;droppable\&quot; options --&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;boldButton\&quot;\n\t\t\t\t\t\tunselectable=\&quot;on\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;boldClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon bold\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoin!
 t=\&quot;italicButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;italicClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon italic\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;underlineButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;underlineClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon underline\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;leftButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;leftClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon justifyleft\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;fullButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;fullClick; buttonClick;\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon justifyfull\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;rightButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;rightClick; buttonClick;\&quot;&gt;\n\t\t\t\!
 t\t\t&lt;span class=\&quot;icon justifyright\&quot; unselectable=\&quot;on\&quot;&gt;&amp;nb!
 sp;&lt;/spa
n&gt;\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;!-- paste --&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;pasteButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;pasteClick; buttonClick;\&quot; unselectable=\&quot;on\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon paste\&quot; style=\&quot;float: left;\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt; paste\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;!-- \&quot;droppable\&quot; options --&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;undoButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;undoClick; buttonClick;\&quot; unselectable=\&quot;on\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon undo\&quot; style=\&quot;float: left;\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt; undo\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t\t&lt;span class=\&quot;iconContainer\&quot; dojoAttachPoint=\&quot;redoButton\&quot;\n\t\t\t\t\t\tdojoOnClick=\&quot;redoClick; buttonClick;\&quot; unselectable=\&quot;on\&quot;&gt;\n\t\t\t\t\t\t&lt;span class=\&quot;icon redo\&quot; style=\&quot;float: left;\&quot; unselectable=\&quot;on\&quot;&gt;&nbsp;&lt;/span&gt; redo\n\t\t\t\t\t&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\t\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;!
 \n\t&lt;/table&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.StyleDropdownContainer {\n\tposition: absolute;\n\tz-index: 1000;\n\toverflow: auto;\n\tcursor: default;\n\twidth: 250px;\n\theight: 250px;\n\tbackground-color: white;\n\tborder: 1px solid black;\n}\n\n.ColorDropdownContainer {\n\tposition: absolute;\n\tz-index: 1000;\n\toverflow: auto;\n\tcursor: default;\n\twidth: 250px;\n\theight: 150px;\n\tbackground-color: white;\n\tborder: 1px solid black;\n}\n\n.EditorToolbarDomNode {\n\tbackground-image: url(buttons/bg-fade.png);\n\tbackground-repeat: repeat-x;\n\tbackground-position: 0px -50px;\n}\n\n.EditorToolbarSmallBg {\n\tbackground-image: url(images/toolbar-bg.gif);\n\tbackground-repeat: repeat-x;\n\tbackground-position: 0px 0px;\n}\n\n/*\nbody {\n\tbackground:url(images/blank.gif) fixed;\n}*/\n\n.IEFixedToolbar {\n\tposition:absolute;\n\t/* top:0; */\n\ttop: expression(eval((document.documentElement||document.body).scrollTop));\n}\n\ndiv.bigIcon {\n\twidth: 40px;\n\theight: 40px; !
 \n\t/* background-color: white; */\n\t/* border: 1px solid #a6!
 a7a3; */
\n\tfont-family: Verdana, Trebuchet, Tahoma, Arial;\n}\n\n.iconContainer {\n\tfont-family: Verdana, Trebuchet, Tahoma, Arial;\n\tfont-size: 13px;\n\tfloat: left;\n\theight: 18px;\n\tdisplay: block;\n\t/* background-color: white; */\n\tcursor: pointer;\n\tpadding: 1px 4px 1px 1px; /* almost the same as a transparent border */\n\tborder: 0px;\n}\n\n.dojoE2TBIcon {\n\tdisplay: block;\n\ttext-align: center;\n\tmin-width: 18px;\n\twidth: 18px;\n\theight: 18px;\n\t/* background-color: #a6a7a3; */\n\tbackground-repeat: no-repeat;\n\tbackground-image: url(buttons/aggregate.gif);\n}\n\n\n.dojoE2TBIcon[class~=dojoE2TBIcon] {\n}\n\n.ToolbarButtonLatched {\n	border: #316ac5 1px solid; !important;\n	padding: 0px 3px 0px 0px; !important; /* make room for border */\n	background-color: #c1d2ee;\n}\n\n.ToolbarButtonHighlighted {\n	border: #316ac5 1px solid; !important;\n	padding: 0px 3px 0px 0px; !important; /* make room for border */\n	background-color: #dff1ff;\n}\n\n.ToolbarButtonDisabled!
 {\n	filter: gray() alpha(opacity=30); /* IE */\n	opacity: 0.30; /* Safari, Opera and Mozilla */\n}\n\n.headingContainer {\n\twidth: 150px;\n\theight: 30px;\n\tmargin: 0px;\n\t/* padding-left: 5px; */\n\toverflow: hidden;\n\tline-height: 25px;\n\tborder-bottom: 1px solid black;\n\tborder-top: 1px solid white;\n}\n\n.EditorToolbarDomNode select {\n\tfont-size: 14px;\n}\n \n.dojoE2TBIcon_Sep { width: 5px; min-width: 5px; max-width: 5px; background-position: 0px 0px}\n.dojoE2TBIcon_Backcolor { background-position: -18px 0px}\n.dojoE2TBIcon_Bold { background-position: -36px 0px}\n.dojoE2TBIcon_Cancel { background-position: -54px 0px}\n.dojoE2TBIcon_Copy { background-position: -72px 0px}\n.dojoE2TBIcon_Link { background-position: -90px 0px}\n.dojoE2TBIcon_Cut { background-position: -108px 0px}\n.dojoE2TBIcon_Delete { background-position: -126px 0px}\n.dojoE2TBIcon_TextColor { background-position: -144px 0px}\n.dojoE2TBIcon_BackgroundColor { background-position: -162px 0px}\n.dojo!
 E2TBIcon_Indent { background-position: -180px 0px}\n.dojoE2TBI!
 con_Hori
zontalLine { background-position: -198px 0px}\n.dojoE2TBIcon_Image { background-position: -216px 0px}\n.dojoE2TBIcon_NumberedList { background-position: -234px 0px}\n.dojoE2TBIcon_Table { background-position: -252px 0px}\n.dojoE2TBIcon_BulletedList { background-position: -270px 0px}\n.dojoE2TBIcon_Italic { background-position: -288px 0px}\n.dojoE2TBIcon_CenterJustify { background-position: -306px 0px}\n.dojoE2TBIcon_BlockJustify { background-position: -324px 0px}\n.dojoE2TBIcon_LeftJustify { background-position: -342px 0px}\n.dojoE2TBIcon_RightJustify { background-position: -360px 0px}\n.dojoE2TBIcon_left_to_right { background-position: -378px 0px}\n.dojoE2TBIcon_list_bullet_indent { background-position: -396px 0px}\n.dojoE2TBIcon_list_bullet_outdent { background-position: -414px 0px}\n.dojoE2TBIcon_list_num_indent { background-position: -432px 0px}\n.dojoE2TBIcon_list_num_outdent { background-position: -450px 0px}\n.dojoE2TBIcon_Outdent { background-position: -468px 0px}\n.!
 dojoE2TBIcon_Paste { background-position: -486px 0px}\n.dojoE2TBIcon_Redo { background-position: -504px 0px}\ndojoE2TBIcon_RemoveFormat { background-position: -522px 0px}\n.dojoE2TBIcon_right_to_left { background-position: -540px 0px}\n.dojoE2TBIcon_Save { background-position: -558px 0px}\n.dojoE2TBIcon_Space { background-position: -576px 0px}\n.dojoE2TBIcon_StrikeThrough { background-position: -594px 0px}\n.dojoE2TBIcon_Subscript { background-position: -612px 0px}\n.dojoE2TBIcon_Superscript { background-position: -630px 0px}\n.dojoE2TBIcon_Underline { background-position: -648px 0px}\n.dojoE2TBIcon_Undo { background-position: -666px 0px}\n.dojoE2TBIcon_WikiWord { background-position: -684px 0px}\n\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/EditorToolbar.css&quot;), ToolbarLatchedItemStyle:&quot;ToolbarButtonLatched&quot;, ToolbarEnabledItemStyle:&quot;ToolbarButtonEnabled&quot;, ToolbarDisabledItemStyle:&quot;ToolbarButtonDisabled&quot;, ToolbarHighlightedItemStyle:&quot;ToolbarButtonHighli!
 ghted&quot;, ToolbarHighlightedSelectStyle:&quot;ToolbarSelectHighlighte!
 d&quot;, Tool
barHighlightedSelectItemStyle:&quot;ToolbarSelectHighlightedItem&quot;, postCreate:function () {
+	var nodes = dojo.html.getElementsByClass(&quot;dojoEditorToolbarItem&quot;, this.domNode);
+	this.items = {};
+	for (var x = 0; x &lt; nodes.length; x++) {
+		var node = nodes[x];
+		var itemname = node.getAttribute(&quot;dojoETItemName&quot;);
+		if (itemname) {
+			var item = dojo.widget.Editor2ToolbarItemManager.getToolbarItem(itemname);
+			if (item) {
+				item.create(node, this);
+				this.items[itemname.toLowerCase()] = item;
+			} else {
+				node.style.display = &quot;none&quot;;
+			}
+		}
+	}
+}, update:function () {
+	for (var cmd in this.items) {
+		this.items[cmd].refreshState();
+	}
+}, shareGroup:&quot;&quot;, checkAvailability:function () {
+	if (!this.shareGroup) {
+		this.parent.focus();
+		return true;
+	}
+	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
+	if (this.shareGroup == curInst.toolbarGroup) {
+		return true;
+	}
+	return false;
+}, destroy:function () {
+	for (var it in this.items) {
+		this.items[it].destroy();
+		delete this.items[it];
+	}
+	dojo.widget.Editor2Toolbar.superclass.destroy.call(this);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/FilteringTable.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/FilteringTable.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/FilteringTable.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,710 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.FilteringTable&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.collections.Store&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.FilteringTable&quot;, dojo.widget.HtmlWidget, function () {
+	this.store = new dojo.collections.Store();
+	this.valueField = &quot;Id&quot;;
+	this.multiple = false;
+	this.maxSelect = 0;
+	this.maxSortable = 1;
+	this.minRows = 0;
+	this.defaultDateFormat = &quot;%D&quot;;
+	this.isInitialized = false;
+	this.alternateRows = false;
+	this.columns = [];
+	this.sortInformation = [{index:0, direction:0}];
+	this.headClass = &quot;&quot;;
+	this.tbodyClass = &quot;&quot;;
+	this.headerClass = &quot;&quot;;
+	this.headerUpClass = &quot;selectedUp&quot;;
+	this.headerDownClass = &quot;selectedDown&quot;;
+	this.rowClass = &quot;&quot;;
+	this.rowAlternateClass = &quot;alt&quot;;
+	this.rowSelectedClass = &quot;selected&quot;;
+	this.columnSelected = &quot;sorted-column&quot;;
+}, {isContainer:false, templatePath:null, templateCssPath:null, getTypeFromString:function (s) {
+	var parts = s.split(&quot;.&quot;), i = 0, obj = dj_global;
+	do {
+		obj = obj[parts[i++]];
+	} while (i &lt; parts.length &amp;&amp; obj);
+	return (obj != dj_global) ? obj : null;
+}, getByRow:function (row) {
+	return this.store.getByKey(dojo.html.getAttribute(row, &quot;value&quot;));
+}, getDataByRow:function (row) {
+	return this.store.getDataByKey(dojo.html.getAttribute(row, &quot;value&quot;));
+}, getRow:function (obj) {
+	var rows = this.domNode.tBodies[0].rows;
+	for (var i = 0; i &lt; rows.length; i++) {
+		if (this.store.getDataByKey(dojo.html.getAttribute(rows[i], &quot;value&quot;)) == obj) {
+			return rows[i];
+		}
+	}
+	return null;
+}, getColumnIndex:function (fieldPath) {
+	for (var i = 0; i &lt; this.columns.length; i++) {
+		if (this.columns[i].getField() == fieldPath) {
+			return i;
+		}
+	}
+	return -1;
+}, getSelectedData:function () {
+	var data = this.store.get();
+	var a = [];
+	for (var i = 0; i &lt; data.length; i++) {
+		if (data[i].isSelected) {
+			a.push(data[i].src);
+		}
+	}
+	if (this.multiple) {
+		return a;
+	} else {
+		return a[0];
+	}
+}, isSelected:function (obj) {
+	var data = this.store.get();
+	for (var i = 0; i &lt; data.length; i++) {
+		if (data[i].src == obj) {
+			return true;
+		}
+	}
+	return false;
+}, isValueSelected:function (val) {
+	var v = this.store.getByKey(val);
+	if (v) {
+		return v.isSelected;
+	}
+	return false;
+}, isIndexSelected:function (idx) {
+	var v = this.store.getByIndex(idx);
+	if (v) {
+		return v.isSelected;
+	}
+	return false;
+}, isRowSelected:function (row) {
+	var v = this.getByRow(row);
+	if (v) {
+		return v.isSelected;
+	}
+	return false;
+}, reset:function () {
+	this.store.clearData();
+	this.columns = [];
+	this.sortInformation = [{index:0, direction:0}];
+	this.resetSelections();
+	this.isInitialized = false;
+	this.onReset();
+}, resetSelections:function () {
+	this.store.forEach(function (element) {
+		element.isSelected = false;
+	});
+}, onReset:function () {
+}, select:function (obj) {
+	var data = this.store.get();
+	for (var i = 0; i &lt; data.length; i++) {
+		if (data[i].src == obj) {
+			data[i].isSelected = true;
+			break;
+		}
+	}
+	this.onDataSelect(obj);
+}, selectByValue:function (val) {
+	this.select(this.store.getDataByKey(val));
+}, selectByIndex:function (idx) {
+	this.select(this.store.getDataByIndex(idx));
+}, selectByRow:function (row) {
+	this.select(this.getDataByRow(row));
+}, selectAll:function () {
+	this.store.forEach(function (element) {
+		element.isSelected = true;
+	});
+}, onDataSelect:function (obj) {
+}, toggleSelection:function (obj) {
+	var data = this.store.get();
+	for (var i = 0; i &lt; data.length; i++) {
+		if (data[i].src == obj) {
+			data[i].isSelected = !data[i].isSelected;
+			break;
+		}
+	}
+	this.onDataToggle(obj);
+}, toggleSelectionByValue:function (val) {
+	this.toggleSelection(this.store.getDataByKey(val));
+}, toggleSelectionByIndex:function (idx) {
+	this.toggleSelection(this.store.getDataByIndex(idx));
+}, toggleSelectionByRow:function (row) {
+	this.toggleSelection(this.getDataByRow(row));
+}, toggleAll:function () {
+	this.store.forEach(function (element) {
+		element.isSelected = !element.isSelected;
+	});
+}, onDataToggle:function (obj) {
+}, _meta:{field:null, format:null, filterer:null, noSort:false, sortType:&quot;String&quot;, dataType:String, sortFunction:null, filterFunction:null, label:null, align:&quot;left&quot;, valign:&quot;middle&quot;, getField:function () {
+	return this.field || this.label;
+}, getType:function () {
+	return this.dataType;
+}}, createMetaData:function (obj) {
+	for (var p in this._meta) {
+		if (!obj[p]) {
+			obj[p] = this._meta[p];
+		}
+	}
+	if (!obj.label) {
+		obj.label = obj.field;
+	}
+	if (!obj.filterFunction) {
+		obj.filterFunction = this._defaultFilter;
+	}
+	return obj;
+}, parseMetadata:function (head) {
+	this.columns = [];
+	this.sortInformation = [];
+	var row = head.getElementsByTagName(&quot;tr&quot;)[0];
+	var cells = row.getElementsByTagName(&quot;td&quot;);
+	if (cells.length == 0) {
+		cells = row.getElementsByTagName(&quot;th&quot;);
+	}
+	for (var i = 0; i &lt; cells.length; i++) {
+		var o = this.createMetaData({});
+		if (dojo.html.hasAttribute(cells[i], &quot;align&quot;)) {
+			o.align = dojo.html.getAttribute(cells[i], &quot;align&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;valign&quot;)) {
+			o.valign = dojo.html.getAttribute(cells[i], &quot;valign&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;nosort&quot;)) {
+			o.noSort = (dojo.html.getAttribute(cells[i], &quot;nosort&quot;) == &quot;true&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;sortusing&quot;)) {
+			var trans = dojo.html.getAttribute(cells[i], &quot;sortusing&quot;);
+			var f = this.getTypeFromString(trans);
+			if (f != null &amp;&amp; f != window &amp;&amp; typeof (f) == &quot;function&quot;) {
+				o.sortFunction = f;
+			}
+		}
+		o.label = dojo.html.renderedTextContent(cells[i]);
+		if (dojo.html.hasAttribute(cells[i], &quot;field&quot;)) {
+			o.field = dojo.html.getAttribute(cells[i], &quot;field&quot;);
+		} else {
+			if (o.label.length &gt; 0) {
+				o.field = o.label;
+			} else {
+				o.field = &quot;field&quot; + i;
+			}
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;format&quot;)) {
+			o.format = dojo.html.getAttribute(cells[i], &quot;format&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;dataType&quot;)) {
+			var sortType = dojo.html.getAttribute(cells[i], &quot;dataType&quot;);
+			if (sortType.toLowerCase() == &quot;html&quot; || sortType.toLowerCase() == &quot;markup&quot;) {
+				o.sortType = &quot;__markup__&quot;;
+			} else {
+				var type = this.getTypeFromString(sortType);
+				if (type) {
+					o.sortType = sortType;
+					o.dataType = type;
+				}
+			}
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;filterusing&quot;)) {
+			var trans = dojo.html.getAttribute(cells[i], &quot;filterusing&quot;);
+			var f = this.getTypeFromString(trans);
+			if (f != null &amp;&amp; f != window &amp;&amp; typeof (f) == &quot;function&quot;) {
+				o.filterFunction = f;
+			}
+		}
+		this.columns.push(o);
+		if (dojo.html.hasAttribute(cells[i], &quot;sort&quot;)) {
+			var info = {index:i, direction:0};
+			var dir = dojo.html.getAttribute(cells[i], &quot;sort&quot;);
+			if (!isNaN(parseInt(dir))) {
+				dir = parseInt(dir);
+				info.direction = (dir != 0) ? 1 : 0;
+			} else {
+				info.direction = (dir.toLowerCase() == &quot;desc&quot;) ? 1 : 0;
+			}
+			this.sortInformation.push(info);
+		}
+	}
+	if (this.sortInformation.length == 0) {
+		this.sortInformation.push({index:0, direction:0});
+	} else {
+		if (this.sortInformation.length &gt; this.maxSortable) {
+			this.sortInformation.length = this.maxSortable;
+		}
+	}
+}, parseData:function (body) {
+	if (body.rows.length == 0 &amp;&amp; this.columns.length == 0) {
+		return;
+	}
+	var self = this;
+	this[&quot;__selected__&quot;] = [];
+	var arr = this.store.getFromHtml(this.columns, body, function (obj, row) {
+		if (typeof (obj[self.valueField]) == &quot;undefined&quot; || obj[self.valueField] == null) {
+			obj[self.valueField] = dojo.html.getAttribute(row, &quot;value&quot;);
+		}
+		if (dojo.html.getAttribute(row, &quot;selected&quot;) == &quot;true&quot;) {
+			self[&quot;__selected__&quot;].push(obj);
+		}
+	});
+	this.store.setData(arr, true);
+	this.render();
+	for (var i = 0; i &lt; this[&quot;__selected__&quot;].length; i++) {
+		this.select(this[&quot;__selected__&quot;][i]);
+	}
+	this.renderSelections();
+	delete this[&quot;__selected__&quot;];
+	this.isInitialized = true;
+}, onSelect:function (e) {
+	var row = dojo.html.getParentByType(e.target, &quot;tr&quot;);
+	if (dojo.html.hasAttribute(row, &quot;emptyRow&quot;)) {
+		return;
+	}
+	var body = dojo.html.getParentByType(row, &quot;tbody&quot;);
+	if (this.multiple) {
+		if (e.shiftKey) {
+			var startRow;
+			var rows = body.rows;
+			for (var i = 0; i &lt; rows.length; i++) {
+				if (rows[i] == row) {
+					break;
+				}
+				if (this.isRowSelected(rows[i])) {
+					startRow = rows[i];
+				}
+			}
+			if (!startRow) {
+				startRow = row;
+				for (; i &lt; rows.length; i++) {
+					if (this.isRowSelected(rows[i])) {
+						row = rows[i];
+						break;
+					}
+				}
+			}
+			this.resetSelections();
+			if (startRow == row) {
+				this.toggleSelectionByRow(row);
+			} else {
+				var doSelect = false;
+				for (var i = 0; i &lt; rows.length; i++) {
+					if (rows[i] == startRow) {
+						doSelect = true;
+					}
+					if (doSelect) {
+						this.selectByRow(rows[i]);
+					}
+					if (rows[i] == row) {
+						doSelect = false;
+					}
+				}
+			}
+		} else {
+			this.toggleSelectionByRow(row);
+		}
+	} else {
+		this.resetSelections();
+		this.toggleSelectionByRow(row);
+	}
+	this.renderSelections();
+}, onSort:function (e) {
+	var oldIndex = this.sortIndex;
+	var oldDirection = this.sortDirection;
+	var source = e.target;
+	var row = dojo.html.getParentByType(source, &quot;tr&quot;);
+	var cellTag = &quot;td&quot;;
+	if (row.getElementsByTagName(cellTag).length == 0) {
+		cellTag = &quot;th&quot;;
+	}
+	var headers = row.getElementsByTagName(cellTag);
+	var header = dojo.html.getParentByType(source, cellTag);
+	for (var i = 0; i &lt; headers.length; i++) {
+		dojo.html.setClass(headers[i], this.headerClass);
+		if (headers[i] == header) {
+			if (this.sortInformation[0].index != i) {
+				this.sortInformation.unshift({index:i, direction:0});
+			} else {
+				this.sortInformation[0] = {index:i, direction:(~this.sortInformation[0].direction) &amp; 1};
+			}
+		}
+	}
+	this.sortInformation.length = Math.min(this.sortInformation.length, this.maxSortable);
+	for (var i = 0; i &lt; this.sortInformation.length; i++) {
+		var idx = this.sortInformation[i].index;
+		var dir = (~this.sortInformation[i].direction) &amp; 1;
+		dojo.html.setClass(headers[idx], dir == 0 ? this.headerDownClass : this.headerUpClass);
+	}
+	this.render();
+}, onFilter:function () {
+}, _defaultFilter:function (obj) {
+	return true;
+}, setFilter:function (field, fn) {
+	for (var i = 0; i &lt; this.columns.length; i++) {
+		if (this.columns[i].getField() == field) {
+			this.columns[i].filterFunction = fn;
+			break;
+		}
+	}
+	this.applyFilters();
+}, setFilterByIndex:function (idx, fn) {
+	this.columns[idx].filterFunction = fn;
+	this.applyFilters();
+}, clearFilter:function (field) {
+	for (var i = 0; i &lt; this.columns.length; i++) {
+		if (this.columns[i].getField() == field) {
+			this.columns[i].filterFunction = this._defaultFilter;
+			break;
+		}
+	}
+	this.applyFilters();
+}, clearFilterByIndex:function (idx) {
+	this.columns[idx].filterFunction = this._defaultFilter;
+	this.applyFilters();
+}, clearFilters:function () {
+	for (var i = 0; i &lt; this.columns.length; i++) {
+		this.columns[i].filterFunction = this._defaultFilter;
+	}
+	var rows = this.domNode.tBodies[0].rows;
+	for (var i = 0; i &lt; rows.length; i++) {
+		rows[i].style.display = &quot;&quot;;
+		if (this.alternateRows) {
+			dojo.html[((i % 2 == 1) ? &quot;addClass&quot; : &quot;removeClass&quot;)](rows[i], this.rowAlternateClass);
+		}
+	}
+	this.onFilter();
+}, applyFilters:function () {
+	var alt = 0;
+	var rows = this.domNode.tBodies[0].rows;
+	for (var i = 0; i &lt; rows.length; i++) {
+		var b = true;
+		var row = rows[i];
+		for (var j = 0; j &lt; this.columns.length; j++) {
+			var value = this.store.getField(this.getDataByRow(row), this.columns[j].getField());
+			if (this.columns[j].getType() == Date &amp;&amp; value != null &amp;&amp; !value.getYear) {
+				value = new Date(value);
+			}
+			if (!this.columns[j].filterFunction(value)) {
+				b = false;
+				break;
+			}
+		}
+		row.style.display = (b ? &quot;&quot; : &quot;none&quot;);
+		if (b &amp;&amp; this.alternateRows) {
+			dojo.html[((alt++ % 2 == 1) ? &quot;addClass&quot; : &quot;removeClass&quot;)](row, this.rowAlternateClass);
+		}
+	}
+	this.onFilter();
+}, createSorter:function (info) {
+	var self = this;
+	var sortFunctions = [];
+	function createSortFunction(fieldIndex, dir) {
+		var meta = self.columns[fieldIndex];
+		var field = meta.getField();
+		return function (rowA, rowB) {
+			if (dojo.html.hasAttribute(rowA, &quot;emptyRow&quot;)) {
+				return 1;
+			}
+			if (dojo.html.hasAttribute(rowB, &quot;emptyRow&quot;)) {
+				return -1;
+			}
+			var a = self.store.getField(self.getDataByRow(rowA), field);
+			var b = self.store.getField(self.getDataByRow(rowB), field);
+			var ret = 0;
+			if (a &gt; b) {
+				ret = 1;
+			}
+			if (a &lt; b) {
+				ret = -1;
+			}
+			return dir * ret;
+		};
+	}
+	var current = 0;
+	var max = Math.min(info.length, this.maxSortable, this.columns.length);
+	while (current &lt; max) {
+		var direction = (info[current].direction == 0) ? 1 : -1;
+		sortFunctions.push(createSortFunction(info[current].index, direction));
+		current++;
+	}
+	return function (rowA, rowB) {
+		var idx = 0;
+		while (idx &lt; sortFunctions.length) {
+			var ret = sortFunctions[idx++](rowA, rowB);
+			if (ret != 0) {
+				return ret;
+			}
+		}
+		return 0;
+	};
+}, createRow:function (obj) {
+	var row = document.createElement(&quot;tr&quot;);
+	dojo.html.disableSelection(row);
+	if (obj.key != null) {
+		row.setAttribute(&quot;value&quot;, obj.key);
+	}
+	for (var j = 0; j &lt; this.columns.length; j++) {
+		var cell = document.createElement(&quot;td&quot;);
+		cell.setAttribute(&quot;align&quot;, this.columns[j].align);
+		cell.setAttribute(&quot;valign&quot;, this.columns[j].valign);
+		dojo.html.disableSelection(cell);
+		var val = this.store.getField(obj.src, this.columns[j].getField());
+		if (typeof (val) == &quot;undefined&quot;) {
+			val = &quot;&quot;;
+		}
+		this.fillCell(cell, this.columns[j], val);
+		row.appendChild(cell);
+	}
+	return row;
+}, fillCell:function (cell, meta, val) {
+	if (meta.sortType == &quot;__markup__&quot;) {
+		cell.innerHTML = val;
+	} else {
+		if (meta.getType() == Date) {
+			val = new Date(val);
+			if (!isNaN(val)) {
+				var format = this.defaultDateFormat;
+				if (meta.format) {
+					format = meta.format;
+				}
+				cell.innerHTML = dojo.date.strftime(val, format);
+			} else {
+				cell.innerHTML = val;
+			}
+		} else {
+			if (&quot;Number number int Integer float Float&quot;.indexOf(meta.getType()) &gt; -1) {
+				if (val.length == 0) {
+					val = &quot;0&quot;;
+				}
+				var n = parseFloat(val, 10) + &quot;&quot;;
+				if (n.indexOf(&quot;.&quot;) &gt; -1) {
+					n = dojo.math.round(parseFloat(val, 10), 2);
+				}
+				cell.innerHTML = n;
+			} else {
+				cell.innerHTML = val;
+			}
+		}
+	}
+}, prefill:function () {
+	this.isInitialized = false;
+	var body = this.domNode.tBodies[0];
+	while (body.childNodes.length &gt; 0) {
+		body.removeChild(body.childNodes[0]);
+	}
+	if (this.minRows &gt; 0) {
+		for (var i = 0; i &lt; this.minRows; i++) {
+			var row = document.createElement(&quot;tr&quot;);
+			if (this.alternateRows) {
+				dojo.html[((i % 2 == 1) ? &quot;addClass&quot; : &quot;removeClass&quot;)](row, this.rowAlternateClass);
+			}
+			row.setAttribute(&quot;emptyRow&quot;, &quot;true&quot;);
+			for (var j = 0; j &lt; this.columns.length; j++) {
+				var cell = document.createElement(&quot;td&quot;);
+				cell.innerHTML = &quot;&nbsp;&quot;;
+				row.appendChild(cell);
+			}
+			body.appendChild(row);
+		}
+	}
+}, init:function () {
+	this.isInitialized = false;
+	var head = this.domNode.getElementsByTagName(&quot;thead&quot;)[0];
+	if (head.getElementsByTagName(&quot;tr&quot;).length == 0) {
+		var row = document.createElement(&quot;tr&quot;);
+		for (var i = 0; i &lt; this.columns.length; i++) {
+			var cell = document.createElement(&quot;td&quot;);
+			cell.setAttribute(&quot;align&quot;, this.columns[i].align);
+			cell.setAttribute(&quot;valign&quot;, this.columns[i].valign);
+			dojo.html.disableSelection(cell);
+			cell.innerHTML = this.columns[i].label;
+			row.appendChild(cell);
+			if (!this.columns[i].noSort) {
+				dojo.event.connect(cell, &quot;onclick&quot;, this, &quot;onSort&quot;);
+			}
+		}
+		dojo.html.prependChild(row, head);
+	}
+	if (this.store.get().length == 0) {
+		return false;
+	}
+	var idx = this.domNode.tBodies[0].rows.length;
+	if (!idx || idx == 0 || this.domNode.tBodies[0].rows[0].getAttribute(&quot;emptyRow&quot;) == &quot;true&quot;) {
+		idx = 0;
+		var body = this.domNode.tBodies[0];
+		while (body.childNodes.length &gt; 0) {
+			body.removeChild(body.childNodes[0]);
+		}
+		var data = this.store.get();
+		for (var i = 0; i &lt; data.length; i++) {
+			var row = this.createRow(data[i]);
+			body.appendChild(row);
+			idx++;
+		}
+	}
+	if (this.minRows &gt; 0 &amp;&amp; idx &lt; this.minRows) {
+		idx = this.minRows - idx;
+		for (var i = 0; i &lt; idx; i++) {
+			row = document.createElement(&quot;tr&quot;);
+			row.setAttribute(&quot;emptyRow&quot;, &quot;true&quot;);
+			for (var j = 0; j &lt; this.columns.length; j++) {
+				cell = document.createElement(&quot;td&quot;);
+				cell.innerHTML = &quot;&nbsp;&quot;;
+				row.appendChild(cell);
+			}
+			body.appendChild(row);
+		}
+	}
+	var row = this.domNode.getElementsByTagName(&quot;thead&quot;)[0].rows[0];
+	var cellTag = &quot;td&quot;;
+	if (row.getElementsByTagName(cellTag).length == 0) {
+		cellTag = &quot;th&quot;;
+	}
+	var headers = row.getElementsByTagName(cellTag);
+	for (var i = 0; i &lt; headers.length; i++) {
+		dojo.html.setClass(headers[i], this.headerClass);
+	}
+	for (var i = 0; i &lt; this.sortInformation.length; i++) {
+		var idx = this.sortInformation[i].index;
+		var dir = (~this.sortInformation[i].direction) &amp; 1;
+		dojo.html.setClass(headers[idx], dir == 0 ? this.headerDownClass : this.headerUpClass);
+	}
+	this.isInitialized = true;
+	return this.isInitialized;
+}, render:function () {
+	if (!this.isInitialized) {
+		var b = this.init();
+		if (!b) {
+			this.prefill();
+			return;
+		}
+	}
+	var rows = [];
+	var body = this.domNode.tBodies[0];
+	var emptyRowIdx = -1;
+	for (var i = 0; i &lt; body.rows.length; i++) {
+		rows.push(body.rows[i]);
+	}
+	var sortFunction = this.createSorter(this.sortInformation);
+	if (sortFunction) {
+		rows.sort(sortFunction);
+	}
+	for (var i = 0; i &lt; rows.length; i++) {
+		if (this.alternateRows) {
+			dojo.html[((i % 2 == 1) ? &quot;addClass&quot; : &quot;removeClass&quot;)](rows[i], this.rowAlternateClass);
+		}
+		dojo.html[(this.isRowSelected(body.rows[i]) ? &quot;addClass&quot; : &quot;removeClass&quot;)](body.rows[i], this.rowSelectedClass);
+		body.appendChild(rows[i]);
+	}
+}, renderSelections:function () {
+	var body = this.domNode.tBodies[0];
+	for (var i = 0; i &lt; body.rows.length; i++) {
+		dojo.html[(this.isRowSelected(body.rows[i]) ? &quot;addClass&quot; : &quot;removeClass&quot;)](body.rows[i], this.rowSelectedClass);
+	}
+}, initialize:function () {
+	var self = this;
+	dojo.event.connect(this.store, &quot;onSetData&quot;, function () {
+		self.store.forEach(function (element) {
+			element.isSelected = false;
+		});
+		self.isInitialized = false;
+		var body = self.domNode.tBodies[0];
+		if (body) {
+			while (body.childNodes.length &gt; 0) {
+				body.removeChild(body.childNodes[0]);
+			}
+		}
+		self.render();
+	});
+	dojo.event.connect(this.store, &quot;onClearData&quot;, function () {
+		self.isInitialized = false;
+		self.render();
+	});
+	dojo.event.connect(this.store, &quot;onAddData&quot;, function (addedObject) {
+		var row = self.createRow(addedObject);
+		self.domNode.tBodies[0].appendChild(row);
+		self.render();
+	});
+	dojo.event.connect(this.store, &quot;onAddDataRange&quot;, function (arr) {
+		for (var i = 0; i &lt; arr.length; i++) {
+			arr[i].isSelected = false;
+			var row = self.createRow(arr[i]);
+			self.domNode.tBodies[0].appendChild(row);
+		}
+		self.render();
+	});
+	dojo.event.connect(this.store, &quot;onRemoveData&quot;, function (removedObject) {
+		var rows = self.domNode.tBodies[0].rows;
+		for (var i = 0; i &lt; rows.length; i++) {
+			if (self.getDataByRow(rows[i]) == removedObject.src) {
+				rows[i].parentNode.removeChild(rows[i]);
+				break;
+			}
+		}
+		self.render();
+	});
+	dojo.event.connect(this.store, &quot;onUpdateField&quot;, function (obj, fieldPath, val) {
+		var row = self.getRow(obj);
+		var idx = self.getColumnIndex(fieldPath);
+		if (row &amp;&amp; row.cells[idx] &amp;&amp; self.columns[idx]) {
+			self.fillCell(row.cells[idx], self.columns[idx], val);
+		}
+	});
+}, postCreate:function () {
+	this.store.keyField = this.valueField;
+	if (this.domNode) {
+		if (this.domNode.nodeName.toLowerCase() != &quot;table&quot;) {
+		}
+		if (this.domNode.getElementsByTagName(&quot;thead&quot;)[0]) {
+			var head = this.domNode.getElementsByTagName(&quot;thead&quot;)[0];
+			if (this.headClass.length &gt; 0) {
+				head.className = this.headClass;
+			}
+			dojo.html.disableSelection(this.domNode);
+			this.parseMetadata(head);
+			var header = &quot;td&quot;;
+			if (head.getElementsByTagName(header).length == 0) {
+				header = &quot;th&quot;;
+			}
+			var headers = head.getElementsByTagName(header);
+			for (var i = 0; i &lt; headers.length; i++) {
+				if (!this.columns[i].noSort) {
+					dojo.event.connect(headers[i], &quot;onclick&quot;, this, &quot;onSort&quot;);
+				}
+			}
+		} else {
+			this.domNode.appendChild(document.createElement(&quot;thead&quot;));
+		}
+		if (this.domNode.tBodies.length &lt; 1) {
+			var body = document.createElement(&quot;tbody&quot;);
+			this.domNode.appendChild(body);
+		} else {
+			var body = this.domNode.tBodies[0];
+		}
+		if (this.tbodyClass.length &gt; 0) {
+			body.className = this.tbodyClass;
+		}
+		dojo.event.connect(body, &quot;onclick&quot;, this, &quot;onSelect&quot;);
+		this.parseData(body);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/FisheyeList.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/FisheyeList.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/FisheyeList.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,446 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.FisheyeList&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.FisheyeList&quot;, dojo.widget.HtmlWidget, function () {
+	this.pos = {x:-1, y:-1};
+	this.EDGE = {CENTER:0, LEFT:1, RIGHT:2, TOP:3, BOTTOM:4};
+	this.timerScale = 1;
+}, {templateString:&quot;&lt;div class=\&quot;dojoHtmlFisheyeListBar\&quot;&gt;&lt;/div&gt;&quot;, templateCssString:&quot;.dojoHtmlFisheyeListItemLabel {\n\tfont-family: Arial, Helvetica, sans-serif;\n\tbackground-color: #eee;\n\tborder: 2px solid #666;\n\tpadding: 2px;\n\ttext-align: center;\n\tposition: absolute;\n\tdisplay: none;\n}\n\n.dojoHtmlFisheyeListItemLabel.selected {\n\tdisplay: block;\n}\n\n.dojoHtmlFisheyeListItemImage {\n\tborder: 0px;\n\tposition: absolute;\n}\n\n.dojoHtmlFisheyeListItem {\n\tposition: absolute;\n\tz-index: 2;\n}\n\n.dojoHtmlFisheyeListBar {\n\tposition: relative;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/FisheyeList.css&quot;), isContainer:true, snarfChildDomOutput:true, itemWidth:40, itemHeight:40, itemMaxWidth:150, itemMaxHeight:150, orientation:&quot;horizontal&quot;, conservativeTrigger:false, effectUnits:2, itemPadding:10, attachEdge:&quot;center&quot;, labelEdge:&quot;bottom&quot;, enableCrappySvgSupport:false, fillInTemplate:function () {
+	dojo.html.disableSelection(this.domNode);
+	this.isHorizontal = (this.orientation == &quot;horizontal&quot;);
+	this.selectedNode = -1;
+	this.isOver = false;
+	this.hitX1 = -1;
+	this.hitY1 = -1;
+	this.hitX2 = -1;
+	this.hitY2 = -1;
+	this.anchorEdge = this._toEdge(this.attachEdge, this.EDGE.CENTER);
+	this.labelEdge = this._toEdge(this.labelEdge, this.EDGE.TOP);
+	if (this.isHorizontal &amp;&amp; (this.anchorEdge == this.EDGE.LEFT)) {
+		this.anchorEdge = this.EDGE.CENTER;
+	}
+	if (this.isHorizontal &amp;&amp; (this.anchorEdge == this.EDGE.RIGHT)) {
+		this.anchorEdge = this.EDGE.CENTER;
+	}
+	if (!this.isHorizontal &amp;&amp; (this.anchorEdge == this.EDGE.TOP)) {
+		this.anchorEdge = this.EDGE.CENTER;
+	}
+	if (!this.isHorizontal &amp;&amp; (this.anchorEdge == this.EDGE.BOTTOM)) {
+		this.anchorEdge = this.EDGE.CENTER;
+	}
+	if (this.labelEdge == this.EDGE.CENTER) {
+		this.labelEdge = this.EDGE.TOP;
+	}
+	if (this.isHorizontal &amp;&amp; (this.labelEdge == this.EDGE.LEFT)) {
+		this.labelEdge = this.EDGE.TOP;
+	}
+	if (this.isHorizontal &amp;&amp; (this.labelEdge == this.EDGE.RIGHT)) {
+		this.labelEdge = this.EDGE.TOP;
+	}
+	if (!this.isHorizontal &amp;&amp; (this.labelEdge == this.EDGE.TOP)) {
+		this.labelEdge = this.EDGE.LEFT;
+	}
+	if (!this.isHorizontal &amp;&amp; (this.labelEdge == this.EDGE.BOTTOM)) {
+		this.labelEdge = this.EDGE.LEFT;
+	}
+	this.proximityLeft = this.itemWidth * (this.effectUnits - 0.5);
+	this.proximityRight = this.itemWidth * (this.effectUnits - 0.5);
+	this.proximityTop = this.itemHeight * (this.effectUnits - 0.5);
+	this.proximityBottom = this.itemHeight * (this.effectUnits - 0.5);
+	if (this.anchorEdge == this.EDGE.LEFT) {
+		this.proximityLeft = 0;
+	}
+	if (this.anchorEdge == this.EDGE.RIGHT) {
+		this.proximityRight = 0;
+	}
+	if (this.anchorEdge == this.EDGE.TOP) {
+		this.proximityTop = 0;
+	}
+	if (this.anchorEdge == this.EDGE.BOTTOM) {
+		this.proximityBottom = 0;
+	}
+	if (this.anchorEdge == this.EDGE.CENTER) {
+		this.proximityLeft /= 2;
+		this.proximityRight /= 2;
+		this.proximityTop /= 2;
+		this.proximityBottom /= 2;
+	}
+}, postCreate:function () {
+	this._initializePositioning();
+	if (!this.conservativeTrigger) {
+		dojo.event.connect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+	}
+	dojo.event.connect(document.documentElement, &quot;onmouseout&quot;, this, &quot;_onBodyOut&quot;);
+	dojo.event.connect(this, &quot;addChild&quot;, this, &quot;_initializePositioning&quot;);
+}, _initializePositioning:function () {
+	this.itemCount = this.children.length;
+	this.barWidth = (this.isHorizontal ? this.itemCount : 1) * this.itemWidth;
+	this.barHeight = (this.isHorizontal ? 1 : this.itemCount) * this.itemHeight;
+	this.totalWidth = this.proximityLeft + this.proximityRight + this.barWidth;
+	this.totalHeight = this.proximityTop + this.proximityBottom + this.barHeight;
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this.children[i].posX = this.itemWidth * (this.isHorizontal ? i : 0);
+		this.children[i].posY = this.itemHeight * (this.isHorizontal ? 0 : i);
+		this.children[i].cenX = this.children[i].posX + (this.itemWidth / 2);
+		this.children[i].cenY = this.children[i].posY + (this.itemHeight / 2);
+		var isz = this.isHorizontal ? this.itemWidth : this.itemHeight;
+		var r = this.effectUnits * isz;
+		var c = this.isHorizontal ? this.children[i].cenX : this.children[i].cenY;
+		var lhs = this.isHorizontal ? this.proximityLeft : this.proximityTop;
+		var rhs = this.isHorizontal ? this.proximityRight : this.proximityBottom;
+		var siz = this.isHorizontal ? this.barWidth : this.barHeight;
+		var range_lhs = r;
+		var range_rhs = r;
+		if (range_lhs &gt; c + lhs) {
+			range_lhs = c + lhs;
+		}
+		if (range_rhs &gt; (siz - c + rhs)) {
+			range_rhs = siz - c + rhs;
+		}
+		this.children[i].effectRangeLeft = range_lhs / isz;
+		this.children[i].effectRangeRght = range_rhs / isz;
+	}
+	this.domNode.style.width = this.barWidth + &quot;px&quot;;
+	this.domNode.style.height = this.barHeight + &quot;px&quot;;
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var itm = this.children[i];
+		var elm = itm.domNode;
+		elm.style.left = itm.posX + &quot;px&quot;;
+		elm.style.top = itm.posY + &quot;px&quot;;
+		elm.style.width = this.itemWidth + &quot;px&quot;;
+		elm.style.height = this.itemHeight + &quot;px&quot;;
+		if (itm.svgNode) {
+			itm.svgNode.style.position = &quot;absolute&quot;;
+			itm.svgNode.style.left = this.itemPadding + &quot;%&quot;;
+			itm.svgNode.style.top = this.itemPadding + &quot;%&quot;;
+			itm.svgNode.style.width = (100 - 2 * this.itemPadding) + &quot;%&quot;;
+			itm.svgNode.style.height = (100 - 2 * this.itemPadding) + &quot;%&quot;;
+			itm.svgNode.style.zIndex = 1;
+			itm.svgNode.setSize(this.itemWidth, this.itemHeight);
+		} else {
+			itm.imgNode.style.left = this.itemPadding + &quot;%&quot;;
+			itm.imgNode.style.top = this.itemPadding + &quot;%&quot;;
+			itm.imgNode.style.width = (100 - 2 * this.itemPadding) + &quot;%&quot;;
+			itm.imgNode.style.height = (100 - 2 * this.itemPadding) + &quot;%&quot;;
+		}
+	}
+	this._calcHitGrid();
+}, _onBodyOut:function (e) {
+	if (dojo.html.overElement(dojo.body(), e)) {
+		return;
+	}
+	this._setDormant(e);
+}, _setDormant:function (e) {
+	if (!this.isOver) {
+		return;
+	}
+	this.isOver = false;
+	if (this.conservativeTrigger) {
+		dojo.event.disconnect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+	}
+	this._onGridMouseMove(-1, -1);
+}, _setActive:function (e) {
+	if (this.isOver) {
+		return;
+	}
+	this.isOver = true;
+	if (this.conservativeTrigger) {
+		dojo.event.connect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+		this.timerScale = 0;
+		this._onMouseMove(e);
+		this._expandSlowly();
+	}
+}, _onMouseMove:function (e) {
+	if ((e.pageX &gt;= this.hitX1) &amp;&amp; (e.pageX &lt;= this.hitX2) &amp;&amp; (e.pageY &gt;= this.hitY1) &amp;&amp; (e.pageY &lt;= this.hitY2)) {
+		if (!this.isOver) {
+			this._setActive(e);
+		}
+		this._onGridMouseMove(e.pageX - this.hitX1, e.pageY - this.hitY1);
+	} else {
+		if (this.isOver) {
+			this._setDormant(e);
+		}
+	}
+}, onResized:function () {
+	this._calcHitGrid();
+}, _onGridMouseMove:function (x, y) {
+	this.pos = {x:x, y:y};
+	this._paint();
+}, _paint:function () {
+	var x = this.pos.x;
+	var y = this.pos.y;
+	if (this.itemCount &lt;= 0) {
+		return;
+	}
+	var pos = this.isHorizontal ? x : y;
+	var prx = this.isHorizontal ? this.proximityLeft : this.proximityTop;
+	var siz = this.isHorizontal ? this.itemWidth : this.itemHeight;
+	var sim = this.isHorizontal ? (1 - this.timerScale) * this.itemWidth + this.timerScale * this.itemMaxWidth : (1 - this.timerScale) * this.itemHeight + this.timerScale * this.itemMaxHeight;
+	var cen = ((pos - prx) / siz) - 0.5;
+	var max_off_cen = (sim / siz) - 0.5;
+	if (max_off_cen &gt; this.effectUnits) {
+		max_off_cen = this.effectUnits;
+	}
+	var off_weight = 0;
+	if (this.anchorEdge == this.EDGE.BOTTOM) {
+		var cen2 = (y - this.proximityTop) / this.itemHeight;
+		off_weight = (cen2 &gt; 0.5) ? 1 : y / (this.proximityTop + (this.itemHeight / 2));
+	}
+	if (this.anchorEdge == this.EDGE.TOP) {
+		var cen2 = (y - this.proximityTop) / this.itemHeight;
+		off_weight = (cen2 &lt; 0.5) ? 1 : (this.totalHeight - y) / (this.proximityBottom + (this.itemHeight / 2));
+	}
+	if (this.anchorEdge == this.EDGE.RIGHT) {
+		var cen2 = (x - this.proximityLeft) / this.itemWidth;
+		off_weight = (cen2 &gt; 0.5) ? 1 : x / (this.proximityLeft + (this.itemWidth / 2));
+	}
+	if (this.anchorEdge == this.EDGE.LEFT) {
+		var cen2 = (x - this.proximityLeft) / this.itemWidth;
+		off_weight = (cen2 &lt; 0.5) ? 1 : (this.totalWidth - x) / (this.proximityRight + (this.itemWidth / 2));
+	}
+	if (this.anchorEdge == this.EDGE.CENTER) {
+		if (this.isHorizontal) {
+			off_weight = y / (this.totalHeight);
+		} else {
+			off_weight = x / (this.totalWidth);
+		}
+		if (off_weight &gt; 0.5) {
+			off_weight = 1 - off_weight;
+		}
+		off_weight *= 2;
+	}
+	for (var i = 0; i &lt; this.itemCount; i++) {
+		var weight = this._weighAt(cen, i);
+		if (weight &lt; 0) {
+			weight = 0;
+		}
+		this._setItemSize(i, weight * off_weight);
+	}
+	var main_p = Math.round(cen);
+	var offset = 0;
+	if (cen &lt; 0) {
+		main_p = 0;
+	} else {
+		if (cen &gt; this.itemCount - 1) {
+			main_p = this.itemCount - 1;
+		} else {
+			offset = (cen - main_p) * ((this.isHorizontal ? this.itemWidth : this.itemHeight) - this.children[main_p].sizeMain);
+		}
+	}
+	this._positionElementsFrom(main_p, offset);
+}, _weighAt:function (cen, i) {
+	var dist = Math.abs(cen - i);
+	var limit = ((cen - i) &gt; 0) ? this.children[i].effectRangeRght : this.children[i].effectRangeLeft;
+	return (dist &gt; limit) ? 0 : (1 - dist / limit);
+}, _setItemSize:function (p, scale) {
+	scale *= this.timerScale;
+	var w = Math.round(this.itemWidth + ((this.itemMaxWidth - this.itemWidth) * scale));
+	var h = Math.round(this.itemHeight + ((this.itemMaxHeight - this.itemHeight) * scale));
+	if (this.isHorizontal) {
+		this.children[p].sizeW = w;
+		this.children[p].sizeH = h;
+		this.children[p].sizeMain = w;
+		this.children[p].sizeOff = h;
+		var y = 0;
+		if (this.anchorEdge == this.EDGE.TOP) {
+			y = (this.children[p].cenY - (this.itemHeight / 2));
+		} else {
+			if (this.anchorEdge == this.EDGE.BOTTOM) {
+				y = (this.children[p].cenY - (h - (this.itemHeight / 2)));
+			} else {
+				y = (this.children[p].cenY - (h / 2));
+			}
+		}
+		this.children[p].usualX = Math.round(this.children[p].cenX - (w / 2));
+		this.children[p].domNode.style.top = y + &quot;px&quot;;
+		this.children[p].domNode.style.left = this.children[p].usualX + &quot;px&quot;;
+	} else {
+		this.children[p].sizeW = w;
+		this.children[p].sizeH = h;
+		this.children[p].sizeOff = w;
+		this.children[p].sizeMain = h;
+		var x = 0;
+		if (this.anchorEdge == this.EDGE.LEFT) {
+			x = this.children[p].cenX - (this.itemWidth / 2);
+		} else {
+			if (this.anchorEdge == this.EDGE.RIGHT) {
+				x = this.children[p].cenX - (w - (this.itemWidth / 2));
+			} else {
+				x = this.children[p].cenX - (w / 2);
+			}
+		}
+		this.children[p].domNode.style.left = x + &quot;px&quot;;
+		this.children[p].usualY = Math.round(this.children[p].cenY - (h / 2));
+		this.children[p].domNode.style.top = this.children[p].usualY + &quot;px&quot;;
+	}
+	this.children[p].domNode.style.width = w + &quot;px&quot;;
+	this.children[p].domNode.style.height = h + &quot;px&quot;;
+	if (this.children[p].svgNode) {
+		this.children[p].svgNode.setSize(w, h);
+	}
+}, _positionElementsFrom:function (p, offset) {
+	var pos = 0;
+	if (this.isHorizontal) {
+		pos = Math.round(this.children[p].usualX + offset);
+		this.children[p].domNode.style.left = pos + &quot;px&quot;;
+	} else {
+		pos = Math.round(this.children[p].usualY + offset);
+		this.children[p].domNode.style.top = pos + &quot;px&quot;;
+	}
+	this._positionLabel(this.children[p]);
+	var bpos = pos;
+	for (var i = p - 1; i &gt;= 0; i--) {
+		bpos -= this.children[i].sizeMain;
+		if (this.isHorizontal) {
+			this.children[i].domNode.style.left = bpos + &quot;px&quot;;
+		} else {
+			this.children[i].domNode.style.top = bpos + &quot;px&quot;;
+		}
+		this._positionLabel(this.children[i]);
+	}
+	var apos = pos;
+	for (var i = p + 1; i &lt; this.itemCount; i++) {
+		apos += this.children[i - 1].sizeMain;
+		if (this.isHorizontal) {
+			this.children[i].domNode.style.left = apos + &quot;px&quot;;
+		} else {
+			this.children[i].domNode.style.top = apos + &quot;px&quot;;
+		}
+		this._positionLabel(this.children[i]);
+	}
+}, _positionLabel:function (itm) {
+	var x = 0;
+	var y = 0;
+	var mb = dojo.html.getMarginBox(itm.lblNode);
+	if (this.labelEdge == this.EDGE.TOP) {
+		x = Math.round((itm.sizeW / 2) - (mb.width / 2));
+		y = -mb.height;
+	}
+	if (this.labelEdge == this.EDGE.BOTTOM) {
+		x = Math.round((itm.sizeW / 2) - (mb.width / 2));
+		y = itm.sizeH;
+	}
+	if (this.labelEdge == this.EDGE.LEFT) {
+		x = -mb.width;
+		y = Math.round((itm.sizeH / 2) - (mb.height / 2));
+	}
+	if (this.labelEdge == this.EDGE.RIGHT) {
+		x = itm.sizeW;
+		y = Math.round((itm.sizeH / 2) - (mb.height / 2));
+	}
+	itm.lblNode.style.left = x + &quot;px&quot;;
+	itm.lblNode.style.top = y + &quot;px&quot;;
+}, _calcHitGrid:function () {
+	var pos = dojo.html.getAbsolutePosition(this.domNode, true);
+	this.hitX1 = pos.x - this.proximityLeft;
+	this.hitY1 = pos.y - this.proximityTop;
+	this.hitX2 = this.hitX1 + this.totalWidth;
+	this.hitY2 = this.hitY1 + this.totalHeight;
+}, _toEdge:function (inp, def) {
+	return this.EDGE[inp.toUpperCase()] || def;
+}, _expandSlowly:function () {
+	if (!this.isOver) {
+		return;
+	}
+	this.timerScale += 0.2;
+	this._paint();
+	if (this.timerScale &lt; 1) {
+		dojo.lang.setTimeout(this, &quot;_expandSlowly&quot;, 10);
+	}
+}, destroy:function () {
+	dojo.event.disconnect(document.documentElement, &quot;onmouseout&quot;, this, &quot;_onBodyOut&quot;);
+	dojo.event.disconnect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+	dojo.widget.FisheyeList.superclass.destroy.call(this);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.FisheyeListItem&quot;, dojo.widget.HtmlWidget, {iconSrc:&quot;&quot;, svgSrc:&quot;&quot;, caption:&quot;&quot;, id:&quot;&quot;, _blankImgPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/blank.gif&quot;), templateString:&quot;&lt;div class=\&quot;dojoHtmlFisheyeListItem\&quot;&gt;&quot; + &quot;  &lt;img class=\&quot;dojoHtmlFisheyeListItemImage\&quot; dojoAttachPoint=\&quot;imgNode\&quot; dojoAttachEvent=\&quot;onMouseOver;onMouseOut;onClick\&quot;&gt;&quot; + &quot;  &lt;div class=\&quot;dojoHtmlFisheyeListItemLabel\&quot; dojoAttachPoint=\&quot;lblNode\&quot;&gt;&lt;/div&gt;&quot; + &quot;&lt;/div&gt;&quot;, fillInTemplate:function () {
+	if (this.svgSrc != &quot;&quot;) {
+		this.svgNode = this._createSvgNode(this.svgSrc);
+		this.domNode.appendChild(this.svgNode);
+		this.imgNode.style.display = &quot;none&quot;;
+	} else {
+		if ((this.iconSrc.toLowerCase().substring(this.iconSrc.length - 4) == &quot;.png&quot;) &amp;&amp; (dojo.render.html.ie) &amp;&amp; (!dojo.render.html.ie70)) {
+			if (dojo.dom.hasParent(this.imgNode) &amp;&amp; this.id != &quot;&quot;) {
+				var parent = this.imgNode.parentNode;
+				parent.setAttribute(&quot;id&quot;, this.id);
+			}
+			this.imgNode.style.filter = &quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(src='&quot; + this.iconSrc + &quot;', sizingMethod='scale')&quot;;
+			this.imgNode.src = this._blankImgPath.toString();
+		} else {
+			if (dojo.dom.hasParent(this.imgNode) &amp;&amp; this.id != &quot;&quot;) {
+				var parent = this.imgNode.parentNode;
+				parent.setAttribute(&quot;id&quot;, this.id);
+			}
+			this.imgNode.src = this.iconSrc;
+		}
+	}
+	if (this.lblNode) {
+		this.lblNode.appendChild(document.createTextNode(this.caption));
+	}
+	dojo.html.disableSelection(this.domNode);
+}, _createSvgNode:function (src) {
+	var elm = document.createElement(&quot;embed&quot;);
+	elm.src = src;
+	elm.type = &quot;image/svg+xml&quot;;
+	elm.style.width = &quot;1px&quot;;
+	elm.style.height = &quot;1px&quot;;
+	elm.loaded = 0;
+	elm.setSizeOnLoad = false;
+	elm.onload = function () {
+		this.svgRoot = this.getSVGDocument().rootElement;
+		this.svgDoc = this.getSVGDocument().documentElement;
+		this.zeroWidth = this.svgRoot.width.baseVal.value;
+		this.zeroHeight = this.svgRoot.height.baseVal.value;
+		this.loaded = true;
+		if (this.setSizeOnLoad) {
+			this.setSize(this.setWidth, this.setHeight);
+		}
+	};
+	elm.setSize = function (w, h) {
+		if (!this.loaded) {
+			this.setWidth = w;
+			this.setHeight = h;
+			this.setSizeOnLoad = true;
+			return;
+		}
+		this.style.width = w + &quot;px&quot;;
+		this.style.height = h + &quot;px&quot;;
+		this.svgRoot.width.baseVal.value = w;
+		this.svgRoot.height.baseVal.value = h;
+		var scale_x = w / this.zeroWidth;
+		var scale_y = h / this.zeroHeight;
+		for (var i = 0; i &lt; this.svgDoc.childNodes.length; i++) {
+			if (this.svgDoc.childNodes[i].setAttribute) {
+				this.svgDoc.childNodes[i].setAttribute(&quot;transform&quot;, &quot;scale(&quot; + scale_x + &quot;,&quot; + scale_y + &quot;)&quot;);
+			}
+		}
+	};
+	return elm;
+}, onMouseOver:function (e) {
+	if (!this.parent.isOver) {
+		this.parent._setActive(e);
+	}
+	if (this.caption != &quot;&quot;) {
+		dojo.html.addClass(this.lblNode, &quot;selected&quot;);
+		this.parent._positionLabel(this);
+	}
+}, onMouseOut:function (e) {
+	dojo.html.removeClass(this.lblNode, &quot;selected&quot;);
+}, onClick:function (e) {
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/FloatingPane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/FloatingPane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/FloatingPane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,249 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.FloatingPane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.Manager&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.iframe&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.lfx.shadow&quot;);
+dojo.require(&quot;dojo.widget.html.layout&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.dnd.HtmlDragMove&quot;);
+dojo.require(&quot;dojo.widget.Dialog&quot;);
+dojo.require(&quot;dojo.widget.ResizeHandle&quot;);
+dojo.declare(&quot;dojo.widget.FloatingPaneBase&quot;, null, {title:&quot;&quot;, iconSrc:&quot;&quot;, hasShadow:false, constrainToContainer:false, taskBarId:&quot;&quot;, resizable:true, titleBarDisplay:true, windowState:&quot;normal&quot;, displayCloseAction:false, displayMinimizeAction:false, displayMaximizeAction:false, _max_taskBarConnectAttempts:5, _taskBarConnectAttempts:0, templateString:&quot;&lt;div id=\&quot;${this.widgetId}\&quot; dojoAttachEvent=\&quot;onMouseDown\&quot; class=\&quot;dojoFloatingPane\&quot;&gt;\n\t&lt;div dojoAttachPoint=\&quot;titleBar\&quot; class=\&quot;dojoFloatingPaneTitleBar\&quot;  style=\&quot;display:none\&quot;&gt;\n\t  \t&lt;img dojoAttachPoint=\&quot;titleBarIcon\&quot;  class=\&quot;dojoFloatingPaneTitleBarIcon\&quot;&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;closeAction\&quot; dojoAttachEvent=\&quot;onClick:closeWindow\&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneCloseIcon\&quot;&gt;&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;restoreAction\&quot; dojoAttachEvent=\&quot;onClick:restoreWindow\&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneRestoreIcon\&quot;&gt;&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;maximizeAction\&quot; dojoAttachEvent=\&quot;onClick:maximizeWindow!
 \&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneMaximizeIcon\&quot;&gt;&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;minimizeAction\&quot; dojoAttachEvent=\&quot;onClick:minimizeWindow\&quot;\n   \t  \t\tclass=\&quot;dojoFloatingPaneMinimizeIcon\&quot;&gt;&lt;/div&gt;\n\t  \t&lt;div dojoAttachPoint=\&quot;titleBarText\&quot; class=\&quot;dojoFloatingPaneTitleText\&quot;&gt;${this.title}&lt;/div&gt;\n\t&lt;/div&gt;\n\n\t&lt;div id=\&quot;${this.widgetId}_container\&quot; dojoAttachPoint=\&quot;containerNode\&quot; class=\&quot;dojoFloatingPaneClient\&quot;&gt;&lt;/div&gt;\n\n\t&lt;div dojoAttachPoint=\&quot;resizeBar\&quot; class=\&quot;dojoFloatingPaneResizebar\&quot; style=\&quot;display:none\&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;\n/********** Outer Window ***************/\n\n.dojoFloatingPane {\n\t/* essential css */\n\tposition: absolute;\n\toverflow: visible;\t\t/* so drop shadow is displayed */\n\tz-index: 10;\n\n\t/* styling css */\n\tborder: 1px solid;\n\tborder-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;\n\tbackground-color: ThreeDFace;\n}\n\n\n/********** Title Bar ****************/\n\n.dojoFloatingPaneTitle!
 Bar {\n\tvertical-align: top;\n\tmargin: 2px 2px 2px 2px;\n\tz!
 -index: 
10;\n\tbackground-color: #7596c6;\n\tcursor: default;\n\toverflow: hidden;\n\tborder-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;\n\tvertical-align: middle;\n}\n\n.dojoFloatingPaneTitleText {\n\tfloat: left;\n\tpadding: 2px 4px 2px 2px;\n\twhite-space: nowrap;\n\tcolor: CaptionText;\n\tfont: small-caption;\n}\n\n.dojoTitleBarIcon {\n\tfloat: left;\n\theight: 22px;\n\twidth: 22px;\n\tvertical-align: middle;\n\tmargin-right: 5px;\n\tmargin-left: 5px;\n}\n\n.dojoFloatingPaneActions{\n\tfloat: right;\n\tposition: absolute;\n\tright: 2px;\n\ttop: 2px;\n\tvertical-align: middle;\n}\n\n\n.dojoFloatingPaneActionItem {\n\tvertical-align: middle;\n\tmargin-right: 1px;\n\theight: 22px;\n\twidth: 22px;\n}\n\n\n.dojoFloatingPaneTitleBarIcon {\n\t/* essential css */\n\tfloat: left;\n\n\t/* styling css */\n\tmargin-left: 2px;\n\tmargin-right: 4px;\n\theight: 22px;\n}\n\n/* minimize/maximize icons are specified by CSS only */\n.dojoFloatingPaneMinimizeIcon,\n.dojoFloati!
 ngPaneMaximizeIcon,\n.dojoFloatingPaneRestoreIcon,\n.dojoFloatingPaneCloseIcon {\n\tvertical-align: middle;\n\theight: 22px;\n\twidth: 22px;\n\tfloat: right;\n}\n.dojoFloatingPaneMinimizeIcon {\n\tbackground-image: url(images/floatingPaneMinimize.gif);\n}\n.dojoFloatingPaneMaximizeIcon {\n\tbackground-image: url(images/floatingPaneMaximize.gif);\n}\n.dojoFloatingPaneRestoreIcon {\n\tbackground-image: url(images/floatingPaneRestore.gif);\n}\n.dojoFloatingPaneCloseIcon {\n\tbackground-image: url(images/floatingPaneClose.gif);\n}\n\n/* bar at bottom of window that holds resize handle */\n.dojoFloatingPaneResizebar {\n\tz-index: 10;\n\theight: 13px;\n\tbackground-color: ThreeDFace;\n}\n\n/************* Client Area ***************/\n\n.dojoFloatingPaneClient {\n\tposition: relative;\n\tz-index: 10;\n\tborder: 1px solid;\n\tborder-color: ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow;\n\tmargin: 2px;\n\tbackground-color: ThreeDFace;\n\tpadding: 8px;\n\tfont-family: Ver!
 dana, Helvetica, Garamond, sans-serif;\n\tfont-size: 12px;\n\t!
 overflow
:<i> auto;\n}\n\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/FloatingPane.css&quot;), fillInFloatingPaneTemplate:function (args, frag) {
</I>+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+	dojo.body().appendChild(this.domNode);
+	if (!this.isShowing()) {
+		this.windowState = &quot;minimized&quot;;
+	}
+	if (this.iconSrc == &quot;&quot;) {
+		dojo.html.removeNode(this.titleBarIcon);
+	} else {
+		this.titleBarIcon.src = this.iconSrc.toString();
+	}
+	if (this.titleBarDisplay) {
+		this.titleBar.style.display = &quot;&quot;;
+		dojo.html.disableSelection(this.titleBar);
+		this.titleBarIcon.style.display = (this.iconSrc == &quot;&quot; ? &quot;none&quot; : &quot;&quot;);
+		this.minimizeAction.style.display = (this.displayMinimizeAction ? &quot;&quot; : &quot;none&quot;);
+		this.maximizeAction.style.display = (this.displayMaximizeAction &amp;&amp; this.windowState != &quot;maximized&quot; ? &quot;&quot; : &quot;none&quot;);
+		this.restoreAction.style.display = (this.displayMaximizeAction &amp;&amp; this.windowState == &quot;maximized&quot; ? &quot;&quot; : &quot;none&quot;);
+		this.closeAction.style.display = (this.displayCloseAction ? &quot;&quot; : &quot;none&quot;);
+		this.drag = new dojo.dnd.HtmlDragMoveSource(this.domNode);
+		if (this.constrainToContainer) {
+			this.drag.constrainTo();
+		}
+		this.drag.setDragHandle(this.titleBar);
+		var self = this;
+		dojo.event.topic.subscribe(&quot;dragMove&quot;, function (info) {
+			if (info.source.domNode == self.domNode) {
+				dojo.event.topic.publish(&quot;floatingPaneMove&quot;, {source:self});
+			}
+		});
+	}
+	if (this.resizable) {
+		this.resizeBar.style.display = &quot;&quot;;
+		this.resizeHandle = dojo.widget.createWidget(&quot;ResizeHandle&quot;, {targetElmId:this.widgetId, id:this.widgetId + &quot;_resize&quot;});
+		this.resizeBar.appendChild(this.resizeHandle.domNode);
+	}
+	if (this.hasShadow) {
+		this.shadow = new dojo.lfx.shadow(this.domNode);
+	}
+	this.bgIframe = new dojo.html.BackgroundIframe(this.domNode);
+	if (this.taskBarId) {
+		this._taskBarSetup();
+	}
+	dojo.body().removeChild(this.domNode);
+}, postCreate:function () {
+	if (dojo.hostenv.post_load_) {
+		this._setInitialWindowState();
+	} else {
+		dojo.addOnLoad(this, &quot;_setInitialWindowState&quot;);
+	}
+}, maximizeWindow:function (evt) {
+	var mb = dojo.html.getMarginBox(this.domNode);
+	this.previous = {width:mb.width || this.width, height:mb.height || this.height, left:this.domNode.style.left, top:this.domNode.style.top, bottom:this.domNode.style.bottom, right:this.domNode.style.right};
+	if (this.domNode.parentNode.style.overflow.toLowerCase() != &quot;hidden&quot;) {
+		this.parentPrevious = {overflow:this.domNode.parentNode.style.overflow};
+		dojo.debug(this.domNode.parentNode.style.overflow);
+		this.domNode.parentNode.style.overflow = &quot;hidden&quot;;
+	}
+	this.domNode.style.left = dojo.html.getPixelValue(this.domNode.parentNode, &quot;padding-left&quot;, true) + &quot;px&quot;;
+	this.domNode.style.top = dojo.html.getPixelValue(this.domNode.parentNode, &quot;padding-top&quot;, true) + &quot;px&quot;;
+	if ((this.domNode.parentNode.nodeName.toLowerCase() == &quot;body&quot;)) {
+		var viewport = dojo.html.getViewport();
+		var padding = dojo.html.getPadding(dojo.body());
+		this.resizeTo(viewport.width - padding.width, viewport.height - padding.height);
+	} else {
+		var content = dojo.html.getContentBox(this.domNode.parentNode);
+		this.resizeTo(content.width, content.height);
+	}
+	this.maximizeAction.style.display = &quot;none&quot;;
+	this.restoreAction.style.display = &quot;&quot;;
+	if (this.resizeHandle) {
+		this.resizeHandle.domNode.style.display = &quot;none&quot;;
+	}
+	this.drag.setDragHandle(null);
+	this.windowState = &quot;maximized&quot;;
+}, minimizeWindow:function (evt) {
+	this.hide();
+	for (var attr in this.parentPrevious) {
+		this.domNode.parentNode.style[attr] = this.parentPrevious[attr];
+	}
+	this.lastWindowState = this.windowState;
+	this.windowState = &quot;minimized&quot;;
+}, restoreWindow:function (evt) {
+	if (this.windowState == &quot;minimized&quot;) {
+		this.show();
+		if (this.lastWindowState == &quot;maximized&quot;) {
+			this.domNode.parentNode.style.overflow = &quot;hidden&quot;;
+			this.windowState = &quot;maximized&quot;;
+		} else {
+			this.windowState = &quot;normal&quot;;
+		}
+	} else {
+		if (this.windowState == &quot;maximized&quot;) {
+			for (var attr in this.previous) {
+				this.domNode.style[attr] = this.previous[attr];
+			}
+			for (var attr in this.parentPrevious) {
+				this.domNode.parentNode.style[attr] = this.parentPrevious[attr];
+			}
+			this.resizeTo(this.previous.width, this.previous.height);
+			this.previous = null;
+			this.parentPrevious = null;
+			this.restoreAction.style.display = &quot;none&quot;;
+			this.maximizeAction.style.display = this.displayMaximizeAction ? &quot;&quot; : &quot;none&quot;;
+			if (this.resizeHandle) {
+				this.resizeHandle.domNode.style.display = &quot;&quot;;
+			}
+			this.drag.setDragHandle(this.titleBar);
+			this.windowState = &quot;normal&quot;;
+		} else {
+		}
+	}
+}, toggleDisplay:function () {
+	if (this.windowState == &quot;minimized&quot;) {
+		this.restoreWindow();
+	} else {
+		this.minimizeWindow();
+	}
+}, closeWindow:function (evt) {
+	dojo.html.removeNode(this.domNode);
+	this.destroy();
+}, onMouseDown:function (evt) {
+	this.bringToTop();
+}, bringToTop:function () {
+	var floatingPanes = dojo.widget.manager.getWidgetsByType(this.widgetType);
+	var windows = [];
+	for (var x = 0; x &lt; floatingPanes.length; x++) {
+		if (this.widgetId != floatingPanes[x].widgetId) {
+			windows.push(floatingPanes[x]);
+		}
+	}
+	windows.sort(function (a, b) {
+		return a.domNode.style.zIndex - b.domNode.style.zIndex;
+	});
+	windows.push(this);
+	var floatingPaneStartingZ = 100;
+	for (x = 0; x &lt; windows.length; x++) {
+		windows[x].domNode.style.zIndex = floatingPaneStartingZ + x * 2;
+	}
+}, _setInitialWindowState:function () {
+	if (this.isShowing()) {
+		this.width = -1;
+		var mb = dojo.html.getMarginBox(this.domNode);
+		this.resizeTo(mb.width, mb.height);
+	}
+	if (this.windowState == &quot;maximized&quot;) {
+		this.maximizeWindow();
+		this.show();
+		return;
+	}
+	if (this.windowState == &quot;normal&quot;) {
+		this.show();
+		return;
+	}
+	if (this.windowState == &quot;minimized&quot;) {
+		this.hide();
+		return;
+	}
+	this.windowState = &quot;minimized&quot;;
+}, _taskBarSetup:function () {
+	var taskbar = dojo.widget.getWidgetById(this.taskBarId);
+	if (!taskbar) {
+		if (this._taskBarConnectAttempts &lt; this._max_taskBarConnectAttempts) {
+			dojo.lang.setTimeout(this, this._taskBarSetup, 50);
+			this._taskBarConnectAttempts++;
+		} else {
+			dojo.debug(&quot;Unable to connect to the taskBar&quot;);
+		}
+		return;
+	}
+	taskbar.addChild(this);
+}, showFloatingPane:function () {
+	this.bringToTop();
+}, onFloatingPaneShow:function () {
+	var mb = dojo.html.getMarginBox(this.domNode);
+	this.resizeTo(mb.width, mb.height);
+}, resizeTo:function (width, height) {
+	dojo.html.setMarginBox(this.domNode, {width:width, height:height});
+	dojo.widget.html.layout(this.domNode, [{domNode:this.titleBar, layoutAlign:&quot;top&quot;}, {domNode:this.resizeBar, layoutAlign:&quot;bottom&quot;}, {domNode:this.containerNode, layoutAlign:&quot;client&quot;}]);
+	dojo.widget.html.layout(this.containerNode, this.children, &quot;top-bottom&quot;);
+	this.bgIframe.onResized();
+	if (this.shadow) {
+		this.shadow.size(width, height);
+	}
+	this.onResized();
+}, checkSize:function () {
+}, destroyFloatingPane:function () {
+	if (this.resizeHandle) {
+		this.resizeHandle.destroy();
+		this.resizeHandle = null;
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.FloatingPane&quot;, [dojo.widget.ContentPane, dojo.widget.FloatingPaneBase], {fillInTemplate:function (args, frag) {
+	this.fillInFloatingPaneTemplate(args, frag);
+	dojo.widget.FloatingPane.superclass.fillInTemplate.call(this, args, frag);
+}, postCreate:function () {
+	dojo.widget.FloatingPaneBase.prototype.postCreate.apply(this, arguments);
+	dojo.widget.FloatingPane.superclass.postCreate.apply(this, arguments);
+}, show:function () {
+	dojo.widget.FloatingPane.superclass.show.apply(this, arguments);
+	this.showFloatingPane();
+}, onShow:function () {
+	dojo.widget.FloatingPane.superclass.onShow.call(this);
+	this.onFloatingPaneShow();
+}, destroy:function () {
+	this.destroyFloatingPane();
+	dojo.widget.FloatingPane.superclass.destroy.apply(this, arguments);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ModalFloatingPane&quot;, [dojo.widget.FloatingPane, dojo.widget.ModalDialogBase], {windowState:&quot;minimized&quot;, displayCloseAction:true, postCreate:function () {
+	dojo.widget.ModalDialogBase.prototype.postCreate.call(this);
+	dojo.widget.ModalFloatingPane.superclass.postCreate.call(this);
+}, show:function () {
+	this.showModalDialog();
+	dojo.widget.ModalFloatingPane.superclass.show.apply(this, arguments);
+	this.bg.style.zIndex = this.domNode.style.zIndex - 1;
+}, hide:function () {
+	this.hideModalDialog();
+	dojo.widget.ModalFloatingPane.superclass.hide.apply(this, arguments);
+}, closeWindow:function () {
+	this.hide();
+	dojo.widget.ModalFloatingPane.superclass.closeWindow.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Form.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Form.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Form.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,267 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Form&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Form&quot;, dojo.widget.HtmlWidget, {isContainer:true, templateString:&quot;&lt;form dojoAttachPoint='containerNode' dojoAttachEvent='onSubmit:onSubmit'&gt;&lt;/form&gt;&quot;, formElements:[], ignoreNullValues:false, postCreate:function (args, frag) {
+	for (var key in args) {
+		if (key == &quot;dojotype&quot;) {
+			continue;
+		}
+		var attr = document.createAttribute(key);
+		attr.nodeValue = args[key];
+		this.containerNode.setAttributeNode(attr);
+	}
+}, _createRepeaters:function (obj, widget) {
+	for (var i = 0; i &lt; widget.children.length; ++i) {
+		if (widget.children[i].widgetType == &quot;RepeaterContainer&quot;) {
+			var rIndex = widget.children[i].index;
+			var rIndexPos = rIndex.indexOf(&quot;%{index}&quot;);
+			rIndex = rIndex.substr(0, rIndexPos - 1);
+			var myObj = this._getObject(obj, rIndex);
+			if (typeof (myObj) == &quot;object&quot; &amp;&amp; myObj.length == 0) {
+				myObj = new Array();
+			}
+			var rowCount = widget.children[i].getRowCount();
+			for (var j = 0, len = rowCount; j &lt; len; ++j) {
+				widget.children[i].deleteRow(0);
+			}
+			for (var j = 0; j &lt; myObj.length; j++) {
+				widget.children[i].addRow(false);
+			}
+		}
+		if (widget.children[i].isContainer) {
+			this._createRepeaters(obj, widget.children[i]);
+		}
+	}
+}, _createFormElements:function () {
+	if (dojo.render.html.safari) {
+		this.formElements = [];
+		var elems = [&quot;INPUT&quot;, &quot;SELECT&quot;, &quot;TEXTAREA&quot;];
+		for (var k = 0; k &lt; elems.length; k++) {
+			var list = this.containerNode.getElementsByTagName(elems[k]);
+			for (var j = 0, len2 = list.length; j &lt; len2; j++) {
+				this.formElements.push(list[j]);
+			}
+		}
+	} else {
+		this.formElements = this.containerNode.elements;
+	}
+}, onSubmit:function (e) {
+	e.preventDefault();
+}, submit:function () {
+	this.containerNode.submit();
+}, _getFormElement:function (name) {
+	if (dojo.render.html.ie) {
+		for (var i = 0, len = this.formElements.length; i &lt; len; i++) {
+			var element = this.formElements[i];
+			if (element.name == name) {
+				return element;
+			}
+		}
+	} else {
+		var elem = this.formElements[name];
+		if (typeof (elem) != &quot;undefined&quot;) {
+			return elem;
+		}
+	}
+	return null;
+}, _getObject:function (obj, searchString) {
+	var namePath = [];
+	namePath = searchString.split(&quot;.&quot;);
+	var myObj = obj;
+	var name = namePath[namePath.length - 1];
+	for (var j = 0, len = namePath.length; j &lt; len; ++j) {
+		var p = namePath[j];
+		if (typeof (myObj[p]) == &quot;undefined&quot;) {
+			myObj[p] = {};
+		}
+		myObj = myObj[p];
+	}
+	return myObj;
+}, _setToContainers:function (obj, widget) {
+	for (var i = 0, len = widget.children.length; i &lt; len; ++i) {
+		var currentWidget = widget.children[i];
+		if (currentWidget.widgetType == &quot;Repeater&quot;) {
+			for (var j = 0, len = currentWidget.getRowCount(); j &lt; len; ++j) {
+				currentWidget._initRow(j);
+			}
+		}
+		if (currentWidget.isContainer) {
+			this._setToContainers(obj, currentWidget);
+			continue;
+		}
+		switch (currentWidget.widgetType) {
+		  case &quot;Checkbox&quot;:
+			currentWidget.setValue(currentWidget.inputNode.checked);
+			break;
+		  case &quot;DropdownDatePicker&quot;:
+			currentWidget.setValue(currentWidget.getValue());
+			break;
+		  case &quot;Select&quot;:
+			continue;
+			break;
+		  case &quot;ComboBox&quot;:
+			continue;
+			break;
+		  default:
+			break;
+		}
+	}
+}, setValues:function (obj) {
+	this._createFormElements();
+	this._createRepeaters(obj, this);
+	for (var i = 0, len = this.formElements.length; i &lt; len; i++) {
+		var element = this.formElements[i];
+		if (element.name == &quot;&quot;) {
+			continue;
+		}
+		var namePath = new Array();
+		namePath = element.name.split(&quot;.&quot;);
+		var myObj = obj;
+		var name = namePath[namePath.length - 1];
+		for (var j = 1, len2 = namePath.length; j &lt; len2; ++j) {
+			var p = namePath[j - 1];
+			if (typeof (myObj[p]) == &quot;undefined&quot;) {
+				myObj = undefined;
+				break;
+			}
+			myObj = myObj[p];
+		}
+		if (typeof (myObj) == &quot;undefined&quot;) {
+			continue;
+		}
+		if (typeof (myObj[name]) == &quot;undefined&quot; &amp;&amp; this.ignoreNullValues) {
+			continue;
+		}
+		var type = element.type;
+		if (type == &quot;hidden&quot; || type == &quot;text&quot; || type == &quot;textarea&quot; || type == &quot;password&quot;) {
+			type = &quot;text&quot;;
+		}
+		switch (type) {
+		  case &quot;checkbox&quot;:
+			element.checked = false;
+			if (typeof (myObj[name]) == &quot;undefined&quot;) {
+				continue;
+			}
+			for (var j = 0, len2 = myObj[name].length; j &lt; len2; ++j) {
+				if (element.value == myObj[name][j]) {
+					element.checked = true;
+				}
+			}
+			break;
+		  case &quot;radio&quot;:
+			element.checked = false;
+			if (typeof (myObj[name]) == &quot;undefined&quot;) {
+				continue;
+			}
+			if (myObj[name] == element.value) {
+				element.checked = true;
+			}
+			break;
+		  case &quot;select-multiple&quot;:
+			element.selectedIndex = -1;
+			for (var j = 0, len2 = element.options.length; j &lt; len2; ++j) {
+				for (var k = 0, len3 = myObj[name].length; k &lt; len3; ++k) {
+					if (element.options[j].value == myObj[name][k]) {
+						element.options[j].selected = true;
+					}
+				}
+			}
+			break;
+		  case &quot;select-one&quot;:
+			element.selectedIndex = &quot;0&quot;;
+			for (var j = 0, len2 = element.options.length; j &lt; len2; ++j) {
+				if (element.options[j].value == myObj[name]) {
+					element.options[j].selected = true;
+				} else {
+				}
+			}
+			break;
+		  case &quot;text&quot;:
+			var value = &quot;&quot;;
+			if (typeof (myObj[name]) != &quot;undefined&quot;) {
+				value = myObj[name];
+			}
+			element.value = value;
+			break;
+		  default:
+			dojo.debug(&quot;Not supported type (&quot; + type + &quot;)&quot;);
+			break;
+		}
+	}
+	this._setToContainers(obj, this);
+}, getValues:function () {
+	this._createFormElements();
+	var obj = {};
+	for (var i = 0, len = this.formElements.length; i &lt; len; i++) {
+		var elm = this.formElements[i];
+		var namePath = [];
+		if (elm.name == &quot;&quot;) {
+			continue;
+		}
+		namePath = elm.name.split(&quot;.&quot;);
+		var myObj = obj;
+		var name = namePath[namePath.length - 1];
+		for (var j = 1, len2 = namePath.length; j &lt; len2; ++j) {
+			var nameIndex = null;
+			var p = namePath[j - 1];
+			var nameA = p.split(&quot;[&quot;);
+			if (nameA.length &gt; 1) {
+				if (typeof (myObj[nameA[0]]) == &quot;undefined&quot;) {
+					myObj[nameA[0]] = [];
+				}
+				nameIndex = parseInt(nameA[1]);
+				if (typeof (myObj[nameA[0]][nameIndex]) == &quot;undefined&quot;) {
+					myObj[nameA[0]][nameIndex] = {};
+				}
+			} else {
+				if (typeof (myObj[nameA[0]]) == &quot;undefined&quot;) {
+					myObj[nameA[0]] = {};
+				}
+			}
+			if (nameA.length == 1) {
+				myObj = myObj[nameA[0]];
+			} else {
+				myObj = myObj[nameA[0]][nameIndex];
+			}
+		}
+		if ((elm.type != &quot;select-multiple&quot; &amp;&amp; elm.type != &quot;checkbox&quot; &amp;&amp; elm.type != &quot;radio&quot;) || (elm.type == &quot;radio&quot; &amp;&amp; elm.checked)) {
+			if (name == name.split(&quot;[&quot;)[0]) {
+				myObj[name] = elm.value;
+			} else {
+			}
+		} else {
+			if (elm.type == &quot;checkbox&quot; &amp;&amp; elm.checked) {
+				if (typeof (myObj[name]) == &quot;undefined&quot;) {
+					myObj[name] = [];
+				}
+				myObj[name].push(elm.value);
+			} else {
+				if (elm.type == &quot;select-multiple&quot;) {
+					if (typeof (myObj[name]) == &quot;undefined&quot;) {
+						myObj[name] = [];
+					}
+					for (var jdx = 0, len3 = elm.options.length; jdx &lt; len3; ++jdx) {
+						if (elm.options[jdx].selected) {
+							myObj[name].push(elm.options[jdx].value);
+						}
+					}
+				}
+			}
+		}
+		name = undefined;
+	}
+	return obj;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/GoogleMap.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/GoogleMap.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/GoogleMap.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,169 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.GoogleMap&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+(function () {
+	var gkey = djConfig[&quot;gMapKey&quot;] || djConfig[&quot;googleMapKey&quot;];
+	var uri = new dojo.uri.Uri(window.location.href);
+	if (uri.host == &quot;www.dojotoolkit.org&quot;) {
+		gkey = &quot;ABQIAAAACUNdgv_7FGOmUslbm9l6_hRqjp7ri2mNiOEYqetD3xnFHpt5rBSjszDd1sdufPyQKUTyCf_YxoIxvw&quot;;
+	} else {
+		if (uri.host == &quot;blog.dojotoolkit.org&quot;) {
+			gkey = &quot;ABQIAAAACUNdgv_7FGOmUslbm9l6_hSkep6Av1xaMhVn3yCLkorJeXeLARQ6fammI_P3qSGleTJhoI5_1JmP_Q&quot;;
+		} else {
+			if (uri.host == &quot;archive.dojotoolkit.org&quot;) {
+				gkey = &quot;ABQIAAAACUNdgv_7FGOmUslbm9l6_hTaQpDt0dyGLIHbXMPTzg1kWeAfwRTwZNyrUfbfxYE9yIvRivEjcXoDTg&quot;;
+			} else {
+				if (uri.host == &quot;dojotoolkit.org&quot;) {
+					gkey = &quot;ABQIAAAACUNdgv_7FGOmUslbm9l6_hSaOaO_TgJ5c3mtQFnk5JO2zD5dZBRZk-ieqVs7BORREYNzAERmcJoEjQ&quot;;
+				}
+			}
+		}
+	}
+	if (!dojo.hostenv.post_load_) {
+		if (!gkey || gkey == &quot;&quot;) {
+			dojo.raise(&quot;dojo.widget.GoogleMap: The Google Map widget requires a proper API key in order to be used.&quot;);
+		}
+		var tag = &quot;&lt;scr&quot; + &quot;ipt src='<A HREF="http://maps.google.com/maps?file=api&amp;amp;v=2&amp;amp;key=">http://maps.google.com/maps?file=api&amp;v=2&amp;key=</A>&quot; + gkey + &quot;'&gt;&lt;/scri&quot; + &quot;pt&gt;&quot;;
+		if (!dj_global[&quot;GMap2&quot;]) {
+			document.write(tag);
+		}
+	} else {
+		dojo.debug(&quot;Cannot initialize Google Map system after the page has been loaded! Please either manually include the script block provided by Google in your page or require() the GoogleMap widget before onload has fired.&quot;);
+	}
+})();
+dojo.widget.defineWidget(&quot;dojo.widget.GoogleMap&quot;, dojo.widget.HtmlWidget, function () {
+	this.map = null;
+	this.geocoder = null;
+	this.data = [];
+	this.datasrc = &quot;&quot;;
+	this.controls = [&quot;largemap&quot;, &quot;scale&quot;, &quot;maptype&quot;];
+}, {templatePath:null, templateCssPath:null, isContainer:false, _defaultPoint:{lat:39.10662, lng:-94.578209}, setControls:function () {
+	var methodmap = {largemap:GLargeMapControl, smallmap:GSmallMapControl, smallzoom:GSmallZoomControl, scale:GScaleControl, maptype:GMapTypeControl, overview:GOverviewMapControl};
+	for (var i = 0; i &lt; this.controls.length; i++) {
+		this.map.addControl(new (methodmap[this.controls[i].toLowerCase()])());
+	}
+}, findCenter:function (bounds) {
+	if (this.data.length == 1) {
+		return (new GLatLng(this.data[0].lat, this.data[0].lng));
+	}
+	var clat = (bounds.getNorthEast().lat() + bounds.getSouthWest().lat()) / 2;
+	var clng = (bounds.getNorthEast().lng() + bounds.getSouthWest().lng()) / 2;
+	return (new GLatLng(clat, clng));
+}, createPinpoint:function (pt, overlay) {
+	var m = new GMarker(pt);
+	if (overlay) {
+		GEvent.addListener(m, &quot;click&quot;, function () {
+			m.openInfoWindowHtml(&quot;&lt;div&gt;&quot; + overlay + &quot;&lt;/div&gt;&quot;);
+		});
+	}
+	return m;
+}, plot:function (obj) {
+	var p = new GLatLng(obj.lat, obj.lng);
+	var d = obj.description || null;
+	var m = this.createPinpoint(p, d);
+	this.map.addOverlay(m);
+}, plotAddress:function (address) {
+	var self = this;
+	this.geocoder.getLocations(address, function (response) {
+		if (!response || response.Status.code != 200) {
+			alert(&quot;The address \&quot;&quot; + address + &quot;\&quot; was not found.&quot;);
+			return;
+		}
+		var obj = {lat:response.Placemark[0].Point.coordinates[1], lng:response.Placemark[0].Point.coordinates[0], description:response.Placemark[0].address};
+		self.data.push(obj);
+		self.render();
+	});
+}, parse:function (table) {
+	this.data = [];
+	var h = table.getElementsByTagName(&quot;thead&quot;)[0];
+	if (!h) {
+		return;
+	}
+	var a = [];
+	var cols = h.getElementsByTagName(&quot;td&quot;);
+	if (cols.length == 0) {
+		cols = h.getElementsByTagName(&quot;th&quot;);
+	}
+	for (var i = 0; i &lt; cols.length; i++) {
+		var c = cols[i].innerHTML.toLowerCase();
+		if (c == &quot;long&quot;) {
+			c = &quot;lng&quot;;
+		}
+		a.push(c);
+	}
+	var b = table.getElementsByTagName(&quot;tbody&quot;)[0];
+	if (!b) {
+		return;
+	}
+	for (var i = 0; i &lt; b.childNodes.length; i++) {
+		if (!(b.childNodes[i].nodeName &amp;&amp; b.childNodes[i].nodeName.toLowerCase() == &quot;tr&quot;)) {
+			continue;
+		}
+		var cells = b.childNodes[i].getElementsByTagName(&quot;td&quot;);
+		var o = {};
+		for (var j = 0; j &lt; a.length; j++) {
+			var col = a[j];
+			if (col == &quot;lat&quot; || col == &quot;lng&quot;) {
+				o[col] = parseFloat(cells[j].innerHTML);
+			} else {
+				o[col] = cells[j].innerHTML;
+			}
+		}
+		this.data.push(o);
+	}
+}, render:function () {
+	if (this.data.length == 0) {
+		this.map.setCenter(new GLatLng(this._defaultPoint.lat, this._defaultPoint.lng), 4);
+		return;
+	}
+	this.map.clearOverlays();
+	var bounds = new GLatLngBounds();
+	var d = this.data;
+	for (var i = 0; i &lt; d.length; i++) {
+		bounds.extend(new GLatLng(d[i].lat, d[i].lng));
+	}
+	var zoom = Math.min((this.map.getBoundsZoomLevel(bounds) - 1), 14);
+	this.map.setCenter(this.findCenter(bounds), zoom);
+	for (var i = 0; i &lt; this.data.length; i++) {
+		this.plot(this.data[i]);
+	}
+}, initialize:function (args, frag) {
+	if (this.datasrc) {
+		this.parse(dojo.byId(this.datasrc));
+	} else {
+		if (this.domNode.getElementsByTagName(&quot;table&quot;)[0]) {
+			this.parse(this.domNode.getElementsByTagName(&quot;table&quot;)[0]);
+		}
+	}
+}, postCreate:function () {
+	while (this.domNode.childNodes.length &gt; 0) {
+		this.domNode.removeChild(this.domNode.childNodes[0]);
+	}
+	if (this.domNode.style.position != &quot;absolute&quot;) {
+		this.domNode.style.position = &quot;relative&quot;;
+	}
+	this.map = new GMap2(this.domNode);
+	try {
+		this.geocoder = new GClientGeocoder();
+	}
+	catch (ex) {
+	}
+	this.render();
+	this.setControls();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/HtmlWidget.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/HtmlWidget.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/HtmlWidget.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,101 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.DomWidget&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lfx.toggle&quot;);
+dojo.declare(&quot;dojo.widget.HtmlWidget&quot;, dojo.widget.DomWidget, {templateCssPath:null, templatePath:null, lang:&quot;&quot;, toggle:&quot;plain&quot;, toggleDuration:150, initialize:function (args, frag) {
+}, postMixInProperties:function (args, frag) {
+	if (this.lang === &quot;&quot;) {
+		this.lang = null;
+	}
+	this.toggleObj = dojo.lfx.toggle[this.toggle.toLowerCase()] || dojo.lfx.toggle.plain;
+}, createNodesFromText:function (txt, wrap) {
+	return dojo.html.createNodesFromText(txt, wrap);
+}, destroyRendering:function (finalize) {
+	try {
+		if (this.bgIframe) {
+			this.bgIframe.remove();
+			delete this.bgIframe;
+		}
+		if (!finalize &amp;&amp; this.domNode) {
+			dojo.event.browser.clean(this.domNode);
+		}
+		dojo.widget.HtmlWidget.superclass.destroyRendering.call(this);
+	}
+	catch (e) {
+	}
+}, isShowing:function () {
+	return dojo.html.isShowing(this.domNode);
+}, toggleShowing:function () {
+	if (this.isShowing()) {
+		this.hide();
+	} else {
+		this.show();
+	}
+}, show:function () {
+	if (this.isShowing()) {
+		return;
+	}
+	this.animationInProgress = true;
+	this.toggleObj.show(this.domNode, this.toggleDuration, null, dojo.lang.hitch(this, this.onShow), this.explodeSrc);
+}, onShow:function () {
+	this.animationInProgress = false;
+	this.checkSize();
+}, hide:function () {
+	if (!this.isShowing()) {
+		return;
+	}
+	this.animationInProgress = true;
+	this.toggleObj.hide(this.domNode, this.toggleDuration, null, dojo.lang.hitch(this, this.onHide), this.explodeSrc);
+}, onHide:function () {
+	this.animationInProgress = false;
+}, _isResized:function (w, h) {
+	if (!this.isShowing()) {
+		return false;
+	}
+	var wh = dojo.html.getMarginBox(this.domNode);
+	var width = w || wh.width;
+	var height = h || wh.height;
+	if (this.width == width &amp;&amp; this.height == height) {
+		return false;
+	}
+	this.width = width;
+	this.height = height;
+	return true;
+}, checkSize:function () {
+	if (!this._isResized()) {
+		return;
+	}
+	this.onResized();
+}, resizeTo:function (w, h) {
+	dojo.html.setMarginBox(this.domNode, {width:w, height:h});
+	if (this.isShowing()) {
+		this.onResized();
+	}
+}, resizeSoon:function () {
+	if (this.isShowing()) {
+		dojo.lang.setTimeout(this, this.onResized, 0);
+	}
+}, onResized:function () {
+	dojo.lang.forEach(this.children, function (child) {
+		if (child.checkSize) {
+			child.checkSize();
+		}
+	});
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/InlineEditBox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/InlineEditBox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/InlineEditBox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,156 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.InlineEditBox&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.InlineEditBox&quot;, dojo.widget.HtmlWidget, function () {
+	this.history = [];
+}, {templateString:&quot;&lt;form class=\&quot;inlineEditBox\&quot; style=\&quot;display: none\&quot; dojoAttachPoint=\&quot;form\&quot; dojoAttachEvent=\&quot;onSubmit:saveEdit; onReset:cancelEdit; onKeyUp: checkForValueChange;\&quot;&gt;\n\t&lt;input type=\&quot;text\&quot; dojoAttachPoint=\&quot;text\&quot; style=\&quot;display: none;\&quot; /&gt;\n\t&lt;textarea dojoAttachPoint=\&quot;textarea\&quot; style=\&quot;display: none;\&quot;&gt;&lt;/textarea&gt;\n\t&lt;input type=\&quot;submit\&quot; value=\&quot;Save\&quot; dojoAttachPoint=\&quot;submitButton\&quot; /&gt;\n\t&lt;input type=\&quot;reset\&quot; value=\&quot;Cancel\&quot; dojoAttachPoint=\&quot;cancelButton\&quot; /&gt;\n&lt;/form&gt;\n&quot;, templateCssString:&quot;.editLabel {\n\tfont-size : small;\n\tpadding : 0 5px;\n\tdisplay : none;\n}\n\n.editableRegionDisabled {\n\tcursor : pointer;\n\t_cursor : hand;\n}\n\n.editableRegion {\n\tbackground-color : #ffc !important;\n\tcursor : pointer;\n\t_cursor : hand;\n}\n\n.editableRegion .editLabel {\n\tdisplay : inline;\n}\n\n.editableTextareaRegion .editLabel {\n\tdisplay : block;\n}\n\n.inlineEditBox {\n\t/*background-color : #ffc;*/\n\tdisplay : inline;\n}\n&quot;, templ!
 ateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/InlineEditBox.css&quot;), mode:&quot;text&quot;, name:&quot;&quot;, minWidth:100, minHeight:200, editing:false, value:&quot;&quot;, textValue:&quot;&quot;, defaultText:&quot;&quot;, postMixInProperties:function () {
+	if (this.textValue) {
+		dojo.deprecated(&quot;InlineEditBox: Use value parameter instead of textValue; will be removed in 0.5&quot;);
+		this.value = this.textValue;
+	}
+	if (this.defaultText) {
+		dojo.deprecated(&quot;InlineEditBox: Use value parameter instead of defaultText; will be removed in 0.5&quot;);
+		this.value = this.defaultText;
+	}
+}, postCreate:function (args, frag) {
+	this.editable = this.getFragNodeRef(frag);
+	dojo.html.insertAfter(this.editable, this.form);
+	dojo.event.connect(this.editable, &quot;onmouseover&quot;, this, &quot;onMouseOver&quot;);
+	dojo.event.connect(this.editable, &quot;onmouseout&quot;, this, &quot;onMouseOut&quot;);
+	dojo.event.connect(this.editable, &quot;onclick&quot;, this, &quot;_beginEdit&quot;);
+	if (this.value) {
+		this.editable.innerHTML = this.value;
+		return;
+	} else {
+		this.value = dojo.string.trim(this.editable.innerHTML);
+		this.editable.innerHTML = this.value;
+	}
+}, onMouseOver:function () {
+	if (!this.editing) {
+		if (this.disabled) {
+			dojo.html.addClass(this.editable, &quot;editableRegionDisabled&quot;);
+		} else {
+			dojo.html.addClass(this.editable, &quot;editableRegion&quot;);
+			if (this.mode == &quot;textarea&quot;) {
+				dojo.html.addClass(this.editable, &quot;editableTextareaRegion&quot;);
+			}
+		}
+	}
+}, onMouseOut:function () {
+	if (!this.editing) {
+		dojo.html.removeClass(this.editable, &quot;editableRegion&quot;);
+		dojo.html.removeClass(this.editable, &quot;editableTextareaRegion&quot;);
+		dojo.html.removeClass(this.editable, &quot;editableRegionDisabled&quot;);
+	}
+}, _beginEdit:function (e) {
+	if (this.editing || this.disabled) {
+		return;
+	}
+	this.onMouseOut();
+	this.editing = true;
+	var ee = this[this.mode.toLowerCase()];
+	ee.value = dojo.string.trim(this.value);
+	ee.style.fontSize = dojo.html.getStyle(this.editable, &quot;font-size&quot;);
+	ee.style.fontWeight = dojo.html.getStyle(this.editable, &quot;font-weight&quot;);
+	ee.style.fontStyle = dojo.html.getStyle(this.editable, &quot;font-style&quot;);
+	var bb = dojo.html.getBorderBox(this.editable);
+	ee.style.width = Math.max(bb.width, this.minWidth) + &quot;px&quot;;
+	if (this.mode.toLowerCase() == &quot;textarea&quot;) {
+		ee.style.display = &quot;block&quot;;
+		ee.style.height = Math.max(bb.height, this.minHeight) + &quot;px&quot;;
+	} else {
+		ee.style.display = &quot;&quot;;
+	}
+	this.form.style.display = &quot;&quot;;
+	this.editable.style.display = &quot;none&quot;;
+	ee.focus();
+	ee.select();
+	this.submitButton.disabled = true;
+}, saveEdit:function (e) {
+	e.preventDefault();
+	e.stopPropagation();
+	var ee = this[this.mode.toLowerCase()];
+	if ((this.value != ee.value) &amp;&amp; (dojo.string.trim(ee.value) != &quot;&quot;)) {
+		this.doFade = true;
+		this.history.push(this.value);
+		this.onSave(ee.value, this.value, this.name);
+		this.value = ee.value;
+		this.editable.innerHTML = &quot;&quot;;
+		var textNode = document.createTextNode(this.value);
+		this.editable.appendChild(textNode);
+	} else {
+		this.doFade = false;
+	}
+	this._finishEdit(e);
+}, _stopEditing:function () {
+	this.editing = false;
+	this.form.style.display = &quot;none&quot;;
+	this.editable.style.display = &quot;&quot;;
+	return true;
+}, cancelEdit:function (e) {
+	this._stopEditing();
+	this.onCancel();
+	return true;
+}, _finishEdit:function (e) {
+	this._stopEditing();
+	if (this.doFade) {
+		dojo.lfx.highlight(this.editable, dojo.gfx.color.hex2rgb(&quot;#ffc&quot;), 700).play(300);
+	}
+	this.doFade = false;
+}, setText:function (txt) {
+	dojo.deprecated(&quot;setText() is deprecated, call setValue() instead, will be removed in 0.5&quot;);
+	this.setValue(txt);
+}, setValue:function (txt) {
+	txt = &quot;&quot; + txt;
+	var tt = dojo.string.trim(txt);
+	this.value = tt;
+	this.editable.innerHTML = tt;
+}, undo:function () {
+	if (this.history.length &gt; 0) {
+		var curValue = this.value;
+		var value = this.history.pop();
+		this.editable.innerHTML = value;
+		this.value = value;
+		this.onUndo(value);
+		this.onSave(value, curValue, this.name);
+	}
+}, onChange:function (newValue, oldValue) {
+}, onSave:function (newValue, oldValue, name) {
+}, onCancel:function () {
+}, checkForValueChange:function () {
+	var ee = this[this.mode.toLowerCase()];
+	if ((this.value != ee.value) &amp;&amp; (dojo.string.trim(ee.value) != &quot;&quot;)) {
+		this.submitButton.disabled = false;
+	}
+	this.onChange(this.value, ee.value);
+}, disable:function () {
+	this.submitButton.disabled = true;
+	this.cancelButton.disabled = true;
+	var ee = this[this.mode.toLowerCase()];
+	ee.disabled = true;
+	dojo.widget.InlineEditBox.superclass.disable.apply(this, arguments);
+}, enable:function () {
+	this.checkForValueChange();
+	this.cancelButton.disabled = false;
+	var ee = this[this.mode.toLowerCase()];
+	ee.disabled = false;
+	dojo.widget.InlineEditBox.superclass.enable.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/IntegerTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/IntegerTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/IntegerTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,42 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.IntegerTextbox&quot;);
+dojo.require(&quot;dojo.widget.ValidationTextbox&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.IntegerTextbox&quot;, dojo.widget.ValidationTextbox, {mixInProperties:function (localProperties, frag) {
+	dojo.widget.IntegerTextbox.superclass.mixInProperties.apply(this, arguments);
+	if ((localProperties.signed == &quot;true&quot;) || (localProperties.signed == &quot;always&quot;)) {
+		this.flags.signed = true;
+	} else {
+		if ((localProperties.signed == &quot;false&quot;) || (localProperties.signed == &quot;never&quot;)) {
+			this.flags.signed = false;
+			this.flags.min = 0;
+		} else {
+			this.flags.signed = [true, false];
+		}
+	}
+	if (localProperties.separator) {
+		this.flags.separator = localProperties.separator;
+	}
+	if (localProperties.min) {
+		this.flags.min = parseInt(localProperties.min);
+	}
+	if (localProperties.max) {
+		this.flags.max = parseInt(localProperties.max);
+	}
+}, isValid:function () {
+	return dojo.validate.isInteger(this.textbox.value, this.flags);
+}, isInRange:function () {
+	return dojo.validate.isInRange(this.textbox.value, this.flags);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/InternetTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/InternetTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/InternetTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,78 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.InternetTextbox&quot;);
+dojo.require(&quot;dojo.widget.ValidationTextbox&quot;);
+dojo.require(&quot;dojo.validate.web&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.IpAddressTextbox&quot;, dojo.widget.ValidationTextbox, {mixInProperties:function (localProperties) {
+	dojo.widget.IpAddressTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.allowdotteddecimal) {
+		this.flags.allowDottedDecimal = (localProperties.allowdotteddecimal == &quot;true&quot;);
+	}
+	if (localProperties.allowdottedhex) {
+		this.flags.allowDottedHex = (localProperties.allowdottedhex == &quot;true&quot;);
+	}
+	if (localProperties.allowdottedoctal) {
+		this.flags.allowDottedOctal = (localProperties.allowdottedoctal == &quot;true&quot;);
+	}
+	if (localProperties.allowdecimal) {
+		this.flags.allowDecimal = (localProperties.allowdecimal == &quot;true&quot;);
+	}
+	if (localProperties.allowhex) {
+		this.flags.allowHex = (localProperties.allowhex == &quot;true&quot;);
+	}
+	if (localProperties.allowipv6) {
+		this.flags.allowIPv6 = (localProperties.allowipv6 == &quot;true&quot;);
+	}
+	if (localProperties.allowhybrid) {
+		this.flags.allowHybrid = (localProperties.allowhybrid == &quot;true&quot;);
+	}
+}, isValid:function () {
+	return dojo.validate.isIpAddress(this.textbox.value, this.flags);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.UrlTextbox&quot;, dojo.widget.IpAddressTextbox, {mixInProperties:function (localProperties) {
+	dojo.widget.UrlTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.scheme) {
+		this.flags.scheme = (localProperties.scheme == &quot;true&quot;);
+	}
+	if (localProperties.allowip) {
+		this.flags.allowIP = (localProperties.allowip == &quot;true&quot;);
+	}
+	if (localProperties.allowlocal) {
+		this.flags.allowLocal = (localProperties.allowlocal == &quot;true&quot;);
+	}
+	if (localProperties.allowcc) {
+		this.flags.allowCC = (localProperties.allowcc == &quot;true&quot;);
+	}
+	if (localProperties.allowgeneric) {
+		this.flags.allowGeneric = (localProperties.allowgeneric == &quot;true&quot;);
+	}
+}, isValid:function () {
+	return dojo.validate.isUrl(this.textbox.value, this.flags);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.EmailTextbox&quot;, dojo.widget.UrlTextbox, {mixInProperties:function (localProperties) {
+	dojo.widget.EmailTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.allowcruft) {
+		this.flags.allowCruft = (localProperties.allowcruft == &quot;true&quot;);
+	}
+}, isValid:function () {
+	return dojo.validate.isEmailAddress(this.textbox.value, this.flags);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.EmailListTextbox&quot;, dojo.widget.EmailTextbox, {mixInProperties:function (localProperties) {
+	dojo.widget.EmailListTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.listseparator) {
+		this.flags.listSeparator = localProperties.listseparator;
+	}
+}, isValid:function () {
+	return dojo.validate.isEmailAddressList(this.textbox.value, this.flags);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/LayoutContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/LayoutContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/LayoutContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,34 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.LayoutContainer&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.html.layout&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.LayoutContainer&quot;, dojo.widget.HtmlWidget, {isContainer:true, layoutChildPriority:&quot;top-bottom&quot;, postCreate:function () {
+	dojo.widget.html.layout(this.domNode, this.children, this.layoutChildPriority);
+}, addChild:function (child, overrideContainerNode, pos, ref, insertIndex) {
+	dojo.widget.LayoutContainer.superclass.addChild.call(this, child, overrideContainerNode, pos, ref, insertIndex);
+	dojo.widget.html.layout(this.domNode, this.children, this.layoutChildPriority);
+}, removeChild:function (pane) {
+	dojo.widget.LayoutContainer.superclass.removeChild.call(this, pane);
+	dojo.widget.html.layout(this.domNode, this.children, this.layoutChildPriority);
+}, onResized:function () {
+	dojo.widget.html.layout(this.domNode, this.children, this.layoutChildPriority);
+}, show:function () {
+	this.domNode.style.display = &quot;&quot;;
+	this.checkSize();
+	this.domNode.style.display = &quot;none&quot;;
+	this.domNode.style.visibility = &quot;&quot;;
+	dojo.widget.LayoutContainer.superclass.show.call(this);
+}});
+dojo.lang.extend(dojo.widget.Widget, {layoutAlign:&quot;none&quot;});
+

Added: tags/parley-0.55/root/static/magic/src/widget/LinkPane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/LinkPane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/LinkPane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.LinkPane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.LinkPane&quot;, dojo.widget.ContentPane, {templateString:&quot;&lt;div class=\&quot;dojoLinkPane\&quot;&gt;&lt;/div&gt;&quot;, fillInTemplate:function (args, frag) {
+	var source = this.getFragNodeRef(frag);
+	this.label += source.innerHTML;
+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Manager.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Manager.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Manager.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,288 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Manager&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.widget.manager = new function () {
+	this.widgets = [];
+	this.widgetIds = [];
+	this.topWidgets = {};
+	var widgetTypeCtr = {};
+	var renderPrefixCache = [];
+	this.getUniqueId = function (widgetType) {
+		var widgetId;
+		do {
+			widgetId = widgetType + &quot;_&quot; + (widgetTypeCtr[widgetType] != undefined ? ++widgetTypeCtr[widgetType] : widgetTypeCtr[widgetType] = 0);
+		} while (this.getWidgetById(widgetId));
+		return widgetId;
+	};
+	this.add = function (widget) {
+		this.widgets.push(widget);
+		if (!widget.extraArgs[&quot;id&quot;]) {
+			widget.extraArgs[&quot;id&quot;] = widget.extraArgs[&quot;ID&quot;];
+		}
+		if (widget.widgetId == &quot;&quot;) {
+			if (widget[&quot;id&quot;]) {
+				widget.widgetId = widget[&quot;id&quot;];
+			} else {
+				if (widget.extraArgs[&quot;id&quot;]) {
+					widget.widgetId = widget.extraArgs[&quot;id&quot;];
+				} else {
+					widget.widgetId = this.getUniqueId(widget.ns + &quot;_&quot; + widget.widgetType);
+				}
+			}
+		}
+		if (this.widgetIds[widget.widgetId]) {
+			dojo.debug(&quot;widget ID collision on ID: &quot; + widget.widgetId);
+		}
+		this.widgetIds[widget.widgetId] = widget;
+	};
+	this.destroyAll = function () {
+		for (var x = this.widgets.length - 1; x &gt;= 0; x--) {
+			try {
+				this.widgets[x].destroy(true);
+				delete this.widgets[x];
+			}
+			catch (e) {
+			}
+		}
+	};
+	this.remove = function (widgetIndex) {
+		if (dojo.lang.isNumber(widgetIndex)) {
+			var tw = this.widgets[widgetIndex].widgetId;
+			delete this.topWidgets[tw];
+			delete this.widgetIds[tw];
+			this.widgets.splice(widgetIndex, 1);
+		} else {
+			this.removeById(widgetIndex);
+		}
+	};
+	this.removeById = function (id) {
+		if (!dojo.lang.isString(id)) {
+			id = id[&quot;widgetId&quot;];
+			if (!id) {
+				dojo.debug(&quot;invalid widget or id passed to removeById&quot;);
+				return;
+			}
+		}
+		for (var i = 0; i &lt; this.widgets.length; i++) {
+			if (this.widgets[i].widgetId == id) {
+				this.remove(i);
+				break;
+			}
+		}
+	};
+	this.getWidgetById = function (id) {
+		if (dojo.lang.isString(id)) {
+			return this.widgetIds[id];
+		}
+		return id;
+	};
+	this.getWidgetsByType = function (type) {
+		var lt = type.toLowerCase();
+		var getType = (type.indexOf(&quot;:&quot;) &lt; 0 ? function (x) {
+			return x.widgetType.toLowerCase();
+		} : function (x) {
+			return x.getNamespacedType();
+		});
+		var ret = [];
+		dojo.lang.forEach(this.widgets, function (x) {
+			if (getType(x) == lt) {
+				ret.push(x);
+			}
+		});
+		return ret;
+	};
+	this.getWidgetsByFilter = function (unaryFunc, onlyOne) {
+		var ret = [];
+		dojo.lang.every(this.widgets, function (x) {
+			if (unaryFunc(x)) {
+				ret.push(x);
+				if (onlyOne) {
+					return false;
+				}
+			}
+			return true;
+		});
+		return (onlyOne ? ret[0] : ret);
+	};
+	this.getAllWidgets = function () {
+		return this.widgets.concat();
+	};
+	this.getWidgetByNode = function (node) {
+		var w = this.getAllWidgets();
+		node = dojo.byId(node);
+		for (var i = 0; i &lt; w.length; i++) {
+			if (w[i].domNode == node) {
+				return w[i];
+			}
+		}
+		return null;
+	};
+	this.byId = this.getWidgetById;
+	this.byType = this.getWidgetsByType;
+	this.byFilter = this.getWidgetsByFilter;
+	this.byNode = this.getWidgetByNode;
+	var knownWidgetImplementations = {};
+	var widgetPackages = [&quot;dojo.widget&quot;];
+	for (var i = 0; i &lt; widgetPackages.length; i++) {
+		widgetPackages[widgetPackages[i]] = true;
+	}
+	this.registerWidgetPackage = function (pname) {
+		if (!widgetPackages[pname]) {
+			widgetPackages[pname] = true;
+			widgetPackages.push(pname);
+		}
+	};
+	this.getWidgetPackageList = function () {
+		return dojo.lang.map(widgetPackages, function (elt) {
+			return (elt !== true ? elt : undefined);
+		});
+	};
+	this.getImplementation = function (widgetName, ctorObject, mixins, ns) {
+		var impl = this.getImplementationName(widgetName, ns);
+		if (impl) {
+			var ret = ctorObject ? new impl(ctorObject) : new impl();
+			return ret;
+		}
+	};
+	function buildPrefixCache() {
+		for (var renderer in dojo.render) {
+			if (dojo.render[renderer][&quot;capable&quot;] === true) {
+				var prefixes = dojo.render[renderer].prefixes;
+				for (var i = 0; i &lt; prefixes.length; i++) {
+					renderPrefixCache.push(prefixes[i].toLowerCase());
+				}
+			}
+		}
+	}
+	var findImplementationInModule = function (lowerCaseWidgetName, module) {
+		if (!module) {
+			return null;
+		}
+		for (var i = 0, l = renderPrefixCache.length, widgetModule; i &lt;= l; i++) {
+			widgetModule = (i &lt; l ? module[renderPrefixCache[i]] : module);
+			if (!widgetModule) {
+				continue;
+			}
+			for (var name in widgetModule) {
+				if (name.toLowerCase() == lowerCaseWidgetName) {
+					return widgetModule[name];
+				}
+			}
+		}
+		return null;
+	};
+	var findImplementation = function (lowerCaseWidgetName, moduleName) {
+		var module = dojo.evalObjPath(moduleName, false);
+		return (module ? findImplementationInModule(lowerCaseWidgetName, module) : null);
+	};
+	this.getImplementationName = function (widgetName, ns) {
+		var lowerCaseWidgetName = widgetName.toLowerCase();
+		ns = ns || &quot;dojo&quot;;
+		var imps = knownWidgetImplementations[ns] || (knownWidgetImplementations[ns] = {});
+		var impl = imps[lowerCaseWidgetName];
+		if (impl) {
+			return impl;
+		}
+		if (!renderPrefixCache.length) {
+			buildPrefixCache();
+		}
+		var nsObj = dojo.ns.get(ns);
+		if (!nsObj) {
+			dojo.ns.register(ns, ns + &quot;.widget&quot;);
+			nsObj = dojo.ns.get(ns);
+		}
+		if (nsObj) {
+			nsObj.resolve(widgetName);
+		}
+		impl = findImplementation(lowerCaseWidgetName, nsObj.module);
+		if (impl) {
+			return (imps[lowerCaseWidgetName] = impl);
+		}
+		nsObj = dojo.ns.require(ns);
+		if ((nsObj) &amp;&amp; (nsObj.resolver)) {
+			nsObj.resolve(widgetName);
+			impl = findImplementation(lowerCaseWidgetName, nsObj.module);
+			if (impl) {
+				return (imps[lowerCaseWidgetName] = impl);
+			}
+		}
+		dojo.deprecated(&quot;dojo.widget.Manager.getImplementationName&quot;, &quot;Could not locate widget implementation for \&quot;&quot; + widgetName + &quot;\&quot; in \&quot;&quot; + nsObj.module + &quot;\&quot; registered to namespace \&quot;&quot; + nsObj.name + &quot;\&quot;. &quot; + &quot;Developers must specify correct namespaces for all non-Dojo widgets&quot;, &quot;0.5&quot;);
+		for (var i = 0; i &lt; widgetPackages.length; i++) {
+			impl = findImplementation(lowerCaseWidgetName, widgetPackages[i]);
+			if (impl) {
+				return (imps[lowerCaseWidgetName] = impl);
+			}
+		}
+		throw new Error(&quot;Could not locate widget implementation for \&quot;&quot; + widgetName + &quot;\&quot; in \&quot;&quot; + nsObj.module + &quot;\&quot; registered to namespace \&quot;&quot; + nsObj.name + &quot;\&quot;&quot;);
+	};
+	this.resizing = false;
+	this.onWindowResized = function () {
+		if (this.resizing) {
+			return;
+		}
+		try {
+			this.resizing = true;
+			for (var id in this.topWidgets) {
+				var child = this.topWidgets[id];
+				if (child.checkSize) {
+					child.checkSize();
+				}
+			}
+		}
+		catch (e) {
+		}
+		finally {
+			this.resizing = false;
+		}
+	};
+	if (typeof window != &quot;undefined&quot;) {
+		dojo.addOnLoad(this, &quot;onWindowResized&quot;);
+		dojo.event.connect(window, &quot;onresize&quot;, this, &quot;onWindowResized&quot;);
+	}
+};
+(function () {
+	var dw = dojo.widget;
+	var dwm = dw.manager;
+	var h = dojo.lang.curry(dojo.lang, &quot;hitch&quot;, dwm);
+	var g = function (oldName, newName) {
+		dw[(newName || oldName)] = h(oldName);
+	};
+	g(&quot;add&quot;, &quot;addWidget&quot;);
+	g(&quot;destroyAll&quot;, &quot;destroyAllWidgets&quot;);
+	g(&quot;remove&quot;, &quot;removeWidget&quot;);
+	g(&quot;removeById&quot;, &quot;removeWidgetById&quot;);
+	g(&quot;getWidgetById&quot;);
+	g(&quot;getWidgetById&quot;, &quot;byId&quot;);
+	g(&quot;getWidgetsByType&quot;);
+	g(&quot;getWidgetsByFilter&quot;);
+	g(&quot;getWidgetsByType&quot;, &quot;byType&quot;);
+	g(&quot;getWidgetsByFilter&quot;, &quot;byFilter&quot;);
+	g(&quot;getWidgetByNode&quot;, &quot;byNode&quot;);
+	dw.all = function (n) {
+		var widgets = dwm.getAllWidgets.apply(dwm, arguments);
+		if (arguments.length &gt; 0) {
+			return widgets[n];
+		}
+		return widgets;
+	};
+	g(&quot;registerWidgetPackage&quot;);
+	g(&quot;getImplementation&quot;, &quot;getWidgetImplementation&quot;);
+	g(&quot;getImplementationName&quot;, &quot;getWidgetImplementationName&quot;);
+	dw.widgets = dwm.widgets;
+	dw.widgetIds = dwm.widgetIds;
+	dw.root = dwm.root;
+})();
+

Added: tags/parley-0.55/root/static/magic/src/widget/Menu2.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Menu2.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Menu2.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,455 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Menu2&quot;);
+dojo.require(&quot;dojo.widget.PopupContainer&quot;);
+dojo.declare(&quot;dojo.widget.MenuBase&quot;, null, function () {
+	this.eventNames = {open:&quot;&quot;};
+}, {isContainer:true, isMenu:true, eventNaming:&quot;default&quot;, templateCssString:&quot;\n.dojoPopupMenu2 {\n\tposition: absolute;\n\tborder: 1px solid #7298d0;\n\tbackground:#85aeec url(images/soriaMenuBg.gif) repeat-x bottom left !important;\n\tpadding: 1px;\n\tmargin-top: 1px;\n\tmargin-bottom: 1px;\n}\n\n.dojoMenuItem2{\n\twhite-space: nowrap;\n\tfont: menu;\n\tmargin: 0;\n}\n\n.dojoMenuItem2Hover {\n\tbackground-color: #D2E4FD;\n\tcursor:pointer;\n\tcursor:hand;\n}\n\n.dojoMenuItem2Icon {\n\tposition: relative;\n\tbackground-position: center center;\n\tbackground-repeat: no-repeat;\n\twidth: 16px;\n\theight: 16px;\n\tpadding-right: 3px;\n}\n\n.dojoMenuItem2Label {\n\tposition: relative;\n\tvertical-align: middle;\n}\n\n/* main label text */\n.dojoMenuItem2Label {\n\tposition: relative;\n\tvertical-align: middle;\n}\n\n.dojoMenuItem2Accel {\n\tposition: relative;\n\tvertical-align: middle;\n\tpadding-left: 3px;\n}\n\n.dojoMenuItem2Disabled .dojoMenuItem2Label,\n.dojoMenuItem2Disab!
 led .dojoMenuItem2Accel {\n\tcolor: #607a9e;\n}\n\n.dojoMenuItem2Submenu {\n\tposition: relative;\n\tbackground-position: center center;\n\tbackground-repeat: no-repeat;\n\tbackground-image: url(images/submenu_off.gif);\n\twidth: 5px;\n\theight: 9px;\n\tpadding-left: 3px;\n}\n.dojoMenuItem2Hover .dojoMenuItem2Submenu {\n\tbackground-image: url(images/submenu_on.gif);\n}\n\n.dojoMenuItem2Disabled .dojoMenuItem2Submenu {\n\tbackground-image: url(images/submenu_disabled.gif);\n}\n\n.dojoMenuSeparator2 {\n\tfont-size: 1px;\n\tmargin: 0;\n}\n\n.dojoMenuSeparator2Top {\n\theight: 50%;\n\tborder-bottom: 1px solid #7a98c4;\n\tmargin: 0px 2px;\n\tfont-size: 1px;\n}\n\n.dojoMenuSeparator2Bottom {\n\theight: 50%;\n\tborder-top: 1px solid #c9deff;\n\tmargin: 0px 2px;\n\tfont-size: 1px;\n}\n\n.dojoMenuBar2 {\n\tbackground:#85aeec url(images/soriaBarBg.gif) repeat-x top left;\n\t/*border-bottom:1px solid #6b9fec;*/\n\tpadding: 1px;\n}\n\n.dojoMenuBar2 .dojoMenuItem2 {\n\twhite-space: now!
 rap;\n\tfont: menu;\n\tmargin: 0;\n\tposition: relative;\n\tve!
 rtical-a
lign: middle;\n\tz-index: 1;\n\tpadding: 3px 8px;\n\tdisplay: inline;/* needed in khtml to display correctly */\n\tdisplay: -moz-inline-box;/* needed in firefox */\n\tcursor:pointer;\n\tcursor:hand;\n}\n\n.dojoMenuBar2 .dojoMenuItem2Hover {\n\tbackground-color:#d2e4fd;\n}\n\n.dojoMenuBar2 .dojoMenuItem2Disabled span {\n\tcolor: #4f6582;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Menu2.css&quot;), submenuDelay:500, initialize:function (args, frag) {
+	if (this.eventNaming == &quot;default&quot;) {
+		for (var eventName in this.eventNames) {
+			this.eventNames[eventName] = this.widgetId + &quot;/&quot; + eventName;
+		}
+	}
+}, _moveToNext:function (evt) {
+	this._highlightOption(1);
+	return true;
+}, _moveToPrevious:function (evt) {
+	this._highlightOption(-1);
+	return true;
+}, _moveToParentMenu:function (evt) {
+	if (this._highlighted_option &amp;&amp; this.parentMenu) {
+		if (evt._menu2UpKeyProcessed) {
+			return true;
+		} else {
+			this._highlighted_option.onUnhover();
+			this.closeSubmenu();
+			evt._menu2UpKeyProcessed = true;
+		}
+	}
+	return false;
+}, _moveToChildMenu:function (evt) {
+	if (this._highlighted_option &amp;&amp; this._highlighted_option.submenuId) {
+		this._highlighted_option._onClick(true);
+		return true;
+	}
+	return false;
+}, _selectCurrentItem:function (evt) {
+	if (this._highlighted_option) {
+		this._highlighted_option._onClick();
+		return true;
+	}
+	return false;
+}, processKey:function (evt) {
+	if (evt.ctrlKey || evt.altKey || !evt.key) {
+		return false;
+	}
+	var rval = false;
+	switch (evt.key) {
+	  case evt.KEY_DOWN_ARROW:
+		rval = this._moveToNext(evt);
+		break;
+	  case evt.KEY_UP_ARROW:
+		rval = this._moveToPrevious(evt);
+		break;
+	  case evt.KEY_RIGHT_ARROW:
+		rval = this._moveToChildMenu(evt);
+		break;
+	  case evt.KEY_LEFT_ARROW:
+		rval = this._moveToParentMenu(evt);
+		break;
+	  case &quot; &quot;:
+	  case evt.KEY_ENTER:
+		if (rval = this._selectCurrentItem(evt)) {
+			break;
+		}
+	  case evt.KEY_ESCAPE:
+	  case evt.KEY_TAB:
+		this.close(true);
+		rval = true;
+		break;
+	}
+	return rval;
+}, _findValidItem:function (dir, curItem) {
+	if (curItem) {
+		curItem = dir &gt; 0 ? curItem.getNextSibling() : curItem.getPreviousSibling();
+	}
+	for (var i = 0; i &lt; this.children.length; ++i) {
+		if (!curItem) {
+			curItem = dir &gt; 0 ? this.children[0] : this.children[this.children.length - 1];
+		}
+		if (curItem.onHover &amp;&amp; curItem.isShowing()) {
+			return curItem;
+		}
+		curItem = dir &gt; 0 ? curItem.getNextSibling() : curItem.getPreviousSibling();
+	}
+}, _highlightOption:function (dir) {
+	var item;
+	if ((!this._highlighted_option)) {
+		item = this._findValidItem(dir);
+	} else {
+		item = this._findValidItem(dir, this._highlighted_option);
+	}
+	if (item) {
+		if (this._highlighted_option) {
+			this._highlighted_option.onUnhover();
+		}
+		item.onHover();
+		dojo.html.scrollIntoView(item.domNode);
+		try {
+			var node = dojo.html.getElementsByClass(&quot;dojoMenuItem2Label&quot;, item.domNode)[0];
+			node.focus();
+		}
+		catch (e) {
+		}
+	}
+}, onItemClick:function (item) {
+}, closeSubmenu:function (force) {
+	if (this.currentSubmenu == null) {
+		return;
+	}
+	this.currentSubmenu.close(force);
+	this.currentSubmenu = null;
+	this.currentSubmenuTrigger.is_open = false;
+	this.currentSubmenuTrigger._closedSubmenu(force);
+	this.currentSubmenuTrigger = null;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.PopupMenu2&quot;, [dojo.widget.HtmlWidget, dojo.widget.PopupContainerBase, dojo.widget.MenuBase], function () {
+	this.targetNodeIds = [];
+}, {templateString:&quot;&lt;table class=\&quot;dojoPopupMenu2\&quot; border=0 cellspacing=0 cellpadding=0 style=\&quot;display: none; position: absolute;\&quot;&gt;&quot; + &quot;&lt;tbody dojoAttachPoint=\&quot;containerNode\&quot;&gt;&lt;/tbody&gt;&quot; + &quot;&lt;/table&gt;&quot;, submenuOverlap:5, contextMenuForWindow:false, parentMenu:null, postCreate:function () {
+	if (this.contextMenuForWindow) {
+		var doc = dojo.body();
+		this.bindDomNode(doc);
+	} else {
+		if (this.targetNodeIds.length &gt; 0) {
+			dojo.lang.forEach(this.targetNodeIds, this.bindDomNode, this);
+		}
+	}
+	this._subscribeSubitemsOnOpen();
+}, _subscribeSubitemsOnOpen:function () {
+	var subItems = this.getChildrenOfType(dojo.widget.MenuItem2);
+	for (var i = 0; i &lt; subItems.length; i++) {
+		dojo.event.topic.subscribe(this.eventNames.open, subItems[i], &quot;menuOpen&quot;);
+	}
+}, getTopOpenEvent:function () {
+	var menu = this;
+	while (menu.parentMenu) {
+		menu = menu.parentMenu;
+	}
+	return menu.openEvent;
+}, bindDomNode:function (node) {
+	node = dojo.byId(node);
+	var win = dojo.html.getElementWindow(node);
+	if (dojo.html.isTag(node, &quot;iframe&quot;) == &quot;iframe&quot;) {
+		win = dojo.html.iframeContentWindow(node);
+		node = dojo.withGlobal(win, dojo.body);
+	}
+	dojo.widget.Menu2.OperaAndKonqFixer.fixNode(node);
+	dojo.event.kwConnect({srcObj:node, srcFunc:&quot;oncontextmenu&quot;, targetObj:this, targetFunc:&quot;onOpen&quot;, once:true});
+	if (dojo.render.html.moz &amp;&amp; win.document.designMode.toLowerCase() == &quot;on&quot;) {
+		dojo.event.browser.addListener(node, &quot;contextmenu&quot;, dojo.lang.hitch(this, &quot;onOpen&quot;));
+	}
+	dojo.widget.PopupManager.registerWin(win);
+}, unBindDomNode:function (nodeName) {
+	var node = dojo.byId(nodeName);
+	dojo.event.kwDisconnect({srcObj:node, srcFunc:&quot;oncontextmenu&quot;, targetObj:this, targetFunc:&quot;onOpen&quot;, once:true});
+	dojo.widget.Menu2.OperaAndKonqFixer.cleanNode(node);
+}, _openAsSubmenu:function (parent, explodeSrc, orient) {
+	if (this.isShowingNow) {
+		return;
+	}
+	this.parentMenu = parent;
+	this.open(explodeSrc, parent, explodeSrc, orient);
+}, close:function (force) {
+	if (this.animationInProgress) {
+		dojo.widget.PopupContainerBase.prototype.close.call(this, force);
+		return;
+	}
+	if (this._highlighted_option) {
+		this._highlighted_option.onUnhover();
+	}
+	dojo.widget.PopupContainerBase.prototype.close.call(this, force);
+	this.parentMenu = null;
+}, closeAll:function (force) {
+	if (this.parentMenu) {
+		this.parentMenu.closeAll(force);
+	} else {
+		this.close(force);
+	}
+}, _openSubmenu:function (submenu, from_item) {
+	submenu._openAsSubmenu(this, from_item.arrow, {&quot;TR&quot;:&quot;TL&quot;, &quot;TL&quot;:&quot;TR&quot;});
+	this.currentSubmenu = submenu;
+	this.currentSubmenuTrigger = from_item;
+	this.currentSubmenuTrigger.is_open = true;
+}, focus:function () {
+	if (this.currentSubmenuTrigger) {
+		if (this.currentSubmenuTrigger.caption) {
+			try {
+				this.currentSubmenuTrigger.caption.focus();
+			}
+			catch (e) {
+			}
+		} else {
+			try {
+				this.currentSubmenuTrigger.domNode.focus();
+			}
+			catch (e) {
+			}
+		}
+	}
+}, onOpen:function (e) {
+	this.openEvent = e;
+	if (e[&quot;target&quot;]) {
+		this.openedForWindow = dojo.html.getElementWindow(e.target);
+	} else {
+		this.openedForWindow = null;
+	}
+	var x = e.pageX, y = e.pageY;
+	var win = dojo.html.getElementWindow(e.target);
+	var iframe = win._frameElement || win.frameElement;
+	if (iframe) {
+		var cood = dojo.html.abs(iframe, true);
+		x += cood.x - dojo.withGlobal(win, dojo.html.getScroll).left;
+		y += cood.y - dojo.withGlobal(win, dojo.html.getScroll).top;
+	}
+	this.open(x, y, null, [x, y]);
+	dojo.event.browser.stopEvent(e);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.MenuItem2&quot;, dojo.widget.HtmlWidget, function () {
+	this.eventNames = {engage:&quot;&quot;};
+}, {templateString:&quot;&lt;tr class=\&quot;dojoMenuItem2\&quot; dojoAttachEvent=\&quot;onMouseOver: onHover; onMouseOut: onUnhover; onClick: _onClick; onKey:onKey;\&quot;&gt;&quot; + &quot;&lt;td&gt;&lt;div class=\&quot;${this.iconClass}\&quot; style=\&quot;${this.iconStyle}\&quot;&gt;&lt;/div&gt;&lt;/td&gt;&quot; + &quot;&lt;td tabIndex=\&quot;-1\&quot; class=\&quot;dojoMenuItem2Label\&quot; dojoAttachPoint=\&quot;caption\&quot;&gt;${this.caption}&lt;/td&gt;&quot; + &quot;&lt;td class=\&quot;dojoMenuItem2Accel\&quot;&gt;${this.accelKey}&lt;/td&gt;&quot; + &quot;&lt;td&gt;&lt;div class=\&quot;dojoMenuItem2Submenu\&quot; style=\&quot;display:${this.arrowDisplay};\&quot; dojoAttachPoint=\&quot;arrow\&quot;&gt;&lt;/div&gt;&lt;/td&gt;&quot; + &quot;&lt;/tr&gt;&quot;, is_hovering:false, hover_timer:null, is_open:false, topPosition:0, caption:&quot;Untitled&quot;, accelKey:&quot;&quot;, iconSrc:&quot;&quot;, disabledClass:&quot;dojoMenuItem2Disabled&quot;, iconClass:&quot;dojoMenuItem2Icon&quot;, submenuId:&quot;&quot;, eventNaming:&quot;default&quot;, highlightClass:&quot;dojoMenuItem2Hover&quot;, postMixInProperties:function () {
+	this.iconStyle = &quot;&quot;;
+	if (this.iconSrc) {
+		if ((this.iconSrc.toLowerCase().substring(this.iconSrc.length - 4) == &quot;.png&quot;) &amp;&amp; (dojo.render.html.ie55 || dojo.render.html.ie60)) {
+			this.iconStyle = &quot;filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src='&quot; + this.iconSrc + &quot;', sizingMethod='image')&quot;;
+		} else {
+			this.iconStyle = &quot;background-image: url(&quot; + this.iconSrc + &quot;)&quot;;
+		}
+	}
+	this.arrowDisplay = this.submenuId ? &quot;block&quot; : &quot;none&quot;;
+	dojo.widget.MenuItem2.superclass.postMixInProperties.apply(this, arguments);
+}, fillInTemplate:function () {
+	dojo.html.disableSelection(this.domNode);
+	if (this.disabled) {
+		this.setDisabled(true);
+	}
+	if (this.eventNaming == &quot;default&quot;) {
+		for (var eventName in this.eventNames) {
+			this.eventNames[eventName] = this.widgetId + &quot;/&quot; + eventName;
+		}
+	}
+}, onHover:function () {
+	this.onUnhover();
+	if (this.is_hovering) {
+		return;
+	}
+	if (this.is_open) {
+		return;
+	}
+	if (this.parent._highlighted_option) {
+		this.parent._highlighted_option.onUnhover();
+	}
+	this.parent.closeSubmenu();
+	this.parent._highlighted_option = this;
+	dojo.widget.PopupManager.setFocusedMenu(this.parent);
+	this._highlightItem();
+	if (this.is_hovering) {
+		this._stopSubmenuTimer();
+	}
+	this.is_hovering = true;
+	this._startSubmenuTimer();
+}, onUnhover:function () {
+	if (!this.is_open) {
+		this._unhighlightItem();
+	}
+	this.is_hovering = false;
+	this.parent._highlighted_option = null;
+	if (this.parent.parentMenu) {
+		dojo.widget.PopupManager.setFocusedMenu(this.parent.parentMenu);
+	}
+	this._stopSubmenuTimer();
+}, _onClick:function (focus) {
+	var displayingSubMenu = false;
+	if (this.disabled) {
+		return false;
+	}
+	if (this.submenuId) {
+		if (!this.is_open) {
+			this._stopSubmenuTimer();
+			this._openSubmenu();
+		}
+		displayingSubMenu = true;
+	} else {
+		this.onUnhover();
+		this.parent.closeAll(true);
+	}
+	this.onClick();
+	dojo.event.topic.publish(this.eventNames.engage, this);
+	if (displayingSubMenu &amp;&amp; focus) {
+		dojo.widget.getWidgetById(this.submenuId)._highlightOption(1);
+	}
+	return;
+}, onClick:function () {
+	this.parent.onItemClick(this);
+}, _highlightItem:function () {
+	dojo.html.addClass(this.domNode, this.highlightClass);
+}, _unhighlightItem:function () {
+	dojo.html.removeClass(this.domNode, this.highlightClass);
+}, _startSubmenuTimer:function () {
+	this._stopSubmenuTimer();
+	if (this.disabled) {
+		return;
+	}
+	var self = this;
+	var closure = function () {
+		return function () {
+			self._openSubmenu();
+		};
+	}();
+	this.hover_timer = dojo.lang.setTimeout(closure, this.parent.submenuDelay);
+}, _stopSubmenuTimer:function () {
+	if (this.hover_timer) {
+		dojo.lang.clearTimeout(this.hover_timer);
+		this.hover_timer = null;
+	}
+}, _openSubmenu:function () {
+	if (this.disabled) {
+		return;
+	}
+	this.parent.closeSubmenu();
+	var submenu = dojo.widget.getWidgetById(this.submenuId);
+	if (submenu) {
+		this.parent._openSubmenu(submenu, this);
+	}
+}, _closedSubmenu:function () {
+	this.onUnhover();
+}, setDisabled:function (value) {
+	this.disabled = value;
+	if (this.disabled) {
+		dojo.html.addClass(this.domNode, this.disabledClass);
+	} else {
+		dojo.html.removeClass(this.domNode, this.disabledClass);
+	}
+}, enable:function () {
+	this.setDisabled(false);
+}, disable:function () {
+	this.setDisabled(true);
+}, menuOpen:function (message) {
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.MenuSeparator2&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;tr class=\&quot;dojoMenuSeparator2\&quot;&gt;&lt;td colspan=4&gt;&quot; + &quot;&lt;div class=\&quot;dojoMenuSeparator2Top\&quot;&gt;&lt;/div&gt;&quot; + &quot;&lt;div class=\&quot;dojoMenuSeparator2Bottom\&quot;&gt;&lt;/div&gt;&quot; + &quot;&lt;/td&gt;&lt;/tr&gt;&quot;, postCreate:function () {
+	dojo.html.disableSelection(this.domNode);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.MenuBar2&quot;, [dojo.widget.HtmlWidget, dojo.widget.MenuBase], {menuOverlap:2, templateString:&quot;&lt;div class=\&quot;dojoMenuBar2\&quot; dojoAttachPoint=\&quot;containerNode\&quot; tabIndex=\&quot;0\&quot;&gt;&lt;/div&gt;&quot;, close:function (force) {
+	if (this._highlighted_option) {
+		this._highlighted_option.onUnhover();
+	}
+	this.closeSubmenu(force);
+}, closeAll:function (force) {
+	this.close(force);
+}, processKey:function (evt) {
+	if (evt.ctrlKey || evt.altKey) {
+		return false;
+	}
+	var rval = false;
+	switch (evt.key) {
+	  case evt.KEY_DOWN_ARROW:
+		rval = this._moveToChildMenu(evt);
+		break;
+	  case evt.KEY_UP_ARROW:
+		rval = this._moveToParentMenu(evt);
+		break;
+	  case evt.KEY_RIGHT_ARROW:
+		rval = this._moveToNext(evt);
+		break;
+	  case evt.KEY_LEFT_ARROW:
+		rval = this._moveToPrevious(evt);
+		break;
+	  default:
+		rval = dojo.widget.MenuBar2.superclass.processKey.apply(this, arguments);
+		break;
+	}
+	return rval;
+}, postCreate:function () {
+	dojo.widget.MenuBar2.superclass.postCreate.apply(this, arguments);
+	this.isShowingNow = true;
+}, _openSubmenu:function (submenu, from_item) {
+	submenu._openAsSubmenu(this, from_item.domNode, {&quot;BL&quot;:&quot;TL&quot;, &quot;TL&quot;:&quot;BL&quot;});
+	this.currentSubmenu = submenu;
+	this.currentSubmenuTrigger = from_item;
+	this.currentSubmenuTrigger.is_open = true;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.MenuBarItem2&quot;, dojo.widget.MenuItem2, {templateString:&quot;&lt;span class=\&quot;dojoMenuItem2\&quot; dojoAttachEvent=\&quot;onMouseOver: onHover; onMouseOut: onUnhover; onClick: _onClick;\&quot;&gt;${this.caption}&lt;/span&gt;&quot;});
+dojo.widget.Menu2.OperaAndKonqFixer = new function () {
+	var implement = true;
+	var delfunc = false;
+	if (!dojo.lang.isFunction(dojo.doc().oncontextmenu)) {
+		dojo.doc().oncontextmenu = function () {
+			implement = false;
+			delfunc = true;
+		};
+	}
+	if (dojo.doc().createEvent) {
+		try {
+			var e = dojo.doc().createEvent(&quot;MouseEvents&quot;);
+			e.initMouseEvent(&quot;contextmenu&quot;, 1, 1, dojo.global(), 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, null);
+			dojo.doc().dispatchEvent(e);
+		}
+		catch (e) {
+		}
+	} else {
+		implement = false;
+	}
+	if (delfunc) {
+		delete dojo.doc().oncontextmenu;
+	}
+	this.fixNode = function (node) {
+		if (implement) {
+			if (!dojo.lang.isFunction(node.oncontextmenu)) {
+				node.oncontextmenu = function (e) {
+				};
+			}
+			if (dojo.render.html.opera) {
+				node._menufixer_opera = function (e) {
+					if (e.ctrlKey) {
+						this.oncontextmenu(e);
+					}
+				};
+				dojo.event.connect(node, &quot;onclick&quot;, node, &quot;_menufixer_opera&quot;);
+			} else {
+				node._menufixer_konq = function (e) {
+					if (e.button == 2) {
+						e.preventDefault();
+						this.oncontextmenu(e);
+					}
+				};
+				dojo.event.connect(node, &quot;onmousedown&quot;, node, &quot;_menufixer_konq&quot;);
+			}
+		}
+	};
+	this.cleanNode = function (node) {
+		if (implement) {
+			if (node._menufixer_opera) {
+				dojo.event.disconnect(node, &quot;onclick&quot;, node, &quot;_menufixer_opera&quot;);
+				delete node._menufixer_opera;
+			} else {
+				if (node._menufixer_konq) {
+					dojo.event.disconnect(node, &quot;onmousedown&quot;, node, &quot;_menufixer_konq&quot;);
+					delete node._menufixer_konq;
+				}
+			}
+			if (node.oncontextmenu) {
+				delete node.oncontextmenu;
+			}
+		}
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/MonthlyCalendar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/MonthlyCalendar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/MonthlyCalendar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,149 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.MonthlyCalendar&quot;);
+dojo.require(&quot;dojo.date.common&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.DatePicker&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.widget.MonthlyCalendar&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.MonthlyCalendar&quot;, dojo.widget.DatePicker, {dayWidth:&quot;wide&quot;, templateString:&quot;&lt;div class=\&quot;datePickerContainer\&quot; dojoAttachPoint=\&quot;datePickerContainerNode\&quot;&gt;\n\t&lt;h3 class=\&quot;monthLabel\&quot;&gt;\n\t&lt;!--\n\t&lt;span \n\t\tdojoAttachPoint=\&quot;decreaseWeekNode\&quot; \n\t\tdojoAttachEvent=\&quot;onClick: onIncrementWeek;\&quot; \n\t\tclass=\&quot;incrementControl\&quot;&gt;\n\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/decrementWeek.gif\&quot; alt=\&quot;&uarr;\&quot; /&gt;\n\t&lt;/span&gt;\n\t--&gt;\n\t&lt;span \n\t\tdojoAttachPoint=\&quot;decreaseMonthNode\&quot; \n\t\tdojoAttachEvent=\&quot;onClick: onIncrementMonth;\&quot; class=\&quot;incrementControl\&quot;&gt;\n\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/decrementMonth.gif\&quot; \n\t\t\talt=\&quot;&uarr;\&quot; dojoAttachPoint=\&quot;decrementMonthImageNode\&quot;&gt;\n\t&lt;/span&gt;\n\t&lt;span dojoAttachPoint=\&quot;monthLabelNode\&quot; class=\&quot;month\&quot;&gt;July&lt;/span&gt;\n\t&lt;span \n\t\tdojoAttachPoint=\&quot;increaseMonthNode\&quot; \n\t\tdojoAttachEvent=\&quot;onClick: onIncrementMonth;\&quot; class=\&quot;incrementControl\&quot;&gt;\n\t\t&lt;img src=\&quot;${dojoWidge!
 tModuleUri}templates/incrementMonth.gif\&quot; \n\t\t\talt=\&quot;&darr;\&quot;  dojoAttachPoint=\&quot;incrementMonthImageNode\&quot;&gt;\n\t&lt;/span&gt;\n\t&lt;!--\n\t\t&lt;span dojoAttachPoint=\&quot;increaseWeekNode\&quot; \n\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementWeek;\&quot; \n\t\t\tclass=\&quot;incrementControl\&quot;&gt;\n\t\t\t&lt;img src=\&quot;${dojoWidgetModuleUri}templates/incrementWeek.gif\&quot; \n\t\t\talt=\&quot;&darr;\&quot; /&gt;\n\t\t&lt;/span&gt;\n\t--&gt;\n\t&lt;/h3&gt;\n\t&lt;table class=\&quot;calendarContainer\&quot;&gt;\n\t\t&lt;thead&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;dayLabelsRow\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/thead&gt;\n\t\t&lt;tbody dojoAttachPoint=\&quot;calendarDatesContainerNode\&quot; \n\t\t\tdojoAttachEvent=\&quot;onClick: onSetDate;\&quot;&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarRow0\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarRo!
 w1\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;!
 \n\t\t\t
\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarRow2\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarRow3\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarRow4\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;calendarRow5\&quot;&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t\t&lt;td&gt;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t&lt;/table&gt;\n\t&lt;h3 class=\&quot;yearLabel\&quot;&gt;\n\t\t&lt;span dojoAttachPoint=\&quot;previousYearLabelNode\&quot;\n\t\t\tdojoAttachEvent=\&quot;onClick: on!
 IncrementYear;\&quot; class=\&quot;previousYear\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span class=\&quot;selectedYear\&quot; dojoAttachPoint=\&quot;currentYearLabelNode\&quot;&gt;&lt;/span&gt;\n\t\t&lt;span dojoAttachPoint=\&quot;nextYearLabelNode\&quot; \n\t\t\tdojoAttachEvent=\&quot;onClick: onIncrementYear;\&quot; class=\&quot;nextYear\&quot;&gt;&lt;/span&gt;\n\t&lt;/h3&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.datePickerContainer {\n\tmargin:0.5em 2em 0.5em 0;\n\t/*width:10em;*/\n\tfloat:left;\n}\n\n.previousMonth {\n\tbackground-color:#bbbbbb;\n}\n\n.currentMonth {\n\tbackground-color:#8f8f8f;\n}\n\n.nextMonth {\n\tbackground-color:#eeeeee;\n}\n\n.currentDate {\n\ttext-decoration:underline;\n\tfont-style:italic;\n}\n\n.selectedItem {\n\tbackground-color:#3a3a3a;\n\tcolor:#ffffff;\n}\n\n.calendarContainer {\n\tborder-collapse:collapse;\n\tborder-spacing:0;\n\tborder-bottom:1px solid #e6e6e6;\n\toverflow: hidden;\n\ttext-align: right;\n}\n\n.calendarContainer thead{\n\tborder-bottom:1px solid #e6e6e6;\n}\n\n.calendarContainer tbody * td {\n		height: 100px;\n		border: 1px solid gray;\n!
 }\n\n.calendarContainer td {\n		width: 100px;\n		padding: 2px;!
 \n\tvert
ical-align: top;\n}\n\n.monthLabel {\n\tfont-size:0.9em;\n\tfont-weight:400;\n\tmargin:0;\n\ttext-align:center;\n}\n\n.monthLabel .month {\n\tpadding:0 0.4em 0 0.4em;\n}\n\n.yearLabel {\n\tfont-size:0.9em;\n\tfont-weight:400;\n\tmargin:0.25em 0 0 0;\n\ttext-align:right;\n\tcolor:#a3a3a3;\n}\n\n.yearLabel .selectedYear {\n\tcolor:#000;\n\tpadding:0 0.2em;\n}\n\n.nextYear, .previousYear {\n\tcursor:pointer;cursor:hand;\n}\n\n.incrementControl {\n\tcursor:pointer;cursor:hand;\n\twidth:1em;\n}\n\n.dojoMonthlyCalendarEvent {\n\tfont-size:0.7em;\n\toverflow: hidden;\n\tfont-color: grey;\n\twhite-space: nowrap;\n\ttext-align: left;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/MonthlyCalendar.css&quot;), initializer:function () {
+	this.iCalendars = [];
+}, addCalendar:function (cal) {
+	dojo.debug(&quot;Adding Calendar&quot;);
+	this.iCalendars.push(cal);
+	dojo.debug(&quot;Starting init&quot;);
+	this.initUI();
+	dojo.debug(&quot;done init&quot;);
+}, createDayContents:function (node, mydate) {
+	dojo.html.removeChildren(node);
+	node.appendChild(document.createTextNode(mydate.getDate()));
+	for (var x = 0; x &lt; this.iCalendars.length; x++) {
+		var evts = this.iCalendars[x].getEvents(mydate);
+		if ((dojo.lang.isArray(evts)) &amp;&amp; (evts.length &gt; 0)) {
+			for (var y = 0; y &lt; evts.length; y++) {
+				var el = document.createElement(&quot;div&quot;);
+				dojo.html.addClass(el, &quot;dojoMonthlyCalendarEvent&quot;);
+				el.appendChild(document.createTextNode(evts[y].summary.value));
+				el.width = dojo.html.getContentBox(node).width;
+				node.appendChild(el);
+			}
+		}
+	}
+}, initUI:function () {
+	var dayLabels = dojo.date.getNames(&quot;days&quot;, this.dayWidth, &quot;standAlone&quot;, this.lang);
+	var dayLabelNodes = this.dayLabelsRow.getElementsByTagName(&quot;td&quot;);
+	for (var i = 0; i &lt; 7; i++) {
+		dayLabelNodes.item(i).innerHTML = dayLabels[i];
+	}
+	this.selectedIsUsed = false;
+	this.currentIsUsed = false;
+	var currentClassName = &quot;&quot;;
+	var previousDate = new Date();
+	var calendarNodes = this.calendarDatesContainerNode.getElementsByTagName(&quot;td&quot;);
+	var currentCalendarNode;
+	previousDate.setHours(8);
+	var nextDate = new Date(this.firstSaturday.year, this.firstSaturday.month, this.firstSaturday.date, 8);
+	var lastDay = new Date(this.firstSaturday.year, this.firstSaturday.month, this.firstSaturday.date + 42, 8);
+	if (this.iCalendars.length &gt; 0) {
+		for (var x = 0; x &lt; this.iCalendars.length; x++) {
+			this.iCalendars[x].preComputeRecurringEvents(lastDay);
+		}
+	}
+	if (this.firstSaturday.date &lt; 7) {
+		var dayInWeek = 6;
+		for (var i = this.firstSaturday.date; i &gt; 0; i--) {
+			currentCalendarNode = calendarNodes.item(dayInWeek);
+			this.createDayContents(currentCalendarNode, nextDate);
+			dojo.html.setClass(currentCalendarNode, this.getDateClassName(nextDate, &quot;current&quot;));
+			dayInWeek--;
+			previousDate = nextDate;
+			nextDate = this.incrementDate(nextDate, false);
+		}
+		for (var i = dayInWeek; i &gt; -1; i--) {
+			currentCalendarNode = calendarNodes.item(i);
+			this.createDayContents(currentCalendarNode, nextDate);
+			dojo.html.setClass(currentCalendarNode, this.getDateClassName(nextDate, &quot;previous&quot;));
+			previousDate = nextDate;
+			nextDate = this.incrementDate(nextDate, false);
+		}
+	} else {
+		nextDate.setDate(1);
+		for (var i = 0; i &lt; 7; i++) {
+			currentCalendarNode = calendarNodes.item(i);
+			this.createDayContents(currentCalendarNode, nextDate);
+			dojo.html.setClass(currentCalendarNode, this.getDateClassName(nextDate, &quot;current&quot;));
+			previousDate = nextDate;
+			nextDate = this.incrementDate(nextDate, true);
+		}
+	}
+	previousDate.setDate(this.firstSaturday.date);
+	previousDate.setMonth(this.firstSaturday.month);
+	previousDate.setFullYear(this.firstSaturday.year);
+	nextDate = this.incrementDate(previousDate, true);
+	var count = 7;
+	currentCalendarNode = calendarNodes.item(count);
+	while ((nextDate.getMonth() == previousDate.getMonth()) &amp;&amp; (count &lt; 42)) {
+		this.createDayContents(currentCalendarNode, nextDate);
+		dojo.html.setClass(currentCalendarNode, this.getDateClassName(nextDate, &quot;current&quot;));
+		currentCalendarNode = calendarNodes.item(++count);
+		previousDate = nextDate;
+		nextDate = this.incrementDate(nextDate, true);
+	}
+	while (count &lt; 42) {
+		this.createDayContents(currentCalendarNode, nextDate);
+		dojo.html.setClass(currentCalendarNode, this.getDateClassName(nextDate, &quot;next&quot;));
+		currentCalendarNode = calendarNodes.item(++count);
+		previousDate = nextDate;
+		nextDate = this.incrementDate(nextDate, true);
+	}
+	this.setMonthLabel(this.firstSaturday.month);
+	this.setYearLabels(this.firstSaturday.year);
+}});
+dojo.widget.MonthlyCalendar.util = new function () {
+	this.toRfcDate = function (jsDate) {
+		if (!jsDate) {
+			jsDate = this.today;
+		}
+		var year = jsDate.getFullYear();
+		var month = jsDate.getMonth() + 1;
+		if (month &lt; 10) {
+			month = &quot;0&quot; + month.toString();
+		}
+		var date = jsDate.getDate();
+		if (date &lt; 10) {
+			date = &quot;0&quot; + date.toString();
+		}
+		return year + &quot;-&quot; + month + &quot;-&quot; + date + &quot;T00:00:00+00:00&quot;;
+	};
+	this.fromRfcDate = function (rfcDate) {
+		var tempDate = rfcDate.split(&quot;-&quot;);
+		if (tempDate.length &lt; 3) {
+			return new Date();
+		}
+		return new Date(parseInt(tempDate[0]), (parseInt(tempDate[1], 10) - 1), parseInt(tempDate[2].substr(0, 2), 10));
+	};
+	this.initFirstSaturday = function (month, year) {
+		if (!month) {
+			month = this.date.getMonth();
+		}
+		if (!year) {
+			year = this.date.getFullYear();
+		}
+		var firstOfMonth = new Date(year, month, 1);
+		return {year:year, month:month, date:7 - firstOfMonth.getDay()};
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/PageContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/PageContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/PageContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,202 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.PageContainer&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.PageContainer&quot;, dojo.widget.HtmlWidget, {isContainer:true, doLayout:true, templateString:&quot;&lt;div dojoAttachPoint='containerNode'&gt;&lt;/div&gt;&quot;, selectedChild:&quot;&quot;, fillInTemplate:function (args, frag) {
+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+	dojo.widget.PageContainer.superclass.fillInTemplate.apply(this, arguments);
+}, postCreate:function (args, frag) {
+	if (this.children.length) {
+		dojo.lang.forEach(this.children, this._setupChild, this);
+		var initialChild;
+		if (this.selectedChild) {
+			this.selectChild(this.selectedChild);
+		} else {
+			for (var i = 0; i &lt; this.children.length; i++) {
+				if (this.children[i].selected) {
+					this.selectChild(this.children[i]);
+					break;
+				}
+			}
+			if (!this.selectedChildWidget) {
+				this.selectChild(this.children[0]);
+			}
+		}
+	}
+}, addChild:function (child) {
+	dojo.widget.PageContainer.superclass.addChild.apply(this, arguments);
+	this._setupChild(child);
+	this.onResized();
+	if (!this.selectedChildWidget) {
+		this.selectChild(child);
+	}
+}, _setupChild:function (page) {
+	page.hide();
+	page.domNode.style.position = &quot;relative&quot;;
+	dojo.event.topic.publish(this.widgetId + &quot;-addChild&quot;, page);
+}, removeChild:function (page) {
+	dojo.widget.PageContainer.superclass.removeChild.apply(this, arguments);
+	if (this._beingDestroyed) {
+		return;
+	}
+	dojo.event.topic.publish(this.widgetId + &quot;-removeChild&quot;, page);
+	this.onResized();
+	if (this.selectedChildWidget === page) {
+		this.selectedChildWidget = undefined;
+		if (this.children.length &gt; 0) {
+			this.selectChild(this.children[0], true);
+		}
+	}
+}, selectChild:function (page, callingWidget) {
+	page = dojo.widget.byId(page);
+	this.correspondingPageButton = callingWidget;
+	if (this.selectedChildWidget) {
+		this._hideChild(this.selectedChildWidget);
+	}
+	this.selectedChildWidget = page;
+	this.selectedChild = page.widgetId;
+	this._showChild(page);
+	page.isFirstChild = (page == this.children[0]);
+	page.isLastChild = (page == this.children[this.children.length - 1]);
+	dojo.event.topic.publish(this.widgetId + &quot;-selectChild&quot;, page);
+}, forward:function () {
+	var index = dojo.lang.find(this.children, this.selectedChildWidget);
+	this.selectChild(this.children[index + 1]);
+}, back:function () {
+	var index = dojo.lang.find(this.children, this.selectedChildWidget);
+	this.selectChild(this.children[index - 1]);
+}, onResized:function () {
+	if (this.doLayout &amp;&amp; this.selectedChildWidget) {
+		with (this.selectedChildWidget.domNode.style) {
+			top = dojo.html.getPixelValue(this.containerNode, &quot;padding-top&quot;, true);
+			left = dojo.html.getPixelValue(this.containerNode, &quot;padding-left&quot;, true);
+		}
+		var content = dojo.html.getContentBox(this.containerNode);
+		this.selectedChildWidget.resizeTo(content.width, content.height);
+	}
+}, _showChild:function (page) {
+	if (this.doLayout) {
+		var content = dojo.html.getContentBox(this.containerNode);
+		page.resizeTo(content.width, content.height);
+	}
+	page.selected = true;
+	page.show();
+}, _hideChild:function (page) {
+	page.selected = false;
+	page.hide();
+}, closeChild:function (page) {
+	var remove = page.onClose(this, page);
+	if (remove) {
+		this.removeChild(page);
+		page.destroy();
+	}
+}, destroy:function () {
+	this._beingDestroyed = true;
+	dojo.event.topic.destroy(this.widgetId + &quot;-addChild&quot;);
+	dojo.event.topic.destroy(this.widgetId + &quot;-removeChild&quot;);
+	dojo.event.topic.destroy(this.widgetId + &quot;-selectChild&quot;);
+	dojo.widget.PageContainer.superclass.destroy.apply(this, arguments);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.PageController&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;span wairole='tablist' dojoAttachEvent='onKey'&gt;&lt;/span&gt;&quot;, isContainer:true, containerId:&quot;&quot;, buttonWidget:&quot;PageButton&quot;, &quot;class&quot;:&quot;dojoPageController&quot;, fillInTemplate:function () {
+	dojo.html.addClass(this.domNode, this[&quot;class&quot;]);
+	dojo.widget.wai.setAttr(this.domNode, &quot;waiRole&quot;, &quot;role&quot;, &quot;tablist&quot;);
+}, postCreate:function () {
+	this.pane2button = {};
+	var container = dojo.widget.byId(this.containerId);
+	if (container) {
+		dojo.lang.forEach(container.children, this.onAddChild, this);
+	}
+	dojo.event.topic.subscribe(this.containerId + &quot;-addChild&quot;, this, &quot;onAddChild&quot;);
+	dojo.event.topic.subscribe(this.containerId + &quot;-removeChild&quot;, this, &quot;onRemoveChild&quot;);
+	dojo.event.topic.subscribe(this.containerId + &quot;-selectChild&quot;, this, &quot;onSelectChild&quot;);
+}, destroy:function () {
+	dojo.event.topic.unsubscribe(this.containerId + &quot;-addChild&quot;, this, &quot;onAddChild&quot;);
+	dojo.event.topic.unsubscribe(this.containerId + &quot;-removeChild&quot;, this, &quot;onRemoveChild&quot;);
+	dojo.event.topic.unsubscribe(this.containerId + &quot;-selectChild&quot;, this, &quot;onSelectChild&quot;);
+	dojo.widget.PageController.superclass.destroy.apply(this, arguments);
+}, onAddChild:function (page) {
+	var button = dojo.widget.createWidget(this.buttonWidget, {label:page.label, closeButton:page.closable});
+	this.addChild(button);
+	this.domNode.appendChild(button.domNode);
+	this.pane2button[page] = button;
+	page.controlButton = button;
+	var _this = this;
+	dojo.event.connect(button, &quot;onClick&quot;, function () {
+		_this.onButtonClick(page);
+	});
+	dojo.event.connect(button, &quot;onCloseButtonClick&quot;, function () {
+		_this.onCloseButtonClick(page);
+	});
+}, onRemoveChild:function (page) {
+	if (this._currentChild == page) {
+		this._currentChild = null;
+	}
+	var button = this.pane2button[page];
+	if (button) {
+		button.destroy();
+	}
+	this.pane2button[page] = null;
+}, onSelectChild:function (page) {
+	if (this._currentChild) {
+		var oldButton = this.pane2button[this._currentChild];
+		oldButton.clearSelected();
+	}
+	var newButton = this.pane2button[page];
+	newButton.setSelected();
+	this._currentChild = page;
+}, onButtonClick:function (page) {
+	var container = dojo.widget.byId(this.containerId);
+	container.selectChild(page, false, this);
+}, onCloseButtonClick:function (page) {
+	var container = dojo.widget.byId(this.containerId);
+	container.closeChild(page);
+}, onKey:function (evt) {
+	if ((evt.keyCode == evt.KEY_RIGHT_ARROW) || (evt.keyCode == evt.KEY_LEFT_ARROW)) {
+		var current = 0;
+		var next = null;
+		var current = dojo.lang.find(this.children, this.pane2button[this._currentChild]);
+		if (evt.keyCode == evt.KEY_RIGHT_ARROW) {
+			next = this.children[(current + 1) % this.children.length];
+		} else {
+			next = this.children[(current + (this.children.length - 1)) % this.children.length];
+		}
+		dojo.event.browser.stopEvent(evt);
+		next.onClick();
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.PageButton&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;span class='item'&gt;&quot; + &quot;&lt;span dojoAttachEvent='onClick' dojoAttachPoint='titleNode' class='selectButton'&gt;${this.label}&lt;/span&gt;&quot; + &quot;&lt;span dojoAttachEvent='onClick:onCloseButtonClick' class='closeButton'&gt;[X]&lt;/span&gt;&quot; + &quot;&lt;/span&gt;&quot;, label:&quot;foo&quot;, closeButton:false, onClick:function () {
+	this.focus();
+}, onCloseButtonMouseOver:function () {
+	dojo.html.addClass(this.closeButtonNode, &quot;closeHover&quot;);
+}, onCloseButtonMouseOut:function () {
+	dojo.html.removeClass(this.closeButtonNode, &quot;closeHover&quot;);
+}, onCloseButtonClick:function (evt) {
+}, setSelected:function () {
+	dojo.html.addClass(this.domNode, &quot;current&quot;);
+	this.titleNode.setAttribute(&quot;tabIndex&quot;, &quot;0&quot;);
+}, clearSelected:function () {
+	dojo.html.removeClass(this.domNode, &quot;current&quot;);
+	this.titleNode.setAttribute(&quot;tabIndex&quot;, &quot;-1&quot;);
+}, focus:function () {
+	if (this.titleNode.focus) {
+		this.titleNode.focus();
+	}
+}});
+dojo.lang.extend(dojo.widget.Widget, {label:&quot;&quot;, selected:false, closable:false, onClose:function () {
+	return true;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Parse.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Parse.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Parse.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,227 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Parse&quot;);
+dojo.require(&quot;dojo.widget.Manager&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.widget.Parse = function (fragment) {
+	this.propertySetsList = [];
+	this.fragment = fragment;
+	this.createComponents = function (frag, parentComp) {
+		var comps = [];
+		var built = false;
+		try {
+			if (frag &amp;&amp; frag.tagName &amp;&amp; (frag != frag.nodeRef)) {
+				var djTags = dojo.widget.tags;
+				var tna = String(frag.tagName).split(&quot;;&quot;);
+				for (var x = 0; x &lt; tna.length; x++) {
+					var ltn = tna[x].replace(/^\s+|\s+$/g, &quot;&quot;).toLowerCase();
+					frag.tagName = ltn;
+					var ret;
+					if (djTags[ltn]) {
+						built = true;
+						ret = djTags[ltn](frag, this, parentComp, frag.index);
+						comps.push(ret);
+					} else {
+						if (ltn.indexOf(&quot;:&quot;) == -1) {
+							ltn = &quot;dojo:&quot; + ltn;
+						}
+						ret = dojo.widget.buildWidgetFromParseTree(ltn, frag, this, parentComp, frag.index);
+						if (ret) {
+							built = true;
+							comps.push(ret);
+						}
+					}
+				}
+			}
+		}
+		catch (e) {
+			dojo.debug(&quot;dojo.widget.Parse: error:&quot;, e);
+		}
+		if (!built) {
+			comps = comps.concat(this.createSubComponents(frag, parentComp));
+		}
+		return comps;
+	};
+	this.createSubComponents = function (fragment, parentComp) {
+		var frag, comps = [];
+		for (var item in fragment) {
+			frag = fragment[item];
+			if (frag &amp;&amp; typeof frag == &quot;object&quot; &amp;&amp; (frag != fragment.nodeRef) &amp;&amp; (frag != fragment.tagName) &amp;&amp; (!dojo.dom.isNode(frag))) {
+				comps = comps.concat(this.createComponents(frag, parentComp));
+			}
+		}
+		return comps;
+	};
+	this.parsePropertySets = function (fragment) {
+		return [];
+	};
+	this.parseProperties = function (fragment) {
+		var properties = {};
+		for (var item in fragment) {
+			if ((fragment[item] == fragment.tagName) || (fragment[item] == fragment.nodeRef)) {
+			} else {
+				var frag = fragment[item];
+				if (frag.tagName &amp;&amp; dojo.widget.tags[frag.tagName.toLowerCase()]) {
+				} else {
+					if (frag[0] &amp;&amp; frag[0].value != &quot;&quot; &amp;&amp; frag[0].value != null) {
+						try {
+							if (item.toLowerCase() == &quot;dataprovider&quot;) {
+								var _this = this;
+								this.getDataProvider(_this, frag[0].value);
+								properties.dataProvider = this.dataProvider;
+							}
+							properties[item] = frag[0].value;
+							var nestedProperties = this.parseProperties(frag);
+							for (var property in nestedProperties) {
+								properties[property] = nestedProperties[property];
+							}
+						}
+						catch (e) {
+							dojo.debug(e);
+						}
+					}
+				}
+				switch (item.toLowerCase()) {
+				  case &quot;checked&quot;:
+				  case &quot;disabled&quot;:
+					if (typeof properties[item] != &quot;boolean&quot;) {
+						properties[item] = true;
+					}
+					break;
+				}
+			}
+		}
+		return properties;
+	};
+	this.getDataProvider = function (objRef, dataUrl) {
+		dojo.io.bind({url:dataUrl, load:function (type, evaldObj) {
+			if (type == &quot;load&quot;) {
+				objRef.dataProvider = evaldObj;
+			}
+		}, mimetype:&quot;text/javascript&quot;, sync:true});
+	};
+	this.getPropertySetById = function (propertySetId) {
+		for (var x = 0; x &lt; this.propertySetsList.length; x++) {
+			if (propertySetId == this.propertySetsList[x][&quot;id&quot;][0].value) {
+				return this.propertySetsList[x];
+			}
+		}
+		return &quot;&quot;;
+	};
+	this.getPropertySetsByType = function (componentType) {
+		var propertySets = [];
+		for (var x = 0; x &lt; this.propertySetsList.length; x++) {
+			var cpl = this.propertySetsList[x];
+			var cpcc = cpl.componentClass || cpl.componentType || null;
+			var propertySetId = this.propertySetsList[x][&quot;id&quot;][0].value;
+			if (cpcc &amp;&amp; (propertySetId == cpcc[0].value)) {
+				propertySets.push(cpl);
+			}
+		}
+		return propertySets;
+	};
+	this.getPropertySets = function (fragment) {
+		var ppl = &quot;dojo:propertyproviderlist&quot;;
+		var propertySets = [];
+		var tagname = fragment.tagName;
+		if (fragment[ppl]) {
+			var propertyProviderIds = fragment[ppl].value.split(&quot; &quot;);
+			for (var propertySetId in propertyProviderIds) {
+				if ((propertySetId.indexOf(&quot;..&quot;) == -1) &amp;&amp; (propertySetId.indexOf(&quot;://&quot;) == -1)) {
+					var propertySet = this.getPropertySetById(propertySetId);
+					if (propertySet != &quot;&quot;) {
+						propertySets.push(propertySet);
+					}
+				} else {
+				}
+			}
+		}
+		return this.getPropertySetsByType(tagname).concat(propertySets);
+	};
+	this.createComponentFromScript = function (nodeRef, componentName, properties, ns) {
+		properties.fastMixIn = true;
+		var ltn = (ns || &quot;dojo&quot;) + &quot;:&quot; + componentName.toLowerCase();
+		if (dojo.widget.tags[ltn]) {
+			return [dojo.widget.tags[ltn](properties, this, null, null, properties)];
+		}
+		return [dojo.widget.buildWidgetFromParseTree(ltn, properties, this, null, null, properties)];
+	};
+};
+dojo.widget._parser_collection = {&quot;dojo&quot;:new dojo.widget.Parse()};
+dojo.widget.getParser = function (name) {
+	if (!name) {
+		name = &quot;dojo&quot;;
+	}
+	if (!this._parser_collection[name]) {
+		this._parser_collection[name] = new dojo.widget.Parse();
+	}
+	return this._parser_collection[name];
+};
+dojo.widget.createWidget = function (name, props, refNode, position) {
+	var isNode = false;
+	var isNameStr = (typeof name == &quot;string&quot;);
+	if (isNameStr) {
+		var pos = name.indexOf(&quot;:&quot;);
+		var ns = (pos &gt; -1) ? name.substring(0, pos) : &quot;dojo&quot;;
+		if (pos &gt; -1) {
+			name = name.substring(pos + 1);
+		}
+		var lowerCaseName = name.toLowerCase();
+		var namespacedName = ns + &quot;:&quot; + lowerCaseName;
+		isNode = (dojo.byId(name) &amp;&amp; !dojo.widget.tags[namespacedName]);
+	}
+	if ((arguments.length == 1) &amp;&amp; (isNode || !isNameStr)) {
+		var xp = new dojo.xml.Parse();
+		var tn = isNode ? dojo.byId(name) : name;
+		return dojo.widget.getParser().createComponents(xp.parseElement(tn, null, true))[0];
+	}
+	function fromScript(placeKeeperNode, name, props, ns) {
+		props[namespacedName] = {dojotype:[{value:lowerCaseName}], nodeRef:placeKeeperNode, fastMixIn:true};
+		props.ns = ns;
+		return dojo.widget.getParser().createComponentFromScript(placeKeeperNode, name, props, ns);
+	}
+	props = props || {};
+	var notRef = false;
+	var tn = null;
+	var h = dojo.render.html.capable;
+	if (h) {
+		tn = document.createElement(&quot;span&quot;);
+	}
+	if (!refNode) {
+		notRef = true;
+		refNode = tn;
+		if (h) {
+			dojo.body().appendChild(refNode);
+		}
+	} else {
+		if (position) {
+			dojo.dom.insertAtPosition(tn, refNode, position);
+		} else {
+			tn = refNode;
+		}
+	}
+	var widgetArray = fromScript(tn, name.toLowerCase(), props, ns);
+	if ((!widgetArray) || (!widgetArray[0]) || (typeof widgetArray[0].widgetType == &quot;undefined&quot;)) {
+		throw new Error(&quot;createWidget: Creation of \&quot;&quot; + name + &quot;\&quot; widget failed.&quot;);
+	}
+	try {
+		if (notRef &amp;&amp; widgetArray[0].domNode.parentNode) {
+			widgetArray[0].domNode.parentNode.removeChild(widgetArray[0].domNode);
+		}
+	}
+	catch (e) {
+		dojo.debug(e);
+	}
+	return widgetArray[0];
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/PopupContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/PopupContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/PopupContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,297 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.PopupContainer&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.html.iframe&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.declare(&quot;dojo.widget.PopupContainerBase&quot;, null, function () {
+	this.queueOnAnimationFinish = [];
+}, {isShowingNow:false, currentSubpopup:null, beginZIndex:1000, parentPopup:null, parent:null, popupIndex:0, aroundBox:dojo.html.boxSizing.BORDER_BOX, openedForWindow:null, processKey:function (evt) {
+	return false;
+}, applyPopupBasicStyle:function () {
+	with (this.domNode.style) {
+		display = &quot;none&quot;;
+		position = &quot;absolute&quot;;
+	}
+}, aboutToShow:function () {
+}, open:function (x, y, parent, explodeSrc, orient, padding) {
+	if (this.isShowingNow) {
+		return;
+	}
+	if (this.animationInProgress) {
+		this.queueOnAnimationFinish.push(this.open, arguments);
+		return;
+	}
+	this.aboutToShow();
+	var around = false, node, aroundOrient;
+	if (typeof x == &quot;object&quot;) {
+		node = x;
+		aroundOrient = explodeSrc;
+		explodeSrc = parent;
+		parent = y;
+		around = true;
+	}
+	this.parent = parent;
+	dojo.body().appendChild(this.domNode);
+	explodeSrc = explodeSrc || parent[&quot;domNode&quot;] || [];
+	var parentPopup = null;
+	this.isTopLevel = true;
+	while (parent) {
+		if (parent !== this &amp;&amp; (parent.setOpenedSubpopup != undefined &amp;&amp; parent.applyPopupBasicStyle != undefined)) {
+			parentPopup = parent;
+			this.isTopLevel = false;
+			parentPopup.setOpenedSubpopup(this);
+			break;
+		}
+		parent = parent.parent;
+	}
+	this.parentPopup = parentPopup;
+	this.popupIndex = parentPopup ? parentPopup.popupIndex + 1 : 1;
+	if (this.isTopLevel) {
+		var button = dojo.html.isNode(explodeSrc) ? explodeSrc : null;
+		dojo.widget.PopupManager.opened(this, button);
+	}
+	if (this.isTopLevel &amp;&amp; !dojo.withGlobal(this.openedForWindow || dojo.global(), dojo.html.selection.isCollapsed)) {
+		this._bookmark = dojo.withGlobal(this.openedForWindow || dojo.global(), dojo.html.selection.getBookmark);
+	} else {
+		this._bookmark = null;
+	}
+	if (explodeSrc instanceof Array) {
+		explodeSrc = {left:explodeSrc[0], top:explodeSrc[1], width:0, height:0};
+	}
+	with (this.domNode.style) {
+		display = &quot;&quot;;
+		zIndex = this.beginZIndex + this.popupIndex;
+	}
+	if (around) {
+		this.move(node, padding, aroundOrient);
+	} else {
+		this.move(x, y, padding, orient);
+	}
+	this.domNode.style.display = &quot;none&quot;;
+	this.explodeSrc = explodeSrc;
+	this.show();
+	this.isShowingNow = true;
+}, move:function (x, y, padding, orient) {
+	var around = (typeof x == &quot;object&quot;);
+	if (around) {
+		var aroundOrient = padding;
+		var node = x;
+		padding = y;
+		if (!aroundOrient) {
+			aroundOrient = {&quot;BL&quot;:&quot;TL&quot;, &quot;TL&quot;:&quot;BL&quot;};
+		}
+		dojo.html.placeOnScreenAroundElement(this.domNode, node, padding, this.aroundBox, aroundOrient);
+	} else {
+		if (!orient) {
+			orient = &quot;TL,TR,BL,BR&quot;;
+		}
+		dojo.html.placeOnScreen(this.domNode, x, y, padding, true, orient);
+	}
+}, close:function (force) {
+	if (force) {
+		this.domNode.style.display = &quot;none&quot;;
+	}
+	if (this.animationInProgress) {
+		this.queueOnAnimationFinish.push(this.close, []);
+		return;
+	}
+	this.closeSubpopup(force);
+	this.hide();
+	if (this.bgIframe) {
+		this.bgIframe.hide();
+		this.bgIframe.size({left:0, top:0, width:0, height:0});
+	}
+	if (this.isTopLevel) {
+		dojo.widget.PopupManager.closed(this);
+	}
+	this.isShowingNow = false;
+	if (this.parent) {
+		setTimeout(dojo.lang.hitch(this, function () {
+			try {
+				if (this.parent[&quot;focus&quot;]) {
+					this.parent.focus();
+				} else {
+					this.parent.domNode.focus();
+				}
+			}
+			catch (e) {
+				dojo.debug(&quot;No idea how to focus to parent&quot;, e);
+			}
+		}), 10);
+	}
+	if (this._bookmark &amp;&amp; dojo.withGlobal(this.openedForWindow || dojo.global(), dojo.html.selection.isCollapsed)) {
+		if (this.openedForWindow) {
+			this.openedForWindow.focus();
+		}
+		try {
+			dojo.withGlobal(this.openedForWindow || dojo.global(), &quot;moveToBookmark&quot;, dojo.html.selection, [this._bookmark]);
+		}
+		catch (e) {
+		}
+	}
+	this._bookmark = null;
+}, closeAll:function (force) {
+	if (this.parentPopup) {
+		this.parentPopup.closeAll(force);
+	} else {
+		this.close(force);
+	}
+}, setOpenedSubpopup:function (popup) {
+	this.currentSubpopup = popup;
+}, closeSubpopup:function (force) {
+	if (this.currentSubpopup == null) {
+		return;
+	}
+	this.currentSubpopup.close(force);
+	this.currentSubpopup = null;
+}, onShow:function () {
+	dojo.widget.PopupContainer.superclass.onShow.apply(this, arguments);
+	this.openedSize = {w:this.domNode.style.width, h:this.domNode.style.height};
+	if (dojo.render.html.ie) {
+		if (!this.bgIframe) {
+			this.bgIframe = new dojo.html.BackgroundIframe();
+			this.bgIframe.setZIndex(this.domNode);
+		}
+		this.bgIframe.size(this.domNode);
+		this.bgIframe.show();
+	}
+	this.processQueue();
+}, processQueue:function () {
+	if (!this.queueOnAnimationFinish.length) {
+		return;
+	}
+	var func = this.queueOnAnimationFinish.shift();
+	var args = this.queueOnAnimationFinish.shift();
+	func.apply(this, args);
+}, onHide:function () {
+	dojo.widget.HtmlWidget.prototype.onHide.call(this);
+	if (this.openedSize) {
+		with (this.domNode.style) {
+			width = this.openedSize.w;
+			height = this.openedSize.h;
+		}
+	}
+	this.processQueue();
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.PopupContainer&quot;, [dojo.widget.HtmlWidget, dojo.widget.PopupContainerBase], {isContainer:true, fillInTemplate:function () {
+	this.applyPopupBasicStyle();
+	dojo.widget.PopupContainer.superclass.fillInTemplate.apply(this, arguments);
+}});
+dojo.widget.PopupManager = new function () {
+	this.currentMenu = null;
+	this.currentButton = null;
+	this.currentFocusMenu = null;
+	this.focusNode = null;
+	this.registeredWindows = [];
+	this.registerWin = function (win) {
+		if (!win.__PopupManagerRegistered) {
+			dojo.event.connect(win.document, &quot;onmousedown&quot;, this, &quot;onClick&quot;);
+			dojo.event.connect(win, &quot;onscroll&quot;, this, &quot;onClick&quot;);
+			dojo.event.connect(win.document, &quot;onkey&quot;, this, &quot;onKey&quot;);
+			win.__PopupManagerRegistered = true;
+			this.registeredWindows.push(win);
+		}
+	};
+	this.registerAllWindows = function (targetWindow) {
+		if (!targetWindow) {
+			targetWindow = dojo.html.getDocumentWindow(window.top &amp;&amp; window.top.document || window.document);
+		}
+		this.registerWin(targetWindow);
+		for (var i = 0; i &lt; targetWindow.frames.length; i++) {
+			try {
+				var win = dojo.html.getDocumentWindow(targetWindow.frames[i].document);
+				if (win) {
+					this.registerAllWindows(win);
+				}
+			}
+			catch (e) {
+			}
+		}
+	};
+	this.unRegisterWin = function (win) {
+		if (win.__PopupManagerRegistered) {
+			dojo.event.disconnect(win.document, &quot;onmousedown&quot;, this, &quot;onClick&quot;);
+			dojo.event.disconnect(win, &quot;onscroll&quot;, this, &quot;onClick&quot;);
+			dojo.event.disconnect(win.document, &quot;onkey&quot;, this, &quot;onKey&quot;);
+			win.__PopupManagerRegistered = false;
+		}
+	};
+	this.unRegisterAllWindows = function () {
+		for (var i = 0; i &lt; this.registeredWindows.length; ++i) {
+			this.unRegisterWin(this.registeredWindows[i]);
+		}
+		this.registeredWindows = [];
+	};
+	dojo.addOnLoad(this, &quot;registerAllWindows&quot;);
+	dojo.addOnUnload(this, &quot;unRegisterAllWindows&quot;);
+	this.closed = function (menu) {
+		if (this.currentMenu == menu) {
+			this.currentMenu = null;
+			this.currentButton = null;
+			this.currentFocusMenu = null;
+		}
+	};
+	this.opened = function (menu, button) {
+		if (menu == this.currentMenu) {
+			return;
+		}
+		if (this.currentMenu) {
+			this.currentMenu.close();
+		}
+		this.currentMenu = menu;
+		this.currentFocusMenu = menu;
+		this.currentButton = button;
+	};
+	this.setFocusedMenu = function (menu) {
+		this.currentFocusMenu = menu;
+	};
+	this.onKey = function (e) {
+		if (!e.key) {
+			return;
+		}
+		if (!this.currentMenu || !this.currentMenu.isShowingNow) {
+			return;
+		}
+		var m = this.currentFocusMenu;
+		while (m) {
+			if (m.processKey(e)) {
+				e.preventDefault();
+				e.stopPropagation();
+				break;
+			}
+			m = m.parentPopup || m.parentMenu;
+		}
+	}, this.onClick = function (e) {
+		if (!this.currentMenu) {
+			return;
+		}
+		var scrolloffset = dojo.html.getScroll().offset;
+		var m = this.currentMenu;
+		while (m) {
+			if (dojo.html.overElement(m.domNode, e) || dojo.html.isDescendantOf(e.target, m.domNode)) {
+				return;
+			}
+			m = m.currentSubpopup;
+		}
+		if (this.currentButton &amp;&amp; dojo.html.overElement(this.currentButton, e)) {
+			return;
+		}
+		this.currentMenu.closeAll(true);
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/ProgressBar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ProgressBar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ProgressBar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,187 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ProgressBar&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.string.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ProgressBar&quot;, dojo.widget.HtmlWidget, {progressValue:0, maxProgressValue:100, width:300, height:30, frontPercentClass:&quot;frontPercent&quot;, backPercentClass:&quot;backPercent&quot;, frontBarClass:&quot;frontBar&quot;, backBarClass:&quot;backBar&quot;, hasText:false, isVertical:false, showOnlyIntegers:false, dataSource:&quot;&quot;, pollInterval:3000, duration:1000, templateString:&quot;&lt;div dojoAttachPoint=\&quot;containerNode\&quot; style=\&quot;position:relative;overflow:hidden\&quot;&gt;\n\t&lt;div style=\&quot;position:absolute;display:none;width:100%;text-align:center\&quot; dojoAttachPoint=\&quot;backPercentLabel\&quot; class=\&quot;dojoBackPercentLabel\&quot;&gt;&lt;/div&gt;\n\t&lt;div style=\&quot;position:absolute;overflow:hidden;width:100%;height:100%\&quot; dojoAttachPoint=\&quot;internalProgress\&quot;&gt;\n\t&lt;div style=\&quot;position:absolute;display:none;width:100%;text-align:center\&quot; dojoAttachPoint=\&quot;frontPercentLabel\&quot; class=\&quot;dojoFrontPercentLabel\&quot;&gt;&lt;/div&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.backBar{\n\tborder:1px solid #84a3d1;\n}\n.frontBar{\n\tbackground:ur!
 l(\&quot;images/bar.gif\&quot;) repeat bottom left;\n\tbackground-attachment: fixed;\n}\n.h-frontBar{\n\tbackground:url(\&quot;images/h-bar.gif\&quot;) repeat bottom left;\n\tbackground-attachment: fixed;\n}\n.simpleFrontBar{\n\tbackground: red;\n}\n.frontPercent,.backPercent{\n\tfont:bold 13px helvetica;\n}\n.backPercent{\n\tcolor:#293a4b;\n}\n.frontPercent{\n\tcolor:#fff;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/ProgressBar.css&quot;), containerNode:null, internalProgress:null, _pixelUnitRatio:0, _pixelPercentRatio:0, _unitPercentRatio:0, _unitPixelRatio:0, _floatDimension:0, _intDimension:0, _progressPercentValue:&quot;0%&quot;, _floatMaxProgressValue:0, _dimension:&quot;width&quot;, _pixelValue:0, _oInterval:null, _animation:null, _animationStopped:true, _progressValueBak:false, _hasTextBak:false, fillInTemplate:function (args, frag) {
+	this.internalProgress.className = this.frontBarClass;
+	this.containerNode.className = this.backBarClass;
+	if (this.isVertical) {
+		this.internalProgress.style.bottom = &quot;0px&quot;;
+		this.internalProgress.style.left = &quot;0px&quot;;
+		this._dimension = &quot;height&quot;;
+	} else {
+		this.internalProgress.style.top = &quot;0px&quot;;
+		this.internalProgress.style.left = &quot;0px&quot;;
+		this._dimension = &quot;width&quot;;
+	}
+	this.frontPercentLabel.className = this.frontPercentClass;
+	this.backPercentLabel.className = this.backPercentClass;
+	this.progressValue = &quot;&quot; + this.progressValue;
+	this.domNode.style.height = this.height + &quot;px&quot;;
+	this.domNode.style.width = this.width + &quot;px&quot;;
+	this._intDimension = parseInt(&quot;0&quot; + eval(&quot;this.&quot; + this._dimension));
+	this._floatDimension = parseFloat(&quot;0&quot; + eval(&quot;this.&quot; + this._dimension));
+	this._pixelPercentRatio = this._floatDimension / 100;
+	this.setMaxProgressValue(this.maxProgressValue, true);
+	this.setProgressValue(dojo.string.trim(this.progressValue), true);
+	dojo.debug(&quot;float dimension: &quot; + this._floatDimension);
+	dojo.debug(&quot;this._unitPixelRatio: &quot; + this._unitPixelRatio);
+	this.showText(this.hasText);
+}, showText:function (visible) {
+	if (visible) {
+		this.backPercentLabel.style.display = &quot;block&quot;;
+		this.frontPercentLabel.style.display = &quot;block&quot;;
+	} else {
+		this.backPercentLabel.style.display = &quot;none&quot;;
+		this.frontPercentLabel.style.display = &quot;none&quot;;
+	}
+	this.hasText = visible;
+}, postCreate:function (args, frag) {
+	this.render();
+}, _backupValues:function () {
+	this._progressValueBak = this.progressValue;
+	this._hasTextBak = this.hasText;
+}, _restoreValues:function () {
+	this.setProgressValue(this._progressValueBak);
+	this.showText(this._hasTextBak);
+}, _setupAnimation:function () {
+	var _self = this;
+	dojo.debug(&quot;internalProgress width: &quot; + this.internalProgress.style.width);
+	this._animation = dojo.lfx.html.slideTo(this.internalProgress, {top:0, left:parseInt(this.width) - parseInt(this.internalProgress.style.width)}, parseInt(this.duration), null, function () {
+		var _backAnim = dojo.lfx.html.slideTo(_self.internalProgress, {top:0, left:0}, parseInt(_self.duration));
+		dojo.event.connect(_backAnim, &quot;onEnd&quot;, function () {
+			if (!_self._animationStopped) {
+				_self._animation.play();
+			}
+		});
+		if (!_self._animationStopped) {
+			_backAnim.play();
+		}
+		_backAnim = null;
+	});
+}, getMaxProgressValue:function () {
+	return this.maxProgressValue;
+}, setMaxProgressValue:function (maxValue, noRender) {
+	if (!this._animationStopped) {
+		return;
+	}
+	this.maxProgressValue = maxValue;
+	this._floatMaxProgressValue = parseFloat(&quot;0&quot; + this.maxProgressValue);
+	this._pixelUnitRatio = this._floatDimension / this.maxProgressValue;
+	this._unitPercentRatio = this._floatMaxProgressValue / 100;
+	this._unitPixelRatio = this._floatMaxProgressValue / this._floatDimension;
+	this.setProgressValue(this.progressValue, true);
+	if (!noRender) {
+		this.render();
+	}
+}, setProgressValue:function (value, noRender) {
+	if (!this._animationStopped) {
+		return;
+	}
+	this._progressPercentValue = &quot;0%&quot;;
+	var _value = dojo.string.trim(&quot;&quot; + value);
+	var _floatValue = parseFloat(&quot;0&quot; + _value);
+	var _intValue = parseInt(&quot;0&quot; + _value);
+	var _pixelValue = 0;
+	if (dojo.string.endsWith(_value, &quot;%&quot;, false)) {
+		this._progressPercentValue = Math.min(_floatValue.toFixed(1), 100) + &quot;%&quot;;
+		_value = Math.min((_floatValue) * this._unitPercentRatio, this.maxProgressValue);
+		_pixelValue = Math.min((_floatValue) * this._pixelPercentRatio, eval(&quot;this.&quot; + this._dimension));
+	} else {
+		this.progressValue = Math.min(_floatValue, this.maxProgressValue);
+		this._progressPercentValue = Math.min((_floatValue / this._unitPercentRatio).toFixed(1), 100) + &quot;%&quot;;
+		_pixelValue = Math.min(_floatValue / this._unitPixelRatio, eval(&quot;this.&quot; + this._dimension));
+	}
+	this.progressValue = dojo.string.trim(_value);
+	this._pixelValue = _pixelValue;
+	if (!noRender) {
+		this.render();
+	}
+}, getProgressValue:function () {
+	return this.progressValue;
+}, getProgressPercentValue:function () {
+	return this._progressPercentValue;
+}, setDataSource:function (dataSource) {
+	this.dataSource = dataSource;
+}, setPollInterval:function (pollInterval) {
+	this.pollInterval = pollInterval;
+}, start:function () {
+	var _showFunction = dojo.lang.hitch(this, this._showRemoteProgress);
+	this._oInterval = setInterval(_showFunction, this.pollInterval);
+}, startAnimation:function () {
+	if (this._animationStopped) {
+		this._backupValues();
+		this.setProgressValue(&quot;10%&quot;);
+		this._animationStopped = false;
+		this._setupAnimation();
+		this.showText(false);
+		this.internalProgress.style.height = &quot;105%&quot;;
+		this._animation.play();
+	}
+}, stopAnimation:function () {
+	if (this._animation) {
+		this._animationStopped = true;
+		this._animation.stop();
+		this.internalProgress.style.height = &quot;100%&quot;;
+		this.internalProgress.style.left = &quot;0px&quot;;
+		this._restoreValues();
+		this._setLabelPosition();
+	}
+}, _showRemoteProgress:function () {
+	var _self = this;
+	if ((this.getMaxProgressValue() == this.getProgressValue()) &amp;&amp; this._oInterval) {
+		clearInterval(this._oInterval);
+		this._oInterval = null;
+		this.setProgressValue(&quot;100%&quot;);
+		return;
+	}
+	var bArgs = {url:_self.dataSource, method:&quot;POST&quot;, mimetype:&quot;text/json&quot;, error:function (type, errorObj) {
+		dojo.debug(&quot;[ProgressBar] showRemoteProgress error&quot;);
+	}, load:function (type, data, evt) {
+		_self.setProgressValue((_self._oInterval ? data[&quot;progress&quot;] : &quot;100%&quot;));
+	}};
+	dojo.io.bind(bArgs);
+}, render:function () {
+	this._setPercentLabel(dojo.string.trim(this._progressPercentValue));
+	this._setPixelValue(this._pixelValue);
+	this._setLabelPosition();
+}, _setLabelPosition:function () {
+	var _widthFront = dojo.html.getContentBox(this.frontPercentLabel).width;
+	var _heightFront = dojo.html.getContentBox(this.frontPercentLabel).height;
+	var _widthBack = dojo.html.getContentBox(this.backPercentLabel).width;
+	var _heightBack = dojo.html.getContentBox(this.backPercentLabel).height;
+	var _leftFront = (parseInt(this.width) - _widthFront) / 2 + &quot;px&quot;;
+	var _bottomFront = (parseInt(this.height) - parseInt(_heightFront)) / 2 + &quot;px&quot;;
+	var _leftBack = (parseInt(this.width) - _widthBack) / 2 + &quot;px&quot;;
+	var _bottomBack = (parseInt(this.height) - parseInt(_heightBack)) / 2 + &quot;px&quot;;
+	this.frontPercentLabel.style.left = _leftFront;
+	this.backPercentLabel.style.left = _leftBack;
+	this.frontPercentLabel.style.bottom = _bottomFront;
+	this.backPercentLabel.style.bottom = _bottomBack;
+}, _setPercentLabel:function (percentValue) {
+	dojo.dom.removeChildren(this.frontPercentLabel);
+	dojo.dom.removeChildren(this.backPercentLabel);
+	var _percentValue = this.showOnlyIntegers == false ? percentValue : parseInt(percentValue) + &quot;%&quot;;
+	this.frontPercentLabel.appendChild(document.createTextNode(_percentValue));
+	this.backPercentLabel.appendChild(document.createTextNode(_percentValue));
+}, _setPixelValue:function (value) {
+	eval(&quot;this.internalProgress.style.&quot; + this._dimension + &quot; = &quot; + value + &quot; + 'px'&quot;);
+	this.onChange();
+}, onChange:function () {
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/RadioGroup.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/RadioGroup.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/RadioGroup.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,122 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.RadioGroup&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.event.browser&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.RadioGroup&quot;, dojo.widget.HtmlWidget, function () {
+	this.selectedItem = null;
+	this.items = [];
+	this.selected = [];
+	this.groupCssClass = &quot;radioGroup&quot;;
+	this.selectedCssClass = &quot;selected&quot;;
+	this.itemContentCssClass = &quot;itemContent&quot;;
+}, {isContainer:false, templatePath:null, templateCssPath:null, postCreate:function () {
+	this._parseStructure();
+	dojo.html.addClass(this.domNode, this.groupCssClass);
+	this._setupChildren();
+	dojo.event.browser.addListener(this.domNode, &quot;onclick&quot;, dojo.lang.hitch(this, &quot;onSelect&quot;));
+	if (this.selectedItem) {
+		this._selectItem(this.selectedItem);
+	}
+}, _parseStructure:function () {
+	if (this.domNode.tagName.toLowerCase() != &quot;ul&quot; &amp;&amp; this.domNode.tagName.toLowerCase() != &quot;ol&quot;) {
+		dojo.raise(&quot;RadioGroup: Expected ul or ol content.&quot;);
+		return;
+	}
+	this.items = [];
+	var nl = this.domNode.getElementsByTagName(&quot;li&quot;);
+	for (var i = 0; i &lt; nl.length; i++) {
+		if (nl[i].parentNode == this.domNode) {
+			this.items.push(nl[i]);
+		}
+	}
+}, add:function (node) {
+	if (node.parentNode != this.domNode) {
+		this.domNode.appendChild(node);
+	}
+	this.items.push(node);
+	this._setup(node);
+}, remove:function (node) {
+	var idx = -1;
+	for (var i = 0; i &lt; this.items.length; i++) {
+		if (this.items[i] == node) {
+			idx = i;
+			break;
+		}
+	}
+	if (idx &lt; 0) {
+		return;
+	}
+	this.items.splice(idx, 1);
+	node.parentNode.removeChild(node);
+}, clear:function () {
+	for (var i = 0; i &lt; this.items.length; i++) {
+		this.domNode.removeChild(this.items[i]);
+	}
+	this.items = [];
+}, clearSelections:function () {
+	for (var i = 0; i &lt; this.items.length; i++) {
+		dojo.html.removeClass(this.items[i], this.selectedCssClass);
+	}
+	this.selectedItem = null;
+}, _setup:function (node) {
+	var span = document.createElement(&quot;span&quot;);
+	dojo.html.disableSelection(span);
+	dojo.html.addClass(span, this.itemContentCssClass);
+	dojo.dom.moveChildren(node, span);
+	node.appendChild(span);
+	if (this.selected.length &gt; 0) {
+		var uid = dojo.html.getAttribute(node, &quot;id&quot;);
+		if (uid &amp;&amp; uid == this.selected) {
+			this.selectedItem = node;
+		}
+	}
+	dojo.event.browser.addListener(node, &quot;onclick&quot;, dojo.lang.hitch(this, &quot;onItemSelect&quot;));
+	if (dojo.html.hasAttribute(node, &quot;onitemselect&quot;)) {
+		var tn = dojo.lang.nameAnonFunc(new Function(dojo.html.getAttribute(node, &quot;onitemselect&quot;)), this);
+		dojo.event.browser.addListener(node, &quot;onclick&quot;, dojo.lang.hitch(this, tn));
+	}
+}, _setupChildren:function () {
+	for (var i = 0; i &lt; this.items.length; i++) {
+		this._setup(this.items[i]);
+	}
+}, _selectItem:function (node, event, nofire) {
+	if (this.selectedItem) {
+		dojo.html.removeClass(this.selectedItem, this.selectedCssClass);
+	}
+	this.selectedItem = node;
+	dojo.html.addClass(this.selectedItem, this.selectedCssClass);
+	if (!dj_undef(&quot;currentTarget&quot;, event)) {
+		return;
+	}
+	if (!nofire) {
+		if (dojo.render.html.ie) {
+			this.selectedItem.fireEvent(&quot;onclick&quot;);
+		} else {
+			var e = document.createEvent(&quot;MouseEvents&quot;);
+			e.initEvent(&quot;click&quot;, true, false);
+			this.selectedItem.dispatchEvent(e);
+		}
+	}
+}, getValue:function () {
+	return this.selectedItem;
+}, onSelect:function (e) {
+}, onItemSelect:function (e) {
+	if (!dj_undef(&quot;currentTarget&quot;, e)) {
+		this._selectItem(e.currentTarget, e);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/RealNumberTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/RealNumberTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/RealNumberTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,50 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.RealNumberTextbox&quot;);
+dojo.require(&quot;dojo.widget.IntegerTextbox&quot;);
+dojo.require(&quot;dojo.validate.common&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.RealNumberTextbox&quot;, dojo.widget.IntegerTextbox, {mixInProperties:function (localProperties, frag) {
+	dojo.widget.RealNumberTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.places) {
+		this.flags.places = Number(localProperties.places);
+	}
+	if ((localProperties.exponent == &quot;true&quot;) || (localProperties.exponent == &quot;always&quot;)) {
+		this.flags.exponent = true;
+	} else {
+		if ((localProperties.exponent == &quot;false&quot;) || (localProperties.exponent == &quot;never&quot;)) {
+			this.flags.exponent = false;
+		} else {
+			this.flags.exponent = [true, false];
+		}
+	}
+	if ((localProperties.esigned == &quot;true&quot;) || (localProperties.esigned == &quot;always&quot;)) {
+		this.flags.eSigned = true;
+	} else {
+		if ((localProperties.esigned == &quot;false&quot;) || (localProperties.esigned == &quot;never&quot;)) {
+			this.flags.eSigned = false;
+		} else {
+			this.flags.eSigned = [true, false];
+		}
+	}
+	if (localProperties.min) {
+		this.flags.min = parseFloat(localProperties.min);
+	}
+	if (localProperties.max) {
+		this.flags.max = parseFloat(localProperties.max);
+	}
+}, isValid:function () {
+	return dojo.validate.isRealNumber(this.textbox.value, this.flags);
+}, isInRange:function () {
+	return dojo.validate.isInRange(this.textbox.value, this.flags);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/RegexpTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/RegexpTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/RegexpTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,27 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.RegexpTextbox&quot;);
+dojo.require(&quot;dojo.widget.ValidationTextbox&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.RegexpTextbox&quot;, dojo.widget.ValidationTextbox, {mixInProperties:function (localProperties, frag) {
+	dojo.widget.RegexpTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.regexp) {
+		this.flags.regexp = localProperties.regexp;
+	}
+	if (localProperties.flags) {
+		this.flags.flags = localProperties.flags;
+	}
+}, isValid:function () {
+	var regexp = new RegExp(this.flags.regexp, this.flags.flags);
+	return regexp.test(this.textbox.value);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/RemoteTabController.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/RemoteTabController.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/RemoteTabController.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,28 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.RemoteTabController&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.TabContainer&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.deprecated(&quot;dojo.widget.RemoteTabController is slated for removal in 0.5; use PageController or TabController instead.&quot;, &quot;0.5&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.RemoteTabController&quot;, dojo.widget.TabController, {templateCssString:&quot;.dojoRemoteTabController {\n\tposition: relative;\n}\n\n.dojoRemoteTab {\n\tposition : relative;\n\tfloat : left;\n\tpadding-left : 9px;\n\tborder-bottom : 1px solid #6290d2;\n\tbackground : url(images/tab_left.gif) no-repeat left top;\n\tcursor: pointer;\n\twhite-space: nowrap;\n\tz-index: 3;\n}\n\n.dojoRemoteTab div {\n\tdisplay : block;\n\tpadding : 4px 15px 4px 6px;\n\tbackground : url(images/tab_top_right.gif) no-repeat right top;\n\tcolor : #333;\n\tfont-size : 90%;\n}\n\n.dojoRemoteTabPaneClose {\n\tposition : absolute;\n\tbottom : 0px;\n\tright : 6px;\n\theight : 12px;\n\twidth : 12px;\n\tbackground : url(images/tab_close.gif) no-repeat right top;\n}\n\n.dojoRemoteTabPaneCloseHover {\n\tbackground-image : url(images/tab_close_h.gif);\n}\n\n.dojoRemoteTabClose {\n\tdisplay : inline-block;\n\theight : 12px;\n\twidth : 12px;\n\tpadding : 0 12px 0 0;\n\tmargin : 0 !
 -10px 0 10px;\n\tbackground : url(images/tab_close.gif) no-repeat right top;\n\tcursor : default;\n}\n\n.dojoRemoteTabCloseHover {\n\tbackground-image : url(images/tab_close_h.gif);\n}\n\n.dojoRemoteTab.current {\n\tpadding-bottom : 1px;\n\tborder-bottom : 0;\n\tbackground-position : 0 -150px;\n}\n\n.dojoRemoteTab.current div {\n\tpadding-bottom : 5px;\n\tmargin-bottom : -1px;\n\tbackground-position : 100% -150px;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/RemoteTabControl.css&quot;), templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot; wairole=\&quot;tablist\&quot;&gt;&lt;/div&gt;&quot;, &quot;class&quot;:&quot;dojoRemoteTabController&quot;, tabContainer:&quot;&quot;, postMixInProperties:function () {
+	this.containerId = this.tabContainer;
+	dojo.widget.RemoteTabController.superclass.postMixInProperties.apply(this, arguments);
+}, fillInTemplate:function () {
+	dojo.html.addClass(this.domNode, this[&quot;class&quot;]);
+	if (this.tabContainer) {
+		dojo.addOnLoad(dojo.lang.hitch(this, &quot;setupTabs&quot;));
+	}
+	dojo.widget.RemoteTabController.superclass.fillInTemplate.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Repeater.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Repeater.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Repeater.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,128 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Repeater&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.widget.Repeater&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Repeater&quot;, dojo.widget.HtmlWidget, {name:&quot;&quot;, rowTemplate:&quot;&quot;, myObject:null, pattern:&quot;&quot;, useDnd:false, isContainer:true, initialize:function (args, frag) {
+	var node = this.getFragNodeRef(frag);
+	node.removeAttribute(&quot;dojotype&quot;);
+	this.setRow(dojo.string.trim(node.innerHTML), {});
+	node.innerHTML = &quot;&quot;;
+	frag = null;
+}, postCreate:function (args, frag) {
+	if (this.useDnd) {
+		dojo.require(&quot;dojo.dnd.*&quot;);
+		var dnd = new dojo.dnd.HtmlDropTarget(this.domNode, [this.widgetId]);
+	}
+}, _reIndexRows:function () {
+	for (var i = 0, len = this.domNode.childNodes.length; i &lt; len; i++) {
+		var elems = [&quot;INPUT&quot;, &quot;SELECT&quot;, &quot;TEXTAREA&quot;];
+		for (var k = 0; k &lt; elems.length; k++) {
+			var list = this.domNode.childNodes[i].getElementsByTagName(elems[k]);
+			for (var j = 0, len2 = list.length; j &lt; len2; j++) {
+				var name = list[j].name;
+				var index = dojo.string.escape(&quot;regexp&quot;, this.pattern);
+				index = index.replace(/(%\\\{index\\\})/g, &quot;%{index}&quot;);
+				var nameRegexp = dojo.string.substituteParams(index, {&quot;index&quot;:&quot;[0-9]*&quot;});
+				var newName = dojo.string.substituteParams(this.pattern, {&quot;index&quot;:&quot;&quot; + i});
+				var re = new RegExp(nameRegexp, &quot;g&quot;);
+				list[j].name = name.replace(re, newName);
+			}
+		}
+	}
+}, onDeleteRow:function (e) {
+	var index = dojo.string.escape(&quot;regexp&quot;, this.pattern);
+	index = index.replace(/%\\\{index\\\}/g, &quot;%{index}&quot;);
+	var nameRegexp = dojo.string.substituteParams(index, {&quot;index&quot;:&quot;([0-9]*)&quot;});
+	var re = new RegExp(nameRegexp, &quot;g&quot;);
+	this.deleteRow(re.exec(e.target.name)[1]);
+}, hasRows:function () {
+	if (this.domNode.childNodes.length &gt; 0) {
+		return true;
+	}
+	return false;
+}, getRowCount:function () {
+	return this.domNode.childNodes.length;
+}, deleteRow:function (idx) {
+	this.domNode.removeChild(this.domNode.childNodes[idx]);
+	this._reIndexRows();
+}, _changeRowPosition:function (e) {
+	if (e.dragStatus == &quot;dropFailure&quot;) {
+		this.domNode.removeChild(e[&quot;dragSource&quot;].domNode);
+	} else {
+		if (e.dragStatus == &quot;dropSuccess&quot;) {
+		}
+	}
+	this._reIndexRows();
+}, setRow:function (template, myObject) {
+	template = template.replace(/\%\{(index)\}/g, &quot;0&quot;);
+	this.rowTemplate = template;
+	this.myObject = myObject;
+}, getRow:function () {
+	return this.rowTemplate;
+}, _initRow:function (node) {
+	if (typeof (node) == &quot;number&quot;) {
+		node = this.domNode.childNodes[node];
+	}
+	var elems = [&quot;INPUT&quot;, &quot;SELECT&quot;, &quot;IMG&quot;];
+	for (var k = 0; k &lt; elems.length; k++) {
+		var list = node.getElementsByTagName(elems[k]);
+		for (var i = 0, len = list.length; i &lt; len; i++) {
+			var child = list[i];
+			if (child.nodeType != 1) {
+				continue;
+			}
+			if (child.getAttribute(&quot;rowFunction&quot;) != null) {
+				if (typeof (this.myObject[child.getAttribute(&quot;rowFunction&quot;)]) == &quot;undefined&quot;) {
+					dojo.debug(&quot;Function &quot; + child.getAttribute(&quot;rowFunction&quot;) + &quot; not found&quot;);
+				} else {
+					this.myObject[child.getAttribute(&quot;rowFunction&quot;)](child);
+				}
+			} else {
+				if (child.getAttribute(&quot;rowAction&quot;) != null) {
+					if (child.getAttribute(&quot;rowAction&quot;) == &quot;delete&quot;) {
+						child.name = dojo.string.substituteParams(this.pattern, {&quot;index&quot;:&quot;&quot; + (this.getRowCount() - 1)});
+						dojo.event.connect(child, &quot;onclick&quot;, this, &quot;onDeleteRow&quot;);
+					}
+				}
+			}
+		}
+	}
+}, onAddRow:function (e) {
+}, addRow:function (doInit) {
+	if (typeof (doInit) == &quot;undefined&quot;) {
+		doInit = true;
+	}
+	var node = document.createElement(&quot;span&quot;);
+	node.innerHTML = this.getRow();
+	if (node.childNodes.length == 1) {
+		node = node.childNodes[0];
+	}
+	this.domNode.appendChild(node);
+	var parser = new dojo.xml.Parse();
+	var frag = parser.parseElement(node, null, true);
+	dojo.widget.getParser().createSubComponents(frag, this);
+	this._reIndexRows();
+	if (doInit) {
+		this._initRow(node);
+	}
+	if (this.useDnd) {
+		node = new dojo.dnd.HtmlDragSource(node, this.widgetId);
+		dojo.event.connect(node, &quot;onDragEnd&quot;, this, &quot;_changeRowPosition&quot;);
+	}
+	this.onAddRow(node);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ResizableTextarea.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ResizableTextarea.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ResizableTextarea.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ResizableTextarea&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.LayoutContainer&quot;);
+dojo.require(&quot;dojo.widget.ResizeHandle&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ResizableTextarea&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div&gt;\n\t&lt;div style=\&quot;border: 2px solid black; width: 90%; height: 200px;\&quot;\n\t\tdojoAttachPoint=\&quot;rootLayoutNode\&quot;&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;textAreaContainerNode\&quot; \n\t\t\tstyle=\&quot;border: 0px; margin: 0px; overflow: hidden;\&quot;&gt;\n\t\t&lt;/div&gt;\n\t\t&lt;div dojoAttachPoint=\&quot;statusBarContainerNode\&quot; class=\&quot;statusBar\&quot;&gt;\n\t\t\t&lt;div dojoAttachPoint=\&quot;statusLabelNode\&quot; \n\t\t\t\tclass=\&quot;statusPanel\&quot;\n\t\t\t\tstyle=\&quot;padding-right: 0px; z-index: 1;\&quot;&gt;drag to resize&lt;/div&gt;\n\t\t\t&lt;div dojoAttachPoint=\&quot;resizeHandleNode\&quot;&gt;&lt;/div&gt;\n\t\t&lt;/div&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;div.statusBar {\n\tbackground-color: ThreeDFace;\n\theight: 28px;\n\tpadding: 1px;\n\toverflow: hidden;\n\tfont-size: 12px;\n}\n\ndiv.statusPanel {\n\tbackground-color: ThreeDFace;\n\tborder: 1px solid;\n\tborder-color: ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow;\n\tmargin: 1px;\n\tpadding: 2px!
  6px;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/ResizableTextarea.css&quot;), fillInTemplate:function (args, frag) {
+	this.textAreaNode = this.getFragNodeRef(frag).cloneNode(true);
+	dojo.body().appendChild(this.domNode);
+	this.rootLayout = dojo.widget.createWidget(&quot;LayoutContainer&quot;, {minHeight:50, minWidth:100}, this.rootLayoutNode);
+	this.textAreaContainer = dojo.widget.createWidget(&quot;LayoutContainer&quot;, {layoutAlign:&quot;client&quot;}, this.textAreaContainerNode);
+	this.rootLayout.addChild(this.textAreaContainer);
+	this.textAreaContainer.domNode.appendChild(this.textAreaNode);
+	with (this.textAreaNode.style) {
+		width = &quot;100%&quot;;
+		height = &quot;100%&quot;;
+	}
+	this.statusBar = dojo.widget.createWidget(&quot;LayoutContainer&quot;, {layoutAlign:&quot;bottom&quot;, minHeight:28}, this.statusBarContainerNode);
+	this.rootLayout.addChild(this.statusBar);
+	this.statusLabel = dojo.widget.createWidget(&quot;LayoutContainer&quot;, {layoutAlign:&quot;client&quot;, minWidth:50}, this.statusLabelNode);
+	this.statusBar.addChild(this.statusLabel);
+	this.resizeHandle = dojo.widget.createWidget(&quot;ResizeHandle&quot;, {targetElmId:this.rootLayout.widgetId}, this.resizeHandleNode);
+	this.statusBar.addChild(this.resizeHandle);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ResizeHandle.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ResizeHandle.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ResizeHandle.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,68 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ResizeHandle&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ResizeHandle&quot;, dojo.widget.HtmlWidget, {targetElmId:&quot;&quot;, templateCssString:&quot;.dojoHtmlResizeHandle {\n\tfloat: right;\n\tposition: absolute;\n\tright: 2px;\n\tbottom: 2px;\n\twidth: 13px;\n\theight: 13px;\n\tz-index: 20;\n\tcursor: nw-resize;\n\tbackground-image: url(grabCorner.gif);\n\tline-height: 0px;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/ResizeHandle.css&quot;), templateString:&quot;&lt;div class=\&quot;dojoHtmlResizeHandle\&quot;&gt;&lt;div&gt;&lt;/div&gt;&lt;/div&gt;&quot;, postCreate:function () {
+	dojo.event.connect(this.domNode, &quot;onmousedown&quot;, this, &quot;_beginSizing&quot;);
+}, _beginSizing:function (e) {
+	if (this._isSizing) {
+		return false;
+	}
+	this.targetWidget = dojo.widget.byId(this.targetElmId);
+	this.targetDomNode = this.targetWidget ? this.targetWidget.domNode : dojo.byId(this.targetElmId);
+	if (!this.targetDomNode) {
+		return;
+	}
+	this._isSizing = true;
+	this.startPoint = {&quot;x&quot;:e.clientX, &quot;y&quot;:e.clientY};
+	var mb = dojo.html.getMarginBox(this.targetDomNode);
+	this.startSize = {&quot;w&quot;:mb.width, &quot;h&quot;:mb.height};
+	dojo.event.kwConnect({srcObj:dojo.body(), srcFunc:&quot;onmousemove&quot;, targetObj:this, targetFunc:&quot;_changeSizing&quot;, rate:25});
+	dojo.event.connect(dojo.body(), &quot;onmouseup&quot;, this, &quot;_endSizing&quot;);
+	e.preventDefault();
+}, _changeSizing:function (e) {
+	try {
+		if (!e.clientX || !e.clientY) {
+			return;
+		}
+	}
+	catch (e) {
+		return;
+	}
+	var dx = this.startPoint.x - e.clientX;
+	var dy = this.startPoint.y - e.clientY;
+	var newW = this.startSize.w - dx;
+	var newH = this.startSize.h - dy;
+	if (this.minSize) {
+		var mb = dojo.html.getMarginBox(this.targetDomNode);
+		if (newW &lt; this.minSize.w) {
+			newW = mb.width;
+		}
+		if (newH &lt; this.minSize.h) {
+			newH = mb.height;
+		}
+	}
+	if (this.targetWidget) {
+		this.targetWidget.resizeTo(newW, newH);
+	} else {
+		dojo.html.setMarginBox(this.targetDomNode, {width:newW, height:newH});
+	}
+	e.preventDefault();
+}, _endSizing:function (e) {
+	dojo.event.disconnect(dojo.body(), &quot;onmousemove&quot;, this, &quot;_changeSizing&quot;);
+	dojo.event.disconnect(dojo.body(), &quot;onmouseup&quot;, this, &quot;_endSizing&quot;);
+	this._isSizing = false;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/RichText.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/RichText.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/RichText.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,1167 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.RichText&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+if (!djConfig[&quot;useXDomain&quot;] || djConfig[&quot;allowXdRichTextSave&quot;]) {
+	if (dojo.hostenv.post_load_) {
+		(function () {
+			var savetextarea = dojo.doc().createElement(&quot;textarea&quot;);
+			savetextarea.id = &quot;dojo.widget.RichText.savedContent&quot;;
+			savetextarea.style = &quot;display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;&quot;;
+			dojo.body().appendChild(savetextarea);
+		})();
+	} else {
+		try {
+			dojo.doc().write(&quot;&lt;textarea id=\&quot;dojo.widget.RichText.savedContent\&quot; &quot; + &quot;style=\&quot;display:none;position:absolute;top:-100px;left:-100px;height:3px;width:3px;overflow:hidden;\&quot;&gt;&lt;/textarea&gt;&quot;);
+		}
+		catch (e) {
+		}
+	}
+}
+dojo.widget.defineWidget(&quot;dojo.widget.RichText&quot;, dojo.widget.HtmlWidget, function () {
+	this.contentPreFilters = [];
+	this.contentPostFilters = [];
+	this.contentDomPreFilters = [];
+	this.contentDomPostFilters = [];
+	this.editingAreaStyleSheets = [];
+	if (dojo.render.html.moz) {
+		this.contentPreFilters.push(this._fixContentForMoz);
+	}
+	this._keyHandlers = {};
+	if (dojo.Deferred) {
+		this.onLoadDeferred = new dojo.Deferred();
+	}
+}, {inheritWidth:false, focusOnLoad:false, saveName:&quot;&quot;, styleSheets:&quot;&quot;, _content:&quot;&quot;, height:&quot;&quot;, minHeight:&quot;1em&quot;, isClosed:true, isLoaded:false, useActiveX:false, relativeImageUrls:false, _SEPARATOR:&quot;@@**%%__RICHTEXTBOUNDRY__%%**@@&quot;, onLoadDeferred:null, fillInTemplate:function () {
+	dojo.event.topic.publish(&quot;dojo.widget.RichText::init&quot;, this);
+	this.open();
+	dojo.event.connect(this, &quot;onKeyPressed&quot;, this, &quot;afterKeyPress&quot;);
+	dojo.event.connect(this, &quot;onKeyPress&quot;, this, &quot;keyPress&quot;);
+	dojo.event.connect(this, &quot;onKeyDown&quot;, this, &quot;keyDown&quot;);
+	dojo.event.connect(this, &quot;onKeyUp&quot;, this, &quot;keyUp&quot;);
+	this.setupDefaultShortcuts();
+}, setupDefaultShortcuts:function () {
+	var ctrl = this.KEY_CTRL;
+	var exec = function (cmd, arg) {
+		return arguments.length == 1 ? function () {
+			this.execCommand(cmd);
+		} : function () {
+			this.execCommand(cmd, arg);
+		};
+	};
+	this.addKeyHandler(&quot;b&quot;, ctrl, exec(&quot;bold&quot;));
+	this.addKeyHandler(&quot;i&quot;, ctrl, exec(&quot;italic&quot;));
+	this.addKeyHandler(&quot;u&quot;, ctrl, exec(&quot;underline&quot;));
+	this.addKeyHandler(&quot;a&quot;, ctrl, exec(&quot;selectall&quot;));
+	this.addKeyHandler(&quot;s&quot;, ctrl, function () {
+		this.save(true);
+	});
+	this.addKeyHandler(&quot;1&quot;, ctrl, exec(&quot;formatblock&quot;, &quot;h1&quot;));
+	this.addKeyHandler(&quot;2&quot;, ctrl, exec(&quot;formatblock&quot;, &quot;h2&quot;));
+	this.addKeyHandler(&quot;3&quot;, ctrl, exec(&quot;formatblock&quot;, &quot;h3&quot;));
+	this.addKeyHandler(&quot;4&quot;, ctrl, exec(&quot;formatblock&quot;, &quot;h4&quot;));
+	this.addKeyHandler(&quot;\\&quot;, ctrl, exec(&quot;insertunorderedlist&quot;));
+	if (!dojo.render.html.ie) {
+		this.addKeyHandler(&quot;Z&quot;, ctrl, exec(&quot;redo&quot;));
+	}
+}, events:[&quot;onBlur&quot;, &quot;onFocus&quot;, &quot;onKeyPress&quot;, &quot;onKeyDown&quot;, &quot;onKeyUp&quot;, &quot;onClick&quot;], open:function (element) {
+	if (this.onLoadDeferred.fired &gt;= 0) {
+		this.onLoadDeferred = new dojo.Deferred();
+	}
+	var h = dojo.render.html;
+	if (!this.isClosed) {
+		this.close();
+	}
+	dojo.event.topic.publish(&quot;dojo.widget.RichText::open&quot;, this);
+	this._content = &quot;&quot;;
+	if ((arguments.length == 1) &amp;&amp; (element[&quot;nodeName&quot;])) {
+		this.domNode = element;
+	}
+	if ((this.domNode[&quot;nodeName&quot;]) &amp;&amp; (this.domNode.nodeName.toLowerCase() == &quot;textarea&quot;)) {
+		this.textarea = this.domNode;
+		var html = this._preFilterContent(this.textarea.value);
+		this.domNode = dojo.doc().createElement(&quot;div&quot;);
+		dojo.html.copyStyle(this.domNode, this.textarea);
+		var tmpFunc = dojo.lang.hitch(this, function () {
+			with (this.textarea.style) {
+				display = &quot;block&quot;;
+				position = &quot;absolute&quot;;
+				left = top = &quot;-1000px&quot;;
+				if (h.ie) {
+					this.__overflow = overflow;
+					overflow = &quot;hidden&quot;;
+				}
+			}
+		});
+		if (h.ie) {
+			setTimeout(tmpFunc, 10);
+		} else {
+			tmpFunc();
+		}
+		if (!h.safari) {
+			dojo.html.insertBefore(this.domNode, this.textarea);
+		}
+		if (this.textarea.form) {
+			dojo.event.connect(&quot;before&quot;, this.textarea.form, &quot;onsubmit&quot;, dojo.lang.hitch(this, function () {
+				this.textarea.value = this.getEditorContent();
+			}));
+		}
+		var editor = this;
+		dojo.event.connect(this, &quot;postCreate&quot;, function () {
+			dojo.html.insertAfter(editor.textarea, editor.domNode);
+		});
+	} else {
+		var html = this._preFilterContent(dojo.string.trim(this.domNode.innerHTML));
+	}
+	if (html == &quot;&quot;) {
+		html = &quot;&nbsp;&quot;;
+	}
+	var content = dojo.html.getContentBox(this.domNode);
+	this._oldHeight = content.height;
+	this._oldWidth = content.width;
+	this._firstChildContributingMargin = this._getContributingMargin(this.domNode, &quot;top&quot;);
+	this._lastChildContributingMargin = this._getContributingMargin(this.domNode, &quot;bottom&quot;);
+	this.savedContent = html;
+	this.domNode.innerHTML = &quot;&quot;;
+	this.editingArea = dojo.doc().createElement(&quot;div&quot;);
+	this.domNode.appendChild(this.editingArea);
+	if ((this.domNode[&quot;nodeName&quot;]) &amp;&amp; (this.domNode.nodeName == &quot;LI&quot;)) {
+		this.domNode.innerHTML = &quot; &lt;br&gt;&quot;;
+	}
+	if (this.saveName != &quot;&quot; &amp;&amp; (!djConfig[&quot;useXDomain&quot;] || djConfig[&quot;allowXdRichTextSave&quot;])) {
+		var saveTextarea = dojo.doc().getElementById(&quot;dojo.widget.RichText.savedContent&quot;);
+		if (saveTextarea.value != &quot;&quot;) {
+			var datas = saveTextarea.value.split(this._SEPARATOR);
+			for (var i = 0; i &lt; datas.length; i++) {
+				var data = datas[i].split(&quot;:&quot;);
+				if (data[0] == this.saveName) {
+					html = data[1];
+					datas.splice(i, 1);
+					break;
+				}
+			}
+		}
+		dojo.event.connect(&quot;before&quot;, window, &quot;onunload&quot;, this, &quot;_saveContent&quot;);
+	}
+	if (h.ie70 &amp;&amp; this.useActiveX) {
+		dojo.debug(&quot;activeX in ie70 is not currently supported, useActiveX is ignored for now.&quot;);
+		this.useActiveX = false;
+	}
+	if (this.useActiveX &amp;&amp; h.ie) {
+		var self = this;
+		setTimeout(function () {
+			self._drawObject(html);
+		}, 0);
+	} else {
+		if (h.ie || this._safariIsLeopard() || h.opera) {
+			this.iframe = dojo.doc().createElement(&quot;iframe&quot;);
+			this.iframe.src = &quot;javascript:void(0)&quot;;
+			this.editorObject = this.iframe;
+			with (this.iframe.style) {
+				border = &quot;0&quot;;
+				width = &quot;100%&quot;;
+			}
+			this.iframe.frameBorder = 0;
+			this.editingArea.appendChild(this.iframe);
+			this.window = this.iframe.contentWindow;
+			this.document = this.window.document;
+			this.document.open();
+			this.document.write(&quot;&lt;html&gt;&lt;head&gt;&lt;style&gt;body{margin:0;padding:0;border:0;overflow:hidden;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;div&gt;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;&quot;);
+			this.document.close();
+			this.editNode = this.document.body.firstChild;
+			this.editNode.contentEditable = true;
+			with (this.iframe.style) {
+				if (h.ie70) {
+					if (this.height) {
+						height = this.height;
+					}
+					if (this.minHeight) {
+						minHeight = this.minHeight;
+					}
+				} else {
+					height = this.height ? this.height : this.minHeight;
+				}
+			}
+			var formats = [&quot;p&quot;, &quot;pre&quot;, &quot;address&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;, &quot;ol&quot;, &quot;div&quot;, &quot;ul&quot;];
+			var localhtml = &quot;&quot;;
+			for (var i in formats) {
+				if (formats[i].charAt(1) != &quot;l&quot;) {
+					localhtml += &quot;&lt;&quot; + formats[i] + &quot;&gt;&lt;span&gt;content&lt;/span&gt;&lt;/&quot; + formats[i] + &quot;&gt;&quot;;
+				} else {
+					localhtml += &quot;&lt;&quot; + formats[i] + &quot;&gt;&lt;li&gt;content&lt;/li&gt;&lt;/&quot; + formats[i] + &quot;&gt;&quot;;
+				}
+			}
+			with (this.editNode.style) {
+				position = &quot;absolute&quot;;
+				left = &quot;-2000px&quot;;
+				top = &quot;-2000px&quot;;
+			}
+			this.editNode.innerHTML = localhtml;
+			var node = this.editNode.firstChild;
+			while (node) {
+				dojo.withGlobal(this.window, &quot;selectElement&quot;, dojo.html.selection, [node.firstChild]);
+				var nativename = node.tagName.toLowerCase();
+				this._local2NativeFormatNames[nativename] = this.queryCommandValue(&quot;formatblock&quot;);
+				this._native2LocalFormatNames[this._local2NativeFormatNames[nativename]] = nativename;
+				node = node.nextSibling;
+			}
+			with (this.editNode.style) {
+				position = &quot;&quot;;
+				left = &quot;&quot;;
+				top = &quot;&quot;;
+			}
+			this.editNode.innerHTML = html;
+			if (this.height) {
+				this.document.body.style.overflowY = &quot;scroll&quot;;
+			}
+			dojo.lang.forEach(this.events, function (e) {
+				dojo.event.connect(this.editNode, e.toLowerCase(), this, e);
+			}, this);
+			this.onLoad();
+		} else {
+			this._drawIframe(html);
+			this.editorObject = this.iframe;
+		}
+	}
+	if (this.domNode.nodeName == &quot;LI&quot;) {
+		this.domNode.lastChild.style.marginTop = &quot;-1.2em&quot;;
+	}
+	dojo.html.addClass(this.domNode, &quot;RichTextEditable&quot;);
+	this.isClosed = false;
+}, _hasCollapseableMargin:function (element, side) {
+	if (dojo.html.getPixelValue(element, &quot;border-&quot; + side + &quot;-width&quot;, false)) {
+		return false;
+	} else {
+		if (dojo.html.getPixelValue(element, &quot;padding-&quot; + side, false)) {
+			return false;
+		} else {
+			return true;
+		}
+	}
+}, _getContributingMargin:function (element, topOrBottom) {
+	if (topOrBottom == &quot;top&quot;) {
+		var siblingAttr = &quot;previousSibling&quot;;
+		var childSiblingAttr = &quot;nextSibling&quot;;
+		var childAttr = &quot;firstChild&quot;;
+		var marginProp = &quot;margin-top&quot;;
+		var siblingMarginProp = &quot;margin-bottom&quot;;
+	} else {
+		var siblingAttr = &quot;nextSibling&quot;;
+		var childSiblingAttr = &quot;previousSibling&quot;;
+		var childAttr = &quot;lastChild&quot;;
+		var marginProp = &quot;margin-bottom&quot;;
+		var siblingMarginProp = &quot;margin-top&quot;;
+	}
+	var elementMargin = dojo.html.getPixelValue(element, marginProp, false);
+	function isSignificantNode(element) {
+		return !(element.nodeType == 3 &amp;&amp; dojo.string.isBlank(element.data)) &amp;&amp; dojo.html.getStyle(element, &quot;display&quot;) != &quot;none&quot; &amp;&amp; !dojo.html.isPositionAbsolute(element);
+	}
+	var childMargin = 0;
+	var child = element[childAttr];
+	while (child) {
+		while ((!isSignificantNode(child)) &amp;&amp; child[childSiblingAttr]) {
+			child = child[childSiblingAttr];
+		}
+		childMargin = Math.max(childMargin, dojo.html.getPixelValue(child, marginProp, false));
+		if (!this._hasCollapseableMargin(child, topOrBottom)) {
+			break;
+		}
+		child = child[childAttr];
+	}
+	if (!this._hasCollapseableMargin(element, topOrBottom)) {
+		return parseInt(childMargin);
+	}
+	var contextMargin = 0;
+	var sibling = element[siblingAttr];
+	while (sibling) {
+		if (isSignificantNode(sibling)) {
+			contextMargin = dojo.html.getPixelValue(sibling, siblingMarginProp, false);
+			break;
+		}
+		sibling = sibling[siblingAttr];
+	}
+	if (!sibling) {
+		contextMargin = dojo.html.getPixelValue(element.parentNode, marginProp, false);
+	}
+	if (childMargin &gt; elementMargin) {
+		return parseInt(Math.max((childMargin - elementMargin) - contextMargin, 0));
+	} else {
+		return 0;
+	}
+}, _drawIframe:function (html) {
+	var oldMoz = Boolean(dojo.render.html.moz &amp;&amp; (typeof window.XML == &quot;undefined&quot;));
+	if (!this.iframe) {
+		var currentDomain = (new dojo.uri.Uri(dojo.doc().location)).host;
+		this.iframe = dojo.doc().createElement(&quot;iframe&quot;);
+		with (this.iframe) {
+			style.border = &quot;none&quot;;
+			style.lineHeight = &quot;0&quot;;
+			style.verticalAlign = &quot;bottom&quot;;
+			scrolling = this.height ? &quot;auto&quot; : &quot;no&quot;;
+		}
+	}
+	if (djConfig[&quot;useXDomain&quot;] &amp;&amp; !djConfig[&quot;dojoRichTextFrameUrl&quot;]) {
+		dojo.debug(&quot;dojo.widget.RichText: When using cross-domain Dojo builds,&quot; + &quot; please save src/widget/templates/richtextframe.html to your domain and set djConfig.dojoRichTextFrameUrl&quot; + &quot; to the path on your domain to richtextframe.html&quot;);
+	}
+	this.iframe.src = (djConfig[&quot;dojoRichTextFrameUrl&quot;] || dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/richtextframe.html&quot;)) + ((dojo.doc().domain != currentDomain) ? (&quot;#&quot; + dojo.doc().domain) : &quot;&quot;);
+	this.iframe.width = this.inheritWidth ? this._oldWidth : &quot;100%&quot;;
+	if (this.height) {
+		this.iframe.style.height = this.height;
+	} else {
+		var height = this._oldHeight;
+		if (this._hasCollapseableMargin(this.domNode, &quot;top&quot;)) {
+			height += this._firstChildContributingMargin;
+		}
+		if (this._hasCollapseableMargin(this.domNode, &quot;bottom&quot;)) {
+			height += this._lastChildContributingMargin;
+		}
+		this.iframe.height = height;
+	}
+	var tmpContent = dojo.doc().createElement(&quot;div&quot;);
+	tmpContent.innerHTML = html;
+	this.editingArea.appendChild(tmpContent);
+	if (this.relativeImageUrls) {
+		var imgs = tmpContent.getElementsByTagName(&quot;img&quot;);
+		for (var i = 0; i &lt; imgs.length; i++) {
+			imgs[i].src = (new dojo.uri.Uri(dojo.global().location, imgs[i].src)).toString();
+		}
+		html = tmpContent.innerHTML;
+	}
+	var firstChild = dojo.html.firstElement(tmpContent);
+	var lastChild = dojo.html.lastElement(tmpContent);
+	if (firstChild) {
+		firstChild.style.marginTop = this._firstChildContributingMargin + &quot;px&quot;;
+	}
+	if (lastChild) {
+		lastChild.style.marginBottom = this._lastChildContributingMargin + &quot;px&quot;;
+	}
+	this.editingArea.appendChild(this.iframe);
+	if (dojo.render.html.safari) {
+		this.iframe.src = this.iframe.src;
+	}
+	var _iframeInitialized = false;
+	var ifrFunc = dojo.lang.hitch(this, function () {
+		if (!_iframeInitialized) {
+			_iframeInitialized = true;
+		} else {
+			return;
+		}
+		if (!this.editNode) {
+			if (this.iframe.contentWindow) {
+				this.window = this.iframe.contentWindow;
+				this.document = this.iframe.contentWindow.document;
+			} else {
+				if (this.iframe.contentDocument) {
+					this.window = this.iframe.contentDocument.window;
+					this.document = this.iframe.contentDocument;
+				}
+			}
+			var getStyle = (function (domNode) {
+				return function (style) {
+					return dojo.html.getStyle(domNode, style);
+				};
+			})(this.domNode);
+			var font = getStyle(&quot;font-weight&quot;) + &quot; &quot; + getStyle(&quot;font-size&quot;) + &quot; &quot; + getStyle(&quot;font-family&quot;);
+			var lineHeight = &quot;1.0&quot;;
+			var lineHeightStyle = dojo.html.getUnitValue(this.domNode, &quot;line-height&quot;);
+			if (lineHeightStyle.value &amp;&amp; lineHeightStyle.units == &quot;&quot;) {
+				lineHeight = lineHeightStyle.value;
+			}
+			dojo.html.insertCssText(&quot;body,html{background:transparent;padding:0;margin:0;}&quot; + &quot;body{top:0;left:0;right:0;&quot; + (((this.height) || (dojo.render.html.opera)) ? &quot;&quot; : &quot;position:fixed;&quot;) + &quot;font:&quot; + font + &quot;;&quot; + &quot;min-height:&quot; + this.minHeight + &quot;;&quot; + &quot;line-height:&quot; + lineHeight + &quot;}&quot; + &quot;p{margin: 1em 0 !important;}&quot; + &quot;body &gt; *:first-child{padding-top:0 !important;margin-top:&quot; + this._firstChildContributingMargin + &quot;px !important;}&quot; + &quot;body &gt; *:last-child{padding-bottom:0 !important;margin-bottom:&quot; + this._lastChildContributingMargin + &quot;px !important;}&quot; + &quot;li &gt; ul:-moz-first-node, li &gt; ol:-moz-first-node{padding-top:1.2em;}\n&quot; + &quot;li{min-height:1.2em;}&quot; + &quot;&quot;, this.document);
+			dojo.html.removeNode(tmpContent);
+			this.document.body.innerHTML = html;
+			if (oldMoz || dojo.render.html.safari) {
+				this.document.designMode = &quot;on&quot;;
+			}
+			this.onLoad();
+		} else {
+			dojo.html.removeNode(tmpContent);
+			this.editNode.innerHTML = html;
+			this.onDisplayChanged();
+		}
+	});
+	if (this.editNode) {
+		ifrFunc();
+	} else {
+		if (dojo.render.html.moz) {
+			this.iframe.onload = function () {
+				setTimeout(ifrFunc, 250);
+			};
+		} else {
+			this.iframe.onload = ifrFunc;
+		}
+	}
+}, _applyEditingAreaStyleSheets:function () {
+	var files = [];
+	if (this.styleSheets) {
+		files = this.styleSheets.split(&quot;;&quot;);
+		this.styleSheets = &quot;&quot;;
+	}
+	files = files.concat(this.editingAreaStyleSheets);
+	this.editingAreaStyleSheets = [];
+	if (files.length &gt; 0) {
+		for (var i = 0; i &lt; files.length; i++) {
+			var url = files[i];
+			if (url) {
+				this.addStyleSheet(dojo.uri.dojoUri(url));
+			}
+		}
+	}
+}, addStyleSheet:function (uri) {
+	var url = uri.toString();
+	if (dojo.lang.find(this.editingAreaStyleSheets, url) &gt; -1) {
+		dojo.debug(&quot;dojo.widget.RichText.addStyleSheet: Style sheet &quot; + url + &quot; is already applied to the editing area!&quot;);
+		return;
+	}
+	if (url.charAt(0) == &quot;.&quot; || (url.charAt(0) != &quot;/&quot; &amp;&amp; !uri.host)) {
+		url = (new dojo.uri.Uri(dojo.global().location, url)).toString();
+	}
+	this.editingAreaStyleSheets.push(url);
+	if (this.document.createStyleSheet) {
+		this.document.createStyleSheet(url);
+	} else {
+		var head = this.document.getElementsByTagName(&quot;head&quot;)[0];
+		var stylesheet = this.document.createElement(&quot;link&quot;);
+		with (stylesheet) {
+			rel = &quot;stylesheet&quot;;
+			type = &quot;text/css&quot;;
+			href = url;
+		}
+		head.appendChild(stylesheet);
+	}
+}, removeStyleSheet:function (uri) {
+	var url = uri.toString();
+	if (url.charAt(0) == &quot;.&quot; || (url.charAt(0) != &quot;/&quot; &amp;&amp; !uri.host)) {
+		url = (new dojo.uri.Uri(dojo.global().location, url)).toString();
+	}
+	var index = dojo.lang.find(this.editingAreaStyleSheets, url);
+	if (index == -1) {
+		dojo.debug(&quot;dojo.widget.RichText.removeStyleSheet: Style sheet &quot; + url + &quot; is not applied to the editing area so it can not be removed!&quot;);
+		return;
+	}
+	delete this.editingAreaStyleSheets[index];
+	var links = this.document.getElementsByTagName(&quot;link&quot;);
+	for (var i = 0; i &lt; links.length; i++) {
+		if (links[i].href == url) {
+			if (dojo.render.html.ie) {
+				links[i].href = &quot;&quot;;
+			}
+			dojo.html.removeNode(links[i]);
+			break;
+		}
+	}
+}, _drawObject:function (html) {
+	this.object = dojo.html.createExternalElement(dojo.doc(), &quot;object&quot;);
+	with (this.object) {
+		classid = &quot;clsid:2D360201-FFF5-11D1-8D03-00A0C959BC0A&quot;;
+		width = this.inheritWidth ? this._oldWidth : &quot;100%&quot;;
+		style.height = this.height ? this.height : (this._oldHeight + &quot;px&quot;);
+		Scrollbars = this.height ? true : false;
+		Appearance = this._activeX.appearance.flat;
+	}
+	this.editorObject = this.object;
+	this.editingArea.appendChild(this.object);
+	this.object.attachEvent(&quot;DocumentComplete&quot;, dojo.lang.hitch(this, &quot;onLoad&quot;));
+	dojo.lang.forEach(this.events, function (e) {
+		this.object.attachEvent(e.toLowerCase(), dojo.lang.hitch(this, e));
+	}, this);
+	this.object.DocumentHTML = &quot;&lt;!doctype HTML PUBLIC \&quot;-//W3C//DTD HTML 4.01//EN\&quot; \&quot;<A HREF="http://www.w3.org/TR/html4/strict.dtd\">http://www.w3.org/TR/html4/strict.dtd\</A>&quot;&gt;&quot; + &quot;&lt;html&gt;&lt;title&gt;&lt;/title&gt;&quot; + &quot;&lt;style type=\&quot;text/css\&quot;&gt;&quot; + &quot;	body,html { padding: 0; margin: 0; }&quot; + (this.height ? &quot;&quot; : &quot;	body,  { overflow: hidden; }&quot;) + &quot;&lt;/style&gt;&quot; + &quot;&lt;body&gt;&lt;div&gt;&quot; + html + &quot;&lt;div&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
+	this._cacheLocalBlockFormatNames();
+}, _local2NativeFormatNames:{}, _native2LocalFormatNames:{}, _cacheLocalBlockFormatNames:function () {
+	if (!this._native2LocalFormatNames[&quot;p&quot;]) {
+		var obj = this.object;
+		var error = false;
+		if (!obj) {
+			try {
+				obj = dojo.html.createExternalElement(dojo.doc(), &quot;object&quot;);
+				obj.classid = &quot;clsid:2D360201-FFF5-11D1-8D03-00A0C959BC0A&quot;;
+				dojo.body().appendChild(obj);
+				obj.DocumentHTML = &quot;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;&quot;;
+			}
+			catch (e) {
+				error = true;
+			}
+		}
+		try {
+			var oNamesParm = new ActiveXObject(&quot;DEGetBlockFmtNamesParam.DEGetBlockFmtNamesParam&quot;);
+			obj.ExecCommand(this._activeX.command[&quot;getblockformatnames&quot;], 0, oNamesParm);
+			var vbNamesArray = new VBArray(oNamesParm.Names);
+			var localFormats = vbNamesArray.toArray();
+			var nativeFormats = [&quot;p&quot;, &quot;pre&quot;, &quot;address&quot;, &quot;h1&quot;, &quot;h2&quot;, &quot;h3&quot;, &quot;h4&quot;, &quot;h5&quot;, &quot;h6&quot;, &quot;ol&quot;, &quot;ul&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;div&quot;];
+			for (var i = 0; i &lt; nativeFormats.length; ++i) {
+				if (nativeFormats[i].length &gt; 0) {
+					this._local2NativeFormatNames[localFormats[i]] = nativeFormats[i];
+					this._native2LocalFormatNames[nativeFormats[i]] = localFormats[i];
+				}
+			}
+		}
+		catch (e) {
+			error = true;
+		}
+		if (obj &amp;&amp; !this.object) {
+			dojo.body().removeChild(obj);
+		}
+	}
+	return !error;
+}, _isResized:function () {
+	return false;
+}, onLoad:function (e) {
+	this.isLoaded = true;
+	if (this.object) {
+		this.document = this.object.DOM;
+		this.window = this.document.parentWindow;
+		this.editNode = this.document.body.firstChild;
+		this.editingArea.style.height = this.height ? this.height : this.minHeight;
+		if (!this.height) {
+			this.connect(this, &quot;onDisplayChanged&quot;, &quot;_updateHeight&quot;);
+		}
+		this.window._frameElement = this.object;
+	} else {
+		if (this.iframe &amp;&amp; !dojo.render.html.ie) {
+			this.editNode = this.document.body;
+			if (!this.height) {
+				this.connect(this, &quot;onDisplayChanged&quot;, &quot;_updateHeight&quot;);
+			}
+			try {
+				this.document.execCommand(&quot;useCSS&quot;, false, true);
+				this.document.execCommand(&quot;styleWithCSS&quot;, false, false);
+			}
+			catch (e2) {
+			}
+			if (dojo.render.html.safari) {
+				this.connect(this.editNode, &quot;onblur&quot;, &quot;onBlur&quot;);
+				this.connect(this.editNode, &quot;onfocus&quot;, &quot;onFocus&quot;);
+				this.connect(this.editNode, &quot;onclick&quot;, &quot;onFocus&quot;);
+				this.interval = setInterval(dojo.lang.hitch(this, &quot;onDisplayChanged&quot;), 750);
+			} else {
+				if (dojo.render.html.mozilla || dojo.render.html.opera) {
+					var doc = this.document;
+					var addListener = dojo.event.browser.addListener;
+					var self = this;
+					dojo.lang.forEach(this.events, function (e) {
+						var l = addListener(self.document, e.substr(2).toLowerCase(), dojo.lang.hitch(self, e));
+						if (e == &quot;onBlur&quot;) {
+							var unBlur = {unBlur:function (e) {
+								dojo.event.browser.removeListener(doc, &quot;blur&quot;, l);
+							}};
+							dojo.event.connect(&quot;before&quot;, self, &quot;close&quot;, unBlur, &quot;unBlur&quot;);
+						}
+					});
+				}
+			}
+		} else {
+			if (dojo.render.html.ie) {
+				if (!this.height) {
+					this.connect(this, &quot;onDisplayChanged&quot;, &quot;_updateHeight&quot;);
+				}
+				this.editNode.style.zoom = 1;
+			}
+		}
+	}
+	this._applyEditingAreaStyleSheets();
+	if (this.focusOnLoad) {
+		this.focus();
+	}
+	this.onDisplayChanged(e);
+	if (this.onLoadDeferred) {
+		this.onLoadDeferred.callback(true);
+	}
+}, onKeyDown:function (e) {
+	if ((!e) &amp;&amp; (this.object)) {
+		e = dojo.event.browser.fixEvent(this.window.event);
+	}
+	if ((dojo.render.html.ie) &amp;&amp; (e.keyCode == e.KEY_TAB)) {
+		e.preventDefault();
+		e.stopPropagation();
+		this.execCommand((e.shiftKey ? &quot;outdent&quot; : &quot;indent&quot;));
+	} else {
+		if (dojo.render.html.ie) {
+			if ((65 &lt;= e.keyCode) &amp;&amp; (e.keyCode &lt;= 90)) {
+				e.charCode = e.keyCode;
+				this.onKeyPress(e);
+			}
+		}
+	}
+}, onKeyUp:function (e) {
+	return;
+}, KEY_CTRL:1, onKeyPress:function (e) {
+	if ((!e) &amp;&amp; (this.object)) {
+		e = dojo.event.browser.fixEvent(this.window.event);
+	}
+	var modifiers = e.ctrlKey ? this.KEY_CTRL : 0;
+	if (this._keyHandlers[e.key]) {
+		var handlers = this._keyHandlers[e.key], i = 0, handler;
+		while (handler = handlers[i++]) {
+			if (modifiers == handler.modifiers) {
+				e.preventDefault();
+				handler.handler.call(this);
+				break;
+			}
+		}
+	}
+	dojo.lang.setTimeout(this, this.onKeyPressed, 1, e);
+}, addKeyHandler:function (key, modifiers, handler) {
+	if (!(this._keyHandlers[key] instanceof Array)) {
+		this._keyHandlers[key] = [];
+	}
+	this._keyHandlers[key].push({modifiers:modifiers || 0, handler:handler});
+}, onKeyPressed:function (e) {
+	this.onDisplayChanged();
+}, onClick:function (e) {
+	this.onDisplayChanged(e);
+}, onBlur:function (e) {
+}, _initialFocus:true, onFocus:function (e) {
+	if ((dojo.render.html.mozilla) &amp;&amp; (this._initialFocus)) {
+		this._initialFocus = false;
+		if (dojo.string.trim(this.editNode.innerHTML) == &quot;&nbsp;&quot;) {
+			this.placeCursorAtStart();
+		}
+	}
+}, blur:function () {
+	if (this.iframe) {
+		this.window.blur();
+	} else {
+		if (this.object) {
+			this.document.body.blur();
+		} else {
+			if (this.editNode) {
+				this.editNode.blur();
+			}
+		}
+	}
+}, focus:function () {
+	if (this.iframe &amp;&amp; !dojo.render.html.ie) {
+		this.window.focus();
+	} else {
+		if (this.object) {
+			this.document.focus();
+		} else {
+			if (this.editNode &amp;&amp; this.editNode.focus) {
+				this.editNode.focus();
+			} else {
+				dojo.debug(&quot;Have no idea how to focus into the editor!&quot;);
+			}
+		}
+	}
+}, onDisplayChanged:function (e) {
+}, _activeX:{command:{bold:5000, italic:5023, underline:5048, justifycenter:5024, justifyleft:5025, justifyright:5026, cut:5003, copy:5002, paste:5032, &quot;delete&quot;:5004, undo:5049, redo:5033, removeformat:5034, selectall:5035, unlink:5050, indent:5018, outdent:5031, insertorderedlist:5030, insertunorderedlist:5051, inserttable:5022, insertcell:5019, insertcol:5020, insertrow:5021, deletecells:5005, deletecols:5006, deleterows:5007, mergecells:5029, splitcell:5047, setblockformat:5043, getblockformat:5011, getblockformatnames:5012, setfontname:5044, getfontname:5013, setfontsize:5045, getfontsize:5014, setbackcolor:5042, getbackcolor:5010, setforecolor:5046, getforecolor:5015, findtext:5008, font:5009, hyperlink:5016, image:5017, lockelement:5027, makeabsolute:5028, sendbackward:5036, bringforward:5037, sendbelowtext:5038, bringabovetext:5039, sendtoback:5040, bringtofront:5041, properties:5052}, ui:{&quot;default&quot;:0, prompt:1, noprompt:2}, status:{notsupported:0, disabled:1, enable!
 d:3, latched:7, ninched:11}, appearance:{flat:0, inset:1}, state:{unchecked:0, checked:1, gray:2}}, _normalizeCommand:function (cmd) {
+	var drh = dojo.render.html;
+	var command = cmd.toLowerCase();
+	if (command == &quot;formatblock&quot;) {
+		if (drh.safari) {
+			command = &quot;heading&quot;;
+		}
+	} else {
+		if (this.object) {
+			switch (command) {
+			  case &quot;createlink&quot;:
+				command = &quot;hyperlink&quot;;
+				break;
+			  case &quot;insertimage&quot;:
+				command = &quot;image&quot;;
+				break;
+			}
+		} else {
+			if (command == &quot;hilitecolor&quot; &amp;&amp; !drh.mozilla) {
+				command = &quot;backcolor&quot;;
+			}
+		}
+	}
+	return command;
+}, _safariIsLeopard:function () {
+	var gt420 = false;
+	if (dojo.render.html.safari) {
+		var tmp = dojo.render.html.UA.split(&quot;AppleWebKit/&quot;)[1];
+		var ver = parseFloat(tmp.split(&quot; &quot;)[0]);
+		if (ver &gt;= 420) {
+			gt420 = true;
+		}
+	}
+	return gt420;
+}, queryCommandAvailable:function (command) {
+	var ie = 1;
+	var mozilla = 1 &lt;&lt; 1;
+	var safari = 1 &lt;&lt; 2;
+	var opera = 1 &lt;&lt; 3;
+	var safari420 = 1 &lt;&lt; 4;
+	var gt420 = this._safariIsLeopard();
+	function isSupportedBy(browsers) {
+		return {ie:Boolean(browsers &amp; ie), mozilla:Boolean(browsers &amp; mozilla), safari:Boolean(browsers &amp; safari), safari420:Boolean(browsers &amp; safari420), opera:Boolean(browsers &amp; opera)};
+	}
+	var supportedBy = null;
+	switch (command.toLowerCase()) {
+	  case &quot;bold&quot;:
+	  case &quot;italic&quot;:
+	  case &quot;underline&quot;:
+	  case &quot;subscript&quot;:
+	  case &quot;superscript&quot;:
+	  case &quot;fontname&quot;:
+	  case &quot;fontsize&quot;:
+	  case &quot;forecolor&quot;:
+	  case &quot;hilitecolor&quot;:
+	  case &quot;justifycenter&quot;:
+	  case &quot;justifyfull&quot;:
+	  case &quot;justifyleft&quot;:
+	  case &quot;justifyright&quot;:
+	  case &quot;delete&quot;:
+	  case &quot;selectall&quot;:
+		supportedBy = isSupportedBy(mozilla | ie | safari | opera);
+		break;
+	  case &quot;createlink&quot;:
+	  case &quot;unlink&quot;:
+	  case &quot;removeformat&quot;:
+	  case &quot;inserthorizontalrule&quot;:
+	  case &quot;insertimage&quot;:
+	  case &quot;insertorderedlist&quot;:
+	  case &quot;insertunorderedlist&quot;:
+	  case &quot;indent&quot;:
+	  case &quot;outdent&quot;:
+	  case &quot;formatblock&quot;:
+	  case &quot;inserthtml&quot;:
+	  case &quot;undo&quot;:
+	  case &quot;redo&quot;:
+	  case &quot;strikethrough&quot;:
+		supportedBy = isSupportedBy(mozilla | ie | opera | safari420);
+		break;
+	  case &quot;blockdirltr&quot;:
+	  case &quot;blockdirrtl&quot;:
+	  case &quot;dirltr&quot;:
+	  case &quot;dirrtl&quot;:
+	  case &quot;inlinedirltr&quot;:
+	  case &quot;inlinedirrtl&quot;:
+		supportedBy = isSupportedBy(ie);
+		break;
+	  case &quot;cut&quot;:
+	  case &quot;copy&quot;:
+	  case &quot;paste&quot;:
+		supportedBy = isSupportedBy(ie | mozilla | safari420);
+		break;
+	  case &quot;inserttable&quot;:
+		supportedBy = isSupportedBy(mozilla | (this.object ? ie : 0));
+		break;
+	  case &quot;insertcell&quot;:
+	  case &quot;insertcol&quot;:
+	  case &quot;insertrow&quot;:
+	  case &quot;deletecells&quot;:
+	  case &quot;deletecols&quot;:
+	  case &quot;deleterows&quot;:
+	  case &quot;mergecells&quot;:
+	  case &quot;splitcell&quot;:
+		supportedBy = isSupportedBy(this.object ? ie : 0);
+		break;
+	  default:
+		return false;
+	}
+	return (dojo.render.html.ie &amp;&amp; supportedBy.ie) || (dojo.render.html.mozilla &amp;&amp; supportedBy.mozilla) || (dojo.render.html.safari &amp;&amp; supportedBy.safari) || (gt420 &amp;&amp; supportedBy.safari420) || (dojo.render.html.opera &amp;&amp; supportedBy.opera);
+}, execCommand:function (command, argument) {
+	var returnValue;
+	this.focus();
+	command = this._normalizeCommand(command);
+	if (argument != undefined) {
+		if (command == &quot;heading&quot;) {
+			throw new Error(&quot;unimplemented&quot;);
+		} else {
+			if (command == &quot;formatblock&quot;) {
+				if (this.object) {
+					argument = this._native2LocalFormatNames[argument];
+				} else {
+					if (dojo.render.html.ie) {
+						argument = &quot;&lt;&quot; + argument + &quot;&gt;&quot;;
+					}
+				}
+			}
+		}
+	}
+	if (this.object) {
+		switch (command) {
+		  case &quot;hilitecolor&quot;:
+			command = &quot;setbackcolor&quot;;
+			break;
+		  case &quot;forecolor&quot;:
+		  case &quot;backcolor&quot;:
+		  case &quot;fontsize&quot;:
+		  case &quot;fontname&quot;:
+			command = &quot;set&quot; + command;
+			break;
+		  case &quot;formatblock&quot;:
+			command = &quot;setblockformat&quot;;
+		}
+		if (command == &quot;strikethrough&quot;) {
+			command = &quot;inserthtml&quot;;
+			var range = this.document.selection.createRange();
+			if (!range.htmlText) {
+				return;
+			}
+			argument = range.htmlText.strike();
+		} else {
+			if (command == &quot;inserthorizontalrule&quot;) {
+				command = &quot;inserthtml&quot;;
+				argument = &quot;&lt;hr&gt;&quot;;
+			}
+		}
+		if (command == &quot;inserthtml&quot;) {
+			var range = this.document.selection.createRange();
+			if (this.document.selection.type.toUpperCase() == &quot;CONTROL&quot;) {
+				for (var i = 0; i &lt; range.length; i++) {
+					range.item(i).outerHTML = argument;
+				}
+			} else {
+				range.pasteHTML(argument);
+				range.select();
+			}
+			returnValue = true;
+		} else {
+			if (arguments.length == 1) {
+				returnValue = this.object.ExecCommand(this._activeX.command[command], this._activeX.ui.noprompt);
+			} else {
+				returnValue = this.object.ExecCommand(this._activeX.command[command], this._activeX.ui.noprompt, argument);
+			}
+		}
+	} else {
+		if (command == &quot;inserthtml&quot;) {
+			if (dojo.render.html.ie) {
+				var insertRange = this.document.selection.createRange();
+				insertRange.pasteHTML(argument);
+				insertRange.select();
+				return true;
+			} else {
+				return this.document.execCommand(command, false, argument);
+			}
+		} else {
+			if ((command == &quot;unlink&quot;) &amp;&amp; (this.queryCommandEnabled(&quot;unlink&quot;)) &amp;&amp; (dojo.render.html.mozilla)) {
+				var selection = this.window.getSelection();
+				var selectionRange = selection.getRangeAt(0);
+				var selectionStartContainer = selectionRange.startContainer;
+				var selectionStartOffset = selectionRange.startOffset;
+				var selectionEndContainer = selectionRange.endContainer;
+				var selectionEndOffset = selectionRange.endOffset;
+				var a = dojo.withGlobal(this.window, &quot;getAncestorElement&quot;, dojo.html.selection, [&quot;a&quot;]);
+				dojo.withGlobal(this.window, &quot;selectElement&quot;, dojo.html.selection, [a]);
+				returnValue = this.document.execCommand(&quot;unlink&quot;, false, null);
+				var selectionRange = this.document.createRange();
+				selectionRange.setStart(selectionStartContainer, selectionStartOffset);
+				selectionRange.setEnd(selectionEndContainer, selectionEndOffset);
+				selection.removeAllRanges();
+				selection.addRange(selectionRange);
+				return returnValue;
+			} else {
+				if ((command == &quot;hilitecolor&quot;) &amp;&amp; (dojo.render.html.mozilla)) {
+					this.document.execCommand(&quot;useCSS&quot;, false, false);
+					returnValue = this.document.execCommand(command, false, argument);
+					this.document.execCommand(&quot;useCSS&quot;, false, true);
+				} else {
+					if ((dojo.render.html.ie) &amp;&amp; ((command == &quot;backcolor&quot;) || (command == &quot;forecolor&quot;))) {
+						argument = arguments.length &gt; 1 ? argument : null;
+						returnValue = this.document.execCommand(command, false, argument);
+					} else {
+						argument = arguments.length &gt; 1 ? argument : null;
+						if (argument || command != &quot;createlink&quot;) {
+							returnValue = this.document.execCommand(command, false, argument);
+						}
+					}
+				}
+			}
+		}
+	}
+	this.onDisplayChanged();
+	return returnValue;
+}, queryCommandEnabled:function (command) {
+	command = this._normalizeCommand(command);
+	if (this.object) {
+		switch (command) {
+		  case &quot;hilitecolor&quot;:
+			command = &quot;setbackcolor&quot;;
+			break;
+		  case &quot;forecolor&quot;:
+		  case &quot;backcolor&quot;:
+		  case &quot;fontsize&quot;:
+		  case &quot;fontname&quot;:
+			command = &quot;set&quot; + command;
+			break;
+		  case &quot;formatblock&quot;:
+			command = &quot;setblockformat&quot;;
+			break;
+		  case &quot;strikethrough&quot;:
+			command = &quot;bold&quot;;
+			break;
+		  case &quot;inserthorizontalrule&quot;:
+			return true;
+		}
+		if (typeof this._activeX.command[command] == &quot;undefined&quot;) {
+			return false;
+		}
+		var status = this.object.QueryStatus(this._activeX.command[command]);
+		return ((status != this._activeX.status.notsupported) &amp;&amp; (status != this._activeX.status.disabled));
+	} else {
+		if (dojo.render.html.mozilla) {
+			if (command == &quot;unlink&quot;) {
+				return dojo.withGlobal(this.window, &quot;hasAncestorElement&quot;, dojo.html.selection, [&quot;a&quot;]);
+			} else {
+				if (command == &quot;inserttable&quot;) {
+					return true;
+				}
+			}
+		}
+		var elem = (dojo.render.html.ie) ? this.document.selection.createRange() : this.document;
+		return elem.queryCommandEnabled(command);
+	}
+}, queryCommandState:function (command) {
+	command = this._normalizeCommand(command);
+	if (this.object) {
+		if (command == &quot;forecolor&quot;) {
+			command = &quot;setforecolor&quot;;
+		} else {
+			if (command == &quot;backcolor&quot;) {
+				command = &quot;setbackcolor&quot;;
+			} else {
+				if (command == &quot;strikethrough&quot;) {
+					return dojo.withGlobal(this.window, &quot;hasAncestorElement&quot;, dojo.html.selection, [&quot;strike&quot;]);
+				} else {
+					if (command == &quot;inserthorizontalrule&quot;) {
+						return false;
+					}
+				}
+			}
+		}
+		if (typeof this._activeX.command[command] == &quot;undefined&quot;) {
+			return null;
+		}
+		var status = this.object.QueryStatus(this._activeX.command[command]);
+		return ((status == this._activeX.status.latched) || (status == this._activeX.status.ninched));
+	} else {
+		return this.document.queryCommandState(command);
+	}
+}, queryCommandValue:function (command) {
+	command = this._normalizeCommand(command);
+	if (this.object) {
+		switch (command) {
+		  case &quot;forecolor&quot;:
+		  case &quot;backcolor&quot;:
+		  case &quot;fontsize&quot;:
+		  case &quot;fontname&quot;:
+			command = &quot;get&quot; + command;
+			return this.object.execCommand(this._activeX.command[command], this._activeX.ui.noprompt);
+		  case &quot;formatblock&quot;:
+			var retvalue = this.object.execCommand(this._activeX.command[&quot;getblockformat&quot;], this._activeX.ui.noprompt);
+			if (retvalue) {
+				return this._local2NativeFormatNames[retvalue];
+			}
+		}
+	} else {
+		if (dojo.render.html.ie &amp;&amp; command == &quot;formatblock&quot;) {
+			return this._local2NativeFormatNames[this.document.queryCommandValue(command)] || this.document.queryCommandValue(command);
+		}
+		return this.document.queryCommandValue(command);
+	}
+}, placeCursorAtStart:function () {
+	this.focus();
+	if (dojo.render.html.moz &amp;&amp; this.editNode.firstChild &amp;&amp; this.editNode.firstChild.nodeType != dojo.dom.TEXT_NODE) {
+		dojo.withGlobal(this.window, &quot;selectElementChildren&quot;, dojo.html.selection, [this.editNode.firstChild]);
+	} else {
+		dojo.withGlobal(this.window, &quot;selectElementChildren&quot;, dojo.html.selection, [this.editNode]);
+	}
+	dojo.withGlobal(this.window, &quot;collapse&quot;, dojo.html.selection, [true]);
+}, placeCursorAtEnd:function () {
+	this.focus();
+	if (dojo.render.html.moz &amp;&amp; this.editNode.lastChild &amp;&amp; this.editNode.lastChild.nodeType != dojo.dom.TEXT_NODE) {
+		dojo.withGlobal(this.window, &quot;selectElementChildren&quot;, dojo.html.selection, [this.editNode.lastChild]);
+	} else {
+		dojo.withGlobal(this.window, &quot;selectElementChildren&quot;, dojo.html.selection, [this.editNode]);
+	}
+	dojo.withGlobal(this.window, &quot;collapse&quot;, dojo.html.selection, [false]);
+}, replaceEditorContent:function (html) {
+	html = this._preFilterContent(html);
+	if (this.isClosed) {
+		this.domNode.innerHTML = html;
+	} else {
+		if (this.window &amp;&amp; this.window.getSelection &amp;&amp; !dojo.render.html.moz) {
+			this.editNode.innerHTML = html;
+		} else {
+			if ((this.window &amp;&amp; this.window.getSelection) || (this.document &amp;&amp; this.document.selection)) {
+				this.execCommand(&quot;selectall&quot;);
+				if (dojo.render.html.moz &amp;&amp; !html) {
+					html = &quot;&nbsp;&quot;;
+				}
+				this.execCommand(&quot;inserthtml&quot;, html);
+			}
+		}
+	}
+}, _preFilterContent:function (html) {
+	var ec = html;
+	dojo.lang.forEach(this.contentPreFilters, function (ef) {
+		ec = ef(ec);
+	});
+	if (this.contentDomPreFilters.length &gt; 0) {
+		var dom = dojo.doc().createElement(&quot;div&quot;);
+		dom.style.display = &quot;none&quot;;
+		dojo.body().appendChild(dom);
+		dom.innerHTML = ec;
+		dojo.lang.forEach(this.contentDomPreFilters, function (ef) {
+			dom = ef(dom);
+		});
+		ec = dom.innerHTML;
+		dojo.body().removeChild(dom);
+	}
+	return ec;
+}, _postFilterContent:function (html) {
+	var ec = html;
+	if (this.contentDomPostFilters.length &gt; 0) {
+		var dom = this.document.createElement(&quot;div&quot;);
+		dom.innerHTML = ec;
+		dojo.lang.forEach(this.contentDomPostFilters, function (ef) {
+			dom = ef(dom);
+		});
+		ec = dom.innerHTML;
+	}
+	dojo.lang.forEach(this.contentPostFilters, function (ef) {
+		ec = ef(ec);
+	});
+	return ec;
+}, _lastHeight:0, _updateHeight:function () {
+	if (!this.isLoaded) {
+		return;
+	}
+	if (this.height) {
+		return;
+	}
+	var height = dojo.html.getBorderBox(this.editNode).height;
+	if (!height) {
+		height = dojo.html.getBorderBox(this.document.body).height;
+	}
+	if (height == 0) {
+		dojo.debug(&quot;Can not figure out the height of the editing area!&quot;);
+		return;
+	}
+	this._lastHeight = height;
+	this.editorObject.style.height = this._lastHeight + &quot;px&quot;;
+	this.window.scrollTo(0, 0);
+}, _saveContent:function (e) {
+	var saveTextarea = dojo.doc().getElementById(&quot;dojo.widget.RichText.savedContent&quot;);
+	saveTextarea.value += this._SEPARATOR + this.saveName + &quot;:&quot; + this.getEditorContent();
+}, getEditorContent:function () {
+	var ec = &quot;&quot;;
+	try {
+		ec = (this._content.length &gt; 0) ? this._content : this.editNode.innerHTML;
+		if (dojo.string.trim(ec) == &quot;&nbsp;&quot;) {
+			ec = &quot;&quot;;
+		}
+	}
+	catch (e) {
+	}
+	if (dojo.render.html.ie &amp;&amp; !this.object) {
+		var re = new RegExp(&quot;(?:&lt;p&gt;&nbsp;&lt;/p&gt;[\n\r]*)+$&quot;, &quot;i&quot;);
+		ec = ec.replace(re, &quot;&quot;);
+	}
+	ec = this._postFilterContent(ec);
+	if (this.relativeImageUrls) {
+		var siteBase = dojo.global().location.protocol + &quot;//&quot; + dojo.global().location.host;
+		var pathBase = dojo.global().location.pathname;
+		if (pathBase.match(/\/$/)) {
+		} else {
+			var pathParts = pathBase.split(&quot;/&quot;);
+			if (pathParts.length) {
+				pathParts.pop();
+			}
+			pathBase = pathParts.join(&quot;/&quot;) + &quot;/&quot;;
+		}
+		var sameSite = new RegExp(&quot;(&lt;img[^&gt;]* src=[\&quot;'])(&quot; + siteBase + &quot;(&quot; + pathBase + &quot;)?)&quot;, &quot;ig&quot;);
+		ec = ec.replace(sameSite, &quot;$1&quot;);
+	}
+	return ec;
+}, close:function (save, force) {
+	if (this.isClosed) {
+		return false;
+	}
+	if (arguments.length == 0) {
+		save = true;
+	}
+	this._content = this._postFilterContent(this.editNode.innerHTML);
+	var changed = (this.savedContent != this._content);
+	if (this.interval) {
+		clearInterval(this.interval);
+	}
+	if (dojo.render.html.ie &amp;&amp; !this.object) {
+		dojo.event.browser.clean(this.editNode);
+	}
+	if (this.iframe) {
+		delete this.iframe;
+	}
+	if (this.textarea) {
+		with (this.textarea.style) {
+			position = &quot;&quot;;
+			left = top = &quot;&quot;;
+			if (dojo.render.html.ie) {
+				overflow = this.__overflow;
+				this.__overflow = null;
+			}
+		}
+		if (save) {
+			this.textarea.value = this._content;
+		} else {
+			this.textarea.value = this.savedContent;
+		}
+		dojo.html.removeNode(this.domNode);
+		this.domNode = this.textarea;
+	} else {
+		if (save) {
+			if (dojo.render.html.moz) {
+				var nc = dojo.doc().createElement(&quot;span&quot;);
+				this.domNode.appendChild(nc);
+				nc.innerHTML = this.editNode.innerHTML;
+			} else {
+				this.domNode.innerHTML = this._content;
+			}
+		} else {
+			this.domNode.innerHTML = this.savedContent;
+		}
+	}
+	dojo.html.removeClass(this.domNode, &quot;RichTextEditable&quot;);
+	this.isClosed = true;
+	this.isLoaded = false;
+	delete this.editNode;
+	if (this.window._frameElement) {
+		this.window._frameElement = null;
+	}
+	this.window = null;
+	this.document = null;
+	this.object = null;
+	this.editingArea = null;
+	this.editorObject = null;
+	return changed;
+}, destroyRendering:function () {
+}, destroy:function () {
+	this.destroyRendering();
+	if (!this.isClosed) {
+		this.close(false);
+	}
+	dojo.widget.RichText.superclass.destroy.call(this);
+}, connect:function (targetObj, targetFunc, thisFunc) {
+	dojo.event.connect(targetObj, targetFunc, this, thisFunc);
+}, disconnect:function (targetObj, targetFunc, thisFunc) {
+	dojo.event.disconnect(targetObj, targetFunc, this, thisFunc);
+}, disconnectAllWithRoot:function (targetObj) {
+	dojo.deprecated(&quot;disconnectAllWithRoot&quot;, &quot;is deprecated. No need to disconnect manually&quot;, &quot;0.5&quot;);
+}, _fixContentForMoz:function (html) {
+	html = html.replace(/&lt;strong([ \&gt;])/gi, &quot;&lt;b$1&quot;);
+	html = html.replace(/&lt;\/strong&gt;/gi, &quot;&lt;/b&gt;&quot;);
+	html = html.replace(/&lt;em([ \&gt;])/gi, &quot;&lt;i$1&quot;);
+	html = html.replace(/&lt;\/em&gt;/gi, &quot;&lt;/i&gt;&quot;);
+	return html;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Rounded.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Rounded.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Rounded.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,529 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Rounded&quot;);
+dojo.widget.tags.addParseTreeHandler(&quot;dojo:rounded&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.deprecated(&quot;dojo.widget.Rounded will be removed in version 0.5; you can now apply rounded corners to any block element using dojo.lfx.rounded.&quot;, &quot;0.5&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Rounded&quot;, dojo.widget.ContentPane, {isSafari:dojo.render.html.safari, boxMargin:&quot;50px&quot;, radius:14, domNode:&quot;&quot;, corners:&quot;TR,TL,BR,BL&quot;, antiAlias:true, fillInTemplate:function (args, frag) {
+	dojo.widget.Rounded.superclass.fillInTemplate.call(this, args, frag);
+	dojo.html.insertCssFile(this.templateCssPath);
+	if (this.domNode.style.height &lt;= 0) {
+		var minHeight = (this.radius * 1) + this.domNode.clientHeight;
+		this.domNode.style.height = minHeight + &quot;px&quot;;
+	}
+	if (this.domNode.style.width &lt;= 0) {
+		var minWidth = (this.radius * 1) + this.domNode.clientWidth;
+		this.domNode.style.width = minWidth + &quot;px&quot;;
+	}
+	var cornersAvailable = [&quot;TR&quot;, &quot;TL&quot;, &quot;BR&quot;, &quot;BL&quot;];
+	var cornersPassed = this.corners.split(&quot;,&quot;);
+	this.settings = {antiAlias:this.antiAlias};
+	var setCorner = function (currentCorner) {
+		var val = currentCorner.toLowerCase();
+		if (dojo.lang.inArray(cornersPassed, currentCorner)) {
+			this.settings[val] = {radius:this.radius, enabled:true};
+		} else {
+			this.settings[val] = {radius:0};
+		}
+	};
+	dojo.lang.forEach(cornersAvailable, setCorner, this);
+	this.domNode.style.margin = this.boxMargin;
+	this.curvyCorners(this.settings);
+	this.applyCorners();
+}, curvyCorners:function (settings) {
+	this.box = this.domNode;
+	this.topContainer = null;
+	this.bottomContainer = null;
+	this.masterCorners = [];
+	var boxHeight = dojo.html.getStyle(this.box, &quot;height&quot;);
+	if (boxHeight == &quot;&quot;) {
+		boxHeight = &quot;0px&quot;;
+	}
+	var boxWidth = dojo.html.getStyle(this.box, &quot;width&quot;);
+	var borderWidth = dojo.html.getStyle(this.box, &quot;borderTopWidth&quot;);
+	if (borderWidth == &quot;&quot;) {
+		borderWidth = &quot;0px&quot;;
+	}
+	var borderColour = dojo.html.getStyle(this.box, &quot;borderTopColor&quot;);
+	if (borderWidth &gt; 0) {
+		this.antiAlias = true;
+	}
+	var boxColour = dojo.html.getStyle(this.box, &quot;backgroundColor&quot;);
+	var backgroundImage = dojo.html.getStyle(this.box, &quot;backgroundImage&quot;);
+	var boxPosition = dojo.html.getStyle(this.box, &quot;position&quot;);
+	this.boxHeight = parseInt(((boxHeight != &quot;&quot; &amp;&amp; boxHeight != &quot;auto&quot; &amp;&amp; boxHeight.indexOf(&quot;%&quot;) == -1) ? boxHeight.substring(0, boxHeight.indexOf(&quot;px&quot;)) : this.box.scrollHeight));
+	this.boxWidth = parseInt(((boxWidth != &quot;&quot; &amp;&amp; boxWidth != &quot;auto&quot; &amp;&amp; boxWidth.indexOf(&quot;%&quot;) == -1) ? boxWidth.substring(0, boxWidth.indexOf(&quot;px&quot;)) : this.box.scrollWidth));
+	this.borderWidth = parseInt(((borderWidth != &quot;&quot; &amp;&amp; borderWidth.indexOf(&quot;px&quot;) !== -1) ? borderWidth.slice(0, borderWidth.indexOf(&quot;px&quot;)) : 0));
+	var test = new dojo.gfx.color.Color(boxColour);
+	this.boxColour = ((boxColour != &quot;&quot; &amp;&amp; boxColour != &quot;transparent&quot;) ? ((boxColour.substr(0, 3) == &quot;rgb&quot;) ? this.rgb2Hex(boxColour) : boxColour) : &quot;#ffffff&quot;);
+	this.borderColour = ((borderColour != &quot;&quot; &amp;&amp; borderColour != &quot;transparent&quot; &amp;&amp; this.borderWidth &gt; 0) ? ((borderColour.substr(0, 3) == &quot;rgb&quot;) ? this.rgb2Hex(borderColour) : borderColour) : this.boxColour);
+	this.borderString = this.borderWidth + &quot;px&quot; + &quot; solid &quot; + this.borderColour;
+	this.backgroundImage = ((backgroundImage != &quot;none&quot;) ? backgroundImage : &quot;&quot;);
+	if (boxPosition != &quot;absolute&quot;) {
+		this.box.style.position = &quot;relative&quot;;
+	}
+	this.applyCorners = function () {
+		for (var t = 0; t &lt; 2; t++) {
+			switch (t) {
+			  case 0:
+				if (this.settings.tl.enabled || this.settings.tr.enabled) {
+					var newMainContainer = document.createElement(&quot;DIV&quot;);
+					with (newMainContainer.style) {
+						width = &quot;100%&quot;;
+						fontSize = &quot;1px&quot;;
+						overflow = &quot;hidden&quot;;
+						position = &quot;absolute&quot;;
+						paddingLeft = this.borderWidth + &quot;px&quot;;
+						paddingRight = this.borderWidth + &quot;px&quot;;
+						var topMaxRadius = Math.max(this.settings.tl ? this.settings.tl.radius : 0, this.settings.tr ? this.settings.tr.radius : 0);
+						height = topMaxRadius + &quot;px&quot;;
+						top = 0 - topMaxRadius + &quot;px&quot;;
+						left = 0 - this.borderWidth + &quot;px&quot;;
+					}
+					this.topContainer = this.box.appendChild(newMainContainer);
+				}
+				break;
+			  case 1:
+				if (this.settings.bl.enabled || this.settings.br.enabled) {
+					var newMainContainer = document.createElement(&quot;DIV&quot;);
+					with (newMainContainer.style) {
+						width = &quot;100%&quot;;
+						fontSize = &quot;1px&quot;;
+						overflow = &quot;hidden&quot;;
+						position = &quot;absolute&quot;;
+						paddingLeft = this.borderWidth + &quot;px&quot;;
+						paddingRight = this.borderWidth + &quot;px&quot;;
+						var botMaxRadius = Math.max(this.settings.bl ? this.settings.bl.radius : 0, this.settings.br ? this.settings.br.radius : 0);
+						height = botMaxRadius + &quot;px&quot;;
+						bottom = 0 - botMaxRadius + &quot;px&quot;;
+						left = 0 - this.borderWidth + &quot;px&quot;;
+					}
+					this.bottomContainer = this.box.appendChild(newMainContainer);
+				}
+				break;
+			}
+		}
+		if (this.topContainer) {
+			this.box.style.borderTopWidth = &quot;0px&quot;;
+		}
+		if (this.bottomContainer) {
+			this.box.style.borderBottomWidth = &quot;0px&quot;;
+		}
+		var corners = [&quot;tr&quot;, &quot;tl&quot;, &quot;br&quot;, &quot;bl&quot;];
+		for (var i in corners) {
+			var cc = corners[i];
+			if (!this.settings[cc]) {
+				if (((cc == &quot;tr&quot; || cc == &quot;tl&quot;) &amp;&amp; this.topContainer != null) || ((cc == &quot;br&quot; || cc == &quot;bl&quot;) &amp;&amp; this.bottomContainer != null)) {
+					var newCorner = document.createElement(&quot;DIV&quot;);
+					newCorner.style.position = &quot;relative&quot;;
+					newCorner.style.fontSize = &quot;1px&quot;;
+					newCorner.style.overflow = &quot;hidden&quot;;
+					if (this.backgroundImage == &quot;&quot;) {
+						newCorner.style.backgroundColor = this.boxColour;
+					} else {
+						newCorner.style.backgroundImage = this.backgroundImage;
+					}
+					switch (cc) {
+					  case &quot;tl&quot;:
+						with (newCorner.style) {
+							height = topMaxRadius - this.borderWidth + &quot;px&quot;;
+							marginRight = this.settings.tr.radius - (this.borderWidth * 2) + &quot;px&quot;;
+							borderLeft = this.borderString;
+							borderTop = this.borderString;
+							left = -this.borderWidth + &quot;px&quot;;
+						}
+						break;
+					  case &quot;tr&quot;:
+						with (newCorner.style) {
+							height = topMaxRadius - this.borderWidth + &quot;px&quot;;
+							marginLeft = this.settings.tl.radius - (this.borderWidth * 2) + &quot;px&quot;;
+							borderRight = this.borderString;
+							borderTop = this.borderString;
+							backgroundPosition = &quot;-&quot; + this.boxWidth + &quot;px 0px&quot;;
+							left = this.borderWidth + &quot;px&quot;;
+						}
+						break;
+					  case &quot;bl&quot;:
+						with (newCorner.style) {
+							height = botMaxRadius - this.borderWidth + &quot;px&quot;;
+							marginRight = this.settings.br.radius - (this.borderWidth * 2) + &quot;px&quot;;
+							borderLeft = this.borderString;
+							borderBottom = this.borderString;
+							left = -this.borderWidth + &quot;px&quot;;
+						}
+						break;
+					  case &quot;br&quot;:
+						with (newCorner.style) {
+							height = botMaxRadius - this.borderWidth + &quot;px&quot;;
+							marginLeft = this.settings.bl.radius - (this.borderWidth * 2) + &quot;px&quot;;
+							borderRight = this.borderString;
+							borderBottom = this.borderString;
+							left = this.borderWidth + &quot;px&quot;;
+						}
+						break;
+					}
+				}
+			} else {
+				if (this.masterCorners[this.settings[cc].radius]) {
+					var newCorner = this.masterCorners[this.settings[cc].radius].cloneNode(true);
+				} else {
+					var newCorner = document.createElement(&quot;DIV&quot;);
+					with (newCorner.style) {
+						height = this.settings[cc].radius + &quot;px&quot;;
+						width = this.settings[cc].radius + &quot;px&quot;;
+						position = &quot;absolute&quot;;
+						fontSize = &quot;1px&quot;;
+						overflow = &quot;hidden&quot;;
+					}
+					var borderRadius = parseInt(this.settings[cc].radius - this.borderWidth);
+					for (var intx = 0, j = this.settings[cc].radius; intx &lt; j; intx++) {
+						if ((intx + 1) &gt;= borderRadius) {
+							var y1 = -1;
+						} else {
+							var y1 = (Math.floor(Math.sqrt(Math.pow(borderRadius, 2) - Math.pow((intx + 1), 2))) - 1);
+						}
+						if (borderRadius != j) {
+							if ((intx) &gt;= borderRadius) {
+								var y2 = -1;
+							} else {
+								var y2 = Math.ceil(Math.sqrt(Math.pow(borderRadius, 2) - Math.pow(intx, 2)));
+							}
+							if ((intx + 1) &gt;= j) {
+								var y3 = -1;
+							} else {
+								var y3 = (Math.floor(Math.sqrt(Math.pow(j, 2) - Math.pow((intx + 1), 2))) - 1);
+							}
+						}
+						if ((intx) &gt;= j) {
+							var y4 = -1;
+						} else {
+							var y4 = Math.ceil(Math.sqrt(Math.pow(j, 2) - Math.pow(intx, 2)));
+						}
+						if (y1 &gt; -1) {
+							this.drawPixel(intx, 0, this.boxColour, 100, (y1 + 1), newCorner, -1, this.settings[cc].radius);
+						}
+						if (borderRadius != j) {
+							if (this.antiAlias) {
+								for (var inty = (y1 + 1); inty &lt; y2; inty++) {
+									if (this.backgroundImage != &quot;&quot;) {
+										var borderFract = (this.pixelFraction(intx, inty, borderRadius) * 100);
+										if (borderFract &lt; 30) {
+											this.drawPixel(intx, inty, this.borderColour, 100, 1, newCorner, 0, this.settings[cc].radius);
+										} else {
+											this.drawPixel(intx, inty, this.borderColour, 100, 1, newCorner, -1, this.settings[cc].radius);
+										}
+									} else {
+										var pixelcolour = dojo.gfx.color.blend(this.boxColour, this.borderColour, this.pixelFraction(intx, inty, borderRadius));
+										this.drawPixel(intx, inty, pixelcolour, 100, 1, newCorner, 0, this.settings[cc].radius);
+									}
+								}
+							}
+							if (y3 &gt;= y2) {
+								if (y1 == -1) {
+									y1 = 0;
+								}
+								this.drawPixel(intx, y2, this.borderColour, 100, (y3 - y2 + 1), newCorner, 0, this.settings[cc].radius);
+							}
+							var outsideColour = this.borderColour;
+						} else {
+							var outsideColour = this.boxColour;
+							var y3 = y1;
+						}
+						if (this.antiAlias) {
+							for (var inty = (y3 + 1); inty &lt; y4; inty++) {
+								this.drawPixel(intx, inty, outsideColour, (this.pixelFraction(intx, inty, j) * 100), 1, newCorner, ((this.borderWidth &gt; 0) ? 0 : -1), this.settings[cc].radius);
+							}
+						}
+					}
+					this.masterCorners[this.settings[cc].radius] = newCorner.cloneNode(true);
+				}
+				if (cc != &quot;br&quot;) {
+					for (var t = 0, k = newCorner.childNodes.length; t &lt; k; t++) {
+						var pixelBar = newCorner.childNodes[t];
+						var pixelBarTop = parseInt(pixelBar.style.top.substring(0, pixelBar.style.top.indexOf(&quot;px&quot;)));
+						var pixelBarLeft = parseInt(pixelBar.style.left.substring(0, pixelBar.style.left.indexOf(&quot;px&quot;)));
+						var pixelBarHeight = parseInt(pixelBar.style.height.substring(0, pixelBar.style.height.indexOf(&quot;px&quot;)));
+						if (cc == &quot;tl&quot; || cc == &quot;bl&quot;) {
+							pixelBar.style.left = this.settings[cc].radius - pixelBarLeft - 1 + &quot;px&quot;;
+						}
+						if (cc == &quot;tr&quot; || cc == &quot;tl&quot;) {
+							pixelBar.style.top = this.settings[cc].radius - pixelBarHeight - pixelBarTop + &quot;px&quot;;
+						}
+						var value;
+						switch (cc) {
+						  case &quot;tr&quot;:
+							value = (-1 * (Math.abs((this.boxWidth - this.settings[cc].radius + this.borderWidth) + pixelBarLeft) - (Math.abs(this.settings[cc].radius - pixelBarHeight - pixelBarTop - this.borderWidth))));
+							pixelBar.style.backgroundPosition = value + &quot;px&quot;;
+							break;
+						  case &quot;tl&quot;:
+							value = (-1 * (Math.abs((this.settings[cc].radius - pixelBarLeft - 1) - this.borderWidth) - (Math.abs(this.settings[cc].radius - pixelBarHeight - pixelBarTop - this.borderWidth))));
+							pixelBar.style.backgroundPosition = value + &quot;px&quot;;
+							break;
+						  case &quot;bl&quot;:
+							value = (-1 * (Math.abs((this.settings[cc].radius - pixelBarLeft - 1) - this.borderWidth) - (Math.abs((this.boxHeight + this.settings[cc].radius + pixelBarTop) - this.borderWidth))));
+							pixelBar.style.backgroundPosition = value + &quot;px&quot;;
+							break;
+						}
+					}
+				}
+			}
+			if (newCorner) {
+				switch (cc) {
+				  case &quot;tl&quot;:
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.top = &quot;0px&quot;;
+					}
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.left = &quot;0px&quot;;
+					}
+					if (this.topContainer) {
+						this.topContainer.appendChild(newCorner);
+					}
+					break;
+				  case &quot;tr&quot;:
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.top = &quot;0px&quot;;
+					}
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.right = &quot;0px&quot;;
+					}
+					if (this.topContainer) {
+						this.topContainer.appendChild(newCorner);
+					}
+					break;
+				  case &quot;bl&quot;:
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.bottom = &quot;0px&quot;;
+					}
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.left = &quot;0px&quot;;
+					}
+					if (this.bottomContainer) {
+						this.bottomContainer.appendChild(newCorner);
+					}
+					break;
+				  case &quot;br&quot;:
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.bottom = &quot;0px&quot;;
+					}
+					if (newCorner.style.position == &quot;absolute&quot;) {
+						newCorner.style.right = &quot;0px&quot;;
+					}
+					if (this.bottomContainer) {
+						this.bottomContainer.appendChild(newCorner);
+					}
+					break;
+				}
+			}
+		}
+		var radiusDiff = [];
+		radiusDiff[&quot;t&quot;] = this.settings.tl.enabled &amp;&amp; this.settings.tr.enabled ? Math.abs(this.settings.tl.radius - this.settings.tr.radius) : 0;
+		radiusDiff[&quot;b&quot;] = this.settings.bl.enabled &amp;&amp; this.settings.br.enabled ? Math.abs(this.settings.bl.radius - this.settings.br.radius) : 0;
+		for (var z in radiusDiff) {
+			if (radiusDiff[z]) {
+				var smallerCornerType = ((this.settings[z + &quot;l&quot;].radius &lt; this.settings[z + &quot;r&quot;].radius) ? z + &quot;l&quot; : z + &quot;r&quot;);
+				var newFiller = document.createElement(&quot;DIV&quot;);
+				with (newFiller.style) {
+					height = radiusDiff[z] + &quot;px&quot;;
+					width = this.settings[smallerCornerType].radius + &quot;px&quot;;
+					position = &quot;absolute&quot;;
+					fontSize = &quot;1px&quot;;
+					overflow = &quot;hidden&quot;;
+					backgroundColor = this.boxColour;
+				}
+				switch (smallerCornerType) {
+				  case &quot;tl&quot;:
+					with (newFiller.style) {
+						bottom = &quot;0px&quot;;
+						left = &quot;0px&quot;;
+						borderLeft = this.borderString;
+					}
+					this.topContainer.appendChild(newFiller);
+					break;
+				  case &quot;tr&quot;:
+					with (newFiller.style) {
+						bottom = &quot;0px&quot;;
+						right = &quot;0px&quot;;
+						borderRight = this.borderString;
+					}
+					this.topContainer.appendChild(newFiller);
+					break;
+				  case &quot;bl&quot;:
+					with (newFiller.style) {
+						top = &quot;0px&quot;;
+						left = &quot;0px&quot;;
+						borderLeft = this.borderString;
+					}
+					this.bottomContainer.appendChild(newFiller);
+					break;
+				  case &quot;br&quot;:
+					with (newFiller.style) {
+						top = &quot;0px&quot;;
+						right = &quot;0px&quot;;
+						borderRight = this.borderString;
+					}
+					this.bottomContainer.appendChild(newFiller);
+					break;
+				}
+			}
+			var newFillerBar = document.createElement(&quot;DIV&quot;);
+			with (newFillerBar.style) {
+				position = &quot;relative&quot;;
+				fontSize = &quot;1px&quot;;
+				overflow = &quot;hidden&quot;;
+				backgroundColor = this.boxColour;
+			}
+			switch (z) {
+			  case &quot;t&quot;:
+				if (this.topContainer) {
+					with (newFillerBar.style) {
+						height = topMaxRadius - this.borderWidth + &quot;px&quot;;
+						marginLeft = this.settings.tl.radius - this.borderWidth + &quot;px&quot;;
+						marginRight = this.settings.tr.radius - this.borderWidth + &quot;px&quot;;
+						borderTop = this.borderString;
+					}
+					this.topContainer.appendChild(newFillerBar);
+				}
+				break;
+			  case &quot;b&quot;:
+				if (this.bottomContainer) {
+					with (newFillerBar.style) {
+						height = botMaxRadius - this.borderWidth + &quot;px&quot;;
+						marginLeft = this.settings.bl.radius - this.borderWidth + &quot;px&quot;;
+						marginRight = this.settings.br.radius - this.borderWidth + &quot;px&quot;;
+						borderBottom = this.borderString;
+					}
+					this.bottomContainer.appendChild(newFillerBar);
+				}
+				break;
+			}
+		}
+	};
+	this.drawPixel = function (intx, inty, colour, transAmount, height, newCorner, image, cornerRadius) {
+		var pixel = document.createElement(&quot;DIV&quot;);
+		pixel.style.height = height + &quot;px&quot;;
+		pixel.style.width = &quot;1px&quot;;
+		pixel.style.position = &quot;absolute&quot;;
+		pixel.style.fontSize = &quot;1px&quot;;
+		pixel.style.overflow = &quot;hidden&quot;;
+		if (image == -1 &amp;&amp; this.backgroundImage != &quot;&quot;) {
+			pixel.style.backgroundImage = this.backgroundImage;
+			pixel.style.backgroundPosition = &quot;-&quot; + (this.boxWidth - (cornerRadius - intx) + this.borderWidth) + &quot;px -&quot; + ((this.boxHeight + cornerRadius + inty) - this.borderWidth) + &quot;px&quot;;
+		} else {
+			pixel.style.backgroundColor = colour;
+		}
+		if (transAmount != 100) {
+			dojo.html.setOpacity(pixel, transAmount);
+		}
+		pixel.style.top = inty + &quot;px&quot;;
+		pixel.style.left = intx + &quot;px&quot;;
+		newCorner.appendChild(pixel);
+	};
+}, pixelFraction:function (x, y, r) {
+	var pixelfraction = 0;
+	var xvalues = [];
+	var yvalues = [];
+	var point = 0;
+	var whatsides = &quot;&quot;;
+	var intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(x, 2)));
+	if ((intersect &gt;= y) &amp;&amp; (intersect &lt; (y + 1))) {
+		whatsides = &quot;Left&quot;;
+		xvalues[point] = 0;
+		yvalues[point] = intersect - y;
+		point = point + 1;
+	}
+	var intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(y + 1, 2)));
+	if ((intersect &gt;= x) &amp;&amp; (intersect &lt; (x + 1))) {
+		whatsides = whatsides + &quot;Top&quot;;
+		xvalues[point] = intersect - x;
+		yvalues[point] = 1;
+		point = point + 1;
+	}
+	var intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(x + 1, 2)));
+	if ((intersect &gt;= y) &amp;&amp; (intersect &lt; (y + 1))) {
+		whatsides = whatsides + &quot;Right&quot;;
+		xvalues[point] = 1;
+		yvalues[point] = intersect - y;
+		point = point + 1;
+	}
+	var intersect = Math.sqrt((Math.pow(r, 2) - Math.pow(y, 2)));
+	if ((intersect &gt;= x) &amp;&amp; (intersect &lt; (x + 1))) {
+		whatsides = whatsides + &quot;Bottom&quot;;
+		xvalues[point] = intersect - x;
+		yvalues[point] = 0;
+	}
+	switch (whatsides) {
+	  case &quot;LeftRight&quot;:
+		pixelfraction = Math.min(yvalues[0], yvalues[1]) + ((Math.max(yvalues[0], yvalues[1]) - Math.min(yvalues[0], yvalues[1])) / 2);
+		break;
+	  case &quot;TopRight&quot;:
+		pixelfraction = 1 - (((1 - xvalues[0]) * (1 - yvalues[1])) / 2);
+		break;
+	  case &quot;TopBottom&quot;:
+		pixelfraction = Math.min(xvalues[0], xvalues[1]) + ((Math.max(xvalues[0], xvalues[1]) - Math.min(xvalues[0], xvalues[1])) / 2);
+		break;
+	  case &quot;LeftBottom&quot;:
+		pixelfraction = (yvalues[0] * xvalues[1]) / 2;
+		break;
+	  default:
+		pixelfraction = 1;
+	}
+	return pixelfraction;
+}, rgb2Hex:function (rgbColour) {
+	try {
+		var rgbArray = this.rgb2Array(rgbColour);
+		var red = parseInt(rgbArray[0]);
+		var green = parseInt(rgbArray[1]);
+		var blue = parseInt(rgbArray[2]);
+		var hexColour = &quot;#&quot; + this.intToHex(red) + this.intToHex(green) + this.intToHex(blue);
+	}
+	catch (e) {
+		alert(&quot;There was an error converting the RGB value to Hexadecimal in function rgb2Hex&quot;);
+	}
+	return hexColour;
+}, intToHex:function (strNum) {
+	var base = strNum / 16;
+	var rem = strNum % 16;
+	var base = base - (rem / 16);
+	var baseS = this.makeHex(base);
+	var remS = this.makeHex(rem);
+	return baseS + &quot;&quot; + remS;
+}, makeHex:function (x) {
+	if ((x &gt;= 0) &amp;&amp; (x &lt;= 9)) {
+		return x;
+	} else {
+		switch (x) {
+		  case 10:
+			return &quot;A&quot;;
+		  case 11:
+			return &quot;B&quot;;
+		  case 12:
+			return &quot;C&quot;;
+		  case 13:
+			return &quot;D&quot;;
+		  case 14:
+			return &quot;E&quot;;
+		  case 15:
+			return &quot;F&quot;;
+		}
+	}
+}, rgb2Array:function (rgbColour) {
+	var rgbValues = rgbColour.substring(4, rgbColour.indexOf(&quot;)&quot;));
+	var rgbArray = rgbValues.split(&quot;, &quot;);
+	return rgbArray;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Select.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Select.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Select.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,39 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Select&quot;);
+dojo.require(&quot;dojo.widget.ComboBox&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.html.stabile&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Select&quot;, dojo.widget.ComboBox, {forceValidOption:true, setValue:function (value) {
+	this.comboBoxValue.value = value;
+	dojo.widget.html.stabile.setState(this.widgetId, this.getState(), true);
+	this.onValueChanged(value);
+}, setLabel:function (value) {
+	this.comboBoxSelectionValue.value = value;
+	if (this.textInputNode.value != value) {
+		this.textInputNode.value = value;
+	}
+}, getLabel:function () {
+	return this.comboBoxSelectionValue.value;
+}, getState:function () {
+	return {value:this.getValue(), label:this.getLabel()};
+}, onKeyUp:function (evt) {
+	this.setLabel(this.textInputNode.value);
+}, setState:function (state) {
+	this.setValue(state.value);
+	this.setLabel(state.label);
+}, setAllValues:function (value1, value2) {
+	this.setLabel(value1);
+	this.setValue(value2);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Show.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Show.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Show.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,211 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Show&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.math.curves&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Show&quot;, dojo.widget.HtmlWidget, function () {
+	this._slides = [];
+}, {isContainer:true, _slide:-1, body:null, nav:null, hider:null, select:null, option:null, inNav:false, debugPane:null, noClick:false, templateString:&quot;&lt;div class=\&quot;dojoShow\&quot;&gt;\n\t&lt;div dojoAttachPoint=\&quot;contentNode\&quot;&gt;&lt;/div&gt;\n\t&lt;div class=\&quot;dojoShowNav\&quot; dojoAttachPoint=\&quot;nav\&quot;&gt;\n\t\t&lt;div class=\&quot;dojoShowHider\&quot; dojoAttachPoint=\&quot;hider\&quot;&gt;&lt;/div&gt;\n\t\t&lt;span unselectable=\&quot;on\&quot; style=\&quot;cursor: default;\&quot; dojoAttachEvent=\&quot;onClick:previousSlide\&quot;&gt;&lt;&lt;/span&gt;\n\t\t&lt;select dojoAttachEvent=\&quot;onClick:gotoSlideByEvent\&quot; dojoAttachPoint=\&quot;select\&quot;&gt;\n\t\t\t&lt;option dojoAttachPoint=\&quot;option\&quot;&gt;Title&lt;/option&gt;\n\t\t&lt;/select&gt;\n\t\t&lt;span unselectable=\&quot;on\&quot; style=\&quot;cursor: default;\&quot; dojoAttachEvent=\&quot;onClick:nextSlide\&quot;&gt;&gt;&lt;/span&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;@media screen {\n\thtml, body {\n\t\tmargin: 0px;\n\t\tpadding: 0px;\n\t\twidth: 100%;\n\t}\n\th1 {\n\t\tfont-size: 50px;\n\t}\n\tp, li {\n\t\tfont-size: 30px;\n\t}\n\t.dojoShowNav {\n\t\tbackground: #369;\n\t\toverflow: hi!
 dden;\n\t\tposition: absolute;\n\t\theight: 5px;\n\t\tbottom: 0px;\n\t\tleft: 0px;\n\t\twidth: 100%;\n\t\ttext-align: center;\n\t}\n\t.dojoShowNav input {\n\t\tmargin: 0px;\n\t}\n\t.dojoShowHider {\n\t\theight: 5px;\n\t\toverflow: hidden;\n\t\twidth: 100%;\n\t}\n\t.dojoShowPrint {\n\t\tposition: absolute;\n\t\tleft: 5px;\n\t\ttop: 0px;\n\t}\n\t.dojoShow {\n\t\tdisplay: none;\n\t}\n}\<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">n at media</A> print {\n\t.dojoShow {\n\t\tdisplay: none !important;\n\t}\n\t.dojoShowPrint {\n\t\tdisplay: block !important;\n\t}\n\t.dojoShowPrintSlide {\n\t\tborder: 1px solid #aaa;\n\t\tpadding: 10px;\n\t\tmargin-bottom: 15px;\n\t}\n\t.dojoShowPrintSlide, ul {\n\tpage-break-inside: avoid;\n\t}\n\th1 {\n\t\tmargin-top: 0;\n\t\tpage-break-after: avoid;\n\t}\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Show.css&quot;), fillInTemplate:function (args, frag) {
+	if (args.debugPane) {
+		var dp = this.debugPane = dojo.widget.byId(args.debugPane);
+		dp.hide();
+		dojo.event.connect(dp, &quot;closeWindow&quot;, dojo.lang.hitch(this, function () {
+			this.debugPane = false;
+		}));
+	}
+	var source = this.getFragNodeRef(frag);
+	this.sourceNode = dojo.body().appendChild(source.cloneNode(true));
+	for (var i = 0, child; child = this.sourceNode.childNodes[i]; i++) {
+		if (child.tagName &amp;&amp; child.getAttribute(&quot;dojotype&quot;).toLowerCase() == &quot;showslide&quot;) {
+			child.className = &quot;dojoShowPrintSlide&quot;;
+			child.innerHTML = &quot;&lt;h1&gt;&quot; + child.title + &quot;&lt;/h1&gt;&quot; + child.innerHTML;
+		}
+	}
+	this.sourceNode.className = &quot;dojoShowPrint&quot;;
+	this.sourceNode.style.display = &quot;none&quot;;
+	dojo.event.connect(document, &quot;onclick&quot;, this, &quot;gotoSlideByEvent&quot;);
+	if (dojo.render.html.ie) {
+		dojo.event.connect(document, &quot;onkeydown&quot;, this, &quot;gotoSlideByEvent&quot;);
+	} else {
+		dojo.event.connect(document, &quot;onkeypress&quot;, this, &quot;gotoSlideByEvent&quot;);
+	}
+	dojo.event.connect(window, &quot;onresize&quot;, this, &quot;resizeWindow&quot;);
+	dojo.event.connect(this.nav, &quot;onmousemove&quot;, this, &quot;popUpNav&quot;);
+}, postCreate:function () {
+	this._slides = [];
+	for (var i = 0, child; child = this.children[i]; i++) {
+		if (child.widgetType == &quot;ShowSlide&quot;) {
+			this._slides.push(child);
+			this.option.text = child.title + &quot; (&quot; + (i + 1) + &quot;)&quot;;
+			this.option.parentNode.insertBefore(this.option.cloneNode(true), this.option);
+		}
+	}
+	this.option.parentNode.removeChild(this.option);
+	this.domNode.style.display = &quot;block&quot;;
+	this.resizeWindow();
+	this.gotoSlide(0, true);
+	dojo.addOnLoad(dojo.lang.hitch(this, function () {
+		var th = window.location.hash;
+		if (th.length) {
+			var parts = (&quot;&quot; + window.location).split(this.widgetId + &quot;_SlideNo_&quot;);
+			if (parts.length &gt; 1) {
+				setTimeout(dojo.lang.hitch(this, function () {
+					this.gotoSlide(parseInt(parts[1]), true);
+				}), 300);
+			}
+		}
+	}));
+}, gotoSlide:function (slide, preventSetHash) {
+	if (slide == this._slide) {
+		return;
+	}
+	if (!this._slides[slide]) {
+		for (var i = 0, child; child = this._slides[i]; i++) {
+			if (child.title == slide) {
+				slide = i;
+				break;
+			}
+		}
+	}
+	if (!this._slides[slide]) {
+		return;
+	}
+	if (this.debugPane) {
+		if (this._slides[slide].debug) {
+			this.debugPane.show();
+		} else {
+			this.debugPane.hide();
+		}
+	}
+	if (this._slide != -1) {
+		while (this._slides[this._slide].previousAction()) {
+		}
+	}
+	if (!preventSetHash) {
+		window.location.href = &quot;#&quot; + this.widgetId + &quot;_SlideNo_&quot; + slide;
+	}
+	if (this._slides[this._slide]) {
+		this._slides[this._slide].hide();
+	}
+	this._slide = slide;
+	this.select.selectedIndex = slide;
+	var cn = this.contentNode;
+	while (cn.firstChild) {
+		cn.removeChild(cn.firstChild);
+	}
+	cn.appendChild(this._slides[slide].domNode);
+	this._slides[slide].show();
+}, gotoSlideByEvent:function (event) {
+	var node = event.target;
+	var type = event.type;
+	if (type == &quot;click&quot;) {
+		if (node.tagName == &quot;OPTION&quot; &amp;&amp; node.parentNode == this.select) {
+			this.gotoSlide(node.index);
+		} else {
+			if (node == this.select) {
+				this.gotoSlide(node.selectedIndex);
+			} else {
+				this.nextSlide(event);
+			}
+		}
+	} else {
+		if (type == &quot;keydown&quot; || type == &quot;keypress&quot;) {
+			var key = event.keyCode;
+			var ch = event.charCode;
+			if (key == 63234 || key == 37) {
+				this.previousSlide(event);
+			} else {
+				if (key == 63235 || key == 39 || ch == 32) {
+					this.nextSlide(event);
+				}
+			}
+		}
+	}
+}, nextSlide:function (event) {
+	if (!this.stopEvent(event)) {
+		return false;
+	}
+	if (!this._slides[this._slide].nextAction(event)) {
+		if ((this._slide + 1) != this._slides.length) {
+			this.gotoSlide(this._slide + 1);
+			return true;
+		}
+		return false;
+	}
+}, previousSlide:function (event) {
+	if (!this.stopEvent(event)) {
+		return false;
+	}
+	if (!this._slides[this._slide].previousAction(event)) {
+		if ((this._slide - 1) != -1) {
+			this.gotoSlide(this._slide - 1);
+			return true;
+		}
+		return false;
+	}
+}, stopEvent:function (ev) {
+	if (!ev) {
+		return true;
+	}
+	if (ev.type == &quot;click&quot; &amp;&amp; (this._slides[this._slide].noClick || this.noClick)) {
+		return false;
+	}
+	var target = ev.target;
+	while (target != null) {
+		if (target == this.domNode) {
+			target = ev.target;
+			break;
+		}
+		target = target.parentNode;
+	}
+	if (!dojo.dom.isDescendantOf(target, this.nav)) {
+		while (target &amp;&amp; target != this.domNode) {
+			if (target.tagName == &quot;A&quot; || target.tagName == &quot;INPUT&quot; || target.tagName == &quot;TEXTAREA&quot; || target.tagName == &quot;SELECT&quot;) {
+				return false;
+			}
+			if (typeof target.onclick == &quot;function&quot; || typeof target.onkeypress == &quot;function&quot;) {
+				return false;
+			}
+			target = target.parentNode;
+		}
+	}
+	if (window.event) {
+		ev.returnValue = false;
+		ev.cancelBubble = true;
+	} else {
+		ev.preventDefault();
+		ev.stopPropagation();
+	}
+	return true;
+}, popUpNav:function () {
+	if (!this.inNav) {
+		dojo.lfx.propertyAnimation(this.nav, {&quot;height&quot;:{start:5, end:30}}, 250).play();
+	}
+	clearTimeout(this.inNav);
+	this.inNav = setTimeout(dojo.lang.hitch(this, &quot;hideNav&quot;), 2000);
+}, hideNav:function () {
+	clearTimeout(this.inNav);
+	this.inNav = false;
+	dojo.lfx.propertyAnimation(this.nav, {&quot;height&quot;:{start:30, end:5}}, 250).play();
+}, resizeWindow:function (ev) {
+	dojo.body().style.height = &quot;auto&quot;;
+	var h = Math.max(document.documentElement.scrollHeight || dojo.body().scrollHeight, dojo.html.getViewport().height);
+	dojo.body().style.height = h + &quot;px&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ShowAction.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ShowAction.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ShowAction.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,20 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ShowAction&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ShowAction&quot;, dojo.widget.HtmlWidget, {on:&quot;&quot;, action:&quot;fade&quot;, duration:350, from:&quot;&quot;, to:&quot;&quot;, auto:&quot;false&quot;, postMixInProperties:function () {
+	if (dojo.render.html.opera) {
+		this.action = this.action.split(&quot;/&quot;).pop();
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ShowSlide.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ShowSlide.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ShowSlide.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,201 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ShowSlide&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.lfx.html&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.animation.Animation&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ShowSlide&quot;, dojo.widget.HtmlWidget, {title:&quot;&quot;, _action:-1, isContainer:true, _components:{}, _actions:[], gotoAction:function (action) {
+	this._action = action;
+}, _nextAction:function (event) {
+	if ((this._action + 1) != this._actions.length) {
+		++this._action;
+		return true;
+	}
+	return false;
+}, _previousAction:function (event) {
+	if ((this._action - 1) != -1) {
+		--this._action;
+		return true;
+	}
+	return false;
+}, htmlTitle:null, debug:false, noClick:false, templateString:&quot;&lt;div class=\&quot;dojoShowSlide\&quot;&gt;\n\t&lt;div class=\&quot;dojoShowSlideTitle\&quot;&gt;\n\t\t&lt;h1 dojoAttachPoint=\&quot;htmlTitle\&quot;&gt;Title&lt;/h1&gt;\n\t&lt;/div&gt;\n\t&lt;div class=\&quot;dojoShowSlideBody\&quot; dojoAttachPoint=\&quot;containerNode\&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.dojoShowSlideTitle {\n\theight: 100px;\n\tbackground: #369;\n}\n.dojoShowSlideTitle h1 {\n\tmargin-top: 0;\n\tline-height: 100px;\n\tmargin-left: 30px;\n}\n.dojoShowSlideBody {\n\tmargin: 15px;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/ShowSlide.css&quot;), postCreate:function () {
+	this.htmlTitle.innerHTML = this.title;
+	var actions = this.getChildrenOfType(&quot;ShowAction&quot;, false);
+	var atypes = {};
+	dojo.lang.forEach(actions, function (act) {
+		atypes[act.on] = true;
+	});
+	this._components = {};
+	var cn = this.containerNode;
+	var nodes = dojo.render.html.ie ? cn.all : cn.getElementsByTagName(&quot;*&quot;);
+	dojo.lang.forEach(nodes, function (node) {
+		var as = node.getAttribute(&quot;as&quot;);
+		if (as) {
+			if (!this._components[as]) {
+				this._components[as] = [];
+			}
+			this._components[as].push(node);
+			if (!atypes[as]) {
+				var tmpAction = dojo.widget.createWidget(&quot;ShowAction&quot;, {on:as});
+				this.addChild(tmpAction);
+				atypes[as] = true;
+			}
+		}
+	}, this);
+	this._actions = [];
+	actions = this.getChildrenOfType(&quot;ShowAction&quot;, false);
+	dojo.lang.forEach(actions, function (child) {
+		this._actions.push(child);
+		var components = this._components[child.on];
+		for (var j = 0, component; component = components[j]; j++) {
+			if (child[&quot;action&quot;] &amp;&amp; ((child.action != &quot;remove&quot;) &amp;&amp; (child.action != &quot;fadeout&quot;) &amp;&amp; (child.action != &quot;wipeout&quot;))) {
+				this.hideComponent(component);
+			}
+		}
+	}, this);
+}, previousAction:function (event) {
+	if (!this.parent.stopEvent(event)) {
+		return false;
+	}
+	var action = this._actions[this._action];
+	if (!action) {
+		return false;
+	}
+	var on = action.on;
+	while (action.on == on) {
+		var components = this._components[on];
+		for (var i = 0, component; component = components[i]; i++) {
+			if ((action.action == &quot;remove&quot;) || (action.action == &quot;fadeout&quot;) || (action.action == &quot;wipeout&quot;)) {
+				if (component.style.display == &quot;none&quot;) {
+					component.style.display = &quot;&quot;;
+					component.style.visibility = &quot;visible&quot;;
+					var exits = true;
+				}
+				dojo.html.setOpacity(component, 1);
+			} else {
+				if (action.action) {
+					this.hideComponent(component);
+				}
+			}
+		}
+		--this._action;
+		if (exits) {
+			return true;
+		}
+		if (action.auto == &quot;true&quot;) {
+			on = this._actions[this._action].on;
+		}
+		action = this._actions[this._action];
+		if (!action) {
+			return false;
+		}
+	}
+	return true;
+}, hideComponent:function (component) {
+	component.style.visibility = &quot;hidden&quot;;
+	component.style.backgroundColor = &quot;transparent&quot;;
+	var parent = component.parentNode;
+	if ((parent) &amp;&amp; (parent.tagName.toLowerCase() == &quot;li&quot;)) {
+		parent.oldType = parent.style.listStyleType;
+		parent.style.listStyleType = &quot;none&quot;;
+	}
+}, nextAction:function (event) {
+	if (!this.parent.stopEvent(event)) {
+		return false;
+	}
+	if (!this._nextAction(this)) {
+		return false;
+	}
+	var action = this._actions[this._action];
+	if (!action) {
+		return false;
+	}
+	var tmpAction = action[&quot;action&quot;];
+	var components = this._components[action.on];
+	for (var i = 0, component; component = components[i]; i++) {
+		if (tmpAction) {
+			var duration = action.duration || 1000;
+			if ((tmpAction == &quot;fade&quot;) || (tmpAction == &quot;fadeIn&quot;)) {
+				dojo.html.setOpacity(component, 0);
+				dojo.lfx.html.fadeShow(component, duration).play(true);
+			} else {
+				if (tmpAction == &quot;fadeout&quot;) {
+					dojo.lfx.html.fadeHide(component, duration).play(true);
+				} else {
+					if (tmpAction == &quot;fly&quot;) {
+						var width = dojo.html.getMarginBox(component).width;
+						var position = dojo.html.getAbsolutePosition(component);
+						component.style.position = &quot;relative&quot;;
+						component.style.left = -(width + position.x) + &quot;px&quot;;
+						dojo.lfx.html.slideBy(component, {top:0, left:(width + position.x)}, duration, -1, this.callWith).play(true);
+					} else {
+						if ((tmpAction == &quot;wipe&quot;) || (tmpAction == &quot;wipein&quot;)) {
+							dojo.lfx.html.wipeIn(component, duration).play();
+						} else {
+							if (tmpAction == &quot;wipeout&quot;) {
+								dojo.lfx.html.wipeOut(component, duration).play();
+							} else {
+								if (tmpAction == &quot;color&quot;) {
+									var from = new dojo.gfx.color.Color(action.from).toRgb();
+									var to = new dojo.gfx.color.Color(action.to).toRgb();
+									var anim = new dojo.animation.Animation(new dojo.math.curves.Line(from, to), duration, 0);
+									var node = component;
+									dojo.event.connect(anim, &quot;onAnimate&quot;, function (e) {
+										node.style.color = &quot;rgb(&quot; + e.coordsAsInts().join(&quot;,&quot;) + &quot;)&quot;;
+									});
+									anim.play(true);
+								} else {
+									if (tmpAction == &quot;bgcolor&quot;) {
+										dojo.lfx.html.unhighlight(component, action.to, duration).play();
+									} else {
+										if (tmpAction == &quot;remove&quot;) {
+											component.style.display = &quot;none&quot;;
+										}
+									}
+								}
+							}
+						}
+					}
+				}
+			}
+			if (tmpAction == &quot;hide&quot;) {
+				component.style.visibility = &quot;hidden&quot;;
+			} else {
+				component.style.visibility = &quot;visible&quot;;
+			}
+		}
+	}
+	action = this._actions[this._action + 1];
+	if (action &amp;&amp; action.auto == &quot;true&quot;) {
+		this.nextAction();
+	}
+	return true;
+}, callWith:function (node) {
+	if (!node) {
+		return;
+	}
+	if (dojo.lang.isArray(node)) {
+		dojo.lang.forEach(node, arguments.callee);
+		return;
+	}
+	var parent = node.parentNode;
+	if ((parent) &amp;&amp; (parent.tagName.toLowerCase() == &quot;li&quot;)) {
+		parent.style.listStyleType = parent.oldType;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/SlideShow.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/SlideShow.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/SlideShow.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,77 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.SlideShow&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.html.display&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.SlideShow&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div style=\&quot;position: relative; padding: 3px;\&quot;&gt;\n\t\t&lt;div&gt;\n\t\t\t&lt;input type=\&quot;button\&quot; value=\&quot;pause\&quot; \n\t\t\t\tdojoAttachPoint=\&quot;startStopButton\&quot;\n\t\t\t\tdojoAttachEvent=\&quot;onClick: togglePaused;\&quot;&gt;\n\t\t&lt;/div&gt;\n\t\t&lt;div style=\&quot;position: relative; width: ${this.width}; height: ${this.height};\&quot;\n\t\t\tdojoAttachPoint=\&quot;imagesContainer\&quot;\n\t\t\tdojoAttachEvent=\&quot;onClick: togglePaused;\&quot;&gt;\n\t\t\t&lt;img dojoAttachPoint=\&quot;img1\&quot; class=\&quot;slideShowImg\&quot; \n\t\t\t\tstyle=\&quot;z-index: 1; width: ${this.width}; height: ${this.height};\&quot;  /&gt;\n\t\t\t&lt;img dojoAttachPoint=\&quot;img2\&quot; class=\&quot;slideShowImg\&quot; \n\t\t\t\tstyle=\&quot;z-index: 0; width: ${this.width}; height: ${this.height};\&quot; /&gt;\n\t\t&lt;/div&gt;\t\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.slideShowImg {\n\tposition: absolute;\n\tleft: 0px;\n\ttop: 0px; \n\tborder: 2px solid #4d4d4d;\n\tpadding: 0px;\n\tmargin: 0px;\n}\n\n&quot;, templateCssPath:dojo.uri.moduleU!
 ri(&quot;dojo.widget&quot;, &quot;templates/SlideShow.css&quot;), imgUrls:[], imgUrlBase:&quot;&quot;, delay:4000, transitionInterval:2000, imgWidth:800, imgHeight:600, preventCache:false, stopped:false, _urlsIdx:0, _background:&quot;img2&quot;, _foreground:&quot;img1&quot;, fadeAnim:null, startStopButton:null, img1:null, img2:null, postMixInProperties:function () {
+	this.width = this.imgWidth + &quot;px&quot;;
+	this.height = this.imgHeight + &quot;px&quot;;
+}, fillInTemplate:function () {
+	if (dojo.render.html.safari &amp;&amp; this.imgUrls.length == 2) {
+		this.preventCache = true;
+	}
+	dojo.html.setOpacity(this.img1, 0.9999);
+	dojo.html.setOpacity(this.img2, 0.9999);
+	if (this.imgUrls.length &gt; 1) {
+		this.img2.src = this.imgUrlBase + this.imgUrls[this._urlsIdx++] + this._getUrlSuffix();
+		this._endTransition();
+	} else {
+		this.img1.src = this.imgUrlBase + this.imgUrls[this._urlsIdx++] + this._getUrlSuffix();
+	}
+}, _getUrlSuffix:function () {
+	if (this.preventCache) {
+		return &quot;?ts=&quot; + (new Date()).getTime();
+	} else {
+		return &quot;&quot;;
+	}
+}, togglePaused:function () {
+	if (this.stopped) {
+		this.stopped = false;
+		this._backgroundImageLoaded();
+		this.startStopButton.value = &quot;pause&quot;;
+	} else {
+		this.stopped = true;
+		this.startStopButton.value = &quot;play&quot;;
+	}
+}, _backgroundImageLoaded:function () {
+	if (this.stopped) {
+		return;
+	}
+	if (this.fadeAnim) {
+		this.fadeAnim.stop();
+	}
+	this.fadeAnim = dojo.lfx.fadeOut(this[this._foreground], this.transitionInterval, null);
+	dojo.event.connect(this.fadeAnim, &quot;onEnd&quot;, this, &quot;_endTransition&quot;);
+	this.fadeAnim.play();
+}, _endTransition:function () {
+	with (this[this._background].style) {
+		zIndex = parseInt(zIndex) + 1;
+	}
+	with (this[this._foreground].style) {
+		zIndex = parseInt(zIndex) - 1;
+	}
+	var tmp = this._foreground;
+	this._foreground = this._background;
+	this._background = tmp;
+	this._loadNextImage();
+}, _loadNextImage:function () {
+	dojo.event.kwConnect({srcObj:this[this._background], srcFunc:&quot;onload&quot;, adviceObj:this, adviceFunc:&quot;_backgroundImageLoaded&quot;, once:true, delay:this.delay});
+	dojo.html.setOpacity(this[this._background], 1);
+	this[this._background].src = this.imgUrlBase + this.imgUrls[this._urlsIdx++];
+	if (this._urlsIdx &gt; (this.imgUrls.length - 1)) {
+		this._urlsIdx = 0;
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Slider.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Slider.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Slider.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,475 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Slider&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.dnd.*&quot;);
+dojo.require(&quot;dojo.dnd.HtmlDragMove&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Slider&quot;, dojo.widget.HtmlWidget, {minimumX:0, minimumY:0, maximumX:10, maximumY:10, snapValuesX:0, snapValuesY:0, _snapToGrid:true, isEnableX:true, isEnableY:true, _valueSizeX:0, _valueSizeY:0, _minX:0, _minY:0, _constraintWidth:0, _constraintHeight:0, _clipLeft:0, _clipRight:0, _clipTop:0, _clipBottom:0, _clipXdelta:0, _clipYdelta:0, initialValueX:0, initialValueY:0, flipX:false, flipY:false, clickSelect:true, activeDrag:false, templateCssString:&quot;.sliderMain {\n  border: 0px !important;\n  border-spacing: 0px !important;\n  line-height: 0px !important;\n  padding: 0px !important;\n  display: -moz-inline-table !important;\n  display: inline !important;\n  -moz-user-focus: normal !important;\n}\n\n.sliderComponent {\n  border: 0px;\n  padding: 0px;\n  margin: 0px;\n}\n\n.sliderHandle { \n  top: 0px;\n  left: 0px;\n  z-index: 1000;\n  position: absolute !important;\n}\n\n.sliderOutsetButton { \n  border-style: outset;\n  border-width: 0px!
  1px 1px 0px;\n  border-color: black;\n}\n\n.sliderInsetButton { \n  border-style: inset;\n  border-width: 1px 0px 0px 1px;\n  border-color: black;\n}\n\n.sliderButtonY {\n  margin: 0px;\n  padding: 0px;\n  z-index: 900;\n}\n\n.sliderButtonX {\n  margin: 0px;\n  padding: 0px;\n  z-index: 900;\n}\n\n.sliderBackground { \n  z-index: 0;\n  display: block !important;\n  position: relative !important;\n}\n\n.sliderProgressBackground { \n  z-index: 800;\n  position: absolute !important;\n  clip: rect(0px,0px,0px,0px);\n}\n\n.sliderBackgroundSizeOnly { \n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Slider.css&quot;), templateString:&quot;&lt;table _=\&quot;weird end tag formatting is to prevent whitespace from becoming &nbsp;\&quot; \n\tclass=\&quot;sliderMain\&quot; \n\tdojoAttachPoint=\&quot;focusNode\&quot; \n\tdojoAttachEvent=\&quot;onmousedown:_setFocus; onkey:_handleKeyEvents; onkeyup:_buttonReleased; onmouseup:_buttonReleased; onmousewheel:_mouseWheeled;\&quot;\n\ttabindex=\&quot;0\&quot; cols=3 cellpadding=0 cell!
 spacing=0 style=\&quot;\&quot;&gt;\n\t&lt;tr valign=middle align=center&gt;\n\t\t!
 &lt;td clas
s=\&quot;sliderComponent\&quot; colspan=3 dojoAttachPoint=topBorderNode style=\&quot;\&quot;\n\t\t\t&gt;&lt;img class=\&quot;sliderOutsetButton sliderButtonY\&quot;\n\t\t\t\tdojoAttachPoint=topButtonNode \n\t\t\t\tdojoAttachEvent=\&quot;onmousedown:_topButtonPressed; onmousemove:_discardEvent; ondblclick:_topButtonDoubleClicked;\&quot;\n\t\t\t\tsrc=\&quot;${this.topButtonSrc}\&quot; \n\t\t\t\tstyle=\&quot;${this.buttonStyleY}\&quot;\n\t\t&gt;&lt;/td&gt;\n\t&lt;/tr&gt;\n\t&lt;tr valign=middle align=center&gt;\n\t\t&lt;td class=\&quot;sliderComponent\&quot; dojoAttachPoint=leftBorderNode style=\&quot;\&quot;\n\t\t\t&gt;&lt;img class=\&quot;sliderOutsetButton sliderButtonX\&quot;\n\t\t\t\tdojoAttachPoint=leftButtonNode\n\t\t\t\tdojoAttachEvent=\&quot;onmousedown:_leftButtonPressed; onmousemove:_discardEvent; ondblclick:_leftButtonDoubleClicked;\&quot;\n\t\t\t\tsrc=\&quot;${this.leftButtonSrc}\&quot; \n\t\t\t\tstyle=\&quot;${this.buttonStyleX}\&quot;\n\t\t&gt;&lt;/td&gt;\n\t\t&lt;td dojoAttachPoint=constrainingContainerNode \n\t\t\tclass=\&quot;sliderComponent sliderBackground\&quot;\n\t\t\tstyle=\&quot;${this.backgroundStyle}\&quot;\n\t\t\t&gt;&lt;img src=\&quot;${this.han!
 dleSrc}\&quot; \n\t\t\t\tclass=sliderHandle\n\t\t\t\tdojoAttachPoint=sliderHandleNode\n\t\t\t\tstyle=\&quot;${this.handleStyle}\&quot;\n\t\t\t&gt;&lt;img src=\&quot;${this.progressBackgroundSrc}\&quot;\n\t\t\t\tclass=\&quot;sliderBackgroundSizeOnly sliderProgressBackground\&quot;\n\t\t\t\tdojoAttachPoint=progressBackgroundNode\n\t\t\t\tstyle=\&quot;${this.backgroundSize}\&quot;\n\t\t\t&gt;&lt;img src=\&quot;${this.backgroundSrc}\&quot; \n\t\t\t\tclass=sliderBackgroundSizeOnly\n\t\t\t\tdojoAttachPoint=sliderBackgroundNode\n\t\t\t\tstyle=\&quot;${this.backgroundSize}\&quot;\n\t\t&gt;&lt;/td&gt;\n\t\t&lt;td class=\&quot;sliderComponent\&quot; dojoAttachPoint=rightBorderNode style=\&quot;\&quot;\n\t\t\t&gt;&lt;img class=\&quot;sliderOutsetButton sliderButtonX\&quot;\n\t\t\t\tdojoAttachPoint=rightButtonNode\n\t\t\t\tdojoAttachEvent=\&quot;onmousedown:_rightButtonPressed; onmousemove:_discardEvent; ondblclick:_rightButtonDoubleClicked;\&quot;\n\t\t\t\tsrc=\&quot;${this.rightButtonSrc}\&quot; \n\t\t\t\tstyle=\&quot;${this.buttonStyleX}\&quot;\n\t\t&gt;&lt;/td&gt;\n\t&lt;/tr&gt;\n\t&lt;tr valign=middle align=center&gt;\n\t\t&lt;td class=\&quot;sliderComponent\&quot; !
 colspan=3 dojoAttachPoint=bottomBorderNode style=\&quot;\&quot;\n\t\t\t&gt;!
 &lt;img cla
ss=\&quot;sliderOutsetButton sliderButtonY\&quot;\n\t\t\t\tdojoAttachPoint=bottomButtonNode \n\t\t\t\tdojoAttachEvent=\&quot;onmousedown:_bottomButtonPressed; onmousemove:_discardEvent; ondblclick:_bottomButtonDoubleClicked;\&quot;\n\t\t\t\tsrc=\&quot;${this.bottomButtonSrc}\&quot; \n\t\t\t\tstyle=\&quot;${this.buttonStyleY}\&quot;\n\t\t&gt;&lt;/td&gt;\n\t&lt;/tr&gt;\n&lt;/table&gt;\n&quot;, _isDragInProgress:false, bottomButtonSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider_down_arrow.png&quot;), topButtonSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider_up_arrow.png&quot;), leftButtonSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider_left_arrow.png&quot;), rightButtonSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider_right_arrow.png&quot;), backgroundSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/blank.gif&quot;), progressBackgroundSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/blank.gif&quot;), backgroundSize:&quot;width:200px;height:200px;&quot;, backgroundStyle:&quot;&quot;, buttonStyleX:&quot;&quot;, buttonStyleY:&quot;&quot;, handle!
 Style:&quot;&quot;, handleSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider-button.png&quot;), showButtons:true, _eventCount:0, _typamaticTimer:null, _typamaticFunction:null, defaultTimeout:500, timeoutChangeRate:0.9, _currentTimeout:this.defaultTimeout, _handleKeyEvents:function (evt) {
+	if (!evt.key) {
+		return;
+	}
+	if (!evt.ctrlKey &amp;&amp; !evt.altKey) {
+		switch (evt.key) {
+		  case evt.KEY_LEFT_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			this._leftButtonPressed(evt);
+			return;
+		  case evt.KEY_RIGHT_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			this._rightButtonPressed(evt);
+			return;
+		  case evt.KEY_DOWN_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			this._bottomButtonPressed(evt);
+			return;
+		  case evt.KEY_UP_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			this._topButtonPressed(evt);
+			return;
+		}
+	}
+	this._eventCount++;
+}, _pressButton:function (buttonNode) {
+	buttonNode.className = buttonNode.className.replace(&quot;Outset&quot;, &quot;Inset&quot;);
+}, _releaseButton:function (buttonNode) {
+	buttonNode.className = buttonNode.className.replace(&quot;Inset&quot;, &quot;Outset&quot;);
+}, _buttonPressed:function (evt, buttonNode) {
+	this._setFocus();
+	if (typeof evt == &quot;object&quot;) {
+		if (this._typamaticTimer != null) {
+			if (this._typamaticNode == buttonNode) {
+				return;
+			}
+			clearTimeout(this._typamaticTimer);
+		}
+		this._buttonReleased(null);
+		this._eventCount++;
+		this._typamaticTimer = null;
+		this._currentTimeout = this.defaultTimeout;
+		dojo.event.browser.stopEvent(evt);
+	} else {
+		if (evt != this._eventCount) {
+			this._buttonReleased(null);
+			return false;
+		}
+	}
+	if (buttonNode == this.leftButtonNode &amp;&amp; this.isEnableX) {
+		this._snapX(dojo.html.getPixelValue(this.sliderHandleNode, &quot;left&quot;) - this._valueSizeX);
+	} else {
+		if (buttonNode == this.rightButtonNode &amp;&amp; this.isEnableX) {
+			this._snapX(dojo.html.getPixelValue(this.sliderHandleNode, &quot;left&quot;) + this._valueSizeX);
+		} else {
+			if (buttonNode == this.topButtonNode &amp;&amp; this.isEnableY) {
+				this._snapY(dojo.html.getPixelValue(this.sliderHandleNode, &quot;top&quot;) - this._valueSizeY);
+			} else {
+				if (buttonNode == this.bottomButtonNode &amp;&amp; this.isEnableY) {
+					this._snapY(dojo.html.getPixelValue(this.sliderHandleNode, &quot;top&quot;) + this._valueSizeY);
+				} else {
+					return false;
+				}
+			}
+		}
+	}
+	this._pressButton(buttonNode);
+	this.notifyListeners();
+	this._typamaticNode = buttonNode;
+	this._typamaticTimer = dojo.lang.setTimeout(this, &quot;_buttonPressed&quot;, this._currentTimeout, this._eventCount, buttonNode);
+	this._currentTimeout = Math.round(this._currentTimeout * this.timeoutChangeRate);
+	return false;
+}, _bottomButtonPressed:function (evt) {
+	return this._buttonPressed(evt, this.bottomButtonNode);
+}, _bottomButtonDoubleClicked:function (evt) {
+	var rc = this._bottomButtonPressed(evt);
+	dojo.lang.setTimeout(this, &quot;_buttonReleased&quot;, 50, null);
+	return rc;
+}, _topButtonPressed:function (evt) {
+	return this._buttonPressed(evt, this.topButtonNode);
+}, _topButtonDoubleClicked:function (evt) {
+	var rc = this._topButtonPressed(evt);
+	dojo.lang.setTimeout(this, &quot;_buttonReleased&quot;, 50, null);
+	return rc;
+}, _leftButtonPressed:function (evt) {
+	return this._buttonPressed(evt, this.leftButtonNode);
+}, _leftButtonDoubleClicked:function (evt) {
+	var rc = this._leftButtonPressed(evt);
+	dojo.lang.setTimeout(this, &quot;_buttonReleased&quot;, 50, null);
+	return rc;
+}, _rightButtonPressed:function (evt) {
+	return this._buttonPressed(evt, this.rightButtonNode);
+}, _rightButtonDoubleClicked:function (evt) {
+	var rc = this._rightButtonPressed(evt);
+	dojo.lang.setTimeout(this, &quot;_buttonReleased&quot;, 50, null);
+	return rc;
+}, _buttonReleased:function (evt) {
+	if (typeof evt == &quot;object&quot; &amp;&amp; evt != null &amp;&amp; typeof evt.keyCode != &quot;undefined&quot; &amp;&amp; evt.keyCode != null) {
+		var keyCode = evt.keyCode;
+		switch (keyCode) {
+		  case evt.KEY_LEFT_ARROW:
+		  case evt.KEY_RIGHT_ARROW:
+		  case evt.KEY_DOWN_ARROW:
+		  case evt.KEY_UP_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			break;
+		}
+	}
+	this._releaseButton(this.topButtonNode);
+	this._releaseButton(this.bottomButtonNode);
+	this._releaseButton(this.leftButtonNode);
+	this._releaseButton(this.rightButtonNode);
+	this._eventCount++;
+	if (this._typamaticTimer != null) {
+		clearTimeout(this._typamaticTimer);
+	}
+	this._typamaticTimer = null;
+	this._currentTimeout = this.defaultTimeout;
+}, _mouseWheeled:function (evt) {
+	var scrollAmount = 0;
+	if (typeof evt.wheelDelta == &quot;number&quot;) {
+		scrollAmount = evt.wheelDelta;
+	} else {
+		if (typeof evt.detail == &quot;number&quot;) {
+			scrollAmount = -evt.detail;
+		}
+	}
+	if (this.isEnableY) {
+		if (scrollAmount &gt; 0) {
+			this._topButtonPressed(evt);
+			this._buttonReleased(evt);
+		} else {
+			if (scrollAmount &lt; 0) {
+				this._bottomButtonPressed(evt);
+				this._buttonReleased(evt);
+			}
+		}
+	} else {
+		if (this.isEnableX) {
+			if (scrollAmount &gt; 0) {
+				this._rightButtonPressed(evt);
+				this._buttonReleased(evt);
+			} else {
+				if (scrollAmount &lt; 0) {
+					this._leftButtonPressed(evt);
+					this._buttonReleased(evt);
+				}
+			}
+		}
+	}
+}, _discardEvent:function (evt) {
+	dojo.event.browser.stopEvent(evt);
+}, _setFocus:function () {
+	if (this.focusNode.focus) {
+		this.focusNode.focus();
+	}
+}, fillInTemplate:function (args, frag) {
+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+	var padding = this.domNode.style.padding;
+	if (dojo.lang.isString(padding) &amp;&amp; padding != &quot;&quot; &amp;&amp; padding != &quot;0px&quot; &amp;&amp; padding != &quot;0px 0px 0px 0px&quot;) {
+		this.topBorderNode.style.padding = this.bottomBorderNode.style.padding = padding;
+		this.topBorderNode.style.paddingBottom = &quot;0px&quot;;
+		this.bottomBorderNode.style.paddingTop = &quot;0px&quot;;
+		this.rightBorderNode.style.paddingRight = this.domNode.style.paddingRight;
+		this.leftBorderNode.style.paddingLeft = this.domNode.style.paddingLeft;
+		this.domNode.style.padding = &quot;0px 0px 0px 0px&quot;;
+	}
+	var borderWidth = this.domNode.style.borderWidth;
+	if (dojo.lang.isString(borderWidth) &amp;&amp; borderWidth != &quot;&quot; &amp;&amp; borderWidth != &quot;0px&quot; &amp;&amp; borderWidth != &quot;0px 0px 0px 0px&quot;) {
+		this.topBorderNode.style.borderStyle = this.rightBorderNode.style.borderStyle = this.bottomBorderNode.style.borderStyle = this.leftBorderNode.style.borderStyle = this.domNode.style.borderStyle;
+		this.topBorderNode.style.borderColor = this.rightBorderNode.style.borderColor = this.bottomBorderNode.style.borderColor = this.leftBorderNode.style.borderColor = this.domNode.style.borderColor;
+		this.topBorderNode.style.borderWidth = this.bottomBorderNode.style.borderWidth = borderWidth;
+		this.topBorderNode.style.borderBottomWidth = &quot;0px&quot;;
+		this.bottomBorderNode.style.borderTopWidth = &quot;0px&quot;;
+		this.rightBorderNode.style.borderRightWidth = this.domNode.style.borderRightWidth;
+		this.leftBorderNode.style.borderLeftWidth = this.domNode.style.borderLeftWidth;
+		this.domNode.style.borderWidth = &quot;0px 0px 0px 0px&quot;;
+	}
+	this._handleMove = new dojo.widget._SliderDragMoveSource(this.sliderHandleNode);
+	this._handleMove.setParent(this);
+	if (this.clickSelect) {
+		dojo.event.connect(this.constrainingContainerNode, &quot;onmousedown&quot;, this, &quot;_onClick&quot;);
+	}
+	if (this.isEnableX) {
+		this.setValueX(!isNaN(this.initialValueX) ? this.initialValueX : (!isNaN(this.minimumX) ? this.minimumX : 0));
+	}
+	if (!this.isEnableX || !this.showButtons) {
+		this.rightButtonNode.style.width = &quot;1px&quot;;
+		this.rightButtonNode.style.visibility = &quot;hidden&quot;;
+		this.leftButtonNode.style.width = &quot;1px&quot;;
+		this.leftButtonNode.style.visibility = &quot;hidden&quot;;
+	}
+	if (this.isEnableY) {
+		this.setValueY(!isNaN(this.initialValueY) ? this.initialValueY : (!isNaN(this.minimumY) ? this.minimumY : 0));
+	}
+	if (!this.isEnableY || !this.showButtons) {
+		this.bottomButtonNode.style.width = &quot;1px&quot;;
+		this.bottomButtonNode.style.visibility = &quot;hidden&quot;;
+		this.topButtonNode.style.width = &quot;1px&quot;;
+		this.topButtonNode.style.visibility = &quot;hidden&quot;;
+	}
+	if (this.focusNode.addEventListener) {
+		this.focusNode.addEventListener(&quot;DOMMouseScroll&quot;, dojo.lang.hitch(this, &quot;_mouseWheeled&quot;), false);
+	}
+}, _snapX:function (x) {
+	if (x &lt; 0) {
+		x = 0;
+	} else {
+		if (x &gt; this._constraintWidth) {
+			x = this._constraintWidth;
+		} else {
+			var selectedValue = Math.round(x / this._valueSizeX);
+			x = Math.round(selectedValue * this._valueSizeX);
+		}
+	}
+	this.sliderHandleNode.style.left = x + &quot;px&quot;;
+	if (this.flipX) {
+		this._clipLeft = x + this._clipXdelta;
+	} else {
+		this._clipRight = x + this._clipXdelta;
+	}
+	this.progressBackgroundNode.style.clip = &quot;rect(&quot; + this._clipTop + &quot;px,&quot; + this._clipRight + &quot;px,&quot; + this._clipBottom + &quot;px,&quot; + this._clipLeft + &quot;px)&quot;;
+}, _calc_valueSizeX:function () {
+	var constrainingCtrBox = dojo.html.getContentBox(this.constrainingContainerNode);
+	var sliderHandleBox = dojo.html.getContentBox(this.sliderHandleNode);
+	if (isNaN(constrainingCtrBox.width) || isNaN(sliderHandleBox.width) || constrainingCtrBox.width &lt;= 0 || sliderHandleBox.width &lt;= 0) {
+		return false;
+	}
+	this._constraintWidth = constrainingCtrBox.width + dojo.html.getPadding(this.constrainingContainerNode).width - sliderHandleBox.width;
+	if (this.flipX) {
+		this._clipLeft = this._clipRight = constrainingCtrBox.width;
+	} else {
+		this._clipLeft = this._clipRight = 0;
+	}
+	this._clipXdelta = sliderHandleBox.width &gt;&gt; 1;
+	if (!this.isEnableY) {
+		this._clipTop = 0;
+		this._clipBottom = constrainingCtrBox.height;
+	}
+	if (this._constraintWidth &lt;= 0) {
+		return false;
+	}
+	if (this.snapValuesX == 0) {
+		this.snapValuesX = this._constraintWidth + 1;
+	}
+	this._valueSizeX = this._constraintWidth / (this.snapValuesX - 1);
+	return true;
+}, setValueX:function (value) {
+	if (0 == this._valueSizeX) {
+		if (this._calc_valueSizeX() == false) {
+			dojo.lang.setTimeout(this, &quot;setValueX&quot;, 100, value);
+			return;
+		}
+	}
+	if (isNaN(value)) {
+		value = 0;
+	}
+	if (value &gt; this.maximumX) {
+		value = this.maximumX;
+	} else {
+		if (value &lt; this.minimumX) {
+			value = this.minimumX;
+		}
+	}
+	var pixelPercent = (value - this.minimumX) / (this.maximumX - this.minimumX);
+	if (this.flipX) {
+		pixelPercent = 1 - pixelPercent;
+	}
+	this._snapX(pixelPercent * this._constraintWidth);
+	this.notifyListeners();
+}, getValueX:function () {
+	var pixelPercent = dojo.html.getPixelValue(this.sliderHandleNode, &quot;left&quot;) / this._constraintWidth;
+	if (this.flipX) {
+		pixelPercent = 1 - pixelPercent;
+	}
+	return Math.round(pixelPercent * (this.snapValuesX - 1)) * ((this.maximumX - this.minimumX) / (this.snapValuesX - 1)) + this.minimumX;
+}, _snapY:function (y) {
+	if (y &lt; 0) {
+		y = 0;
+	} else {
+		if (y &gt; this._constraintHeight) {
+			y = this._constraintHeight;
+		} else {
+			var selectedValue = Math.round(y / this._valueSizeY);
+			y = Math.round(selectedValue * this._valueSizeY);
+		}
+	}
+	this.sliderHandleNode.style.top = y + &quot;px&quot;;
+	if (this.flipY) {
+		this._clipTop = y + this._clipYdelta;
+	} else {
+		this._clipBottom = y + this._clipYdelta;
+	}
+	this.progressBackgroundNode.style.clip = &quot;rect(&quot; + this._clipTop + &quot;px,&quot; + this._clipRight + &quot;px,&quot; + this._clipBottom + &quot;px,&quot; + this._clipLeft + &quot;px)&quot;;
+}, _calc_valueSizeY:function () {
+	var constrainingCtrBox = dojo.html.getContentBox(this.constrainingContainerNode);
+	var sliderHandleBox = dojo.html.getContentBox(this.sliderHandleNode);
+	if (isNaN(constrainingCtrBox.height) || isNaN(sliderHandleBox.height) || constrainingCtrBox.height &lt;= 0 || sliderHandleBox.height &lt;= 0) {
+		return false;
+	}
+	this._constraintHeight = constrainingCtrBox.height + dojo.html.getPadding(this.constrainingContainerNode).height - sliderHandleBox.height;
+	if (this.flipY) {
+		this._clipTop = this._clipBottom = constrainingCtrBox.height;
+	} else {
+		this._clipTop = this._clipBottom = 0;
+	}
+	this._clipYdelta = sliderHandleBox.height &gt;&gt; 1;
+	if (!this.isEnableX) {
+		this._clipLeft = 0;
+		this._clipRight = constrainingCtrBox.width;
+	}
+	if (this._constraintHeight &lt;= 0) {
+		return false;
+	}
+	if (this.snapValuesY == 0) {
+		this.snapValuesY = this._constraintHeight + 1;
+	}
+	this._valueSizeY = this._constraintHeight / (this.snapValuesY - 1);
+	return true;
+}, setValueY:function (value) {
+	if (0 == this._valueSizeY) {
+		if (this._calc_valueSizeY() == false) {
+			dojo.lang.setTimeout(this, &quot;setValueY&quot;, 100, value);
+			return;
+		}
+	}
+	if (isNaN(value)) {
+		value = 0;
+	}
+	if (value &gt; this.maximumY) {
+		value = this.maximumY;
+	} else {
+		if (value &lt; this.minimumY) {
+			value = this.minimumY;
+		}
+	}
+	var pixelPercent = (value - this.minimumY) / (this.maximumY - this.minimumY);
+	if (this.flipY) {
+		pixelPercent = 1 - pixelPercent;
+	}
+	this._snapY(pixelPercent * this._constraintHeight);
+	this.notifyListeners();
+}, getValueY:function () {
+	var pixelPercent = dojo.html.getPixelValue(this.sliderHandleNode, &quot;top&quot;) / this._constraintHeight;
+	if (this.flipY) {
+		pixelPercent = 1 - pixelPercent;
+	}
+	return Math.round(pixelPercent * (this.snapValuesY - 1)) * ((this.maximumY - this.minimumY) / (this.snapValuesY - 1)) + this.minimumY;
+}, _onClick:function (evt) {
+	if (this._isDragInProgress) {
+		return;
+	}
+	var parent = dojo.html.getAbsolutePosition(this.constrainingContainerNode, true, dojo.html.boxSizing.MARGIN_BOX);
+	var content = dojo.html.getContentBox(this._handleMove.domNode);
+	if (this.isEnableX) {
+		var x = evt.pageX - parent.x - (content.width &gt;&gt; 1);
+		this._snapX(x);
+	}
+	if (this.isEnableY) {
+		var y = evt.pageY - parent.y - (content.height &gt;&gt; 1);
+		this._snapY(y);
+	}
+	this.notifyListeners();
+}, notifyListeners:function () {
+	this.onValueChanged(this.getValueX(), this.getValueY());
+}, onValueChanged:function (x, y) {
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.SliderHorizontal&quot;, dojo.widget.Slider, {isEnableX:true, isEnableY:false, initialValue:&quot;&quot;, snapValues:&quot;&quot;, minimum:&quot;&quot;, maximum:&quot;&quot;, buttonStyle:&quot;&quot;, backgroundSize:&quot;height:10px;width:200px;&quot;, backgroundSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider-bg.gif&quot;), flip:false, postMixInProperties:function () {
+	dojo.widget.SliderHorizontal.superclass.postMixInProperties.apply(this, arguments);
+	if (!isNaN(parseFloat(this.initialValue))) {
+		this.initialValueX = parseFloat(this.initialValue);
+	}
+	if (!isNaN(parseFloat(this.minimum))) {
+		this.minimumX = parseFloat(this.minimum);
+	}
+	if (!isNaN(parseFloat(this.maximum))) {
+		this.maximumX = parseFloat(this.maximum);
+	}
+	if (!isNaN(parseInt(this.snapValues))) {
+		this.snapValuesX = parseInt(this.snapValues);
+	}
+	if (dojo.lang.isString(this.buttonStyle) &amp;&amp; this.buttonStyle != &quot;&quot;) {
+		this.buttonStyleX = this.buttonStyle;
+	}
+	if (dojo.lang.isBoolean(this.flip)) {
+		this.flipX = this.flip;
+	}
+}, notifyListeners:function () {
+	this.onValueChanged(this.getValueX());
+}, getValue:function () {
+	return this.getValueX();
+}, setValue:function (value) {
+	this.setValueX(value);
+}, onValueChanged:function (value) {
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.SliderVertical&quot;, dojo.widget.Slider, {isEnableX:false, isEnableY:true, initialValue:&quot;&quot;, snapValues:&quot;&quot;, minimum:&quot;&quot;, maximum:&quot;&quot;, buttonStyle:&quot;&quot;, backgroundSize:&quot;width:10px;height:200px;&quot;, backgroundSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/slider-bg-vert.gif&quot;), flip:false, postMixInProperties:function () {
+	dojo.widget.SliderVertical.superclass.postMixInProperties.apply(this, arguments);
+	if (!isNaN(parseFloat(this.initialValue))) {
+		this.initialValueY = parseFloat(this.initialValue);
+	}
+	if (!isNaN(parseFloat(this.minimum))) {
+		this.minimumY = parseFloat(this.minimum);
+	}
+	if (!isNaN(parseFloat(this.maximum))) {
+		this.maximumY = parseFloat(this.maximum);
+	}
+	if (!isNaN(parseInt(this.snapValues))) {
+		this.snapValuesY = parseInt(this.snapValues);
+	}
+	if (dojo.lang.isString(this.buttonStyle) &amp;&amp; this.buttonStyle != &quot;&quot;) {
+		this.buttonStyleY = this.buttonStyle;
+	}
+	if (dojo.lang.isBoolean(this.flip)) {
+		this.flipY = this.flip;
+	}
+}, notifyListeners:function () {
+	this.onValueChanged(this.getValueY());
+}, getValue:function () {
+	return this.getValueY();
+}, setValue:function (value) {
+	this.setValueY(value);
+}, onValueChanged:function (value) {
+}});
+dojo.declare(&quot;dojo.widget._SliderDragMoveSource&quot;, dojo.dnd.HtmlDragMoveSource, {slider:null, onDragStart:function (evt) {
+	this.slider._isDragInProgress = true;
+	var dragObj = this.createDragMoveObject();
+	this.slider.notifyListeners();
+	return dragObj;
+}, onDragEnd:function (evt) {
+	this.slider._isDragInProgress = false;
+	this.slider.notifyListeners();
+}, createDragMoveObject:function () {
+	var dragObj = new dojo.widget._SliderDragMoveObject(this.dragObject, this.type);
+	dragObj.slider = this.slider;
+	if (this.dragClass) {
+		dragObj.dragClass = this.dragClass;
+	}
+	return dragObj;
+}, setParent:function (slider) {
+	this.slider = slider;
+}});
+dojo.declare(&quot;dojo.widget._SliderDragMoveObject&quot;, dojo.dnd.HtmlDragMoveObject, {slider:null, onDragMove:function (evt) {
+	this.updateDragOffset();
+	if (this.slider.isEnableX) {
+		var x = this.dragOffset.x + evt.pageX;
+		this.slider._snapX(x);
+	}
+	if (this.slider.isEnableY) {
+		var y = this.dragOffset.y + evt.pageY;
+		this.slider._snapY(y);
+	}
+	if (this.slider.activeDrag) {
+		this.slider.notifyListeners();
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/SortableTable.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/SortableTable.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/SortableTable.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,500 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.SortableTable&quot;);
+dojo.deprecated(&quot;SortableTable will be removed in favor of FilteringTable.&quot;, &quot;0.5&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.SortableTable&quot;, dojo.widget.HtmlWidget, function () {
+	this.data = [];
+	this.selected = [];
+	this.columns = [];
+}, {enableMultipleSelect:false, maximumNumberOfSelections:0, enableAlternateRows:false, minRows:0, defaultDateFormat:&quot;%D&quot;, sortIndex:0, sortDirection:0, valueField:&quot;Id&quot;, headClass:&quot;&quot;, tbodyClass:&quot;&quot;, headerClass:&quot;&quot;, headerSortUpClass:&quot;selected&quot;, headerSortDownClass:&quot;selected&quot;, rowClass:&quot;&quot;, rowAlternateClass:&quot;alt&quot;, rowSelectedClass:&quot;selected&quot;, columnSelected:&quot;sorted-column&quot;, isContainer:false, templatePath:null, templateCssPath:null, getTypeFromString:function (s) {
+	var parts = s.split(&quot;.&quot;), i = 0, obj = dj_global;
+	do {
+		obj = obj[parts[i++]];
+	} while (i &lt; parts.length &amp;&amp; obj);
+	return (obj != dj_global) ? obj : null;
+}, compare:function (o1, o2) {
+	for (var p in o1) {
+		if (!(p in o2)) {
+			return false;
+		}
+		if (o1[p].valueOf() != o2[p].valueOf()) {
+			return false;
+		}
+	}
+	return true;
+}, isSelected:function (o) {
+	for (var i = 0; i &lt; this.selected.length; i++) {
+		if (this.compare(this.selected[i], o)) {
+			return true;
+		}
+	}
+	return false;
+}, removeFromSelected:function (o) {
+	var idx = -1;
+	for (var i = 0; i &lt; this.selected.length; i++) {
+		if (this.compare(this.selected[i], o)) {
+			idx = i;
+			break;
+		}
+	}
+	if (idx &gt;= 0) {
+		this.selected.splice(idx, 1);
+	}
+}, getSelection:function () {
+	return this.selected;
+}, getValue:function () {
+	var a = [];
+	for (var i = 0; i &lt; this.selected.length; i++) {
+		if (this.selected[i][this.valueField]) {
+			a.push(this.selected[i][this.valueField]);
+		}
+	}
+	return a.join();
+}, reset:function () {
+	this.columns = [];
+	this.data = [];
+	this.resetSelections(this.domNode.getElementsByTagName(&quot;tbody&quot;)[0]);
+}, resetSelections:function (body) {
+	this.selected = [];
+	var idx = 0;
+	var rows = body.getElementsByTagName(&quot;tr&quot;);
+	for (var i = 0; i &lt; rows.length; i++) {
+		if (rows[i].parentNode == body) {
+			rows[i].removeAttribute(&quot;selected&quot;);
+			if (this.enableAlternateRows &amp;&amp; idx % 2 == 1) {
+				rows[i].className = this.rowAlternateClass;
+			} else {
+				rows[i].className = &quot;&quot;;
+			}
+			idx++;
+		}
+	}
+}, getObjectFromRow:function (row) {
+	var cells = row.getElementsByTagName(&quot;td&quot;);
+	var o = {};
+	for (var i = 0; i &lt; this.columns.length; i++) {
+		if (this.columns[i].sortType == &quot;__markup__&quot;) {
+			o[this.columns[i].getField()] = cells[i].innerHTML;
+		} else {
+			var text = dojo.html.renderedTextContent(cells[i]);
+			var val = text;
+			if (this.columns[i].getType() != String) {
+				var val = new (this.columns[i].getType())(text);
+			}
+			o[this.columns[i].getField()] = val;
+		}
+	}
+	if (dojo.html.hasAttribute(row, &quot;value&quot;)) {
+		o[this.valueField] = dojo.html.getAttribute(row, &quot;value&quot;);
+	}
+	return o;
+}, setSelectionByRow:function (row) {
+	var o = this.getObjectFromRow(row);
+	var b = false;
+	for (var i = 0; i &lt; this.selected.length; i++) {
+		if (this.compare(this.selected[i], o)) {
+			b = true;
+			break;
+		}
+	}
+	if (!b) {
+		this.selected.push(o);
+	}
+}, parseColumns:function (node) {
+	this.reset();
+	var row = node.getElementsByTagName(&quot;tr&quot;)[0];
+	var cells = row.getElementsByTagName(&quot;td&quot;);
+	if (cells.length == 0) {
+		cells = row.getElementsByTagName(&quot;th&quot;);
+	}
+	for (var i = 0; i &lt; cells.length; i++) {
+		var o = {field:null, format:null, noSort:false, sortType:&quot;String&quot;, dataType:String, sortFunction:null, label:null, align:&quot;left&quot;, valign:&quot;middle&quot;, getField:function () {
+			return this.field || this.label;
+		}, getType:function () {
+			return this.dataType;
+		}};
+		if (dojo.html.hasAttribute(cells[i], &quot;align&quot;)) {
+			o.align = dojo.html.getAttribute(cells[i], &quot;align&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;valign&quot;)) {
+			o.valign = dojo.html.getAttribute(cells[i], &quot;valign&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;nosort&quot;)) {
+			o.noSort = dojo.html.getAttribute(cells[i], &quot;nosort&quot;) == &quot;true&quot;;
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;sortusing&quot;)) {
+			var trans = dojo.html.getAttribute(cells[i], &quot;sortusing&quot;);
+			var f = this.getTypeFromString(trans);
+			if (f != null &amp;&amp; f != window &amp;&amp; typeof (f) == &quot;function&quot;) {
+				o.sortFunction = f;
+			}
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;field&quot;)) {
+			o.field = dojo.html.getAttribute(cells[i], &quot;field&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;format&quot;)) {
+			o.format = dojo.html.getAttribute(cells[i], &quot;format&quot;);
+		}
+		if (dojo.html.hasAttribute(cells[i], &quot;dataType&quot;)) {
+			var sortType = dojo.html.getAttribute(cells[i], &quot;dataType&quot;);
+			if (sortType.toLowerCase() == &quot;html&quot; || sortType.toLowerCase() == &quot;markup&quot;) {
+				o.sortType = &quot;__markup__&quot;;
+				o.noSort = true;
+			} else {
+				var type = this.getTypeFromString(sortType);
+				if (type) {
+					o.sortType = sortType;
+					o.dataType = type;
+				}
+			}
+		}
+		o.label = dojo.html.renderedTextContent(cells[i]);
+		this.columns.push(o);
+		if (dojo.html.hasAttribute(cells[i], &quot;sort&quot;)) {
+			this.sortIndex = i;
+			var dir = dojo.html.getAttribute(cells[i], &quot;sort&quot;);
+			if (!isNaN(parseInt(dir))) {
+				dir = parseInt(dir);
+				this.sortDirection = (dir != 0) ? 1 : 0;
+			} else {
+				this.sortDirection = (dir.toLowerCase() == &quot;desc&quot;) ? 1 : 0;
+			}
+		}
+	}
+}, parseData:function (data) {
+	this.data = [];
+	this.selected = [];
+	for (var i = 0; i &lt; data.length; i++) {
+		var o = {};
+		for (var j = 0; j &lt; this.columns.length; j++) {
+			var field = this.columns[j].getField();
+			if (this.columns[j].sortType == &quot;__markup__&quot;) {
+				o[field] = String(data[i][field]);
+			} else {
+				var type = this.columns[j].getType();
+				var val = data[i][field];
+				var t = this.columns[j].sortType.toLowerCase();
+				if (type == String) {
+					o[field] = val;
+				} else {
+					if (val != null) {
+						o[field] = new type(val);
+					} else {
+						o[field] = new type();
+					}
+				}
+			}
+		}
+		if (data[i][this.valueField] &amp;&amp; !o[this.valueField]) {
+			o[this.valueField] = data[i][this.valueField];
+		}
+		this.data.push(o);
+	}
+}, parseDataFromTable:function (tbody) {
+	this.data = [];
+	this.selected = [];
+	var rows = tbody.getElementsByTagName(&quot;tr&quot;);
+	for (var i = 0; i &lt; rows.length; i++) {
+		if (dojo.html.getAttribute(rows[i], &quot;ignoreIfParsed&quot;) == &quot;true&quot;) {
+			continue;
+		}
+		var o = {};
+		var cells = rows[i].getElementsByTagName(&quot;td&quot;);
+		for (var j = 0; j &lt; this.columns.length; j++) {
+			var field = this.columns[j].getField();
+			if (this.columns[j].sortType == &quot;__markup__&quot;) {
+				o[field] = cells[j].innerHTML;
+			} else {
+				var type = this.columns[j].getType();
+				var val = dojo.html.renderedTextContent(cells[j]);
+				if (type == String) {
+					o[field] = val;
+				} else {
+					if (val != null) {
+						o[field] = new type(val);
+					} else {
+						o[field] = new type();
+					}
+				}
+			}
+		}
+		if (dojo.html.hasAttribute(rows[i], &quot;value&quot;) &amp;&amp; !o[this.valueField]) {
+			o[this.valueField] = dojo.html.getAttribute(rows[i], &quot;value&quot;);
+		}
+		this.data.push(o);
+		if (dojo.html.getAttribute(rows[i], &quot;selected&quot;) == &quot;true&quot;) {
+			this.selected.push(o);
+		}
+	}
+}, showSelections:function () {
+	var body = this.domNode.getElementsByTagName(&quot;tbody&quot;)[0];
+	var rows = body.getElementsByTagName(&quot;tr&quot;);
+	var idx = 0;
+	for (var i = 0; i &lt; rows.length; i++) {
+		if (rows[i].parentNode == body) {
+			if (dojo.html.getAttribute(rows[i], &quot;selected&quot;) == &quot;true&quot;) {
+				rows[i].className = this.rowSelectedClass;
+			} else {
+				if (this.enableAlternateRows &amp;&amp; idx % 2 == 1) {
+					rows[i].className = this.rowAlternateClass;
+				} else {
+					rows[i].className = &quot;&quot;;
+				}
+			}
+			idx++;
+		}
+	}
+}, render:function (bDontPreserve) {
+	var data = [];
+	var body = this.domNode.getElementsByTagName(&quot;tbody&quot;)[0];
+	if (!bDontPreserve) {
+		this.parseDataFromTable(body);
+	}
+	for (var i = 0; i &lt; this.data.length; i++) {
+		data.push(this.data[i]);
+	}
+	var col = this.columns[this.sortIndex];
+	if (!col.noSort) {
+		var field = col.getField();
+		if (col.sortFunction) {
+			var sort = col.sortFunction;
+		} else {
+			var sort = function (a, b) {
+				if (a[field] &gt; b[field]) {
+					return 1;
+				}
+				if (a[field] &lt; b[field]) {
+					return -1;
+				}
+				return 0;
+			};
+		}
+		data.sort(sort);
+		if (this.sortDirection != 0) {
+			data.reverse();
+		}
+	}
+	while (body.childNodes.length &gt; 0) {
+		body.removeChild(body.childNodes[0]);
+	}
+	for (var i = 0; i &lt; data.length; i++) {
+		var row = document.createElement(&quot;tr&quot;);
+		dojo.html.disableSelection(row);
+		if (data[i][this.valueField]) {
+			row.setAttribute(&quot;value&quot;, data[i][this.valueField]);
+		}
+		if (this.isSelected(data[i])) {
+			row.className = this.rowSelectedClass;
+			row.setAttribute(&quot;selected&quot;, &quot;true&quot;);
+		} else {
+			if (this.enableAlternateRows &amp;&amp; i % 2 == 1) {
+				row.className = this.rowAlternateClass;
+			}
+		}
+		for (var j = 0; j &lt; this.columns.length; j++) {
+			var cell = document.createElement(&quot;td&quot;);
+			cell.setAttribute(&quot;align&quot;, this.columns[j].align);
+			cell.setAttribute(&quot;valign&quot;, this.columns[j].valign);
+			dojo.html.disableSelection(cell);
+			if (this.sortIndex == j) {
+				cell.className = this.columnSelected;
+			}
+			if (this.columns[j].sortType == &quot;__markup__&quot;) {
+				cell.innerHTML = data[i][this.columns[j].getField()];
+				for (var k = 0; k &lt; cell.childNodes.length; k++) {
+					var node = cell.childNodes[k];
+					if (node &amp;&amp; node.nodeType == dojo.html.ELEMENT_NODE) {
+						dojo.html.disableSelection(node);
+					}
+				}
+			} else {
+				if (this.columns[j].getType() == Date) {
+					var format = this.defaultDateFormat;
+					if (this.columns[j].format) {
+						format = this.columns[j].format;
+					}
+					cell.appendChild(document.createTextNode(dojo.date.strftime(data[i][this.columns[j].getField()], format)));
+				} else {
+					cell.appendChild(document.createTextNode(data[i][this.columns[j].getField()]));
+				}
+			}
+			row.appendChild(cell);
+		}
+		body.appendChild(row);
+		dojo.event.connect(row, &quot;onclick&quot;, this, &quot;onUISelect&quot;);
+	}
+	var minRows = parseInt(this.minRows);
+	if (!isNaN(minRows) &amp;&amp; minRows &gt; 0 &amp;&amp; data.length &lt; minRows) {
+		var mod = 0;
+		if (data.length % 2 == 0) {
+			mod = 1;
+		}
+		var nRows = minRows - data.length;
+		for (var i = 0; i &lt; nRows; i++) {
+			var row = document.createElement(&quot;tr&quot;);
+			row.setAttribute(&quot;ignoreIfParsed&quot;, &quot;true&quot;);
+			if (this.enableAlternateRows &amp;&amp; i % 2 == mod) {
+				row.className = this.rowAlternateClass;
+			}
+			for (var j = 0; j &lt; this.columns.length; j++) {
+				var cell = document.createElement(&quot;td&quot;);
+				cell.appendChild(document.createTextNode(&quot;\xa0&quot;));
+				row.appendChild(cell);
+			}
+			body.appendChild(row);
+		}
+	}
+}, onSelect:function (e) {
+}, onUISelect:function (e) {
+	var row = dojo.html.getParentByType(e.target, &quot;tr&quot;);
+	var body = dojo.html.getParentByType(row, &quot;tbody&quot;);
+	if (this.enableMultipleSelect) {
+		if (e.metaKey || e.ctrlKey) {
+			if (this.isSelected(this.getObjectFromRow(row))) {
+				this.removeFromSelected(this.getObjectFromRow(row));
+				row.removeAttribute(&quot;selected&quot;);
+			} else {
+				this.setSelectionByRow(row);
+				row.setAttribute(&quot;selected&quot;, &quot;true&quot;);
+			}
+		} else {
+			if (e.shiftKey) {
+				var startRow;
+				var rows = body.getElementsByTagName(&quot;tr&quot;);
+				for (var i = 0; i &lt; rows.length; i++) {
+					if (rows[i].parentNode == body) {
+						if (rows[i] == row) {
+							break;
+						}
+						if (dojo.html.getAttribute(rows[i], &quot;selected&quot;) == &quot;true&quot;) {
+							startRow = rows[i];
+						}
+					}
+				}
+				if (!startRow) {
+					startRow = row;
+					for (; i &lt; rows.length; i++) {
+						if (dojo.html.getAttribute(rows[i], &quot;selected&quot;) == &quot;true&quot;) {
+							row = rows[i];
+							break;
+						}
+					}
+				}
+				this.resetSelections(body);
+				if (startRow == row) {
+					row.setAttribute(&quot;selected&quot;, &quot;true&quot;);
+					this.setSelectionByRow(row);
+				} else {
+					var doSelect = false;
+					for (var i = 0; i &lt; rows.length; i++) {
+						if (rows[i].parentNode == body) {
+							rows[i].removeAttribute(&quot;selected&quot;);
+							if (rows[i] == startRow) {
+								doSelect = true;
+							}
+							if (doSelect) {
+								this.setSelectionByRow(rows[i]);
+								rows[i].setAttribute(&quot;selected&quot;, &quot;true&quot;);
+							}
+							if (rows[i] == row) {
+								doSelect = false;
+							}
+						}
+					}
+				}
+			} else {
+				this.resetSelections(body);
+				row.setAttribute(&quot;selected&quot;, &quot;true&quot;);
+				this.setSelectionByRow(row);
+			}
+		}
+	} else {
+		this.resetSelections(body);
+		row.setAttribute(&quot;selected&quot;, &quot;true&quot;);
+		this.setSelectionByRow(row);
+	}
+	this.showSelections();
+	this.onSelect(e);
+	e.stopPropagation();
+	e.preventDefault();
+}, onHeaderClick:function (e) {
+	var oldIndex = this.sortIndex;
+	var oldDirection = this.sortDirection;
+	var source = e.target;
+	var row = dojo.html.getParentByType(source, &quot;tr&quot;);
+	var cellTag = &quot;td&quot;;
+	if (row.getElementsByTagName(cellTag).length == 0) {
+		cellTag = &quot;th&quot;;
+	}
+	var headers = row.getElementsByTagName(cellTag);
+	var header = dojo.html.getParentByType(source, cellTag);
+	for (var i = 0; i &lt; headers.length; i++) {
+		if (headers[i] == header) {
+			if (i != oldIndex) {
+				this.sortIndex = i;
+				this.sortDirection = 0;
+				headers[i].className = this.headerSortDownClass;
+			} else {
+				this.sortDirection = (oldDirection == 0) ? 1 : 0;
+				if (this.sortDirection == 0) {
+					headers[i].className = this.headerSortDownClass;
+				} else {
+					headers[i].className = this.headerSortUpClass;
+				}
+			}
+		} else {
+			headers[i].className = this.headerClass;
+		}
+	}
+	this.render();
+}, postCreate:function () {
+	var thead = this.domNode.getElementsByTagName(&quot;thead&quot;)[0];
+	if (this.headClass.length &gt; 0) {
+		thead.className = this.headClass;
+	}
+	dojo.html.disableSelection(this.domNode);
+	this.parseColumns(thead);
+	var header = &quot;td&quot;;
+	if (thead.getElementsByTagName(header).length == 0) {
+		header = &quot;th&quot;;
+	}
+	var headers = thead.getElementsByTagName(header);
+	for (var i = 0; i &lt; headers.length; i++) {
+		if (!this.columns[i].noSort) {
+			dojo.event.connect(headers[i], &quot;onclick&quot;, this, &quot;onHeaderClick&quot;);
+		}
+		if (this.sortIndex == i) {
+			if (this.sortDirection == 0) {
+				headers[i].className = this.headerSortDownClass;
+			} else {
+				headers[i].className = this.headerSortUpClass;
+			}
+		}
+	}
+	var tbody = this.domNode.getElementsByTagName(&quot;tbody&quot;)[0];
+	if (this.tbodyClass.length &gt; 0) {
+		tbody.className = this.tbodyClass;
+	}
+	this.parseDataFromTable(tbody);
+	this.render(true);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Spinner.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Spinner.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Spinner.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,526 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Spinner&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.string&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.IntegerTextbox&quot;);
+dojo.require(&quot;dojo.widget.RealNumberTextbox&quot;);
+dojo.require(&quot;dojo.widget.DateTextbox&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.declare(&quot;dojo.widget.Spinner&quot;, null, {_typamaticTimer:null, _typamaticFunction:null, _currentTimeout:this.defaultTimeout, _eventCount:0, defaultTimeout:500, timeoutChangeRate:0.9, templateString:&quot;&lt;span _=\&quot;weird end tag formatting is to prevent whitespace from becoming &nbsp;\&quot;\n\tstyle='float:${this.htmlfloat};'\n\t&gt;&lt;table cellpadding=0 cellspacing=0 class=\&quot;dojoSpinner\&quot;&gt;\n\t\t&lt;tr&gt;\n\t\t\t&lt;td\n\t\t\t\t&gt;&lt;input\n\t\t\t\t\tdojoAttachPoint='textbox' type='${this.type}'\n\t\t\t\t\tdojoAttachEvent='onblur;onfocus;onkey:_handleKeyEvents;onKeyUp:_onSpinnerKeyUp;onresize:_resize'\n\t\t\t\t\tid='${this.widgetId}' name='${this.name}' size='${this.size}' maxlength='${this.maxlength}'\n\t\t\t\t\tvalue='${this.value}' class='${this.className}' autocomplete=\&quot;off\&quot;\n\t\t\t&gt;&lt;/td&gt;\n\t\t\t&lt;td\n\t\t\t\t&gt;&lt;img dojoAttachPoint=\&quot;upArrowNode\&quot;\n\t\t\t\t\tdojoAttachEvent=\&quot;onDblClick: _upArrowDoubleClicked;  onMouseDown: _upArrowPressed; onMouseUp: _arrowReleased; onMouseOut: _arrowReleased!
 ; onMouseMove: _discardEvent;\&quot;\n\t\t\t\t\tsrc=\&quot;${this.incrementSrc}\&quot; style=\&quot;width: ${this.buttonSize.width}px; height: ${this.buttonSize.height}px;\&quot;\n\t\t\t\t&gt;&lt;img dojoAttachPoint=\&quot;downArrowNode\&quot;\n\t\t\t\t\tdojoAttachEvent=\&quot;onDblClick: _downArrowDoubleClicked;  onMouseDown: _downArrowPressed; onMouseUp: _arrowReleased; onMouseOut: _arrowReleased; onMouseMove: _discardEvent;\&quot;\n\t\t\t\t\tsrc=\&quot;${this.decrementSrc}\&quot; style=\&quot;width: ${this.buttonSize.width}px; height: ${this.buttonSize.height}px;\&quot;\n\t\t\t&gt;&lt;/td&gt;\n\t\t&lt;/tr&gt;\n\t&lt;/table\n\t&gt;&lt;span dojoAttachPoint='invalidSpan' class='${this.invalidClass}'&gt;${this.messages.invalidMessage}&lt;/span\n\t&gt;&lt;span dojoAttachPoint='missingSpan' class='${this.missingClass}'&gt;${this.messages.missingMessage}&lt;/span\n\t&gt;&lt;span dojoAttachPoint='rangeSpan' class='${this.rangeClass}'&gt;${this.messages.rangeMessage}&lt;/span\n&gt;&lt;/span&gt;\n&quot;, templateCssString:&quot;/* inline the table holding the &lt;input&gt; and buttons (method varies by browser) */\n.ie .dojoSpi!
 nner, .safari .dojoSpinner {\n\tdisplay: inline;\n}\n\n.moz .d!
 ojoSpinn
er {\n\tdisplay: -moz-inline-box;\n}\n\n.opera .dojoSpinner {\n\tdisplay: inline-table;\n}\n\n/* generic stuff for the table */\n.dojoSpinner td {\n\tpadding:0px;\n\tmargin:0px;\n\tvertical-align: middle;\n}\ntable.dojoSpinner {\n\tborder:0px;\n\tborder-spacing:0px;\n\tline-height:0px;\n\tpadding:0px;\n\tmargin: 0px;\n\tvertical-align: middle;\n}\n\n/* the buttons */\n.dojoSpinner img {\n\tdisplay: block;\n\tborder-width:0px 1px 1px 0px;\n\tborder-style:outset;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Spinner.css&quot;), incrementSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/spinnerIncrement.gif&quot;), decrementSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/spinnerDecrement.gif&quot;), _handleKeyEvents:function (evt) {
+	if (!evt.key) {
+		return;
+	}
+	if (!evt.ctrlKey &amp;&amp; !evt.altKey) {
+		switch (evt.key) {
+		  case evt.KEY_DOWN_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			this._downArrowPressed(evt);
+			return;
+		  case evt.KEY_UP_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			this._upArrowPressed(evt);
+			return;
+		}
+	}
+	this._eventCount++;
+}, _onSpinnerKeyUp:function (evt) {
+	this._arrowReleased(evt);
+	this.onkeyup(evt);
+}, _resize:function () {
+	var inputSize = dojo.html.getBorderBox(this.textbox);
+	this.buttonSize = {width:inputSize.height / 2, height:inputSize.height / 2};
+	if (this.upArrowNode) {
+		dojo.html.setMarginBox(this.upArrowNode, this.buttonSize);
+		dojo.html.setMarginBox(this.downArrowNode, this.buttonSize);
+	}
+}, _pressButton:function (node) {
+	node.style.borderWidth = &quot;1px 0px 0px 1px&quot;;
+	node.style.borderStyle = &quot;inset&quot;;
+}, _releaseButton:function (node) {
+	node.style.borderWidth = &quot;0px 1px 1px 0px&quot;;
+	node.style.borderStyle = &quot;outset&quot;;
+}, _arrowPressed:function (evt, direction) {
+	var nodePressed = (direction == -1) ? this.downArrowNode : this.upArrowNode;
+	var nodeReleased = (direction == +1) ? this.downArrowNode : this.upArrowNode;
+	if (typeof evt != &quot;number&quot;) {
+		if (this._typamaticTimer != null) {
+			if (this._typamaticNode == nodePressed) {
+				return;
+			}
+			dojo.lang.clearTimeout(this._typamaticTimer);
+		}
+		this._releaseButton(nodeReleased);
+		this._eventCount++;
+		this._typamaticTimer = null;
+		this._currentTimeout = this.defaultTimeout;
+	} else {
+		if (evt != this._eventCount) {
+			this._releaseButton(nodePressed);
+			return;
+		}
+	}
+	this._pressButton(nodePressed);
+	this._setCursorX(this.adjustValue(direction, this._getCursorX()));
+	this._typamaticNode = nodePressed;
+	this._typamaticTimer = dojo.lang.setTimeout(this, &quot;_arrowPressed&quot;, this._currentTimeout, this._eventCount, direction);
+	this._currentTimeout = Math.round(this._currentTimeout * this.timeoutChangeRate);
+}, _downArrowPressed:function (evt) {
+	return this._arrowPressed(evt, -1);
+}, _downArrowDoubleClicked:function (evt) {
+	var rc = this._downArrowPressed(evt);
+	dojo.lang.setTimeout(this, &quot;_arrowReleased&quot;, 50, null);
+	return rc;
+}, _upArrowPressed:function (evt) {
+	return this._arrowPressed(evt, +1);
+}, _upArrowDoubleClicked:function (evt) {
+	var rc = this._upArrowPressed(evt);
+	dojo.lang.setTimeout(this, &quot;_arrowReleased&quot;, 50, null);
+	return rc;
+}, _arrowReleased:function (evt) {
+	this.textbox.focus();
+	if (evt != null &amp;&amp; typeof evt == &quot;object&quot; &amp;&amp; evt.keyCode &amp;&amp; evt.keyCode != null) {
+		var keyCode = evt.keyCode;
+		var k = dojo.event.browser.keys;
+		switch (keyCode) {
+		  case k.KEY_DOWN_ARROW:
+		  case k.KEY_UP_ARROW:
+			dojo.event.browser.stopEvent(evt);
+			break;
+		}
+	}
+	this._releaseButton(this.upArrowNode);
+	this._releaseButton(this.downArrowNode);
+	this._eventCount++;
+	if (this._typamaticTimer != null) {
+		dojo.lang.clearTimeout(this._typamaticTimer);
+	}
+	this._typamaticTimer = null;
+	this._currentTimeout = this.defaultTimeout;
+}, _mouseWheeled:function (evt) {
+	var scrollAmount = 0;
+	if (typeof evt.wheelDelta == &quot;number&quot;) {
+		scrollAmount = evt.wheelDelta;
+	} else {
+		if (typeof evt.detail == &quot;number&quot;) {
+			scrollAmount = -evt.detail;
+		}
+	}
+	if (scrollAmount &gt; 0) {
+		this._upArrowPressed(evt);
+		this._arrowReleased(evt);
+	} else {
+		if (scrollAmount &lt; 0) {
+			this._downArrowPressed(evt);
+			this._arrowReleased(evt);
+		}
+	}
+}, _discardEvent:function (evt) {
+	dojo.event.browser.stopEvent(evt);
+}, _getCursorX:function () {
+	var x = -1;
+	try {
+		this.textbox.focus();
+		if (typeof this.textbox.selectionEnd == &quot;number&quot;) {
+			x = this.textbox.selectionEnd;
+		} else {
+			if (document.selection &amp;&amp; document.selection.createRange) {
+				var range = document.selection.createRange().duplicate();
+				if (range.parentElement() == this.textbox) {
+					range.moveStart(&quot;textedit&quot;, -1);
+					x = range.text.length;
+				}
+			}
+		}
+	}
+	catch (e) {
+	}
+	return x;
+}, _setCursorX:function (x) {
+	try {
+		this.textbox.focus();
+		if (!x) {
+			x = 0;
+		}
+		if (typeof this.textbox.selectionEnd == &quot;number&quot;) {
+			this.textbox.selectionEnd = x;
+		} else {
+			if (this.textbox.createTextRange) {
+				var range = this.textbox.createTextRange();
+				range.collapse(true);
+				range.moveEnd(&quot;character&quot;, x);
+				range.moveStart(&quot;character&quot;, x);
+				range.select();
+			}
+		}
+	}
+	catch (e) {
+	}
+}, _spinnerPostMixInProperties:function (args, frag) {
+	var inputNode = this.getFragNodeRef(frag);
+	var inputSize = dojo.html.getBorderBox(inputNode);
+	this.buttonSize = {width:inputSize.height / 2 - 1, height:inputSize.height / 2 - 1};
+}, _spinnerPostCreate:function (args, frag) {
+	if (this.textbox.addEventListener) {
+		this.textbox.addEventListener(&quot;DOMMouseScroll&quot;, dojo.lang.hitch(this, &quot;_mouseWheeled&quot;), false);
+	} else {
+		dojo.event.connect(this.textbox, &quot;onmousewheel&quot;, this, &quot;_mouseWheeled&quot;);
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.IntegerSpinner&quot;, [dojo.widget.IntegerTextbox, dojo.widget.Spinner], {delta:&quot;1&quot;, postMixInProperties:function (args, frag) {
+	dojo.widget.IntegerSpinner.superclass.postMixInProperties.apply(this, arguments);
+	this._spinnerPostMixInProperties(args, frag);
+}, postCreate:function (args, frag) {
+	dojo.widget.IntegerSpinner.superclass.postCreate.apply(this, arguments);
+	this._spinnerPostCreate(args, frag);
+}, adjustValue:function (direction, x) {
+	var val = this.getValue().replace(/[^\-+\d]/g, &quot;&quot;);
+	if (val.length == 0) {
+		return;
+	}
+	var num = Math.min(Math.max((parseInt(val) + (parseInt(this.delta) * direction)), (this.flags.min ? this.flags.min : -Infinity)), (this.flags.max ? this.flags.max : +Infinity));
+	val = num.toString();
+	if (num &gt;= 0) {
+		val = ((this.flags.signed == true) ? &quot;+&quot; : &quot; &quot;) + val;
+	}
+	if (this.flags.separator.length &gt; 0) {
+		for (var i = val.length - 3; i &gt; 1; i -= 3) {
+			val = val.substr(0, i) + this.flags.separator + val.substr(i);
+		}
+	}
+	if (val.substr(0, 1) == &quot; &quot;) {
+		val = val.substr(1);
+	}
+	this.setValue(val);
+	return val.length;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.RealNumberSpinner&quot;, [dojo.widget.RealNumberTextbox, dojo.widget.Spinner], function () {
+	dojo.experimental(&quot;dojo.widget.RealNumberSpinner&quot;);
+}, {delta:&quot;1e1&quot;, postMixInProperties:function (args, frag) {
+	dojo.widget.RealNumberSpinner.superclass.postMixInProperties.apply(this, arguments);
+	this._spinnerPostMixInProperties(args, frag);
+}, postCreate:function (args, frag) {
+	dojo.widget.RealNumberSpinner.superclass.postCreate.apply(this, arguments);
+	this._spinnerPostCreate(args, frag);
+}, adjustValue:function (direction, x) {
+	var val = this.getValue().replace(/[^\-+\.eE\d]/g, &quot;&quot;);
+	if (!val.length) {
+		return;
+	}
+	var num = parseFloat(val);
+	if (isNaN(num)) {
+		return;
+	}
+	var delta = this.delta.split(/[eE]/);
+	if (!delta.length) {
+		delta = [1, 1];
+	} else {
+		delta[0] = parseFloat(delta[0].replace(/[^\-+\.\d]/g, &quot;&quot;));
+		if (isNaN(delta[0])) {
+			delta[0] = 1;
+		}
+		if (delta.length &gt; 1) {
+			delta[1] = parseInt(delta[1]);
+		}
+		if (isNaN(delta[1])) {
+			delta[1] = 1;
+		}
+	}
+	val = this.getValue().split(/[eE]/);
+	if (!val.length) {
+		return;
+	}
+	var numBase = parseFloat(val[0].replace(/[^\-+\.\d]/g, &quot;&quot;));
+	if (val.length == 1) {
+		var numExp = 0;
+	} else {
+		var numExp = parseInt(val[1].replace(/[^\-+\d]/g, &quot;&quot;));
+	}
+	if (x &lt;= val[0].length) {
+		x = 0;
+		numBase += delta[0] * direction;
+	} else {
+		x = Number.MAX_VALUE;
+		numExp += delta[1] * direction;
+		if (this.flags.eSigned == false &amp;&amp; numExp &lt; 0) {
+			numExp = 0;
+		}
+	}
+	num = Math.min(Math.max((numBase * Math.pow(10, numExp)), (this.flags.min ? this.flags.min : -Infinity)), (this.flags.max ? this.flags.max : +Infinity));
+	if ((this.flags.exponent == true || (this.flags.exponent != false &amp;&amp; x != 0)) &amp;&amp; num.toExponential) {
+		if (isNaN(this.flags.places) || this.flags.places == Infinity) {
+			val = num.toExponential();
+		} else {
+			val = num.toExponential(this.flags.places);
+		}
+	} else {
+		if (num.toFixed &amp;&amp; num.toPrecision) {
+			if (isNaN(this.flags.places) || this.flags.places == Infinity) {
+				val = num.toPrecision((1 / 3).toString().length - 1);
+			} else {
+				val = num.toFixed(this.flags.places);
+			}
+		} else {
+			val = num.toString();
+		}
+	}
+	if (num &gt;= 0) {
+		if (this.flags.signed == true) {
+			val = &quot;+&quot; + val;
+		}
+	}
+	val = val.split(/[eE]/);
+	if (this.flags.separator.length &gt; 0) {
+		if (num &gt;= 0 &amp;&amp; val[0].substr(0, 1) != &quot;+&quot;) {
+			val[0] = &quot; &quot; + val[0];
+		}
+		var i = val[0].lastIndexOf(&quot;.&quot;);
+		if (i &gt;= 0) {
+			i -= 3;
+		} else {
+			i = val[0].length - 3;
+		}
+		for (; i &gt; 1; i -= 3) {
+			val[0] = val[0].substr(0, i) + this.flags.separator + val[0].substr(i);
+		}
+		if (val[0].substr(0, 1) == &quot; &quot;) {
+			val[0] = val[0].substr(1);
+		}
+	}
+	if (val.length &gt; 1) {
+		if ((this.flags.eSigned == true) &amp;&amp; (val[1].substr(0, 1) != &quot;+&quot;)) {
+			val[1] = &quot;+&quot; + val[1];
+		} else {
+			if ((!this.flags.eSigned) &amp;&amp; (val[1].substr(0, 1) == &quot;+&quot;)) {
+				val[1] = val[1].substr(1);
+			} else {
+				if ((!this.flags.eSigned) &amp;&amp; (val[1].substr(0, 1) == &quot;-&quot;) &amp;&amp; (num.toFixed &amp;&amp; num.toPrecision)) {
+					if (isNaN(this.flags.places)) {
+						val[0] = num.toPrecision((1 / 3).toString().length - 1);
+					} else {
+						val[0] = num.toFixed(this.flags.places).toString();
+					}
+					val[1] = &quot;0&quot;;
+				}
+			}
+		}
+		val[0] += &quot;e&quot; + val[1];
+	}
+	this.setValue(val[0]);
+	if (x &gt; val[0].length) {
+		x = val[0].length;
+	}
+	return x;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TimeSpinner&quot;, [dojo.widget.TimeTextbox, dojo.widget.Spinner], function () {
+	dojo.experimental(&quot;dojo.widget.TimeSpinner&quot;);
+}, {postMixInProperties:function (args, frag) {
+	dojo.widget.TimeSpinner.superclass.postMixInProperties.apply(this, arguments);
+	this._spinnerPostMixInProperties(args, frag);
+}, postCreate:function (args, frag) {
+	dojo.widget.TimeSpinner.superclass.postCreate.apply(this, arguments);
+	this._spinnerPostCreate(args, frag);
+}, adjustValue:function (direction, x) {
+	var val = this.getValue();
+	var format = (this.flags.format &amp;&amp; this.flags.format.search(/[Hhmst]/) &gt;= 0) ? this.flags.format : &quot;hh:mm:ss t&quot;;
+	if (direction == 0 || !val.length || !this.isValid()) {
+		return;
+	}
+	if (!this.flags.amSymbol) {
+		this.flags.amSymbol = &quot;AM&quot;;
+	}
+	if (!this.flags.pmSymbol) {
+		this.flags.pmSymbol = &quot;PM&quot;;
+	}
+	var re = dojo.regexp.time(this.flags);
+	var qualifiers = format.replace(/H/g, &quot;h&quot;).replace(/[^hmst]/g, &quot;&quot;).replace(/([hmst])\1/g, &quot;$1&quot;);
+	var hourPos = qualifiers.indexOf(&quot;h&quot;) + 1;
+	var minPos = qualifiers.indexOf(&quot;m&quot;) + 1;
+	var secPos = qualifiers.indexOf(&quot;s&quot;) + 1;
+	var ampmPos = qualifiers.indexOf(&quot;t&quot;) + 1;
+	var cursorFormat = format;
+	var ampm = &quot;&quot;;
+	if (ampmPos &gt; 0) {
+		ampm = val.replace(new RegExp(re), &quot;$&quot; + ampmPos);
+		cursorFormat = cursorFormat.replace(/t+/, ampm.replace(/./g, &quot;t&quot;));
+	}
+	var hour = 0;
+	var deltaHour = 1;
+	if (hourPos &gt; 0) {
+		hour = val.replace(new RegExp(re), &quot;$&quot; + hourPos);
+		if (dojo.lang.isString(this.delta)) {
+			deltaHour = this.delta.replace(new RegExp(re), &quot;$&quot; + hourPos);
+		}
+		if (isNaN(deltaHour)) {
+			deltaHour = 1;
+		} else {
+			deltaHour = parseInt(deltaHour);
+		}
+		if (hour.length == 2) {
+			cursorFormat = cursorFormat.replace(/([Hh])+/, &quot;$1$1&quot;);
+		} else {
+			cursorFormat = cursorFormat.replace(/([Hh])+/, &quot;$1&quot;);
+		}
+		if (isNaN(hour)) {
+			hour = 0;
+		} else {
+			hour = parseInt(hour.replace(/^0(\d)/, &quot;$1&quot;));
+		}
+	}
+	var min = 0;
+	var deltaMin = 1;
+	if (minPos &gt; 0) {
+		min = val.replace(new RegExp(re), &quot;$&quot; + minPos);
+		if (dojo.lang.isString(this.delta)) {
+			deltaMin = this.delta.replace(new RegExp(re), &quot;$&quot; + minPos);
+		}
+		if (isNaN(deltaMin)) {
+			deltaMin = 1;
+		} else {
+			deltaMin = parseInt(deltaMin);
+		}
+		cursorFormat = cursorFormat.replace(/m+/, min.replace(/./g, &quot;m&quot;));
+		if (isNaN(min)) {
+			min = 0;
+		} else {
+			min = parseInt(min.replace(/^0(\d)/, &quot;$1&quot;));
+		}
+	}
+	var sec = 0;
+	var deltaSec = 1;
+	if (secPos &gt; 0) {
+		sec = val.replace(new RegExp(re), &quot;$&quot; + secPos);
+		if (dojo.lang.isString(this.delta)) {
+			deltaSec = this.delta.replace(new RegExp(re), &quot;$&quot; + secPos);
+		}
+		if (isNaN(deltaSec)) {
+			deltaSec = 1;
+		} else {
+			deltaSec = parseInt(deltaSec);
+		}
+		cursorFormat = cursorFormat.replace(/s+/, sec.replace(/./g, &quot;s&quot;));
+		if (isNaN(sec)) {
+			sec = 0;
+		} else {
+			sec = parseInt(sec.replace(/^0(\d)/, &quot;$1&quot;));
+		}
+	}
+	if (isNaN(x) || x &gt;= cursorFormat.length) {
+		x = cursorFormat.length - 1;
+	}
+	var cursorToken = cursorFormat.charAt(x);
+	switch (cursorToken) {
+	  case &quot;t&quot;:
+		if (ampm == this.flags.amSymbol) {
+			ampm = this.flags.pmSymbol;
+		} else {
+			if (ampm == this.flags.pmSymbol) {
+				ampm = this.flags.amSymbol;
+			}
+		}
+		break;
+	  default:
+		if (hour &gt;= 1 &amp;&amp; hour &lt; 12 &amp;&amp; ampm == this.flags.pmSymbol) {
+			hour += 12;
+		}
+		if (hour == 12 &amp;&amp; ampm == this.flags.amSymbol) {
+			hour = 0;
+		}
+		switch (cursorToken) {
+		  case &quot;s&quot;:
+			sec += deltaSec * direction;
+			while (sec &lt; 0) {
+				min--;
+				sec += 60;
+			}
+			while (sec &gt;= 60) {
+				min++;
+				sec -= 60;
+			}
+		  case &quot;m&quot;:
+			if (cursorToken == &quot;m&quot;) {
+				min += deltaMin * direction;
+			}
+			while (min &lt; 0) {
+				hour--;
+				min += 60;
+			}
+			while (min &gt;= 60) {
+				hour++;
+				min -= 60;
+			}
+		  case &quot;h&quot;:
+		  case &quot;H&quot;:
+			if (cursorToken == &quot;h&quot; || cursorToken == &quot;H&quot;) {
+				hour += deltaHour * direction;
+			}
+			while (hour &lt; 0) {
+				hour += 24;
+			}
+			while (hour &gt;= 24) {
+				hour -= 24;
+			}
+			break;
+		  default:
+			return;
+		}
+		if (hour &gt;= 12) {
+			ampm = this.flags.pmSymbol;
+			if (format.indexOf(&quot;h&quot;) &gt;= 0 &amp;&amp; hour &gt;= 13) {
+				hour -= 12;
+			}
+		} else {
+			ampm = this.flags.amSymbol;
+			if (format.indexOf(&quot;h&quot;) &gt;= 0 &amp;&amp; hour == 0) {
+				hour = 12;
+			}
+		}
+	}
+	cursorFormat = format;
+	if (hour &gt;= 0 &amp;&amp; hour &lt; 10 &amp;&amp; format.search(/[hH]{2}/) &gt;= 0) {
+		hour = &quot;0&quot; + hour.toString();
+	}
+	if (hour &gt;= 10 &amp;&amp; cursorFormat.search(/[hH]{2}/) &lt; 0) {
+		cursorFormat = cursorFormat.replace(/(h|H)/, &quot;$1$1&quot;);
+	}
+	if (min &gt;= 0 &amp;&amp; min &lt; 10 &amp;&amp; cursorFormat.search(/mm/) &gt;= 0) {
+		min = &quot;0&quot; + min.toString();
+	}
+	if (min &gt;= 10 &amp;&amp; cursorFormat.search(/mm/) &lt; 0) {
+		cursorFormat = cursorFormat.replace(/m/, &quot;$1$1&quot;);
+	}
+	if (sec &gt;= 0 &amp;&amp; sec &lt; 10 &amp;&amp; cursorFormat.search(/ss/) &gt;= 0) {
+		sec = &quot;0&quot; + sec.toString();
+	}
+	if (sec &gt;= 10 &amp;&amp; cursorFormat.search(/ss/) &lt; 0) {
+		cursorFormat = cursorFormat.replace(/s/, &quot;$1$1&quot;);
+	}
+	x = cursorFormat.indexOf(cursorToken);
+	if (x == -1) {
+		x = format.length;
+	}
+	format = format.replace(/[hH]+/, hour);
+	format = format.replace(/m+/, min);
+	format = format.replace(/s+/, sec);
+	format = format.replace(/t/, ampm);
+	this.setValue(format);
+	if (x &gt; format.length) {
+		x = format.length;
+	}
+	return x;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/SplitContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/SplitContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/SplitContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,325 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.SplitContainer&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.io.cookie&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.SplitContainer&quot;, dojo.widget.HtmlWidget, function () {
+	this.sizers = [];
+}, {isContainer:true, templateCssString:&quot;.dojoSplitContainer{\n\tposition: relative;\n\toverflow: hidden;\n\tdisplay: block;\n}\n\n.dojoSplitPane{\n\tposition: absolute;\n}\n\n.dojoSplitContainerSizerH,\n.dojoSplitContainerSizerV {\n\tfont-size: 1px;\n\tcursor: move;\n\tcursor: w-resize;\n\tbackground-color: ThreeDFace;\n\tborder: 1px solid;\n\tborder-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;\n\tmargin: 0;\n}\n\n.dojoSplitContainerSizerV {\n\tcursor: n-resize;\n}\n\n.dojoSplitContainerVirtualSizerH,\n.dojoSplitContainerVirtualSizerV {\n\tfont-size: 1px;\n\tcursor: move;\n\tcursor: w-resize;\n\tbackground-color: ThreeDShadow;\n\t-moz-opacity: 0.5;\n\topacity: 0.5;\n\tfilter: Alpha(Opacity=50);\n\tmargin: 0;\n}\n\n.dojoSplitContainerVirtualSizerV {\n\tcursor: n-resize;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/SplitContainer.css&quot;), activeSizing:false, sizerWidth:15, orientation:&quot;horizontal&quot;, persist:true, postMixInProperties:f!
 unction () {
+	dojo.widget.SplitContainer.superclass.postMixInProperties.apply(this, arguments);
+	this.isHorizontal = (this.orientation == &quot;horizontal&quot;);
+}, fillInTemplate:function () {
+	dojo.widget.SplitContainer.superclass.fillInTemplate.apply(this, arguments);
+	dojo.html.addClass(this.domNode, &quot;dojoSplitContainer&quot;);
+	if (dojo.render.html.moz) {
+		this.domNode.style.overflow = &quot;-moz-scrollbars-none&quot;;
+	}
+	var content = dojo.html.getContentBox(this.domNode);
+	this.paneWidth = content.width;
+	this.paneHeight = content.height;
+}, onResized:function (e) {
+	var content = dojo.html.getContentBox(this.domNode);
+	this.paneWidth = content.width;
+	this.paneHeight = content.height;
+	this._layoutPanels();
+}, postCreate:function (args, fragment, parentComp) {
+	dojo.widget.SplitContainer.superclass.postCreate.apply(this, arguments);
+	for (var i = 0; i &lt; this.children.length; i++) {
+		with (this.children[i].domNode.style) {
+			position = &quot;absolute&quot;;
+		}
+		dojo.html.addClass(this.children[i].domNode, &quot;dojoSplitPane&quot;);
+		if (i == this.children.length - 1) {
+			break;
+		}
+		this._addSizer();
+	}
+	if (typeof this.sizerWidth == &quot;object&quot;) {
+		try {
+			this.sizerWidth = parseInt(this.sizerWidth.toString());
+		}
+		catch (e) {
+			this.sizerWidth = 15;
+		}
+	}
+	this.virtualSizer = document.createElement(&quot;div&quot;);
+	this.virtualSizer.style.position = &quot;absolute&quot;;
+	this.virtualSizer.style.display = &quot;none&quot;;
+	this.virtualSizer.style.zIndex = 10;
+	this.virtualSizer.className = this.isHorizontal ? &quot;dojoSplitContainerVirtualSizerH&quot; : &quot;dojoSplitContainerVirtualSizerV&quot;;
+	this.domNode.appendChild(this.virtualSizer);
+	dojo.html.disableSelection(this.virtualSizer);
+	if (this.persist) {
+		this._restoreState();
+	}
+	this.resizeSoon();
+}, _injectChild:function (child) {
+	with (child.domNode.style) {
+		position = &quot;absolute&quot;;
+	}
+	dojo.html.addClass(child.domNode, &quot;dojoSplitPane&quot;);
+}, _addSizer:function () {
+	var i = this.sizers.length;
+	this.sizers[i] = document.createElement(&quot;div&quot;);
+	this.sizers[i].style.position = &quot;absolute&quot;;
+	this.sizers[i].className = this.isHorizontal ? &quot;dojoSplitContainerSizerH&quot; : &quot;dojoSplitContainerSizerV&quot;;
+	var self = this;
+	var handler = (function () {
+		var sizer_i = i;
+		return function (e) {
+			self.beginSizing(e, sizer_i);
+		};
+	})();
+	dojo.event.connect(this.sizers[i], &quot;onmousedown&quot;, handler);
+	this.domNode.appendChild(this.sizers[i]);
+	dojo.html.disableSelection(this.sizers[i]);
+}, removeChild:function (widget) {
+	if (this.sizers.length &gt; 0) {
+		for (var x = 0; x &lt; this.children.length; x++) {
+			if (this.children[x] === widget) {
+				var i = this.sizers.length - 1;
+				this.domNode.removeChild(this.sizers[i]);
+				this.sizers.length = i;
+				break;
+			}
+		}
+	}
+	dojo.widget.SplitContainer.superclass.removeChild.call(this, widget, arguments);
+	this.onResized();
+}, addChild:function (widget) {
+	dojo.widget.SplitContainer.superclass.addChild.apply(this, arguments);
+	this._injectChild(widget);
+	if (this.children.length &gt; 1) {
+		this._addSizer();
+	}
+	this._layoutPanels();
+}, _layoutPanels:function () {
+	if (this.children.length == 0) {
+		return;
+	}
+	var space = this.isHorizontal ? this.paneWidth : this.paneHeight;
+	if (this.children.length &gt; 1) {
+		space -= this.sizerWidth * (this.children.length - 1);
+	}
+	var out_of = 0;
+	for (var i = 0; i &lt; this.children.length; i++) {
+		out_of += this.children[i].sizeShare;
+	}
+	var pix_per_unit = space / out_of;
+	var total_size = 0;
+	for (var i = 0; i &lt; this.children.length - 1; i++) {
+		var size = Math.round(pix_per_unit * this.children[i].sizeShare);
+		this.children[i].sizeActual = size;
+		total_size += size;
+	}
+	this.children[this.children.length - 1].sizeActual = space - total_size;
+	this._checkSizes();
+	var pos = 0;
+	var size = this.children[0].sizeActual;
+	this._movePanel(this.children[0], pos, size);
+	this.children[0].position = pos;
+	pos += size;
+	for (var i = 1; i &lt; this.children.length; i++) {
+		this._moveSlider(this.sizers[i - 1], pos, this.sizerWidth);
+		this.sizers[i - 1].position = pos;
+		pos += this.sizerWidth;
+		size = this.children[i].sizeActual;
+		this._movePanel(this.children[i], pos, size);
+		this.children[i].position = pos;
+		pos += size;
+	}
+}, _movePanel:function (panel, pos, size) {
+	if (this.isHorizontal) {
+		panel.domNode.style.left = pos + &quot;px&quot;;
+		panel.domNode.style.top = 0;
+		panel.resizeTo(size, this.paneHeight);
+	} else {
+		panel.domNode.style.left = 0;
+		panel.domNode.style.top = pos + &quot;px&quot;;
+		panel.resizeTo(this.paneWidth, size);
+	}
+}, _moveSlider:function (slider, pos, size) {
+	if (this.isHorizontal) {
+		slider.style.left = pos + &quot;px&quot;;
+		slider.style.top = 0;
+		dojo.html.setMarginBox(slider, {width:size, height:this.paneHeight});
+	} else {
+		slider.style.left = 0;
+		slider.style.top = pos + &quot;px&quot;;
+		dojo.html.setMarginBox(slider, {width:this.paneWidth, height:size});
+	}
+}, _growPane:function (growth, pane) {
+	if (growth &gt; 0) {
+		if (pane.sizeActual &gt; pane.sizeMin) {
+			if ((pane.sizeActual - pane.sizeMin) &gt; growth) {
+				pane.sizeActual = pane.sizeActual - growth;
+				growth = 0;
+			} else {
+				growth -= pane.sizeActual - pane.sizeMin;
+				pane.sizeActual = pane.sizeMin;
+			}
+		}
+	}
+	return growth;
+}, _checkSizes:function () {
+	var total_min_size = 0;
+	var total_size = 0;
+	for (var i = 0; i &lt; this.children.length; i++) {
+		total_size += this.children[i].sizeActual;
+		total_min_size += this.children[i].sizeMin;
+	}
+	if (total_min_size &lt;= total_size) {
+		var growth = 0;
+		for (var i = 0; i &lt; this.children.length; i++) {
+			if (this.children[i].sizeActual &lt; this.children[i].sizeMin) {
+				growth += this.children[i].sizeMin - this.children[i].sizeActual;
+				this.children[i].sizeActual = this.children[i].sizeMin;
+			}
+		}
+		if (growth &gt; 0) {
+			if (this.isDraggingLeft) {
+				for (var i = this.children.length - 1; i &gt;= 0; i--) {
+					growth = this._growPane(growth, this.children[i]);
+				}
+			} else {
+				for (var i = 0; i &lt; this.children.length; i++) {
+					growth = this._growPane(growth, this.children[i]);
+				}
+			}
+		}
+	} else {
+		for (var i = 0; i &lt; this.children.length; i++) {
+			this.children[i].sizeActual = Math.round(total_size * (this.children[i].sizeMin / total_min_size));
+		}
+	}
+}, beginSizing:function (e, i) {
+	this.paneBefore = this.children[i];
+	this.paneAfter = this.children[i + 1];
+	this.isSizing = true;
+	this.sizingSplitter = this.sizers[i];
+	this.originPos = dojo.html.getAbsolutePosition(this.children[0].domNode, true, dojo.html.boxSizing.MARGIN_BOX);
+	if (this.isHorizontal) {
+		var client = (e.layerX ? e.layerX : e.offsetX);
+		var screen = e.pageX;
+		this.originPos = this.originPos.x;
+	} else {
+		var client = (e.layerY ? e.layerY : e.offsetY);
+		var screen = e.pageY;
+		this.originPos = this.originPos.y;
+	}
+	this.startPoint = this.lastPoint = screen;
+	this.screenToClientOffset = screen - client;
+	this.dragOffset = this.lastPoint - this.paneBefore.sizeActual - this.originPos - this.paneBefore.position;
+	if (!this.activeSizing) {
+		this._showSizingLine();
+	}
+	dojo.event.connect(document.documentElement, &quot;onmousemove&quot;, this, &quot;changeSizing&quot;);
+	dojo.event.connect(document.documentElement, &quot;onmouseup&quot;, this, &quot;endSizing&quot;);
+	dojo.event.browser.stopEvent(e);
+}, changeSizing:function (e) {
+	this.lastPoint = this.isHorizontal ? e.pageX : e.pageY;
+	if (this.activeSizing) {
+		this.movePoint();
+		this._updateSize();
+	} else {
+		this.movePoint();
+		this._moveSizingLine();
+	}
+	dojo.event.browser.stopEvent(e);
+}, endSizing:function (e) {
+	if (!this.activeSizing) {
+		this._hideSizingLine();
+	}
+	this._updateSize();
+	this.isSizing = false;
+	dojo.event.disconnect(document.documentElement, &quot;onmousemove&quot;, this, &quot;changeSizing&quot;);
+	dojo.event.disconnect(document.documentElement, &quot;onmouseup&quot;, this, &quot;endSizing&quot;);
+	if (this.persist) {
+		this._saveState(this);
+	}
+}, movePoint:function () {
+	var p = this.lastPoint - this.screenToClientOffset;
+	var a = p - this.dragOffset;
+	a = this.legaliseSplitPoint(a);
+	p = a + this.dragOffset;
+	this.lastPoint = p + this.screenToClientOffset;
+}, legaliseSplitPoint:function (a) {
+	a += this.sizingSplitter.position;
+	this.isDraggingLeft = (a &gt; 0) ? true : false;
+	if (!this.activeSizing) {
+		if (a &lt; this.paneBefore.position + this.paneBefore.sizeMin) {
+			a = this.paneBefore.position + this.paneBefore.sizeMin;
+		}
+		if (a &gt; this.paneAfter.position + (this.paneAfter.sizeActual - (this.sizerWidth + this.paneAfter.sizeMin))) {
+			a = this.paneAfter.position + (this.paneAfter.sizeActual - (this.sizerWidth + this.paneAfter.sizeMin));
+		}
+	}
+	a -= this.sizingSplitter.position;
+	this._checkSizes();
+	return a;
+}, _updateSize:function () {
+	var pos = this.lastPoint - this.dragOffset - this.originPos;
+	var start_region = this.paneBefore.position;
+	var end_region = this.paneAfter.position + this.paneAfter.sizeActual;
+	this.paneBefore.sizeActual = pos - start_region;
+	this.paneAfter.position = pos + this.sizerWidth;
+	this.paneAfter.sizeActual = end_region - this.paneAfter.position;
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this.children[i].sizeShare = this.children[i].sizeActual;
+	}
+	this._layoutPanels();
+}, _showSizingLine:function () {
+	this._moveSizingLine();
+	if (this.isHorizontal) {
+		dojo.html.setMarginBox(this.virtualSizer, {width:this.sizerWidth, height:this.paneHeight});
+	} else {
+		dojo.html.setMarginBox(this.virtualSizer, {width:this.paneWidth, height:this.sizerWidth});
+	}
+	this.virtualSizer.style.display = &quot;block&quot;;
+}, _hideSizingLine:function () {
+	this.virtualSizer.style.display = &quot;none&quot;;
+}, _moveSizingLine:function () {
+	var pos = this.lastPoint - this.startPoint + this.sizingSplitter.position;
+	if (this.isHorizontal) {
+		this.virtualSizer.style.left = pos + &quot;px&quot;;
+	} else {
+		var pos = (this.lastPoint - this.startPoint) + this.sizingSplitter.position;
+		this.virtualSizer.style.top = pos + &quot;px&quot;;
+	}
+}, _getCookieName:function (i) {
+	return this.widgetId + &quot;_&quot; + i;
+}, _restoreState:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var cookieName = this._getCookieName(i);
+		var cookieValue = dojo.io.cookie.getCookie(cookieName);
+		if (cookieValue != null) {
+			var pos = parseInt(cookieValue);
+			if (typeof pos == &quot;number&quot;) {
+				this.children[i].sizeShare = pos;
+			}
+		}
+	}
+}, _saveState:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var cookieName = this._getCookieName(i);
+		dojo.io.cookie.setCookie(cookieName, this.children[i].sizeShare, null, null, null, null);
+	}
+}});
+dojo.lang.extend(dojo.widget.Widget, {sizeMin:10, sizeShare:10});
+dojo.widget.defineWidget(&quot;dojo.widget.SplitContainerPanel&quot;, dojo.widget.ContentPane, {});
+

Added: tags/parley-0.55/root/static/magic/src/widget/SvgButton.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/SvgButton.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/SvgButton.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,100 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.SvgButton&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.widget.SvgButton&quot;);
+dojo.widget.SvgButton = function () {
+	dojo.widget.DomButton.call(this);
+	dojo.widget.SvgWidget.call(this);
+	this.onFoo = function () {
+		alert(&quot;bar&quot;);
+	};
+	this.label = &quot;huzzah!&quot;;
+	this.setLabel = function (x, y, textSize, label, shape) {
+		var coords = dojo.widget.SvgButton.prototype.coordinates(x, y, textSize, label, shape);
+		var textString = &quot;&quot;;
+		switch (shape) {
+		  case &quot;ellipse&quot;:
+			textString = &quot;&lt;text x='&quot; + coords[6] + &quot;' y='&quot; + coords[7] + &quot;'&gt;&quot; + label + &quot;&lt;/text&gt;&quot;;
+			break;
+		  case &quot;rectangle&quot;:
+			textString = &quot;&quot;;
+			break;
+		  case &quot;circle&quot;:
+			textString = &quot;&quot;;
+			break;
+		}
+		return textString;
+	};
+	this.fillInTemplate = function (x, y, textSize, label, shape) {
+		this.textSize = textSize || 12;
+		this.label = label;
+		var textWidth = this.label.length * this.textSize;
+	};
+};
+dojo.inherits(dojo.widget.SvgButton, dojo.widget.DomButton);
+dojo.widget.SvgButton.prototype.shapeString = function (x, y, textSize, label, shape) {
+	switch (shape) {
+	  case &quot;ellipse&quot;:
+		var coords = dojo.widget.SvgButton.prototype.coordinates(x, y, textSize, label, shape);
+		return &quot;&lt;ellipse cx='&quot; + coords[4] + &quot;' cy='&quot; + coords[5] + &quot;' rx='&quot; + coords[2] + &quot;' ry='&quot; + coords[3] + &quot;'/&gt;&quot;;
+		break;
+	  case &quot;rect&quot;:
+		return &quot;&quot;;
+		break;
+	  case &quot;circle&quot;:
+		return &quot;&quot;;
+		break;
+	}
+};
+dojo.widget.SvgButton.prototype.coordinates = function (x, y, textSize, label, shape) {
+	switch (shape) {
+	  case &quot;ellipse&quot;:
+		var buttonWidth = label.length * textSize;
+		var buttonHeight = textSize * 2.5;
+		var rx = buttonWidth / 2;
+		var ry = buttonHeight / 2;
+		var cx = rx + x;
+		var cy = ry + y;
+		var textX = cx - rx * textSize / 25;
+		var textY = cy * 1.1;
+		return [buttonWidth, buttonHeight, rx, ry, cx, cy, textX, textY];
+		break;
+	  case &quot;rectangle&quot;:
+		return &quot;&quot;;
+		break;
+	  case &quot;circle&quot;:
+		return &quot;&quot;;
+		break;
+	}
+};
+dojo.widget.SvgButton.prototype.labelString = function (x, y, textSize, label, shape) {
+	var textString = &quot;&quot;;
+	var coords = dojo.widget.SvgButton.prototype.coordinates(x, y, textSize, label, shape);
+	switch (shape) {
+	  case &quot;ellipse&quot;:
+		textString = &quot;&lt;text x='&quot; + coords[6] + &quot;' y='&quot; + coords[7] + &quot;'&gt;&quot; + label + &quot;&lt;/text&gt;&quot;;
+		break;
+	  case &quot;rectangle&quot;:
+		textString = &quot;&quot;;
+		break;
+	  case &quot;circle&quot;:
+		textString = &quot;&quot;;
+		break;
+	}
+	return textString;
+};
+dojo.widget.SvgButton.prototype.templateString = function (x, y, textSize, label, shape) {
+	return &quot;&lt;g class='dojoButton' dojoAttachEvent='onClick; onMouseMove: onFoo;' dojoAttachPoint='labelNode'&gt;&quot; + dojo.widgets.SVGButton.prototype.shapeString(x, y, textSize, label, shape) + dojo.widget.SVGButton.prototype.labelString(x, y, textSize, label, shape) + &quot;&lt;/g&gt;&quot;;
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/SvgWidget.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/SvgWidget.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/SvgWidget.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,71 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.widget.DomWidget&quot;);
+dojo.provide(&quot;dojo.widget.SvgWidget&quot;);
+dojo.provide(&quot;dojo.widget.SVGWidget&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.widget.SvgWidget&quot;);
+dojo.widget.declare(&quot;dojo.widget.SvgWidget&quot;, dojo.widget.DomWidget, {createNodesFromText:function (txt, wrap) {
+	return dojo.svg.createNodesFromText(txt, wrap);
+}});
+dojo.widget.SVGWidget = dojo.widget.SvgWidget;
+try {
+	(function () {
+		var tf = function () {
+			var rw = new function () {
+				dojo.widget.SvgWidget.call(this);
+				this.buildRendering = function () {
+					return;
+				};
+				this.destroyRendering = function () {
+					return;
+				};
+				this.postInitialize = function () {
+					return;
+				};
+				this.widgetType = &quot;SVGRootWidget&quot;;
+				this.domNode = document.documentElement;
+			};
+			var wm = dojo.widget.manager;
+			wm.root = rw;
+			wm.add(rw);
+			wm.getWidgetFromNode = function (node) {
+				var filter = function (x) {
+					if (x.domNode == node) {
+						return true;
+					}
+				};
+				var widgets = [];
+				while ((node) &amp;&amp; (widgets.length &lt; 1)) {
+					widgets = this.getWidgetsByFilter(filter);
+					node = node.parentNode;
+				}
+				if (widgets.length &gt; 0) {
+					return widgets[0];
+				} else {
+					return null;
+				}
+			};
+			wm.getWidgetFromEvent = function (domEvt) {
+				return this.getWidgetFromNode(domEvt.target);
+			};
+			wm.getWidgetFromPrimitive = wm.getWidgetFromNode;
+		};
+		dojo.event.connect(dojo.hostenv, &quot;loaded&quot;, tf);
+	})();
+}
+catch (e) {
+	alert(e);
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/SwtWidget.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/SwtWidget.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/SwtWidget.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.SwtWidget&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.widget.SwtWidget&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.widget.Widget&quot;);
+dojo.require(&quot;dojo.uri.*&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+try {
+	importPackage(Packages.org.eclipse.swt.widgets);
+	dojo.declare(&quot;dojo.widget.SwtWidget&quot;, dojo.widget.Widget, function () {
+		if ((arguments.length &gt; 0) &amp;&amp; (typeof arguments[0] == &quot;object&quot;)) {
+			this.create(arguments[0]);
+		}
+	}, {display:null, shell:null, show:function () {
+	}, hide:function () {
+	}, addChild:function () {
+	}, registerChild:function () {
+	}, addWidgetAsDirectChild:function () {
+	}, removeChild:function () {
+	}, destroyRendering:function () {
+	}, postInitialize:function () {
+	}});
+	dojo.widget.SwtWidget.prototype.display = new Display();
+	dojo.widget.SwtWidget.prototype.shell = new Shell(dojo.widget.SwtWidget.prototype.display);
+	dojo.widget.manager.startShell = function () {
+		var sh = dojo.widget.SwtWidget.prototype.shell;
+		var d = dojo.widget.SwtWidget.prototype.display;
+		sh.open();
+		while (!sh.isDisposed()) {
+			dojo.widget.manager.doNext();
+			if (!d.readAndDispatch()) {
+				d.sleep();
+			}
+		}
+		d.dispose();
+	};
+}
+catch (e) {
+	dojo.debug(&quot;dojo.widget.SwtWidget not loaded. SWT classes not available&quot;);
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/TabContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TabContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TabContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,89 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TabContainer&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.PageContainer&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.require(&quot;dojo.widget.html.layout&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TabContainer&quot;, dojo.widget.PageContainer, {labelPosition:&quot;top&quot;, closeButton:&quot;none&quot;, templateString:null, templateString:&quot;&lt;div id=\&quot;${this.widgetId}\&quot; class=\&quot;dojoTabContainer\&quot;&gt;\n\t&lt;div dojoAttachPoint=\&quot;tablistNode\&quot;&gt;&lt;/div&gt;\n\t&lt;div class=\&quot;dojoTabPaneWrapper\&quot; dojoAttachPoint=\&quot;containerNode\&quot; dojoAttachEvent=\&quot;onKey\&quot; waiRole=\&quot;tabpanel\&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.dojoTabContainer {\n\tposition : relative;\n}\n\n.dojoTabPaneWrapper {\n\tborder : 1px solid #6290d2;\n\t_zoom: 1; /* force IE6 layout mode so top border doesnt disappear */\n\tdisplay: block;\n\tclear: both;\n\toverflow: hidden;\n}\n\n.dojoTabLabels-top {\n\tposition : relative;\n\ttop : 0px;\n\tleft : 0px;\n\toverflow : visible;\n\tmargin-bottom : -1px;\n\twidth : 100%;\n\tz-index: 2;\t/* so the bottom of the tab label will cover up the border of dojoTabPaneWrapper */\n}\n\n.dojoTabNoLayout.dojoTabLabels-top .dojoTab {\n\tmargin-bottom: -1px;\n\t_margin-bottom!
 : 0px; /* IE filter so top border lines up correctly */\n}\n\n.dojoTab {\n\tposition : relative;\n\tfloat : left;\n\tpadding-left : 9px;\n\tborder-bottom : 1px solid #6290d2;\n\tbackground : url(images/tab_left.gif) no-repeat left top;\n\tcursor: pointer;\n\twhite-space: nowrap;\n\tz-index: 3;\n}\n\n.dojoTab div {\n\tdisplay : block;\n\tpadding : 4px 15px 4px 6px;\n\tbackground : url(images/tab_top_right.gif) no-repeat right top;\n\tcolor : #333;\n\tfont-size : 90%;\n}\n\n.dojoTab .close {\n\tdisplay : inline-block;\n\theight : 12px;\n\twidth : 12px;\n\tpadding : 0 12px 0 0;\n\tmargin : 0 -10px 0 10px;\n\tcursor : default;\n\tfont-size: small;\n}\n\n.dojoTab .closeImage {\n\tbackground : url(images/tab_close.gif) no-repeat right top;\n}\n\n.dojoTab .closeHover {\n\tbackground-image : url(images/tab_close_h.gif);\n}\n\n.dojoTab.current {\n\tpadding-bottom : 1px;\n\tborder-bottom : 0;\n\tbackground-position : 0 -150px;\n}\n\n.dojoTab.current div {\n\tpadding-bottom : 5px;\n\t!
 margin-bottom : -1px;\n\tbackground-position : 100% -150px;\n}!
 \n\n/* b
ottom tabs */\n\n.dojoTabLabels-bottom {\n\tposition : relative;\n\tbottom : 0px;\n\tleft : 0px;\n\toverflow : visible;\n\tmargin-top : -1px;\n\twidth : 100%;\n\tz-index: 2;\n}\n\n.dojoTabNoLayout.dojoTabLabels-bottom {\n\tposition : relative;\n}\n\n.dojoTabLabels-bottom .dojoTab {\n\tborder-top :  1px solid #6290d2;\n\tborder-bottom : 0;\n\tbackground : url(images/tab_bot_left.gif) no-repeat left bottom;\n}\n\n.dojoTabLabels-bottom .dojoTab div {\n\tbackground : url(images/tab_bot_right.gif) no-repeat right bottom;\n}\n\n.dojoTabLabels-bottom .dojoTab.current {\n\tborder-top : 0;\n\tbackground : url(images/tab_bot_left_curr.gif) no-repeat left bottom;\n}\n\n.dojoTabLabels-bottom .dojoTab.current div {\n\tpadding-top : 4px;\n\tbackground : url(images/tab_bot_right_curr.gif) no-repeat right bottom;\n}\n\n/* right-h tabs */\n\n.dojoTabLabels-right-h {\n\toverflow : visible;\n\tmargin-left : -1px;\n\tz-index: 2;\n}\n\n.dojoTabLabels-right-h .dojoTab {\n\tpadding-left : 0;\n\tbo!
 rder-left :  1px solid #6290d2;\n\tborder-bottom : 0;\n\tbackground : url(images/tab_bot_right.gif) no-repeat right bottom;\n\tfloat : none;\n}\n\n.dojoTabLabels-right-h .dojoTab div {\n\tpadding : 4px 15px 4px 15px;\n}\n\n.dojoTabLabels-right-h .dojoTab.current {\n\tborder-left :  0;\n\tborder-bottom :  1px solid #6290d2;\n}\n\n/* left-h tabs */\n\n.dojoTabLabels-left-h {\n\toverflow : visible;\n\tmargin-right : -1px;\n\tz-index: 2;\n}\n\n.dojoTabLabels-left-h .dojoTab {\n\tborder-right :  1px solid #6290d2;\n\tborder-bottom : 0;\n\tfloat : none;\n\tbackground : url(images/tab_top_left.gif) no-repeat left top;\n}\n\n.dojoTabLabels-left-h .dojoTab.current {\n\tborder-right : 0;\n\tborder-bottom :  1px solid #6290d2;\n\tpadding-bottom : 0;\n\tbackground : url(images/tab_top_left.gif) no-repeat 0 -150px;\n}\n\n.dojoTabLabels-left-h .dojoTab div {\n\tbackground : 0;\n\tborder-bottom :  1px solid #6290d2;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TabCo!
 ntainer.css&quot;), selectedTab:&quot;&quot;, postMixInProperties:function ()!
  {
+	if (this.selectedTab) {
+		dojo.deprecated(&quot;selectedTab deprecated, use selectedChild instead, will be removed in&quot;, &quot;0.5&quot;);
+		this.selectedChild = this.selectedTab;
+	}
+	if (this.closeButton != &quot;none&quot;) {
+		dojo.deprecated(&quot;closeButton deprecated, use closable='true' on each child instead, will be removed in&quot;, &quot;0.5&quot;);
+	}
+	dojo.widget.TabContainer.superclass.postMixInProperties.apply(this, arguments);
+}, fillInTemplate:function () {
+	this.tablist = dojo.widget.createWidget(&quot;TabController&quot;, {id:this.widgetId + &quot;_tablist&quot;, labelPosition:this.labelPosition, doLayout:this.doLayout, containerId:this.widgetId}, this.tablistNode);
+	dojo.widget.TabContainer.superclass.fillInTemplate.apply(this, arguments);
+}, postCreate:function (args, frag) {
+	dojo.widget.TabContainer.superclass.postCreate.apply(this, arguments);
+	this.onResized();
+}, _setupChild:function (tab) {
+	if (this.closeButton == &quot;tab&quot; || this.closeButton == &quot;pane&quot;) {
+		tab.closable = true;
+	}
+	dojo.html.addClass(tab.domNode, &quot;dojoTabPane&quot;);
+	dojo.widget.TabContainer.superclass._setupChild.apply(this, arguments);
+}, onResized:function () {
+	if (!this.doLayout) {
+		return;
+	}
+	var labelAlign = this.labelPosition.replace(/-h/, &quot;&quot;);
+	var children = [{domNode:this.tablist.domNode, layoutAlign:labelAlign}, {domNode:this.containerNode, layoutAlign:&quot;client&quot;}];
+	dojo.widget.html.layout(this.domNode, children);
+	if (this.selectedChildWidget) {
+		var containerSize = dojo.html.getContentBox(this.containerNode);
+		this.selectedChildWidget.resizeTo(containerSize.width, containerSize.height);
+	}
+}, selectTab:function (tab, callingWidget) {
+	dojo.deprecated(&quot;use selectChild() rather than selectTab(), selectTab() will be removed in&quot;, &quot;0.5&quot;);
+	this.selectChild(tab, callingWidget);
+}, onKey:function (e) {
+	if (e.keyCode == e.KEY_UP_ARROW &amp;&amp; e.ctrlKey) {
+		var button = this.correspondingTabButton || this.selectedTabWidget.tabButton;
+		button.focus();
+		dojo.event.browser.stopEvent(e);
+	} else {
+		if (e.keyCode == e.KEY_DELETE &amp;&amp; e.altKey) {
+			if (this.selectedChildWidget.closable) {
+				this.closeChild(this.selectedChildWidget);
+				dojo.event.browser.stopEvent(e);
+			}
+		}
+	}
+}, destroy:function () {
+	this.tablist.destroy();
+	dojo.widget.TabContainer.superclass.destroy.apply(this, arguments);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TabController&quot;, dojo.widget.PageController, {templateString:&quot;&lt;div wairole='tablist' dojoAttachEvent='onKey'&gt;&lt;/div&gt;&quot;, labelPosition:&quot;top&quot;, doLayout:true, &quot;class&quot;:&quot;&quot;, buttonWidget:&quot;TabButton&quot;, postMixInProperties:function () {
+	if (!this[&quot;class&quot;]) {
+		this[&quot;class&quot;] = &quot;dojoTabLabels-&quot; + this.labelPosition + (this.doLayout ? &quot;&quot; : &quot; dojoTabNoLayout&quot;);
+	}
+	dojo.widget.TabController.superclass.postMixInProperties.apply(this, arguments);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TabButton&quot;, dojo.widget.PageButton, {templateString:&quot;&lt;div class='dojoTab' dojoAttachEvent='onClick'&gt;&quot; + &quot;&lt;div dojoAttachPoint='innerDiv'&gt;&quot; + &quot;&lt;span dojoAttachPoint='titleNode' tabIndex='-1' waiRole='tab'&gt;${this.label}&lt;/span&gt;&quot; + &quot;&lt;span dojoAttachPoint='closeButtonNode' class='close closeImage' style='${this.closeButtonStyle}'&quot; + &quot;	dojoAttachEvent='onMouseOver:onCloseButtonMouseOver; onMouseOut:onCloseButtonMouseOut; onClick:onCloseButtonClick'&gt;&lt;/span&gt;&quot; + &quot;&lt;/div&gt;&quot; + &quot;&lt;/div&gt;&quot;, postMixInProperties:function () {
+	this.closeButtonStyle = this.closeButton ? &quot;&quot; : &quot;display: none&quot;;
+	dojo.widget.TabButton.superclass.postMixInProperties.apply(this, arguments);
+}, fillInTemplate:function () {
+	dojo.html.disableSelection(this.titleNode);
+	dojo.widget.TabButton.superclass.fillInTemplate.apply(this, arguments);
+}, onCloseButtonClick:function (evt) {
+	evt.stopPropagation();
+	dojo.widget.TabButton.superclass.onCloseButtonClick.apply(this, arguments);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.a11y.TabButton&quot;, dojo.widget.TabButton, {imgPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/tab_close.gif&quot;), templateString:&quot;&lt;div class='dojoTab' dojoAttachEvent='onClick;onKey'&gt;&quot; + &quot;&lt;div dojoAttachPoint='innerDiv'&gt;&quot; + &quot;&lt;span dojoAttachPoint='titleNode' tabIndex='-1' waiRole='tab'&gt;${this.label}&lt;/span&gt;&quot; + &quot;&lt;img class='close' src='${this.imgPath}' alt='[x]' style='${this.closeButtonStyle}'&quot; + &quot;	dojoAttachEvent='onClick:onCloseButtonClick'&gt;&quot; + &quot;&lt;/div&gt;&quot; + &quot;&lt;/div&gt;&quot;});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TaskBar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TaskBar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TaskBar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,49 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TaskBar&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.FloatingPane&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TaskBarItem&quot;, dojo.widget.HtmlWidget, {iconSrc:&quot;&quot;, caption:&quot;Untitled&quot;, templateString:&quot;&lt;div class=\&quot;dojoTaskBarItem\&quot; dojoAttachEvent=\&quot;onClick\&quot;&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.dojoTaskBarItem {\n\tdisplay: inline-block;\n\tbackground-color: ThreeDFace;\n\tborder: outset 2px;\n\tmargin-right: 5px;\n\tcursor: pointer;\n\theight: 35px;\n\twidth: 100px;\n\tfont-size: 10pt;\n\twhite-space: nowrap;\n\ttext-align: center;\n\tfloat: left;\n\toverflow: hidden;\n}\n\n.dojoTaskBarItem img {\n\tvertical-align: middle;\n\tmargin-right: 5px;\n\tmargin-left: 5px;\t\n\theight: 32px;\n\twidth: 32px;\n}\n\n.dojoTaskBarItem a {\n\t color: black;\n\ttext-decoration: none;\n}\n\n\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TaskBar.css&quot;), fillInTemplate:function () {
+	if (this.iconSrc) {
+		var img = document.createElement(&quot;img&quot;);
+		img.src = this.iconSrc;
+		this.domNode.appendChild(img);
+	}
+	this.domNode.appendChild(document.createTextNode(this.caption));
+	dojo.html.disableSelection(this.domNode);
+}, postCreate:function () {
+	this.window = dojo.widget.getWidgetById(this.windowId);
+	this.window.explodeSrc = this.domNode;
+	dojo.event.connect(this.window, &quot;destroy&quot;, this, &quot;destroy&quot;);
+}, onClick:function () {
+	this.window.toggleDisplay();
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TaskBar&quot;, dojo.widget.FloatingPane, function () {
+	this._addChildStack = [];
+}, {resizable:false, titleBarDisplay:false, addChild:function (child) {
+	if (!this.containerNode) {
+		this._addChildStack.push(child);
+	} else {
+		if (this._addChildStack.length &gt; 0) {
+			var oarr = this._addChildStack;
+			this._addChildStack = [];
+			dojo.lang.forEach(oarr, this.addChild, this);
+		}
+	}
+	var tbi = dojo.widget.createWidget(&quot;TaskBarItem&quot;, {windowId:child.widgetId, caption:child.title, iconSrc:child.iconSrc});
+	dojo.widget.TaskBar.superclass.addChild.call(this, tbi);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Textbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Textbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Textbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,52 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Textbox&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.Manager&quot;);
+dojo.require(&quot;dojo.widget.Parse&quot;);
+dojo.require(&quot;dojo.xml.Parse&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.requireLocalization(&quot;dojo.widget&quot;, &quot;validate&quot;, null, &quot;zh-cn,ja,ROOT,fr&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Textbox&quot;, dojo.widget.HtmlWidget, {className:&quot;&quot;, name:&quot;&quot;, value:&quot;&quot;, type:&quot;&quot;, trim:false, uppercase:false, lowercase:false, ucFirst:false, digit:false, htmlfloat:&quot;none&quot;, templateString:&quot;&lt;span style='float:${this.htmlfloat};'&gt;\n\t&lt;input dojoAttachPoint='textbox' dojoAttachEvent='onblur;onfocus'\n\t\tid='${this.widgetId}' name='${this.name}'\n\t\tclass='${this.className}' type='${this.type}' &gt;\n&lt;/span&gt;\n&quot;, textbox:null, fillInTemplate:function () {
+	this.textbox.value = this.value;
+}, filter:function () {
+	if (this.trim) {
+		this.textbox.value = this.textbox.value.replace(/(^\s*|\s*$)/g, &quot;&quot;);
+	}
+	if (this.uppercase) {
+		this.textbox.value = this.textbox.value.toUpperCase();
+	}
+	if (this.lowercase) {
+		this.textbox.value = this.textbox.value.toLowerCase();
+	}
+	if (this.ucFirst) {
+		this.textbox.value = this.textbox.value.replace(/\b\w+\b/g, function (word) {
+			return word.substring(0, 1).toUpperCase() + word.substring(1).toLowerCase();
+		});
+	}
+	if (this.digit) {
+		this.textbox.value = this.textbox.value.replace(/\D/g, &quot;&quot;);
+	}
+}, onfocus:function () {
+}, onblur:function () {
+	this.filter();
+}, mixInProperties:function (localProperties, frag) {
+	dojo.widget.Textbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties[&quot;class&quot;]) {
+		this.className = localProperties[&quot;class&quot;];
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TimePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TimePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TimePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,278 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TimePicker&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.date.serialize&quot;);
+dojo.require(&quot;dojo.date.format&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.requireLocalization(&quot;dojo.i18n.calendar&quot;, &quot;gregorian&quot;, null, &quot;ko,zh-cn,zh,sv,ja,en,zh-tw,it,hu,nl,fi,zh-hk,fr,pt,ROOT,es,de,pt-br&quot;);
+dojo.requireLocalization(&quot;dojo.widget&quot;, &quot;TimePicker&quot;, null, &quot;ROOT&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TimePicker&quot;, dojo.widget.HtmlWidget, function () {
+	this.time = &quot;&quot;;
+	this.useDefaultTime = false;
+	this.useDefaultMinutes = false;
+	this.storedTime = &quot;&quot;;
+	this.currentTime = {};
+	this.classNames = {selectedTime:&quot;selectedItem&quot;};
+	this.any = &quot;any&quot;;
+	this.selectedTime = {hour:&quot;&quot;, minute:&quot;&quot;, amPm:&quot;&quot;, anyTime:false};
+	this.hourIndexMap = [&quot;&quot;, 2, 4, 6, 8, 10, 1, 3, 5, 7, 9, 11, 0];
+	this.minuteIndexMap = [0, 2, 4, 6, 8, 10, 1, 3, 5, 7, 9, 11];
+}, {isContainer:false, templateString:&quot;&lt;div class=\&quot;timePickerContainer\&quot; dojoAttachPoint=\&quot;timePickerContainerNode\&quot;&gt;\n\t&lt;table class=\&quot;timeContainer\&quot; cellspacing=\&quot;0\&quot; &gt;\n\t\t&lt;thead&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td class=\&quot;timeCorner cornerTopLeft\&quot; valign=\&quot;top\&quot;&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t&lt;td class=\&quot;timeLabelContainer hourSelector\&quot;&gt;${this.calendar.field-hour}&lt;/td&gt;\n\t\t\t\t&lt;td class=\&quot;timeLabelContainer minutesHeading\&quot;&gt;${this.calendar.field-minute}&lt;/td&gt;\n\t\t\t\t&lt;td class=\&quot;timeCorner cornerTopRight\&quot; valign=\&quot;top\&quot;&gt;&nbsp;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/thead&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td valign=\&quot;top\&quot; colspan=\&quot;2\&quot; class=\&quot;hours\&quot;&gt;\n\t\t\t\t\t&lt;table align=\&quot;center\&quot;&gt;\n\t\t\t\t\t\t&lt;tbody dojoAttachPoint=\&quot;hourContainerNode\&quot;  \n\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onSetSelectedHour;\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;12&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;6&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;1&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;7&lt;/td&gt;\n\t\t\t\t\t\t\!
 t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;2&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;8&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;3&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;9&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;4&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;10&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;5&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;11&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/tbody&gt;\n\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td valign=\&quot;top\&quot; class=\&quot;minutes\&quot; colspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t&lt;table align=\&quot;center\&quot;&gt;\n\t\t\t\t\t\t&lt;tbody dojoAttachPoint=\&quot;minuteContainerNode\&quot; \n\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onSetSelectedMinute;\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;00&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;30&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;05&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;35&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;10&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;40&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t!
 \t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;15&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;45&lt;/t!
 d&gt;\n\t\t
\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;20&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;50&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;25&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td&gt;55&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/tbody&gt;\n\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td class=\&quot;cornerBottomLeft\&quot;&gt;&nbsp;&lt;/td&gt;\n\t\t\t\t&lt;td valign=\&quot;top\&quot; class=\&quot;timeOptions\&quot;&gt;\n\t\t\t\t\t&lt;table class=\&quot;amPmContainer\&quot;&gt;\n\t\t\t\t\t\t&lt;tbody dojoAttachPoint=\&quot;amPmContainerNode\&quot; \n\t\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onSetSelectedAmPm;\&quot;&gt;\n\t\t\t\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t\t\t\t&lt;td id=\&quot;am\&quot;&gt;${this.calendar.am}&lt;/td&gt;\n\t\t\t\t\t\t\t\t&lt;td id=\&quot;pm\&quot;&gt;${this.calendar.pm}&lt;/td&gt;\n\t\t\t\t\t\t\t&lt;/tr&gt;\n\t\t\t\t\t\t&lt;/tbody&gt;\n\t\t\t\t\t&lt;/table&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td class=\&quot;timeOptions\&quot;&gt;\n\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;anyTimeContainerNode\&quot; \n\t\t\t\t\t\tdojoAttachEvent=\&quot;onClick: onSetSelectedAnyTime;\&quot; \n\t\t\t\t\t\tclass=\&quot;anyTimeContainer\&quot;&gt;${this.widgetSt!
 rings.any}&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td class=\&quot;cornerBottomRight\&quot;&gt;&nbsp;&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t&lt;/table&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;/*Time Picker */\n.timePickerContainer {\n\twidth:122px;\n\tfont-family:Tahoma, Myriad, Helvetica, Arial, Verdana, sans-serif;\n\tfont-size:16px;\n}\n\n.timeContainer {\n\tborder-collapse:collapse;\n\tborder-spacing:0;\n}\n\n.timeContainer thead {\n\tcolor:#293a4b;\n\tfont-size:0.9em;\n\tfont-weight:700;\n}\n\n.timeContainer thead td {\n\tpadding:0.25em;\n\tfont-size:0.80em;\n\tborder-bottom:1px solid #6782A8;\n}\n\n.timeCorner {\n\twidth:10px;\n}\n\n.cornerTopLeft {\n\tbackground: url(\&quot;images/dpCurveTL.png\&quot;) top left no-repeat;\n}\n\n.cornerTopRight {\n\tbackground: url(\&quot;images/dpCurveTR.png\&quot;) top right no-repeat;\n}\n\n.timeLabelContainer {\n\tbackground: url(\&quot;images/dpMonthBg.png\&quot;) top left repeat-x;\n}\n\n.hours, .minutes, .timeBorder {\n\tbackground: #7591bc url(\&quot;images/dpBg.gif\&quot;) top left repeat-x;\n\n}\n\n.!
 hours td, .minutes td {\n\tpadding:0.2em;\n\ttext-align:center!
 ;\n\tfon
t-size:0.7em;\n\tfont-weight:bold;\n\tcursor:pointer;\n\tcursor:hand;\n\tcolor:#fff;\n}\n\n.minutes {\n\tborder-left:1px solid #f5d1db;\n}\n\n.hours {\n\tborder-right:1px solid #6782A8;\n}\n\n.hourSelector {\n\tborder-right:1px solid #6782A8;\n\tpadding:5px;\n\tpadding-right:10px;\n}\n\n.minutesSelector {\n\tpadding:5px;\n\tborder-left:1px solid #f5c7d4;\n\ttext-align:center;\n}\n\n.minutesHeading {\n\tpadding-left:9px !important;\n}\n\n.timeOptions {\n\tbackground-color:#F9C9D7;\n}\n\n.timeContainer .cornerBottomLeft, .timeContainer .cornerBottomRight, .timeContainer .timeOptions {\n\tborder-top:1px solid #6782A8;\n}\n\n.timeContainer .cornerBottomLeft {\n\tbackground: url(\&quot;images/dpCurveBL.png\&quot;) bottom left no-repeat !important;\n\twidth:9px !important;\n\tpadding:0;\n\tmargin:0;\n}\n\n.timeContainer .cornerBottomRight {\n\tbackground: url(\&quot;images/dpCurveBR.png\&quot;) bottom right no-repeat !important;\n\twidth:9px !important;\n\tpadding:0;\n\tmargin:0;\n}\n\n.timeOptions {!
 \n\tcolor:#fff;\n\tbackground:url(\&quot;images/dpYearBg.png\&quot;) top left repeat-x;\n\n}\n\n.selectedItem {\n\tbackground-color:#fff;\n\tcolor:#6782a8 !important;\n}\n\n.timeOptions .selectedItem {\n\tcolor:#fff !important;\n\tbackground-color:#9ec3fb !important;\n}\n\n.anyTimeContainer {\n\ttext-align:center;\n\tfont-weight:bold;\n\tfont-size:0.7em;\n\tpadding:0.1em;\n\tcursor:pointer;\n\tcursor:hand;\n\tcolor:#fff !important;\n}\n\n.amPmContainer {\n\twidth:100%;\n}\n\n.amPmContainer td {\n\ttext-align:center;\n\tfont-size:0.7em;\n\tfont-weight:bold;\n\tcursor:pointer;\n\tcursor:hand;\n\tcolor:#fff;\n}\n\n\n\n/*.timePickerContainer {\n\tmargin:1.75em 0 0.5em 0;\n\twidth:10em;\n\tfloat:left;\n}\n\n.timeContainer {\n\tborder-collapse:collapse;\n\tborder-spacing:0;\n}\n\n.timeContainer thead td{\n\tborder-bottom:1px solid #e6e6e6;\n\tpadding:0 0.4em 0.2em 0.4em;\n}\n\n.timeContainer td {\n\tfont-size:0.9em;\n\tpadding:0 0.25em 0 0.25em;\n\ttext-align:left;\n\tcursor:pointer;cursor!
 :hand;\n}\n\n.timeContainer td.minutesHeading {\n\tborder-left!
 :1px sol
id #e6e6e6;\n\tborder-right:1px solid #e6e6e6;\t\n}\n\n.timeContainer .minutes {\n\tborder-left:1px solid #e6e6e6;\n\tborder-right:1px solid #e6e6e6;\n}\n\n.selectedItem {\n\tbackground-color:#3a3a3a;\n\tcolor:#ffffff;\n}*/\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TimePicker.css&quot;), postMixInProperties:function (localProperties, frag) {
+	dojo.widget.TimePicker.superclass.postMixInProperties.apply(this, arguments);
+	this.calendar = dojo.i18n.getLocalization(&quot;dojo.i18n.calendar&quot;, &quot;gregorian&quot;, this.lang);
+	this.widgetStrings = dojo.i18n.getLocalization(&quot;dojo.widget&quot;, &quot;TimePicker&quot;, this.lang);
+}, fillInTemplate:function (args, frag) {
+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+	if (args.value) {
+		if (args.value instanceof Date) {
+			this.storedTime = dojo.date.toRfc3339(args.value);
+		} else {
+			this.storedTime = args.value;
+		}
+	}
+	this.initData();
+	this.initUI();
+}, initData:function () {
+	if (this.storedTime.indexOf(&quot;T&quot;) != -1 &amp;&amp; this.storedTime.split(&quot;T&quot;)[1] &amp;&amp; this.storedTime != &quot; &quot; &amp;&amp; this.storedTime.split(&quot;T&quot;)[1] != &quot;any&quot;) {
+		this.time = dojo.widget.TimePicker.util.fromRfcDateTime(this.storedTime, this.useDefaultMinutes, this.selectedTime.anyTime);
+	} else {
+		if (this.useDefaultTime) {
+			this.time = dojo.widget.TimePicker.util.fromRfcDateTime(&quot;&quot;, this.useDefaultMinutes, this.selectedTime.anyTime);
+		} else {
+			this.selectedTime.anyTime = true;
+			this.time = dojo.widget.TimePicker.util.fromRfcDateTime(&quot;&quot;, 0, 1);
+		}
+	}
+}, initUI:function () {
+	if (!this.selectedTime.anyTime &amp;&amp; this.time) {
+		var amPmHour = dojo.widget.TimePicker.util.toAmPmHour(this.time.getHours());
+		var hour = amPmHour[0];
+		var isAm = amPmHour[1];
+		var minute = this.time.getMinutes();
+		var minuteIndex = parseInt(minute / 5);
+		this.onSetSelectedHour(this.hourIndexMap[hour]);
+		this.onSetSelectedMinute(this.minuteIndexMap[minuteIndex]);
+		this.onSetSelectedAmPm(isAm);
+	} else {
+		this.onSetSelectedAnyTime();
+	}
+}, setTime:function (date) {
+	if (date) {
+		this.selectedTime.anyTime = false;
+		this.setDateTime(dojo.date.toRfc3339(date));
+	} else {
+		this.selectedTime.anyTime = true;
+	}
+	this.initData();
+	this.initUI();
+}, setDateTime:function (rfcDate) {
+	this.storedTime = rfcDate;
+}, onClearSelectedHour:function (evt) {
+	this.clearSelectedHour();
+}, onClearSelectedMinute:function (evt) {
+	this.clearSelectedMinute();
+}, onClearSelectedAmPm:function (evt) {
+	this.clearSelectedAmPm();
+}, onClearSelectedAnyTime:function (evt) {
+	this.clearSelectedAnyTime();
+	if (this.selectedTime.anyTime) {
+		this.selectedTime.anyTime = false;
+		this.time = dojo.widget.TimePicker.util.fromRfcDateTime(&quot;&quot;, this.useDefaultMinutes);
+		this.initUI();
+	}
+}, clearSelectedHour:function () {
+	var hourNodes = this.hourContainerNode.getElementsByTagName(&quot;td&quot;);
+	for (var i = 0; i &lt; hourNodes.length; i++) {
+		dojo.html.setClass(hourNodes.item(i), &quot;&quot;);
+	}
+}, clearSelectedMinute:function () {
+	var minuteNodes = this.minuteContainerNode.getElementsByTagName(&quot;td&quot;);
+	for (var i = 0; i &lt; minuteNodes.length; i++) {
+		dojo.html.setClass(minuteNodes.item(i), &quot;&quot;);
+	}
+}, clearSelectedAmPm:function () {
+	var amPmNodes = this.amPmContainerNode.getElementsByTagName(&quot;td&quot;);
+	for (var i = 0; i &lt; amPmNodes.length; i++) {
+		dojo.html.setClass(amPmNodes.item(i), &quot;&quot;);
+	}
+}, clearSelectedAnyTime:function () {
+	dojo.html.setClass(this.anyTimeContainerNode, &quot;anyTimeContainer&quot;);
+}, onSetSelectedHour:function (evt) {
+	this.onClearSelectedAnyTime();
+	this.onClearSelectedHour();
+	this.setSelectedHour(evt);
+	this.onSetTime();
+}, setSelectedHour:function (evt) {
+	if (evt &amp;&amp; evt.target) {
+		if (evt.target.nodeType == dojo.dom.ELEMENT_NODE) {
+			var eventTarget = evt.target;
+		} else {
+			var eventTarget = evt.target.parentNode;
+		}
+		dojo.event.browser.stopEvent(evt);
+		dojo.html.setClass(eventTarget, this.classNames.selectedTime);
+		this.selectedTime[&quot;hour&quot;] = eventTarget.innerHTML;
+	} else {
+		if (!isNaN(evt)) {
+			var hourNodes = this.hourContainerNode.getElementsByTagName(&quot;td&quot;);
+			if (hourNodes.item(evt)) {
+				dojo.html.setClass(hourNodes.item(evt), this.classNames.selectedTime);
+				this.selectedTime[&quot;hour&quot;] = hourNodes.item(evt).innerHTML;
+			}
+		}
+	}
+	this.selectedTime.anyTime = false;
+}, onSetSelectedMinute:function (evt) {
+	this.onClearSelectedAnyTime();
+	this.onClearSelectedMinute();
+	this.setSelectedMinute(evt);
+	this.selectedTime.anyTime = false;
+	this.onSetTime();
+}, setSelectedMinute:function (evt) {
+	if (evt &amp;&amp; evt.target) {
+		if (evt.target.nodeType == dojo.dom.ELEMENT_NODE) {
+			var eventTarget = evt.target;
+		} else {
+			var eventTarget = evt.target.parentNode;
+		}
+		dojo.event.browser.stopEvent(evt);
+		dojo.html.setClass(eventTarget, this.classNames.selectedTime);
+		this.selectedTime[&quot;minute&quot;] = eventTarget.innerHTML;
+	} else {
+		if (!isNaN(evt)) {
+			var minuteNodes = this.minuteContainerNode.getElementsByTagName(&quot;td&quot;);
+			if (minuteNodes.item(evt)) {
+				dojo.html.setClass(minuteNodes.item(evt), this.classNames.selectedTime);
+				this.selectedTime[&quot;minute&quot;] = minuteNodes.item(evt).innerHTML;
+			}
+		}
+	}
+}, onSetSelectedAmPm:function (evt) {
+	this.onClearSelectedAnyTime();
+	this.onClearSelectedAmPm();
+	this.setSelectedAmPm(evt);
+	this.selectedTime.anyTime = false;
+	this.onSetTime();
+}, setSelectedAmPm:function (evt) {
+	var eventTarget = evt.target;
+	if (evt &amp;&amp; eventTarget) {
+		if (eventTarget.nodeType != dojo.dom.ELEMENT_NODE) {
+			eventTarget = eventTarget.parentNode;
+		}
+		dojo.event.browser.stopEvent(evt);
+		this.selectedTime.amPm = eventTarget.id;
+		dojo.html.setClass(eventTarget, this.classNames.selectedTime);
+	} else {
+		evt = evt ? 0 : 1;
+		var amPmNodes = this.amPmContainerNode.getElementsByTagName(&quot;td&quot;);
+		if (amPmNodes.item(evt)) {
+			this.selectedTime.amPm = amPmNodes.item(evt).id;
+			dojo.html.setClass(amPmNodes.item(evt), this.classNames.selectedTime);
+		}
+	}
+}, onSetSelectedAnyTime:function (evt) {
+	this.onClearSelectedHour();
+	this.onClearSelectedMinute();
+	this.onClearSelectedAmPm();
+	this.setSelectedAnyTime();
+	this.onSetTime();
+}, setSelectedAnyTime:function (evt) {
+	this.selectedTime.anyTime = true;
+	dojo.html.setClass(this.anyTimeContainerNode, this.classNames.selectedTime + &quot; &quot; + &quot;anyTimeContainer&quot;);
+}, onClick:function (evt) {
+	dojo.event.browser.stopEvent(evt);
+}, onSetTime:function () {
+	if (this.selectedTime.anyTime) {
+		this.time = new Date();
+		var tempDateTime = dojo.widget.TimePicker.util.toRfcDateTime(this.time);
+		this.setDateTime(tempDateTime.split(&quot;T&quot;)[0]);
+	} else {
+		var hour = 12;
+		var minute = 0;
+		var isAm = false;
+		if (this.selectedTime[&quot;hour&quot;]) {
+			hour = parseInt(this.selectedTime[&quot;hour&quot;], 10);
+		}
+		if (this.selectedTime[&quot;minute&quot;]) {
+			minute = parseInt(this.selectedTime[&quot;minute&quot;], 10);
+		}
+		if (this.selectedTime[&quot;amPm&quot;]) {
+			isAm = (this.selectedTime[&quot;amPm&quot;].toLowerCase() == &quot;am&quot;);
+		}
+		this.time = new Date();
+		this.time.setHours(dojo.widget.TimePicker.util.fromAmPmHour(hour, isAm));
+		this.time.setMinutes(minute);
+		this.setDateTime(dojo.widget.TimePicker.util.toRfcDateTime(this.time));
+	}
+	this.onValueChanged(this.time);
+}, onValueChanged:function (date) {
+}});
+dojo.widget.TimePicker.util = new function () {
+	this.toRfcDateTime = function (jsDate) {
+		if (!jsDate) {
+			jsDate = new Date();
+		}
+		jsDate.setSeconds(0);
+		return dojo.date.strftime(jsDate, &quot;%Y-%m-%dT%H:%M:00%z&quot;);
+	};
+	this.fromRfcDateTime = function (rfcDate, useDefaultMinutes, isAnyTime) {
+		var tempDate = new Date();
+		if (!rfcDate || rfcDate.indexOf(&quot;T&quot;) == -1) {
+			if (useDefaultMinutes) {
+				tempDate.setMinutes(Math.floor(tempDate.getMinutes() / 5) * 5);
+			} else {
+				tempDate.setMinutes(0);
+			}
+		} else {
+			var tempTime = rfcDate.split(&quot;T&quot;)[1].split(&quot;:&quot;);
+			var tempDate = new Date();
+			tempDate.setHours(tempTime[0]);
+			tempDate.setMinutes(tempTime[1]);
+		}
+		return tempDate;
+	};
+	this.toAmPmHour = function (hour) {
+		var amPmHour = hour;
+		var isAm = true;
+		if (amPmHour == 0) {
+			amPmHour = 12;
+		} else {
+			if (amPmHour &gt; 12) {
+				amPmHour = amPmHour - 12;
+				isAm = false;
+			} else {
+				if (amPmHour == 12) {
+					isAm = false;
+				}
+			}
+		}
+		return [amPmHour, isAm];
+	};
+	this.fromAmPmHour = function (amPmHour, isAm) {
+		var hour = parseInt(amPmHour, 10);
+		if (isAm &amp;&amp; hour == 12) {
+			hour = 0;
+		} else {
+			if (!isAm &amp;&amp; hour &lt; 12) {
+				hour = hour + 12;
+			}
+		}
+		return hour;
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/TitlePane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TitlePane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TitlePane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,43 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TitlePane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TitlePane&quot;, dojo.widget.ContentPane, {labelNodeClass:&quot;&quot;, containerNodeClass:&quot;&quot;, label:&quot;&quot;, open:true, templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n&lt;div dojoAttachPoint=\&quot;labelNode\&quot; dojoAttachEvent=\&quot;onclick: onLabelClick\&quot;&gt;&lt;/div&gt;\n&lt;div dojoAttachPoint=\&quot;containerNode\&quot;&gt;&lt;/div&gt;\n&lt;/div&gt;\n&quot;, postCreate:function () {
+	if (this.label) {
+		this.labelNode.appendChild(document.createTextNode(this.label));
+	}
+	if (this.labelNodeClass) {
+		dojo.html.addClass(this.labelNode, this.labelNodeClass);
+	}
+	if (this.containerNodeClass) {
+		dojo.html.addClass(this.containerNode, this.containerNodeClass);
+	}
+	if (!this.open) {
+		dojo.html.hide(this.containerNode);
+	}
+	dojo.widget.TitlePane.superclass.postCreate.apply(this, arguments);
+}, onLabelClick:function () {
+	if (this.open) {
+		dojo.lfx.wipeOut(this.containerNode, 250).play();
+		this.open = false;
+	} else {
+		dojo.lfx.wipeIn(this.containerNode, 250).play();
+		this.open = true;
+	}
+}, setLabel:function (label) {
+	this.labelNode.innerHTML = label;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Toaster.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Toaster.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Toaster.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,163 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Toaster&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.html.iframe&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Toaster&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;clipNode\&quot;&gt;&lt;div dojoAttachPoint=\&quot;containerNode\&quot; dojoAttachEvent=\&quot;onClick:onSelect\&quot;&gt;&lt;div dojoAttachPoint=\&quot;contentNode\&quot;&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&quot;, templateCssString:&quot;.dojoToasterClip {\n\tposition: absolute;\n\toverflow: hidden;\n}\n\n.dojoToasterContainer {\n\tdisplay: block;\n\tposition: absolute;\n\twidth: 17.5em;\n\tz-index: 5000;\n\tmargin: 0px;\n\tfont:0.75em Tahoma, Helvetica, Verdana, Arial;\n}\n\n.dojoToasterContent{\n\tpadding:1em;\n\tpadding-top:0.25em;\n\tbackground:#73c74a;\n}\n\n.dojoToasterMessage{ \n\tcolor:#fff;\n}\n.dojoToasterWarning{ }\n.dojoToasterError,\n.dojoToasterFatal{\n\tfont-weight:bold;\n\tcolor:#fff;\n}\n\n\n.dojoToasterWarning .dojoToasterContent{\n\tpadding:1em;\n\tpadding-top:0.25em;\n\tbackground:#d4d943;\n} \n\n.dojoToasterError .dojoToasterContent{\n\tpadding:1em;\n\tpadding-top:0.25em;\n\tbackground:#c46600;\n} \n&quot;, templateCssPa!
 th:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Toaster.css&quot;), messageTopic:&quot;&quot;, messageTypes:{MESSAGE:&quot;MESSAGE&quot;, WARNING:&quot;WARNING&quot;, ERROR:&quot;ERROR&quot;, FATAL:&quot;FATAL&quot;}, defaultType:&quot;MESSAGE&quot;, clipCssClass:&quot;dojoToasterClip&quot;, containerCssClass:&quot;dojoToasterContainer&quot;, contentCssClass:&quot;dojoToasterContent&quot;, messageCssClass:&quot;dojoToasterMessage&quot;, warningCssClass:&quot;dojoToasterWarning&quot;, errorCssClass:&quot;dojoToasterError&quot;, fatalCssClass:&quot;dojoToasterFatal&quot;, positionDirection:&quot;br-up&quot;, positionDirectionTypes:[&quot;br-up&quot;, &quot;br-left&quot;, &quot;bl-up&quot;, &quot;bl-right&quot;, &quot;tr-down&quot;, &quot;tr-left&quot;, &quot;tl-down&quot;, &quot;tl-right&quot;], showDelay:2000, postCreate:function () {
+	this.hide();
+	dojo.html.setClass(this.clipNode, this.clipCssClass);
+	dojo.html.addClass(this.containerNode, this.containerCssClass);
+	dojo.html.setClass(this.contentNode, this.contentCssClass);
+	if (this.messageTopic) {
+		dojo.event.topic.subscribe(this.messageTopic, this, &quot;_handleMessage&quot;);
+	}
+	if (!this.positionDirection || !dojo.lang.inArray(this.positionDirectionTypes, this.positionDirection)) {
+		this.positionDirection = this.positionDirectionTypes.BRU;
+	}
+}, _handleMessage:function (msg) {
+	if (dojo.lang.isString(msg)) {
+		this.setContent(msg);
+	} else {
+		this.setContent(msg[&quot;message&quot;], msg[&quot;type&quot;], msg[&quot;delay&quot;]);
+	}
+}, setContent:function (msg, messageType, delay) {
+	var delay = delay || this.showDelay;
+	if (this.slideAnim &amp;&amp; this.slideAnim.status() == &quot;playing&quot;) {
+		dojo.lang.setTimeout(50, dojo.lang.hitch(this, function () {
+			this.setContent(msg, messageType);
+		}));
+		return;
+	} else {
+		if (this.slideAnim) {
+			this.slideAnim.stop();
+			if (this.fadeAnim) {
+				this.fadeAnim.stop();
+			}
+		}
+	}
+	if (!msg) {
+		dojo.debug(this.widgetId + &quot;.setContent() incoming content was null, ignoring.&quot;);
+		return;
+	}
+	if (!this.positionDirection || !dojo.lang.inArray(this.positionDirectionTypes, this.positionDirection)) {
+		dojo.raise(this.widgetId + &quot;.positionDirection is an invalid value: &quot; + this.positionDirection);
+	}
+	dojo.html.removeClass(this.containerNode, this.messageCssClass);
+	dojo.html.removeClass(this.containerNode, this.warningCssClass);
+	dojo.html.removeClass(this.containerNode, this.errorCssClass);
+	dojo.html.removeClass(this.containerNode, this.fatalCssClass);
+	dojo.html.clearOpacity(this.containerNode);
+	if (msg instanceof String || typeof msg == &quot;string&quot;) {
+		this.contentNode.innerHTML = msg;
+	} else {
+		if (dojo.html.isNode(msg)) {
+			this.contentNode.innerHTML = dojo.html.getContentAsString(msg);
+		} else {
+			dojo.raise(&quot;Toaster.setContent(): msg is of unknown type:&quot; + msg);
+		}
+	}
+	switch (messageType) {
+	  case this.messageTypes.WARNING:
+		dojo.html.addClass(this.containerNode, this.warningCssClass);
+		break;
+	  case this.messageTypes.ERROR:
+		dojo.html.addClass(this.containerNode, this.errorCssClass);
+		break;
+	  case this.messageTypes.FATAL:
+		dojo.html.addClass(this.containerNode, this.fatalCssClass);
+		break;
+	  case this.messageTypes.MESSAGE:
+	  default:
+		dojo.html.addClass(this.containerNode, this.messageCssClass);
+		break;
+	}
+	this.show();
+	var nodeSize = dojo.html.getMarginBox(this.containerNode);
+	if (this.positionDirection.indexOf(&quot;-up&quot;) &gt;= 0) {
+		this.containerNode.style.left = 0 + &quot;px&quot;;
+		this.containerNode.style.top = nodeSize.height + 10 + &quot;px&quot;;
+	} else {
+		if (this.positionDirection.indexOf(&quot;-left&quot;) &gt;= 0) {
+			this.containerNode.style.left = nodeSize.width + 10 + &quot;px&quot;;
+			this.containerNode.style.top = 0 + &quot;px&quot;;
+		} else {
+			if (this.positionDirection.indexOf(&quot;-right&quot;) &gt;= 0) {
+				this.containerNode.style.left = 0 - nodeSize.width - 10 + &quot;px&quot;;
+				this.containerNode.style.top = 0 + &quot;px&quot;;
+			} else {
+				if (this.positionDirection.indexOf(&quot;-down&quot;) &gt;= 0) {
+					this.containerNode.style.left = 0 + &quot;px&quot;;
+					this.containerNode.style.top = 0 - nodeSize.height - 10 + &quot;px&quot;;
+				} else {
+					dojo.raise(this.widgetId + &quot;.positionDirection is an invalid value: &quot; + this.positionDirection);
+				}
+			}
+		}
+	}
+	this.slideAnim = dojo.lfx.html.slideTo(this.containerNode, {top:0, left:0}, 450, null, dojo.lang.hitch(this, function (nodes, anim) {
+		dojo.lang.setTimeout(dojo.lang.hitch(this, function (evt) {
+			if (this.bgIframe) {
+				this.bgIframe.hide();
+			}
+			this.fadeAnim = dojo.lfx.html.fadeOut(this.containerNode, 1000, null, dojo.lang.hitch(this, function (evt) {
+				this.hide();
+			})).play();
+		}), delay);
+	})).play();
+}, _placeClip:function () {
+	var scroll = dojo.html.getScroll();
+	var view = dojo.html.getViewport();
+	var nodeSize = dojo.html.getMarginBox(this.containerNode);
+	this.clipNode.style.height = nodeSize.height + &quot;px&quot;;
+	this.clipNode.style.width = nodeSize.width + &quot;px&quot;;
+	if (this.positionDirection.match(/^t/)) {
+		this.clipNode.style.top = scroll.top + &quot;px&quot;;
+	} else {
+		if (this.positionDirection.match(/^b/)) {
+			this.clipNode.style.top = (view.height - nodeSize.height - 2 + scroll.top) + &quot;px&quot;;
+		}
+	}
+	if (this.positionDirection.match(/^[tb]r-/)) {
+		this.clipNode.style.left = (view.width - nodeSize.width - 1 - scroll.left) + &quot;px&quot;;
+	} else {
+		if (this.positionDirection.match(/^[tb]l-/)) {
+			this.clipNode.style.left = 0 + &quot;px&quot;;
+		}
+	}
+	this.clipNode.style.clip = &quot;rect(0px, &quot; + nodeSize.width + &quot;px, &quot; + nodeSize.height + &quot;px, 0px)&quot;;
+	if (dojo.render.html.ie) {
+		if (!this.bgIframe) {
+			this.bgIframe = new dojo.html.BackgroundIframe(this.containerNode);
+			this.bgIframe.setZIndex(this.containerNode);
+		}
+		this.bgIframe.onResized();
+		this.bgIframe.show();
+	}
+}, onSelect:function (e) {
+}, show:function () {
+	dojo.widget.Toaster.superclass.show.call(this);
+	this._placeClip();
+	if (!this._scrollConnected) {
+		this._scrollConnected = true;
+		dojo.event.connect(window, &quot;onscroll&quot;, this, &quot;_placeClip&quot;);
+	}
+}, hide:function () {
+	dojo.widget.Toaster.superclass.hide.call(this);
+	if (this._scrollConnected) {
+		this._scrollConnected = false;
+		dojo.event.disconnect(window, &quot;onscroll&quot;, this, &quot;_placeClip&quot;);
+	}
+	dojo.html.setOpacity(this.containerNode, 1);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Toggler.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Toggler.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Toggler.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,26 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Toggler&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Toggler&quot;, dojo.widget.HtmlWidget, {targetId:&quot;&quot;, fillInTemplate:function () {
+	dojo.event.connect(this.domNode, &quot;onclick&quot;, this, &quot;onClick&quot;);
+}, onClick:function () {
+	var pane = dojo.widget.byId(this.targetId);
+	if (!pane) {
+		return;
+	}
+	pane.explodeSrc = this.domNode;
+	pane.toggleShowing();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Toolbar.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Toolbar.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Toolbar.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,724 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Toolbar&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarContainer&quot;, dojo.widget.HtmlWidget, {isContainer:true, templateString:&quot;&lt;div class=\&quot;toolbarContainer\&quot; dojoAttachPoint=\&quot;containerNode\&quot;&gt;&lt;/div&gt;&quot;, templateCssString:&quot;.toolbarContainer {\n\tborder-bottom : 0;\n\tbackground-color : #def;\n\tcolor : ButtonText;\n\tfont : Menu;\n\tbackground-image: url(images/toolbar-bg.gif);\n}\n\n.toolbar {\n\tpadding : 2px 4px;\n\tmin-height : 26px;\n\t_height : 26px;\n}\n\n.toolbarItem {\n\tfloat : left;\n\tpadding : 1px 2px;\n\tmargin : 0 2px 1px 0;\n\tcursor : pointer;\n}\n\n.toolbarItem.selected, .toolbarItem.down {\n\tmargin : 1px 1px 0 1px;\n\tpadding : 0px 1px;\n\tborder : 1px solid #bbf;\n\tbackground-color : #fafaff;\n}\n\n.toolbarButton img {\n\tvertical-align : bottom;\n}\n\n.toolbarButton span {\n\tline-height : 16px;\n\tvertical-align : middle;\n}\n\n.toolbarButton.hover {\n\tpadding : 0px 1px;\n\tborder : 1px solid #99c;\n}\n\n.toolbarItem.disabled {\n\topacity : 0.3;\n\tfilter : alph!
 a(opacity=30);\n\tcursor : default;\n}\n\n.toolbarSeparator {\n\tcursor : default;\n}\n\n.toolbarFlexibleSpace {\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Toolbar.css&quot;), getItem:function (name) {
+	if (name instanceof dojo.widget.ToolbarItem) {
+		return name;
+	}
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			var item = child.getItem(name);
+			if (item) {
+				return item;
+			}
+		}
+	}
+	return null;
+}, getItems:function () {
+	var items = [];
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			items = items.concat(child.getItems());
+		}
+	}
+	return items;
+}, enable:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			child.enable.apply(child, arguments);
+		}
+	}
+}, disable:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			child.disable.apply(child, arguments);
+		}
+	}
+}, select:function (name) {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			child.select(arguments);
+		}
+	}
+}, deselect:function (name) {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			child.deselect(arguments);
+		}
+	}
+}, getItemsState:function () {
+	var values = {};
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			dojo.lang.mixin(values, child.getItemsState());
+		}
+	}
+	return values;
+}, getItemsActiveState:function () {
+	var values = {};
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			dojo.lang.mixin(values, child.getItemsActiveState());
+		}
+	}
+	return values;
+}, getItemsSelectedState:function () {
+	var values = {};
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.Toolbar) {
+			dojo.lang.mixin(values, child.getItemsSelectedState());
+		}
+	}
+	return values;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.Toolbar&quot;, dojo.widget.HtmlWidget, {isContainer:true, templateString:&quot;&lt;div class=\&quot;toolbar\&quot; dojoAttachPoint=\&quot;containerNode\&quot; unselectable=\&quot;on\&quot; dojoOnMouseover=\&quot;_onmouseover\&quot; dojoOnMouseout=\&quot;_onmouseout\&quot; dojoOnClick=\&quot;_onclick\&quot; dojoOnMousedown=\&quot;_onmousedown\&quot; dojoOnMouseup=\&quot;_onmouseup\&quot;&gt;&lt;/div&gt;&quot;, _getItem:function (node) {
+	var start = new Date();
+	var widget = null;
+	while (node &amp;&amp; node != this.domNode) {
+		if (dojo.html.hasClass(node, &quot;toolbarItem&quot;)) {
+			var widgets = dojo.widget.manager.getWidgetsByFilter(function (w) {
+				return w.domNode == node;
+			});
+			if (widgets.length == 1) {
+				widget = widgets[0];
+				break;
+			} else {
+				if (widgets.length &gt; 1) {
+					dojo.raise(&quot;Toolbar._getItem: More than one widget matches the node&quot;);
+				}
+			}
+		}
+		node = node.parentNode;
+	}
+	return widget;
+}, _onmouseover:function (e) {
+	var widget = this._getItem(e.target);
+	if (widget &amp;&amp; widget._onmouseover) {
+		widget._onmouseover(e);
+	}
+}, _onmouseout:function (e) {
+	var widget = this._getItem(e.target);
+	if (widget &amp;&amp; widget._onmouseout) {
+		widget._onmouseout(e);
+	}
+}, _onclick:function (e) {
+	var widget = this._getItem(e.target);
+	if (widget &amp;&amp; widget._onclick) {
+		widget._onclick(e);
+	}
+}, _onmousedown:function (e) {
+	var widget = this._getItem(e.target);
+	if (widget &amp;&amp; widget._onmousedown) {
+		widget._onmousedown(e);
+	}
+}, _onmouseup:function (e) {
+	var widget = this._getItem(e.target);
+	if (widget &amp;&amp; widget._onmouseup) {
+		widget._onmouseup(e);
+	}
+}, addChild:function (item, pos, props) {
+	var widget = dojo.widget.ToolbarItem.make(item, null, props);
+	var ret = dojo.widget.Toolbar.superclass.addChild.call(this, widget, null, pos, null);
+	return ret;
+}, push:function () {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		this.addChild(arguments[i]);
+	}
+}, getItem:function (name) {
+	if (name instanceof dojo.widget.ToolbarItem) {
+		return name;
+	}
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem &amp;&amp; child._name == name) {
+			return child;
+		}
+	}
+	return null;
+}, getItems:function () {
+	var items = [];
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem) {
+			items.push(child);
+		}
+	}
+	return items;
+}, getItemsState:function () {
+	var values = {};
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem) {
+			values[child._name] = {selected:child._selected, enabled:!child.disabled};
+		}
+	}
+	return values;
+}, getItemsActiveState:function () {
+	var values = this.getItemsState();
+	for (var item in values) {
+		values[item] = values[item].enabled;
+	}
+	return values;
+}, getItemsSelectedState:function () {
+	var values = this.getItemsState();
+	for (var item in values) {
+		values[item] = values[item].selected;
+	}
+	return values;
+}, enable:function () {
+	var items = arguments.length ? arguments : this.children;
+	for (var i = 0; i &lt; items.length; i++) {
+		var child = this.getItem(items[i]);
+		if (child instanceof dojo.widget.ToolbarItem) {
+			child.enable(false, true);
+		}
+	}
+}, disable:function () {
+	var items = arguments.length ? arguments : this.children;
+	for (var i = 0; i &lt; items.length; i++) {
+		var child = this.getItem(items[i]);
+		if (child instanceof dojo.widget.ToolbarItem) {
+			child.disable();
+		}
+	}
+}, select:function () {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		var name = arguments[i];
+		var item = this.getItem(name);
+		if (item) {
+			item.select();
+		}
+	}
+}, deselect:function () {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		var name = arguments[i];
+		var item = this.getItem(name);
+		if (item) {
+			item.disable();
+		}
+	}
+}, setValue:function () {
+	for (var i = 0; i &lt; arguments.length; i += 2) {
+		var name = arguments[i], value = arguments[i + 1];
+		var item = this.getItem(name);
+		if (item) {
+			if (item instanceof dojo.widget.ToolbarItem) {
+				item.setValue(value);
+			}
+		}
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarItem&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;span unselectable=\&quot;on\&quot; class=\&quot;toolbarItem\&quot;&gt;&lt;/span&gt;&quot;, _name:null, getName:function () {
+	return this._name;
+}, setName:function (value) {
+	return (this._name = value);
+}, getValue:function () {
+	return this.getName();
+}, setValue:function (value) {
+	return this.setName(value);
+}, _selected:false, isSelected:function () {
+	return this._selected;
+}, setSelected:function (is, force, preventEvent) {
+	if (!this._toggleItem &amp;&amp; !force) {
+		return;
+	}
+	is = Boolean(is);
+	if (force || !this.disabled &amp;&amp; this._selected != is) {
+		this._selected = is;
+		this.update();
+		if (!preventEvent) {
+			this._fireEvent(is ? &quot;onSelect&quot; : &quot;onDeselect&quot;);
+			this._fireEvent(&quot;onChangeSelect&quot;);
+		}
+	}
+}, select:function (force, preventEvent) {
+	return this.setSelected(true, force, preventEvent);
+}, deselect:function (force, preventEvent) {
+	return this.setSelected(false, force, preventEvent);
+}, _toggleItem:false, isToggleItem:function () {
+	return this._toggleItem;
+}, setToggleItem:function (value) {
+	this._toggleItem = Boolean(value);
+}, toggleSelected:function (force) {
+	return this.setSelected(!this._selected, force);
+}, isEnabled:function () {
+	return !this.disabled;
+}, setEnabled:function (is, force, preventEvent) {
+	is = Boolean(is);
+	if (force || this.disabled == is) {
+		this.disabled = !is;
+		this.update();
+		if (!preventEvent) {
+			this._fireEvent(this.disabled ? &quot;onDisable&quot; : &quot;onEnable&quot;);
+			this._fireEvent(&quot;onChangeEnabled&quot;);
+		}
+	}
+	return !this.disabled;
+}, enable:function (force, preventEvent) {
+	return this.setEnabled(true, force, preventEvent);
+}, disable:function (force, preventEvent) {
+	return this.setEnabled(false, force, preventEvent);
+}, toggleEnabled:function (force, preventEvent) {
+	return this.setEnabled(this.disabled, force, preventEvent);
+}, _icon:null, getIcon:function () {
+	return this._icon;
+}, setIcon:function (value) {
+	var icon = dojo.widget.Icon.make(value);
+	if (this._icon) {
+		this._icon.setIcon(icon);
+	} else {
+		this._icon = icon;
+	}
+	var iconNode = this._icon.getNode();
+	if (iconNode.parentNode != this.domNode) {
+		if (this.domNode.hasChildNodes()) {
+			this.domNode.insertBefore(iconNode, this.domNode.firstChild);
+		} else {
+			this.domNode.appendChild(iconNode);
+		}
+	}
+	return this._icon;
+}, _label:&quot;&quot;, getLabel:function () {
+	return this._label;
+}, setLabel:function (value) {
+	var ret = (this._label = value);
+	if (!this.labelNode) {
+		this.labelNode = document.createElement(&quot;span&quot;);
+		this.domNode.appendChild(this.labelNode);
+	}
+	this.labelNode.innerHTML = &quot;&quot;;
+	this.labelNode.appendChild(document.createTextNode(this._label));
+	this.update();
+	return ret;
+}, update:function () {
+	if (this.disabled) {
+		this._selected = false;
+		dojo.html.addClass(this.domNode, &quot;disabled&quot;);
+		dojo.html.removeClass(this.domNode, &quot;down&quot;);
+		dojo.html.removeClass(this.domNode, &quot;hover&quot;);
+	} else {
+		dojo.html.removeClass(this.domNode, &quot;disabled&quot;);
+		if (this._selected) {
+			dojo.html.addClass(this.domNode, &quot;selected&quot;);
+		} else {
+			dojo.html.removeClass(this.domNode, &quot;selected&quot;);
+		}
+	}
+	this._updateIcon();
+}, _updateIcon:function () {
+	if (this._icon) {
+		if (this.disabled) {
+			this._icon.disable();
+		} else {
+			if (this._cssHover) {
+				this._icon.hover();
+			} else {
+				if (this._selected) {
+					this._icon.select();
+				} else {
+					this._icon.enable();
+				}
+			}
+		}
+	}
+}, _fireEvent:function (evt) {
+	if (typeof this[evt] == &quot;function&quot;) {
+		var args = [this];
+		for (var i = 1; i &lt; arguments.length; i++) {
+			args.push(arguments[i]);
+		}
+		this[evt].apply(this, args);
+	}
+}, _onmouseover:function (e) {
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.addClass(this.domNode, &quot;hover&quot;);
+	this._fireEvent(&quot;onMouseOver&quot;);
+}, _onmouseout:function (e) {
+	dojo.html.removeClass(this.domNode, &quot;hover&quot;);
+	dojo.html.removeClass(this.domNode, &quot;down&quot;);
+	if (!this._selected) {
+		dojo.html.removeClass(this.domNode, &quot;selected&quot;);
+	}
+	this._fireEvent(&quot;onMouseOut&quot;);
+}, _onclick:function (e) {
+	if (!this.disabled &amp;&amp; !this._toggleItem) {
+		this._fireEvent(&quot;onClick&quot;);
+	}
+}, _onmousedown:function (e) {
+	if (e.preventDefault) {
+		e.preventDefault();
+	}
+	if (this.disabled) {
+		return;
+	}
+	dojo.html.addClass(this.domNode, &quot;down&quot;);
+	if (this._toggleItem) {
+		if (this.parent.preventDeselect &amp;&amp; this._selected) {
+			return;
+		}
+		this.toggleSelected();
+	}
+	this._fireEvent(&quot;onMouseDown&quot;);
+}, _onmouseup:function (e) {
+	dojo.html.removeClass(this.domNode, &quot;down&quot;);
+	this._fireEvent(&quot;onMouseUp&quot;);
+}, onClick:function () {
+}, onMouseOver:function () {
+}, onMouseOut:function () {
+}, onMouseDown:function () {
+}, onMouseUp:function () {
+}, fillInTemplate:function (args, frag) {
+	if (args.name) {
+		this._name = args.name;
+	}
+	if (args.selected) {
+		this.select();
+	}
+	if (args.disabled) {
+		this.disable();
+	}
+	if (args.label) {
+		this.setLabel(args.label);
+	}
+	if (args.icon) {
+		this.setIcon(args.icon);
+	}
+	if (args.toggleitem || args.toggleItem) {
+		this.setToggleItem(true);
+	}
+}});
+dojo.widget.ToolbarItem.make = function (wh, whIsType, props) {
+	var item = null;
+	if (wh instanceof Array) {
+		item = dojo.widget.createWidget(&quot;ToolbarButtonGroup&quot;, props);
+		item.setName(wh[0]);
+		for (var i = 1; i &lt; wh.length; i++) {
+			item.addChild(wh[i]);
+		}
+	} else {
+		if (wh instanceof dojo.widget.ToolbarItem) {
+			item = wh;
+		} else {
+			if (wh instanceof dojo.uri.Uri) {
+				item = dojo.widget.createWidget(&quot;ToolbarButton&quot;, dojo.lang.mixin(props || {}, {icon:new dojo.widget.Icon(wh.toString())}));
+			} else {
+				if (whIsType) {
+					item = dojo.widget.createWidget(wh, props);
+				} else {
+					if (typeof wh == &quot;string&quot; || wh instanceof String) {
+						switch (wh.charAt(0)) {
+						  case &quot;|&quot;:
+						  case &quot;-&quot;:
+						  case &quot;/&quot;:
+							item = dojo.widget.createWidget(&quot;ToolbarSeparator&quot;, props);
+							break;
+						  case &quot; &quot;:
+							if (wh.length == 1) {
+								item = dojo.widget.createWidget(&quot;ToolbarSpace&quot;, props);
+							} else {
+								item = dojo.widget.createWidget(&quot;ToolbarFlexibleSpace&quot;, props);
+							}
+							break;
+						  default:
+							if (/\.(gif|jpg|jpeg|png)$/i.test(wh)) {
+								item = dojo.widget.createWidget(&quot;ToolbarButton&quot;, dojo.lang.mixin(props || {}, {icon:new dojo.widget.Icon(wh.toString())}));
+							} else {
+								item = dojo.widget.createWidget(&quot;ToolbarButton&quot;, dojo.lang.mixin(props || {}, {label:wh.toString()}));
+							}
+						}
+					} else {
+						if (wh &amp;&amp; wh.tagName &amp;&amp; /^img$/i.test(wh.tagName)) {
+							item = dojo.widget.createWidget(&quot;ToolbarButton&quot;, dojo.lang.mixin(props || {}, {icon:wh}));
+						} else {
+							item = dojo.widget.createWidget(&quot;ToolbarButton&quot;, dojo.lang.mixin(props || {}, {label:wh.toString()}));
+						}
+					}
+				}
+			}
+		}
+	}
+	return item;
+};
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarButtonGroup&quot;, dojo.widget.ToolbarItem, {isContainer:true, templateString:&quot;&lt;span unselectable=\&quot;on\&quot; class=\&quot;toolbarButtonGroup\&quot; dojoAttachPoint=\&quot;containerNode\&quot;&gt;&lt;/span&gt;&quot;, defaultButton:&quot;&quot;, postCreate:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this._injectChild(this.children[i]);
+	}
+}, addChild:function (item, pos, props) {
+	var widget = dojo.widget.ToolbarItem.make(item, null, dojo.lang.mixin(props || {}, {toggleItem:true}));
+	var ret = dojo.widget.ToolbarButtonGroup.superclass.addChild.call(this, widget, null, pos, null);
+	this._injectChild(widget);
+	return ret;
+}, _injectChild:function (widget) {
+	dojo.event.connect(widget, &quot;onSelect&quot;, this, &quot;onChildSelected&quot;);
+	dojo.event.connect(widget, &quot;onDeselect&quot;, this, &quot;onChildDeSelected&quot;);
+	if (widget._name == this.defaultButton || (typeof this.defaultButton == &quot;number&quot; &amp;&amp; this.children.length - 1 == this.defaultButton)) {
+		widget.select(false, true);
+	}
+}, getItem:function (name) {
+	if (name instanceof dojo.widget.ToolbarItem) {
+		return name;
+	}
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem &amp;&amp; child._name == name) {
+			return child;
+		}
+	}
+	return null;
+}, getItems:function () {
+	var items = [];
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem) {
+			items.push(child);
+		}
+	}
+	return items;
+}, onChildSelected:function (e) {
+	this.select(e._name);
+}, onChildDeSelected:function (e) {
+	this._fireEvent(&quot;onChangeSelect&quot;, this._value);
+}, enable:function (force, preventEvent) {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem) {
+			child.enable(force, preventEvent);
+			if (child._name == this._value) {
+				child.select(force, preventEvent);
+			}
+		}
+	}
+}, disable:function (force, preventEvent) {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem) {
+			child.disable(force, preventEvent);
+		}
+	}
+}, _value:&quot;&quot;, getValue:function () {
+	return this._value;
+}, select:function (name, force, preventEvent) {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child instanceof dojo.widget.ToolbarItem) {
+			if (child._name == name) {
+				child.select(force, preventEvent);
+				this._value = name;
+			} else {
+				child.deselect(true, true);
+			}
+		}
+	}
+	if (!preventEvent) {
+		this._fireEvent(&quot;onSelect&quot;, this._value);
+		this._fireEvent(&quot;onChangeSelect&quot;, this._value);
+	}
+}, setValue:this.select, preventDeselect:false});
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarButton&quot;, dojo.widget.ToolbarItem, {fillInTemplate:function (args, frag) {
+	dojo.widget.ToolbarButton.superclass.fillInTemplate.call(this, args, frag);
+	dojo.html.addClass(this.domNode, &quot;toolbarButton&quot;);
+	if (this._icon) {
+		this.setIcon(this._icon);
+	}
+	if (this._label) {
+		this.setLabel(this._label);
+	}
+	if (!this._name) {
+		if (this._label) {
+			this.setName(this._label);
+		} else {
+			if (this._icon) {
+				var src = this._icon.getSrc(&quot;enabled&quot;).match(/[\/^]([^\.\/]+)\.(gif|jpg|jpeg|png)$/i);
+				if (src) {
+					this.setName(src[1]);
+				}
+			} else {
+				this._name = this._widgetId;
+			}
+		}
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarDialog&quot;, dojo.widget.ToolbarButton, {fillInTemplate:function (args, frag) {
+	dojo.widget.ToolbarDialog.superclass.fillInTemplate.call(this, args, frag);
+	dojo.event.connect(this, &quot;onSelect&quot;, this, &quot;showDialog&quot;);
+	dojo.event.connect(this, &quot;onDeselect&quot;, this, &quot;hideDialog&quot;);
+}, showDialog:function (e) {
+	dojo.lang.setTimeout(dojo.event.connect, 1, document, &quot;onmousedown&quot;, this, &quot;deselect&quot;);
+}, hideDialog:function (e) {
+	dojo.event.disconnect(document, &quot;onmousedown&quot;, this, &quot;deselect&quot;);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarMenu&quot;, dojo.widget.ToolbarDialog, {});
+dojo.widget.ToolbarMenuItem = function () {
+};
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarSeparator&quot;, dojo.widget.ToolbarItem, {templateString:&quot;&lt;span unselectable=\&quot;on\&quot; class=\&quot;toolbarItem toolbarSeparator\&quot;&gt;&lt;/span&gt;&quot;, defaultIconPath:new dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/buttons/sep.gif&quot;), fillInTemplate:function (args, frag, skip) {
+	dojo.widget.ToolbarSeparator.superclass.fillInTemplate.call(this, args, frag);
+	this._name = this.widgetId;
+	if (!skip) {
+		if (!this._icon) {
+			this.setIcon(this.defaultIconPath);
+		}
+		this.domNode.appendChild(this._icon.getNode());
+	}
+}, _onmouseover:null, _onmouseout:null, _onclick:null, _onmousedown:null, _onmouseup:null});
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarSpace&quot;, dojo.widget.ToolbarSeparator, {fillInTemplate:function (args, frag, skip) {
+	dojo.widget.ToolbarSpace.superclass.fillInTemplate.call(this, args, frag, true);
+	if (!skip) {
+		dojo.html.addClass(this.domNode, &quot;toolbarSpace&quot;);
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarSelect&quot;, dojo.widget.ToolbarItem, {templateString:&quot;&lt;span class=\&quot;toolbarItem toolbarSelect\&quot; unselectable=\&quot;on\&quot;&gt;&lt;select dojoAttachPoint=\&quot;selectBox\&quot; dojoOnChange=\&quot;changed\&quot;&gt;&lt;/select&gt;&lt;/span&gt;&quot;, fillInTemplate:function (args, frag) {
+	dojo.widget.ToolbarSelect.superclass.fillInTemplate.call(this, args, frag, true);
+	var keys = args.values;
+	var i = 0;
+	for (var val in keys) {
+		var opt = document.createElement(&quot;option&quot;);
+		opt.setAttribute(&quot;value&quot;, keys[val]);
+		opt.innerHTML = val;
+		this.selectBox.appendChild(opt);
+	}
+}, changed:function (e) {
+	this._fireEvent(&quot;onSetValue&quot;, this.selectBox.value);
+}, setEnabled:function (is, force, preventEvent) {
+	var ret = dojo.widget.ToolbarSelect.superclass.setEnabled.call(this, is, force, preventEvent);
+	this.selectBox.disabled = this.disabled;
+	return ret;
+}, _onmouseover:null, _onmouseout:null, _onclick:null, _onmousedown:null, _onmouseup:null});
+dojo.widget.Icon = function (enabled, disabled, hovered, selected) {
+	if (!arguments.length) {
+		throw new Error(&quot;Icon must have at least an enabled state&quot;);
+	}
+	var states = [&quot;enabled&quot;, &quot;disabled&quot;, &quot;hovered&quot;, &quot;selected&quot;];
+	var currentState = &quot;enabled&quot;;
+	var domNode = document.createElement(&quot;img&quot;);
+	this.getState = function () {
+		return currentState;
+	};
+	this.setState = function (value) {
+		if (dojo.lang.inArray(states, value)) {
+			if (this[value]) {
+				currentState = value;
+				var img = this[currentState];
+				if ((dojo.render.html.ie55 || dojo.render.html.ie60) &amp;&amp; img.src &amp;&amp; img.src.match(/[.]png$/i)) {
+					domNode.width = img.width || img.offsetWidth;
+					domNode.height = img.height || img.offsetHeight;
+					domNode.setAttribute(&quot;src&quot;, dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/blank.gif&quot;).uri);
+					domNode.style.filter = &quot;progid:DXImageTransform.Microsoft.AlphaImageLoader(src='&quot; + img.src + &quot;',sizingMethod='image')&quot;;
+				} else {
+					domNode.setAttribute(&quot;src&quot;, img.src);
+				}
+			}
+		} else {
+			throw new Error(&quot;Invalid state set on Icon (state: &quot; + value + &quot;)&quot;);
+		}
+	};
+	this.setSrc = function (state, value) {
+		if (/^img$/i.test(value.tagName)) {
+			this[state] = value;
+		} else {
+			if (typeof value == &quot;string&quot; || value instanceof String || value instanceof dojo.uri.Uri) {
+				this[state] = new Image();
+				this[state].src = value.toString();
+			}
+		}
+		return this[state];
+	};
+	this.setIcon = function (icon) {
+		for (var i = 0; i &lt; states.length; i++) {
+			if (icon[states[i]]) {
+				this.setSrc(states[i], icon[states[i]]);
+			}
+		}
+		this.update();
+	};
+	this.enable = function () {
+		this.setState(&quot;enabled&quot;);
+	};
+	this.disable = function () {
+		this.setState(&quot;disabled&quot;);
+	};
+	this.hover = function () {
+		this.setState(&quot;hovered&quot;);
+	};
+	this.select = function () {
+		this.setState(&quot;selected&quot;);
+	};
+	this.getSize = function () {
+		return {width:domNode.width || domNode.offsetWidth, height:domNode.height || domNode.offsetHeight};
+	};
+	this.setSize = function (w, h) {
+		domNode.width = w;
+		domNode.height = h;
+		return {width:w, height:h};
+	};
+	this.getNode = function () {
+		return domNode;
+	};
+	this.getSrc = function (state) {
+		if (state) {
+			return this[state].src;
+		}
+		return domNode.src || &quot;&quot;;
+	};
+	this.update = function () {
+		this.setState(currentState);
+	};
+	for (var i = 0; i &lt; states.length; i++) {
+		var arg = arguments[i];
+		var state = states[i];
+		this[state] = null;
+		if (!arg) {
+			continue;
+		}
+		this.setSrc(state, arg);
+	}
+	this.enable();
+};
+dojo.widget.Icon.make = function (a, b, c, d) {
+	for (var i = 0; i &lt; arguments.length; i++) {
+		if (arguments[i] instanceof dojo.widget.Icon) {
+			return arguments[i];
+		}
+	}
+	return new dojo.widget.Icon(a, b, c, d);
+};
+dojo.widget.defineWidget(&quot;dojo.widget.ToolbarColorDialog&quot;, dojo.widget.ToolbarDialog, {palette:&quot;7x10&quot;, fillInTemplate:function (args, frag) {
+	dojo.widget.ToolbarColorDialog.superclass.fillInTemplate.call(this, args, frag);
+	this.dialog = dojo.widget.createWidget(&quot;ColorPalette&quot;, {palette:this.palette});
+	this.dialog.domNode.style.position = &quot;absolute&quot;;
+	dojo.event.connect(this.dialog, &quot;onColorSelect&quot;, this, &quot;_setValue&quot;);
+}, _setValue:function (color) {
+	this._value = color;
+	this._fireEvent(&quot;onSetValue&quot;, color);
+}, showDialog:function (e) {
+	dojo.widget.ToolbarColorDialog.superclass.showDialog.call(this, e);
+	var abs = dojo.html.getAbsolutePosition(this.domNode, true);
+	var y = abs.y + dojo.html.getBorderBox(this.domNode).height;
+	this.dialog.showAt(abs.x, y);
+}, hideDialog:function (e) {
+	dojo.widget.ToolbarColorDialog.superclass.hideDialog.call(this, e);
+	this.dialog.hide();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Tooltip.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Tooltip.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Tooltip.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,107 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Tooltip&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.widget.PopupContainer&quot;);
+dojo.require(&quot;dojo.uri.Uri&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.util&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Tooltip&quot;, [dojo.widget.ContentPane, dojo.widget.PopupContainerBase], {caption:&quot;&quot;, showDelay:500, hideDelay:100, connectId:&quot;&quot;, templateCssString:&quot;.dojoTooltip {\n\tborder: solid black 1px;\n\tbackground: beige;\n\tcolor: black;\n\tposition: absolute;\n\tfont-size: small;\n\tpadding: 2px 2px 2px 2px;\n\tz-index: 10;\n\tdisplay: block;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TooltipTemplate.css&quot;), fillInTemplate:function (args, frag) {
+	if (this.caption != &quot;&quot;) {
+		this.domNode.appendChild(document.createTextNode(this.caption));
+	}
+	this._connectNode = dojo.byId(this.connectId);
+	dojo.widget.Tooltip.superclass.fillInTemplate.call(this, args, frag);
+	this.addOnLoad(this, &quot;_loadedContent&quot;);
+	dojo.html.addClass(this.domNode, &quot;dojoTooltip&quot;);
+	var source = this.getFragNodeRef(frag);
+	dojo.html.copyStyle(this.domNode, source);
+	this.applyPopupBasicStyle();
+}, postCreate:function (args, frag) {
+	dojo.event.connect(this._connectNode, &quot;onmouseover&quot;, this, &quot;_onMouseOver&quot;);
+	dojo.widget.Tooltip.superclass.postCreate.call(this, args, frag);
+}, _onMouseOver:function (e) {
+	this._mouse = {x:e.pageX, y:e.pageY};
+	if (!this._tracking) {
+		dojo.event.connect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+		this._tracking = true;
+	}
+	this._onHover(e);
+}, _onMouseMove:function (e) {
+	this._mouse = {x:e.pageX, y:e.pageY};
+	if (dojo.html.overElement(this._connectNode, e) || dojo.html.overElement(this.domNode, e)) {
+		this._onHover(e);
+	} else {
+		this._onUnHover(e);
+	}
+}, _onHover:function (e) {
+	if (this._hover) {
+		return;
+	}
+	this._hover = true;
+	if (this._hideTimer) {
+		clearTimeout(this._hideTimer);
+		delete this._hideTimer;
+	}
+	if (!this.isShowingNow &amp;&amp; !this._showTimer) {
+		this._showTimer = setTimeout(dojo.lang.hitch(this, &quot;open&quot;), this.showDelay);
+	}
+}, _onUnHover:function (e) {
+	if (!this._hover) {
+		return;
+	}
+	this._hover = false;
+	if (this._showTimer) {
+		clearTimeout(this._showTimer);
+		delete this._showTimer;
+	}
+	if (this.isShowingNow &amp;&amp; !this._hideTimer) {
+		this._hideTimer = setTimeout(dojo.lang.hitch(this, &quot;close&quot;), this.hideDelay);
+	}
+	if (!this.isShowingNow) {
+		dojo.event.disconnect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+		this._tracking = false;
+	}
+}, open:function () {
+	if (this.isShowingNow) {
+		return;
+	}
+	dojo.widget.PopupContainerBase.prototype.open.call(this, this._mouse.x, this._mouse.y, null, [this._mouse.x, this._mouse.y], &quot;TL,TR,BL,BR&quot;, [10, 15]);
+}, close:function () {
+	if (this.isShowingNow) {
+		if (this._showTimer) {
+			clearTimeout(this._showTimer);
+			delete this._showTimer;
+		}
+		if (this._hideTimer) {
+			clearTimeout(this._hideTimer);
+			delete this._hideTimer;
+		}
+		dojo.event.disconnect(document.documentElement, &quot;onmousemove&quot;, this, &quot;_onMouseMove&quot;);
+		this._tracking = false;
+		dojo.widget.PopupContainerBase.prototype.close.call(this);
+	}
+}, _position:function () {
+	this.move(this._mouse.x, this._mouse.y, [10, 15], &quot;TL,TR,BL,BR&quot;);
+}, _loadedContent:function () {
+	if (this.isShowingNow) {
+		this._position();
+	}
+}, checkSize:function () {
+}, uninitialize:function () {
+	this.close();
+	dojo.event.disconnect(this._connectNode, &quot;onmouseover&quot;, this, &quot;_onMouseOver&quot;);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Tree.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Tree.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Tree.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,236 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Tree&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeNode&quot;);
+dojo.require(&quot;dojo.html.common&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.Tree&quot;, dojo.widget.HtmlWidget, function () {
+	this.eventNames = {};
+	this.tree = this;
+	this.DNDAcceptTypes = [];
+	this.actionsDisabled = [];
+}, {widgetType:&quot;Tree&quot;, eventNamesDefault:{createDOMNode:&quot;createDOMNode&quot;, treeCreate:&quot;treeCreate&quot;, treeDestroy:&quot;treeDestroy&quot;, treeClick:&quot;treeClick&quot;, iconClick:&quot;iconClick&quot;, titleClick:&quot;titleClick&quot;, moveFrom:&quot;moveFrom&quot;, moveTo:&quot;moveTo&quot;, addChild:&quot;addChild&quot;, removeNode:&quot;removeNode&quot;, expand:&quot;expand&quot;, collapse:&quot;collapse&quot;}, isContainer:true, DNDMode:&quot;off&quot;, lockLevel:0, strictFolders:true, DNDModes:{BETWEEN:1, ONTO:2}, DNDAcceptTypes:&quot;&quot;, templateCssString:&quot;\n.dojoTree {\n\tfont: caption;\n\tfont-size: 11px;\n\tfont-weight: normal;\n\toverflow: auto;\n}\n\n\n.dojoTreeNodeLabelTitle {\n\tpadding-left: 2px;\n\tcolor: WindowText;\n}\n\n.dojoTreeNodeLabel {\n\tcursor:hand;\n\tcursor:pointer;\n}\n\n.dojoTreeNodeLabelTitle:hover {\n\ttext-decoration: underline;\n}\n\n.dojoTreeNodeLabelSelected {\n\tbackground-color: Highlight;\n\tcolor: HighlightText;\n}\n\n.dojoTree div {\n\twhite-space: nowrap;\n}\n\n.dojoTree img, .dojoTreeNodeLabel img {\n\tvertical-align: middle;\n}\n\n&quot;, templateCss!
 Path:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/Tree.css&quot;), templateString:&quot;&lt;div class=\&quot;dojoTree\&quot;&gt;&lt;/div&gt;&quot;, isExpanded:true, isTree:true, objectId:&quot;&quot;, controller:&quot;&quot;, selector:&quot;&quot;, menu:&quot;&quot;, expandLevel:&quot;&quot;, blankIconSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_blank.gif&quot;), gridIconSrcT:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_t.gif&quot;), gridIconSrcL:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_l.gif&quot;), gridIconSrcV:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_v.gif&quot;), gridIconSrcP:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_p.gif&quot;), gridIconSrcC:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_c.gif&quot;), gridIconSrcX:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_x.gif&quot;), gridIconSrcY:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_y.gif&quot;), gridIconSrcZ:dojo.uri.modu!
 leUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_grid_z.gi!
 f&quot;), exp
andIconSrcPlus:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_expand_plus.gif&quot;), expandIconSrcMinus:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_expand_minus.gif&quot;), expandIconSrcLoading:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/treenode_loading.gif&quot;), iconWidth:18, iconHeight:18, showGrid:true, showRootGrid:true, actionIsDisabled:function (action) {
+	var _this = this;
+	return dojo.lang.inArray(_this.actionsDisabled, action);
+}, actions:{ADDCHILD:&quot;ADDCHILD&quot;}, getInfo:function () {
+	var info = {widgetId:this.widgetId, objectId:this.objectId};
+	return info;
+}, initializeController:function () {
+	if (this.controller != &quot;off&quot;) {
+		if (this.controller) {
+			this.controller = dojo.widget.byId(this.controller);
+		} else {
+			dojo.require(&quot;dojo.widget.TreeBasicController&quot;);
+			this.controller = dojo.widget.createWidget(&quot;TreeBasicController&quot;, {DNDController:(this.DNDMode ? &quot;create&quot; : &quot;&quot;), dieWithTree:true});
+		}
+		this.controller.listenTree(this);
+	} else {
+		this.controller = null;
+	}
+}, initializeSelector:function () {
+	if (this.selector != &quot;off&quot;) {
+		if (this.selector) {
+			this.selector = dojo.widget.byId(this.selector);
+		} else {
+			dojo.require(&quot;dojo.widget.TreeSelector&quot;);
+			this.selector = dojo.widget.createWidget(&quot;TreeSelector&quot;, {dieWithTree:true});
+		}
+		this.selector.listenTree(this);
+	} else {
+		this.selector = null;
+	}
+}, initialize:function (args, frag) {
+	var _this = this;
+	for (name in this.eventNamesDefault) {
+		if (dojo.lang.isUndefined(this.eventNames[name])) {
+			this.eventNames[name] = this.widgetId + &quot;/&quot; + this.eventNamesDefault[name];
+		}
+	}
+	for (var i = 0; i &lt; this.actionsDisabled.length; i++) {
+		this.actionsDisabled[i] = this.actionsDisabled[i].toUpperCase();
+	}
+	if (this.DNDMode == &quot;off&quot;) {
+		this.DNDMode = 0;
+	} else {
+		if (this.DNDMode == &quot;between&quot;) {
+			this.DNDMode = this.DNDModes.ONTO | this.DNDModes.BETWEEN;
+		} else {
+			if (this.DNDMode == &quot;onto&quot;) {
+				this.DNDMode = this.DNDModes.ONTO;
+			}
+		}
+	}
+	this.expandLevel = parseInt(this.expandLevel);
+	this.initializeSelector();
+	this.initializeController();
+	if (this.menu) {
+		this.menu = dojo.widget.byId(this.menu);
+		this.menu.listenTree(this);
+	}
+	this.containerNode = this.domNode;
+}, postCreate:function () {
+	this.createDOMNode();
+}, createDOMNode:function () {
+	dojo.html.disableSelection(this.domNode);
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this.children[i].parent = this;
+		var node = this.children[i].createDOMNode(this, 0);
+		this.domNode.appendChild(node);
+	}
+	if (!this.showRootGrid) {
+		for (var i = 0; i &lt; this.children.length; i++) {
+			this.children[i].expand();
+		}
+	}
+	dojo.event.topic.publish(this.eventNames.treeCreate, {source:this});
+}, destroy:function () {
+	dojo.event.topic.publish(this.tree.eventNames.treeDestroy, {source:this});
+	return dojo.widget.HtmlWidget.prototype.destroy.apply(this, arguments);
+}, addChild:function (child, index) {
+	var message = {child:child, index:index, parent:this, domNodeInitialized:child.domNodeInitialized};
+	this.doAddChild.apply(this, arguments);
+	dojo.event.topic.publish(this.tree.eventNames.addChild, message);
+}, doAddChild:function (child, index) {
+	if (dojo.lang.isUndefined(index)) {
+		index = this.children.length;
+	}
+	if (!child.isTreeNode) {
+		dojo.raise(&quot;You can only add TreeNode widgets to a &quot; + this.widgetType + &quot; widget!&quot;);
+		return;
+	}
+	if (this.isTreeNode) {
+		if (!this.isFolder) {
+			this.setFolder();
+		}
+	}
+	var _this = this;
+	dojo.lang.forEach(child.getDescendants(), function (elem) {
+		elem.tree = _this.tree;
+	});
+	child.parent = this;
+	if (this.isTreeNode) {
+		this.state = this.loadStates.LOADED;
+	}
+	if (index &lt; this.children.length) {
+		dojo.html.insertBefore(child.domNode, this.children[index].domNode);
+	} else {
+		this.containerNode.appendChild(child.domNode);
+		if (this.isExpanded &amp;&amp; this.isTreeNode) {
+			this.showChildren();
+		}
+	}
+	this.children.splice(index, 0, child);
+	if (child.domNodeInitialized) {
+		var d = this.isTreeNode ? this.depth : -1;
+		child.adjustDepth(d - child.depth + 1);
+		child.updateIconTree();
+	} else {
+		child.depth = this.isTreeNode ? this.depth + 1 : 0;
+		child.createDOMNode(child.tree, child.depth);
+	}
+	var prevSibling = child.getPreviousSibling();
+	if (child.isLastChild() &amp;&amp; prevSibling) {
+		prevSibling.updateExpandGridColumn();
+	}
+}, makeBlankImg:function () {
+	var img = document.createElement(&quot;img&quot;);
+	img.style.width = this.iconWidth + &quot;px&quot;;
+	img.style.height = this.iconHeight + &quot;px&quot;;
+	img.src = this.blankIconSrc;
+	img.style.verticalAlign = &quot;middle&quot;;
+	return img;
+}, updateIconTree:function () {
+	if (!this.isTree) {
+		this.updateIcons();
+	}
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this.children[i].updateIconTree();
+	}
+}, toString:function () {
+	return &quot;[&quot; + this.widgetType + &quot; ID:&quot; + this.widgetId + &quot;]&quot;;
+}, move:function (child, newParent, index) {
+	var oldParent = child.parent;
+	var oldTree = child.tree;
+	this.doMove.apply(this, arguments);
+	var newParent = child.parent;
+	var newTree = child.tree;
+	var message = {oldParent:oldParent, oldTree:oldTree, newParent:newParent, newTree:newTree, child:child};
+	dojo.event.topic.publish(oldTree.eventNames.moveFrom, message);
+	dojo.event.topic.publish(newTree.eventNames.moveTo, message);
+}, doMove:function (child, newParent, index) {
+	child.parent.doRemoveNode(child);
+	newParent.doAddChild(child, index);
+}, removeNode:function (child) {
+	if (!child.parent) {
+		return;
+	}
+	var oldTree = child.tree;
+	var oldParent = child.parent;
+	var removedChild = this.doRemoveNode.apply(this, arguments);
+	dojo.event.topic.publish(this.tree.eventNames.removeNode, {child:removedChild, tree:oldTree, parent:oldParent});
+	return removedChild;
+}, doRemoveNode:function (child) {
+	if (!child.parent) {
+		return;
+	}
+	var parent = child.parent;
+	var children = parent.children;
+	var index = child.getParentIndex();
+	if (index &lt; 0) {
+		dojo.raise(&quot;Couldn't find node &quot; + child + &quot; for removal&quot;);
+	}
+	children.splice(index, 1);
+	dojo.html.removeNode(child.domNode);
+	if (parent.children.length == 0 &amp;&amp; !parent.isTree) {
+		parent.containerNode.style.display = &quot;none&quot;;
+	}
+	if (index == children.length &amp;&amp; index &gt; 0) {
+		children[index - 1].updateExpandGridColumn();
+	}
+	if (parent instanceof dojo.widget.Tree &amp;&amp; index == 0 &amp;&amp; children.length &gt; 0) {
+		children[0].updateExpandGrid();
+	}
+	child.parent = child.tree = null;
+	return child;
+}, markLoading:function () {
+}, unMarkLoading:function () {
+}, lock:function () {
+	!this.lockLevel &amp;&amp; this.markLoading();
+	this.lockLevel++;
+}, unlock:function () {
+	if (!this.lockLevel) {
+		dojo.raise(&quot;unlock: not locked&quot;);
+	}
+	this.lockLevel--;
+	!this.lockLevel &amp;&amp; this.unMarkLoading();
+}, isLocked:function () {
+	var node = this;
+	while (true) {
+		if (node.lockLevel) {
+			return true;
+		}
+		if (node instanceof dojo.widget.Tree) {
+			break;
+		}
+		node = node.parent;
+	}
+	return false;
+}, flushLock:function () {
+	this.lockLevel = 0;
+	this.unMarkLoading();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeBasicController.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeBasicController.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeBasicController.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,154 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeBasicController&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeBasicController&quot;, dojo.widget.HtmlWidget, {widgetType:&quot;TreeBasicController&quot;, DNDController:&quot;&quot;, dieWithTree:false, initialize:function (args, frag) {
+	if (this.DNDController == &quot;create&quot;) {
+		dojo.require(&quot;dojo.dnd.TreeDragAndDrop&quot;);
+		this.DNDController = new dojo.dnd.TreeDNDController(this);
+	}
+}, listenTree:function (tree) {
+	dojo.event.topic.subscribe(tree.eventNames.createDOMNode, this, &quot;onCreateDOMNode&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.treeClick, this, &quot;onTreeClick&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.treeCreate, this, &quot;onTreeCreate&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+	if (this.DNDController) {
+		this.DNDController.listenTree(tree);
+	}
+}, unlistenTree:function (tree) {
+	dojo.event.topic.unsubscribe(tree.eventNames.createDOMNode, this, &quot;onCreateDOMNode&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.treeClick, this, &quot;onTreeClick&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.treeCreate, this, &quot;onTreeCreate&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+}, onTreeDestroy:function (message) {
+	var tree = message.source;
+	this.unlistenTree(tree);
+	if (this.dieWithTree) {
+		this.destroy();
+	}
+}, onCreateDOMNode:function (message) {
+	var node = message.source;
+	if (node.expandLevel &gt; 0) {
+		this.expandToLevel(node, node.expandLevel);
+	}
+}, onTreeCreate:function (message) {
+	var tree = message.source;
+	var _this = this;
+	if (tree.expandLevel) {
+		dojo.lang.forEach(tree.children, function (child) {
+			_this.expandToLevel(child, tree.expandLevel - 1);
+		});
+	}
+}, expandToLevel:function (node, level) {
+	if (level == 0) {
+		return;
+	}
+	var children = node.children;
+	var _this = this;
+	var handler = function (node, expandLevel) {
+		this.node = node;
+		this.expandLevel = expandLevel;
+		this.process = function () {
+			for (var i = 0; i &lt; this.node.children.length; i++) {
+				var child = node.children[i];
+				_this.expandToLevel(child, this.expandLevel);
+			}
+		};
+	};
+	var h = new handler(node, level - 1);
+	this.expand(node, false, h, h.process);
+}, onTreeClick:function (message) {
+	var node = message.source;
+	if (node.isLocked()) {
+		return false;
+	}
+	if (node.isExpanded) {
+		this.collapse(node);
+	} else {
+		this.expand(node);
+	}
+}, expand:function (node, sync, callObj, callFunc) {
+	node.expand();
+	if (callFunc) {
+		callFunc.apply(callObj, [node]);
+	}
+}, collapse:function (node) {
+	node.collapse();
+}, canMove:function (child, newParent) {
+	if (child.actionIsDisabled(child.actions.MOVE)) {
+		return false;
+	}
+	if (child.parent !== newParent &amp;&amp; newParent.actionIsDisabled(newParent.actions.ADDCHILD)) {
+		return false;
+	}
+	var node = newParent;
+	while (node.isTreeNode) {
+		if (node === child) {
+			return false;
+		}
+		node = node.parent;
+	}
+	return true;
+}, move:function (child, newParent, index) {
+	if (!this.canMove(child, newParent)) {
+		return false;
+	}
+	var result = this.doMove(child, newParent, index);
+	if (!result) {
+		return result;
+	}
+	if (newParent.isTreeNode) {
+		this.expand(newParent);
+	}
+	return result;
+}, doMove:function (child, newParent, index) {
+	child.tree.move(child, newParent, index);
+	return true;
+}, canRemoveNode:function (child) {
+	if (child.actionIsDisabled(child.actions.REMOVE)) {
+		return false;
+	}
+	return true;
+}, removeNode:function (node, callObj, callFunc) {
+	if (!this.canRemoveNode(node)) {
+		return false;
+	}
+	return this.doRemoveNode(node, callObj, callFunc);
+}, doRemoveNode:function (node, callObj, callFunc) {
+	node.tree.removeNode(node);
+	if (callFunc) {
+		callFunc.apply(dojo.lang.isUndefined(callObj) ? this : callObj, [node]);
+	}
+}, canCreateChild:function (parent, index, data) {
+	if (parent.actionIsDisabled(parent.actions.ADDCHILD)) {
+		return false;
+	}
+	return true;
+}, createChild:function (parent, index, data, callObj, callFunc) {
+	if (!this.canCreateChild(parent, index, data)) {
+		return false;
+	}
+	return this.doCreateChild.apply(this, arguments);
+}, doCreateChild:function (parent, index, data, callObj, callFunc) {
+	var widgetType = data.widgetType ? data.widgetType : &quot;TreeNode&quot;;
+	var newChild = dojo.widget.createWidget(widgetType, data);
+	parent.addChild(newChild, index);
+	this.expand(parent);
+	if (callFunc) {
+		callFunc.apply(callObj, [newChild]);
+	}
+	return newChild;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeBasicControllerV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeBasicControllerV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeBasicControllerV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,461 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeBasicControllerV3&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.TreeCommon&quot;);
+dojo.require(&quot;dojo.widget.TreeNodeV3&quot;);
+dojo.require(&quot;dojo.widget.TreeV3&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeBasicControllerV3&quot;, [dojo.widget.HtmlWidget, dojo.widget.TreeCommon], function () {
+	this.listenedTrees = {};
+}, {listenTreeEvents:[&quot;afterSetFolder&quot;, &quot;afterTreeCreate&quot;, &quot;beforeTreeDestroy&quot;], listenNodeFilter:function (elem) {
+	return elem instanceof dojo.widget.Widget;
+}, editor:null, initialize:function (args) {
+	if (args.editor) {
+		this.editor = dojo.widget.byId(args.editor);
+		this.editor.controller = this;
+	}
+}, getInfo:function (elem) {
+	return elem.getInfo();
+}, onBeforeTreeDestroy:function (message) {
+	this.unlistenTree(message.source);
+}, onAfterSetFolder:function (message) {
+	if (message.source.expandLevel &gt; 0) {
+		this.expandToLevel(message.source, message.source.expandLevel);
+	}
+	if (message.source.loadLevel &gt; 0) {
+		this.loadToLevel(message.source, message.source.loadLevel);
+	}
+}, _focusNextVisible:function (nodeWidget) {
+	if (nodeWidget.isFolder &amp;&amp; nodeWidget.isExpanded &amp;&amp; nodeWidget.children.length &gt; 0) {
+		returnWidget = nodeWidget.children[0];
+	} else {
+		while (nodeWidget.isTreeNode &amp;&amp; nodeWidget.isLastChild()) {
+			nodeWidget = nodeWidget.parent;
+		}
+		if (nodeWidget.isTreeNode) {
+			var returnWidget = nodeWidget.parent.children[nodeWidget.getParentIndex() + 1];
+		}
+	}
+	if (returnWidget &amp;&amp; returnWidget.isTreeNode) {
+		this._focusLabel(returnWidget);
+		return returnWidget;
+	}
+}, _focusPreviousVisible:function (nodeWidget) {
+	var returnWidget = nodeWidget;
+	if (!nodeWidget.isFirstChild()) {
+		var previousSibling = nodeWidget.parent.children[nodeWidget.getParentIndex() - 1];
+		nodeWidget = previousSibling;
+		while (nodeWidget.isFolder &amp;&amp; nodeWidget.isExpanded &amp;&amp; nodeWidget.children.length &gt; 0) {
+			returnWidget = nodeWidget;
+			nodeWidget = nodeWidget.children[nodeWidget.children.length - 1];
+		}
+	} else {
+		nodeWidget = nodeWidget.parent;
+	}
+	if (nodeWidget &amp;&amp; nodeWidget.isTreeNode) {
+		returnWidget = nodeWidget;
+	}
+	if (returnWidget &amp;&amp; returnWidget.isTreeNode) {
+		this._focusLabel(returnWidget);
+		return returnWidget;
+	}
+}, _focusZoomIn:function (nodeWidget) {
+	var returnWidget = nodeWidget;
+	if (nodeWidget.isFolder &amp;&amp; !nodeWidget.isExpanded) {
+		this.expand(nodeWidget);
+	} else {
+		if (nodeWidget.children.length &gt; 0) {
+			nodeWidget = nodeWidget.children[0];
+		}
+	}
+	if (nodeWidget &amp;&amp; nodeWidget.isTreeNode) {
+		returnWidget = nodeWidget;
+	}
+	if (returnWidget &amp;&amp; returnWidget.isTreeNode) {
+		this._focusLabel(returnWidget);
+		return returnWidget;
+	}
+}, _focusZoomOut:function (node) {
+	var returnWidget = node;
+	if (node.isFolder &amp;&amp; node.isExpanded) {
+		this.collapse(node);
+	} else {
+		node = node.parent;
+	}
+	if (node &amp;&amp; node.isTreeNode) {
+		returnWidget = node;
+	}
+	if (returnWidget &amp;&amp; returnWidget.isTreeNode) {
+		this._focusLabel(returnWidget);
+		return returnWidget;
+	}
+}, onFocusNode:function (e) {
+	var node = this.domElement2TreeNode(e.target);
+	if (node) {
+		node.viewFocus();
+		dojo.event.browser.stopEvent(e);
+	}
+}, onBlurNode:function (e) {
+	var node = this.domElement2TreeNode(e.target);
+	if (!node) {
+		return;
+	}
+	var labelNode = node.labelNode;
+	labelNode.setAttribute(&quot;tabIndex&quot;, &quot;-1&quot;);
+	node.viewUnfocus();
+	dojo.event.browser.stopEvent(e);
+	node.tree.domNode.setAttribute(&quot;tabIndex&quot;, &quot;0&quot;);
+}, _focusLabel:function (node) {
+	var lastFocused = node.tree.lastFocused;
+	var labelNode;
+	if (lastFocused &amp;&amp; lastFocused.labelNode) {
+		labelNode = lastFocused.labelNode;
+		dojo.event.disconnect(labelNode, &quot;onblur&quot;, this, &quot;onBlurNode&quot;);
+		labelNode.setAttribute(&quot;tabIndex&quot;, &quot;-1&quot;);
+		dojo.html.removeClass(labelNode, &quot;TreeLabelFocused&quot;);
+	}
+	labelNode = node.labelNode;
+	labelNode.setAttribute(&quot;tabIndex&quot;, &quot;0&quot;);
+	node.tree.lastFocused = node;
+	dojo.html.addClass(labelNode, &quot;TreeLabelFocused&quot;);
+	dojo.event.connectOnce(labelNode, &quot;onblur&quot;, this, &quot;onBlurNode&quot;);
+	dojo.event.connectOnce(labelNode, &quot;onfocus&quot;, this, &quot;onFocusNode&quot;);
+	labelNode.focus();
+}, onKey:function (e) {
+	if (!e.key || e.ctrkKey || e.altKey) {
+		return;
+	}
+	var nodeWidget = this.domElement2TreeNode(e.target);
+	if (!nodeWidget) {
+		return;
+	}
+	var treeWidget = nodeWidget.tree;
+	if (treeWidget.lastFocused &amp;&amp; treeWidget.lastFocused.labelNode) {
+		nodeWidget = treeWidget.lastFocused;
+	}
+	switch (e.key) {
+	  case e.KEY_TAB:
+		if (e.shiftKey) {
+			treeWidget.domNode.setAttribute(&quot;tabIndex&quot;, &quot;-1&quot;);
+		}
+		break;
+	  case e.KEY_RIGHT_ARROW:
+		this._focusZoomIn(nodeWidget);
+		dojo.event.browser.stopEvent(e);
+		break;
+	  case e.KEY_LEFT_ARROW:
+		this._focusZoomOut(nodeWidget);
+		dojo.event.browser.stopEvent(e);
+		break;
+	  case e.KEY_UP_ARROW:
+		this._focusPreviousVisible(nodeWidget);
+		dojo.event.browser.stopEvent(e);
+		break;
+	  case e.KEY_DOWN_ARROW:
+		this._focusNextVisible(nodeWidget);
+		dojo.event.browser.stopEvent(e);
+		break;
+	}
+}, onFocusTree:function (e) {
+	if (!e.currentTarget) {
+		return;
+	}
+	try {
+		var treeWidget = this.getWidgetByNode(e.currentTarget);
+		if (!treeWidget || !treeWidget.isTree) {
+			return;
+		}
+		var nodeWidget = this.getWidgetByNode(treeWidget.domNode.firstChild);
+		if (nodeWidget &amp;&amp; nodeWidget.isTreeNode) {
+			if (treeWidget.lastFocused &amp;&amp; treeWidget.lastFocused.isTreeNode) {
+				nodeWidget = treeWidget.lastFocused;
+			}
+			this._focusLabel(nodeWidget);
+		}
+	}
+	catch (e) {
+	}
+}, onAfterTreeCreate:function (message) {
+	var tree = message.source;
+	dojo.event.browser.addListener(tree.domNode, &quot;onKey&quot;, dojo.lang.hitch(this, this.onKey));
+	dojo.event.browser.addListener(tree.domNode, &quot;onmousedown&quot;, dojo.lang.hitch(this, this.onTreeMouseDown));
+	dojo.event.browser.addListener(tree.domNode, &quot;onclick&quot;, dojo.lang.hitch(this, this.onTreeClick));
+	dojo.event.browser.addListener(tree.domNode, &quot;onfocus&quot;, dojo.lang.hitch(this, this.onFocusTree));
+	tree.domNode.setAttribute(&quot;tabIndex&quot;, &quot;0&quot;);
+	if (tree.expandLevel) {
+		this.expandToLevel(tree, tree.expandLevel);
+	}
+	if (tree.loadLevel) {
+		this.loadToLevel(tree, tree.loadLevel);
+	}
+}, onTreeMouseDown:function (e) {
+}, onTreeClick:function (e) {
+	var domElement = e.target;
+	var node = this.domElement2TreeNode(domElement);
+	if (!node || !node.isTreeNode) {
+		return;
+	}
+	var checkExpandClick = function (el) {
+		return el === node.expandNode;
+	};
+	if (this.checkPathCondition(domElement, checkExpandClick)) {
+		this.processExpandClick(node);
+	}
+	this._focusLabel(node);
+}, processExpandClick:function (node) {
+	if (node.isExpanded) {
+		this.collapse(node);
+	} else {
+		this.expand(node);
+	}
+}, batchExpandTimeout:20, expandAll:function (nodeOrTree) {
+	return this.expandToLevel(nodeOrTree, Number.POSITIVE_INFINITY);
+}, collapseAll:function (nodeOrTree) {
+	var _this = this;
+	var filter = function (elem) {
+		return (elem instanceof dojo.widget.Widget) &amp;&amp; elem.isFolder &amp;&amp; elem.isExpanded;
+	};
+	if (nodeOrTree.isTreeNode) {
+		this.processDescendants(nodeOrTree, filter, this.collapse);
+	} else {
+		if (nodeOrTree.isTree) {
+			dojo.lang.forEach(nodeOrTree.children, function (c) {
+				_this.processDescendants(c, filter, _this.collapse);
+			});
+		}
+	}
+}, expandToNode:function (node, withSelected) {
+	n = withSelected ? node : node.parent;
+	s = [];
+	while (!n.isExpanded) {
+		s.push(n);
+		n = n.parent;
+	}
+	dojo.lang.forEach(s, function (n) {
+		n.expand();
+	});
+}, expandToLevel:function (nodeOrTree, level) {
+	dojo.require(&quot;dojo.widget.TreeTimeoutIterator&quot;);
+	var _this = this;
+	var filterFunc = function (elem) {
+		var res = elem.isFolder || elem.children &amp;&amp; elem.children.length;
+		return res;
+	};
+	var callFunc = function (node, iterator) {
+		_this.expand(node, true);
+		iterator.forward();
+	};
+	var iterator = new dojo.widget.TreeTimeoutIterator(nodeOrTree, callFunc, this);
+	iterator.setFilter(filterFunc);
+	iterator.timeout = this.batchExpandTimeout;
+	iterator.setMaxLevel(nodeOrTree.isTreeNode ? level - 1 : level);
+	return iterator.start(nodeOrTree.isTreeNode);
+}, getWidgetByNode:function (node) {
+	var widgetId;
+	var newNode = node;
+	while (!(widgetId = newNode.widgetId)) {
+		newNode = newNode.parentNode;
+		if (newNode == null) {
+			break;
+		}
+	}
+	if (widgetId) {
+		return dojo.widget.byId(widgetId);
+	} else {
+		if (node == null) {
+			return null;
+		} else {
+			return dojo.widget.manager.byNode(node);
+		}
+	}
+}, expand:function (node) {
+	if (node.isFolder) {
+		node.expand();
+	}
+}, collapse:function (node) {
+	if (node.isFolder) {
+		node.collapse();
+	}
+}, canEditLabel:function (node) {
+	if (node.actionIsDisabledNow(node.actions.EDIT)) {
+		return false;
+	}
+	return true;
+}, editLabelStart:function (node) {
+	if (!this.canEditLabel(node)) {
+		return false;
+	}
+	if (!this.editor.isClosed()) {
+		this.editLabelFinish(this.editor.saveOnBlur);
+	}
+	this.doEditLabelStart(node);
+}, editLabelFinish:function (save) {
+	this.doEditLabelFinish(save);
+}, doEditLabelStart:function (node) {
+	if (!this.editor) {
+		dojo.raise(this.widgetType + &quot;: no editor specified&quot;);
+	}
+	this.editor.open(node);
+}, doEditLabelFinish:function (save, server_data) {
+	if (!this.editor) {
+		dojo.raise(this.widgetType + &quot;: no editor specified&quot;);
+	}
+	var node = this.editor.node;
+	var editorTitle = this.editor.getContents();
+	this.editor.close(save);
+	if (save) {
+		var data = {title:editorTitle};
+		if (server_data) {
+			dojo.lang.mixin(data, server_data);
+		}
+		if (node.isPhantom) {
+			var parent = node.parent;
+			var index = node.getParentIndex();
+			node.destroy();
+			dojo.widget.TreeBasicControllerV3.prototype.doCreateChild.call(this, parent, index, data);
+		} else {
+			var title = server_data &amp;&amp; server_data.title ? server_data.title : editorTitle;
+			node.setTitle(title);
+		}
+	} else {
+		if (node.isPhantom) {
+			node.destroy();
+		}
+	}
+}, makeDefaultNode:function (parent, index) {
+	var data = {title:parent.tree.defaultChildTitle};
+	return dojo.widget.TreeBasicControllerV3.prototype.doCreateChild.call(this, parent, index, data);
+}, runStages:function (check, prepare, make, finalize, expose, args) {
+	if (check &amp;&amp; !check.apply(this, args)) {
+		return false;
+	}
+	if (prepare &amp;&amp; !prepare.apply(this, args)) {
+		return false;
+	}
+	var result = make.apply(this, args);
+	if (finalize) {
+		finalize.apply(this, args);
+	}
+	if (!result) {
+		return result;
+	}
+	if (expose) {
+		expose.apply(this, args);
+	}
+	return result;
+}});
+dojo.lang.extend(dojo.widget.TreeBasicControllerV3, {createAndEdit:function (parent, index) {
+	var data = {title:parent.tree.defaultChildTitle};
+	if (!this.canCreateChild(parent, index, data)) {
+		return false;
+	}
+	var child = this.doCreateChild(parent, index, data);
+	if (!child) {
+		return false;
+	}
+	this.exposeCreateChild(parent, index, data);
+	child.isPhantom = true;
+	if (!this.editor.isClosed()) {
+		this.editLabelFinish(this.editor.saveOnBlur);
+	}
+	this.doEditLabelStart(child);
+}});
+dojo.lang.extend(dojo.widget.TreeBasicControllerV3, {canClone:function (child, newParent, index, deep) {
+	return true;
+}, clone:function (child, newParent, index, deep) {
+	return this.runStages(this.canClone, this.prepareClone, this.doClone, this.finalizeClone, this.exposeClone, arguments);
+}, exposeClone:function (child, newParent) {
+	if (newParent.isTreeNode) {
+		this.expand(newParent);
+	}
+}, doClone:function (child, newParent, index, deep) {
+	var cloned = child.clone(deep);
+	newParent.addChild(cloned, index);
+	return cloned;
+}});
+dojo.lang.extend(dojo.widget.TreeBasicControllerV3, {canDetach:function (child) {
+	if (child.actionIsDisabledNow(child.actions.DETACH)) {
+		return false;
+	}
+	return true;
+}, detach:function (node) {
+	return this.runStages(this.canDetach, this.prepareDetach, this.doDetach, this.finalizeDetach, this.exposeDetach, arguments);
+}, doDetach:function (node, callObj, callFunc) {
+	node.detach();
+}});
+dojo.lang.extend(dojo.widget.TreeBasicControllerV3, {canDestroyChild:function (child) {
+	if (child.parent &amp;&amp; !this.canDetach(child)) {
+		return false;
+	}
+	return true;
+}, destroyChild:function (node) {
+	return this.runStages(this.canDestroyChild, this.prepareDestroyChild, this.doDestroyChild, this.finalizeDestroyChild, this.exposeDestroyChild, arguments);
+}, doDestroyChild:function (node) {
+	node.destroy();
+}});
+dojo.lang.extend(dojo.widget.TreeBasicControllerV3, {canMoveNotANode:function (child, parent) {
+	if (child.treeCanMove) {
+		return child.treeCanMove(parent);
+	}
+	return true;
+}, canMove:function (child, newParent) {
+	if (!child.isTreeNode) {
+		return this.canMoveNotANode(child, newParent);
+	}
+	if (child.actionIsDisabledNow(child.actions.MOVE)) {
+		return false;
+	}
+	if (child.parent !== newParent &amp;&amp; newParent.actionIsDisabledNow(newParent.actions.ADDCHILD)) {
+		return false;
+	}
+	var node = newParent;
+	while (node.isTreeNode) {
+		if (node === child) {
+			return false;
+		}
+		node = node.parent;
+	}
+	return true;
+}, move:function (child, newParent, index) {
+	return this.runStages(this.canMove, this.prepareMove, this.doMove, this.finalizeMove, this.exposeMove, arguments);
+}, doMove:function (child, newParent, index) {
+	child.tree.move(child, newParent, index);
+	return true;
+}, exposeMove:function (child, newParent) {
+	if (newParent.isTreeNode) {
+		this.expand(newParent);
+	}
+}});
+dojo.lang.extend(dojo.widget.TreeBasicControllerV3, {canCreateChild:function (parent, index, data) {
+	if (parent.actionIsDisabledNow(parent.actions.ADDCHILD)) {
+		return false;
+	}
+	return true;
+}, createChild:function (parent, index, data) {
+	if (!data) {
+		data = {title:parent.tree.defaultChildTitle};
+	}
+	return this.runStages(this.canCreateChild, this.prepareCreateChild, this.doCreateChild, this.finalizeCreateChild, this.exposeCreateChild, [parent, index, data]);
+}, prepareCreateChild:function () {
+	return true;
+}, finalizeCreateChild:function () {
+}, doCreateChild:function (parent, index, data) {
+	var newChild = parent.tree.createNode(data);
+	parent.addChild(newChild, index);
+	return newChild;
+}, exposeCreateChild:function (parent) {
+	return this.expand(parent);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeCommon.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeCommon.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeCommon.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,82 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeCommon&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.declare(&quot;dojo.widget.TreeCommon&quot;, null, {listenTreeEvents:[], listenedTrees:{}, listenNodeFilter:null, listenTree:function (tree) {
+	var _this = this;
+	if (this.listenedTrees[tree.widgetId]) {
+		return;
+	}
+	dojo.lang.forEach(this.listenTreeEvents, function (event) {
+		var eventHandler = &quot;on&quot; + event.charAt(0).toUpperCase() + event.substr(1);
+		dojo.event.topic.subscribe(tree.eventNames[event], _this, eventHandler);
+	});
+	var filter;
+	if (this.listenNodeFilter) {
+		this.processDescendants(tree, this.listenNodeFilter, this.listenNode, true);
+	}
+	this.listenedTrees[tree.widgetId] = true;
+}, listenNode:function () {
+}, unlistenNode:function () {
+}, unlistenTree:function (tree, nodeFilter) {
+	var _this = this;
+	if (!this.listenedTrees[tree.widgetId]) {
+		return;
+	}
+	dojo.lang.forEach(this.listenTreeEvents, function (event) {
+		var eventHandler = &quot;on&quot; + event.charAt(0).toUpperCase() + event.substr(1);
+		dojo.event.topic.unsubscribe(tree.eventNames[event], _this, eventHandler);
+	});
+	if (this.listenNodeFilter) {
+		this.processDescendants(tree, this.listenNodeFilter, this.unlistenNode, true);
+	}
+	delete this.listenedTrees[tree.widgetId];
+}, checkPathCondition:function (domElement, condition) {
+	while (domElement &amp;&amp; !domElement.widgetId) {
+		if (condition.call(null, domElement)) {
+			return true;
+		}
+		domElement = domElement.parentNode;
+	}
+	return false;
+}, domElement2TreeNode:function (domElement) {
+	while (domElement &amp;&amp; !domElement.widgetId) {
+		domElement = domElement.parentNode;
+	}
+	if (!domElement) {
+		return null;
+	}
+	var widget = dojo.widget.byId(domElement.widgetId);
+	if (!widget.isTreeNode) {
+		return null;
+	}
+	return widget;
+}, processDescendants:function (elem, filter, func, skipFirst) {
+	var _this = this;
+	if (!skipFirst) {
+		if (!filter.call(_this, elem)) {
+			return;
+		}
+		func.call(_this, elem);
+	}
+	var stack = [elem];
+	while (elem = stack.pop()) {
+		dojo.lang.forEach(elem.children, function (elem) {
+			if (filter.call(_this, elem)) {
+				func.call(_this, elem);
+				stack.push(elem);
+			}
+		});
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeContextMenu.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeContextMenu.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeContextMenu.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,110 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeContextMenu&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.Menu2&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeContextMenu&quot;, dojo.widget.PopupMenu2, function () {
+	this.listenedTrees = [];
+}, {open:function (x, y, parentMenu, explodeSrc) {
+	var result = dojo.widget.PopupMenu2.prototype.open.apply(this, arguments);
+	dojo.event.topic.publish(this.eventNames.open, {menu:this});
+	return result;
+}, listenTree:function (tree) {
+	var nodes = tree.getDescendants();
+	for (var i = 0; i &lt; nodes.length; i++) {
+		if (!nodes[i].isTreeNode) {
+			continue;
+		}
+		this.bindDomNode(nodes[i].labelNode);
+	}
+	var _this = this;
+	dojo.event.topic.subscribe(tree.eventNames.createDOMNode, this, &quot;onCreateDOMNode&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.moveFrom, this, &quot;onMoveFrom&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.moveTo, this, &quot;onMoveTo&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.removeNode, this, &quot;onRemoveNode&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.addChild, this, &quot;onAddChild&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+	this.listenedTrees.push(tree);
+}, unlistenTree:function (tree) {
+	dojo.event.topic.unsubscribe(tree.eventNames.createDOMNode, this, &quot;onCreateDOMNode&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.moveFrom, this, &quot;onMoveFrom&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.moveTo, this, &quot;onMoveTo&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.removeNode, this, &quot;onRemoveNode&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.addChild, this, &quot;onAddChild&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+	for (var i = 0; i &lt; this.listenedTrees.length; i++) {
+		if (this.listenedTrees[i] === tree) {
+			this.listenedTrees.splice(i, 1);
+			break;
+		}
+	}
+}, onTreeDestroy:function (message) {
+	this.unlistenTree(message.source);
+}, bindTreeNode:function (node) {
+	var _this = this;
+	dojo.lang.forEach(node.getDescendants(), function (e) {
+		_this.bindDomNode(e.labelNode);
+	});
+}, unBindTreeNode:function (node) {
+	var _this = this;
+	dojo.lang.forEach(node.getDescendants(), function (e) {
+		_this.unBindDomNode(e.labelNode);
+	});
+}, onCreateDOMNode:function (message) {
+	this.bindTreeNode(message.source);
+}, onMoveFrom:function (message) {
+	if (!dojo.lang.inArray(this.listenedTrees, message.newTree)) {
+		this.unBindTreeNode(message.child);
+	}
+}, onMoveTo:function (message) {
+	if (dojo.lang.inArray(this.listenedTrees, message.newTree)) {
+		this.bindTreeNode(message.child);
+	}
+}, onRemoveNode:function (message) {
+	this.unBindTreeNode(message.child);
+}, onAddChild:function (message) {
+	if (message.domNodeInitialized) {
+		this.bindTreeNode(message.child);
+	}
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TreeMenuItem&quot;, dojo.widget.MenuItem2, {treeActions:&quot;&quot;, initialize:function (args, frag) {
+	this.treeActions = this.treeActions.split(&quot;,&quot;);
+	for (var i = 0; i &lt; this.treeActions.length; i++) {
+		this.treeActions[i] = this.treeActions[i].toUpperCase();
+	}
+}, getTreeNode:function () {
+	var menu = this;
+	while (!(menu instanceof dojo.widget.TreeContextMenu)) {
+		menu = menu.parent;
+	}
+	var source = menu.getTopOpenEvent().target;
+	while (!source.getAttribute(&quot;treeNode&quot;) &amp;&amp; source.tagName != &quot;body&quot;) {
+		source = source.parentNode;
+	}
+	if (source.tagName == &quot;body&quot;) {
+		dojo.raise(&quot;treeNode not detected&quot;);
+	}
+	var treeNode = dojo.widget.manager.getWidgetById(source.getAttribute(&quot;treeNode&quot;));
+	return treeNode;
+}, menuOpen:function (message) {
+	var treeNode = this.getTreeNode();
+	this.setDisabled(false);
+	var _this = this;
+	dojo.lang.forEach(_this.treeActions, function (action) {
+		_this.setDisabled(treeNode.actionIsDisabled(action));
+	});
+}, toString:function () {
+	return &quot;[&quot; + this.widgetType + &quot; node &quot; + this.getTreeNode() + &quot;]&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeContextMenuV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeContextMenuV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeContextMenuV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,74 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeContextMenuV3&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.Menu2&quot;);
+dojo.require(&quot;dojo.widget.TreeCommon&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeContextMenuV3&quot;, [dojo.widget.PopupMenu2, dojo.widget.TreeCommon], function () {
+	this.listenedTrees = {};
+}, {listenTreeEvents:[&quot;afterTreeCreate&quot;, &quot;beforeTreeDestroy&quot;], listenNodeFilter:function (elem) {
+	return elem instanceof dojo.widget.Widget;
+}, onAfterTreeCreate:function (message) {
+	var tree = message.source;
+	this.bindDomNode(tree.domNode);
+}, onBeforeTreeDestroy:function (message) {
+	this.unBindDomNode(message.source.domNode);
+}, getTreeNode:function () {
+	var source = this.getTopOpenEvent().target;
+	var treeNode = this.domElement2TreeNode(source);
+	return treeNode;
+}, open:function () {
+	var result = dojo.widget.PopupMenu2.prototype.open.apply(this, arguments);
+	for (var i = 0; i &lt; this.children.length; i++) {
+		if (this.children[i].menuOpen) {
+			this.children[i].menuOpen(this.getTreeNode());
+		}
+	}
+	return result;
+}, close:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		if (this.children[i].menuClose) {
+			this.children[i].menuClose(this.getTreeNode());
+		}
+	}
+	var result = dojo.widget.PopupMenu2.prototype.close.apply(this, arguments);
+	return result;
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.TreeMenuItemV3&quot;, [dojo.widget.MenuItem2, dojo.widget.TreeCommon], function () {
+	this.treeActions = [];
+}, {treeActions:&quot;&quot;, initialize:function (args, frag) {
+	for (var i = 0; i &lt; this.treeActions.length; i++) {
+		this.treeActions[i] = this.treeActions[i].toUpperCase();
+	}
+}, getTreeNode:function () {
+	var menu = this;
+	while (!(menu instanceof dojo.widget.TreeContextMenuV3)) {
+		menu = menu.parent;
+	}
+	var treeNode = menu.getTreeNode();
+	return treeNode;
+}, menuOpen:function (treeNode) {
+	treeNode.viewEmphasize();
+	this.setDisabled(false);
+	var _this = this;
+	dojo.lang.forEach(_this.treeActions, function (action) {
+		_this.setDisabled(treeNode.actionIsDisabledNow(action));
+	});
+}, menuClose:function (treeNode) {
+	treeNode.viewUnemphasize();
+}, toString:function () {
+	return &quot;[&quot; + this.widgetType + &quot; node &quot; + this.getTreeNode() + &quot;]&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeControllerExtension.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeControllerExtension.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeControllerExtension.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,60 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeControllerExtension&quot;);
+dojo.declare(&quot;dojo.widget.TreeControllerExtension&quot;, null, {saveExpandedIndices:function (node, field) {
+	var obj = {};
+	for (var i = 0; i &lt; node.children.length; i++) {
+		if (node.children[i].isExpanded) {
+			var key = dojo.lang.isUndefined(field) ? i : node.children[i][field];
+			obj[key] = this.saveExpandedIndices(node.children[i], field);
+		}
+	}
+	return obj;
+}, restoreExpandedIndices:function (node, savedIndices, field) {
+	var _this = this;
+	var handler = function (node, savedIndices) {
+		this.node = node;
+		this.savedIndices = savedIndices;
+		this.process = function () {
+			_this.restoreExpandedIndices(this.node, this.savedIndices, field);
+		};
+	};
+	for (var i = 0; i &lt; node.children.length; i++) {
+		var child = node.children[i];
+		var found = false;
+		var key = -1;
+		if (dojo.lang.isUndefined(field) &amp;&amp; savedIndices[i]) {
+			found = true;
+			key = i;
+		}
+		if (field) {
+			for (var key in savedIndices) {
+				if (key == child[field]) {
+					found = true;
+					break;
+				}
+			}
+		}
+		if (found) {
+			var h = new handler(child, savedIndices[key]);
+			_this.expand(child, false, h, h.process);
+		} else {
+			if (child.isExpanded) {
+				dojo.lang.forEach(child.getDescendants(), function (elem) {
+					_this.collapse(elem);
+				});
+			}
+		}
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeDemo.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeDemo.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeDemo.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,85 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeDemo&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.widget.TreeDemo = {reportIfDefered:function (res) {
+	if (res instanceof dojo.Deferred) {
+		res.addCallbacks(function (res) {
+			return res;
+		}, function (err) {
+			dojo.debug(&quot;Error&quot;);
+			dojo.debugShallow(err);
+		});
+	}
+}, resetRandomChildren:function (maxCount) {
+	this.randomChildrenMaxCount = maxCount;
+	this.randomChildrenCount = 0;
+	this.randomChildrenDepth = 0;
+}, makeRandomChildren:function (title) {
+	this.randomChildrenDepth++;
+	var children = [];
+	for (var i = 1; i &lt;= 5; i++) {
+		var t = title + (this.randomChildrenDepth == 1 ? &quot;&quot; : &quot;.&quot;) + i;
+		var node = {title:t};
+		children.push(node);
+		this.randomChildrenCount++;
+		if (this.randomChildrenCount &gt;= this.randomChildrenMaxCount) {
+			break;
+		}
+	}
+	var i = 1;
+	var _this = this;
+	dojo.lang.forEach(children, function (child) {
+		var t = title + (_this.randomChildrenDepth == 1 ? &quot;&quot; : &quot;.&quot;) + i;
+		i++;
+		if (_this.randomChildrenCount &lt; _this.randomChildrenMaxCount &amp;&amp; (_this.randomChildrenDepth == 1 &amp;&amp; child === children[0] || _this.randomChildrenDepth &lt; 5 &amp;&amp; Math.random() &gt; 0.3)) {
+			child.children = _this.makeRandomChildren(t);
+		}
+	});
+	this.randomChildrenDepth--;
+	return children;
+}, bindDemoMenu:function (controller) {
+	var _t = this;
+	dojo.event.topic.subscribe(&quot;treeContextMenuDestroy/engage&quot;, function (menuItem) {
+		var node = menuItem.getTreeNode();
+		_t.reportIfDefered(controller.destroyChild(node));
+	});
+	dojo.event.topic.subscribe(&quot;treeContextMenuRefresh/engage&quot;, function (menuItem) {
+		var node = menuItem.getTreeNode();
+		_t.reportIfDefered(controller.refreshChildren(node));
+	});
+	dojo.event.topic.subscribe(&quot;treeContextMenuCreate/engage&quot;, function (menuItem) {
+		var node = menuItem.getTreeNode();
+		var d = controller.createAndEdit(node, 0);
+		_t.reportIfDefered(d);
+	});
+	dojo.event.topic.subscribe(&quot;treeContextMenuUp/engage&quot;, function (menuItem) {
+		var node = menuItem.getTreeNode();
+		if (node.isFirstChild()) {
+			return;
+		}
+		_t.reportIfDefered(controller.move(node, node.parent, node.getParentIndex() - 1));
+	});
+	dojo.event.topic.subscribe(&quot;treeContextMenuDown/engage&quot;, function (menuItem) {
+		var node = menuItem.getTreeNode();
+		if (node.isLastChild()) {
+			return;
+		}
+		_t.reportIfDefered(controller.move(node, node.parent, node.getParentIndex() + 1));
+	});
+	dojo.event.topic.subscribe(&quot;treeContextMenuEdit/engage&quot;, function (menuItem) {
+		var node = menuItem.getTreeNode();
+		_t.reportIfDefered(controller.editLabelStart(node));
+	});
+}};
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeDeselectOnDblselect.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeDeselectOnDblselect.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeDeselectOnDblselect.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeDeselectOnDblselect&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeSelectorV3&quot;);
+dojo.deprecated(&quot;Does anyone still need this extension? (TreeDeselectOnDblselect)&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeDeselectOnDblselect&quot;, [dojo.widget.HtmlWidget], {selector:&quot;&quot;, initialize:function () {
+	this.selector = dojo.widget.byId(this.selector);
+	dojo.event.topic.subscribe(this.selector.eventNames.dblselect, this, &quot;onDblselect&quot;);
+}, onDblselect:function (message) {
+	this.selector.deselect(message.node);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeDisableWrapExtension.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeDisableWrapExtension.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeDisableWrapExtension.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,37 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeDisableWrapExtension&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeExtension&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeDisableWrapExtension&quot;, dojo.widget.TreeExtension, {templateCssString:&quot;\n/* CSS for TreeDisableWrapExtension */\n\n.TreeDisableWrap {\n\twhite-space: nowrap;\n}\n.TreeIEDisableWrap {\n\twidth: expression( 5 + firstChild.offsetWidth );\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TreeDisableWrap.css&quot;), listenTree:function (tree) {
+	var wrappingDiv = document.createElement(&quot;div&quot;);
+	var clazz = tree.classPrefix + &quot;DisableWrap&quot;;
+	if (dojo.render.html.ie) {
+		clazz = clazz + &quot; &quot; + tree.classPrefix + &quot;IEDisableWrap&quot;;
+	}
+	dojo.html.setClass(wrappingDiv, clazz);
+	var table = document.createElement(&quot;table&quot;);
+	wrappingDiv.appendChild(table);
+	var tbody = document.createElement(&quot;tbody&quot;);
+	table.appendChild(tbody);
+	var tr = document.createElement(&quot;tr&quot;);
+	tbody.appendChild(tr);
+	var td = document.createElement(&quot;td&quot;);
+	tr.appendChild(td);
+	if (tree.domNode.parentNode) {
+		tree.domNode.parentNode.replaceChild(wrappingDiv, tree.domNode);
+	}
+	td.appendChild(tree.domNode);
+	tree.domNode = wrappingDiv;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeDndControllerV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeDndControllerV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeDndControllerV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,71 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeDndControllerV3&quot;);
+dojo.require(&quot;dojo.dnd.TreeDragAndDropV3&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;Tree drag'n'drop' has lots of problems/bugs, it requires dojo drag'n'drop overhaul to work, probably in 0.5&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeDndControllerV3&quot;, [dojo.widget.HtmlWidget, dojo.widget.TreeCommon], function () {
+	this.dragSources = {};
+	this.dropTargets = {};
+	this.listenedTrees = {};
+}, {listenTreeEvents:[&quot;afterChangeTree&quot;, &quot;beforeTreeDestroy&quot;, &quot;afterAddChild&quot;], listenNodeFilter:function (elem) {
+	return elem instanceof dojo.widget.Widget;
+}, initialize:function (args) {
+	this.treeController = dojo.lang.isString(args.controller) ? dojo.widget.byId(args.controller) : args.controller;
+	if (!this.treeController) {
+		dojo.raise(&quot;treeController must be declared&quot;);
+	}
+}, onBeforeTreeDestroy:function (message) {
+	this.unlistenTree(message.source);
+}, onAfterAddChild:function (message) {
+	this.listenNode(message.child);
+}, onAfterChangeTree:function (message) {
+	if (!message.oldTree) {
+		return;
+	}
+	if (!message.newTree || !this.listenedTrees[message.newTree.widgetId]) {
+		this.processDescendants(message.node, this.listenNodeFilter, this.unlistenNode);
+	}
+	if (!this.listenedTrees[message.oldTree.widgetId]) {
+		this.processDescendants(message.node, this.listenNodeFilter, this.listenNode);
+	}
+}, listenNode:function (node) {
+	if (!node.tree.DndMode) {
+		return;
+	}
+	if (this.dragSources[node.widgetId] || this.dropTargets[node.widgetId]) {
+		return;
+	}
+	var source = null;
+	var target = null;
+	if (!node.actionIsDisabled(node.actions.MOVE)) {
+		var source = this.makeDragSource(node);
+		this.dragSources[node.widgetId] = source;
+	}
+	var target = this.makeDropTarget(node);
+	this.dropTargets[node.widgetId] = target;
+}, makeDragSource:function (node) {
+	return new dojo.dnd.TreeDragSourceV3(node.contentNode, this, node.tree.widgetId, node);
+}, makeDropTarget:function (node) {
+	return new dojo.dnd.TreeDropTargetV3(node.contentNode, this.treeController, node.tree.DndAcceptTypes, node);
+}, unlistenNode:function (node) {
+	if (this.dragSources[node.widgetId]) {
+		dojo.dnd.dragManager.unregisterDragSource(this.dragSources[node.widgetId]);
+		delete this.dragSources[node.widgetId];
+	}
+	if (this.dropTargets[node.widgetId]) {
+		dojo.dnd.dragManager.unregisterDropTarget(this.dropTargets[node.widgetId]);
+		delete this.dropTargets[node.widgetId];
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeDocIconExtension.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeDocIconExtension.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeDocIconExtension.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeDocIconExtension&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeExtension&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeDocIconExtension&quot;, [dojo.widget.TreeExtension], {templateCssString:&quot;\n/* CSS for TreeDocIconExtension */\n\n\n/* long vertical line under docIcon, connecting w/ children */\n.TreeStateChildrenYes-ExpandOpen .TreeIconContent {\n	background-image : url('../templates/images/TreeV3/i_long.gif');\n	background-repeat : no-repeat;\n	background-position: 18px 9px;\n}\n\n/* close has higher priority */\n.TreeStateChildrenYes-ExpandClosed .TreeIconContent {\n	background-image : url();\n}\n\n/* higher priotity: same length and appear after background-definition */\n.TreeStateChildrenNo-ExpandLeaf .TreeIconContent {\n	background-image : url();\n}\n\n.TreeStateChildrenNo-ExpandClosed .TreeIconContent {\n	background-image : url();\n}\n\n.TreeStateChildrenNo-ExpandOpen .TreeIconContent {\n	background-image : url();\n}\n\n\n/* highest priority */\n.TreeIconDocument {\n	background-image: url('../templates/images/TreeV3/document.gif');\n}\n\n.TreeExp!
 andOpen .TreeIconFolder {\n	background-image: url('../templates/images/TreeV3/open.gif');\n}\n\n.TreeExpandClosed .TreeIconFolder {\n	background-image: url('../templates/images/TreeV3/closed.gif');\n}\n\n/* generic class for docIcon */\n.TreeIcon {\n	width: 18px;\n	height: 18px;\n	float: left;\n	display: inline;\n	background-repeat : no-repeat;\n}\n\ndiv.TreeContent {\n	margin-left: 36px;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TreeDocIcon.css&quot;), listenTreeEvents:[&quot;afterChangeTree&quot;, &quot;afterSetFolder&quot;, &quot;afterUnsetFolder&quot;], listenNodeFilter:function (elem) {
+	return elem instanceof dojo.widget.Widget;
+}, getnodeDocType:function (node) {
+	var nodeDocType = node.getnodeDocType();
+	if (!nodeDocType) {
+		nodeDocType = node.isFolder ? &quot;Folder&quot; : &quot;Document&quot;;
+	}
+	return nodeDocType;
+}, setnodeDocTypeClass:function (node) {
+	var reg = new RegExp(&quot;(^|\\s)&quot; + node.tree.classPrefix + &quot;Icon\\w+&quot;, &quot;g&quot;);
+	var clazz = dojo.html.getClass(node.iconNode).replace(reg, &quot;&quot;) + &quot; &quot; + node.tree.classPrefix + &quot;Icon&quot; + this.getnodeDocType(node);
+	dojo.html.setClass(node.iconNode, clazz);
+}, onAfterSetFolder:function (message) {
+	if (message.source.iconNode) {
+		this.setnodeDocTypeClass(message.source);
+	}
+}, onAfterUnsetFolder:function (message) {
+	this.setnodeDocTypeClass(message.source);
+}, listenNode:function (node) {
+	node.contentIconNode = document.createElement(&quot;div&quot;);
+	var clazz = node.tree.classPrefix + &quot;IconContent&quot;;
+	if (dojo.render.html.ie) {
+		clazz = clazz + &quot; &quot; + node.tree.classPrefix + &quot;IEIconContent&quot;;
+	}
+	dojo.html.setClass(node.contentIconNode, clazz);
+	node.contentNode.parentNode.replaceChild(node.contentIconNode, node.expandNode);
+	node.iconNode = document.createElement(&quot;div&quot;);
+	dojo.html.setClass(node.iconNode, node.tree.classPrefix + &quot;Icon&quot; + &quot; &quot; + node.tree.classPrefix + &quot;Icon&quot; + this.getnodeDocType(node));
+	node.contentIconNode.appendChild(node.expandNode);
+	node.contentIconNode.appendChild(node.iconNode);
+	dojo.dom.removeNode(node.contentNode);
+	node.contentIconNode.appendChild(node.contentNode);
+}, onAfterChangeTree:function (message) {
+	var _this = this;
+	if (!message.oldTree || !this.listenedTrees[message.oldTree.widgetId]) {
+		this.processDescendants(message.node, this.listenNodeFilter, this.listenNode);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeEditor.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeEditor.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeEditor.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,67 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.RichText&quot;);
+dojo.provide(&quot;dojo.widget.TreeEditor&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeEditor&quot;, dojo.widget.HtmlWidget, {singleLineMode:false, saveOnBlur:true, sync:false, selectOnOpen:true, controller:null, node:null, richTextParams:{styleSheets:&quot;src/widget/templates/TreeEditor.css&quot;}, getContents:function () {
+	return this.richText.getEditorContent();
+}, open:function (node) {
+	if (!this.richText) {
+		this.richText = dojo.widget.createWidget(&quot;RichText&quot;, this.richTextParams, node.labelNode);
+		dojo.event.connect(&quot;around&quot;, this.richText, &quot;onKeyDown&quot;, this, &quot;richText_onKeyDown&quot;);
+		dojo.event.connect(this.richText, &quot;onBlur&quot;, this, &quot;richText_onBlur&quot;);
+		var self = this;
+		dojo.event.connect(this.richText, &quot;onLoad&quot;, function () {
+			if (self.selectOnOpen) {
+				self.richText.execCommand(&quot;selectall&quot;);
+			}
+		});
+	} else {
+		this.richText.open(node.labelNode);
+	}
+	this.node = node;
+}, close:function (save) {
+	this.richText.close(save);
+	this.node = null;
+}, isClosed:function () {
+	return !this.richText || this.richText.isClosed;
+}, execCommand:function () {
+	this.richText.execCommand.apply(this.richText, arguments);
+}, richText_onKeyDown:function (invocation) {
+	var e = invocation.args[0];
+	if ((!e) &amp;&amp; (this.object)) {
+		e = dojo.event.browser.fixEvent(this.editor.window.event);
+	}
+	switch (e.keyCode) {
+	  case e.KEY_ESCAPE:
+		this.finish(false);
+		dojo.event.browser.stopEvent(e);
+		break;
+	  case e.KEY_ENTER:
+		if (e.ctrlKey &amp;&amp; !this.singleLineMode) {
+			this.execCommand(&quot;inserthtml&quot;, &quot;&lt;br/&gt;&quot;);
+		} else {
+			this.finish(true);
+		}
+		dojo.event.browser.stopEvent(e);
+		break;
+	  default:
+		return invocation.proceed();
+	}
+}, richText_onBlur:function () {
+	this.finish(this.saveOnBlur);
+}, finish:function (save) {
+	return this.controller.editLabelFinish(save, this.sync);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeEmphasizeOnSelect.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeEmphasizeOnSelect.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeEmphasizeOnSelect.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,26 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeEmphasizeOnSelect&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeSelectorV3&quot;);
+dojo.require(&quot;dojo.html.selection&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeEmphasizeOnSelect&quot;, dojo.widget.HtmlWidget, {selector:&quot;&quot;, initialize:function () {
+	this.selector = dojo.widget.byId(this.selector);
+	dojo.event.topic.subscribe(this.selector.eventNames.select, this, &quot;onSelect&quot;);
+	dojo.event.topic.subscribe(this.selector.eventNames.deselect, this, &quot;onDeselect&quot;);
+}, onSelect:function (message) {
+	message.node.viewEmphasize();
+}, onDeselect:function (message) {
+	message.node.viewUnemphasize();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeExpandToNodeOnSelect.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeExpandToNodeOnSelect.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeExpandToNodeOnSelect.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,22 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeExpandToNodeOnSelect&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeExpandToNodeOnSelect&quot;, dojo.widget.HtmlWidget, {selector:&quot;&quot;, controller:&quot;&quot;, withSelected:false, initialize:function () {
+	this.selector = dojo.widget.byId(this.selector);
+	this.controller = dojo.widget.byId(this.controller);
+	dojo.event.topic.subscribe(this.selector.eventNames.select, this, &quot;onSelect&quot;);
+}, onSelectEvent:function (message) {
+	this.controller.expandToNode(message.node, this.withSelected);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeExtension.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeExtension.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeExtension.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeExtension&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeCommon&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeExtension&quot;, [dojo.widget.HtmlWidget, dojo.widget.TreeCommon], function () {
+	this.listenedTrees = {};
+}, {});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeLinkExtension.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeLinkExtension.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeLinkExtension.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,46 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeLinkExtension&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeExtension&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeLinkExtension&quot;, dojo.widget.TreeExtension, function () {
+	this.params = {};
+}, {listenTreeEvents:[&quot;afterChangeTree&quot;], listenTree:function (tree) {
+	dojo.widget.TreeCommon.prototype.listenTree.call(this, tree);
+	var labelNode = tree.labelNodeTemplate;
+	var newLabel = this.makeALabel();
+	dojo.html.setClass(newLabel, dojo.html.getClass(labelNode));
+	labelNode.parentNode.replaceChild(newLabel, labelNode);
+}, makeALabel:function () {
+	var newLabel = document.createElement(&quot;a&quot;);
+	for (var key in this.params) {
+		if (key in {}) {
+			continue;
+		}
+		newLabel.setAttribute(key, this.params[key]);
+	}
+	return newLabel;
+}, onAfterChangeTree:function (message) {
+	var _this = this;
+	if (!message.oldTree) {
+		this.listenNode(message.node);
+	}
+}, listenNode:function (node) {
+	for (var key in node.object) {
+		if (key in {}) {
+			continue;
+		}
+		node.labelNode.setAttribute(key, node.object[key]);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeLoadingController.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeLoadingController.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeLoadingController.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,94 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeLoadingController&quot;);
+dojo.require(&quot;dojo.widget.TreeBasicController&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeLoadingController&quot;, dojo.widget.TreeBasicController, {RPCUrl:&quot;&quot;, RPCActionParam:&quot;action&quot;, RPCErrorHandler:function (type, obj, evt) {
+	alert(&quot;RPC Error: &quot; + (obj.message || &quot;no message&quot;));
+}, preventCache:true, getRPCUrl:function (action) {
+	if (this.RPCUrl == &quot;local&quot;) {
+		var dir = document.location.href.substr(0, document.location.href.lastIndexOf(&quot;/&quot;));
+		var localUrl = dir + &quot;/&quot; + action;
+		return localUrl;
+	}
+	if (!this.RPCUrl) {
+		dojo.raise(&quot;Empty RPCUrl: can't load&quot;);
+	}
+	return this.RPCUrl + (this.RPCUrl.indexOf(&quot;?&quot;) &gt; -1 ? &quot;&amp;&quot; : &quot;?&quot;) + this.RPCActionParam + &quot;=&quot; + action;
+}, loadProcessResponse:function (node, result, callObj, callFunc) {
+	if (!dojo.lang.isUndefined(result.error)) {
+		this.RPCErrorHandler(&quot;server&quot;, result.error);
+		return false;
+	}
+	var newChildren = result;
+	if (!dojo.lang.isArray(newChildren)) {
+		dojo.raise(&quot;loadProcessResponse: Not array loaded: &quot; + newChildren);
+	}
+	for (var i = 0; i &lt; newChildren.length; i++) {
+		newChildren[i] = dojo.widget.createWidget(node.widgetType, newChildren[i]);
+		node.addChild(newChildren[i]);
+	}
+	node.state = node.loadStates.LOADED;
+	if (dojo.lang.isFunction(callFunc)) {
+		callFunc.apply(dojo.lang.isUndefined(callObj) ? this : callObj, [node, newChildren]);
+	}
+}, getInfo:function (obj) {
+	return obj.getInfo();
+}, runRPC:function (kw) {
+	var _this = this;
+	var handle = function (type, data, evt) {
+		if (kw.lock) {
+			dojo.lang.forEach(kw.lock, function (t) {
+				t.unlock();
+			});
+		}
+		if (type == &quot;load&quot;) {
+			kw.load.call(this, data);
+		} else {
+			this.RPCErrorHandler(type, data, evt);
+		}
+	};
+	if (kw.lock) {
+		dojo.lang.forEach(kw.lock, function (t) {
+			t.lock();
+		});
+	}
+	dojo.io.bind({url:kw.url, handle:dojo.lang.hitch(this, handle), mimetype:&quot;text/json&quot;, preventCache:_this.preventCache, sync:kw.sync, content:{data:dojo.json.serialize(kw.params)}});
+}, loadRemote:function (node, sync, callObj, callFunc) {
+	var _this = this;
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree)};
+	this.runRPC({url:this.getRPCUrl(&quot;getChildren&quot;), load:function (result) {
+		_this.loadProcessResponse(node, result, callObj, callFunc);
+	}, sync:sync, lock:[node], params:params});
+}, expand:function (node, sync, callObj, callFunc) {
+	if (node.state == node.loadStates.UNCHECKED &amp;&amp; node.isFolder) {
+		this.loadRemote(node, sync, this, function (node, newChildren) {
+			this.expand(node, sync, callObj, callFunc);
+		});
+		return;
+	}
+	dojo.widget.TreeBasicController.prototype.expand.apply(this, arguments);
+}, doMove:function (child, newParent, index) {
+	if (newParent.isTreeNode &amp;&amp; newParent.state == newParent.loadStates.UNCHECKED) {
+		this.loadRemote(newParent, true);
+	}
+	return dojo.widget.TreeBasicController.prototype.doMove.apply(this, arguments);
+}, doCreateChild:function (parent, index, data, callObj, callFunc) {
+	if (parent.state == parent.loadStates.UNCHECKED) {
+		this.loadRemote(parent, true);
+	}
+	return dojo.widget.TreeBasicController.prototype.doCreateChild.apply(this, arguments);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeLoadingControllerV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeLoadingControllerV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeLoadingControllerV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,250 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeLoadingControllerV3&quot;);
+dojo.require(&quot;dojo.widget.TreeBasicControllerV3&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.Deferred&quot;);
+dojo.require(&quot;dojo.DeferredList&quot;);
+dojo.declare(&quot;dojo.Error&quot;, Error, function (message, extra) {
+	this.message = message;
+	this.extra = extra;
+	this.stack = (new Error()).stack;
+});
+dojo.declare(&quot;dojo.CommunicationError&quot;, dojo.Error, function () {
+	this.name = &quot;CommunicationError&quot;;
+});
+dojo.declare(&quot;dojo.LockedError&quot;, dojo.Error, function () {
+	this.name = &quot;LockedError&quot;;
+});
+dojo.declare(&quot;dojo.FormatError&quot;, dojo.Error, function () {
+	this.name = &quot;FormatError&quot;;
+});
+dojo.declare(&quot;dojo.RpcError&quot;, dojo.Error, function () {
+	this.name = &quot;RpcError&quot;;
+});
+dojo.widget.defineWidget(&quot;dojo.widget.TreeLoadingControllerV3&quot;, dojo.widget.TreeBasicControllerV3, {RpcUrl:&quot;&quot;, RpcActionParam:&quot;action&quot;, preventCache:true, checkValidRpcResponse:function (type, obj) {
+	if (type != &quot;load&quot;) {
+		var extra = {};
+		for (var i = 1; i &lt; arguments.length; i++) {
+			dojo.lang.mixin(extra, arguments[i]);
+		}
+		return new dojo.CommunicationError(obj, extra);
+	}
+	if (typeof obj != &quot;object&quot;) {
+		return new dojo.FormatError(&quot;Wrong server answer format &quot; + (obj &amp;&amp; obj.toSource ? obj.toSource() : obj) + &quot; type &quot; + (typeof obj), obj);
+	}
+	if (!dojo.lang.isUndefined(obj.error)) {
+		return new dojo.RpcError(obj.error, obj);
+	}
+	return false;
+}, getDeferredBindHandler:function (deferred) {
+	return dojo.lang.hitch(this, function (type, obj) {
+		var error = this.checkValidRpcResponse.apply(this, arguments);
+		if (error) {
+			deferred.errback(error);
+			return;
+		}
+		deferred.callback(obj);
+	});
+}, getRpcUrl:function (action) {
+	if (this.RpcUrl == &quot;local&quot;) {
+		var dir = document.location.href.substr(0, document.location.href.lastIndexOf(&quot;/&quot;));
+		var localUrl = dir + &quot;/local/&quot; + action;
+		return localUrl;
+	}
+	if (!this.RpcUrl) {
+		dojo.raise(&quot;Empty RpcUrl: can't load&quot;);
+	}
+	var url = this.RpcUrl;
+	if (url.indexOf(&quot;/&quot;) != 0) {
+		var protocol = document.location.href.replace(/:\/\/.*/, &quot;&quot;);
+		var prefix = document.location.href.substring(protocol.length + 3);
+		if (prefix.lastIndexOf(&quot;/&quot;) != prefix.length - 1) {
+			prefix = prefix.replace(/\/[^\/]+$/, &quot;/&quot;);
+		}
+		if (prefix.lastIndexOf(&quot;/&quot;) != prefix.length - 1) {
+			prefix = prefix + &quot;/&quot;;
+		}
+		url = protocol + &quot;://&quot; + prefix + url;
+	}
+	return url + (url.indexOf(&quot;?&quot;) &gt; -1 ? &quot;&amp;&quot; : &quot;?&quot;) + this.RpcActionParam + &quot;=&quot; + action;
+}, loadProcessResponse:function (node, result) {
+	if (!dojo.lang.isArray(result)) {
+		throw new dojo.FormatError(&quot;loadProcessResponse: Not array loaded: &quot; + result);
+	}
+	node.setChildren(result);
+}, runRpc:function (kw) {
+	var _this = this;
+	var deferred = new dojo.Deferred();
+	dojo.io.bind({url:kw.url, handle:this.getDeferredBindHandler(deferred), mimetype:&quot;text/javascript&quot;, preventCache:this.preventCache, sync:kw.sync, content:{data:dojo.json.serialize(kw.params)}});
+	return deferred;
+}, loadRemote:function (node, sync) {
+	var _this = this;
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree)};
+	var deferred = this.runRpc({url:this.getRpcUrl(&quot;getChildren&quot;), sync:sync, params:params});
+	deferred.addCallback(function (res) {
+		return _this.loadProcessResponse(node, res);
+	});
+	return deferred;
+}, batchExpandTimeout:0, recurseToLevel:function (widget, level, callFunc, callObj, skipFirst, sync) {
+	if (level == 0) {
+		return;
+	}
+	if (!skipFirst) {
+		var deferred = callFunc.call(callObj, widget, sync);
+	} else {
+		var deferred = dojo.Deferred.prototype.makeCalled();
+	}
+	var _this = this;
+	var recurseOnExpand = function () {
+		var children = widget.children;
+		var deferreds = [];
+		for (var i = 0; i &lt; children.length; i++) {
+			deferreds.push(_this.recurseToLevel(children[i], level - 1, callFunc, callObj, sync));
+		}
+		return new dojo.DeferredList(deferreds);
+	};
+	deferred.addCallback(recurseOnExpand);
+	return deferred;
+}, expandToLevel:function (nodeOrTree, level, sync) {
+	return this.recurseToLevel(nodeOrTree, nodeOrTree.isTree ? level + 1 : level, this.expand, this, nodeOrTree.isTree, sync);
+}, loadToLevel:function (nodeOrTree, level, sync) {
+	return this.recurseToLevel(nodeOrTree, nodeOrTree.isTree ? level + 1 : level, this.loadIfNeeded, this, nodeOrTree.isTree, sync);
+}, loadAll:function (nodeOrTree, sync) {
+	return this.loadToLevel(nodeOrTree, Number.POSITIVE_INFINITY, sync);
+}, expand:function (node, sync) {
+	var _this = this;
+	var deferred = this.startProcessing(node);
+	deferred.addCallback(function () {
+		return _this.loadIfNeeded(node, sync);
+	});
+	deferred.addCallback(function (res) {
+		dojo.widget.TreeBasicControllerV3.prototype.expand(node);
+		return res;
+	});
+	deferred.addBoth(function (res) {
+		_this.finishProcessing(node);
+		return res;
+	});
+	return deferred;
+}, loadIfNeeded:function (node, sync) {
+	var deferred;
+	if (node.state == node.loadStates.UNCHECKED &amp;&amp; node.isFolder &amp;&amp; !node.children.length) {
+		deferred = this.loadRemote(node, sync);
+	} else {
+		deferred = new dojo.Deferred();
+		deferred.callback();
+	}
+	return deferred;
+}, runStages:function (check, prepare, make, finalize, expose, args) {
+	var _this = this;
+	if (check &amp;&amp; !check.apply(this, args)) {
+		return false;
+	}
+	var deferred = dojo.Deferred.prototype.makeCalled();
+	if (prepare) {
+		deferred.addCallback(function () {
+			return prepare.apply(_this, args);
+		});
+	}
+	if (make) {
+		deferred.addCallback(function () {
+			var res = make.apply(_this, args);
+			return res;
+		});
+	}
+	if (finalize) {
+		deferred.addBoth(function (res) {
+			finalize.apply(_this, args);
+			return res;
+		});
+	}
+	if (expose) {
+		deferred.addCallback(function (res) {
+			expose.apply(_this, args);
+			return res;
+		});
+	}
+	return deferred;
+}, startProcessing:function (nodesArray) {
+	var deferred = new dojo.Deferred();
+	var nodes = dojo.lang.isArray(nodesArray) ? nodesArray : arguments;
+	for (var i = 0; i &lt; nodes.length; i++) {
+		if (nodes[i].isLocked()) {
+			deferred.errback(new dojo.LockedError(&quot;item locked &quot; + nodes[i], nodes[i]));
+			return deferred;
+		}
+		if (nodes[i].isTreeNode) {
+			nodes[i].markProcessing();
+		}
+		nodes[i].lock();
+	}
+	deferred.callback();
+	return deferred;
+}, finishProcessing:function (nodesArray) {
+	var nodes = dojo.lang.isArray(nodesArray) ? nodesArray : arguments;
+	for (var i = 0; i &lt; nodes.length; i++) {
+		if (!nodes[i].hasLock()) {
+			continue;
+		}
+		nodes[i].unlock();
+		if (nodes[i].isTreeNode) {
+			nodes[i].unmarkProcessing();
+		}
+	}
+}, refreshChildren:function (nodeOrTree, sync) {
+	return this.runStages(null, this.prepareRefreshChildren, this.doRefreshChildren, this.finalizeRefreshChildren, this.exposeRefreshChildren, arguments);
+}, prepareRefreshChildren:function (nodeOrTree, sync) {
+	var deferred = this.startProcessing(nodeOrTree);
+	nodeOrTree.destroyChildren();
+	nodeOrTree.state = nodeOrTree.loadStates.UNCHECKED;
+	return deferred;
+}, doRefreshChildren:function (nodeOrTree, sync) {
+	return this.loadRemote(nodeOrTree, sync);
+}, finalizeRefreshChildren:function (nodeOrTree, sync) {
+	this.finishProcessing(nodeOrTree);
+}, exposeRefreshChildren:function (nodeOrTree, sync) {
+	nodeOrTree.expand();
+}, move:function (child, newParent, index) {
+	return this.runStages(this.canMove, this.prepareMove, this.doMove, this.finalizeMove, this.exposeMove, arguments);
+}, doMove:function (child, newParent, index) {
+	child.tree.move(child, newParent, index);
+	return true;
+}, prepareMove:function (child, newParent, index, sync) {
+	var deferred = this.startProcessing(newParent);
+	deferred.addCallback(dojo.lang.hitch(this, function () {
+		return this.loadIfNeeded(newParent, sync);
+	}));
+	return deferred;
+}, finalizeMove:function (child, newParent) {
+	this.finishProcessing(newParent);
+}, prepareCreateChild:function (parent, index, data, sync) {
+	var deferred = this.startProcessing(parent);
+	deferred.addCallback(dojo.lang.hitch(this, function () {
+		return this.loadIfNeeded(parent, sync);
+	}));
+	return deferred;
+}, finalizeCreateChild:function (parent) {
+	this.finishProcessing(parent);
+}, prepareClone:function (child, newParent, index, deep, sync) {
+	var deferred = this.startProcessing(child, newParent);
+	deferred.addCallback(dojo.lang.hitch(this, function () {
+		return this.loadIfNeeded(newParent, sync);
+	}));
+	return deferred;
+}, finalizeClone:function (child, newParent) {
+	this.finishProcessing(child, newParent);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeNode.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeNode.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeNode.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,246 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeNode&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeNode&quot;, dojo.widget.HtmlWidget, function () {
+	this.actionsDisabled = [];
+}, {widgetType:&quot;TreeNode&quot;, loadStates:{UNCHECKED:&quot;UNCHECKED&quot;, LOADING:&quot;LOADING&quot;, LOADED:&quot;LOADED&quot;}, actions:{MOVE:&quot;MOVE&quot;, REMOVE:&quot;REMOVE&quot;, EDIT:&quot;EDIT&quot;, ADDCHILD:&quot;ADDCHILD&quot;}, isContainer:true, lockLevel:0, templateString:(&quot;&lt;div class=\&quot;dojoTreeNode\&quot;&gt; &quot; + &quot;&lt;span treeNode=\&quot;${this.widgetId}\&quot; class=\&quot;dojoTreeNodeLabel\&quot; dojoAttachPoint=\&quot;labelNode\&quot;&gt; &quot; + &quot;\t\t&lt;span dojoAttachPoint=\&quot;titleNode\&quot; dojoAttachEvent=\&quot;onClick: onTitleClick\&quot; class=\&quot;dojoTreeNodeLabelTitle\&quot;&gt;${this.title}&lt;/span&gt; &quot; + &quot;&lt;/span&gt; &quot; + &quot;&lt;span class=\&quot;dojoTreeNodeAfterLabel\&quot; dojoAttachPoint=\&quot;afterLabelNode\&quot;&gt;${this.afterLabel}&lt;/span&gt; &quot; + &quot;&lt;div dojoAttachPoint=\&quot;containerNode\&quot; style=\&quot;display:none\&quot;&gt;&lt;/div&gt; &quot; + &quot;&lt;/div&gt;&quot;).replace(/(&gt;|&lt;)\s+/g, &quot;$1&quot;), childIconSrc:&quot;&quot;, childIconFolderSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/closed.gif&quot;), childIconDocumentSrc:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/images/Tree/document.gif&quot;), childIcon:null, isTreeNode:true, objectId:&quot;&quot;, afterLabel:&quot;&quot;, a!
 fterLabelNode:null, expandIcon:null, title:&quot;&quot;, object:&quot;&quot;, isFolder:false, labelNode:null, titleNode:null, imgs:null, expandLevel:&quot;&quot;, tree:null, depth:0, isExpanded:false, state:null, domNodeInitialized:false, isFirstChild:function () {
+	return this.getParentIndex() == 0 ? true : false;
+}, isLastChild:function () {
+	return this.getParentIndex() == this.parent.children.length - 1 ? true : false;
+}, lock:function () {
+	return this.tree.lock.apply(this, arguments);
+}, unlock:function () {
+	return this.tree.unlock.apply(this, arguments);
+}, isLocked:function () {
+	return this.tree.isLocked.apply(this, arguments);
+}, cleanLock:function () {
+	return this.tree.cleanLock.apply(this, arguments);
+}, actionIsDisabled:function (action) {
+	var _this = this;
+	var disabled = false;
+	if (this.tree.strictFolders &amp;&amp; action == this.actions.ADDCHILD &amp;&amp; !this.isFolder) {
+		disabled = true;
+	}
+	if (dojo.lang.inArray(_this.actionsDisabled, action)) {
+		disabled = true;
+	}
+	if (this.isLocked()) {
+		disabled = true;
+	}
+	return disabled;
+}, getInfo:function () {
+	var info = {widgetId:this.widgetId, objectId:this.objectId, index:this.getParentIndex(), isFolder:this.isFolder};
+	return info;
+}, initialize:function (args, frag) {
+	this.state = this.loadStates.UNCHECKED;
+	for (var i = 0; i &lt; this.actionsDisabled.length; i++) {
+		this.actionsDisabled[i] = this.actionsDisabled[i].toUpperCase();
+	}
+	this.expandLevel = parseInt(this.expandLevel);
+}, adjustDepth:function (depthDiff) {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this.children[i].adjustDepth(depthDiff);
+	}
+	this.depth += depthDiff;
+	if (depthDiff &gt; 0) {
+		for (var i = 0; i &lt; depthDiff; i++) {
+			var img = this.tree.makeBlankImg();
+			this.imgs.unshift(img);
+			dojo.html.insertBefore(this.imgs[0], this.domNode.firstChild);
+		}
+	}
+	if (depthDiff &lt; 0) {
+		for (var i = 0; i &lt; -depthDiff; i++) {
+			this.imgs.shift();
+			dojo.html.removeNode(this.domNode.firstChild);
+		}
+	}
+}, markLoading:function () {
+	this._markLoadingSavedIcon = this.expandIcon.src;
+	this.expandIcon.src = this.tree.expandIconSrcLoading;
+}, unMarkLoading:function () {
+	if (!this._markLoadingSavedIcon) {
+		return;
+	}
+	var im = new Image();
+	im.src = this.tree.expandIconSrcLoading;
+	if (this.expandIcon.src == im.src) {
+		this.expandIcon.src = this._markLoadingSavedIcon;
+	}
+	this._markLoadingSavedIcon = null;
+}, setFolder:function () {
+	dojo.event.connect(this.expandIcon, &quot;onclick&quot;, this, &quot;onTreeClick&quot;);
+	this.expandIcon.src = this.isExpanded ? this.tree.expandIconSrcMinus : this.tree.expandIconSrcPlus;
+	this.isFolder = true;
+}, createDOMNode:function (tree, depth) {
+	this.tree = tree;
+	this.depth = depth;
+	this.imgs = [];
+	for (var i = 0; i &lt; this.depth + 1; i++) {
+		var img = this.tree.makeBlankImg();
+		this.domNode.insertBefore(img, this.labelNode);
+		this.imgs.push(img);
+	}
+	this.expandIcon = this.imgs[this.imgs.length - 1];
+	this.childIcon = this.tree.makeBlankImg();
+	this.imgs.push(this.childIcon);
+	dojo.html.insertBefore(this.childIcon, this.titleNode);
+	if (this.children.length || this.isFolder) {
+		this.setFolder();
+	} else {
+		this.state = this.loadStates.LOADED;
+	}
+	dojo.event.connect(this.childIcon, &quot;onclick&quot;, this, &quot;onIconClick&quot;);
+	for (var i = 0; i &lt; this.children.length; i++) {
+		this.children[i].parent = this;
+		var node = this.children[i].createDOMNode(this.tree, this.depth + 1);
+		this.containerNode.appendChild(node);
+	}
+	if (this.children.length) {
+		this.state = this.loadStates.LOADED;
+	}
+	this.updateIcons();
+	this.domNodeInitialized = true;
+	dojo.event.topic.publish(this.tree.eventNames.createDOMNode, {source:this});
+	return this.domNode;
+}, onTreeClick:function (e) {
+	dojo.event.topic.publish(this.tree.eventNames.treeClick, {source:this, event:e});
+}, onIconClick:function (e) {
+	dojo.event.topic.publish(this.tree.eventNames.iconClick, {source:this, event:e});
+}, onTitleClick:function (e) {
+	dojo.event.topic.publish(this.tree.eventNames.titleClick, {source:this, event:e});
+}, markSelected:function () {
+	dojo.html.addClass(this.titleNode, &quot;dojoTreeNodeLabelSelected&quot;);
+}, unMarkSelected:function () {
+	dojo.html.removeClass(this.titleNode, &quot;dojoTreeNodeLabelSelected&quot;);
+}, updateExpandIcon:function () {
+	if (this.isFolder) {
+		this.expandIcon.src = this.isExpanded ? this.tree.expandIconSrcMinus : this.tree.expandIconSrcPlus;
+	} else {
+		this.expandIcon.src = this.tree.blankIconSrc;
+	}
+}, updateExpandGrid:function () {
+	if (this.tree.showGrid) {
+		if (this.depth) {
+			this.setGridImage(-2, this.isLastChild() ? this.tree.gridIconSrcL : this.tree.gridIconSrcT);
+		} else {
+			if (this.isFirstChild()) {
+				this.setGridImage(-2, this.isLastChild() ? this.tree.gridIconSrcX : this.tree.gridIconSrcY);
+			} else {
+				this.setGridImage(-2, this.isLastChild() ? this.tree.gridIconSrcL : this.tree.gridIconSrcT);
+			}
+		}
+	} else {
+		this.setGridImage(-2, this.tree.blankIconSrc);
+	}
+}, updateChildGrid:function () {
+	if ((this.depth || this.tree.showRootGrid) &amp;&amp; this.tree.showGrid) {
+		this.setGridImage(-1, (this.children.length &amp;&amp; this.isExpanded) ? this.tree.gridIconSrcP : this.tree.gridIconSrcC);
+	} else {
+		if (this.tree.showGrid &amp;&amp; !this.tree.showRootGrid) {
+			this.setGridImage(-1, (this.children.length &amp;&amp; this.isExpanded) ? this.tree.gridIconSrcZ : this.tree.blankIconSrc);
+		} else {
+			this.setGridImage(-1, this.tree.blankIconSrc);
+		}
+	}
+}, updateParentGrid:function () {
+	var parent = this.parent;
+	for (var i = 0; i &lt; this.depth; i++) {
+		var idx = this.imgs.length - (3 + i);
+		var img = (this.tree.showGrid &amp;&amp; !parent.isLastChild()) ? this.tree.gridIconSrcV : this.tree.blankIconSrc;
+		this.setGridImage(idx, img);
+		parent = parent.parent;
+	}
+}, updateExpandGridColumn:function () {
+	if (!this.tree.showGrid) {
+		return;
+	}
+	var _this = this;
+	var icon = this.isLastChild() ? this.tree.blankIconSrc : this.tree.gridIconSrcV;
+	dojo.lang.forEach(_this.getDescendants(), function (node) {
+		node.setGridImage(_this.depth, icon);
+	});
+	this.updateExpandGrid();
+}, updateIcons:function () {
+	this.imgs[0].style.display = this.tree.showRootGrid ? &quot;inline&quot; : &quot;none&quot;;
+	this.buildChildIcon();
+	this.updateExpandGrid();
+	this.updateChildGrid();
+	this.updateParentGrid();
+	dojo.profile.stop(&quot;updateIcons&quot;);
+}, buildChildIcon:function () {
+	if (this.childIconSrc) {
+		this.childIcon.src = this.childIconSrc;
+	}
+	this.childIcon.style.display = this.childIconSrc ? &quot;inline&quot; : &quot;none&quot;;
+}, setGridImage:function (idx, src) {
+	if (idx &lt; 0) {
+		idx = this.imgs.length + idx;
+	}
+	this.imgs[idx].style.backgroundImage = &quot;url(&quot; + src + &quot;)&quot;;
+}, updateIconTree:function () {
+	this.tree.updateIconTree.call(this);
+}, expand:function () {
+	if (this.isExpanded) {
+		return;
+	}
+	if (this.children.length) {
+		this.showChildren();
+	}
+	this.isExpanded = true;
+	this.updateExpandIcon();
+	dojo.event.topic.publish(this.tree.eventNames.expand, {source:this});
+}, collapse:function () {
+	if (!this.isExpanded) {
+		return;
+	}
+	this.hideChildren();
+	this.isExpanded = false;
+	this.updateExpandIcon();
+	dojo.event.topic.publish(this.tree.eventNames.collapse, {source:this});
+}, hideChildren:function () {
+	this.tree.toggleObj.hide(this.containerNode, this.toggleDuration, this.explodeSrc, dojo.lang.hitch(this, &quot;onHide&quot;));
+	if (dojo.exists(dojo, &quot;dnd.dragManager.dragObjects&quot;) &amp;&amp; dojo.dnd.dragManager.dragObjects.length) {
+		dojo.dnd.dragManager.cacheTargetLocations();
+	}
+}, showChildren:function () {
+	this.tree.toggleObj.show(this.containerNode, this.toggleDuration, this.explodeSrc, dojo.lang.hitch(this, &quot;onShow&quot;));
+	if (dojo.exists(dojo, &quot;dnd.dragManager.dragObjects&quot;) &amp;&amp; dojo.dnd.dragManager.dragObjects.length) {
+		dojo.dnd.dragManager.cacheTargetLocations();
+	}
+}, addChild:function () {
+	return this.tree.addChild.apply(this, arguments);
+}, doAddChild:function () {
+	return this.tree.doAddChild.apply(this, arguments);
+}, edit:function (props) {
+	dojo.lang.mixin(this, props);
+	if (props.title) {
+		this.titleNode.innerHTML = this.title;
+	}
+	if (props.afterLabel) {
+		this.afterLabelNode.innerHTML = this.afterLabel;
+	}
+	if (props.childIconSrc) {
+		this.buildChildIcon();
+	}
+}, removeNode:function () {
+	return this.tree.removeNode.apply(this, arguments);
+}, doRemoveNode:function () {
+	return this.tree.doRemoveNode.apply(this, arguments);
+}, toString:function () {
+	return &quot;[&quot; + this.widgetType + &quot; Tree:&quot; + this.tree + &quot; ID:&quot; + this.widgetId + &quot; Title:&quot; + this.title + &quot;]&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeNodeV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeNodeV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeNodeV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,310 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeNodeV3&quot;);
+dojo.require(&quot;dojo.html.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.TreeWithNode&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeNodeV3&quot;, [dojo.widget.HtmlWidget, dojo.widget.TreeWithNode], function () {
+	this.actionsDisabled = [];
+	this.object = {};
+}, {tryLazyInit:true, actions:{MOVE:&quot;MOVE&quot;, DETACH:&quot;DETACH&quot;, EDIT:&quot;EDIT&quot;, ADDCHILD:&quot;ADDCHILD&quot;, SELECT:&quot;SELECT&quot;}, labelClass:&quot;&quot;, contentClass:&quot;&quot;, expandNode:null, labelNode:null, nodeDocType:&quot;&quot;, selected:false, getnodeDocType:function () {
+	return this.nodeDocType;
+}, cloneProperties:[&quot;actionsDisabled&quot;, &quot;tryLazyInit&quot;, &quot;nodeDocType&quot;, &quot;objectId&quot;, &quot;object&quot;, &quot;title&quot;, &quot;isFolder&quot;, &quot;isExpanded&quot;, &quot;state&quot;], clone:function (deep) {
+	var ret = new this.constructor();
+	for (var i = 0; i &lt; this.cloneProperties.length; i++) {
+		var prop = this.cloneProperties[i];
+		ret[prop] = dojo.lang.shallowCopy(this[prop], true);
+	}
+	if (this.tree.unsetFolderOnEmpty &amp;&amp; !deep &amp;&amp; this.isFolder) {
+		ret.isFolder = false;
+	}
+	ret.toggleObj = this.toggleObj;
+	dojo.widget.manager.add(ret);
+	ret.tree = this.tree;
+	ret.buildRendering({}, {});
+	ret.initialize({}, {});
+	if (deep &amp;&amp; this.children.length) {
+		for (var i = 0; i &lt; this.children.length; i++) {
+			var child = this.children[i];
+			if (child.clone) {
+				ret.children.push(child.clone(deep));
+			} else {
+				ret.children.push(dojo.lang.shallowCopy(child, deep));
+			}
+		}
+		ret.setChildren();
+	}
+	return ret;
+}, markProcessing:function () {
+	this.markProcessingSavedClass = dojo.html.getClass(this.expandNode);
+	dojo.html.setClass(this.expandNode, this.tree.classPrefix + &quot;ExpandLoading&quot;);
+}, unmarkProcessing:function () {
+	dojo.html.setClass(this.expandNode, this.markProcessingSavedClass);
+}, buildRendering:function (args, fragment, parent) {
+	if (args.tree) {
+		this.tree = dojo.lang.isString(args.tree) ? dojo.widget.manager.getWidgetById(args.tree) : args.tree;
+	} else {
+		if (parent &amp;&amp; parent.tree) {
+			this.tree = parent.tree;
+		}
+	}
+	if (!this.tree) {
+		dojo.raise(&quot;Can't evaluate tree from arguments or parent&quot;);
+	}
+	this.domNode = this.tree.nodeTemplate.cloneNode(true);
+	this.expandNode = this.domNode.firstChild;
+	this.contentNode = this.domNode.childNodes[1];
+	this.labelNode = this.contentNode.firstChild;
+	if (this.labelClass) {
+		dojo.html.addClass(this.labelNode, this.labelClass);
+	}
+	if (this.contentClass) {
+		dojo.html.addClass(this.contentNode, this.contentClass);
+	}
+	this.domNode.widgetId = this.widgetId;
+	this.labelNode.innerHTML = this.title;
+}, isTreeNode:true, object:{}, title:&quot;&quot;, isFolder:null, contentNode:null, expandClass:&quot;&quot;, isExpanded:false, containerNode:null, getInfo:function () {
+	var info = {widgetId:this.widgetId, objectId:this.objectId, index:this.getParentIndex()};
+	return info;
+}, setFolder:function () {
+	this.isFolder = true;
+	this.viewSetExpand();
+	if (!this.containerNode) {
+		this.viewAddContainer();
+	}
+	dojo.event.topic.publish(this.tree.eventNames.afterSetFolder, {source:this});
+}, initialize:function (args, frag, parent) {
+	if (args.isFolder) {
+		this.isFolder = true;
+	}
+	if (this.children.length || this.isFolder) {
+		this.setFolder();
+	} else {
+		this.viewSetExpand();
+	}
+	for (var i = 0; i &lt; this.actionsDisabled.length; i++) {
+		this.actionsDisabled[i] = this.actionsDisabled[i].toUpperCase();
+	}
+	dojo.event.topic.publish(this.tree.eventNames.afterChangeTree, {oldTree:null, newTree:this.tree, node:this});
+}, unsetFolder:function () {
+	this.isFolder = false;
+	this.viewSetExpand();
+	dojo.event.topic.publish(this.tree.eventNames.afterUnsetFolder, {source:this});
+}, insertNode:function (parent, index) {
+	if (!index) {
+		index = 0;
+	}
+	if (index == 0) {
+		dojo.html.prependChild(this.domNode, parent.containerNode);
+	} else {
+		dojo.html.insertAfter(this.domNode, parent.children[index - 1].domNode);
+	}
+}, updateTree:function (newTree) {
+	if (this.tree === newTree) {
+		return;
+	}
+	var oldTree = this.tree;
+	dojo.lang.forEach(this.getDescendants(), function (elem) {
+		elem.tree = newTree;
+	});
+	if (oldTree.classPrefix != newTree.classPrefix) {
+		var stack = [this.domNode];
+		var elem;
+		var reg = new RegExp(&quot;(^|\\s)&quot; + oldTree.classPrefix, &quot;g&quot;);
+		while (elem = stack.pop()) {
+			for (var i = 0; i &lt; elem.childNodes.length; i++) {
+				var childNode = elem.childNodes[i];
+				if (childNode.nodeDocType != 1) {
+					continue;
+				}
+				dojo.html.setClass(childNode, dojo.html.getClass(childNode).replace(reg, &quot;$1&quot; + newTree.classPrefix));
+				stack.push(childNode);
+			}
+		}
+	}
+	var message = {oldTree:oldTree, newTree:newTree, node:this};
+	dojo.event.topic.publish(this.tree.eventNames.afterChangeTree, message);
+	dojo.event.topic.publish(newTree.eventNames.afterChangeTree, message);
+}, addedTo:function (parent, index, dontPublishEvent) {
+	if (this.tree !== parent.tree) {
+		this.updateTree(parent.tree);
+	}
+	if (parent.isTreeNode) {
+		if (!parent.isFolder) {
+			parent.setFolder();
+			parent.state = parent.loadStates.LOADED;
+		}
+	}
+	var siblingsCount = parent.children.length;
+	this.insertNode(parent, index);
+	this.viewAddLayout();
+	if (siblingsCount &gt; 1) {
+		if (index == 0 &amp;&amp; parent.children[1] instanceof dojo.widget.Widget) {
+			parent.children[1].viewUpdateLayout();
+		}
+		if (index == siblingsCount - 1 &amp;&amp; parent.children[siblingsCount - 2] instanceof dojo.widget.Widget) {
+			parent.children[siblingsCount - 2].viewUpdateLayout();
+		}
+	} else {
+		if (parent.isTreeNode) {
+			parent.viewSetHasChildren();
+		}
+	}
+	if (!dontPublishEvent) {
+		var message = {child:this, index:index, parent:parent};
+		dojo.event.topic.publish(this.tree.eventNames.afterAddChild, message);
+	}
+}, createSimple:function (args, parent) {
+	if (args.tree) {
+		var tree = args.tree;
+	} else {
+		if (parent) {
+			var tree = parent.tree;
+		} else {
+			dojo.raise(&quot;createSimple: can't evaluate tree&quot;);
+		}
+	}
+	tree = dojo.widget.byId(tree);
+	var treeNode = new tree.defaultChildWidget();
+	for (var x in args) {
+		treeNode[x] = args[x];
+	}
+	treeNode.toggleObj = dojo.lfx.toggle[treeNode.toggle.toLowerCase()] || dojo.lfx.toggle.plain;
+	dojo.widget.manager.add(treeNode);
+	treeNode.buildRendering(args, {}, parent);
+	treeNode.initialize(args, {}, parent);
+	if (treeNode.parent) {
+		delete dojo.widget.manager.topWidgets[treeNode.widgetId];
+	}
+	return treeNode;
+}, viewUpdateLayout:function () {
+	this.viewRemoveLayout();
+	this.viewAddLayout();
+}, viewAddContainer:function () {
+	this.containerNode = this.tree.containerNodeTemplate.cloneNode(true);
+	this.domNode.appendChild(this.containerNode);
+}, viewAddLayout:function () {
+	if (this.parent[&quot;isTree&quot;]) {
+		dojo.html.setClass(this.domNode, dojo.html.getClass(this.domNode) + &quot; &quot; + this.tree.classPrefix + &quot;IsRoot&quot;);
+	}
+	if (this.isLastChild()) {
+		dojo.html.setClass(this.domNode, dojo.html.getClass(this.domNode) + &quot; &quot; + this.tree.classPrefix + &quot;IsLast&quot;);
+	}
+}, viewRemoveLayout:function () {
+	dojo.html.removeClass(this.domNode, this.tree.classPrefix + &quot;IsRoot&quot;);
+	dojo.html.removeClass(this.domNode, this.tree.classPrefix + &quot;IsLast&quot;);
+}, viewGetExpandClass:function () {
+	if (this.isFolder) {
+		return this.isExpanded ? &quot;ExpandOpen&quot; : &quot;ExpandClosed&quot;;
+	} else {
+		return &quot;ExpandLeaf&quot;;
+	}
+}, viewSetExpand:function () {
+	var expand = this.tree.classPrefix + this.viewGetExpandClass();
+	var reg = new RegExp(&quot;(^|\\s)&quot; + this.tree.classPrefix + &quot;Expand\\w+&quot;, &quot;g&quot;);
+	dojo.html.setClass(this.domNode, dojo.html.getClass(this.domNode).replace(reg, &quot;&quot;) + &quot; &quot; + expand);
+	this.viewSetHasChildrenAndExpand();
+}, viewGetChildrenClass:function () {
+	return &quot;Children&quot; + (this.children.length ? &quot;Yes&quot; : &quot;No&quot;);
+}, viewSetHasChildren:function () {
+	var clazz = this.tree.classPrefix + this.viewGetChildrenClass();
+	var reg = new RegExp(&quot;(^|\\s)&quot; + this.tree.classPrefix + &quot;Children\\w+&quot;, &quot;g&quot;);
+	dojo.html.setClass(this.domNode, dojo.html.getClass(this.domNode).replace(reg, &quot;&quot;) + &quot; &quot; + clazz);
+	this.viewSetHasChildrenAndExpand();
+}, viewSetHasChildrenAndExpand:function () {
+	var clazz = this.tree.classPrefix + &quot;State&quot; + this.viewGetChildrenClass() + &quot;-&quot; + this.viewGetExpandClass();
+	var reg = new RegExp(&quot;(^|\\s)&quot; + this.tree.classPrefix + &quot;State[\\w-]+&quot;, &quot;g&quot;);
+	dojo.html.setClass(this.domNode, dojo.html.getClass(this.domNode).replace(reg, &quot;&quot;) + &quot; &quot; + clazz);
+}, viewUnfocus:function () {
+	dojo.html.removeClass(this.labelNode, this.tree.classPrefix + &quot;LabelFocused&quot;);
+}, viewFocus:function () {
+	dojo.html.addClass(this.labelNode, this.tree.classPrefix + &quot;LabelFocused&quot;);
+}, viewEmphasize:function () {
+	dojo.html.clearSelection(this.labelNode);
+	dojo.html.addClass(this.labelNode, this.tree.classPrefix + &quot;NodeEmphasized&quot;);
+}, viewUnemphasize:function () {
+	dojo.html.removeClass(this.labelNode, this.tree.classPrefix + &quot;NodeEmphasized&quot;);
+}, detach:function () {
+	if (!this.parent) {
+		return;
+	}
+	var parent = this.parent;
+	var index = this.getParentIndex();
+	this.doDetach.apply(this, arguments);
+	dojo.event.topic.publish(this.tree.eventNames.afterDetach, {child:this, parent:parent, index:index});
+}, doDetach:function () {
+	var parent = this.parent;
+	if (!parent) {
+		return;
+	}
+	var index = this.getParentIndex();
+	this.viewRemoveLayout();
+	dojo.widget.DomWidget.prototype.removeChild.call(parent, this);
+	var siblingsCount = parent.children.length;
+	if (siblingsCount &gt; 0) {
+		if (index == 0) {
+			parent.children[0].viewUpdateLayout();
+		}
+		if (index == siblingsCount) {
+			parent.children[siblingsCount - 1].viewUpdateLayout();
+		}
+	} else {
+		if (parent.isTreeNode) {
+			parent.viewSetHasChildren();
+		}
+	}
+	if (this.tree.unsetFolderOnEmpty &amp;&amp; !parent.children.length &amp;&amp; parent.isTreeNode) {
+		parent.unsetFolder();
+	}
+	this.parent = null;
+}, destroy:function () {
+	dojo.event.topic.publish(this.tree.eventNames.beforeNodeDestroy, {source:this});
+	this.detach();
+	return dojo.widget.HtmlWidget.prototype.destroy.apply(this, arguments);
+}, expand:function () {
+	if (this.isExpanded) {
+		return;
+	}
+	if (this.tryLazyInit) {
+		this.setChildren();
+		this.tryLazyInit = false;
+	}
+	this.isExpanded = true;
+	this.viewSetExpand();
+	this.showChildren();
+}, collapse:function () {
+	if (!this.isExpanded) {
+		return;
+	}
+	this.isExpanded = false;
+	this.hideChildren();
+}, hideChildren:function () {
+	this.tree.toggleObj.hide(this.containerNode, this.tree.toggleDuration, this.explodeSrc, dojo.lang.hitch(this, &quot;onHideChildren&quot;));
+}, showChildren:function () {
+	this.tree.toggleObj.show(this.containerNode, this.tree.toggleDuration, this.explodeSrc, dojo.lang.hitch(this, &quot;onShowChildren&quot;));
+}, onShowChildren:function () {
+	this.onShow();
+	dojo.event.topic.publish(this.tree.eventNames.afterExpand, {source:this});
+}, onHideChildren:function () {
+	this.viewSetExpand();
+	this.onHide();
+	dojo.event.topic.publish(this.tree.eventNames.afterCollapse, {source:this});
+}, setTitle:function (title) {
+	var oldTitle = this.title;
+	this.labelNode.innerHTML = this.title = title;
+	dojo.event.topic.publish(this.tree.eventNames.afterSetTitle, {source:this, oldTitle:oldTitle});
+}, toString:function () {
+	return &quot;[&quot; + this.widgetType + &quot;, &quot; + this.title + &quot;]&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeRPCController.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeRPCController.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeRPCController.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,72 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeRPCController&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.TreeLoadingController&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeRPCController&quot;, dojo.widget.TreeLoadingController, {doMove:function (child, newParent, index) {
+	var params = {child:this.getInfo(child), childTree:this.getInfo(child.tree), newParent:this.getInfo(newParent), newParentTree:this.getInfo(newParent.tree), newIndex:index};
+	var success;
+	this.runRPC({url:this.getRPCUrl(&quot;move&quot;), load:function (response) {
+		success = this.doMoveProcessResponse(response, child, newParent, index);
+	}, sync:true, lock:[child, newParent], params:params});
+	return success;
+}, doMoveProcessResponse:function (response, child, newParent, index) {
+	if (!dojo.lang.isUndefined(response.error)) {
+		this.RPCErrorHandler(&quot;server&quot;, response.error);
+		return false;
+	}
+	var args = [child, newParent, index];
+	return dojo.widget.TreeLoadingController.prototype.doMove.apply(this, args);
+}, doRemoveNode:function (node, callObj, callFunc) {
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree)};
+	this.runRPC({url:this.getRPCUrl(&quot;removeNode&quot;), load:function (response) {
+		this.doRemoveNodeProcessResponse(response, node, callObj, callFunc);
+	}, params:params, lock:[node]});
+}, doRemoveNodeProcessResponse:function (response, node, callObj, callFunc) {
+	if (!dojo.lang.isUndefined(response.error)) {
+		this.RPCErrorHandler(&quot;server&quot;, response.error);
+		return false;
+	}
+	if (!response) {
+		return false;
+	}
+	if (response == true) {
+		var args = [node, callObj, callFunc];
+		dojo.widget.TreeLoadingController.prototype.doRemoveNode.apply(this, args);
+		return;
+	} else {
+		if (dojo.lang.isObject(response)) {
+			dojo.raise(response.error);
+		} else {
+			dojo.raise(&quot;Invalid response &quot; + response);
+		}
+	}
+}, doCreateChild:function (parent, index, output, callObj, callFunc) {
+	var params = {tree:this.getInfo(parent.tree), parent:this.getInfo(parent), index:index, data:output};
+	this.runRPC({url:this.getRPCUrl(&quot;createChild&quot;), load:function (response) {
+		this.doCreateChildProcessResponse(response, parent, index, callObj, callFunc);
+	}, params:params, lock:[parent]});
+}, doCreateChildProcessResponse:function (response, parent, index, callObj, callFunc) {
+	if (!dojo.lang.isUndefined(response.error)) {
+		this.RPCErrorHandler(&quot;server&quot;, response.error);
+		return false;
+	}
+	if (!dojo.lang.isObject(response)) {
+		dojo.raise(&quot;Invalid result &quot; + response);
+	}
+	var args = [parent, index, response, callObj, callFunc];
+	dojo.widget.TreeLoadingController.prototype.doCreateChild.apply(this, args);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeRpcControllerV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeRpcControllerV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeRpcControllerV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,182 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeRpcControllerV3&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.TreeLoadingControllerV3&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeRpcControllerV3&quot;, dojo.widget.TreeLoadingControllerV3, {extraRpcOnEdit:false, doMove:function (child, newParent, index, sync) {
+	var params = {child:this.getInfo(child), childTree:this.getInfo(child.tree), oldParent:this.getInfo(child.parent), oldParentTree:this.getInfo(child.parent.tree), newParent:this.getInfo(newParent), newParentTree:this.getInfo(newParent.tree), newIndex:index};
+	var deferred = this.runRpc({url:this.getRpcUrl(&quot;move&quot;), sync:sync, params:params});
+	var _this = this;
+	var args = arguments;
+	deferred.addCallback(function () {
+		dojo.widget.TreeBasicControllerV3.prototype.doMove.apply(_this, args);
+	});
+	return deferred;
+}, prepareDetach:function (node, sync) {
+	var deferred = this.startProcessing(node);
+	return deferred;
+}, finalizeDetach:function (node) {
+	this.finishProcessing(node);
+}, doDetach:function (node, sync) {
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree)};
+	var deferred = this.runRpc({url:this.getRpcUrl(&quot;detach&quot;), sync:sync, params:params});
+	var _this = this;
+	var args = arguments;
+	deferred.addCallback(function () {
+		dojo.widget.TreeBasicControllerV3.prototype.doDetach.apply(_this, args);
+	});
+	return deferred;
+}, requestEditConfirmation:function (node, action, sync) {
+	if (!this.extraRpcOnEdit) {
+		return dojo.Deferred.prototype.makeCalled();
+	}
+	var _this = this;
+	var deferred = this.startProcessing(node);
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree)};
+	deferred.addCallback(function () {
+		return _this.runRpc({url:_this.getRpcUrl(action), sync:sync, params:params});
+	});
+	deferred.addBoth(function (r) {
+		_this.finishProcessing(node);
+		return r;
+	});
+	return deferred;
+}, editLabelSave:function (node, newContent, sync) {
+	var deferred = this.startProcessing(node);
+	var _this = this;
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree), newContent:newContent};
+	deferred.addCallback(function () {
+		return _this.runRpc({url:_this.getRpcUrl(&quot;editLabelSave&quot;), sync:sync, params:params});
+	});
+	deferred.addBoth(function (r) {
+		_this.finishProcessing(node);
+		return r;
+	});
+	return deferred;
+}, editLabelStart:function (node, sync) {
+	if (!this.canEditLabel(node)) {
+		return false;
+	}
+	var _this = this;
+	if (!this.editor.isClosed()) {
+		var deferred = this.editLabelFinish(this.editor.saveOnBlur, sync);
+		deferred.addCallback(function () {
+			return _this.editLabelStart(node, sync);
+		});
+		return deferred;
+	}
+	var deferred = this.requestEditConfirmation(node, &quot;editLabelStart&quot;, sync);
+	deferred.addCallback(function () {
+		_this.doEditLabelStart(node);
+	});
+	return deferred;
+}, editLabelFinish:function (save, sync) {
+	var _this = this;
+	var node = this.editor.node;
+	var deferred = dojo.Deferred.prototype.makeCalled();
+	if (!save &amp;&amp; !node.isPhantom) {
+		deferred = this.requestEditConfirmation(this.editor.node, &quot;editLabelFinishCancel&quot;, sync);
+	}
+	if (save) {
+		if (node.isPhantom) {
+			deferred = this.sendCreateChildRequest(node.parent, node.getParentIndex(), {title:this.editor.getContents()}, sync);
+		} else {
+			deferred = this.editLabelSave(node, this.editor.getContents(), sync);
+		}
+	}
+	deferred.addCallback(function (server_data) {
+		_this.doEditLabelFinish(save, server_data);
+	});
+	deferred.addErrback(function (r) {
+		_this.doEditLabelFinish(false);
+		return false;
+	});
+	return deferred;
+}, createAndEdit:function (parent, index, sync) {
+	var data = {title:parent.tree.defaultChildTitle};
+	if (!this.canCreateChild(parent, index, data)) {
+		return false;
+	}
+	if (!this.editor.isClosed()) {
+		var deferred = this.editLabelFinish(this.editor.saveOnBlur, sync);
+		deferred.addCallback(function () {
+			return _this.createAndEdit(parent, index, sync);
+		});
+		return deferred;
+	}
+	var _this = this;
+	var deferred = this.prepareCreateChild(parent, index, data, sync);
+	deferred.addCallback(function () {
+		var child = _this.makeDefaultNode(parent, index);
+		child.isPhantom = true;
+		return child;
+	});
+	deferred.addBoth(function (r) {
+		_this.finalizeCreateChild(parent, index, data, sync);
+		return r;
+	});
+	deferred.addCallback(function (child) {
+		var d = _this.exposeCreateChild(parent, index, data, sync);
+		d.addCallback(function () {
+			return child;
+		});
+		return d;
+	});
+	deferred.addCallback(function (child) {
+		_this.doEditLabelStart(child);
+		return child;
+	});
+	return deferred;
+}, prepareDestroyChild:function (node, sync) {
+	var deferred = this.startProcessing(node);
+	return deferred;
+}, finalizeDestroyChild:function (node) {
+	this.finishProcessing(node);
+}, doDestroyChild:function (node, sync) {
+	var params = {node:this.getInfo(node), tree:this.getInfo(node.tree)};
+	var deferred = this.runRpc({url:this.getRpcUrl(&quot;destroyChild&quot;), sync:sync, params:params});
+	var _this = this;
+	var args = arguments;
+	deferred.addCallback(function () {
+		dojo.widget.TreeBasicControllerV3.prototype.doDestroyChild.apply(_this, args);
+	});
+	return deferred;
+}, sendCreateChildRequest:function (parent, index, data, sync) {
+	var params = {tree:this.getInfo(parent.tree), parent:this.getInfo(parent), index:index, data:data};
+	var deferred = this.runRpc({url:this.getRpcUrl(&quot;createChild&quot;), sync:sync, params:params});
+	return deferred;
+}, doCreateChild:function (parent, index, data, sync) {
+	if (dojo.lang.isUndefined(data.title)) {
+		data.title = parent.tree.defaultChildTitle;
+	}
+	var deferred = this.sendCreateChildRequest(parent, index, data, sync);
+	var _this = this;
+	var args = arguments;
+	deferred.addCallback(function (server_data) {
+		dojo.lang.mixin(data, server_data);
+		return dojo.widget.TreeBasicControllerV3.prototype.doCreateChild.call(_this, parent, index, data);
+	});
+	return deferred;
+}, doClone:function (child, newParent, index, deep, sync) {
+	var params = {child:this.getInfo(child), oldParent:this.getInfo(child.parent), oldParentTree:this.getInfo(child.parent.tree), newParent:this.getInfo(newParent), newParentTree:this.getInfo(newParent.tree), index:index, deep:deep ? true : false, tree:this.getInfo(child.tree)};
+	var deferred = this.runRpc({url:this.getRpcUrl(&quot;clone&quot;), sync:sync, params:params});
+	var _this = this;
+	var args = arguments;
+	deferred.addCallback(function () {
+		dojo.widget.TreeBasicControllerV3.prototype.doClone.apply(_this, args);
+	});
+	return deferred;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeSelector.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeSelector.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeSelector.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,102 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeSelector&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeSelector&quot;, dojo.widget.HtmlWidget, function () {
+	this.eventNames = {};
+	this.listenedTrees = [];
+}, {widgetType:&quot;TreeSelector&quot;, selectedNode:null, dieWithTree:false, eventNamesDefault:{select:&quot;select&quot;, destroy:&quot;destroy&quot;, deselect:&quot;deselect&quot;, dblselect:&quot;dblselect&quot;}, initialize:function () {
+	for (var name in this.eventNamesDefault) {
+		if (dojo.lang.isUndefined(this.eventNames[name])) {
+			this.eventNames[name] = this.widgetId + &quot;/&quot; + this.eventNamesDefault[name];
+		}
+	}
+}, destroy:function () {
+	dojo.event.topic.publish(this.eventNames.destroy, {source:this});
+	return dojo.widget.HtmlWidget.prototype.destroy.apply(this, arguments);
+}, listenTree:function (tree) {
+	dojo.event.topic.subscribe(tree.eventNames.titleClick, this, &quot;select&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.iconClick, this, &quot;select&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.collapse, this, &quot;onCollapse&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.moveFrom, this, &quot;onMoveFrom&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.removeNode, this, &quot;onRemoveNode&quot;);
+	dojo.event.topic.subscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+	this.listenedTrees.push(tree);
+}, unlistenTree:function (tree) {
+	dojo.event.topic.unsubscribe(tree.eventNames.titleClick, this, &quot;select&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.iconClick, this, &quot;select&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.collapse, this, &quot;onCollapse&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.moveFrom, this, &quot;onMoveFrom&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.removeNode, this, &quot;onRemoveNode&quot;);
+	dojo.event.topic.unsubscribe(tree.eventNames.treeDestroy, this, &quot;onTreeDestroy&quot;);
+	for (var i = 0; i &lt; this.listenedTrees.length; i++) {
+		if (this.listenedTrees[i] === tree) {
+			this.listenedTrees.splice(i, 1);
+			break;
+		}
+	}
+}, onTreeDestroy:function (message) {
+	this.unlistenTree(message.source);
+	if (this.dieWithTree) {
+		this.destroy();
+	}
+}, onCollapse:function (message) {
+	if (!this.selectedNode) {
+		return;
+	}
+	var node = message.source;
+	var parent = this.selectedNode.parent;
+	while (parent !== node &amp;&amp; parent.isTreeNode) {
+		parent = parent.parent;
+	}
+	if (parent.isTreeNode) {
+		this.deselect();
+	}
+}, select:function (message) {
+	var node = message.source;
+	var e = message.event;
+	if (this.selectedNode === node) {
+		if (e.ctrlKey || e.shiftKey || e.metaKey) {
+			this.deselect();
+			return;
+		}
+		dojo.event.topic.publish(this.eventNames.dblselect, {node:node});
+		return;
+	}
+	if (this.selectedNode) {
+		this.deselect();
+	}
+	this.doSelect(node);
+	dojo.event.topic.publish(this.eventNames.select, {node:node});
+}, onMoveFrom:function (message) {
+	if (message.child !== this.selectedNode) {
+		return;
+	}
+	if (!dojo.lang.inArray(this.listenedTrees, message.newTree)) {
+		this.deselect();
+	}
+}, onRemoveNode:function (message) {
+	if (message.child !== this.selectedNode) {
+		return;
+	}
+	this.deselect();
+}, doSelect:function (node) {
+	node.markSelected();
+	this.selectedNode = node;
+}, deselect:function () {
+	var node = this.selectedNode;
+	this.selectedNode = null;
+	node.unMarkSelected();
+	dojo.event.topic.publish(this.eventNames.deselect, {node:node});
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeSelectorV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeSelectorV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeSelectorV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,160 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeSelectorV3&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeCommon&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeSelectorV3&quot;, [dojo.widget.HtmlWidget, dojo.widget.TreeCommon], function () {
+	this.eventNames = {};
+	this.listenedTrees = {};
+	this.selectedNodes = [];
+	this.lastClicked = {};
+}, {listenTreeEvents:[&quot;afterTreeCreate&quot;, &quot;afterCollapse&quot;, &quot;afterChangeTree&quot;, &quot;afterDetach&quot;, &quot;beforeTreeDestroy&quot;], listenNodeFilter:function (elem) {
+	return elem instanceof dojo.widget.Widget;
+}, allowedMulti:true, dblselectTimeout:300, eventNamesDefault:{select:&quot;select&quot;, deselect:&quot;deselect&quot;, dblselect:&quot;dblselect&quot;}, onAfterTreeCreate:function (message) {
+	var tree = message.source;
+	dojo.event.browser.addListener(tree.domNode, &quot;onclick&quot;, dojo.lang.hitch(this, this.onTreeClick));
+	if (dojo.render.html.ie) {
+		dojo.event.browser.addListener(tree.domNode, &quot;ondblclick&quot;, dojo.lang.hitch(this, this.onTreeDblClick));
+	}
+	dojo.event.browser.addListener(tree.domNode, &quot;onKey&quot;, dojo.lang.hitch(this, this.onKey));
+}, onKey:function (e) {
+	if (!e.key || e.ctrkKey || e.altKey) {
+		return;
+	}
+	switch (e.key) {
+	  case e.KEY_ENTER:
+		var node = this.domElement2TreeNode(e.target);
+		if (node) {
+			this.processNode(node, e);
+		}
+	}
+}, onAfterChangeTree:function (message) {
+	if (!message.oldTree &amp;&amp; message.node.selected) {
+		this.select(message.node);
+	}
+	if (!message.newTree || !this.listenedTrees[message.newTree.widgetId]) {
+		if (this.selectedNode &amp;&amp; message.node.children) {
+			this.deselectIfAncestorMatch(message.node);
+		}
+	}
+}, initialize:function (args) {
+	for (var name in this.eventNamesDefault) {
+		if (dojo.lang.isUndefined(this.eventNames[name])) {
+			this.eventNames[name] = this.widgetId + &quot;/&quot; + this.eventNamesDefault[name];
+		}
+	}
+}, onBeforeTreeDestroy:function (message) {
+	this.unlistenTree(message.source);
+}, onAfterCollapse:function (message) {
+	this.deselectIfAncestorMatch(message.source);
+}, onTreeDblClick:function (event) {
+	this.onTreeClick(event);
+}, checkSpecialEvent:function (event) {
+	return event.shiftKey || event.ctrlKey;
+}, onTreeClick:function (event) {
+	var node = this.domElement2TreeNode(event.target);
+	if (!node) {
+		return;
+	}
+	var checkLabelClick = function (domElement) {
+		return domElement === node.labelNode;
+	};
+	if (this.checkPathCondition(event.target, checkLabelClick)) {
+		this.processNode(node, event);
+	}
+}, processNode:function (node, event) {
+	if (node.actionIsDisabled(node.actions.SELECT)) {
+		return;
+	}
+	if (dojo.lang.inArray(this.selectedNodes, node)) {
+		if (this.checkSpecialEvent(event)) {
+			this.deselect(node);
+			return;
+		}
+		var _this = this;
+		var i = 0;
+		var selectedNode;
+		while (this.selectedNodes.length &gt; i) {
+			selectedNode = this.selectedNodes[i];
+			if (selectedNode !== node) {
+				this.deselect(selectedNode);
+				continue;
+			}
+			i++;
+		}
+		var wasJustClicked = this.checkRecentClick(node);
+		eventName = wasJustClicked ? this.eventNames.dblselect : this.eventNames.select;
+		if (wasJustClicked) {
+			eventName = this.eventNames.dblselect;
+			this.forgetLastClicked();
+		} else {
+			eventName = this.eventNames.select;
+			this.setLastClicked(node);
+		}
+		dojo.event.topic.publish(eventName, {node:node});
+		return;
+	}
+	this.deselectIfNoMulti(event);
+	this.setLastClicked(node);
+	this.select(node);
+}, forgetLastClicked:function () {
+	this.lastClicked = {};
+}, setLastClicked:function (node) {
+	this.lastClicked.date = new Date();
+	this.lastClicked.node = node;
+}, checkRecentClick:function (node) {
+	var diff = new Date() - this.lastClicked.date;
+	if (this.lastClicked.node &amp;&amp; diff &lt; this.dblselectTimeout) {
+		return true;
+	} else {
+		return false;
+	}
+}, deselectIfNoMulti:function (event) {
+	if (!this.checkSpecialEvent(event) || !this.allowedMulti) {
+		this.deselectAll();
+	}
+}, deselectIfAncestorMatch:function (ancestor) {
+	var _this = this;
+	dojo.lang.forEach(this.selectedNodes, function (node) {
+		var selectedNode = node;
+		node = node.parent;
+		while (node &amp;&amp; node.isTreeNode) {
+			if (node === ancestor) {
+				_this.deselect(selectedNode);
+				return;
+			}
+			node = node.parent;
+		}
+	});
+}, onAfterDetach:function (message) {
+	this.deselectIfAncestorMatch(message.child);
+}, select:function (node) {
+	var index = dojo.lang.find(this.selectedNodes, node, true);
+	if (index &gt;= 0) {
+		return;
+	}
+	this.selectedNodes.push(node);
+	dojo.event.topic.publish(this.eventNames.select, {node:node});
+}, deselect:function (node) {
+	var index = dojo.lang.find(this.selectedNodes, node, true);
+	if (index &lt; 0) {
+		return;
+	}
+	this.selectedNodes.splice(index, 1);
+	dojo.event.topic.publish(this.eventNames.deselect, {node:node});
+}, deselectAll:function () {
+	while (this.selectedNodes.length) {
+		this.deselect(this.selectedNodes[0]);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeTimeoutIterator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeTimeoutIterator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeTimeoutIterator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,88 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeTimeoutIterator&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.TreeCommon&quot;);
+dojo.declare(&quot;dojo.widget.TreeTimeoutIterator&quot;, null, function (elem, callFunc, callObj) {
+	var _this = this;
+	this.currentParent = elem;
+	this.callFunc = callFunc;
+	this.callObj = callObj ? callObj : this;
+	this.stack = [];
+}, {maxStackDepth:Number.POSITIVE_INFINITY, stack:null, currentParent:null, currentIndex:0, filterFunc:function () {
+	return true;
+}, finishFunc:function () {
+	return true;
+}, setFilter:function (func, obj) {
+	this.filterFunc = func;
+	this.filterObj = obj;
+}, setMaxLevel:function (level) {
+	this.maxStackDepth = level - 2;
+}, forward:function (timeout) {
+	var _this = this;
+	if (this.timeout) {
+		var tid = setTimeout(function () {
+			_this.processNext();
+			clearTimeout(tid);
+		}, _this.timeout);
+	} else {
+		return this.processNext();
+	}
+}, start:function (processFirst) {
+	if (processFirst) {
+		return this.callFunc.call(this.callObj, this.currentParent, this);
+	}
+	return this.processNext();
+}, processNext:function () {
+	var handler;
+	var _this = this;
+	var found;
+	var next;
+	if (this.maxStackDepth == -2) {
+		return;
+	}
+	while (true) {
+		var children = this.currentParent.children;
+		if (children &amp;&amp; children.length) {
+			do {
+				next = children[this.currentIndex];
+			} while (this.currentIndex++ &lt; children.length &amp;&amp; !(found = this.filterFunc.call(this.filterObj, next)));
+			if (found) {
+				if (next.isFolder &amp;&amp; this.stack.length &lt;= this.maxStackDepth) {
+					this.moveParent(next, 0);
+				}
+				return this.callFunc.call(this.callObj, next, this);
+			}
+		}
+		if (this.stack.length) {
+			this.popParent();
+			continue;
+		}
+		break;
+	}
+	return this.finishFunc.call(this.finishObj);
+}, setFinish:function (func, obj) {
+	this.finishFunc = func;
+	this.finishObj = obj;
+}, popParent:function () {
+	var p = this.stack.pop();
+	this.currentParent = p[0];
+	this.currentIndex = p[1];
+}, moveParent:function (nextParent, nextIndex) {
+	this.stack.push([this.currentParent, this.currentIndex]);
+	this.currentParent = nextParent;
+	this.currentIndex = nextIndex;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeToggleOnSelect.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeToggleOnSelect.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeToggleOnSelect.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeToggleOnSelect&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeToggleOnSelect&quot;, dojo.widget.HtmlWidget, {selector:&quot;&quot;, controller:&quot;&quot;, selectEvent:&quot;select&quot;, initialize:function () {
+	this.selector = dojo.widget.byId(this.selector);
+	this.controller = dojo.widget.byId(this.controller);
+	dojo.event.topic.subscribe(this.selector.eventNames[this.selectEvent], this, &quot;onSelectEvent&quot;);
+}, onSelectEvent:function (message) {
+	var node = message.node;
+	node.isExpanded ? this.controller.collapse(node) : this.controller.expand(node);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeV3.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeV3.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeV3.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,135 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.TreeV3&quot;);
+dojo.require(&quot;dojo.widget.TreeWithNode&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.TreeNodeV3&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.TreeV3&quot;, [dojo.widget.HtmlWidget, dojo.widget.TreeWithNode], function () {
+	this.eventNames = {};
+	this.DndAcceptTypes = [];
+	this.actionsDisabled = [];
+	this.listeners = [];
+	this.tree = this;
+}, {DndMode:&quot;&quot;, defaultChildWidget:null, defaultChildTitle:&quot;New Node&quot;, eagerWidgetInstantiation:false, eventNamesDefault:{afterTreeCreate:&quot;afterTreeCreate&quot;, beforeTreeDestroy:&quot;beforeTreeDestroy&quot;, beforeNodeDestroy:&quot;beforeNodeDestroy&quot;, afterChangeTree:&quot;afterChangeTree&quot;, afterSetFolder:&quot;afterSetFolder&quot;, afterUnsetFolder:&quot;afterUnsetFolder&quot;, beforeMoveFrom:&quot;beforeMoveFrom&quot;, beforeMoveTo:&quot;beforeMoveTo&quot;, afterMoveFrom:&quot;afterMoveFrom&quot;, afterMoveTo:&quot;afterMoveTo&quot;, afterAddChild:&quot;afterAddChild&quot;, afterDetach:&quot;afterDetach&quot;, afterExpand:&quot;afterExpand&quot;, beforeExpand:&quot;beforeExpand&quot;, afterSetTitle:&quot;afterSetTitle&quot;, afterCollapse:&quot;afterCollapse&quot;, beforeCollapse:&quot;beforeCollapse&quot;}, classPrefix:&quot;Tree&quot;, style:&quot;&quot;, allowAddChildToLeaf:true, unsetFolderOnEmpty:true, DndModes:{BETWEEN:1, ONTO:2}, DndAcceptTypes:&quot;&quot;, templateCssString:&quot;/* indent for all tree children excepts root */\n.TreeNode {\n	background-image : url('../templates/images/TreeV3/i.gif');\n	background-position : top left;\n	background!
 -repeat : repeat-y;\n	margin-left: 19px;\n	zoom: 1;\n}\n.TreeIsRoot {\n	margin-left: 0;\n}\n \n/* left vertical line (grid) for all nodes */\n.TreeIsLast {\n	background-image: url('../templates/images/TreeV3/i_half.gif');\n	background-repeat : no-repeat;\n}\n \n.TreeExpandOpen .TreeExpand {\n	background-image: url('../templates/images/TreeV3/expand_minus.gif');\n}\n \n/* closed is higher priority than open */\n.TreeExpandClosed .TreeExpand {\n	background-image: url('../templates/images/TreeV3/expand_plus.gif');\n}\n \n/* highest priority */\n.TreeExpandLeaf .TreeExpand {\n	background-image: url('../templates/images/TreeV3/expand_leaf.gif');\n}\n\n/* \nshould always override any expand setting, but do not touch children.\nif I add .TreeExpand .TreeExpandLoading same time and put it to top/bottom, then it will take precedence over +- for all descendants or always fail\nso I have to remove TreeExpand and process this one specifically\n*/\n\n.TreeExpandLoading   {\n	width: 18px!
 ;\n	height: 18px;\n	float: left;\n	display: inline;\n	backgrou!
 nd-repea
t : no-repeat;\n	background-image: url('../templates/images/TreeV3/expand_loading.gif');\n}\n \n.TreeContent {\n	min-height: 18px;\n	min-width: 18px;\n	margin-left:18px;\n	cursor: default;\n	/* can't make inline - multiline bugs */\n}\n\n.TreeIEContent {\n\theight: 18px;\n}\n \n.TreeExpand {\n	width: 18px;\n	height: 18px;\n	float: left;\n	display: inline;\n	background-repeat : no-repeat;\n}\n \n/* same style as IE selection */\n.TreeNodeEmphasized {\n	background-color: Highlight;\n	color: HighlightText;\n}\n \n.TreeContent .RichTextEditable, .TreeContent .RichTextEditable iframe {\n	  background-color: #ffc;\n	  color: black;\n}\n\n/* don't use :focus due to opera's lack of support on div's */\n.TreeLabelFocused {\n	  outline: 1px invert dotted;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/TreeV3.css&quot;), templateString:&quot;&lt;div style=\&quot;${this.style}\&quot;&gt;\n&lt;/div&gt;&quot;, isExpanded:true, isTree:true, createNode:function (data) {
+	data.tree = this.widgetId;
+	if (data.widgetName) {
+		return dojo.widget.createWidget(data.widgetName, data);
+	} else {
+		if (this.defaultChildWidget.prototype.createSimple) {
+			return this.defaultChildWidget.prototype.createSimple(data);
+		} else {
+			var ns = this.defaultChildWidget.prototype.ns;
+			var wt = this.defaultChildWidget.prototype.widgetType;
+			return dojo.widget.createWidget(ns + &quot;:&quot; + wt, data);
+		}
+	}
+}, makeNodeTemplate:function () {
+	var domNode = document.createElement(&quot;div&quot;);
+	dojo.html.setClass(domNode, this.classPrefix + &quot;Node &quot; + this.classPrefix + &quot;ExpandLeaf &quot; + this.classPrefix + &quot;ChildrenNo&quot;);
+	this.nodeTemplate = domNode;
+	var expandNode = document.createElement(&quot;div&quot;);
+	var clazz = this.classPrefix + &quot;Expand&quot;;
+	if (dojo.render.html.ie) {
+		clazz = clazz + &quot; &quot; + this.classPrefix + &quot;IEExpand&quot;;
+	}
+	dojo.html.setClass(expandNode, clazz);
+	this.expandNodeTemplate = expandNode;
+	var labelNode = document.createElement(&quot;span&quot;);
+	dojo.html.setClass(labelNode, this.classPrefix + &quot;Label&quot;);
+	this.labelNodeTemplate = labelNode;
+	var contentNode = document.createElement(&quot;div&quot;);
+	var clazz = this.classPrefix + &quot;Content&quot;;
+	if (dojo.render.html.ie &amp;&amp; !dojo.render.html.ie70) {
+		clazz = clazz + &quot; &quot; + this.classPrefix + &quot;IEContent&quot;;
+	}
+	dojo.html.setClass(contentNode, clazz);
+	this.contentNodeTemplate = contentNode;
+	domNode.appendChild(expandNode);
+	domNode.appendChild(contentNode);
+	contentNode.appendChild(labelNode);
+}, makeContainerNodeTemplate:function () {
+	var div = document.createElement(&quot;div&quot;);
+	div.style.display = &quot;none&quot;;
+	dojo.html.setClass(div, this.classPrefix + &quot;Container&quot;);
+	this.containerNodeTemplate = div;
+}, actions:{ADDCHILD:&quot;ADDCHILD&quot;}, getInfo:function () {
+	var info = {widgetId:this.widgetId, objectId:this.objectId};
+	return info;
+}, adjustEventNames:function () {
+	for (var name in this.eventNamesDefault) {
+		if (dojo.lang.isUndefined(this.eventNames[name])) {
+			this.eventNames[name] = this.widgetId + &quot;/&quot; + this.eventNamesDefault[name];
+		}
+	}
+}, adjustDndMode:function () {
+	var _this = this;
+	var DndMode = 0;
+	dojo.lang.forEach(this.DndMode.split(&quot;;&quot;), function (elem) {
+		var mode = _this.DndModes[dojo.string.trim(elem).toUpperCase()];
+		if (mode) {
+			DndMode = DndMode | mode;
+		}
+	});
+	this.DndMode = DndMode;
+}, destroy:function () {
+	dojo.event.topic.publish(this.tree.eventNames.beforeTreeDestroy, {source:this});
+	return dojo.widget.HtmlWidget.prototype.destroy.apply(this, arguments);
+}, initialize:function (args) {
+	this.domNode.widgetId = this.widgetId;
+	for (var i = 0; i &lt; this.actionsDisabled.length; i++) {
+		this.actionsDisabled[i] = this.actionsDisabled[i].toUpperCase();
+	}
+	if (!args.defaultChildWidget) {
+		this.defaultChildWidget = dojo.widget.TreeNodeV3;
+	} else {
+		this.defaultChildWidget = dojo.lang.getObjPathValue(args.defaultChildWidget);
+	}
+	this.adjustEventNames();
+	this.adjustDndMode();
+	this.makeNodeTemplate();
+	this.makeContainerNodeTemplate();
+	this.containerNode = this.domNode;
+	dojo.html.setClass(this.domNode, this.classPrefix + &quot;Container&quot;);
+	var _this = this;
+	dojo.lang.forEach(this.listeners, function (elem) {
+		var t = dojo.lang.isString(elem) ? dojo.widget.byId(elem) : elem;
+		t.listenTree(_this);
+	});
+}, postCreate:function () {
+	dojo.event.topic.publish(this.eventNames.afterTreeCreate, {source:this});
+}, move:function (child, newParent, index) {
+	if (!child.parent) {
+		dojo.raise(this.widgetType + &quot;: child can be moved only while it's attached&quot;);
+	}
+	var oldParent = child.parent;
+	var oldTree = child.tree;
+	var oldIndex = child.getParentIndex();
+	var newTree = newParent.tree;
+	var newParent = newParent;
+	var newIndex = index;
+	var message = {oldParent:oldParent, oldTree:oldTree, oldIndex:oldIndex, newParent:newParent, newTree:newTree, newIndex:newIndex, child:child};
+	dojo.event.topic.publish(oldTree.eventNames.beforeMoveFrom, message);
+	dojo.event.topic.publish(newTree.eventNames.beforeMoveTo, message);
+	this.doMove.apply(this, arguments);
+	dojo.event.topic.publish(oldTree.eventNames.afterMoveFrom, message);
+	dojo.event.topic.publish(newTree.eventNames.afterMoveTo, message);
+}, doMove:function (child, newParent, index) {
+	child.doDetach();
+	newParent.doAddChild(child, index);
+}, toString:function () {
+	return &quot;[&quot; + this.widgetType + &quot; ID:&quot; + this.widgetId + &quot;]&quot;;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/TreeWithNode.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/TreeWithNode.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/TreeWithNode.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,115 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.provide(&quot;dojo.widget.TreeWithNode&quot;);
+dojo.declare(&quot;dojo.widget.TreeWithNode&quot;, null, function () {
+}, {loadStates:{UNCHECKED:&quot;UNCHECKED&quot;, LOADING:&quot;LOADING&quot;, LOADED:&quot;LOADED&quot;}, state:&quot;UNCHECKED&quot;, objectId:&quot;&quot;, isContainer:true, lockLevel:0, lock:function () {
+	this.lockLevel++;
+}, unlock:function () {
+	if (!this.lockLevel) {
+		dojo.raise(this.widgetType + &quot; unlock: not locked&quot;);
+	}
+	this.lockLevel--;
+}, expandLevel:0, loadLevel:0, hasLock:function () {
+	return this.lockLevel &gt; 0;
+}, isLocked:function () {
+	var node = this;
+	while (true) {
+		if (node.lockLevel) {
+			return true;
+		}
+		if (!node.parent || node.isTree) {
+			break;
+		}
+		node = node.parent;
+	}
+	return false;
+}, flushLock:function () {
+	this.lockLevel = 0;
+}, actionIsDisabled:function (action) {
+	var disabled = false;
+	if (dojo.lang.inArray(this.actionsDisabled, action)) {
+		disabled = true;
+	}
+	if (this.isTreeNode) {
+		if (!this.tree.allowAddChildToLeaf &amp;&amp; action == this.actions.ADDCHILD &amp;&amp; !this.isFolder) {
+			disabled = true;
+		}
+	}
+	return disabled;
+}, actionIsDisabledNow:function (action) {
+	return this.actionIsDisabled(action) || this.isLocked();
+}, setChildren:function (childrenArray) {
+	if (this.isTreeNode &amp;&amp; !this.isFolder) {
+		this.setFolder();
+	} else {
+		if (this.isTreeNode) {
+			this.state = this.loadStates.LOADED;
+		}
+	}
+	var hadChildren = this.children.length &gt; 0;
+	if (hadChildren &amp;&amp; childrenArray) {
+		this.destroyChildren();
+	}
+	if (childrenArray) {
+		this.children = childrenArray;
+	}
+	var hasChildren = this.children.length &gt; 0;
+	if (this.isTreeNode &amp;&amp; hasChildren != hadChildren) {
+		this.viewSetHasChildren();
+	}
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (!(child instanceof dojo.widget.Widget)) {
+			child = this.children[i] = this.tree.createNode(child);
+			var childWidgetCreated = true;
+		} else {
+			var childWidgetCreated = false;
+		}
+		if (!child.parent) {
+			child.parent = this;
+			if (this.tree !== child.tree) {
+				child.updateTree(this.tree);
+			}
+			child.viewAddLayout();
+			this.containerNode.appendChild(child.domNode);
+			var message = {child:child, index:i, parent:this, childWidgetCreated:childWidgetCreated};
+			delete dojo.widget.manager.topWidgets[child.widgetId];
+			dojo.event.topic.publish(this.tree.eventNames.afterAddChild, message);
+		}
+		if (this.tree.eagerWidgetInstantiation) {
+			dojo.lang.forEach(this.children, function (child) {
+				child.setChildren();
+			});
+		}
+	}
+}, doAddChild:function (child, index) {
+	return this.addChild(child, index, true);
+}, addChild:function (child, index, dontPublishEvent) {
+	if (dojo.lang.isUndefined(index)) {
+		index = this.children.length;
+	}
+	if (!child.isTreeNode) {
+		dojo.raise(&quot;You can only add TreeNode widgets to a &quot; + this.widgetType + &quot; widget!&quot;);
+		return;
+	}
+	this.children.splice(index, 0, child);
+	child.parent = this;
+	child.addedTo(this, index, dontPublishEvent);
+	delete dojo.widget.manager.topWidgets[child.widgetId];
+}, onShow:function () {
+	this.animationInProgress = false;
+}, onHide:function () {
+	this.animationInProgress = false;
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/UsTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/UsTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/UsTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.UsTextbox&quot;);
+dojo.require(&quot;dojo.widget.ValidationTextbox&quot;);
+dojo.require(&quot;dojo.validate.us&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.UsStateTextbox&quot;, dojo.widget.ValidationTextbox, {mixInProperties:function (localProperties) {
+	dojo.widget.UsStateTextbox.superclass.mixInProperties.apply(this, arguments);
+	if (localProperties.allowterritories) {
+		this.flags.allowTerritories = (localProperties.allowterritories == &quot;true&quot;);
+	}
+	if (localProperties.allowmilitary) {
+		this.flags.allowMilitary = (localProperties.allowmilitary == &quot;true&quot;);
+	}
+}, isValid:function () {
+	return dojo.validate.us.isState(this.textbox.value, this.flags);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.UsZipTextbox&quot;, dojo.widget.ValidationTextbox, {isValid:function () {
+	return dojo.validate.us.isZipCode(this.textbox.value);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.UsSocialSecurityNumberTextbox&quot;, dojo.widget.ValidationTextbox, {isValid:function () {
+	return dojo.validate.us.isSocialSecurityNumber(this.textbox.value);
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.UsPhoneNumberTextbox&quot;, dojo.widget.ValidationTextbox, {isValid:function () {
+	return dojo.validate.us.isPhoneNumber(this.textbox.value);
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/ValidationTextbox.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/ValidationTextbox.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/ValidationTextbox.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,124 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.ValidationTextbox&quot;);
+dojo.require(&quot;dojo.widget.Textbox&quot;);
+dojo.require(&quot;dojo.i18n.common&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.ValidationTextbox&quot;, dojo.widget.Textbox, function () {
+	this.flags = {};
+}, {required:false, rangeClass:&quot;range&quot;, invalidClass:&quot;invalid&quot;, missingClass:&quot;missing&quot;, classPrefix:&quot;dojoValidate&quot;, size:&quot;&quot;, maxlength:&quot;&quot;, promptMessage:&quot;&quot;, invalidMessage:&quot;&quot;, missingMessage:&quot;&quot;, rangeMessage:&quot;&quot;, listenOnKeyPress:true, htmlfloat:&quot;none&quot;, lastCheckedValue:null, templateString:&quot;&lt;span style='float:${this.htmlfloat};'&gt;\n\t&lt;input dojoAttachPoint='textbox' type='${this.type}' dojoAttachEvent='onblur;onfocus;onkeyup'\n\t\tid='${this.widgetId}' name='${this.name}' size='${this.size}' maxlength='${this.maxlength}'\n\t\tclass='${this.className}' style=''&gt;\n\t&lt;span dojoAttachPoint='invalidSpan' class='${this.invalidClass}'&gt;${this.messages.invalidMessage}&lt;/span&gt;\n\t&lt;span dojoAttachPoint='missingSpan' class='${this.missingClass}'&gt;${this.messages.missingMessage}&lt;/span&gt;\n\t&lt;span dojoAttachPoint='rangeSpan' class='${this.rangeClass}'&gt;${this.messages.rangeMessage}&lt;/span&gt;\n&lt;/span&gt;\n&quot;, templateCssString:&quot;.dojoValidateEmpty{\n\tbackground-color: #00FFFF;\n}\n.dojoValidateValid{\!
 n\tbackground-color: #cfc;\n}\n.dojoValidateInvalid{\n\tbackground-color: #fcc;\n}\n.dojoValidateRange{\n\tbackground-color: #ccf;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Validate.css&quot;), invalidSpan:null, missingSpan:null, rangeSpan:null, getValue:function () {
+	return this.textbox.value;
+}, setValue:function (value) {
+	this.textbox.value = value;
+	this.update();
+}, isValid:function () {
+	return true;
+}, isInRange:function () {
+	return true;
+}, isEmpty:function () {
+	return (/^\s*$/.test(this.textbox.value));
+}, isMissing:function () {
+	return (this.required &amp;&amp; this.isEmpty());
+}, update:function () {
+	this.lastCheckedValue = this.textbox.value;
+	this.missingSpan.style.display = &quot;none&quot;;
+	this.invalidSpan.style.display = &quot;none&quot;;
+	this.rangeSpan.style.display = &quot;none&quot;;
+	var empty = this.isEmpty();
+	var valid = true;
+	if (this.promptMessage != this.textbox.value) {
+		valid = this.isValid();
+	}
+	var missing = this.isMissing();
+	if (missing) {
+		this.missingSpan.style.display = &quot;&quot;;
+	} else {
+		if (!empty &amp;&amp; !valid) {
+			this.invalidSpan.style.display = &quot;&quot;;
+		} else {
+			if (!empty &amp;&amp; !this.isInRange()) {
+				this.rangeSpan.style.display = &quot;&quot;;
+			}
+		}
+	}
+	this.highlight();
+}, updateClass:function (className) {
+	var pre = this.classPrefix;
+	dojo.html.removeClass(this.textbox, pre + &quot;Empty&quot;);
+	dojo.html.removeClass(this.textbox, pre + &quot;Valid&quot;);
+	dojo.html.removeClass(this.textbox, pre + &quot;Invalid&quot;);
+	dojo.html.addClass(this.textbox, pre + className);
+}, highlight:function () {
+	if (this.isEmpty()) {
+		this.updateClass(&quot;Empty&quot;);
+	} else {
+		if (this.isValid() &amp;&amp; this.isInRange()) {
+			this.updateClass(&quot;Valid&quot;);
+		} else {
+			if (this.textbox.value != this.promptMessage) {
+				this.updateClass(&quot;Invalid&quot;);
+			} else {
+				this.updateClass(&quot;Empty&quot;);
+			}
+		}
+	}
+}, onfocus:function (evt) {
+	if (!this.listenOnKeyPress) {
+		this.updateClass(&quot;Empty&quot;);
+	}
+}, onblur:function (evt) {
+	this.filter();
+	this.update();
+}, onkeyup:function (evt) {
+	if (this.listenOnKeyPress) {
+		this.update();
+	} else {
+		if (this.textbox.value != this.lastCheckedValue) {
+			this.updateClass(&quot;Empty&quot;);
+		}
+	}
+}, postMixInProperties:function (localProperties, frag) {
+	dojo.widget.ValidationTextbox.superclass.postMixInProperties.apply(this, arguments);
+	this.messages = dojo.i18n.getLocalization(&quot;dojo.widget&quot;, &quot;validate&quot;, this.lang);
+	dojo.lang.forEach([&quot;invalidMessage&quot;, &quot;missingMessage&quot;, &quot;rangeMessage&quot;], function (prop) {
+		if (this[prop]) {
+			this.messages[prop] = this[prop];
+		}
+	}, this);
+}, fillInTemplate:function () {
+	dojo.widget.ValidationTextbox.superclass.fillInTemplate.apply(this, arguments);
+	this.textbox.isValid = function () {
+		this.isValid.call(this);
+	};
+	this.textbox.isMissing = function () {
+		this.isMissing.call(this);
+	};
+	this.textbox.isInRange = function () {
+		this.isInRange.call(this);
+	};
+	dojo.html.setClass(this.invalidSpan, this.invalidClass);
+	this.update();
+	this.filter();
+	if (dojo.render.html.ie) {
+		dojo.html.addClass(this.domNode, &quot;ie&quot;);
+	}
+	if (dojo.render.html.moz) {
+		dojo.html.addClass(this.domNode, &quot;moz&quot;);
+	}
+	if (dojo.render.html.opera) {
+		dojo.html.addClass(this.domNode, &quot;opera&quot;);
+	}
+	if (dojo.render.html.safari) {
+		dojo.html.addClass(this.domNode, &quot;safari&quot;);
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/Widget.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Widget.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Widget.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,312 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Widget&quot;);
+dojo.require(&quot;dojo.lang.func&quot;);
+dojo.require(&quot;dojo.lang.array&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.lang.declare&quot;);
+dojo.require(&quot;dojo.ns&quot;);
+dojo.require(&quot;dojo.widget.Manager&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.a11y&quot;);
+dojo.declare(&quot;dojo.widget.Widget&quot;, null, function () {
+	this.children = [];
+	this.extraArgs = {};
+}, {parent:null, isTopLevel:false, disabled:false, isContainer:false, widgetId:&quot;&quot;, widgetType:&quot;Widget&quot;, ns:&quot;dojo&quot;, getNamespacedType:function () {
+	return (this.ns ? this.ns + &quot;:&quot; + this.widgetType : this.widgetType).toLowerCase();
+}, toString:function () {
+	return &quot;[Widget &quot; + this.getNamespacedType() + &quot;, &quot; + (this.widgetId || &quot;NO ID&quot;) + &quot;]&quot;;
+}, repr:function () {
+	return this.toString();
+}, enable:function () {
+	this.disabled = false;
+}, disable:function () {
+	this.disabled = true;
+}, onResized:function () {
+	this.notifyChildrenOfResize();
+}, notifyChildrenOfResize:function () {
+	for (var i = 0; i &lt; this.children.length; i++) {
+		var child = this.children[i];
+		if (child.onResized) {
+			child.onResized();
+		}
+	}
+}, create:function (args, fragment, parent, ns) {
+	if (ns) {
+		this.ns = ns;
+	}
+	this.satisfyPropertySets(args, fragment, parent);
+	this.mixInProperties(args, fragment, parent);
+	this.postMixInProperties(args, fragment, parent);
+	dojo.widget.manager.add(this);
+	this.buildRendering(args, fragment, parent);
+	this.initialize(args, fragment, parent);
+	this.postInitialize(args, fragment, parent);
+	this.postCreate(args, fragment, parent);
+	return this;
+}, destroy:function (finalize) {
+	if (this.parent) {
+		this.parent.removeChild(this);
+	}
+	this.destroyChildren();
+	this.uninitialize();
+	this.destroyRendering(finalize);
+	dojo.widget.manager.removeById(this.widgetId);
+}, destroyChildren:function () {
+	var widget;
+	var i = 0;
+	while (this.children.length &gt; i) {
+		widget = this.children[i];
+		if (widget instanceof dojo.widget.Widget) {
+			this.removeChild(widget);
+			widget.destroy();
+			continue;
+		}
+		i++;
+	}
+}, getChildrenOfType:function (type, recurse) {
+	var ret = [];
+	var isFunc = dojo.lang.isFunction(type);
+	if (!isFunc) {
+		type = type.toLowerCase();
+	}
+	for (var x = 0; x &lt; this.children.length; x++) {
+		if (isFunc) {
+			if (this.children[x] instanceof type) {
+				ret.push(this.children[x]);
+			}
+		} else {
+			if (this.children[x].widgetType.toLowerCase() == type) {
+				ret.push(this.children[x]);
+			}
+		}
+		if (recurse) {
+			ret = ret.concat(this.children[x].getChildrenOfType(type, recurse));
+		}
+	}
+	return ret;
+}, getDescendants:function () {
+	var result = [];
+	var stack = [this];
+	var elem;
+	while ((elem = stack.pop())) {
+		result.push(elem);
+		if (elem.children) {
+			dojo.lang.forEach(elem.children, function (elem) {
+				stack.push(elem);
+			});
+		}
+	}
+	return result;
+}, isFirstChild:function () {
+	return this === this.parent.children[0];
+}, isLastChild:function () {
+	return this === this.parent.children[this.parent.children.length - 1];
+}, satisfyPropertySets:function (args) {
+	return args;
+}, mixInProperties:function (args, frag) {
+	if ((args[&quot;fastMixIn&quot;]) || (frag[&quot;fastMixIn&quot;])) {
+		for (var x in args) {
+			this[x] = args[x];
+		}
+		return;
+	}
+	var undef;
+	var lcArgs = dojo.widget.lcArgsCache[this.widgetType];
+	if (lcArgs == null) {
+		lcArgs = {};
+		for (var y in this) {
+			lcArgs[((new String(y)).toLowerCase())] = y;
+		}
+		dojo.widget.lcArgsCache[this.widgetType] = lcArgs;
+	}
+	var visited = {};
+	for (var x in args) {
+		if (!this[x]) {
+			var y = lcArgs[(new String(x)).toLowerCase()];
+			if (y) {
+				args[y] = args[x];
+				x = y;
+			}
+		}
+		if (visited[x]) {
+			continue;
+		}
+		visited[x] = true;
+		if ((typeof this[x]) != (typeof undef)) {
+			if (typeof args[x] != &quot;string&quot;) {
+				this[x] = args[x];
+			} else {
+				if (dojo.lang.isString(this[x])) {
+					this[x] = args[x];
+				} else {
+					if (dojo.lang.isNumber(this[x])) {
+						this[x] = new Number(args[x]);
+					} else {
+						if (dojo.lang.isBoolean(this[x])) {
+							this[x] = (args[x].toLowerCase() == &quot;false&quot;) ? false : true;
+						} else {
+							if (dojo.lang.isFunction(this[x])) {
+								if (args[x].search(/[^\w\.]+/i) == -1) {
+									this[x] = dojo.evalObjPath(args[x], false);
+								} else {
+									var tn = dojo.lang.nameAnonFunc(new Function(args[x]), this);
+									dojo.event.kwConnect({srcObj:this, srcFunc:x, adviceObj:this, adviceFunc:tn});
+								}
+							} else {
+								if (dojo.lang.isArray(this[x])) {
+									this[x] = args[x].split(&quot;;&quot;);
+								} else {
+									if (this[x] instanceof Date) {
+										this[x] = new Date(Number(args[x]));
+									} else {
+										if (typeof this[x] == &quot;object&quot;) {
+											if (this[x] instanceof dojo.uri.Uri) {
+												this[x] = dojo.uri.dojoUri(args[x]);
+											} else {
+												var pairs = args[x].split(&quot;;&quot;);
+												for (var y = 0; y &lt; pairs.length; y++) {
+													var si = pairs[y].indexOf(&quot;:&quot;);
+													if ((si != -1) &amp;&amp; (pairs[y].length &gt; si)) {
+														this[x][pairs[y].substr(0, si).replace(/^\s+|\s+$/g, &quot;&quot;)] = pairs[y].substr(si + 1);
+													}
+												}
+											}
+										} else {
+											this[x] = args[x];
+										}
+									}
+								}
+							}
+						}
+					}
+				}
+			}
+		} else {
+			this.extraArgs[x.toLowerCase()] = args[x];
+		}
+	}
+}, postMixInProperties:function (args, frag, parent) {
+}, initialize:function (args, frag, parent) {
+	return false;
+}, postInitialize:function (args, frag, parent) {
+	return false;
+}, postCreate:function (args, frag, parent) {
+	return false;
+}, uninitialize:function () {
+	return false;
+}, buildRendering:function (args, frag, parent) {
+	dojo.unimplemented(&quot;dojo.widget.Widget.buildRendering, on &quot; + this.toString() + &quot;, &quot;);
+	return false;
+}, destroyRendering:function () {
+	dojo.unimplemented(&quot;dojo.widget.Widget.destroyRendering&quot;);
+	return false;
+}, addedTo:function (parent) {
+}, addChild:function (child) {
+	dojo.unimplemented(&quot;dojo.widget.Widget.addChild&quot;);
+	return false;
+}, removeChild:function (widget) {
+	for (var x = 0; x &lt; this.children.length; x++) {
+		if (this.children[x] === widget) {
+			this.children.splice(x, 1);
+			widget.parent = null;
+			break;
+		}
+	}
+	return widget;
+}, getPreviousSibling:function () {
+	var idx = this.getParentIndex();
+	if (idx &lt;= 0) {
+		return null;
+	}
+	return this.parent.children[idx - 1];
+}, getSiblings:function () {
+	return this.parent.children;
+}, getParentIndex:function () {
+	return dojo.lang.indexOf(this.parent.children, this, true);
+}, getNextSibling:function () {
+	var idx = this.getParentIndex();
+	if (idx == this.parent.children.length - 1) {
+		return null;
+	}
+	if (idx &lt; 0) {
+		return null;
+	}
+	return this.parent.children[idx + 1];
+}});
+dojo.widget.lcArgsCache = {};
+dojo.widget.tags = {};
+dojo.widget.tags.addParseTreeHandler = function (type) {
+	dojo.deprecated(&quot;addParseTreeHandler&quot;, &quot;. ParseTreeHandlers are now reserved for components. Any unfiltered DojoML tag without a ParseTreeHandler is assumed to be a widget&quot;, &quot;0.5&quot;);
+};
+dojo.widget.tags[&quot;dojo:propertyset&quot;] = function (fragment, widgetParser, parentComp) {
+	var properties = widgetParser.parseProperties(fragment[&quot;dojo:propertyset&quot;]);
+};
+dojo.widget.tags[&quot;dojo:connect&quot;] = function (fragment, widgetParser, parentComp) {
+	var properties = widgetParser.parseProperties(fragment[&quot;dojo:connect&quot;]);
+};
+dojo.widget.buildWidgetFromParseTree = function (type, frag, parser, parentComp, insertionIndex, localProps) {
+	dojo.a11y.setAccessibleMode();
+	var stype = type.split(&quot;:&quot;);
+	stype = (stype.length == 2) ? stype[1] : type;
+	var localProperties = localProps || parser.parseProperties(frag[frag[&quot;ns&quot;] + &quot;:&quot; + stype]);
+	var twidget = dojo.widget.manager.getImplementation(stype, null, null, frag[&quot;ns&quot;]);
+	if (!twidget) {
+		throw new Error(&quot;cannot find \&quot;&quot; + type + &quot;\&quot; widget&quot;);
+	} else {
+		if (!twidget.create) {
+			throw new Error(&quot;\&quot;&quot; + type + &quot;\&quot; widget object has no \&quot;create\&quot; method and does not appear to implement *Widget&quot;);
+		}
+	}
+	localProperties[&quot;dojoinsertionindex&quot;] = insertionIndex;
+	var ret = twidget.create(localProperties, frag, parentComp, frag[&quot;ns&quot;]);
+	return ret;
+};
+dojo.widget.defineWidget = function (widgetClass, renderer, superclasses, init, props) {
+	if (dojo.lang.isString(arguments[3])) {
+		dojo.widget._defineWidget(arguments[0], arguments[3], arguments[1], arguments[4], arguments[2]);
+	} else {
+		var args = [arguments[0]], p = 3;
+		if (dojo.lang.isString(arguments[1])) {
+			args.push(arguments[1], arguments[2]);
+		} else {
+			args.push(&quot;&quot;, arguments[1]);
+			p = 2;
+		}
+		if (dojo.lang.isFunction(arguments[p])) {
+			args.push(arguments[p], arguments[p + 1]);
+		} else {
+			args.push(null, arguments[p]);
+		}
+		dojo.widget._defineWidget.apply(this, args);
+	}
+};
+dojo.widget.defineWidget.renderers = &quot;html|svg|vml&quot;;
+dojo.widget._defineWidget = function (widgetClass, renderer, superclasses, init, props) {
+	var module = widgetClass.split(&quot;.&quot;);
+	var type = module.pop();
+	var regx = &quot;\\.(&quot; + (renderer ? renderer + &quot;|&quot; : &quot;&quot;) + dojo.widget.defineWidget.renderers + &quot;)\\.&quot;;
+	var r = widgetClass.search(new RegExp(regx));
+	module = (r &lt; 0 ? module.join(&quot;.&quot;) : widgetClass.substr(0, r));
+	dojo.widget.manager.registerWidgetPackage(module);
+	var pos = module.indexOf(&quot;.&quot;);
+	var nsName = (pos &gt; -1) ? module.substring(0, pos) : module;
+	props = (props) || {};
+	props.widgetType = type;
+	if ((!init) &amp;&amp; (props[&quot;classConstructor&quot;])) {
+		init = props.classConstructor;
+		delete props.classConstructor;
+	}
+	dojo.declare(widgetClass, superclasses, init, props);
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/Wizard.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/Wizard.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/Wizard.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,127 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.Wizard&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.LayoutContainer&quot;);
+dojo.require(&quot;dojo.widget.ContentPane&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.WizardContainer&quot;, dojo.widget.LayoutContainer, {templateString:&quot;&lt;div class=\&quot;WizardContainer\&quot; dojoAttachPoint=\&quot;wizardNode\&quot;&gt;\n	&lt;div class=\&quot;WizardText\&quot; dojoAttachPoint=\&quot;wizardPanelContainerNode\&quot;&gt;\n	&lt;/div&gt;\n	&lt;div class=\&quot;WizardButtonHolder\&quot; dojoAttachPoint=\&quot;wizardControlContainerNode\&quot;&gt;\n		&lt;input class=\&quot;WizardButton\&quot; type=\&quot;button\&quot; dojoAttachPoint=\&quot;previousButton\&quot;/&gt;\n		&lt;input class=\&quot;WizardButton\&quot; type=\&quot;button\&quot; dojoAttachPoint=\&quot;nextButton\&quot;/&gt;\n		&lt;input class=\&quot;WizardButton\&quot; type=\&quot;button\&quot; dojoAttachPoint=\&quot;doneButton\&quot; style=\&quot;display:none\&quot;/&gt;\n		&lt;input class=\&quot;WizardButton\&quot; type=\&quot;button\&quot; dojoAttachPoint=\&quot;cancelButton\&quot;/&gt;\n	&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.WizardContainer {\n\tbackground: #EEEEEE;\n\tborder: #798EC5 1px solid;\n\tpadding: 2px;\n}\n\n.WizardTitle {\n\tcolor: #003366;\n\tpadding: 8px 5px 15px 2px;\n\tfont-weight: bold;\n\tfont-size: x-small;\n\tfont-style: normal;\n\tfont-family: Verdana, Arial,!
  Helvetica;\n\ttext-align: left;\n}\n\n.WizardText {\n\tcolor: #000033;\n\tfont-weight: normal;\n\tfont-size: xx-small;\n\tfont-family: Verdana, Arial, Helvetica;\n\tpadding: 2 50; text-align: justify;\n}\n\n.WizardLightText {\n\tcolor: #666666;\n\tfont-weight: normal;\n\tfont-size: xx-small;\n\tfont-family: verdana, arial, helvetica;\n\tpadding: 2px 50px;\n\ttext-align: justify;\n}\n\n.WizardButtonHolder {\n\ttext-align: right;\n\tpadding: 10px 5px;\n}\n\n.WizardButton {\n\tcolor: #ffffff;\n\tbackground: #798EC5;\n\tfont-size: xx-small;\n\tfont-family: verdana, arial, helvetica, sans-serif;\n\tborder-right: #000000 1px solid;\n\tborder-bottom: #000000 1px solid;\n\tborder-left: #666666 1px solid;\n\tborder-top: #666666 1px solid;\n\tpadding-right: 4px;\n\tpadding-left: 4px;\n\ttext-decoration: none; height: 18px;\n}\n\n.WizardButton:hover {\n\tcursor: pointer;\n}\n\n.WizardButtonDisabled {\n\tcolor: #eeeeee;\n\tbackground-color: #999999;\n\tfont-size: xx-small;\n\tFONT-FAM!
 ILY: verdana, arial, helvetica, sans-serif;\n\tborder-right: #!
 000000 1
px solid;\n\tborder-bottom: #000000 1px solid;\n\tborder-left: #798EC5 1px solid;\n\tborder-top: #798EC5 1px solid;\n\tpadding-right: 4px;\n\tpadding-left: 4px;\n\ttext-decoration: none;\n\theight: 18px;\n}\n\n\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;templates/Wizard.css&quot;), selected:null, nextButtonLabel:&quot;next&quot;, previousButtonLabel:&quot;previous&quot;, cancelButtonLabel:&quot;cancel&quot;, doneButtonLabel:&quot;done&quot;, cancelFunction:&quot;&quot;, hideDisabledButtons:false, fillInTemplate:function (args, frag) {
+	dojo.event.connect(this.nextButton, &quot;onclick&quot;, this, &quot;_onNextButtonClick&quot;);
+	dojo.event.connect(this.previousButton, &quot;onclick&quot;, this, &quot;_onPreviousButtonClick&quot;);
+	if (this.cancelFunction) {
+		dojo.event.connect(this.cancelButton, &quot;onclick&quot;, this.cancelFunction);
+	} else {
+		this.cancelButton.style.display = &quot;none&quot;;
+	}
+	dojo.event.connect(this.doneButton, &quot;onclick&quot;, this, &quot;done&quot;);
+	this.nextButton.value = this.nextButtonLabel;
+	this.previousButton.value = this.previousButtonLabel;
+	this.cancelButton.value = this.cancelButtonLabel;
+	this.doneButton.value = this.doneButtonLabel;
+}, _checkButtons:function () {
+	var lastStep = !this.hasNextPanel();
+	this.nextButton.disabled = lastStep;
+	this._setButtonClass(this.nextButton);
+	if (this.selected.doneFunction) {
+		this.doneButton.style.display = &quot;&quot;;
+		if (lastStep) {
+			this.nextButton.style.display = &quot;none&quot;;
+		}
+	} else {
+		this.doneButton.style.display = &quot;none&quot;;
+	}
+	this.previousButton.disabled = ((!this.hasPreviousPanel()) || (!this.selected.canGoBack));
+	this._setButtonClass(this.previousButton);
+}, _setButtonClass:function (button) {
+	if (!this.hideDisabledButtons) {
+		button.style.display = &quot;&quot;;
+		dojo.html.setClass(button, button.disabled ? &quot;WizardButtonDisabled&quot; : &quot;WizardButton&quot;);
+	} else {
+		button.style.display = button.disabled ? &quot;none&quot; : &quot;&quot;;
+	}
+}, registerChild:function (panel, insertionIndex) {
+	dojo.widget.WizardContainer.superclass.registerChild.call(this, panel, insertionIndex);
+	this.wizardPanelContainerNode.appendChild(panel.domNode);
+	panel.hide();
+	if (!this.selected) {
+		this.onSelected(panel);
+	}
+	this._checkButtons();
+}, onSelected:function (panel) {
+	if (this.selected) {
+		if (this.selected._checkPass()) {
+			this.selected.hide();
+		} else {
+			return;
+		}
+	}
+	panel.show();
+	this.selected = panel;
+}, getPanels:function () {
+	return this.getChildrenOfType(&quot;WizardPane&quot;, false);
+}, selectedIndex:function () {
+	if (this.selected) {
+		return dojo.lang.indexOf(this.getPanels(), this.selected);
+	}
+	return -1;
+}, _onNextButtonClick:function () {
+	var selectedIndex = this.selectedIndex();
+	if (selectedIndex &gt; -1) {
+		var childPanels = this.getPanels();
+		if (childPanels[selectedIndex + 1]) {
+			this.onSelected(childPanels[selectedIndex + 1]);
+		}
+	}
+	this._checkButtons();
+}, _onPreviousButtonClick:function () {
+	var selectedIndex = this.selectedIndex();
+	if (selectedIndex &gt; -1) {
+		var childPanels = this.getPanels();
+		if (childPanels[selectedIndex - 1]) {
+			this.onSelected(childPanels[selectedIndex - 1]);
+		}
+	}
+	this._checkButtons();
+}, hasNextPanel:function () {
+	var selectedIndex = this.selectedIndex();
+	return (selectedIndex &lt; (this.getPanels().length - 1));
+}, hasPreviousPanel:function () {
+	var selectedIndex = this.selectedIndex();
+	return (selectedIndex &gt; 0);
+}, done:function () {
+	this.selected.done();
+}});
+dojo.widget.defineWidget(&quot;dojo.widget.WizardPane&quot;, dojo.widget.ContentPane, {canGoBack:true, passFunction:&quot;&quot;, doneFunction:&quot;&quot;, postMixInProperties:function (args, frag) {
+	if (this.passFunction) {
+		this.passFunction = dj_global[this.passFunction];
+	}
+	if (this.doneFunction) {
+		this.doneFunction = dj_global[this.doneFunction];
+	}
+	dojo.widget.WizardPane.superclass.postMixInProperties.apply(this, arguments);
+}, _checkPass:function () {
+	if (this.passFunction &amp;&amp; dojo.lang.isFunction(this.passFunction)) {
+		var failMessage = this.passFunction();
+		if (failMessage) {
+			alert(failMessage);
+			return false;
+		}
+	}
+	return true;
+}, done:function () {
+	if (this.doneFunction &amp;&amp; dojo.lang.isFunction(this.doneFunction)) {
+		this.doneFunction();
+	}
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/YahooMap.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/YahooMap.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/YahooMap.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,145 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.YahooMap&quot;);
+dojo.require(&quot;dojo.event.*&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+(function () {
+	var yappid = djConfig[&quot;yAppId&quot;] || djConfig[&quot;yahooAppId&quot;] || &quot;dojotoolkit&quot;;
+	if (!dojo.hostenv.post_load_) {
+		if (yappid == &quot;dojotoolkit&quot;) {
+			dojo.debug(&quot;please provide a unique Yahoo App ID in djConfig.yahooAppId when using the map widget&quot;);
+		}
+		var tag = &quot;&lt;scr&quot; + &quot;ipt src='<A HREF="http://api.maps.yahoo.com/ajaxymap?v=3.0&amp;appid=">http://api.maps.yahoo.com/ajaxymap?v=3.0&amp;appid=</A>&quot; + yappid + &quot;'&gt;&lt;/scri&quot; + &quot;pt&gt;&quot;;
+		if (!dj_global[&quot;YMap&quot;]) {
+			document.write(tag);
+		}
+	} else {
+		dojo.debug(&quot;cannot initialize map system after the page has been loaded! Please either manually include the script block provided by Yahoo in your page or require() the YahooMap widget before onload has fired&quot;);
+	}
+})();
+dojo.widget.defineWidget(&quot;dojo.widget.YahooMap&quot;, dojo.widget.HtmlWidget, function () {
+	this.map = null;
+	this.datasrc = &quot;&quot;;
+	this.data = [];
+	this.width = 0;
+	this.height = 0;
+	this.controls = [&quot;zoomlong&quot;, &quot;maptype&quot;, &quot;pan&quot;];
+}, {isContainer:false, templatePath:null, templateCssPath:null, findCenter:function (aPts) {
+	var start = new YGeoPoint(37, -90);
+	if (aPts.length == 0) {
+		return start;
+	}
+	var minLat, maxLat, minLon, maxLon, cLat, cLon;
+	minLat = maxLat = aPts[0].Lat;
+	minLon = maxLon = aPts[0].Lon;
+	for (var i = 0; i &lt; aPts.length; i++) {
+		minLat = Math.min(minLat, aPts[i].Lat);
+		maxLat = Math.max(maxLat, aPts[i].Lat);
+		minLon = Math.min(minLon, aPts[i].Lon);
+		maxLon = Math.max(maxLon, aPts[i].Lon);
+	}
+	cLat = dojo.math.round((minLat + maxLat) / 2, 6);
+	cLon = dojo.math.round((minLon + maxLon) / 2, 6);
+	return new YGeoPoint(cLat, cLon);
+}, setControls:function () {
+	var methodmap = {maptype:&quot;addTypeControl&quot;, pan:&quot;addPanControl&quot;, zoomlong:&quot;addZoomLong&quot;, zoomshort:&quot;addZoomShort&quot;};
+	var c = this.controls;
+	for (var i = 0; i &lt; c.length; i++) {
+		var controlMethod = methodmap[c[i].toLowerCase()];
+		if (this.map[controlMethod]) {
+			this.map[controlMethod]();
+		}
+	}
+}, parse:function (table) {
+	this.data = [];
+	var h = table.getElementsByTagName(&quot;thead&quot;)[0];
+	if (!h) {
+		return;
+	}
+	var a = [];
+	var cols = h.getElementsByTagName(&quot;td&quot;);
+	if (cols.length == 0) {
+		cols = h.getElementsByTagName(&quot;th&quot;);
+	}
+	for (var i = 0; i &lt; cols.length; i++) {
+		var c = cols[i].innerHTML.toLowerCase();
+		if (c == &quot;long&quot;) {
+			c = &quot;lng&quot;;
+		}
+		a.push(c);
+	}
+	var b = table.getElementsByTagName(&quot;tbody&quot;)[0];
+	if (!b) {
+		return;
+	}
+	for (var i = 0; i &lt; b.childNodes.length; i++) {
+		if (!(b.childNodes[i].nodeName &amp;&amp; b.childNodes[i].nodeName.toLowerCase() == &quot;tr&quot;)) {
+			continue;
+		}
+		var cells = b.childNodes[i].getElementsByTagName(&quot;td&quot;);
+		var o = {};
+		for (var j = 0; j &lt; a.length; j++) {
+			var col = a[j];
+			if (col == &quot;lat&quot; || col == &quot;lng&quot;) {
+				o[col] = parseFloat(cells[j].innerHTML);
+			} else {
+				o[col] = cells[j].innerHTML;
+			}
+		}
+		this.data.push(o);
+	}
+}, render:function () {
+	var pts = [];
+	var d = this.data;
+	for (var i = 0; i &lt; d.length; i++) {
+		var pt = new YGeoPoint(d[i].lat, d[i].lng);
+		pts.push(pt);
+		var icon = d[i].icon || null;
+		if (icon) {
+			icon = new YImage(icon);
+		}
+		var m = new YMarker(pt, icon);
+		if (d[i].description) {
+			m.addAutoExpand(&quot;&lt;div&gt;&quot; + d[i].description + &quot;&lt;/div&gt;&quot;);
+		}
+		this.map.addOverlay(m);
+	}
+	var c = this.findCenter(pts);
+	var z = this.map.getZoomLevel(pts);
+	this.map.drawZoomAndCenter(c, z);
+}, initialize:function (args, frag) {
+	if (!YMap || !YGeoPoint) {
+		dojo.raise(&quot;dojo.widget.YahooMap: The Yahoo Map script must be included in order to use this widget.&quot;);
+	}
+	if (this.datasrc) {
+		this.parse(dojo.byId(this.datasrc));
+	} else {
+		if (this.domNode.getElementsByTagName(&quot;table&quot;)[0]) {
+			this.parse(this.domNode.getElementsByTagName(&quot;table&quot;)[0]);
+		}
+	}
+}, postCreate:function () {
+	while (this.domNode.childNodes.length &gt; 0) {
+		this.domNode.removeChild(this.domNode.childNodes[0]);
+	}
+	if (this.width &gt; 0 &amp;&amp; this.height &gt; 0) {
+		this.map = new YMap(this.domNode, YAHOO_MAP_REG, new YSize(this.width, this.height));
+	} else {
+		this.map = new YMap(this.domNode);
+	}
+	this.setControls();
+	this.render();
+}});
+

Added: tags/parley-0.55/root/static/magic/src/widget/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({common:[&quot;dojo.xml.Parse&quot;, &quot;dojo.widget.Widget&quot;, &quot;dojo.widget.Parse&quot;, &quot;dojo.widget.Manager&quot;], browser:[&quot;dojo.widget.DomWidget&quot;, &quot;dojo.widget.HtmlWidget&quot;], dashboard:[&quot;dojo.widget.DomWidget&quot;, &quot;dojo.widget.HtmlWidget&quot;], svg:[&quot;dojo.widget.SvgWidget&quot;], rhino:[&quot;dojo.widget.SwtWidget&quot;]});
+dojo.provide(&quot;dojo.widget.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoContainer.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoContainer.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoContainer.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,75 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.demoEngine.DemoContainer&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.demoEngine.DemoPane&quot;);
+dojo.require(&quot;dojo.widget.demoEngine.SourcePane&quot;);
+dojo.require(&quot;dojo.widget.TabContainer&quot;);
+dojo.widget.defineWidget(&quot;my.widget.demoEngine.DemoContainer&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n\t&lt;table width=\&quot;100%\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;5\&quot;&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;headerNode\&quot;&gt;\n\t\t\t\t&lt;td dojoAttachPoint=\&quot;returnNode\&quot; valign=\&quot;middle\&quot; width=\&quot;1%\&quot;&gt;\n\t\t\t\t\t&lt;img dojoAttachPoint=\&quot;returnImageNode\&quot; dojoAttachEvent=\&quot;onclick: returnToDemos\&quot;/&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td&gt;\n\t\t\t\t\t&lt;h1 dojoAttachPoint=\&quot;demoNameNode\&quot;&gt;&lt;/h1&gt;\n\t\t\t\t\t&lt;p dojoAttachPoint=\&quot;summaryNode\&quot;&gt;&lt;/p&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;td dojoAttachPoint=\&quot;tabControlNode\&quot; valign=\&quot;middle\&quot; align=\&quot;right\&quot; nowrap&gt;\n\t\t\t\t\t&lt;span dojoAttachPoint=\&quot;sourceButtonNode\&quot; dojoAttachEvent=\&quot;onclick: showSource\&quot;&gt;source&lt;/span&gt;\n\t\t\t\t\t&lt;span dojoAttachPoint=\&quot;demoButtonNode\&quot; dojoAttachEvent=\&quot;onclick: showDemo\&quot;&gt;demo&lt;/span&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td colspan=\&quot;3\&quot;&gt;\n\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;tabNode\!
 &quot;&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t&lt;/table&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.demoContainer{\n\twidth: 100%;\n\theight: 100%;\n\tpadding: 0px;\n\tmargin: 0px;\n}\n\n.demoContainer .return {\n\tcursor: pointer;\n}\n\n.demoContainer span {\n\tmargin-right: 10px;\n\tcursor: pointer;\n}\n\n.demoContainer .selected {\n\tborder-bottom: 5px solid #95bfff;\n}\n\n.demoContainer table {\n\tbackground: #f5f5f5;\n\twidth: 100%;\n\theight: 100%;\n}\n\n.demoContainerTabs {\n\twidth: 100%;\n\theight: 400px;\n}\n\n.demoContainerTabs .dojoTabLabels-top {\n\tdisplay: none;\n}\n\n.demoContainerTabs .dojoTabPaneWrapper {\n\tborder: 0px;\n}\n\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;demoEngine/templates/DemoContainer.css&quot;), postCreate:function () {
+	dojo.html.addClass(this.domNode, this.domNodeClass);
+	dojo.html.addClass(this.tabNode, this.tabClass);
+	dojo.html.addClass(this.returnImageNode, this.returnClass);
+	this.returnImageNode.src = this.returnImage;
+	this.tabContainer = dojo.widget.createWidget(&quot;TabContainer&quot;, {}, this.tabNode);
+	this.demoTab = dojo.widget.createWidget(&quot;DemoPane&quot;, {});
+	this.tabContainer.addChild(this.demoTab);
+	this.sourceTab = dojo.widget.createWidget(&quot;SourcePane&quot;, {});
+	this.tabContainer.addChild(this.sourceTab);
+	dojo.html.setOpacity(this.domNode, 0);
+	dojo.html.hide(this.domNode);
+}, loadDemo:function (url) {
+	this.demoTab.setHref(url);
+	this.sourceTab.setHref(url);
+	this.showDemo();
+}, setName:function (name) {
+	dojo.html.removeChildren(this.demoNameNode);
+	this.demoNameNode.appendChild(document.createTextNode(name));
+}, setSummary:function (summary) {
+	dojo.html.removeChildren(this.summaryNode);
+	this.summaryNode.appendChild(document.createTextNode(summary));
+}, showSource:function () {
+	dojo.html.removeClass(this.demoButtonNode, this.selectedButtonClass);
+	dojo.html.addClass(this.sourceButtonNode, this.selectedButtonClass);
+	this.tabContainer.selectTab(this.sourceTab);
+}, showDemo:function () {
+	dojo.html.removeClass(this.sourceButtonNode, this.selectedButtonClass);
+	dojo.html.addClass(this.demoButtonNode, this.selectedButtonClass);
+	this.tabContainer.selectTab(this.demoTab);
+}, returnToDemos:function () {
+	dojo.debug(&quot;Return To Demos&quot;);
+}, show:function () {
+	dojo.html.setOpacity(this.domNode, 1);
+	dojo.html.show(this.domNode);
+	this.tabContainer.checkSize();
+}}, &quot;&quot;, function () {
+	dojo.debug(&quot;DemoPane Init&quot;);
+	this.domNodeClass = &quot;demoContainer&quot;;
+	this.tabContainer = &quot;&quot;;
+	this.sourceTab = &quot;&quot;;
+	this.demoTab = &quot;&quot;;
+	this.headerNode = &quot;&quot;;
+	this.returnNode = &quot;&quot;;
+	this.returnImageNode = &quot;&quot;;
+	this.returnImage = &quot;images/dojoDemos.gif&quot;;
+	this.returnClass = &quot;return&quot;;
+	this.summaryNode = &quot;&quot;;
+	this.demoNameNode = &quot;&quot;;
+	this.tabControlNode = &quot;&quot;;
+	this.tabNode = &quot;&quot;;
+	this.tabClass = &quot;demoContainerTabs&quot;;
+	this.sourceButtonNode = &quot;&quot;;
+	this.demoButtonNode = &quot;&quot;;
+	this.selectedButtonClass = &quot;selected&quot;;
+});
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoItem.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoItem.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoItem.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,52 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.demoEngine.DemoItem&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;my.widget.demoEngine.DemoItem&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n\t&lt;div dojoAttachPoint=\&quot;summaryBoxNode\&quot;&gt;\n\t\t&lt;table width=\&quot;100%\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;0\&quot;&gt;\n\t\t\t&lt;tbody&gt;\n\t\t\t\t&lt;tr&gt;\n\t\t\t\t\t&lt;td dojoAttachPoint=\&quot;screenshotTdNode\&quot; valign=\&quot;top\&quot; width=\&quot;1%\&quot;&gt;\n\t\t\t\t\t\t&lt;img dojoAttachPoint=\&quot;thumbnailImageNode\&quot; dojoAttachEvent=\&quot;onclick: onSelectDemo\&quot; /&gt;\n\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t\t&lt;td dojoAttachPoint=\&quot;summaryContainerNode\&quot; valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t\t&lt;h1 dojoAttachPoint=\&quot;nameNode\&quot;&gt;\n\t\t\t\t\t\t&lt;/h1&gt;\n\t\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;summaryNode\&quot;&gt;\n\t\t\t\t\t\t\t&lt;p dojoAttachPoint=\&quot;descriptionNode\&quot;&gt;&lt;/p&gt;\n\t\t\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;viewDemoLinkNode\&quot;&gt;&lt;img dojoAttachPoint=\&quot;viewDemoImageNode\&quot;/ dojoAttachEvent=\&quot;onclick: onSelectDemo\&quot;&gt;&lt;/div&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/td&gt;\n\t\t\t\t&lt;/tr&gt;\n\t\t\t&lt;/tbody&gt;\n\t\t&lt;/table&gt;\n\t&lt;/div&gt;\n&lt;/div&gt;\n&quot;, templateCssStrin!
 g:&quot;.demoItemSummaryBox {\n\tbackground: #efefef;\n\tborder:1px solid #dae3ee;\n}\n\n.demoItemScreenshot {\n\tpadding:0.65em;\n\twidth:175px;\n\tborder-right:1px solid #fafafa;\n\ttext-align:center;\n\tcursor: pointer;\n}\n\n.demoItemWrapper{\n\tmargin-bottom:1em;\n}\n\n.demoItemWrapper a:link, .demoItemWrapper a:visited {\n\tcolor:#a6238f;\n\ttext-decoration:none;\n}\n\n.demoItemSummaryContainer {\n\tborder-left:1px solid #ddd;\n}\n\n.demoItemSummaryContainer h1 {\n\tbackground-color:#e8e8e8;\n\tborder-bottom: 1px solid #e6e6e6;\n\tcolor:#738fb9;\n\tmargin:1px;\n\tpadding:0.5em;\n\tfont-family:\&quot;Lucida Grande\&quot;, \&quot;Tahoma\&quot;, serif;\n\tfont-size:1.25em;\n\tfont-weight:normal;\n}\n\n.demoItemSummaryContainer h1 .packageSummary {\n\tdisplay:block;\n\tcolor:#000;\n\tfont-size:10px;\n\tmargin-top:2px;\n}\n\n.demoItemSummaryContainer .demoItemSummary{\n\tpadding:1em;\n}\n\n.demoItemSummaryContainer .demoItemSummary p {\n\tfont-size:0.85em;\n\tpadding:0;\n\tmargin:0;\n}\n\n.demoIte!
 mView {\n\ttext-align:right;\n\tcursor: pointer;\n}\n&quot;, templa!
 teCssPat
h:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;demoEngine/templates/DemoItem.css&quot;), postCreate:function () {
+	dojo.html.addClass(this.domNode, this.domNodeClass);
+	dojo.html.addClass(this.summaryBoxNode, this.summaryBoxClass);
+	dojo.html.addClass(this.screenshotTdNode, this.screenshotTdClass);
+	dojo.html.addClass(this.summaryContainerNode, this.summaryContainerClass);
+	dojo.html.addClass(this.summaryNode, this.summaryClass);
+	dojo.html.addClass(this.viewDemoLinkNode, this.viewDemoLinkClass);
+	this.nameNode.appendChild(document.createTextNode(this.name));
+	this.descriptionNode.appendChild(document.createTextNode(this.description));
+	this.thumbnailImageNode.src = this.thumbnail;
+	this.thumbnailImageNode.name = this.name;
+	this.viewDemoImageNode.src = this.viewDemoImage;
+	this.viewDemoImageNode.name = this.name;
+}, onSelectDemo:function () {
+}}, &quot;&quot;, function () {
+	this.demo = &quot;&quot;;
+	this.domNodeClass = &quot;demoItemWrapper&quot;;
+	this.summaryBoxNode = &quot;&quot;;
+	this.summaryBoxClass = &quot;demoItemSummaryBox&quot;;
+	this.nameNode = &quot;&quot;;
+	this.thumbnailImageNode = &quot;&quot;;
+	this.viewDemoImageNode = &quot;&quot;;
+	this.screenshotTdNode = &quot;&quot;;
+	this.screenshotTdClass = &quot;demoItemScreenshot&quot;;
+	this.summaryContainerNode = &quot;&quot;;
+	this.summaryContainerClass = &quot;demoItemSummaryContainer&quot;;
+	this.summaryNode = &quot;&quot;;
+	this.summaryClass = &quot;demoItemSummary&quot;;
+	this.viewDemoLinkNode = &quot;&quot;;
+	this.viewDemoLinkClass = &quot;demoItemView&quot;;
+	this.descriptionNode = &quot;&quot;;
+	this.name = &quot;Some Demo&quot;;
+	this.description = &quot;This is the description of this demo.&quot;;
+	this.thumbnail = &quot;images/test_thumb.gif&quot;;
+	this.viewDemoImage = &quot;images/viewDemo.png&quot;;
+});
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoNavigator.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoNavigator.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoNavigator.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,134 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.demoEngine.DemoNavigator&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.Button&quot;);
+dojo.require(&quot;dojo.widget.demoEngine.DemoItem&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.lfx.*&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.widget.defineWidget(&quot;my.widget.demoEngine.DemoNavigator&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n\t&lt;table width=\&quot;100%\&quot; cellspacing=\&quot;0\&quot; cellpadding=\&quot;5\&quot;&gt;\n\t\t&lt;tbody&gt;\n\t\t\t&lt;tr dojoAttachPoint=\&quot;navigationContainer\&quot;&gt;\n\t\t\t\t&lt;td dojoAttachPoint=\&quot;categoriesNode\&quot; valign=\&quot;top\&quot; width=\&quot;1%\&quot;&gt;\n\t\t\t\t\t&lt;h1&gt;Categories&lt;/h1&gt;\n\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;categoriesButtonsNode\&quot;&gt;&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\n\t\t\t\t&lt;td dojoAttachPoint=\&quot;demoListNode\&quot; valign=\&quot;top\&quot;&gt;\n\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;demoListWrapperNode\&quot;&gt;\n\t\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;demoListContainerNode\&quot;&gt;\n\t\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t\t&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t\t&lt;tr&gt;\n\t\t\t\t&lt;td colspan=\&quot;2\&quot;&gt;\n\t\t\t\t\t&lt;div dojoAttachPoint=\&quot;demoNode\&quot;&gt;&lt;/div&gt;\n\t\t\t\t&lt;/td&gt;\n\t\t\t&lt;/tr&gt;\n\t\t&lt;/tbody&gt;\n\t&lt;/table&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.demoNavigatorListWrapper {\n\tborder:1px solid #dcdbdb;\n\tbackground-color:#f8f8f8;\n\tpadding:2px;\n}\n\n.d!
 emoNavigatorListContainer {\n\tborder:1px solid #f0f0f0;\n\tbackground-color:#fff;\n\tpadding:1em;\n}\n\n.demoNavigator h1 {\n\tmargin-top: 0px;\n\tmargin-bottom: 10px;\n\tfont-size: 1.2em;\n\tborder-bottom:1px dotted #a9ccf5;\n}\n\n.demoNavigator .dojoButton {\n\tmargin-bottom: 5px;\n}\n\n.demoNavigator .dojoButton .dojoButtonContents {\n\tfont-size: 1.1em;\n\twidth: 100px;\n\tcolor: black;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;demoEngine/templates/DemoNavigator.css&quot;), postCreate:function () {
+	dojo.html.addClass(this.domNode, this.domNodeClass);
+	dojo.html.addClass(this.demoListWrapperNode, this.demoListWrapperClass);
+	dojo.html.addClass(this.demoListContainerNode, this.demoListContainerClass);
+	if (dojo.render.html.ie) {
+		dojo.debug(&quot;render ie&quot;);
+		dojo.html.hide(this.demoListWrapperNode);
+	} else {
+		dojo.debug(&quot;render non-ie&quot;);
+		dojo.lfx.html.fadeHide(this.demoListWrapperNode, 0).play();
+	}
+	this.getRegistry(this.demoRegistryUrl);
+	this.demoContainer = dojo.widget.createWidget(&quot;DemoContainer&quot;, {returnImage:this.returnImage}, this.demoNode);
+	dojo.event.connect(this.demoContainer, &quot;returnToDemos&quot;, this, &quot;returnToDemos&quot;);
+	this.demoContainer.hide();
+}, returnToDemos:function () {
+	this.demoContainer.hide();
+	if (dojo.render.html.ie) {
+		dojo.debug(&quot;render ie&quot;);
+		dojo.html.show(this.navigationContainer);
+	} else {
+		dojo.debug(&quot;render non-ie&quot;);
+		dojo.lfx.html.fadeShow(this.navigationContainer, 250).play();
+	}
+	dojo.lang.forEach(this.categoriesChildren, dojo.lang.hitch(this, function (child) {
+		child.checkSize();
+	}));
+	dojo.lang.forEach(this.demoListChildren, dojo.lang.hitch(this, function (child) {
+		child.checkSize();
+	}));
+}, show:function () {
+	dojo.html.show(this.domNode);
+	dojo.html.setOpacity(this.domNode, 1);
+	dojo.html.setOpacity(this.navigationContainer, 1);
+	dojo.lang.forEach(this.categoriesChildren, dojo.lang.hitch(this, function (child) {
+		child.checkSize();
+	}));
+	dojo.lang.forEach(this.demoListChildren, dojo.lang.hitch(this, function (child) {
+		child.checkSize();
+	}));
+}, getRegistry:function (url) {
+	dojo.io.bind({url:url, load:dojo.lang.hitch(this, this.processRegistry), mimetype:&quot;text/json&quot;});
+}, processRegistry:function (type, registry, e) {
+	dojo.debug(&quot;Processing Registry&quot;);
+	this.registry = registry;
+	dojo.lang.forEach(this.registry.navigation, dojo.lang.hitch(this, this.addCategory));
+}, addCategory:function (category) {
+	var newCat = dojo.widget.createWidget(&quot;Button&quot;, {caption:category.name});
+	if (!dojo.lang.isObject(this.registry.categories)) {
+		this.registry.categories = function () {
+		};
+	}
+	this.registry.categories[category.name] = category;
+	this.categoriesChildren.push(newCat);
+	this.categoriesButtonsNode.appendChild(newCat.domNode);
+	newCat.domNode.categoryName = category.name;
+	dojo.event.connect(newCat, &quot;onClick&quot;, this, &quot;onSelectCategory&quot;);
+}, addDemo:function (demoName) {
+	var demo = this.registry.definitions[demoName];
+	if (dojo.render.html.ie) {
+		dojo.html.show(this.demoListWrapperNode);
+	} else {
+		dojo.lfx.html.fadeShow(this.demoListWrapperNode, 250).play();
+	}
+	var newDemo = dojo.widget.createWidget(&quot;DemoItem&quot;, {viewDemoImage:this.viewDemoImage, name:demoName, description:demo.description, thumbnail:demo.thumbnail});
+	this.demoListChildren.push(newDemo);
+	this.demoListContainerNode.appendChild(newDemo.domNode);
+	dojo.event.connect(newDemo, &quot;onSelectDemo&quot;, this, &quot;onSelectDemo&quot;);
+}, onSelectCategory:function (e) {
+	catName = e.currentTarget.categoryName;
+	dojo.debug(&quot;Selected Category: &quot; + catName);
+	dojo.lang.forEach(this.demoListChildren, function (child) {
+		child.destroy();
+	});
+	this.demoListChildren = [];
+	dojo.lang.forEach(this.registry.categories[catName].demos, dojo.lang.hitch(this, function (demoName) {
+		this.addDemo(demoName);
+	}));
+}, onSelectDemo:function (e) {
+	dojo.debug(&quot;Demo Selected: &quot; + e.target.name);
+	if (dojo.render.html.ie) {
+		dojo.debug(&quot;render ie&quot;);
+		dojo.html.hide(this.navigationContainer);
+		this.demoContainer.show();
+		this.demoContainer.showDemo();
+	} else {
+		dojo.debug(&quot;render non-ie&quot;);
+		dojo.lfx.html.fadeHide(this.navigationContainer, 250, null, dojo.lang.hitch(this, function () {
+			this.demoContainer.show();
+			this.demoContainer.showDemo();
+		})).play();
+	}
+	this.demoContainer.loadDemo(this.registry.definitions[e.target.name].url);
+	this.demoContainer.setName(e.target.name);
+	this.demoContainer.setSummary(this.registry.definitions[e.target.name].description);
+}}, &quot;&quot;, function () {
+	this.demoRegistryUrl = &quot;demoRegistry.json&quot;;
+	this.registry = function () {
+	};
+	this.categoriesNode = &quot;&quot;;
+	this.categoriesButtonsNode = &quot;&quot;;
+	this.navigationContainer = &quot;&quot;;
+	this.domNodeClass = &quot;demoNavigator&quot;;
+	this.demoNode = &quot;&quot;;
+	this.demoContainer = &quot;&quot;;
+	this.demoListWrapperNode = &quot;&quot;;
+	this.demoListWrapperClass = &quot;demoNavigatorListWrapper&quot;;
+	this.demoListContainerClass = &quot;demoNavigatorListContainer&quot;;
+	this.returnImage = &quot;images/dojoDemos.gif&quot;;
+	this.viewDemoImage = &quot;images/viewDemo.png&quot;;
+	this.demoListChildren = [];
+	this.categoriesChildren = [];
+});
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoPane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoPane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/DemoPane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,33 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.demoEngine.DemoPane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.widget.defineWidget(&quot;my.widget.demoEngine.DemoPane&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n\t&lt;iframe dojoAttachPoint=\&quot;demoNode\&quot;&gt;&lt;/iframe&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.demoPane {\n\twidth: 100%;\n\theight: 100%;\n\tpadding: 0px;\n\tmargin: 0px;\n\toverflow: hidden;\n}\n\n.demoPane iframe {\n\twidth: 100%;\n\theight: 100%;\n\tborder: 0px;\n\tborder: none;\n\toverflow: auto;\n\tpadding: 0px;\n\tmargin:0px;\n\tbackground: #ffffff;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;demoEngine/templates/DemoPane.css&quot;), postCreate:function () {
+	dojo.html.addClass(this.domNode, this.domNodeClass);
+	dojo.debug(&quot;PostCreate&quot;);
+	this._launchDemo();
+}, _launchDemo:function () {
+	dojo.debug(&quot;Launching Demo&quot;);
+	dojo.debug(this.demoNode);
+	this.demoNode.src = this.href;
+}, setHref:function (url) {
+	this.href = url;
+	this._launchDemo();
+}}, &quot;&quot;, function () {
+	dojo.debug(&quot;DemoPane Init&quot;);
+	this.domNodeClass = &quot;demoPane&quot;;
+	this.demoNode = &quot;&quot;;
+	this.href = &quot;&quot;;
+});
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/SourcePane.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/SourcePane.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/SourcePane.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.demoEngine.SourcePane&quot;);
+dojo.require(&quot;dojo.widget.*&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.widget.defineWidget(&quot;my.widget.demoEngine.SourcePane&quot;, dojo.widget.HtmlWidget, {templateString:&quot;&lt;div dojoAttachPoint=\&quot;domNode\&quot;&gt;\n\t&lt;textarea dojoAttachPoint=\&quot;sourceNode\&quot; rows=\&quot;100%\&quot;&gt;&lt;/textarea&gt;\n&lt;/div&gt;\n&quot;, templateCssString:&quot;.sourcePane {\n\twidth: 100%;\n\theight: 100%;\n\tpadding: 0px;\n\tmargin: 0px;\n\toverflow: hidden;\n}\n\n.sourcePane textarea{\n\twidth: 100%;\n\theight: 100%;\n\tborder: 0px;\n\toverflow: auto;\n\tpadding: 0px;\n\tmargin:0px;\n}\n\n* html .sourcePane {\n\toverflow: auto;\n}\n&quot;, templateCssPath:dojo.uri.moduleUri(&quot;dojo.widget&quot;, &quot;demoEngine/templates/SourcePane.css&quot;), postCreate:function () {
+	dojo.html.addClass(this.domNode, this.domNodeClass);
+	dojo.debug(&quot;PostCreate&quot;);
+}, getSource:function () {
+	if (this.href) {
+		dojo.io.bind({url:this.href, load:dojo.lang.hitch(this, &quot;fillInSource&quot;), mimetype:&quot;text/plain&quot;});
+	}
+}, fillInSource:function (type, source, e) {
+	this.sourceNode.value = source;
+}, setHref:function (url) {
+	this.href = url;
+	this.getSource();
+}}, &quot;&quot;, function () {
+	dojo.debug(&quot;SourcePane Init&quot;);
+	this.domNodeClass = &quot;sourcePane&quot;;
+	this.sourceNode = &quot;&quot;;
+	this.href = &quot;&quot;;
+});
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.kwCompoundRequire({browser:[&quot;dojo.widget.demoEngine.DemoItem&quot;, &quot;dojo.widget.demoEngine.DemoNavigator&quot;, &quot;dojo.widget.demoEngine.DemoPane&quot;, &quot;dojo.widget.demoEngine.SourcePane&quot;, &quot;dojo.widget.demoEngine.DemoContainer&quot;]});
+dojo.provide(&quot;dojo.widget.demoEngine.*&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,39 @@
+.demoContainer{
+	width: 100%;
+	height: 100%;
+	padding: 0px;
+	margin: 0px;
+}
+
+.demoContainer .return {
+	cursor: pointer;
+}
+
+.demoContainer span {
+	margin-right: 10px;
+	cursor: pointer;
+}
+
+.demoContainer .selected {
+	border-bottom: 5px solid #95bfff;
+}
+
+.demoContainer table {
+	background: #f5f5f5;
+	width: 100%;
+	height: 100%;
+}
+
+.demoContainerTabs {
+	width: 100%;
+	height: 400px;
+}
+
+.demoContainerTabs .dojoTabLabels-top {
+	display: none;
+}
+
+.demoContainerTabs .dojoTabPaneWrapper {
+	border: 0px;
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoContainer.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,25 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+	&lt;table width=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;5&quot;&gt;
+		&lt;tbody&gt;
+			&lt;tr dojoAttachPoint=&quot;headerNode&quot;&gt;
+				&lt;td dojoAttachPoint=&quot;returnNode&quot; valign=&quot;middle&quot; width=&quot;1%&quot;&gt;
+					&lt;img dojoAttachPoint=&quot;returnImageNode&quot; dojoAttachEvent=&quot;onclick: returnToDemos&quot;/&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;h1 dojoAttachPoint=&quot;demoNameNode&quot;&gt;&lt;/h1&gt;
+					&lt;p dojoAttachPoint=&quot;summaryNode&quot;&gt;&lt;/p&gt;
+				&lt;/td&gt;
+				&lt;td dojoAttachPoint=&quot;tabControlNode&quot; valign=&quot;middle&quot; align=&quot;right&quot; nowrap&gt;
+					&lt;span dojoAttachPoint=&quot;sourceButtonNode&quot; dojoAttachEvent=&quot;onclick: showSource&quot;&gt;source&lt;/span&gt;
+					&lt;span dojoAttachPoint=&quot;demoButtonNode&quot; dojoAttachEvent=&quot;onclick: showDemo&quot;&gt;demo&lt;/span&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td colspan=&quot;3&quot;&gt;
+					&lt;div dojoAttachPoint=&quot;tabNode&quot;&gt;
+					&lt;/div&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,58 @@
+.demoItemSummaryBox {
+	background: #efefef;
+	border:1px solid #dae3ee;
+}
+
+.demoItemScreenshot {
+	padding:0.65em;
+	width:175px;
+	border-right:1px solid #fafafa;
+	text-align:center;
+	cursor: pointer;
+}
+
+.demoItemWrapper{
+	margin-bottom:1em;
+}
+
+.demoItemWrapper a:link, .demoItemWrapper a:visited {
+	color:#a6238f;
+	text-decoration:none;
+}
+
+.demoItemSummaryContainer {
+	border-left:1px solid #ddd;
+}
+
+.demoItemSummaryContainer h1 {
+	background-color:#e8e8e8;
+	border-bottom: 1px solid #e6e6e6;
+	color:#738fb9;
+	margin:1px;
+	padding:0.5em;
+	font-family:&quot;Lucida Grande&quot;, &quot;Tahoma&quot;, serif;
+	font-size:1.25em;
+	font-weight:normal;
+}
+
+.demoItemSummaryContainer h1 .packageSummary {
+	display:block;
+	color:#000;
+	font-size:10px;
+	margin-top:2px;
+}
+
+.demoItemSummaryContainer .demoItemSummary{
+	padding:1em;
+}
+
+.demoItemSummaryContainer .demoItemSummary p {
+	font-size:0.85em;
+	padding:0;
+	margin:0;
+}
+
+.demoItemView {
+	text-align:right;
+	cursor: pointer;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoItem.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,21 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+	&lt;div dojoAttachPoint=&quot;summaryBoxNode&quot;&gt;
+		&lt;table width=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;
+			&lt;tbody&gt;
+				&lt;tr&gt;
+					&lt;td dojoAttachPoint=&quot;screenshotTdNode&quot; valign=&quot;top&quot; width=&quot;1%&quot;&gt;
+						&lt;img dojoAttachPoint=&quot;thumbnailImageNode&quot; dojoAttachEvent=&quot;onclick: onSelectDemo&quot; /&gt;
+					&lt;/td&gt;
+					&lt;td dojoAttachPoint=&quot;summaryContainerNode&quot; valign=&quot;top&quot;&gt;
+						&lt;h1 dojoAttachPoint=&quot;nameNode&quot;&gt;
+						&lt;/h1&gt;
+						&lt;div dojoAttachPoint=&quot;summaryNode&quot;&gt;
+							&lt;p dojoAttachPoint=&quot;descriptionNode&quot;&gt;&lt;/p&gt;
+							&lt;div dojoAttachPoint=&quot;viewDemoLinkNode&quot;&gt;&lt;img dojoAttachPoint=&quot;viewDemoImageNode&quot;/ dojoAttachEvent=&quot;onclick: onSelectDemo&quot;&gt;&lt;/div&gt;
+						&lt;/div&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+			&lt;/tbody&gt;
+		&lt;/table&gt;
+	&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,28 @@
+.demoNavigatorListWrapper {
+	border:1px solid #dcdbdb;
+	background-color:#f8f8f8;
+	padding:2px;
+}
+
+.demoNavigatorListContainer {
+	border:1px solid #f0f0f0;
+	background-color:#fff;
+	padding:1em;
+}
+
+.demoNavigator h1 {
+	margin-top: 0px;
+	margin-bottom: 10px;
+	font-size: 1.2em;
+	border-bottom:1px dotted #a9ccf5;
+}
+
+.demoNavigator .dojoButton {
+	margin-bottom: 5px;
+}
+
+.demoNavigator .dojoButton .dojoButtonContents {
+	font-size: 1.1em;
+	width: 100px;
+	color: black;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoNavigator.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+	&lt;table width=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;5&quot;&gt;
+		&lt;tbody&gt;
+			&lt;tr dojoAttachPoint=&quot;navigationContainer&quot;&gt;
+				&lt;td dojoAttachPoint=&quot;categoriesNode&quot; valign=&quot;top&quot; width=&quot;1%&quot;&gt;
+					&lt;h1&gt;Categories&lt;/h1&gt;
+					&lt;div dojoAttachPoint=&quot;categoriesButtonsNode&quot;&gt;&lt;/div&gt;
+				&lt;/td&gt;
+
+				&lt;td dojoAttachPoint=&quot;demoListNode&quot; valign=&quot;top&quot;&gt;
+					&lt;div dojoAttachPoint=&quot;demoListWrapperNode&quot;&gt;
+						&lt;div dojoAttachPoint=&quot;demoListContainerNode&quot;&gt;
+						&lt;/div&gt;
+					&lt;/div&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td colspan=&quot;2&quot;&gt;
+					&lt;div dojoAttachPoint=&quot;demoNode&quot;&gt;&lt;/div&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,18 @@
+.demoPane {
+	width: 100%;
+	height: 100%;
+	padding: 0px;
+	margin: 0px;
+	overflow: hidden;
+}
+
+.demoPane iframe {
+	width: 100%;
+	height: 100%;
+	border: 0px;
+	border: none;
+	overflow: auto;
+	padding: 0px;
+	margin:0px;
+	background: #ffffff;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/DemoPane.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,3 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+	&lt;iframe dojoAttachPoint=&quot;demoNode&quot;&gt;&lt;/iframe&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,20 @@
+.sourcePane {
+	width: 100%;
+	height: 100%;
+	padding: 0px;
+	margin: 0px;
+	overflow: hidden;
+}
+
+.sourcePane textarea{
+	width: 100%;
+	height: 100%;
+	border: 0px;
+	overflow: auto;
+	padding: 0px;
+	margin:0px;
+}
+
+* html .sourcePane {
+	overflow: auto;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/SourcePane.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,3 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+	&lt;textarea dojoAttachPoint=&quot;sourceNode&quot; rows=&quot;100%&quot;&gt;&lt;/textarea&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/general.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/general.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/general.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,73 @@
+.demoListWrapper {
+	border:1px solid #dcdbdb;
+	background-color:#f8f8f8;
+	padding:2px;
+}
+
+.demoListContainer {
+	border:1px solid #f0f0f0;
+	background-color:#fff;
+	padding:1em;
+}
+
+.demoSummaryBox {
+	background: #efefef;
+	border:1px solid #dae3ee;
+}
+
+.screenshot {
+	padding:0.65em;
+	width:175px;
+	border-right:1px solid #fafafa;
+	text-align:center;
+}
+
+.demoSummary {
+	margin-bottom:1em;
+}
+
+.demoSummary a:link, .demoSummary a:visited {
+	color:#a6238f;
+	text-decoration:none;
+}
+
+.summaryContainer {
+	border-left:1px solid #ddd;
+}
+
+.summaryContainer h1 {
+	background-color:#e8e8e8;
+	border-bottom: 1px solid #e6e6e6;
+	color:#738fb9;
+	margin:1px;
+	padding:0.5em;
+	font-family:&quot;Lucida Grande&quot;, &quot;Tahoma&quot;, serif;
+	font-size:1.25em;
+	font-weight:normal;
+}
+
+.summaryContainer h1 .packageSummary {
+	display:block;
+	color:#000;
+	font-size:10px;
+	margin-top:2px;
+}
+
+.summaryContainer .summary {
+	padding:1em;
+}
+
+.summaryContainer .summary p {
+	font-size:0.85em;
+	padding:0;
+	margin:0;
+}
+
+.reflection {
+	background: url(&quot;images/demoBoxReflection.gif&quot;) repeat-x top left;
+	height:25px;
+}
+
+.view {
+	text-align:right;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/test_thumb.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/test_thumb.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/viewDemo.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/demoEngine/templates/images/viewDemo.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/html/layout.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/html/layout.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/html/layout.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,94 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.html.layout&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.string.extras&quot;);
+dojo.require(&quot;dojo.html.style&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.widget.html.layout = function (container, children, layoutPriority) {
+	dojo.html.addClass(container, &quot;dojoLayoutContainer&quot;);
+	children = dojo.lang.filter(children, function (child, idx) {
+		child.idx = idx;
+		return dojo.lang.inArray([&quot;top&quot;, &quot;bottom&quot;, &quot;left&quot;, &quot;right&quot;, &quot;client&quot;, &quot;flood&quot;], child.layoutAlign);
+	});
+	if (layoutPriority &amp;&amp; layoutPriority != &quot;none&quot;) {
+		var rank = function (child) {
+			switch (child.layoutAlign) {
+			  case &quot;flood&quot;:
+				return 1;
+			  case &quot;left&quot;:
+			  case &quot;right&quot;:
+				return (layoutPriority == &quot;left-right&quot;) ? 2 : 3;
+			  case &quot;top&quot;:
+			  case &quot;bottom&quot;:
+				return (layoutPriority == &quot;left-right&quot;) ? 3 : 2;
+			  default:
+				return 4;
+			}
+		};
+		children.sort(function (a, b) {
+			return (rank(a) - rank(b)) || (a.idx - b.idx);
+		});
+	}
+	var f = {top:dojo.html.getPixelValue(container, &quot;padding-top&quot;, true), left:dojo.html.getPixelValue(container, &quot;padding-left&quot;, true)};
+	dojo.lang.mixin(f, dojo.html.getContentBox(container));
+	dojo.lang.forEach(children, function (child) {
+		var elm = child.domNode;
+		var pos = child.layoutAlign;
+		with (elm.style) {
+			left = f.left + &quot;px&quot;;
+			top = f.top + &quot;px&quot;;
+			bottom = &quot;auto&quot;;
+			right = &quot;auto&quot;;
+		}
+		dojo.html.addClass(elm, &quot;dojoAlign&quot; + dojo.string.capitalize(pos));
+		if ((pos == &quot;top&quot;) || (pos == &quot;bottom&quot;)) {
+			dojo.html.setMarginBox(elm, {width:f.width});
+			var h = dojo.html.getMarginBox(elm).height;
+			f.height -= h;
+			if (pos == &quot;top&quot;) {
+				f.top += h;
+			} else {
+				elm.style.top = f.top + f.height + &quot;px&quot;;
+			}
+			if (child.onResized) {
+				child.onResized();
+			}
+		} else {
+			if (pos == &quot;left&quot; || pos == &quot;right&quot;) {
+				var w = dojo.html.getMarginBox(elm).width;
+				if (child.resizeTo) {
+					child.resizeTo(w, f.height);
+				} else {
+					dojo.html.setMarginBox(elm, {width:w, height:f.height});
+				}
+				f.width -= w;
+				if (pos == &quot;left&quot;) {
+					f.left += w;
+				} else {
+					elm.style.left = f.left + f.width + &quot;px&quot;;
+				}
+			} else {
+				if (pos == &quot;flood&quot; || pos == &quot;client&quot;) {
+					if (child.resizeTo) {
+						child.resizeTo(f.width, f.height);
+					} else {
+						dojo.html.setMarginBox(elm, {width:f.width, height:f.height});
+					}
+				}
+			}
+		}
+	});
+};
+dojo.html.insertCssText(&quot;.dojoLayoutContainer{ position: relative; display: block; overflow: hidden; }\n&quot; + &quot;body .dojoAlignTop, body .dojoAlignBottom, body .dojoAlignLeft, body .dojoAlignRight { position: absolute; overflow: hidden; }\n&quot; + &quot;body .dojoAlignClient { position: absolute }\n&quot; + &quot;.dojoAlignClient { overflow: auto; }\n&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/html/loader.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/html/loader.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/html/loader.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,622 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.html.loader&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.io.*&quot;);
+dojo.require(&quot;dojo.lang.common&quot;);
+dojo.require(&quot;dojo.lang.extras&quot;);
+dojo.require(&quot;dojo.experimental&quot;);
+dojo.experimental(&quot;dojo.widget.html.loader&quot;);
+dojo.widget.html.loader = new (function () {
+	this.toString = function () {
+		return &quot;dojo.widget.html.loader&quot;;
+	};
+	var _loader = this;
+	dojo.addOnLoad(function () {
+		dojo.experimental(_loader.toString());
+		var undo = dojo.evalObjPath(&quot;dojo.undo.browser&quot;);
+		if (djConfig[&quot;preventBackButtonFix&quot;] &amp;&amp; undo &amp;&amp; !undo.initialState) {
+			undo.setInitialState(new trackerObj);
+		}
+	});
+	var logger = {};
+	var trackerObj = function (id, data) {
+		this.id = id;
+		this.data = data;
+	};
+	trackerObj.prototype.handle = function (type) {
+		if (typeof dojo == &quot;undefined&quot;) {
+			return;
+		}
+		var wg = dojo.widget.byId(this.id);
+		if (wg) {
+			wg.setContent(this.data, true);
+		}
+	};
+	this._log = function (widget, data) {
+		if (widget.trackHistory) {
+			if (!logger[widget.widgetId]) {
+				logger[widget.widgetId] = {childrenIds:[], stack:[data]};
+			}
+			var children = logger[widget.widgetId].childrenIds;
+			while (children &amp;&amp; children.length) {
+				delete logger[children.pop()];
+			}
+			for (var child in widget.children) {
+				logger[widget.widgetId].childrenIds = child.widgetId;
+			}
+			dojo.undo.browser.addToHistory(new trackerObj(widget.widgetId, dojo.lang.shallowCopy(data, true)));
+		}
+	};
+	var undef = dojo.lang.isUndefined;
+	var isFunc = dojo.lang.isFunction;
+	function handleDefaults(e, handler, useAlert) {
+		if (!handler) {
+			handler = &quot;onContentError&quot;;
+		}
+		if (dojo.lang.isString(e)) {
+			e = {_text:e};
+		}
+		if (!e._text) {
+			e._text = e.toString();
+		}
+		e.toString = function () {
+			return this._text;
+		};
+		if (typeof e.returnValue != &quot;boolean&quot;) {
+			e.returnValue = true;
+		}
+		if (typeof e.preventDefault != &quot;function&quot;) {
+			e.preventDefault = function () {
+				this.returnValue = false;
+			};
+		}
+		this[handler](e);
+		if (e.returnValue) {
+			if (useAlert) {
+				alert(e.toString());
+			} else {
+				this.loader.callOnUnLoad.call(this, false);
+				this.onSetContent(e.toString());
+			}
+		}
+	}
+	function downloader(bindArgs) {
+		for (var x in this.bindArgs) {
+			bindArgs[x] = (undef(bindArgs[x]) ? this.bindArgs[x] : undefined);
+		}
+		var cache = this.cacheContent;
+		if (undef(bindArgs.useCache)) {
+			bindArgs.useCache = cache;
+		}
+		if (undef(bindArgs.preventCache)) {
+			bindArgs.preventCache = !cache;
+		}
+		if (undef(bindArgs.mimetype)) {
+			bindArgs.mimetype = &quot;text/html&quot;;
+		}
+		this.loader.bindObj = dojo.io.bind(bindArgs);
+	}
+	function stackRunner(st) {
+		var err = &quot;&quot;, func = null;
+		var scope = this.scriptScope || dojo.global();
+		while (st.length) {
+			func = st.shift();
+			try {
+				func.call(scope);
+			}
+			catch (e) {
+				err += &quot;\n&quot; + func + &quot; failed: &quot; + e;
+			}
+		}
+		if (err.length) {
+			var name = (st == this.loader.addOnLoads) ? &quot;addOnLoad&quot; : &quot;addOnUnLoad&quot;;
+			handleDefaults.call(this, name + &quot; failure\n &quot; + err, &quot;onExecError&quot;, true);
+		}
+	}
+	function stackPusher(st, obj, func) {
+		if (typeof func == &quot;undefined&quot;) {
+			st.push(obj);
+		} else {
+			st.push(function () {
+				obj[func]();
+			});
+		}
+	}
+	function refreshed() {
+		this.onResized();
+		this.onLoad();
+		this.isLoaded = true;
+	}
+	function asyncParse(data) {
+		if (this.executeScripts) {
+			this.onExecScript.call(this, data.scripts);
+		}
+		if (this.parseContent) {
+			this.onContentParse.call(this);
+		}
+		refreshed.call(this);
+	}
+	function runHandler() {
+		if (dojo.lang.isFunction(this.handler)) {
+			this.handler(this, this.containerNode || this.domNode);
+			refreshed.call(this);
+			return false;
+		}
+		return true;
+	}
+	this.htmlContentBasicFix = function (s, url) {
+		var titles = [], styles = [];
+		var regex = /&lt;title[^&gt;]*&gt;([\s\S]*?)&lt;\/title&gt;/i;
+		var match, attr;
+		while (match = regex.exec(s)) {
+			titles.push(match[1]);
+			s = s.substring(0, match.index) + s.substr(match.index + match[0].length);
+		}
+		regex = /(?:&lt;(style)[^&gt;]*&gt;([\s\S]*?)&lt;\/style&gt;|&lt;link ([^&gt;]*rel=['&quot;]?stylesheet['&quot;]?[^&gt;]*)&gt;)/i;
+		while (match = regex.exec(s)) {
+			if (match[1] &amp;&amp; match[1].toLowerCase() == &quot;style&quot;) {
+				styles.push(dojo.html.fixPathsInCssText(match[2], url));
+			} else {
+				if (attr = match[3].match(/href=(['&quot;]?)([^'&quot;&gt;]*)\1/i)) {
+					styles.push({path:attr[2]});
+				}
+			}
+			s = s.substring(0, match.index) + s.substr(match.index + match[0].length);
+		}
+		return {&quot;s&quot;:s, &quot;titles&quot;:titles, &quot;styles&quot;:styles};
+	};
+	this.htmlContentAdjustPaths = function (s, url) {
+		var tag = &quot;&quot;, str = &quot;&quot;, tagFix = &quot;&quot;, path = &quot;&quot;;
+		var attr = [], origPath = &quot;&quot;, fix = &quot;&quot;;
+		var regexFindTag = /&lt;[a-z][a-z0-9]*[^&gt;]*\s(?:(?:src|href|style)=[^&gt;])+[^&gt;]*&gt;/i;
+		var regexFindAttr = /\s(src|href|style)=(['&quot;]?)([\w()\[\]\/.,\\'&quot;-:;#=&amp;?\s@]+?)\2/i;
+		var regexProtocols = /^(?:[#]|(?:(?:https?|ftps?|file|javascript|mailto|news):))/;
+		while (tag = regexFindTag.exec(s)) {
+			str += s.substring(0, tag.index);
+			s = s.substring((tag.index + tag[0].length), s.length);
+			tag = tag[0];
+			tagFix = &quot;&quot;;
+			while (attr = regexFindAttr.exec(tag)) {
+				path = &quot;&quot;;
+				origPath = attr[3];
+				switch (attr[1].toLowerCase()) {
+				  case &quot;src&quot;:
+				  case &quot;href&quot;:
+					if (regexProtocols.exec(origPath)) {
+						path = origPath;
+					} else {
+						path = (new dojo.uri.Uri(url, origPath).toString());
+					}
+					break;
+				  case &quot;style&quot;:
+					path = dojo.html.fixPathsInCssText(origPath, url);
+					break;
+				  default:
+					path = origPath;
+				}
+				fix = &quot; &quot; + attr[1] + &quot;=&quot; + attr[2] + path + attr[2];
+				tagFix += tag.substring(0, attr.index) + fix;
+				tag = tag.substring((attr.index + attr[0].length), tag.length);
+			}
+			str += tagFix + tag;
+		}
+		return str + s;
+	};
+	this.htmlContentScripts = function (s, collectScripts) {
+		var scripts = [], requires = [], match = [];
+		var attr = &quot;&quot;, tmp = null, tag = &quot;&quot;, sc = &quot;&quot;, str = &quot;&quot;;
+		var regex = /&lt;script([^&gt;]*)&gt;([\s\S]*?)&lt;\/script&gt;/i;
+		var regexSrc = /src=(['&quot;]?)([^&quot;']*)\1/i;
+		var regexDojoJs = /.*(\bdojo\b\.js(?:\.uncompressed\.js)?)$/;
+		var regexInvalid = /(?:var )?\bdjConfig\b(?:[\s]*=[\s]*\{[^}]+\}|\.[\w]*[\s]*=[\s]*[^;\n]*)?;?|dojo\.hostenv\.writeIncludes\(\s*\);?/g;
+		var regexRequires = /dojo\.(?:(?:require(?:After)?(?:If)?)|(?:widget\.(?:manager\.)?registerWidgetPackage)|(?:(?:hostenv\.)?setModulePrefix)|defineNamespace)\((['&quot;]).*?\1\)\s*;?/;
+		while (match = regex.exec(s)) {
+			if (this.executeScripts &amp;&amp; match[1]) {
+				if (attr = regexSrc.exec(match[1])) {
+					if (regexDojoJs.exec(attr[2])) {
+						dojo.debug(&quot;Security note! inhibit:&quot; + attr[2] + &quot; from  beeing loaded again.&quot;);
+					} else {
+						scripts.push({path:attr[2]});
+					}
+				}
+			}
+			if (match[2]) {
+				sc = match[2].replace(regexInvalid, &quot;&quot;);
+				if (!sc) {
+					continue;
+				}
+				while (tmp = regexRequires.exec(sc)) {
+					requires.push(tmp[0]);
+					sc = sc.substring(0, tmp.index) + sc.substr(tmp.index + tmp[0].length);
+				}
+				if (collectScripts) {
+					scripts.push(sc);
+				}
+			}
+			s = s.substr(0, match.index) + s.substr(match.index + match[0].length);
+		}
+		if (collectScripts) {
+			var regex = /(&lt;[a-zA-Z][a-zA-Z0-9]*\s[^&gt;]*\S=(['&quot;])[^&gt;]*[^\.\]])scriptScope([^&gt;]*&gt;)/;
+			str = &quot;&quot;;
+			while (tag = regex.exec(s)) {
+				tmp = ((tag[2] == &quot;'&quot;) ? &quot;\&quot;&quot; : &quot;'&quot;);
+				str += s.substring(0, tag.index);
+				s = s.substr(tag.index).replace(regex, &quot;$1dojo.widget.byId(&quot; + tmp + this.widgetId + tmp + &quot;).scriptScope$3&quot;);
+			}
+			s = str + s;
+		}
+		return {&quot;s&quot;:s, &quot;requires&quot;:requires, &quot;scripts&quot;:scripts};
+	};
+	this.splitAndFixPaths = function (args) {
+		if (!args.url) {
+			args.url = &quot;./&quot;;
+		}
+		url = new dojo.uri.Uri(location, args.url).toString();
+		var ret = {&quot;xml&quot;:&quot;&quot;, &quot;styles&quot;:[], &quot;titles&quot;:[], &quot;requires&quot;:[], &quot;scripts&quot;:[], &quot;url&quot;:url};
+		if (args.content) {
+			var tmp = null, content = args.content;
+			if (args.adjustPaths) {
+				content = _loader.htmlContentAdjustPaths.call(this, content, url);
+			}
+			tmp = _loader.htmlContentBasicFix.call(this, content, url);
+			content = tmp.s;
+			ret.styles = tmp.styles;
+			ret.titles = tmp.titles;
+			if (args.collectRequires || args.collectScripts) {
+				tmp = _loader.htmlContentScripts.call(this, content, args.collectScripts);
+				content = tmp.s;
+				ret.requires = tmp.requires;
+				ret.scripts = tmp.scripts;
+			}
+			var match = [];
+			if (args.bodyExtract) {
+				match = content.match(/&lt;body[^&gt;]*&gt;\s*([\s\S]+)\s*&lt;\/body&gt;/im);
+				if (match) {
+					content = match[1];
+				}
+			}
+			ret.xml = content;
+		}
+		return ret;
+	};
+	this.hookUp = function (args) {
+		var widget = args.widget;
+		if (dojo.lang.isString(widget)) {
+			if (args.mixin) {
+				dojo.raise(this.toString() + &quot;, cant use mixin when widget is a string&quot;);
+			}
+			widget = dojo.evalObjPath(widget);
+		}
+		if (!widget || !(widget instanceof dojo.widget.HtmlWidget)) {
+			dojo.raise(this.toString() + &quot; Widget isn't defined or isn't a HtmlWidget instance&quot;);
+		}
+		if (widget.loader &amp;&amp; widget.setUrl) {
+			return;
+		}
+		var widgetProto = (args.mixin) ? widget : widget.constructor.prototype;
+		widget.loader = {isLoaded:false, styleNodes:[], addOnLoads:[], addOnUnLoads:[], callOnUnLoad:(function (canCall) {
+			return function (after) {
+				this.abort();
+				if (canCall) {
+					this.onUnLoad();
+				}
+				canCall = after;
+			};
+		})(false), bindObj:null, unHook:(function (w, wg) {
+			var oldProps = {isContainer:w.isContainer, adjustPats:w.adjustPaths, href:w.href, extractContent:w.extractContent, parseContent:w.parseContent, cacheContent:w.cacheContent, bindArgs:w.bindArgs, preload:w.preload, refreshOnShow:w.refreshOnShow, handler:w.handler, trackHistory:w.trackHistory, executeScripts:w.executeScripts, scriptScope:w.scriptScope, postCreate:w.postCreate, show:w.show, refresh:w.refresh, loadContents:w.loadContents, abort:w.abort, destroy:w.destroy, onLoad:w.onLoad, onUnLoad:w.onUnLoad, addOnLoad:w.addOnLoad, addOnUnLoad:w.addOnUnLoad, onDownloadStart:w.onDownloadStart, onDownloadEnd:w.onDownloadEnd, onDownloadError:w.onDownloadError, onContentError:w.onContentError, onExecError:w.onExecError, onSetContent:w.onSetContent, setUrl:w.setUrl, setContent:w.setContent, onContentParse:w.onContentParse, onExecScript:w.onExecScript, setHandler:w.setHandler};
+			return function () {
+				if (wg.abort) {
+					wg.abort();
+				}
+				if ((w != wg) &amp;&amp; (dojo.widget.byType(wg.widgetType).length &gt; 1)) {
+					return;
+				}
+				for (var x in oldProps) {
+					if (oldProps[x] === undefined) {
+						delete w[x];
+						continue;
+					}
+					w[x] = oldProps[x];
+				}
+				delete wg._loader_defined;
+				delete wg.loader;
+			};
+		})(widgetProto, widget)};
+		if (widgetProto._loader_defined || widget._loader_defined) {
+			return;
+		}
+		dojo.mixin(widgetProto, {isContainer:true, adjustPaths:undef(widgetProto.adjustPaths) ? true : widgetProto.adjustPaths, href:undef(widgetProto.href) ? &quot;&quot; : widgetProto.href, extractContent:undef(widgetProto.extractContent) ? true : widgetProto.extractContent, parseContent:undef(widgetProto.parseContent) ? true : widgetProto.parseContent, cacheContent:undef(widgetProto.cacheContent) ? true : widgetProto.cacheContent, bindArgs:undef(widgetProto.bindArgs) ? {} : widgetProto.bindArgs, preload:undef(widgetProto.preload) ? false : widgetProto.preload, refreshOnShow:undef(widgetProto.refreshOnShow) ? false : widgetProto.refreshOnShow, handler:undef(widgetProto.handler) ? &quot;&quot; : widgetProto.handler, executeScripts:undef(widgetProto.executeScripts) ? false : widgetProto.executeScripts, trackHistory:undef(widgetProto.tracHistory) ? false : widgetProto.trackHistory, scriptScope:null});
+		widgetProto.postCreate = (function (postCreate) {
+			return function () {
+				if (widgetProto.constructor.superclass.postCreate != postCreate) {
+					postCreate.apply(this, arguments);
+				} else {
+					widgetProto.constructor.superclass.postCreate.apply(this, arguments);
+				}
+				if (this.handler !== &quot;&quot;) {
+					this.setHandler(this.handler);
+				}
+				if (this.isShowing() || this.preload) {
+					this.loadContents();
+					if (!this.href) {
+						_loader._log(this, (this.domNode || this.containerNode).innerHTML);
+					}
+				}
+			};
+		})(widgetProto.postCreate);
+		widgetProto.show = (function (show) {
+			return function () {
+				if (this.refreshOnShow) {
+					this.refresh();
+				} else {
+					this.loadContents();
+				}
+				if ((widgetProto.constructor.superclass.show == show) || !isFunc(show)) {
+					widgetProto.constructor.superclass.show.apply(this, arguments);
+				} else {
+					show.apply(this, arguments);
+				}
+			};
+		})(widgetProto.show);
+		widgetProto.destroy = (function (destroy) {
+			return function (destroy) {
+				this.onUnLoad();
+				this.abort();
+				this.loader.unHook();
+				if ((widgetProto.constructor.superclass.destroy != destroy) &amp;&amp; isFunc(destroy)) {
+					destroy.apply(this, arguments);
+				} else {
+					widgetProto.constructor.superclass.destroy.apply(this, arguments);
+				}
+			};
+		})(widgetProto.destroy);
+		if (!widgetProto.refresh) {
+			widgetProto.refresh = function () {
+				this.loader.isLoaded = false;
+				this.loadContents();
+			};
+		}
+		if (!widgetProto.loadContents) {
+			widgetProto.loadContents = function () {
+				if (this.loader.isLoaded) {
+					return;
+				}
+				if (isFunc(this.handler)) {
+					runHandler.call(this);
+				} else {
+					if (this.href !== &quot;&quot;) {
+						handleDefaults.call(this, &quot;Loading...&quot;, &quot;onDownloadStart&quot;);
+						var self = this, url = this.href;
+						downloader.call(this, {url:url, load:function (type, data, xhr) {
+							self.onDownloadEnd.call(self, url, data);
+						}, error:function (type, err, xhr) {
+							var e = {responseText:xhr.responseText, status:xhr.status, statusText:xhr.statusText, responseHeaders:(xhr.getAllResponseHeaders) ? xhr.getAllResponseHeaders() : [], _text:&quot;Error loading '&quot; + url + &quot;' (&quot; + xhr.status + &quot; &quot; + xhr.statusText + &quot;)&quot;};
+							handleDefaults.call(self, e, &quot;onDownloadError&quot;);
+							self.onLoad();
+						}});
+					}
+				}
+			};
+		}
+		if (!widgetProto.abort) {
+			widgetProto.abort = function () {
+				if (!this.loader || !this.loader.bindObj || !this.loader.bindObj.abort) {
+					return;
+				}
+				this.loader.bindObj.abort();
+				this.loader.bindObj = null;
+			};
+		}
+		if (!widgetProto.onLoad) {
+			widgetProto.onLoad = function () {
+				stackRunner.call(this, this.loader.addOnLoads);
+				this.loader.isLoaded = true;
+			};
+		}
+		if (!widgetProto.onUnLoad) {
+			widgetProto.onUnLoad = function () {
+				stackRunner.call(this, this.loader.addOnUnLoads);
+				delete this.scriptScope;
+			};
+		}
+		if (!widgetProto.addOnLoad) {
+			widgetProto.addOnLoad = function (obj, func) {
+				stackPusher.call(this, this.loader.addOnLoads, obj, func);
+			};
+		}
+		if (!widgetProto.addOnUnLoad) {
+			widgetProto.addOnUnLoad = function (obj, func) {
+				stackPusher.call(this, this.loader.addOnUnLoads, obj, func);
+			};
+		}
+		if (!widgetProto.onExecError) {
+			widgetProto.onExecError = function () {
+			};
+		}
+		if (!widgetProto.onContentError) {
+			widgetProto.onContentError = function () {
+			};
+		}
+		if (!widgetProto.onDownloadError) {
+			widgetProto.onDownloadError = function () {
+			};
+		}
+		if (!widgetProto.onDownloadStart) {
+			widgetProto.onDownloadStart = function (onDownloadStart) {
+			};
+		}
+		if (!widgetProto.onDownloadEnd) {
+			widgetProto.onDownloadEnd = function (url, data) {
+				var args = {content:data, url:url, adjustPaths:this.adjustPaths, collectScripts:this.executeScripts, collectRequires:this.parseContent, bodyExtract:this.extractContent};
+				data = _loader.splitAndFixPaths.call(this, args);
+				this.setContent(data);
+			};
+		}
+		if (!widgetProto.onSetContent) {
+			widgetProto.onSetContent = function (cont) {
+				this.destroyChildren();
+				var styleNodes = this.loader.styleNodes;
+				while (styleNodes.length) {
+					var st = styleNodes.pop();
+					if (st &amp;&amp; st.parentNode) {
+						st.parentNode.removeChild(st);
+					}
+				}
+				var node = this.containerNode || this.domNode;
+				while (node.firstChild) {
+					try {
+						dojo.event.browser.clean(node.firstChild);
+					}
+					catch (e) {
+					}
+					node.removeChild(node.firstChild);
+				}
+				try {
+					if (typeof cont != &quot;string&quot;) {
+						node.appendChild(cont);
+					} else {
+						try {
+							node.innerHTML = cont;
+						}
+						catch (e) {
+							var tmp;
+							(tmp = dojo.doc().createElement(&quot;div&quot;)).innerHTML = cont;
+							while (tmp.firstChild) {
+								node.appendChild(tmp.removeChild(tmp.firstChild));
+							}
+						}
+					}
+				}
+				catch (e) {
+					e._text = &quot;Could'nt load content: &quot; + e;
+					var useAlert = (this.loader._onSetContent_err == e._text);
+					this.loader._onSetContent_err = e._text;
+					handleDefaults.call(this, e, &quot;onContentError&quot;, useAlert);
+				}
+			};
+		}
+		if (!widgetProto.setUrl) {
+			widgetProto.setUrl = function (url) {
+				this.href = url;
+				this.loader.isLoaded = false;
+				if (this.preload || this.isShowing()) {
+					this.loadContents();
+				}
+			};
+		}
+		if (!widgetProto.setContent) {
+			widgetProto.setContent = function (data, dontLog) {
+				this.loader.callOnUnLoad.call(this, true);
+				if (!data || dojo.html.isNode(data)) {
+					this.onSetContent(data);
+					refreshed.call(this);
+				} else {
+					if (typeof data.xml != &quot;string&quot;) {
+						this.href = &quot;&quot;;
+						var args = {content:data, url:this.href, adjustPaths:this.adjustPaths, collectScripts:this.executeScripts, collectRequires:this.parseContent, bodyExtract:this.extractContent};
+						data = _loader.splitAndFixPaths.call(this, args);
+					} else {
+						if (data.url != &quot;./&quot;) {
+							this.url = data.url;
+						}
+					}
+					this.onSetContent(data.xml);
+					for (var i = 0, styles = data.styles; i &lt; styles.length; i++) {
+						if (styles[i].path) {
+							this.loader.styleNodes.push(dojo.html.insertCssFile(styles[i].path));
+						} else {
+							this.loader.styleNodes.push(dojo.html.insertCssText(styles[i]));
+						}
+					}
+					if (this.parseContent) {
+						for (var i = 0, requires = data.requires; i &lt; requires.length; i++) {
+							try {
+								eval(requires[i]);
+							}
+							catch (e) {
+								e._text = &quot;dojo.widget.html.loader.hookUp: error in package loading calls, &quot; + (e.description || e);
+								handleDefaults.call(this, e, &quot;onContentError&quot;, true);
+							}
+						}
+					}
+					if (dojo.hostenv.isXDomain &amp;&amp; data.requires.length) {
+						dojo.addOnLoad(function () {
+							asyncParse.call(this, data);
+							if (!dontLog) {
+								_loader._log(this, data);
+							}
+						});
+						dontLog = true;
+					} else {
+						asyncParse.call(this, data);
+					}
+				}
+				if (!dontLog) {
+				}
+			};
+		}
+		if (!widgetProto.onContentParse) {
+			widgetProto.onContentParse = function () {
+				var node = this.containerNode || this.domNode;
+				var parser = new dojo.xml.Parse();
+				var frag = parser.parseElement(node, null, true);
+				dojo.widget.getParser().createSubComponents(frag, this);
+			};
+		}
+		if (!widgetProto.onExecScript) {
+			widgetProto.onExecScript = function (scripts) {
+				var self = this, tmp = &quot;&quot;, code = &quot;&quot;;
+				for (var i = 0; i &lt; scripts.length; i++) {
+					if (scripts[i].path) {
+						var url = scripts[i].path;
+						downloader.call(this, {&quot;url&quot;:url, &quot;load&quot;:function (type, scriptStr) {
+							(function () {
+								tmp = scriptStr;
+								scripts[i] = scriptStr;
+							}).call(self);
+						}, &quot;error&quot;:function (type, error) {
+							error._text = type + &quot; downloading remote script&quot;;
+							handleDefaults.call(self, error, &quot;onExecError&quot;, true);
+						}, &quot;mimetype&quot;:&quot;text/plain&quot;, &quot;sync&quot;:true});
+						code += tmp;
+					} else {
+						code += scripts[i];
+					}
+				}
+				try {
+					delete this.scriptScope;
+					this.scriptScope = new (new Function(&quot;_container_&quot;, code + &quot;; return this;&quot;))(self);
+				}
+				catch (e) {
+					e._text = &quot;Error running scripts from content:\n&quot; + (e.description || e.toString());
+					handleDefaults.call(this, e, &quot;onExecError&quot;, true);
+				}
+			};
+		}
+		if (!widgetProto.setHandler) {
+			widgetProto.setHandler = function (handler) {
+				var fcn = dojo.lang.isFunction(handler) ? handler : window[handler];
+				if (!isFunc(fcn)) {
+					handleDefaults.call(this, &quot;Unable to set handler, '&quot; + handler + &quot;' not a function.&quot;, &quot;onExecError&quot;, true);
+					return;
+				}
+				this.handler = function () {
+					return fcn.apply(this, arguments);
+				};
+			};
+		}
+		widgetProto._loader_defined = true;
+	};
+})();
+

Added: tags/parley-0.55/root/static/magic/src/widget/html/stabile.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/html/stabile.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/html/stabile.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,128 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.html.stabile&quot;);
+dojo.widget.html.stabile = {_sqQuotables:new RegExp(&quot;([\\\\'])&quot;, &quot;g&quot;), _depth:0, _recur:false, depthLimit:2};
+dojo.widget.html.stabile.getState = function (id) {
+	dojo.widget.html.stabile.setup();
+	return dojo.widget.html.stabile.widgetState[id];
+};
+dojo.widget.html.stabile.setState = function (id, state, isCommit) {
+	dojo.widget.html.stabile.setup();
+	dojo.widget.html.stabile.widgetState[id] = state;
+	if (isCommit) {
+		dojo.widget.html.stabile.commit(dojo.widget.html.stabile.widgetState);
+	}
+};
+dojo.widget.html.stabile.setup = function () {
+	if (!dojo.widget.html.stabile.widgetState) {
+		var text = dojo.widget.html.stabile._getStorage().value;
+		dojo.widget.html.stabile.widgetState = text ? dj_eval(&quot;(&quot; + text + &quot;)&quot;) : {};
+	}
+};
+dojo.widget.html.stabile.commit = function (state) {
+	dojo.widget.html.stabile._getStorage().value = dojo.widget.html.stabile.description(state);
+};
+dojo.widget.html.stabile.description = function (v, showAll) {
+	var depth = dojo.widget.html.stabile._depth;
+	var describeThis = function () {
+		return this.description(this, true);
+	};
+	try {
+		if (v === void (0)) {
+			return &quot;undefined&quot;;
+		}
+		if (v === null) {
+			return &quot;null&quot;;
+		}
+		if (typeof (v) == &quot;boolean&quot; || typeof (v) == &quot;number&quot; || v instanceof Boolean || v instanceof Number) {
+			return v.toString();
+		}
+		if (typeof (v) == &quot;string&quot; || v instanceof String) {
+			var v1 = v.replace(dojo.widget.html.stabile._sqQuotables, &quot;\\$1&quot;);
+			v1 = v1.replace(/\n/g, &quot;\\n&quot;);
+			v1 = v1.replace(/\r/g, &quot;\\r&quot;);
+			return &quot;'&quot; + v1 + &quot;'&quot;;
+		}
+		if (v instanceof Date) {
+			return &quot;new Date(&quot; + d.getFullYear + &quot;,&quot; + d.getMonth() + &quot;,&quot; + d.getDate() + &quot;)&quot;;
+		}
+		var d;
+		if (v instanceof Array || v.push) {
+			if (depth &gt;= dojo.widget.html.stabile.depthLimit) {
+				return &quot;[ ... ]&quot;;
+			}
+			d = &quot;[&quot;;
+			var first = true;
+			dojo.widget.html.stabile._depth++;
+			for (var i = 0; i &lt; v.length; i++) {
+				if (first) {
+					first = false;
+				} else {
+					d += &quot;,&quot;;
+				}
+				d += arguments.callee(v[i], showAll);
+			}
+			return d + &quot;]&quot;;
+		}
+		if (v.constructor == Object || v.toString == describeThis) {
+			if (depth &gt;= dojo.widget.html.stabile.depthLimit) {
+				return &quot;{ ... }&quot;;
+			}
+			if (typeof (v.hasOwnProperty) != &quot;function&quot; &amp;&amp; v.prototype) {
+				throw new Error(&quot;description: &quot; + v + &quot; not supported by script engine&quot;);
+			}
+			var first = true;
+			d = &quot;{&quot;;
+			dojo.widget.html.stabile._depth++;
+			for (var key in v) {
+				if (v[key] == void (0) || typeof (v[key]) == &quot;function&quot;) {
+					continue;
+				}
+				if (first) {
+					first = false;
+				} else {
+					d += &quot;, &quot;;
+				}
+				var kd = key;
+				if (!kd.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)) {
+					kd = arguments.callee(key, showAll);
+				}
+				d += kd + &quot;: &quot; + arguments.callee(v[key], showAll);
+			}
+			return d + &quot;}&quot;;
+		}
+		if (showAll) {
+			if (dojo.widget.html.stabile._recur) {
+				var objectToString = Object.prototype.toString;
+				return objectToString.apply(v, []);
+			} else {
+				dojo.widget.html.stabile._recur = true;
+				return v.toString();
+			}
+		} else {
+			throw new Error(&quot;Unknown type: &quot; + v);
+			return &quot;'unknown'&quot;;
+		}
+	}
+	finally {
+		dojo.widget.html.stabile._depth = depth;
+	}
+};
+dojo.widget.html.stabile._getStorage = function () {
+	if (dojo.widget.html.stabile.dataField) {
+		return dojo.widget.html.stabile.dataField;
+	}
+	var form = document.forms._dojo_form;
+	return dojo.widget.html.stabile.dataField = form ? form.stabile : {value:&quot;&quot;};
+};
+

Added: tags/parley-0.55/root/static/magic/src/widget/nls/DropdownDatePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/DropdownDatePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/DropdownDatePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;selectDate&quot;:&quot;Select a date&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/nls/DropdownTimePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/DropdownTimePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/DropdownTimePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;selectTime&quot;:&quot;Select time&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/nls/TimePicker.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/TimePicker.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/TimePicker.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;any&quot;:&quot;any&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/nls/fr/validate.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/fr/validate.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/fr/validate.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;rangeMessage&quot;:&quot;* Cette valeur est hors limites.&quot;, &quot;invalidMessage&quot;:&quot;* La valeur saisie est incorrecte.&quot;, &quot;missingMessage&quot;:&quot;* Cette valeur est obligatoire.&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/nls/ja/validate.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/ja/validate.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/ja/validate.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;rangeMessage&quot;:&quot;* \u5165\u529b\u3057\u305f\u6570\u5024\u306f\u9078\u629e\u7bc4\u56f2\u5916\u3067\u3059\u3002&quot;, &quot;invalidMessage&quot;:&quot;* \u5165\u529b\u3057\u305f\u30c7\u30fc\u30bf\u306b\u8a72\u5f53\u3059\u308b\u3082\u306e\u304c\u3042\u308a\u307e\u305b\u3093\u3002&quot;, &quot;missingMessage&quot;:&quot;* \u5165\u529b\u304c\u5fc5\u9808\u3067\u3059\u3002&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/nls/validate.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/validate.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/validate.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;rangeMessage&quot;:&quot;* This value is out of range.&quot;, &quot;invalidMessage&quot;:&quot;* The value entered is not valid.&quot;, &quot;missingMessage&quot;:&quot;* This value is required.&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/nls/zh-cn/validate.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/nls/zh-cn/validate.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/nls/zh-cn/validate.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,13 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+({&quot;rangeMessage&quot;:&quot;* \u8f93\u5165\u6570\u636e\u8d85\u51fa\u503c\u57df\u3002&quot;, &quot;invalidMessage&quot;:&quot;* \u975e\u6cd5\u7684\u8f93\u5165\u503c\u3002&quot;, &quot;missingMessage&quot;:&quot;* \u6b64\u503c\u662f\u5fc5\u987b\u7684\u3002&quot;})
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/svg/Chart.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/svg/Chart.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/svg/Chart.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,472 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.svg.Chart&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.Chart&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.svg&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.require(&quot;dojo.json&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.svg.Chart&quot;, [dojo.widget.HtmlWidget, dojo.widget.Chart], function () {
+	this.templatePath = null;
+	this.templateCssPath = null;
+	this._isInitialize = false;
+	this.hasData = false;
+	this.vectorNode = null;
+	this.plotArea = null;
+	this.dataGroup = null;
+	this.axisGroup = null;
+	this.properties = {height:0, width:0, defaultWidth:600, defaultHeight:400, plotType:null, padding:{top:10, bottom:2, left:60, right:30}, axes:{x:{plotAt:0, label:&quot;&quot;, unitLabel:&quot;&quot;, unitType:Number, nUnitsToShow:10, range:{min:0, max:200}}, y:{plotAt:0, label:&quot;&quot;, unitLabel:&quot;&quot;, unitType:Number, nUnitsToShow:10, range:{min:0, max:200}}}};
+}, {parseProperties:function (node) {
+	var bRangeX = false;
+	var bRangeY = false;
+	if (node.getAttribute(&quot;width&quot;)) {
+		this.properties.width = node.getAttribute(&quot;width&quot;);
+	}
+	if (node.getAttribute(&quot;height&quot;)) {
+		this.properties.height = node.getAttribute(&quot;height&quot;);
+	}
+	if (node.getAttribute(&quot;plotType&quot;)) {
+		this.properties.plotType = node.getAttribute(&quot;plotType&quot;);
+	}
+	if (node.getAttribute(&quot;padding&quot;)) {
+		if (node.getAttribute(&quot;padding&quot;).indexOf(&quot;,&quot;) &gt; -1) {
+			var p = node.getAttribute(&quot;padding&quot;).split(&quot;,&quot;);
+		} else {
+			var p = node.getAttribute(&quot;padding&quot;).split(&quot; &quot;);
+		}
+		if (p.length == 1) {
+			var pad = parseFloat(p[0]);
+			this.properties.padding.top = pad;
+			this.properties.padding.right = pad;
+			this.properties.padding.bottom = pad;
+			this.properties.padding.left = pad;
+		} else {
+			if (p.length == 2) {
+				var padV = parseFloat(p[0]);
+				var padH = parseFloat(p[1]);
+				this.properties.padding.top = padV;
+				this.properties.padding.right = padH;
+				this.properties.padding.bottom = padV;
+				this.properties.padding.left = padH;
+			} else {
+				if (p.length == 4) {
+					this.properties.padding.top = parseFloat(p[0]);
+					this.properties.padding.right = parseFloat(p[1]);
+					this.properties.padding.bottom = parseFloat(p[2]);
+					this.properties.padding.left = parseFloat(p[3]);
+				}
+			}
+		}
+	}
+	if (node.getAttribute(&quot;rangeX&quot;)) {
+		var p = node.getAttribute(&quot;rangeX&quot;);
+		if (p.indexOf(&quot;,&quot;) &gt; -1) {
+			p = p.split(&quot;,&quot;);
+		} else {
+			p = p.split(&quot; &quot;);
+		}
+		this.properties.axes.x.range.min = parseFloat(p[0]);
+		this.properties.axes.x.range.max = parseFloat(p[1]);
+		bRangeX = true;
+	}
+	if (node.getAttribute(&quot;rangeY&quot;)) {
+		var p = node.getAttribute(&quot;rangeY&quot;);
+		if (p.indexOf(&quot;,&quot;) &gt; -1) {
+			p = p.split(&quot;,&quot;);
+		} else {
+			p = p.split(&quot; &quot;);
+		}
+		this.properties.axes.y.range.min = parseFloat(p[0]);
+		this.properties.axes.y.range.max = parseFloat(p[1]);
+		bRangeY = true;
+	}
+	return {rangeX:bRangeX, rangeY:bRangeY};
+}, setAxesPlot:function (table) {
+	if (table.getAttribute(&quot;axisAt&quot;)) {
+		var p = table.getAttribute(&quot;axisAt&quot;);
+		if (p.indexOf(&quot;,&quot;) &gt; -1) {
+			p = p.split(&quot;,&quot;);
+		} else {
+			p = p.split(&quot; &quot;);
+		}
+		if (!isNaN(parseFloat(p[0]))) {
+			this.properties.axes.x.plotAt = parseFloat(p[0]);
+		} else {
+			if (p[0].toLowerCase() == &quot;ymin&quot;) {
+				this.properties.axes.x.plotAt = this.properties.axes.y.range.min;
+			} else {
+				if (p[0].toLowerCase() == &quot;ymax&quot;) {
+					this.properties.axes.x.plotAt = this.properties.axes.y.range.max;
+				}
+			}
+		}
+		if (!isNaN(parseFloat(p[1]))) {
+			this.properties.axes.y.plotAt = parseFloat(p[1]);
+		} else {
+			if (p[1].toLowerCase() == &quot;xmin&quot;) {
+				this.properties.axes.y.plotAt = this.properties.axes.x.range.min;
+			} else {
+				if (p[1].toLowerCase() == &quot;xmax&quot;) {
+					this.properties.axes.y.plotAt = this.properties.axes.x.range.max;
+				}
+			}
+		}
+	} else {
+		this.properties.axes.x.plotAt = this.properties.axes.y.range.min;
+		this.properties.axes.y.plotAt = this.properties.axes.x.range.min;
+	}
+}, drawVectorNode:function () {
+	dojo.svg.g.suspend();
+	if (this.vectorNode) {
+		this.destroy();
+	}
+	this.vectorNode = document.createElementNS(dojo.svg.xmlns.svg, &quot;svg&quot;);
+	this.vectorNode.setAttribute(&quot;width&quot;, this.properties.width);
+	this.vectorNode.setAttribute(&quot;height&quot;, this.properties.height);
+	dojo.svg.g.resume();
+}, drawPlotArea:function () {
+	dojo.svg.g.suspend();
+	if (this.plotArea) {
+		this.plotArea.parentNode.removeChild(this.plotArea);
+		this.plotArea = null;
+	}
+	var defs = document.createElementNS(dojo.svg.xmlns.svg, &quot;defs&quot;);
+	var clip = document.createElementNS(dojo.svg.xmlns.svg, &quot;clipPath&quot;);
+	clip.setAttribute(&quot;id&quot;, &quot;plotClip&quot; + this.widgetId);
+	var rect = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+	rect.setAttribute(&quot;x&quot;, this.properties.padding.left);
+	rect.setAttribute(&quot;y&quot;, this.properties.padding.top);
+	rect.setAttribute(&quot;width&quot;, this.properties.width - this.properties.padding.left - this.properties.padding.right);
+	rect.setAttribute(&quot;height&quot;, this.properties.height - this.properties.padding.top - this.properties.padding.bottom);
+	clip.appendChild(rect);
+	defs.appendChild(clip);
+	this.vectorNode.appendChild(defs);
+	this.plotArea = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+	this.vectorNode.appendChild(this.plotArea);
+	var rect = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+	rect.setAttribute(&quot;x&quot;, this.properties.padding.left);
+	rect.setAttribute(&quot;y&quot;, this.properties.padding.top);
+	rect.setAttribute(&quot;width&quot;, this.properties.width - this.properties.padding.left - this.properties.padding.right);
+	rect.setAttribute(&quot;height&quot;, this.properties.height - this.properties.padding.top - this.properties.padding.bottom);
+	rect.setAttribute(&quot;fill&quot;, &quot;#fff&quot;);
+	this.plotArea.appendChild(rect);
+	dojo.svg.g.resume();
+}, drawDataGroup:function () {
+	dojo.svg.g.suspend();
+	if (this.dataGroup) {
+		this.dataGroup.parentNode.removeChild(this.dataGroup);
+		this.dataGroup = null;
+	}
+	this.dataGroup = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+	this.dataGroup.setAttribute(&quot;style&quot;, &quot;clip-path:url(#plotClip&quot; + this.widgetId + &quot;);&quot;);
+	this.plotArea.appendChild(this.dataGroup);
+	dojo.svg.g.resume();
+}, drawAxes:function () {
+	dojo.svg.g.suspend();
+	if (this.axisGroup) {
+		this.axisGroup.parentNode.removeChild(this.axisGroup);
+		this.axisGroup = null;
+	}
+	this.axisGroup = document.createElementNS(dojo.svg.xmlns.svg, &quot;g&quot;);
+	this.plotArea.appendChild(this.axisGroup);
+	var stroke = 1;
+	var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+	var y = dojo.widget.svg.Chart.Plotter.getY(this.properties.axes.x.plotAt, this);
+	line.setAttribute(&quot;y1&quot;, y);
+	line.setAttribute(&quot;y2&quot;, y);
+	line.setAttribute(&quot;x1&quot;, this.properties.padding.left - stroke);
+	line.setAttribute(&quot;x2&quot;, this.properties.width - this.properties.padding.right);
+	line.setAttribute(&quot;style&quot;, &quot;stroke:#000;stroke-width:&quot; + stroke + &quot;;&quot;);
+	this.axisGroup.appendChild(line);
+	var textSize = 10;
+	var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+	text.setAttribute(&quot;x&quot;, this.properties.padding.left);
+	text.setAttribute(&quot;y&quot;, this.properties.height - this.properties.padding.bottom + textSize + 2);
+	text.setAttribute(&quot;style&quot;, &quot;text-anchor:middle;font-size:&quot; + textSize + &quot;px;fill:#000;&quot;);
+	text.appendChild(document.createTextNode(dojo.math.round(parseFloat(this.properties.axes.x.range.min), 2)));
+	this.axisGroup.appendChild(text);
+	var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+	text.setAttribute(&quot;x&quot;, this.properties.width - this.properties.padding.right - (textSize / 2));
+	text.setAttribute(&quot;y&quot;, this.properties.height - this.properties.padding.bottom + textSize + 2);
+	text.setAttribute(&quot;style&quot;, &quot;text-anchor:middle;font-size:&quot; + textSize + &quot;px;fill:#000;&quot;);
+	text.appendChild(document.createTextNode(dojo.math.round(parseFloat(this.properties.axes.x.range.max), 2)));
+	this.axisGroup.appendChild(text);
+	var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;line&quot;);
+	var x = dojo.widget.svg.Chart.Plotter.getX(this.properties.axes.y.plotAt, this);
+	line.setAttribute(&quot;x1&quot;, x);
+	line.setAttribute(&quot;x2&quot;, x);
+	line.setAttribute(&quot;y1&quot;, this.properties.padding.top);
+	line.setAttribute(&quot;y2&quot;, this.properties.height - this.properties.padding.bottom);
+	line.setAttribute(&quot;style&quot;, &quot;stroke:#000;stroke-width:&quot; + stroke + &quot;;&quot;);
+	this.axisGroup.appendChild(line);
+	var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+	text.setAttribute(&quot;x&quot;, this.properties.padding.left - 4);
+	text.setAttribute(&quot;y&quot;, this.properties.height - this.properties.padding.bottom);
+	text.setAttribute(&quot;style&quot;, &quot;text-anchor:end;font-size:&quot; + textSize + &quot;px;fill:#000;&quot;);
+	text.appendChild(document.createTextNode(dojo.math.round(parseFloat(this.properties.axes.y.range.min), 2)));
+	this.axisGroup.appendChild(text);
+	var text = document.createElementNS(dojo.svg.xmlns.svg, &quot;text&quot;);
+	text.setAttribute(&quot;x&quot;, this.properties.padding.left - 4);
+	text.setAttribute(&quot;y&quot;, this.properties.padding.top + (textSize / 2));
+	text.setAttribute(&quot;style&quot;, &quot;text-anchor:end;font-size:&quot; + textSize + &quot;px;fill:#000;&quot;);
+	text.appendChild(document.createTextNode(dojo.math.round(parseFloat(this.properties.axes.y.range.max), 2)));
+	this.axisGroup.appendChild(text);
+	dojo.svg.g.resume();
+}, init:function () {
+	if (!this.properties.width || !this.properties.height) {
+		var box = dojo.html.getContentBox(this.domNode);
+		if (!this.properties.width) {
+			this.properties.width = (box.width &lt; 32) ? this.properties.defaultWidth : box.width;
+		}
+		if (!this.properties.height) {
+			this.properties.height = (box.height &lt; 32) ? this.properties.defaultHeight : box.height;
+		}
+	}
+	this.drawVectorNode();
+	this.drawPlotArea();
+	this.drawDataGroup();
+	this.drawAxes();
+	this.domNode.appendChild(this.vectorNode);
+	this.assignColors();
+	this._isInitialized = true;
+}, destroy:function () {
+	while (this.domNode.childNodes.length &gt; 0) {
+		this.domNode.removeChild(this.domNode.childNodes.item(0));
+	}
+	this.vectorNode = this.plotArea = this.dataGroup = this.axisGroup = null;
+}, render:function () {
+	dojo.svg.g.suspend();
+	if (this.dataGroup) {
+		while (this.dataGroup.childNodes.length &gt; 0) {
+			this.dataGroup.removeChild(this.dataGroup.childNodes.item(0));
+		}
+	} else {
+		this.init();
+	}
+	for (var i = 0; i &lt; this.series.length; i++) {
+		dojo.widget.svg.Chart.Plotter.plot(this.series[i], this);
+	}
+	dojo.svg.g.resume();
+}, postCreate:function () {
+	var table = this.domNode.getElementsByTagName(&quot;table&quot;)[0];
+	if (table) {
+		var ranges = this.parseProperties(table);
+		var bRangeX = false;
+		var bRangeY = false;
+		var axisValues = this.parseData(table);
+		if (!bRangeX) {
+			this.properties.axes.x.range = {min:axisValues.x.min, max:axisValues.x.max};
+		}
+		if (!bRangeY) {
+			this.properties.axes.y.range = {min:axisValues.y.min, max:axisValues.y.max};
+		}
+		this.setAxesPlot(table);
+		this.domNode.removeChild(table);
+	}
+	if (this.series.length &gt; 0) {
+		this.render();
+	}
+}});
+dojo.widget.svg.Chart.Plotter = new function () {
+	var self = this;
+	var plotters = {};
+	var types = dojo.widget.Chart.PlotTypes;
+	this.getX = function (value, chart) {
+		var v = parseFloat(value);
+		var min = chart.properties.axes.x.range.min;
+		var max = chart.properties.axes.x.range.max;
+		var ofst = 0 - min;
+		min += ofst;
+		max += ofst;
+		v += ofst;
+		var xmin = chart.properties.padding.left;
+		var xmax = chart.properties.width - chart.properties.padding.right;
+		var x = (v * ((xmax - xmin) / max)) + xmin;
+		return x;
+	};
+	this.getY = function (value, chart) {
+		var v = parseFloat(value);
+		var max = chart.properties.axes.y.range.max;
+		var min = chart.properties.axes.y.range.min;
+		var ofst = 0;
+		if (min &lt; 0) {
+			ofst += Math.abs(min);
+		}
+		min += ofst;
+		max += ofst;
+		v += ofst;
+		var ymin = chart.properties.height - chart.properties.padding.bottom;
+		var ymax = chart.properties.padding.top;
+		var y = (((ymin - ymax) / (max - min)) * (max - v)) + ymax;
+		return y;
+	};
+	this.addPlotter = function (name, func) {
+		plotters[name] = func;
+	};
+	this.plot = function (series, chart) {
+		if (series.values.length == 0) {
+			return;
+		}
+		if (series.plotType &amp;&amp; plotters[series.plotType]) {
+			return plotters[series.plotType](series, chart);
+		} else {
+			if (chart.plotType &amp;&amp; plotters[chart.plotType]) {
+				return plotters[chart.plotType](series, chart);
+			}
+		}
+	};
+	plotters[&quot;bar&quot;] = function (series, chart) {
+		var space = 1;
+		var lastW = 0;
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = self.getX(series.values[i].x, chart);
+			var w;
+			if (i == series.values.length - 1) {
+				w = lastW;
+			} else {
+				w = self.getX(series.values[i + 1].x, chart) - x - space;
+				lastW = w;
+			}
+			x -= (w / 2);
+			var yA = self.getY(chart.properties.axes.x.plotAt, chart);
+			var y = self.getY(series.values[i].value, chart);
+			var h = Math.abs(yA - y);
+			if (parseFloat(series.values[i].value) &lt; chart.properties.axes.x.plotAt) {
+				var oy = yA;
+				yA = y;
+				y = oy;
+			}
+			var bar = document.createElementNS(dojo.svg.xmlns.svg, &quot;rect&quot;);
+			bar.setAttribute(&quot;fill&quot;, series.color);
+			bar.setAttribute(&quot;title&quot;, series.label + &quot;: &quot; + series.values[i].value);
+			bar.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			bar.setAttribute(&quot;x&quot;, x);
+			bar.setAttribute(&quot;y&quot;, y);
+			bar.setAttribute(&quot;width&quot;, w);
+			bar.setAttribute(&quot;height&quot;, h);
+			bar.setAttribute(&quot;fill-opacity&quot;, &quot;0.9&quot;);
+			chart.dataGroup.appendChild(bar);
+		}
+	};
+	plotters[&quot;line&quot;] = function (series, chart) {
+		var tension = 1.5;
+		var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+		line.setAttribute(&quot;fill&quot;, &quot;none&quot;);
+		line.setAttribute(&quot;stroke&quot;, series.color);
+		line.setAttribute(&quot;stroke-width&quot;, &quot;2&quot;);
+		line.setAttribute(&quot;stroke-opacity&quot;, &quot;0.85&quot;);
+		line.setAttribute(&quot;title&quot;, series.label);
+		chart.dataGroup.appendChild(line);
+		var path = [];
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = self.getX(series.values[i].x, chart);
+			var y = self.getY(series.values[i].value, chart);
+			var dx = chart.properties.padding.left + 1;
+			var dy = chart.properties.height - chart.properties.padding.bottom;
+			if (i &gt; 0) {
+				dx = x - self.getX(series.values[i - 1].x, chart);
+				dy = self.getY(series.values[i - 1].value, chart);
+			}
+			if (i == 0) {
+				path.push(&quot;M&quot;);
+			} else {
+				path.push(&quot;C&quot;);
+				var cx = x - (tension - 1) * (dx / tension);
+				path.push(cx + &quot;,&quot; + dy);
+				cx = x - (dx / tension);
+				path.push(cx + &quot;,&quot; + y);
+			}
+			path.push(x + &quot;,&quot; + y);
+		}
+		line.setAttribute(&quot;d&quot;, path.join(&quot; &quot;));
+	};
+	plotters[&quot;area&quot;] = function (series, chart) {
+		var tension = 1.5;
+		var line = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+		line.setAttribute(&quot;fill&quot;, series.color);
+		line.setAttribute(&quot;fill-opacity&quot;, &quot;0.4&quot;);
+		line.setAttribute(&quot;stroke&quot;, series.color);
+		line.setAttribute(&quot;stroke-width&quot;, &quot;1&quot;);
+		line.setAttribute(&quot;stroke-opacity&quot;, &quot;0.8&quot;);
+		line.setAttribute(&quot;title&quot;, series.label);
+		chart.dataGroup.appendChild(line);
+		var path = [];
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = self.getX(series.values[i].x, chart);
+			var y = self.getY(series.values[i].value, chart);
+			var dx = chart.properties.padding.left + 1;
+			var dy = chart.properties.height - chart.properties.padding.bottom;
+			if (i &gt; 0) {
+				dx = x - self.getX(series.values[i - 1].x, chart);
+				dy = self.getY(series.values[i - 1].value, chart);
+			}
+			if (i == 0) {
+				path.push(&quot;M&quot;);
+			} else {
+				path.push(&quot;C&quot;);
+				var cx = x - (tension - 1) * (dx / tension);
+				path.push(cx + &quot;,&quot; + dy);
+				cx = x - (dx / tension);
+				path.push(cx + &quot;,&quot; + y);
+			}
+			path.push(x + &quot;,&quot; + y);
+		}
+		path.push(&quot;L&quot;);
+		path.push(x + &quot;,&quot; + self.getY(0, chart));
+		path.push(&quot;L&quot;);
+		path.push(self.getX(0, chart) + &quot;,&quot; + self.getY(0, chart));
+		path.push(&quot;Z&quot;);
+		line.setAttribute(&quot;d&quot;, path.join(&quot; &quot;));
+	}, plotters[&quot;scatter&quot;] = function (series, chart) {
+		var r = 7;
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = self.getX(series.values[i].x, chart);
+			var y = self.getY(series.values[i].value, chart);
+			var point = document.createElementNS(dojo.svg.xmlns.svg, &quot;path&quot;);
+			point.setAttribute(&quot;fill&quot;, series.color);
+			point.setAttribute(&quot;stroke-width&quot;, &quot;0&quot;);
+			point.setAttribute(&quot;title&quot;, series.label + &quot;: &quot; + series.values[i].value);
+			point.setAttribute(&quot;d&quot;, &quot;M &quot; + x + &quot;,&quot; + (y - r) + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + (x + r) + &quot;,&quot; + y + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + x + &quot;,&quot; + (y + r) + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + (x - r) + &quot;,&quot; + y + &quot; &quot; + &quot;Q &quot; + x + &quot;,&quot; + y + &quot; &quot; + x + &quot;,&quot; + (y - r) + &quot; &quot; + &quot;Z&quot;);
+			chart.dataGroup.appendChild(point);
+		}
+	};
+	plotters[&quot;bubble&quot;] = function (series, chart) {
+		var minR = 1;
+		var min = chart.properties.axes.x.range.min;
+		var max = chart.properties.axes.x.range.max;
+		var ofst = 0 - min;
+		min += ofst;
+		max += ofst;
+		var xmin = chart.properties.padding.left;
+		var xmax = chart.properties.width - chart.properties.padding.right;
+		var factor = (max - min) / (xmax - xmin) * 25;
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var size = series.values[i].size;
+			if (isNaN(parseFloat(size))) {
+				size = minR;
+			}
+			var point = document.createElementNS(dojo.svg.xmlns.svg, &quot;circle&quot;);
+			point.setAttribute(&quot;stroke-width&quot;, 0);
+			point.setAttribute(&quot;fill&quot;, series.color);
+			point.setAttribute(&quot;fill-opacity&quot;, &quot;0.8&quot;);
+			point.setAttribute(&quot;r&quot;, (parseFloat(size) * factor) / 2);
+			point.setAttribute(&quot;cx&quot;, self.getX(series.values[i].x, chart));
+			point.setAttribute(&quot;cy&quot;, self.getY(series.values[i].value, chart));
+			point.setAttribute(&quot;title&quot;, series.label + &quot;: &quot; + series.values[i].value + &quot; (&quot; + size + &quot;)&quot;);
+			chart.dataGroup.appendChild(point);
+		}
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,22 @@
+.dojoAccordionPane .label {
+	color: #000;
+	font-weight: bold;
+	background: url(&quot;images/soriaAccordionOff.gif&quot;) repeat-x top left #85aeec;
+	border:1px solid #d9d9d9;
+	font-size:0.9em;
+}
+
+.dojoAccordionPane-selected .label {
+	background: url(&quot;images/soriaAccordionSelected.gif&quot;) repeat-x top left #85aeec;
+	border:1px solid #84a3d1;
+}
+
+.dojoAccordionPane .label:hover {
+	cursor: pointer;
+}
+
+.dojoAccordionPane .accBody {
+	background: #fff;
+	overflow: auto;
+	border:1px solid #84a3d1;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/AccordionPane.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,4 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+&lt;div dojoAttachPoint=&quot;labelNode&quot; dojoAttachEvent=&quot;onclick: onLabelClick&quot; class=&quot;${this.labelNodeClass}&quot;&gt;${this.label}&lt;/div&gt;
+&lt;div dojoAttachPoint=&quot;containerNode&quot; style=&quot;overflow: hidden;&quot; class=&quot;${this.containerNodeClass}&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,59 @@
+/* ---- button --- */
+.dojoButton {
+	padding: 0 0 0 0;
+	font-size: 8pt;
+	white-space: nowrap;
+	cursor: pointer;
+	font-family: Myriad, Tahoma, Verdana, sans-serif;
+}
+
+.dojoButton .dojoButtonContents {
+	padding: 2px 2px 2px 2px;
+	text-align: center;		/* if icon and label are split across two lines, center icon */
+	color: white;
+}
+
+.dojoButtonLeftPart .dojoButtonContents {
+	padding-right: 8px;
+}
+
+.dojoButtonDisabled {
+	cursor: url(&quot;images/no.gif&quot;), default;
+}
+
+
+.dojoButtonContents img {
+	vertical-align: middle;	/* if icon and label are on same line, center them */
+}
+
+/* -------- colors ------------ */
+
+.dojoButtonHover .dojoButtonContents {
+}
+
+.dojoButtonDepressed .dojoButtonContents {
+	color: #293a4b;
+}
+
+.dojoButtonDisabled .dojoButtonContents {
+	color: #aaa;
+}
+
+
+/* ---------- drop down button specific ---------- */
+
+/* border between label and arrow (for drop down buttons */
+.dojoButton .border {
+	width: 1px;
+	background: gray;
+}
+
+/* button arrow */
+.dojoButton .downArrow {
+	padding-left: 10px;
+	text-align: center;
+}
+
+.dojoButton.disabled .downArrow {
+	cursor : default;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ButtonTemplate.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+&lt;div dojoAttachPoint=&quot;buttonNode&quot; class=&quot;dojoButton&quot; style=&quot;position:relative;&quot; dojoAttachEvent=&quot;onMouseOver; onMouseOut; onMouseDown; onMouseUp; onClick:buttonClick; onKey:onKey; onFocus;&quot;&gt;
+  &lt;div class=&quot;dojoButtonContents&quot; align=center dojoAttachPoint=&quot;containerNode&quot; style=&quot;position:absolute;z-index:2;&quot;&gt;&lt;/div&gt;
+  &lt;img dojoAttachPoint=&quot;leftImage&quot; style=&quot;position:absolute;left:0px;&quot;&gt;
+  &lt;img dojoAttachPoint=&quot;centerImage&quot; style=&quot;position:absolute;z-index:1;&quot;&gt;
+  &lt;img dojoAttachPoint=&quot;rightImage&quot; style=&quot;position:absolute;top:0px;right:0px;&quot;&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,26 @@
+.dojoHtmlCheckbox {
+	border: 0px;
+	width: 16px;
+	height: 16px;
+	margin: 2px;
+	vertical-align: middle;
+}
+
+.dojoHtmlCheckboxOn {
+	background: url(check.gif) 0px 0px;
+}
+.dojoHtmlCheckboxOff {
+	background: url(check.gif) -16px 0px;
+}
+.dojoHtmlCheckboxDisabledOn {
+	background: url(check.gif) -32px 0px;
+}
+.dojoHtmlCheckboxDisabledOff {
+	background: url(check.gif) -48px 0px;
+}
+.dojoHtmlCheckboxOnHover {
+	background: url(check.gif) -64px 0px;
+}
+.dojoHtmlCheckboxOffHover {
+	background: url(check.gif) -80px 0px;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Checkbox.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,5 @@
+&lt;span style=&quot;display: inline-block;&quot; tabIndex=&quot;${this.tabIndex}&quot; waiRole=&quot;checkbox&quot; id=&quot;${this.id}&quot;&gt;
+	&lt;img dojoAttachPoint=&quot;imageNode&quot; class=&quot;dojoHtmlCheckbox&quot; src=&quot;${dojoWidgetModuleUri}templates/images/blank.gif&quot; alt=&quot;&quot; /&gt;
+	&lt;input type=&quot;checkbox&quot; name=&quot;${this.name}&quot; style=&quot;display: none&quot; value=&quot;${this.value}&quot;
+		dojoAttachPoint=&quot;inputNode&quot;&gt;
+&lt;/span&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/CheckboxA11y.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/CheckboxA11y.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/CheckboxA11y.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,4 @@
+&lt;span class='dojoHtmlCheckbox'&gt;
+	&lt;input type=&quot;checkbox&quot; name=&quot;${this.name}&quot; tabIndex=&quot;${this.tabIndex}&quot; id=&quot;${this.id}&quot; value=&quot;${this.value}&quot;
+		 dojoAttachEvent=&quot;onClick: _onClick;&quot; dojoAttachPoint=&quot;inputNode&quot;&gt; 
+&lt;/span&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/CiviCrmDatePicker.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/CiviCrmDatePicker.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/CiviCrmDatePicker.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,12 @@
+&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot; width=&quot;400&quot;&gt;
+	&lt;tr&gt;
+		&lt;td id=&quot;dateHolderTd&quot; width=&quot;200&quot;&gt;
+		&lt;/td&gt;
+		&lt;td id=&quot;timeHolderTd&quot; width=&quot;200&quot;&gt;
+		&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr style=&quot;display: none;&quot; id=&quot;formItemsTr&quot;&gt;
+		&lt;td id=&quot;formItemsTd&quot;&gt;&nbsp;&lt;/td&gt;
+		&lt;td&gt;&nbsp;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,68 @@
+.dojoComboBoxOuter {
+	border: 0px !important;
+	margin: 0px !important;
+	padding: 0px !important;
+	background: transparent !important;
+	white-space: nowrap !important;
+}
+
+.dojoComboBox {
+	border: 1px inset #afafaf;
+	margin: 0px;
+	padding: 0px;
+	vertical-align: middle !important;
+	float: none !important;
+	position: static !important;
+	display: inline !important;
+}
+
+/* the input box */
+input.dojoComboBox {
+	border-right-width: 0px !important; 
+	margin-right: 0px !important;
+	padding-right: 0px !important;
+}
+
+/* the down arrow */
+img.dojoComboBox {
+	border-left-width: 0px !important;
+	padding-left: 0px !important;
+	margin-left: 0px !important;
+}
+
+/* IE vertical-alignment calculations can be off by +-1 but these margins are collapsed away */
+.dj_ie img.dojoComboBox {
+	margin-top: 1px; 
+	margin-bottom: 1px; 
+}
+
+/* the drop down */
+.dojoComboBoxOptions {
+	font-family: Verdana, Helvetica, Garamond, sans-serif;
+	/* font-size: 0.7em; */
+	background-color: white;
+	border: 1px solid #afafaf;
+	position: absolute;
+	z-index: 1000; 
+	overflow: auto;
+	cursor: default;
+}
+
+.dojoComboBoxItem {
+	padding-left: 2px;
+	padding-top: 2px;
+	margin: 0px;
+}
+
+.dojoComboBoxItemEven {
+	background-color: #f4f4f4;
+}
+
+.dojoComboBoxItemOdd {
+	background-color: white;
+}
+
+.dojoComboBoxItemHighlight {
+	background-color: #63709A;
+	color: white;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ComboBox.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+&lt;span _=&quot;whitespace and CR's between tags adds &nbsp; in FF&quot;
+	class=&quot;dojoComboBoxOuter&quot;
+	&gt;&lt;input style=&quot;display:none&quot;  tabindex=&quot;-1&quot; name=&quot;&quot; value=&quot;&quot; 
+		dojoAttachPoint=&quot;comboBoxValue&quot;
+	&gt;&lt;input style=&quot;display:none&quot;  tabindex=&quot;-1&quot; name=&quot;&quot; value=&quot;&quot; 
+		dojoAttachPoint=&quot;comboBoxSelectionValue&quot;
+	&gt;&lt;input type=&quot;text&quot; autocomplete=&quot;off&quot; class=&quot;dojoComboBox&quot;
+		dojoAttachEvent=&quot;key:_handleKeyEvents; keyUp: onKeyUp; compositionEnd; onResize;&quot;
+		dojoAttachPoint=&quot;textInputNode&quot;
+	&gt;&lt;img hspace=&quot;0&quot;
+		vspace=&quot;0&quot;
+		class=&quot;dojoComboBox&quot;
+		dojoAttachPoint=&quot;downArrowNode&quot;
+		dojoAttachEvent=&quot;onMouseUp: handleArrowClick; onResize;&quot;
+		src=&quot;${this.buttonSrc}&quot;
+&gt;&lt;/span&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ComboButtonTemplate.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ComboButtonTemplate.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ComboButtonTemplate.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,18 @@
+&lt;div class=&quot;dojoButton&quot; style=&quot;position:relative;top:0px;left:0px; text-align:none;&quot; dojoAttachEvent=&quot;onKey;onFocus&quot;&gt;
+
+	&lt;div dojoAttachPoint=&quot;buttonNode&quot; class=&quot;dojoButtonLeftPart&quot; style=&quot;position:absolute;left:0px;top:0px;&quot;
+		dojoAttachEvent=&quot;onMouseOver; onMouseOut; onMouseDown; onMouseUp; onClick:buttonClick;&quot;&gt;
+		&lt;div class=&quot;dojoButtonContents&quot; dojoAttachPoint=&quot;containerNode&quot; style=&quot;position:absolute;top:0px;right:0px;z-index:2;&quot;&gt;&lt;/div&gt;
+		&lt;img dojoAttachPoint=&quot;leftImage&quot; style=&quot;position:absolute;left:0px;top:0px;&quot;&gt;
+		&lt;img dojoAttachPoint=&quot;centerImage&quot; style=&quot;position:absolute;right:0px;top:0px;z-index:1;&quot;&gt;
+	&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;rightPart&quot; class=&quot;dojoButtonRightPart&quot; style=&quot;position:absolute;top:0px;right:0px;&quot;
+		dojoAttachEvent=&quot;onMouseOver:rightOver; onMouseOut:rightOut; onMouseDown:rightDown; onMouseUp:rightUp; onClick:rightClick;&quot;&gt;
+		&lt;img dojoAttachPoint=&quot;arrowBackgroundImage&quot; style=&quot;position:absolute;top:0px;left:0px;z-index:1;&quot;&gt;
+		&lt;img src=&quot;${dojoWidgetModuleUri}templates/images/whiteDownArrow.gif&quot;
+		  		style=&quot;z-index:2;position:absolute;left:3px;top:50%;&quot;&gt;
+		&lt;img dojoAttachPoint=&quot;rightImage&quot; style=&quot;position:absolute;top:0px;right:0px;&quot;&gt;
+	&lt;/div&gt;
+
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,167 @@
+.datePickerContainer {
+	width:164px; /* needed for proper user styling */
+}
+
+.calendarContainer {
+/*	border:1px solid #566f8f;*/
+}
+
+.calendarBodyContainer {
+	width:100%; /* needed for the explode effect (explain?) */
+	background: #7591bc url(&quot;images/dpBg.gif&quot;) top left repeat-x;
+}
+
+.calendarBodyContainer thead tr td {
+	color:#293a4b;
+	font:bold 0.75em Helvetica, Arial, Verdana, sans-serif;
+	text-align:center;
+	padding:0.25em;
+	background: url(&quot;images/dpHorizLine.gif&quot;) bottom left repeat-x;
+}
+
+.calendarBodyContainer tbody tr td {
+	color:#fff;
+	font:bold 0.7em Helvetica, Arial, Verdana, sans-serif;
+	text-align:center;
+	padding:0.4em;
+	background: url(&quot;images/dpVertLine.gif&quot;) top right repeat-y;
+	cursor:pointer;
+	cursor:hand;
+}
+
+
+.monthWrapper {
+	padding-bottom:2px;
+	background: url(&quot;images/dpHorizLine.gif&quot;) bottom left repeat-x;
+}
+
+.monthContainer {
+	width:100%;
+}
+
+.monthLabelContainer {
+	text-align:center;
+	font:bold 0.75em Helvetica, Arial, Verdana, sans-serif;
+	background: url(&quot;images/dpMonthBg.png&quot;) repeat-x top left !important;
+	color:#293a4b;
+	padding:0.25em;
+}
+
+.monthCurve {
+	width:12px;
+}
+
+.monthCurveTL {
+	background: url(&quot;images/dpCurveTL.png&quot;) no-repeat top left !important;
+}
+
+.monthCurveTR {
+		background: url(&quot;images/dpCurveTR.png&quot;) no-repeat top right !important;
+}
+
+
+.yearWrapper {
+	background: url(&quot;images/dpHorizLineFoot.gif&quot;) top left repeat-x;
+	padding-top:2px;
+}
+
+.yearContainer {
+	width:100%;
+}
+
+.yearContainer td {
+	background:url(&quot;images/dpYearBg.png&quot;) top left repeat-x;
+}
+
+.yearContainer .yearLabel {
+	margin:0;
+	padding:0.45em 0 0.45em 0;
+	color:#fff;
+	font:bold 0.75em Helvetica, Arial, Verdana, sans-serif;
+	text-align:center;
+}
+
+.curveBL {
+	background: url(&quot;images/dpCurveBL.png&quot;) bottom left no-repeat !important;
+	width:9px !important;
+	padding:0;
+	margin:0;
+}
+
+.curveBR {
+	background: url(&quot;images/dpCurveBR.png&quot;) bottom right no-repeat !important;
+	width:9px !important;
+	padding:0;
+	margin:0;
+}
+
+
+.previousMonth {
+	background-color:#6782a8 !important;
+}
+
+.previousMonthDisabled {
+	background-color:#a4a5a6 !important;
+	cursor:default !important
+}
+.currentMonth {
+}
+
+.currentMonthDisabled {
+	background-color:#bbbbbc !important;
+	cursor:default !important
+}
+.nextMonth {
+	background-color:#6782a8 !important;
+}
+.nextMonthDisabled {
+	background-color:#a4a5a6 !important;
+	cursor:default !important;
+}
+
+.currentDate {
+	text-decoration:underline;
+	font-style:italic;
+}
+
+.selectedDate {
+	background-color:#fff !important;
+	color:#6782a8 !important;
+}
+
+.yearLabel .selectedYear {
+	padding:0.2em;
+	background-color:#9ec3fb !important;
+}
+
+.nextYear, .previousYear {
+	cursor:pointer;cursor:hand;
+	padding:0;
+}
+
+.nextYear {
+	margin:0 0 0 0.55em;
+}
+
+.previousYear {
+	margin:0 0.55em 0 0;
+}
+
+.incrementControl {
+	cursor:pointer;cursor:hand;
+	width:1em;
+}
+
+.increase {
+	float:right;
+}
+
+.decrease {
+	float:left;
+}
+
+.lastColumn {
+	background-image:none !important;
+}
+
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/DatePicker.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,95 @@
+&lt;div class=&quot;datePickerContainer&quot; dojoAttachPoint=&quot;datePickerContainerNode&quot;&gt;
+	&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; class=&quot;calendarContainer&quot;&gt;
+		&lt;thead&gt;
+			&lt;tr&gt;
+				&lt;td class=&quot;monthWrapper&quot; valign=&quot;top&quot;&gt;
+					&lt;table class=&quot;monthContainer&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
+						&lt;tr&gt;
+							&lt;td class=&quot;monthCurve monthCurveTL&quot; valign=&quot;top&quot;&gt;&lt;/td&gt;
+							&lt;td class=&quot;monthLabelContainer&quot; valign=&quot;top&quot;&gt;
+								&lt;span dojoAttachPoint=&quot;increaseWeekNode&quot; 
+									dojoAttachEvent=&quot;onClick: onIncrementWeek;&quot; 
+									class=&quot;incrementControl increase&quot;&gt;
+									&lt;img src=&quot;${dojoWidgetModuleUri}templates/images/incrementMonth.png&quot; 
+									alt=&quot;&darr;&quot; style=&quot;width:7px;height:5px;&quot; /&gt;
+								&lt;/span&gt;
+								&lt;span 
+									dojoAttachPoint=&quot;increaseMonthNode&quot; 
+									dojoAttachEvent=&quot;onClick: onIncrementMonth;&quot; class=&quot;incrementControl increase&quot;&gt;
+									&lt;img src=&quot;${dojoWidgetModuleUri}templates/images/incrementMonth.png&quot; 
+										alt=&quot;&darr;&quot;  dojoAttachPoint=&quot;incrementMonthImageNode&quot;&gt;
+								&lt;/span&gt;
+								&lt;span 
+									dojoAttachPoint=&quot;decreaseWeekNode&quot; 
+									dojoAttachEvent=&quot;onClick: onIncrementWeek;&quot; 
+									class=&quot;incrementControl decrease&quot;&gt;
+									&lt;img src=&quot;${dojoWidgetModuleUri}templates/images/decrementMonth.png&quot; alt=&quot;&uarr;&quot; style=&quot;width:7px;height:5px;&quot; /&gt;
+								&lt;/span&gt;
+								&lt;span 
+									dojoAttachPoint=&quot;decreaseMonthNode&quot; 
+									dojoAttachEvent=&quot;onClick: onIncrementMonth;&quot; class=&quot;incrementControl decrease&quot;&gt;
+									&lt;img src=&quot;${dojoWidgetModuleUri}templates/images/decrementMonth.png&quot; 
+										alt=&quot;&uarr;&quot; dojoAttachPoint=&quot;decrementMonthImageNode&quot;&gt;
+								&lt;/span&gt;
+								&lt;span dojoAttachPoint=&quot;monthLabelNode&quot; class=&quot;month&quot;&gt;&lt;/span&gt;
+							&lt;/td&gt;
+							&lt;td class=&quot;monthCurve monthCurveTR&quot; valign=&quot;top&quot;&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/thead&gt;
+		&lt;tbody&gt;
+			&lt;tr&gt;
+				&lt;td colspan=&quot;3&quot;&gt;
+					&lt;table class=&quot;calendarBodyContainer&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
+						&lt;thead&gt;
+							&lt;tr dojoAttachPoint=&quot;dayLabelsRow&quot;&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/thead&gt;
+						&lt;tbody dojoAttachPoint=&quot;calendarDatesContainerNode&quot; 
+							dojoAttachEvent=&quot;onClick: _handleUiClick;&quot;&gt;
+							&lt;tr dojoAttachPoint=&quot;calendarWeekTemplate&quot;&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+								&lt;td&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/tbody&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+		&lt;tfoot&gt;
+			&lt;tr&gt;
+				&lt;td colspan=&quot;3&quot; class=&quot;yearWrapper&quot;&gt;
+					&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; class=&quot;yearContainer&quot;&gt;
+						&lt;tr&gt;
+							&lt;td class=&quot;curveBL&quot; valign=&quot;top&quot;&gt;&lt;/td&gt;
+							&lt;td valign=&quot;top&quot;&gt;
+								&lt;h3 class=&quot;yearLabel&quot;&gt;
+									&lt;span dojoAttachPoint=&quot;previousYearLabelNode&quot;
+										dojoAttachEvent=&quot;onClick: onIncrementYear;&quot; class=&quot;previousYear&quot;&gt;&lt;/span&gt;
+									&lt;span class=&quot;selectedYear&quot; dojoAttachPoint=&quot;currentYearLabelNode&quot;&gt;&lt;/span&gt;
+									&lt;span dojoAttachPoint=&quot;nextYearLabelNode&quot; 
+										dojoAttachEvent=&quot;onClick: onIncrementYear;&quot; class=&quot;nextYear&quot;&gt;&lt;/span&gt;
+								&lt;/h3&gt;
+							&lt;/td&gt;
+							&lt;td class=&quot;curveBR&quot; valign=&quot;top&quot;&gt;&lt;/td&gt;
+						&lt;/tr&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tfoot&gt;
+	&lt;/table&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/DemoEngine.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/DemoEngine.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/DemoEngine.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+	&lt;div dojoAttachPoint=&quot;navigationNode&quot;&gt;
+		&lt;table border=&quot;0&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot;&gt;
+			&lt;tr&gt;
+				&lt;td width=&quot;1%&quot; valign=&quot;top&quot; class=&quot;navigationCell&quot;&gt;&lt;h1&gt;Categories&lt;/h1&gt;&lt;div dojoAttachPoint=&quot;menuNavigationNode&quot;&gt;&lt;/div&gt;&lt;/td&gt;
+				&lt;td width=&quot;99%&quot; valign=&quot;top&quot;&gt;
+					&lt;div dojoAttachPoint=&quot;demoNavigationNode&quot;&gt;
+					&lt;/div&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/table&gt;
+	&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;demoContainerNode&quot;&gt;
+
+		&lt;div dojoAttachPoint=&quot;demoPaneNode&quot;&gt;
+		&lt;/div&gt;
+
+		&lt;div dojoAttachPoint=&quot;demoHeaderNode&quot;&gt;
+			&lt;span dojoAttachPoint=&quot;collapsedMenuNode&quot; dojoAttachEvent=&quot;onclick: expandDemoNavigation&quot;&gt;&lt;/span&gt;
+			&lt;div dojoAttachPoint=&quot;aboutNode&quot;&gt;About this Demo&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Dialog.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Dialog.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Dialog.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,7 @@
+&lt;div id=&quot;${this.widgetId}&quot; class=&quot;dojoDialog&quot; dojoattachpoint=&quot;wrapper&quot;&gt;
+	&lt;span dojoattachpoint=&quot;tabStartOuter&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot;	tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;span dojoattachpoint=&quot;tabStart&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot; tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;div dojoattachpoint=&quot;containerNode&quot; style=&quot;position: relative; z-index: 2;&quot;&gt;&lt;/div&gt;
+	&lt;span dojoattachpoint=&quot;tabEnd&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot; tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;span dojoattachpoint=&quot;tabEndOuter&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot; tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,49 @@
+.dojoDocPane { padding:1em; font: 1em Georgia,Times,&quot;Times New Roman&quot;,serif; }
+
+.dojoDocPane .container{ }
+
+.dojoDocPane .dialog{ }
+.dojoDocPane .dialog .container{ padding: 0.5em; background: #fff; border: 2px solid #333; }
+.dojoDocPane .dialog .docDialog{ background: transparent; width: 20em; }
+.dojoDocPane .dialog .docDialog h2{ margin-top: 0; padding-top: 0; }
+.dojoDocPane .dialog .docDialog input { float: right; margin-right: 1em; }
+.dojoDocPane .dialog .docDialog p{ clear: both; }
+#dojoDocUserName, #dojoDocPassword { width: 10em; }
+
+.dojoDocPane .nav{ }
+.dojoDocPane .nav span{ }
+
+.dojoDocPane .detail{ }
+.dojoDocPane .detail h1{ }
+.dojoDocPane .detail h1 span.fn{ }
+.dojoDocPane .detail .description{ }
+.dojoDocPane .detail .params{ }
+.dojoDocPane .detail .params .row{ }
+.dojoDocPane .detail .params .row span{ }
+.dojoDocPane .detail .variables{ }
+.dojoDocPane .detail .variables .row{ }
+.dojoDocPane .detail .signature{ }
+.dojoDocPane .detail .signature .source{ white-space: pre; font: 0.8em Monaco, Courier, &quot;Courier New&quot;, monospace; }
+.dojoDocPane .detail .signature .source .return{ color:#369; }
+.dojoDocPane .detail .signature .source .function{ color: #98543F; font-weight: bold; }
+.dojoDocPane .detail .signature .source .params{ }
+.dojoDocPane .detail .signature .source .params .type{ font-style: italic; color: #d17575; }
+.dojoDocPane .detail .signature .source .params .name{ color: #d14040; }
+
+.dojoDocPane .result{ }
+.dojoDocPane .result h1{ }
+.dojoDocPane .result .row{ }
+.dojoDocPane .result .row .summary{ }
+
+.dojoDocPane .package{ }
+.dojoDocPane .package h1{ }
+.dojoDocPane .package .row{ }
+.dojoDocPane .package .row .summary{ }
+.dojoDocPane .package .description{ }
+.dojoDocPane .package .methods{ }
+.dojoDocPane .package .methods h2{ }
+.dojoDocPane .package .methods .row{ }
+.dojoDocPane .package .methods .row .description{ }
+.dojoDocPane .package .requires{ }
+.dojoDocPane .package .requires h2{ }
+.dojoDocPane .package .requires .row{ }

Added: tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/DocPane.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,79 @@
+&lt;div class=&quot;dojoDocPane&quot;&gt;
+	&lt;div dojoAttachPoint=&quot;containerNode&quot; class=&quot;container&quot;&gt;&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;dialog&quot; class=&quot;dialog&quot;&gt;
+		&lt;div class=&quot;container&quot; dojoAttachPoint=&quot;dialogBg&quot;&gt;
+			&lt;div class=&quot;docDialog&quot; dojoAttachPoint=&quot;dialogFg&quot;&gt;
+				&lt;h2&gt;Log In&lt;/h2&gt;
+				&lt;p&gt;&lt;input id=&quot;dojoDocUserName&quot; dojoAttachPoint=&quot;userName&quot;&gt;&lt;label for=&quot;dojoDocUserName&quot;&gt;User Name:&lt;/label&gt;&lt;/p&gt;
+				&lt;p&gt;&lt;input id=&quot;dojoDocPassword&quot; dojoAttachPoint=&quot;password&quot; type=&quot;password&quot;&gt;&lt;label for=&quot;dojoDocPassword&quot;&gt;Password:&lt;/label&gt;&lt;/p&gt;
+				&lt;p&gt;&lt;input type=&quot;button&quot; dojoAttachPoint=&quot;cancel&quot; value=&quot;cancel&quot;&gt; &lt;input type=&quot;button&quot; dojoAttachPoint=&quot;logIn&quot; value=&quot;Log In&quot;&gt;&lt;/p&gt;
+				&lt;p&gt;&lt;/p&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;nav&quot; class=&quot;nav&quot;&gt;&lt;span&gt;Detail&lt;/span&gt; | &lt;span&gt;Source&lt;/span&gt; | &lt;span&gt;Examples&lt;/span&gt; | &lt;span&gt;Walkthrough&lt;/span&gt;&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;detail&quot; class=&quot;detail&quot;&gt;
+		&lt;h1&gt;Detail: &lt;span class=&quot;fn&quot; dojoAttachPoint=&quot;fn&quot;&gt;dojo.select&lt;/span&gt;&lt;/h1&gt;
+		&lt;div class=&quot;description&quot; dojoAttachPoint=&quot;description&quot;&gt;Description&lt;/div&gt;
+		&lt;div class=&quot;params&quot; dojoAttachPoint=&quot;parameters&quot;&gt;
+			&lt;h2&gt;Parameters&lt;/h2&gt;
+			&lt;div class=&quot;row&quot; dojoAttachPoint=&quot;pRow&quot;&gt;
+				&lt;span dojoAttachPoint=&quot;pOpt&quot;&gt;&lt;em&gt;optional&lt;/em&gt; &lt;/span&gt;
+				&lt;span&gt;&lt;span dojoAttachPoint=&quot;pType&quot;&gt;type&lt;/span&gt; &lt;/span&gt;
+				&lt;a href=&quot;#&quot; dojoAttachPoint=&quot;pLink&quot;&gt;variable&lt;/a&gt;
+				&lt;span&gt; - &lt;span dojoAttachPoint=&quot;pDesc&quot;&gt;&lt;/span&gt;&lt;/span&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		&lt;div class=&quot;variables&quot; dojoAttachPoint=&quot;variables&quot;&gt;
+			&lt;h2&gt;Variables&lt;/h2&gt;
+			&lt;div class&quot;row&quot; dojoAttachPoint=&quot;vRow&quot;&gt;
+				&lt;a href=&quot;#&quot; dojoAttachPoint=&quot;vLink&quot;&gt;variable&lt;/a&gt;&lt;span&gt; - &lt;span dojoAttachPoint=&quot;vDesc&quot;&gt;&lt;/span&gt;&lt;/span&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		&lt;div class=&quot;signature&quot;&gt;
+			&lt;h2&gt;Signature&lt;/h2&gt;
+			&lt;div class=&quot;source&quot;&gt;
+				&lt;span class=&quot;return&quot; dojoAttachPoint=&quot;sType&quot;&gt;returnType&lt;/span&gt; 
+				&lt;span class=&quot;function&quot; dojoAttachPoint=&quot;sName&quot;&gt;foo&lt;/span&gt;
+				(&lt;span class=&quot;params&quot; dojoAttachPoint=&quot;sParams&quot;&gt;
+					&lt;span class=&quot;type&quot; dojoAttachPoint=&quot;sPType&quot;&gt;type &lt;/span&gt;
+					&lt;span class=&quot;name&quot; dojoAttachPoint=&quot;sPName&quot;&gt;paramName&lt;/span&gt;
+				&lt;/span&gt;)
+			&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	
+	&lt;div dojoAttachPoint=&quot;result&quot; class=&quot;result&quot;&gt;
+		&lt;h1&gt;Search Results: &lt;span dojoAttachPoint=&quot;count&quot;&gt;0&lt;/span&gt; matches&lt;/h1&gt;
+		&lt;div class=&quot;row&quot; dojoAttachPoint=&quot;row&quot;&gt;
+			&lt;a href=&quot;#&quot; dojoAttachPoint=&quot;fnLink&quot;&gt;dojo.fnLink&lt;/a&gt;
+			&lt;span&gt; - &lt;span class=&quot;summary&quot; dojoAttachPoint=&quot;summary&quot;&gt;summary&lt;/span&gt;&lt;/span&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;packag&quot; class=&quot;package&quot;&gt;
+		&lt;h1&gt;Package: 
+			&lt;span class=&quot;pkg&quot; dojoAttachPoint=&quot;pkg&quot;&gt;dojo.package&lt;/span&gt; 
+			&lt;span class=&quot;edit&quot; dojoAttachPoint=&quot;edit&quot;&gt;[edit]&lt;/span&gt; 
+			&lt;span class=&quot;save&quot; dojoAttachPoint=&quot;save&quot;&gt;[save]&lt;/span&gt;
+		&lt;/h1&gt;
+		&lt;div dojoAttachPoint=&quot;pkgDescription&quot; class=&quot;description&quot;&gt;Description&lt;/div&gt;
+		&lt;div class=&quot;methods&quot; dojoAttachPoint=&quot;methods&quot;&gt;
+			&lt;h2&gt;Methods&lt;/h2&gt;
+			&lt;div class=&quot;row&quot; dojoAttachPoint=&quot;mRow&quot;&gt;
+				&lt;a href=&quot;#&quot; dojoAttachPoint=&quot;mLink&quot;&gt;method&lt;/a&gt;
+				&lt;span&gt; - &lt;span class=&quot;description&quot; dojoAttachPoint=&quot;mDesc&quot;&gt;&lt;/span&gt;&lt;/span&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+		&lt;div class=&quot;requires&quot; dojoAttachPoint=&quot;requires&quot;&gt;
+			&lt;h2&gt;Requires&lt;/h2&gt;
+			&lt;div class=&quot;row&quot; dojoAttachPoint=&quot;rRow&quot;&gt;
+				&lt;h3 dojoAttachPoint=&quot;rH3&quot;&gt;Environment&lt;/h3&gt;
+				&lt;div dojoAttachPoint=&quot;rRow2&quot;&gt;&lt;a href=&quot;#&quot; dojoAttachPoint=&quot;rLink&quot; class=&quot;package&quot;&gt;require&lt;/a&gt;&lt;/div&gt;
+			&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/DropDownButtonTemplate.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/DropDownButtonTemplate.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/DropDownButtonTemplate.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,9 @@
+&lt;button dojoAttachPoint=&quot;button&quot; class=&quot;dojoButton dojoButtonNoHover&quot; dojoAttachEvent=&quot;onMouseOver: ; onMouseOut: ; onClick: ;&quot;&gt;
+  &lt;table dojoAttachPoint=&quot;table&quot; style=&quot;margin:0 0 0 0;&quot;&gt;&lt;tr&gt;
+    &lt;td class=&quot;label&quot; dojoAttachPoint=&quot;labelCell&quot;&gt;&lt;/td&gt;
+    &lt;td class=&quot;border&quot; dojoAttachPoint=&quot;borderCell&quot;&gt;&lt;/td&gt;
+    &lt;td class=&quot;downArrow&quot; dojoAttachPoint=&quot;arrowCell&quot;&gt;
+      &lt;img dojoAttachPoint=&quot;arrow&quot;&gt;
+    &lt;/td&gt;
+  &lt;/tr&gt;&lt;/table&gt;
+&lt;/button&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/createlink.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/createlink.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/createlink.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+&lt;table&gt;
+&lt;tr&gt;&lt;td&gt;URL&lt;/td&gt;&lt;td&gt; &lt;input type=&quot;text&quot; dojoAttachPoint=&quot;link_href&quot; name=&quot;dojo_createLink_href&quot;/&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td&gt;Target &lt;/td&gt;&lt;td&gt;&lt;select dojoAttachPoint=&quot;link_target&quot;&gt;
+	&lt;option value=&quot;&quot;&gt;Self&lt;/option&gt;
+	&lt;option value=&quot;_blank&quot;&gt;New Window&lt;/option&gt;
+	&lt;option value=&quot;_top&quot;&gt;Top Window&lt;/option&gt;
+	&lt;/select&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td&gt;Class &lt;/td&gt;&lt;td&gt;&lt;input type=&quot;text&quot; dojoAttachPoint=&quot;link_class&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;
+	&lt;table&gt;&lt;tr&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:ok'&gt;OK&lt;/button&gt;&lt;/td&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Cancel&lt;/button&gt;&lt;/td&gt;
+	&lt;/tr&gt;&lt;/table&gt;
+	&lt;/td&gt;&lt;/tr&gt;
+&lt;/table&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/find.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/find.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/find.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+&lt;table style=&quot;white-space: nowrap;&quot;&gt;
+&lt;tr&gt;&lt;td colspan='2'&gt;Find: &lt;input type=&quot;text&quot; dojoAttachPoint=&quot;find_text&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td&gt;&lt;input type=&quot;checkbox&quot; dojoType=&quot;CheckBox&quot; dojoAttachPoint=&quot;find_option_casesens&quot; /&gt;
+		&lt;label for=&quot;find_option_casesens&quot;&gt;Case Sensitive&lt;/label&gt;&lt;/td&gt;
+			&lt;td&gt;&lt;input type=&quot;checkbox&quot; dojoType=&quot;CheckBox&quot; dojoAttachPoint=&quot;find_option_backwards&quot; /&gt;
+		&lt;label for=&quot;find_option_backwards&quot;&gt;Search Backwards&lt;/label&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td style=&quot;display: none;&quot;&gt;&lt;input type=&quot;checkbox&quot; dojoType=&quot;CheckBox&quot; dojoAttachPoint=&quot;find_option_wholeword&quot; /&gt;
+		&lt;label for=&quot;find_option_wholeword&quot;&gt;Whole Word&lt;/label&gt;&lt;/td&gt;
+&lt;tr&gt;&lt;td colspan=&quot;1&quot;&gt;
+	&lt;table&gt;&lt;tr&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:find'&gt;Find&lt;/button&gt;&lt;/td&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Close&lt;/button&gt;&lt;/td&gt;
+	&lt;/tr&gt;&lt;/table&gt;
+	&lt;/td&gt;&lt;/tr&gt;
+&lt;/table&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/insertimage.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/insertimage.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/insertimage.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,114 @@
+&lt;table cellspacing=&quot;1&quot; cellpadding=&quot;1&quot; border=&quot;0&quot; width=&quot;100%&quot; height=&quot;100%&quot;&gt;
+	&lt;tr&gt;
+		&lt;td&gt;
+			&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; width=&quot;100%&quot; border=&quot;0&quot;&gt;
+				&lt;tr&gt;
+					&lt;td width=&quot;100%&quot;&gt;
+						&lt;span&gt;URL&lt;/span&gt;
+					&lt;/td&gt;
+					&lt;td style=&quot;display: none&quot; nowrap=&quot;nowrap&quot; rowspan=&quot;2&quot;&gt;
+						&lt;!--input id=&quot;btnBrowse&quot; onclick=&quot;BrowseServer();&quot; type=&quot;button&quot; value=&quot;Browse Server&quot;/--&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td valign=&quot;top&quot;&gt;
+						&lt;input dojoAttachPoint=&quot;image_src&quot; style=&quot;width: 100%&quot; type=&quot;text&quot; /&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;
+			&lt;/table&gt;
+		&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td&gt;
+			&lt;span&gt;Alternative Text&lt;/span&gt;&lt;br /&gt;
+			&lt;input dojoAttachPoint=&quot;image_alt&quot; style=&quot;width: 100%&quot; type=&quot;text&quot; /&gt;&lt;br /&gt;
+		&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td valign=&quot;top&quot;&gt;
+			&lt;table&gt;&lt;tr&gt;&lt;td&gt;
+						&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
+							&lt;tr&gt;
+								&lt;td nowrap=&quot;nowrap&quot;&gt;
+									&lt;span&gt;Width&lt;/span&gt;&nbsp;&lt;/td&gt;
+								&lt;td&gt;
+									&lt;input type=&quot;text&quot; size=&quot;3&quot; dojoAttachPoint=&quot;image_width&quot; /&gt;&lt;/td&gt;
+
+								&lt;td rowspan=&quot;2&quot;&gt;
+									&lt;!--div id=&quot;btnLockSizes&quot; class=&quot;BtnLocked&quot; onmouseover=&quot;this.className = (bLockRatio ? 'BtnLocked' : 'BtnUnlocked' ) + ' BtnOver';&quot;
+										onmouseout=&quot;this.className = (bLockRatio ? 'BtnLocked' : 'BtnUnlocked' );&quot; title=&quot;Lock Sizes&quot;
+										onclick=&quot;SwitchLock(this);&quot;&gt;
+									&lt;/div--&gt;
+								&lt;/td&gt;
+								&lt;td rowspan=&quot;2&quot;&gt;
+									&lt;!--div id=&quot;btnResetSize&quot; class=&quot;BtnReset&quot; onmouseover=&quot;this.className='BtnReset BtnOver';&quot;
+										onmouseout=&quot;this.className='BtnReset';&quot; title=&quot;Reset Size&quot; onclick=&quot;ResetSizes();&quot;&gt;
+									&lt;/div--&gt;
+								&lt;/td&gt;
+							&lt;/tr&gt;
+
+							&lt;tr&gt;
+								&lt;td nowrap=&quot;nowrap&quot;&gt;
+									&lt;span&gt;Height&lt;/span&gt;&nbsp;&lt;/td&gt;
+								&lt;td&gt;
+									&lt;input type=&quot;text&quot; size=&quot;3&quot; dojoAttachPoint=&quot;image_height&quot; /&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;/td&gt;&lt;td&gt;
+
+						&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
+							&lt;tr&gt;
+
+								&lt;td nowrap=&quot;nowrap&quot;&gt;
+									&lt;span &gt;HSpace&lt;/span&gt;&nbsp;&lt;/td&gt;
+								&lt;td&gt;
+									&lt;input type=&quot;text&quot; size=&quot;2&quot; dojoAttachPoint=&quot;image_hspace&quot;/&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td nowrap=&quot;nowrap&quot;&gt;
+									&lt;span &gt;VSpace&lt;/span&gt;&nbsp;&lt;/td&gt;
+
+								&lt;td&gt;
+									&lt;input type=&quot;text&quot; size=&quot;2&quot; dojoAttachPoint=&quot;image_vspace&quot; /&gt;&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;/td&gt;&lt;/tr&gt;
+					&lt;tr&gt;&lt;td colspan=&quot;2&quot;&gt;
+						&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot;&gt;
+							&lt;tr&gt;
+								&lt;td nowrap=&quot;nowrap&quot;&gt;
+									&lt;span&gt;Border&lt;/span&gt;&nbsp;&lt;/td&gt;
+								&lt;td&gt;
+									&lt;input type=&quot;text&quot; size=&quot;2&quot; value=&quot;&quot; dojoAttachPoint=&quot;image_border&quot; /&gt;&lt;/td&gt;
+								&lt;td&gt;&nbsp;&nbsp;&nbsp;&lt;/td&gt;
+								&lt;td nowrap=&quot;nowrap&quot;&gt;
+									&lt;span &gt;Align&lt;/span&gt;&nbsp;&lt;/td&gt;
+								&lt;td&gt;
+									&lt;select dojoAttachPoint=&quot;image_align&quot;&gt;
+
+										&lt;option value=&quot;&quot; selected=&quot;selected&quot;&gt;&lt;/option&gt;
+										&lt;option value=&quot;left&quot;&gt;Left&lt;/option&gt;
+										&lt;option value=&quot;absBottom&quot;&gt;Abs Bottom&lt;/option&gt;
+										&lt;option value=&quot;absMiddle&quot;&gt;Abs Middle&lt;/option&gt;
+										&lt;option value=&quot;baseline&quot;&gt;Baseline&lt;/option&gt;
+										&lt;option value=&quot;bottom&quot;&gt;Bottom&lt;/option&gt;
+
+										&lt;option value=&quot;middle&quot;&gt;Middle&lt;/option&gt;
+										&lt;option value=&quot;right&quot;&gt;Right&lt;/option&gt;
+										&lt;option value=&quot;textTop&quot;&gt;Text Top&lt;/option&gt;
+										&lt;option value=&quot;top&quot;&gt;Top&lt;/option&gt;
+									&lt;/select&gt;
+								&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;/td&gt;
+				&lt;/tr&gt;&lt;/table&gt;
+		&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;&lt;td&gt;
+		&lt;table&gt;&lt;tr&gt;
+		&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:ok'&gt;OK&lt;/button&gt;&lt;/td&gt;
+		&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Cancel&lt;/button&gt;&lt;/td&gt;
+		&lt;/tr&gt;&lt;/table&gt;
+	&lt;/td&gt;&lt;/tr&gt;
+&lt;/table&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/inserttable.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/inserttable.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/inserttable.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,91 @@
+&lt;div&gt;
+&lt;table cellSpacing=&quot;1&quot; cellPadding=&quot;1&quot; width=&quot;100%&quot; border=&quot;0&quot;&gt;
+	&lt;tr&gt;
+		&lt;td valign=&quot;top&quot;&gt;
+			&lt;table cellSpacing=&quot;0&quot; cellPadding=&quot;0&quot; border=&quot;0&quot;&gt;
+				&lt;tr&gt;
+
+					&lt;td&gt;&lt;span&gt;Rows&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=&quot;table_rows&quot; type=&quot;text&quot; maxLength=&quot;3&quot; size=&quot;2&quot; value=&quot;3&quot;&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;&lt;span&gt;Columns&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=&quot;table_cols&quot; type=&quot;text&quot; maxLength=&quot;2&quot; size=&quot;2&quot; value=&quot;2&quot;&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+
+				&lt;tr&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;&lt;span&gt;Border size&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;INPUT dojoAttachPoint=&quot;table_border&quot; type=&quot;text&quot; maxLength=&quot;2&quot; size=&quot;2&quot; value=&quot;1&quot;&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+
+				&lt;tr&gt;
+					&lt;td&gt;&lt;span&gt;Alignment&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;select dojoAttachPoint=&quot;table_align&quot;&gt;
+							&lt;option value=&quot;&quot; selected&gt;&lt;Not set&gt;&lt;/option&gt;
+							&lt;option value=&quot;left&quot;&gt;Left&lt;/option&gt;
+							&lt;option value=&quot;center&quot;&gt;Center&lt;/option&gt;
+							&lt;option value=&quot;right&quot;&gt;Right&lt;/option&gt;
+						&lt;/select&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+			&lt;/table&gt;
+		&lt;/td&gt;
+		&lt;td&gt;&nbsp;&nbsp;&nbsp;&lt;/td&gt;
+		&lt;td align=&quot;right&quot; valign=&quot;top&quot;&gt;
+			&lt;table cellSpacing=&quot;0&quot; cellPadding=&quot;0&quot; border=&quot;0&quot;&gt;
+				&lt;tr&gt;
+					&lt;td&gt;&lt;span&gt;Width&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=&quot;table_width&quot; type=&quot;text&quot; maxLength=&quot;4&quot; size=&quot;3&quot;&gt;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;select dojoAttachPoint=&quot;table_widthtype&quot;&gt;
+							&lt;option value=&quot;percent&quot; selected&gt;percent&lt;/option&gt;
+							&lt;option value=&quot;pixels&quot;&gt;pixels&lt;/option&gt;
+						&lt;/select&gt;&lt;/td&gt;
+
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;&lt;span&gt;Height&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;INPUT dojoAttachPoint=&quot;table_height&quot; type=&quot;text&quot; maxLength=&quot;4&quot; size=&quot;3&quot;&gt;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;span&gt;pixels&lt;/span&gt;&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td nowrap&gt;&lt;span&gt;Cell spacing&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=&quot;table_cellspacing&quot; type=&quot;text&quot; maxLength=&quot;2&quot; size=&quot;2&quot; value=&quot;1&quot;&gt;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+
+				&lt;/tr&gt;
+				&lt;tr&gt;
+					&lt;td nowrap&gt;&lt;span&gt;Cell padding&lt;/span&gt;:&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;input dojoAttachPoint=&quot;table_cellpadding&quot; type=&quot;text&quot; maxLength=&quot;2&quot; size=&quot;2&quot; value=&quot;1&quot;&gt;&lt;/td&gt;
+					&lt;td&gt;&nbsp;&lt;/td&gt;
+				&lt;/tr&gt;
+			&lt;/table&gt;
+		&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;
+&lt;table cellSpacing=&quot;0&quot; cellPadding=&quot;0&quot; width=&quot;100%&quot; border=&quot;0&quot;&gt;
+	&lt;tr&gt;
+		&lt;td nowrap&gt;&lt;span&gt;Caption&lt;/span&gt;:&lt;/td&gt;
+		&lt;td&gt;&nbsp;&lt;/td&gt;
+		&lt;td width=&quot;100%&quot; nowrap&gt;&nbsp;
+			&lt;input dojoAttachPoint=&quot;table_caption&quot; type=&quot;text&quot; style=&quot;WIDTH: 90%&quot;&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr&gt;
+		&lt;td nowrap&gt;&lt;span&gt;Summary&lt;/span&gt;:&lt;/td&gt;
+		&lt;td&gt;&nbsp;&lt;/td&gt;
+		&lt;td width=&quot;100%&quot; nowrap&gt;&nbsp;
+			&lt;input dojoAttachPoint=&quot;table_summary&quot; type=&quot;text&quot; style=&quot;WIDTH: 90%&quot;&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;
+&lt;table&gt;&lt;tr&gt;
+&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:ok'&gt;Ok&lt;/button&gt;&lt;/td&gt;
+&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Cancel&lt;/button&gt;&lt;/td&gt;
+&lt;/tr&gt;&lt;/table&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/replace.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/replace.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/Dialog/replace.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+&lt;table style=&quot;white-space: nowrap;&quot;&gt;
+&lt;tr&gt;&lt;td&gt;Find: &lt;/td&gt;&lt;td&gt; &lt;input type=&quot;text&quot; dojoAttachPoint=&quot;replace_text&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td&gt;Replace with: &lt;/td&gt;&lt;td&gt; &lt;input type=&quot;text&quot; dojoAttachPoint=&quot;replace_text&quot; /&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td colspan='2'&gt;&lt;table&gt;&lt;tr&gt;&lt;td&gt;&lt;input type=&quot;checkbox&quot; dojoType=&quot;CheckBox&quot; dojoAttachPoint=&quot;replace_option_casesens&quot; id=&quot;dojo_replace_option_casesens&quot; /&gt;
+		&lt;label for=&quot;dojo_replace_option_casesens&quot;&gt;Case Sensitive&lt;/label&gt;&lt;/td&gt;
+			&lt;td&gt;&lt;input type=&quot;checkbox&quot; dojoType=&quot;CheckBox&quot; dojoAttachPoint=&quot;replace_option_backwards&quot; id=&quot;dojo_replace_option_backwards&quot; /&gt;
+		&lt;label for=&quot;dojo_replace_option_backwards&quot;&gt;Search Backwards&lt;/label&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/td&gt;&lt;/tr&gt;
+&lt;tr&gt;&lt;td colspan=2&quot;&gt;
+	&lt;table&gt;&lt;tr&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:replace'&gt;Replace&lt;/button&gt;&lt;/td&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:replaceAll'&gt;Replace All&lt;/button&gt;&lt;/td&gt;
+	&lt;td&gt;&lt;button dojoType='Button' dojoAttachEvent='onClick:cancel'&gt;Close&lt;/button&gt;&lt;/td&gt;
+	&lt;/tr&gt;&lt;/table&gt;
+	&lt;/td&gt;&lt;/tr&gt;
+&lt;/table&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorDialog.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorDialog.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorDialog.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,21 @@
+&lt;div id=&quot;${this.widgetId}&quot; class=&quot;dojoFloatingPane&quot;&gt;
+	&lt;span dojoattachpoint=&quot;tabStartOuter&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot;	tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;span dojoattachpoint=&quot;tabStart&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot; tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;div dojoAttachPoint=&quot;titleBar&quot; class=&quot;dojoFloatingPaneTitleBar&quot;  style=&quot;display:none&quot;&gt;
+	  	&lt;img dojoAttachPoint=&quot;titleBarIcon&quot;  class=&quot;dojoFloatingPaneTitleBarIcon&quot;&gt;
+		&lt;div dojoAttachPoint=&quot;closeAction&quot; dojoAttachEvent=&quot;onClick:hide&quot;
+   	  		class=&quot;dojoFloatingPaneCloseIcon&quot;&gt;&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;restoreAction&quot; dojoAttachEvent=&quot;onClick:restoreWindow&quot;
+   	  		class=&quot;dojoFloatingPaneRestoreIcon&quot;&gt;&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;maximizeAction&quot; dojoAttachEvent=&quot;onClick:maximizeWindow&quot;
+   	  		class=&quot;dojoFloatingPaneMaximizeIcon&quot;&gt;&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;minimizeAction&quot; dojoAttachEvent=&quot;onClick:minimizeWindow&quot;
+   	  		class=&quot;dojoFloatingPaneMinimizeIcon&quot;&gt;&lt;/div&gt;
+	  	&lt;div dojoAttachPoint=&quot;titleBarText&quot; class=&quot;dojoFloatingPaneTitleText&quot;&gt;${this.title}&lt;/div&gt;
+	&lt;/div&gt;
+
+	&lt;div id=&quot;${this.widgetId}_container&quot; dojoAttachPoint=&quot;containerNode&quot; class=&quot;dojoFloatingPaneClient&quot;&gt;&lt;/div&gt;
+	&lt;span dojoattachpoint=&quot;tabEnd&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot; tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;span dojoattachpoint=&quot;tabEndOuter&quot; dojoonfocus=&quot;trapTabs&quot; dojoonblur=&quot;clearTrap&quot; tabindex=&quot;0&quot;&gt;&lt;/span&gt;
+	&lt;div dojoAttachPoint=&quot;resizeBar&quot; class=&quot;dojoFloatingPaneResizebar&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontName.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontName.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontName.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,20 @@
+&lt;div class=&quot;SC_Panel&quot; style=&quot;width: 150px; height: 150px;&quot;&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;Arial&quot;&gt;
+		&lt;font face=&quot;Arial&quot; style=&quot;font-size: 12px;&quot;&gt;Arial&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;Comic Sans MS&quot;&gt;
+		&lt;font face=&quot;Comic Sans MS&quot; style=&quot;font-size: 12px;&quot;&gt;Comic Sans MS&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;Courier New&quot;&gt;
+		&lt;font face=&quot;Courier New&quot; style=&quot;font-size: 12px;&quot;&gt;Courier New&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;Tahoma&quot;&gt;
+		&lt;font face=&quot;Tahoma&quot; style=&quot;font-size: 12px;&quot;&gt;Tahoma&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;Times New Roman&quot;&gt;
+		&lt;font face=&quot;Times New Roman&quot; style=&quot;font-size: 12px;&quot;&gt;Times New Roman&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;Verdana&quot;&gt;
+		&lt;font face=&quot;Verdana&quot; style=&quot;font-size: 12px;&quot;&gt;Verdana&lt;/font&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontSize.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontSize.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FontSize.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,31 @@
+&lt;div class=&quot;SC_Panel&quot; style=&quot;width: 150px; height: 150px;&quot;&gt;
+&lt;table width=&quot;100%&quot; cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; style=&quot;table-layout: fixed;&quot;&gt;
+&lt;tbody&gt;
+&lt;tr&gt;
+&lt;td nowrap=&quot;&quot;&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;1&quot;&gt;
+	&lt;font size=&quot;1&quot;&gt;xx-small&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;2&quot;&gt;
+	&lt;font size=&quot;2&quot;&gt;x-small&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;3&quot;&gt;
+	&lt;font size=&quot;3&quot;&gt;small&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;4&quot;&gt;
+	&lt;font size=&quot;4&quot;&gt;medium&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;5&quot;&gt;
+	&lt;font size=&quot;5&quot;&gt;large&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;6&quot;&gt;
+	&lt;font size=&quot;6&quot;&gt;x-large&lt;/font&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;7&quot;&gt;
+	&lt;font size=&quot;7&quot;&gt;xx-large&lt;/font&gt;
+	&lt;/div&gt;
+&lt;/td&gt;
+&lt;/tr&gt;
+&lt;/tbody&gt;
+&lt;/table&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FormatBlock.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FormatBlock.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/EditorToolbar_FormatBlock.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,52 @@
+&lt;div class=&quot;SC_Panel&quot; style=&quot;width: 190px; height: 150px;&quot;&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;p&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;p&gt;Normal&lt;/p&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;div&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;div&gt;Normal (DIV)&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;pre&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;pre&gt;Formatted&lt;/pre&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;address&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;address&gt;Address&lt;/address&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;h1&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;h1&gt;Heading 1&lt;/h1&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;h2&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;h2&gt;Heading 2&lt;/h2&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;h3&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;h3&gt;Heading 3&lt;/h3&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;h4&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;h4&gt;Heading 4&lt;/h4&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;h5&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;h5&gt;Heading 5&lt;/h5&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;SC_Item&quot; dropDownItemName=&quot;h6&quot;&gt;
+		&lt;div class=&quot;BaseFont&quot;&gt;
+			&lt;h6&gt;Heading 6&lt;/h6&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_gecko.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_gecko.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_gecko.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,19 @@
+/* For tables with the &quot;border&quot; attribute set to &quot;0&quot; */
+table[border=&quot;0&quot;], 
+table[border=&quot;0&quot;] &gt; tr &gt; td, table[border=&quot;0&quot;] &gt; tr &gt; th, 
+table[border=&quot;0&quot;] &gt; tbody &gt; tr &gt; td, table[border=&quot;0&quot;] &gt; tbody &gt; tr &gt; th, 
+table[border=&quot;0&quot;] &gt; thead &gt; tr &gt; td, table[border=&quot;0&quot;] &gt; thead &gt; tr &gt; th, 
+table[border=&quot;0&quot;] &gt; tfoot &gt; tr &gt; td, table[border=&quot;0&quot;] &gt; tfoot &gt; tr &gt; th
+{
+	border: #d3d3d3 1px dotted ;
+}
+
+/* For tables with no &quot;border&quot; attribute set */
+table:not([border]), 
+table:not([border]) &gt; tr &gt; td, table:not([border]) &gt; tr &gt; th,
+table:not([border]) &gt; tbody &gt; tr &gt; td, table:not([border]) &gt; tbody &gt; tr &gt; th,
+table:not([border]) &gt; thead &gt; tr &gt; td, table:not([border]) &gt; thead &gt; tr &gt; th,
+table:not([border]) &gt; tfoot &gt; tr &gt; td, table:not([border]) &gt; tfoot &gt; tr &gt; th
+{
+	border: #d3d3d3 1px dotted ;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_ie.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_ie.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Editor2/showtableborder_ie.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,4 @@
+table.dojoShowIETableBorders, table.dojoShowIETableBorders td, table.dojoShowIETableBorders th
+{
+	border: #d3d3d3 1px solid;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,152 @@
+.StyleDropdownContainer {
+	position: absolute;
+	z-index: 1000;
+	overflow: auto;
+	cursor: default;
+	width: 250px;
+	height: 250px;
+	background-color: white;
+	border: 1px solid black;
+}
+
+.ColorDropdownContainer {
+	position: absolute;
+	z-index: 1000;
+	overflow: auto;
+	cursor: default;
+	width: 250px;
+	height: 150px;
+	background-color: white;
+	border: 1px solid black;
+}
+
+.EditorToolbarDomNode {
+	background-image: url(buttons/bg-fade.png);
+	background-repeat: repeat-x;
+	background-position: 0px -50px;
+}
+
+.EditorToolbarSmallBg {
+	background-image: url(images/toolbar-bg.gif);
+	background-repeat: repeat-x;
+	background-position: 0px 0px;
+}
+
+/*
+body {
+	background:url(images/blank.gif) fixed;
+}*/
+
+.IEFixedToolbar {
+	position:absolute;
+	/* top:0; */
+	top: expression(eval((document.documentElement||document.body).scrollTop));
+}
+
+div.bigIcon {
+	width: 40px;
+	height: 40px; 
+	/* background-color: white; */
+	/* border: 1px solid #a6a7a3; */
+	font-family: Verdana, Trebuchet, Tahoma, Arial;
+}
+
+.iconContainer {
+	font-family: Verdana, Trebuchet, Tahoma, Arial;
+	font-size: 13px;
+	float: left;
+	height: 18px;
+	display: block;
+	/* background-color: white; */
+	cursor: pointer;
+	padding: 1px 4px 1px 1px; /* almost the same as a transparent border */
+	border: 0px;
+}
+
+.dojoE2TBIcon {
+	display: block;
+	text-align: center;
+	min-width: 18px;
+	width: 18px;
+	height: 18px;
+	/* background-color: #a6a7a3; */
+	background-repeat: no-repeat;
+	background-image: url(buttons/aggregate.gif);
+}
+
+
+.dojoE2TBIcon[class~=dojoE2TBIcon] {
+}
+
+.ToolbarButtonLatched {
+    border: #316ac5 1px solid; !important;
+    padding: 0px 3px 0px 0px; !important; /* make room for border */
+    background-color: #c1d2ee;
+}
+
+.ToolbarButtonHighlighted {
+    border: #316ac5 1px solid; !important;
+    padding: 0px 3px 0px 0px; !important; /* make room for border */
+    background-color: #dff1ff;
+}
+
+.ToolbarButtonDisabled{
+    filter: gray() alpha(opacity=30); /* IE */
+    opacity: 0.30; /* Safari, Opera and Mozilla */
+}
+
+.headingContainer {
+	width: 150px;
+	height: 30px;
+	margin: 0px;
+	/* padding-left: 5px; */
+	overflow: hidden;
+	line-height: 25px;
+	border-bottom: 1px solid black;
+	border-top: 1px solid white;
+}
+
+.EditorToolbarDomNode select {
+	font-size: 14px;
+}
+ 
+.dojoE2TBIcon_Sep { width: 5px; min-width: 5px; max-width: 5px; background-position: 0px 0px}
+.dojoE2TBIcon_Backcolor { background-position: -18px 0px}
+.dojoE2TBIcon_Bold { background-position: -36px 0px}
+.dojoE2TBIcon_Cancel { background-position: -54px 0px}
+.dojoE2TBIcon_Copy { background-position: -72px 0px}
+.dojoE2TBIcon_Link { background-position: -90px 0px}
+.dojoE2TBIcon_Cut { background-position: -108px 0px}
+.dojoE2TBIcon_Delete { background-position: -126px 0px}
+.dojoE2TBIcon_TextColor { background-position: -144px 0px}
+.dojoE2TBIcon_BackgroundColor { background-position: -162px 0px}
+.dojoE2TBIcon_Indent { background-position: -180px 0px}
+.dojoE2TBIcon_HorizontalLine { background-position: -198px 0px}
+.dojoE2TBIcon_Image { background-position: -216px 0px}
+.dojoE2TBIcon_NumberedList { background-position: -234px 0px}
+.dojoE2TBIcon_Table { background-position: -252px 0px}
+.dojoE2TBIcon_BulletedList { background-position: -270px 0px}
+.dojoE2TBIcon_Italic { background-position: -288px 0px}
+.dojoE2TBIcon_CenterJustify { background-position: -306px 0px}
+.dojoE2TBIcon_BlockJustify { background-position: -324px 0px}
+.dojoE2TBIcon_LeftJustify { background-position: -342px 0px}
+.dojoE2TBIcon_RightJustify { background-position: -360px 0px}
+.dojoE2TBIcon_left_to_right { background-position: -378px 0px}
+.dojoE2TBIcon_list_bullet_indent { background-position: -396px 0px}
+.dojoE2TBIcon_list_bullet_outdent { background-position: -414px 0px}
+.dojoE2TBIcon_list_num_indent { background-position: -432px 0px}
+.dojoE2TBIcon_list_num_outdent { background-position: -450px 0px}
+.dojoE2TBIcon_Outdent { background-position: -468px 0px}
+.dojoE2TBIcon_Paste { background-position: -486px 0px}
+.dojoE2TBIcon_Redo { background-position: -504px 0px}
+dojoE2TBIcon_RemoveFormat { background-position: -522px 0px}
+.dojoE2TBIcon_right_to_left { background-position: -540px 0px}
+.dojoE2TBIcon_Save { background-position: -558px 0px}
+.dojoE2TBIcon_Space { background-position: -576px 0px}
+.dojoE2TBIcon_StrikeThrough { background-position: -594px 0px}
+.dojoE2TBIcon_Subscript { background-position: -612px 0px}
+.dojoE2TBIcon_Superscript { background-position: -630px 0px}
+.dojoE2TBIcon_Underline { background-position: -648px 0px}
+.dojoE2TBIcon_Undo { background-position: -666px 0px}
+.dojoE2TBIcon_WikiWord { background-position: -684px 0px}
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbar.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,153 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot; class=&quot;EditorToolbarDomNode&quot; unselectable=&quot;on&quot;&gt;
+	&lt;table cellpadding=&quot;3&quot; cellspacing=&quot;0&quot; border=&quot;0&quot;&gt;
+		&lt;!--
+			our toolbar should look something like:
+
+			+=======+=======+=======+=============================================+
+			| w   w | style | copy  | bo | it | un | le | ce | ri |
+			| w w w | style |=======|==============|==============|
+			|  w w  | style | paste |  undo | redo | change style |
+			+=======+=======+=======+=============================================+
+		--&gt;
+		&lt;tbody&gt;
+			&lt;tr valign=&quot;top&quot;&gt;
+				&lt;td rowspan=&quot;2&quot;&gt;
+					&lt;div class=&quot;bigIcon&quot; dojoAttachPoint=&quot;wikiWordButton&quot;
+						dojoOnClick=&quot;wikiWordClick; buttonClick;&quot;&gt;
+						&lt;span style=&quot;font-size: 30px; margin-left: 5px;&quot;&gt;
+							W
+						&lt;/span&gt;
+					&lt;/div&gt;
+				&lt;/td&gt;
+				&lt;td rowspan=&quot;2&quot;&gt;
+					&lt;div class=&quot;bigIcon&quot; dojoAttachPoint=&quot;styleDropdownButton&quot;
+						dojoOnClick=&quot;styleDropdownClick; buttonClick;&quot;&gt;
+						&lt;span unselectable=&quot;on&quot;
+							style=&quot;font-size: 30px; margin-left: 5px;&quot;&gt;
+							S
+						&lt;/span&gt;
+					&lt;/div&gt;
+					&lt;div class=&quot;StyleDropdownContainer&quot; style=&quot;display: none;&quot;
+						dojoAttachPoint=&quot;styleDropdownContainer&quot;&gt;
+						&lt;table cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; border=&quot;0&quot;
+							height=&quot;100%&quot; width=&quot;100%&quot;&gt;
+							&lt;tr valign=&quot;top&quot;&gt;
+								&lt;td rowspan=&quot;2&quot;&gt;
+									&lt;div style=&quot;height: 245px; overflow: auto;&quot;&gt;
+										&lt;div class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;normalTextClick&quot;&gt;normal&lt;/div&gt;
+										&lt;h1 class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;h1TextClick&quot;&gt;Heading 1&lt;/h1&gt;
+										&lt;h2 class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;h2TextClick&quot;&gt;Heading 2&lt;/h2&gt;
+										&lt;h3 class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;h3TextClick&quot;&gt;Heading 3&lt;/h3&gt;
+										&lt;h4 class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;h4TextClick&quot;&gt;Heading 4&lt;/h4&gt;
+										&lt;div class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;blahTextClick&quot;&gt;blah&lt;/div&gt;
+										&lt;div class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;blahTextClick&quot;&gt;blah&lt;/div&gt;
+										&lt;div class=&quot;headingContainer&quot;
+											unselectable=&quot;on&quot;
+											dojoOnClick=&quot;blahTextClick&quot;&gt;blah&lt;/div&gt;
+										&lt;div class=&quot;headingContainer&quot;&gt;blah&lt;/div&gt;
+										&lt;div class=&quot;headingContainer&quot;&gt;blah&lt;/div&gt;
+										&lt;div class=&quot;headingContainer&quot;&gt;blah&lt;/div&gt;
+										&lt;div class=&quot;headingContainer&quot;&gt;blah&lt;/div&gt;
+									&lt;/div&gt;
+								&lt;/td&gt;
+								&lt;!--
+								&lt;td&gt;
+									&lt;span class=&quot;iconContainer&quot; dojoOnClick=&quot;buttonClick;&quot;&gt;
+										&lt;span class=&quot;icon justifyleft&quot; 
+											style=&quot;float: left;&quot;&gt;&nbsp;&lt;/span&gt;
+									&lt;/span&gt;
+									&lt;span class=&quot;iconContainer&quot; dojoOnClick=&quot;buttonClick;&quot;&gt;
+										&lt;span class=&quot;icon justifycenter&quot; 
+											style=&quot;float: left;&quot;&gt;&nbsp;&lt;/span&gt;
+									&lt;/span&gt;
+									&lt;span class=&quot;iconContainer&quot; dojoOnClick=&quot;buttonClick;&quot;&gt;
+										&lt;span class=&quot;icon justifyright&quot; 
+											style=&quot;float: left;&quot;&gt;&nbsp;&lt;/span&gt;
+									&lt;/span&gt;
+									&lt;span class=&quot;iconContainer&quot; dojoOnClick=&quot;buttonClick;&quot;&gt;
+										&lt;span class=&quot;icon justifyfull&quot; 
+											style=&quot;float: left;&quot;&gt;&nbsp;&lt;/span&gt;
+									&lt;/span&gt;
+								&lt;/td&gt;
+								--&gt;
+							&lt;/tr&gt;
+							&lt;tr valign=&quot;top&quot;&gt;
+								&lt;td&gt;
+									thud
+								&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/table&gt;
+					&lt;/div&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;!-- copy --&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;copyButton&quot;
+						unselectable=&quot;on&quot;
+						dojoOnClick=&quot;copyClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon copy&quot; 
+							unselectable=&quot;on&quot;
+							style=&quot;float: left;&quot;&gt;&nbsp;&lt;/span&gt; copy
+					&lt;/span&gt;
+					&lt;!-- &quot;droppable&quot; options --&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;boldButton&quot;
+						unselectable=&quot;on&quot;
+						dojoOnClick=&quot;boldClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon bold&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;italicButton&quot;
+						dojoOnClick=&quot;italicClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon italic&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;underlineButton&quot;
+						dojoOnClick=&quot;underlineClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon underline&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;leftButton&quot;
+						dojoOnClick=&quot;leftClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon justifyleft&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;fullButton&quot;
+						dojoOnClick=&quot;fullClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon justifyfull&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;rightButton&quot;
+						dojoOnClick=&quot;rightClick; buttonClick;&quot;&gt;
+						&lt;span class=&quot;icon justifyright&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td&gt;
+					&lt;!-- paste --&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;pasteButton&quot;
+						dojoOnClick=&quot;pasteClick; buttonClick;&quot; unselectable=&quot;on&quot;&gt;
+						&lt;span class=&quot;icon paste&quot; style=&quot;float: left;&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt; paste
+					&lt;/span&gt;
+					&lt;!-- &quot;droppable&quot; options --&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;undoButton&quot;
+						dojoOnClick=&quot;undoClick; buttonClick;&quot; unselectable=&quot;on&quot;&gt;
+						&lt;span class=&quot;icon undo&quot; style=&quot;float: left;&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt; undo
+					&lt;/span&gt;
+					&lt;span class=&quot;iconContainer&quot; dojoAttachPoint=&quot;redoButton&quot;
+						dojoOnClick=&quot;redoClick; buttonClick;&quot; unselectable=&quot;on&quot;&gt;
+						&lt;span class=&quot;icon redo&quot; style=&quot;float: left;&quot; unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt; redo
+					&lt;/span&gt;
+				&lt;/td&gt;	
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbarOneline.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbarOneline.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/EditorToolbarOneline.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,172 @@
+&lt;div class=&quot;EditorToolbarDomNode EditorToolbarSmallBg&quot;&gt;
+	&lt;table cellpadding=&quot;1&quot; cellspacing=&quot;0&quot; border=&quot;0&quot;&gt;
+		&lt;tbody&gt;
+			&lt;tr valign=&quot;top&quot; align=&quot;left&quot;&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;htmltoggle&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon&quot; 
+						style=&quot;background-image: none; width: 30px;&quot; &gt;&lt;h&gt;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;copy&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Copy&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;paste&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Paste&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;undo&quot;&gt;
+						&lt;!-- FIXME: should we have the text &quot;undo&quot; here? --&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Undo&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;redo&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Redo&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td isSpacer=&quot;true&quot;&gt;
+					&lt;span class=&quot;iconContainer&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Sep&quot;	style=&quot;width: 5px; min-width: 5px;&quot;&gt;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;createlink&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Link&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;insertimage&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Image&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;inserthorizontalrule&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_HorizontalLine &quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;bold&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Bold&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;italic&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Italic&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;underline&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Underline&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;strikethrough&quot;&gt;
+						&lt;span 
+							class=&quot;dojoE2TBIcon dojoE2TBIcon_StrikeThrough&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td isSpacer=&quot;true&quot;&gt;
+					&lt;span class=&quot;iconContainer&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Sep&quot; 
+							style=&quot;width: 5px; min-width: 5px;&quot;&gt;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;insertunorderedlist&quot;&gt;
+						&lt;span 
+							class=&quot;dojoE2TBIcon dojoE2TBIcon_BulletedList&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;insertorderedlist&quot;&gt;
+						&lt;span 
+							class=&quot;dojoE2TBIcon dojoE2TBIcon_NumberedList&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td isSpacer=&quot;true&quot;&gt;
+					&lt;span class=&quot;iconContainer&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Sep&quot; style=&quot;width: 5px; min-width: 5px;&quot;&gt;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;indent&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Indent&quot; 
+							unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;outdent&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Outdent&quot; 
+							unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td isSpacer=&quot;true&quot;&gt;
+					&lt;span class=&quot;iconContainer&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Sep&quot; style=&quot;width: 5px; min-width: 5px;&quot;&gt;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;forecolor&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_TextColor&quot; 
+							unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;hilitecolor&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_BackgroundColor&quot; 
+							unselectable=&quot;on&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td isSpacer=&quot;true&quot;&gt;
+					&lt;span class=&quot;iconContainer&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Sep&quot; style=&quot;width: 5px; min-width: 5px;&quot;&gt;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;justifyleft&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_LeftJustify&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;justifycenter&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_CenterJustify&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;justifyright&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_RightJustify&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;
+				&lt;td&gt;
+					&lt;span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;justifyfull&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_BlockJustify&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span&gt;
+				&lt;/td&gt;	
+				&lt;td&gt;
+					&lt;select class=&quot;dojoEditorToolbarItem&quot; dojoETItemName=&quot;plainformatblock&quot;&gt;
+						&lt;!-- FIXME: using &quot;p&quot; here inserts a paragraph in most cases! --&gt;
+						&lt;option value=&quot;&quot;&gt;-- format --&lt;/option&gt;
+						&lt;option value=&quot;p&quot;&gt;Normal&lt;/option&gt;
+						&lt;option value=&quot;pre&quot;&gt;Fixed Font&lt;/option&gt;
+						&lt;option value=&quot;h1&quot;&gt;Main Heading&lt;/option&gt;
+						&lt;option value=&quot;h2&quot;&gt;Section Heading&lt;/option&gt;
+						&lt;option value=&quot;h3&quot;&gt;Sub-Heading&lt;/option&gt;
+						&lt;!-- &lt;option value=&quot;blockquote&quot;&gt;Block Quote&lt;/option&gt; --&gt;
+					&lt;/select&gt;
+				&lt;/td&gt;
+				&lt;td&gt;&lt;!-- uncomment to enable save button --&gt;
+					&lt;!-- save --&gt;
+					&lt;!--span class=&quot;iconContainer dojoEditorToolbarItem&quot; dojoETItemName=&quot;save&quot;&gt;
+						&lt;span class=&quot;dojoE2TBIcon dojoE2TBIcon_Save&quot;&gt;&nbsp;&lt;/span&gt;
+					&lt;/span--&gt;
+				&lt;/td&gt;
+				&lt;td width=&quot;*&quot;&gt;&nbsp;&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/FisheyeList.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/FisheyeList.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/FisheyeList.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,27 @@
+.dojoHtmlFisheyeListItemLabel {
+	font-family: Arial, Helvetica, sans-serif;
+	background-color: #eee;
+	border: 2px solid #666;
+	padding: 2px;
+	text-align: center;
+	position: absolute;
+	display: none;
+}
+
+.dojoHtmlFisheyeListItemLabel.selected {
+	display: block;
+}
+
+.dojoHtmlFisheyeListItemImage {
+	border: 0px;
+	position: absolute;
+}
+
+.dojoHtmlFisheyeListItem {
+	position: absolute;
+	z-index: 2;
+}
+
+.dojoHtmlFisheyeListBar {
+	position: relative;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,118 @@
+
+/********** Outer Window ***************/
+
+.dojoFloatingPane {
+	/* essential css */
+	position: absolute;
+	overflow: visible;		/* so drop shadow is displayed */
+	z-index: 10;
+
+	/* styling css */
+	border: 1px solid;
+	border-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;
+	background-color: ThreeDFace;
+}
+
+
+/********** Title Bar ****************/
+
+.dojoFloatingPaneTitleBar {
+	vertical-align: top;
+	margin: 2px 2px 2px 2px;
+	z-index: 10;
+	background-color: #7596c6;
+	cursor: default;
+	overflow: hidden;
+	border-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;
+	vertical-align: middle;
+}
+
+.dojoFloatingPaneTitleText {
+	float: left;
+	padding: 2px 4px 2px 2px;
+	white-space: nowrap;
+	color: CaptionText;
+	font: small-caption;
+}
+
+.dojoTitleBarIcon {
+	float: left;
+	height: 22px;
+	width: 22px;
+	vertical-align: middle;
+	margin-right: 5px;
+	margin-left: 5px;
+}
+
+.dojoFloatingPaneActions{
+	float: right;
+	position: absolute;
+	right: 2px;
+	top: 2px;
+	vertical-align: middle;
+}
+
+
+.dojoFloatingPaneActionItem {
+	vertical-align: middle;
+	margin-right: 1px;
+	height: 22px;
+	width: 22px;
+}
+
+
+.dojoFloatingPaneTitleBarIcon {
+	/* essential css */
+	float: left;
+
+	/* styling css */
+	margin-left: 2px;
+	margin-right: 4px;
+	height: 22px;
+}
+
+/* minimize/maximize icons are specified by CSS only */
+.dojoFloatingPaneMinimizeIcon,
+.dojoFloatingPaneMaximizeIcon,
+.dojoFloatingPaneRestoreIcon,
+.dojoFloatingPaneCloseIcon {
+	vertical-align: middle;
+	height: 22px;
+	width: 22px;
+	float: right;
+}
+.dojoFloatingPaneMinimizeIcon {
+	background-image: url(images/floatingPaneMinimize.gif);
+}
+.dojoFloatingPaneMaximizeIcon {
+	background-image: url(images/floatingPaneMaximize.gif);
+}
+.dojoFloatingPaneRestoreIcon {
+	background-image: url(images/floatingPaneRestore.gif);
+}
+.dojoFloatingPaneCloseIcon {
+	background-image: url(images/floatingPaneClose.gif);
+}
+
+/* bar at bottom of window that holds resize handle */
+.dojoFloatingPaneResizebar {
+	z-index: 10;
+	height: 13px;
+	background-color: ThreeDFace;
+}
+
+/************* Client Area ***************/
+
+.dojoFloatingPaneClient {
+	position: relative;
+	z-index: 10;
+	border: 1px solid;
+	border-color: ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow;
+	margin: 2px;
+	background-color: ThreeDFace;
+	padding: 8px;
+	font-family: Verdana, Helvetica, Garamond, sans-serif;
+	font-size: 12px;
+	overflow: auto;
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/FloatingPane.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,18 @@
+&lt;div id=&quot;${this.widgetId}&quot; dojoAttachEvent=&quot;onMouseDown&quot; class=&quot;dojoFloatingPane&quot;&gt;
+	&lt;div dojoAttachPoint=&quot;titleBar&quot; class=&quot;dojoFloatingPaneTitleBar&quot;  style=&quot;display:none&quot;&gt;
+	  	&lt;img dojoAttachPoint=&quot;titleBarIcon&quot;  class=&quot;dojoFloatingPaneTitleBarIcon&quot;&gt;
+		&lt;div dojoAttachPoint=&quot;closeAction&quot; dojoAttachEvent=&quot;onClick:closeWindow&quot;
+   	  		class=&quot;dojoFloatingPaneCloseIcon&quot;&gt;&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;restoreAction&quot; dojoAttachEvent=&quot;onClick:restoreWindow&quot;
+   	  		class=&quot;dojoFloatingPaneRestoreIcon&quot;&gt;&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;maximizeAction&quot; dojoAttachEvent=&quot;onClick:maximizeWindow&quot;
+   	  		class=&quot;dojoFloatingPaneMaximizeIcon&quot;&gt;&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;minimizeAction&quot; dojoAttachEvent=&quot;onClick:minimizeWindow&quot;
+   	  		class=&quot;dojoFloatingPaneMinimizeIcon&quot;&gt;&lt;/div&gt;
+	  	&lt;div dojoAttachPoint=&quot;titleBarText&quot; class=&quot;dojoFloatingPaneTitleText&quot;&gt;${this.title}&lt;/div&gt;
+	&lt;/div&gt;
+
+	&lt;div id=&quot;${this.widgetId}_container&quot; dojoAttachPoint=&quot;containerNode&quot; class=&quot;dojoFloatingPaneClient&quot;&gt;&lt;/div&gt;
+
+	&lt;div dojoAttachPoint=&quot;resizeBar&quot; class=&quot;dojoFloatingPaneResizebar&quot; style=&quot;display:none&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+.editLabel {
+	font-size : small;
+	padding : 0 5px;
+	display : none;
+}
+
+.editableRegionDisabled {
+	cursor : pointer;
+	_cursor : hand;
+}
+
+.editableRegion {
+	background-color : #ffc !important;
+	cursor : pointer;
+	_cursor : hand;
+}
+
+.editableRegion .editLabel {
+	display : inline;
+}
+
+.editableTextareaRegion .editLabel {
+	display : block;
+}
+
+.inlineEditBox {
+	/*background-color : #ffc;*/
+	display : inline;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/InlineEditBox.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+&lt;form class=&quot;inlineEditBox&quot; style=&quot;display: none&quot; dojoAttachPoint=&quot;form&quot; dojoAttachEvent=&quot;onSubmit:saveEdit; onReset:cancelEdit; onKeyUp: checkForValueChange;&quot;&gt;
+	&lt;input type=&quot;text&quot; dojoAttachPoint=&quot;text&quot; style=&quot;display: none;&quot; /&gt;
+	&lt;textarea dojoAttachPoint=&quot;textarea&quot; style=&quot;display: none;&quot;&gt;&lt;/textarea&gt;
+	&lt;input type=&quot;submit&quot; value=&quot;Save&quot; dojoAttachPoint=&quot;submitButton&quot; /&gt;
+	&lt;input type=&quot;reset&quot; value=&quot;Cancel&quot; dojoAttachPoint=&quot;cancelButton&quot; /&gt;
+&lt;/form&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Menu.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Menu.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Menu.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,60 @@
+.dojoMenu {
+	border:1px solid #000000;
+	list-style-type:none;
+	margin:0;
+	padding:0;
+	padding-bottom: 1px;
+	background-color:#f4f4f4;
+	font-size: 8pt;
+}
+
+.dojoMenuSeparator {
+	list-style-type:none;
+	margin:0;
+	padding:1px 0;
+	border-bottom:1px solid #000000;
+	line-height:1px;
+	height:1px;
+}
+
+li:hover.dojoMenuSeparator {
+	background-color:#e5e5e5;
+	cursor:default;
+}
+
+
+
+
+.dojoContextMenu {
+	position: absolute;
+	display: none;
+	border: 2px solid;
+	border-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;
+	list-style-type: none;
+	margin: 0;
+	padding: 1px;
+	background-color: ThreeDFace;
+	font-size: 8pt;
+}
+
+.dojoMenuItem {
+	white-space: nowrap;
+	padding: 2px;
+	font: menu;
+	color: WindowText;
+}
+
+.dojoMenuItem a {
+	text-decoration: none;
+	color: WindowText;
+	font: inherit;
+}
+
+.dojoMenuItemHover {
+	padding: 2px;
+	background-color: blue;
+	cursor: pointer;
+	_cursor: hand;
+	background-color: Highlight;
+	color: HighlightText;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Menu2.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Menu2.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Menu2.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,116 @@
+
+.dojoPopupMenu2 {
+	position: absolute;
+	border: 1px solid #7298d0;
+	background:#85aeec url(images/soriaMenuBg.gif) repeat-x bottom left !important;
+	padding: 1px;
+	margin-top: 1px;
+	margin-bottom: 1px;
+}
+
+.dojoMenuItem2{
+	white-space: nowrap;
+	font: menu;
+	margin: 0;
+}
+
+.dojoMenuItem2Hover {
+	background-color: #D2E4FD;
+	cursor:pointer;
+	cursor:hand;
+}
+
+.dojoMenuItem2Icon {
+	position: relative;
+	background-position: center center;
+	background-repeat: no-repeat;
+	width: 16px;
+	height: 16px;
+	padding-right: 3px;
+}
+
+.dojoMenuItem2Label {
+	position: relative;
+	vertical-align: middle;
+}
+
+/* main label text */
+.dojoMenuItem2Label {
+	position: relative;
+	vertical-align: middle;
+}
+
+.dojoMenuItem2Accel {
+	position: relative;
+	vertical-align: middle;
+	padding-left: 3px;
+}
+
+.dojoMenuItem2Disabled .dojoMenuItem2Label,
+.dojoMenuItem2Disabled .dojoMenuItem2Accel {
+	color: #607a9e;
+}
+
+.dojoMenuItem2Submenu {
+	position: relative;
+	background-position: center center;
+	background-repeat: no-repeat;
+	background-image: url(images/submenu_off.gif);
+	width: 5px;
+	height: 9px;
+	padding-left: 3px;
+}
+.dojoMenuItem2Hover .dojoMenuItem2Submenu {
+	background-image: url(images/submenu_on.gif);
+}
+
+.dojoMenuItem2Disabled .dojoMenuItem2Submenu {
+	background-image: url(images/submenu_disabled.gif);
+}
+
+.dojoMenuSeparator2 {
+	font-size: 1px;
+	margin: 0;
+}
+
+.dojoMenuSeparator2Top {
+	height: 50%;
+	border-bottom: 1px solid #7a98c4;
+	margin: 0px 2px;
+	font-size: 1px;
+}
+
+.dojoMenuSeparator2Bottom {
+	height: 50%;
+	border-top: 1px solid #c9deff;
+	margin: 0px 2px;
+	font-size: 1px;
+}
+
+.dojoMenuBar2 {
+	background:#85aeec url(images/soriaBarBg.gif) repeat-x top left;
+	/*border-bottom:1px solid #6b9fec;*/
+	padding: 1px;
+}
+
+.dojoMenuBar2 .dojoMenuItem2 {
+	white-space: nowrap;
+	font: menu;
+	margin: 0;
+	position: relative;
+	vertical-align: middle;
+	z-index: 1;
+	padding: 3px 8px;
+	display: inline;/* needed in khtml to display correctly */
+	display: -moz-inline-box;/* needed in firefox */
+	cursor:pointer;
+	cursor:hand;
+}
+
+.dojoMenuBar2 .dojoMenuItem2Hover {
+	background-color:#d2e4fd;
+}
+
+.dojoMenuBar2 .dojoMenuItem2Disabled span {
+	color: #4f6582;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,91 @@
+.datePickerContainer {
+	margin:0.5em 2em 0.5em 0;
+	/*width:10em;*/
+	float:left;
+}
+
+.previousMonth {
+	background-color:#bbbbbb;
+}
+
+.currentMonth {
+	background-color:#8f8f8f;
+}
+
+.nextMonth {
+	background-color:#eeeeee;
+}
+
+.currentDate {
+	text-decoration:underline;
+	font-style:italic;
+}
+
+.selectedItem {
+	background-color:#3a3a3a;
+	color:#ffffff;
+}
+
+.calendarContainer {
+	border-collapse:collapse;
+	border-spacing:0;
+	border-bottom:1px solid #e6e6e6;
+	overflow: hidden;
+	text-align: right;
+}
+
+.calendarContainer thead{
+	border-bottom:1px solid #e6e6e6;
+}
+
+.calendarContainer tbody * td {
+        height: 100px;
+        border: 1px solid gray;
+}
+
+.calendarContainer td {
+        width: 100px;
+        padding: 2px;
+	vertical-align: top;
+}
+
+.monthLabel {
+	font-size:0.9em;
+	font-weight:400;
+	margin:0;
+	text-align:center;
+}
+
+.monthLabel .month {
+	padding:0 0.4em 0 0.4em;
+}
+
+.yearLabel {
+	font-size:0.9em;
+	font-weight:400;
+	margin:0.25em 0 0 0;
+	text-align:right;
+	color:#a3a3a3;
+}
+
+.yearLabel .selectedYear {
+	color:#000;
+	padding:0 0.2em;
+}
+
+.nextYear, .previousYear {
+	cursor:pointer;cursor:hand;
+}
+
+.incrementControl {
+	cursor:pointer;cursor:hand;
+	width:1em;
+}
+
+.dojoMonthlyCalendarEvent {
+	font-size:0.7em;
+	overflow: hidden;
+	font-color: grey;
+	white-space: nowrap;
+	text-align: left;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/MonthlyCalendar.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,110 @@
+&lt;div class=&quot;datePickerContainer&quot; dojoAttachPoint=&quot;datePickerContainerNode&quot;&gt;
+	&lt;h3 class=&quot;monthLabel&quot;&gt;
+	&lt;!--
+	&lt;span 
+		dojoAttachPoint=&quot;decreaseWeekNode&quot; 
+		dojoAttachEvent=&quot;onClick: onIncrementWeek;&quot; 
+		class=&quot;incrementControl&quot;&gt;
+		&lt;img src=&quot;${dojoWidgetModuleUri}templates/decrementWeek.gif&quot; alt=&quot;&uarr;&quot; /&gt;
+	&lt;/span&gt;
+	--&gt;
+	&lt;span 
+		dojoAttachPoint=&quot;decreaseMonthNode&quot; 
+		dojoAttachEvent=&quot;onClick: onIncrementMonth;&quot; class=&quot;incrementControl&quot;&gt;
+		&lt;img src=&quot;${dojoWidgetModuleUri}templates/decrementMonth.gif&quot; 
+			alt=&quot;&uarr;&quot; dojoAttachPoint=&quot;decrementMonthImageNode&quot;&gt;
+	&lt;/span&gt;
+	&lt;span dojoAttachPoint=&quot;monthLabelNode&quot; class=&quot;month&quot;&gt;July&lt;/span&gt;
+	&lt;span 
+		dojoAttachPoint=&quot;increaseMonthNode&quot; 
+		dojoAttachEvent=&quot;onClick: onIncrementMonth;&quot; class=&quot;incrementControl&quot;&gt;
+		&lt;img src=&quot;${dojoWidgetModuleUri}templates/incrementMonth.gif&quot; 
+			alt=&quot;&darr;&quot;  dojoAttachPoint=&quot;incrementMonthImageNode&quot;&gt;
+	&lt;/span&gt;
+	&lt;!--
+		&lt;span dojoAttachPoint=&quot;increaseWeekNode&quot; 
+			dojoAttachEvent=&quot;onClick: onIncrementWeek;&quot; 
+			class=&quot;incrementControl&quot;&gt;
+			&lt;img src=&quot;${dojoWidgetModuleUri}templates/incrementWeek.gif&quot; 
+			alt=&quot;&darr;&quot; /&gt;
+		&lt;/span&gt;
+	--&gt;
+	&lt;/h3&gt;
+	&lt;table class=&quot;calendarContainer&quot;&gt;
+		&lt;thead&gt;
+			&lt;tr dojoAttachPoint=&quot;dayLabelsRow&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/thead&gt;
+		&lt;tbody dojoAttachPoint=&quot;calendarDatesContainerNode&quot; 
+			dojoAttachEvent=&quot;onClick: onSetDate;&quot;&gt;
+			&lt;tr dojoAttachPoint=&quot;calendarRow0&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr dojoAttachPoint=&quot;calendarRow1&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr dojoAttachPoint=&quot;calendarRow2&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr dojoAttachPoint=&quot;calendarRow3&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr dojoAttachPoint=&quot;calendarRow4&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr dojoAttachPoint=&quot;calendarRow5&quot;&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+				&lt;td&gt;&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+	&lt;h3 class=&quot;yearLabel&quot;&gt;
+		&lt;span dojoAttachPoint=&quot;previousYearLabelNode&quot;
+			dojoAttachEvent=&quot;onClick: onIncrementYear;&quot; class=&quot;previousYear&quot;&gt;&lt;/span&gt;
+		&lt;span class=&quot;selectedYear&quot; dojoAttachPoint=&quot;currentYearLabelNode&quot;&gt;&lt;/span&gt;
+		&lt;span dojoAttachPoint=&quot;nextYearLabelNode&quot; 
+			dojoAttachEvent=&quot;onClick: onIncrementYear;&quot; class=&quot;nextYear&quot;&gt;&lt;/span&gt;
+	&lt;/h3&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/PopUpButton.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/PopUpButton.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/PopUpButton.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,35 @@
+.PopUpButton {
+	padding : 2px 6px 2px 9px;
+	border : 1px outset #ccc;
+	background : #f4f4f4;
+	color : #333;
+	text-decoration : none;
+}
+
+.PopUpButton .downArrow {
+	margin-left: 0.5em;
+	margin-bottom: 2px;
+}
+
+.downArrow.disabled {
+	background-image : url(images/dropdownButtonsArrow-disabled.gif);
+	cursor : default;
+}
+
+ul.dropdownButtons li a:hover,
+ul.dropdownButtons li span.downArrow:hover {
+	color : black;
+	background-color : #ddd;
+}
+
+ul.dropdownButtons li .downArrow.pressed, ul.dropdownButtons li .downArrow:focus {
+	border-style : inset;
+	background-position : 5px 10px;
+	padding : 2px 4px;
+}
+
+ul.dropdownButtons li a.disabled:hover,
+ul.dropdownButtons li span.downArrow.disabled:hover {
+	color : #999;
+	background-color : #d2e4fd;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,23 @@
+.backBar{
+	border:1px solid #84a3d1;
+}
+.frontBar{
+	background:url(&quot;images/bar.gif&quot;) repeat bottom left;
+	background-attachment: fixed;
+}
+.h-frontBar{
+	background:url(&quot;images/h-bar.gif&quot;) repeat bottom left;
+	background-attachment: fixed;
+}
+.simpleFrontBar{
+	background: red;
+}
+.frontPercent,.backPercent{
+	font:bold 13px helvetica;
+}
+.backPercent{
+	color:#293a4b;
+}
+.frontPercent{
+	color:#fff;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ProgressBar.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,5 @@
+&lt;div dojoAttachPoint=&quot;containerNode&quot; style=&quot;position:relative;overflow:hidden&quot;&gt;
+	&lt;div style=&quot;position:absolute;display:none;width:100%;text-align:center&quot; dojoAttachPoint=&quot;backPercentLabel&quot; class=&quot;dojoBackPercentLabel&quot;&gt;&lt;/div&gt;
+	&lt;div style=&quot;position:absolute;overflow:hidden;width:100%;height:100%&quot; dojoAttachPoint=&quot;internalProgress&quot;&gt;
+	&lt;div style=&quot;position:absolute;display:none;width:100%;text-align:center&quot; dojoAttachPoint=&quot;frontPercentLabel&quot; class=&quot;dojoFrontPercentLabel&quot;&gt;&lt;/div&gt;&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/RemoteTabControl.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/RemoteTabControl.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/RemoteTabControl.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,61 @@
+.dojoRemoteTabController {
+	position: relative;
+}
+
+.dojoRemoteTab {
+	position : relative;
+	float : left;
+	padding-left : 9px;
+	border-bottom : 1px solid #6290d2;
+	background : url(images/tab_left.gif) no-repeat left top;
+	cursor: pointer;
+	white-space: nowrap;
+	z-index: 3;
+}
+
+.dojoRemoteTab div {
+	display : block;
+	padding : 4px 15px 4px 6px;
+	background : url(images/tab_top_right.gif) no-repeat right top;
+	color : #333;
+	font-size : 90%;
+}
+
+.dojoRemoteTabPaneClose {
+	position : absolute;
+	bottom : 0px;
+	right : 6px;
+	height : 12px;
+	width : 12px;
+	background : url(images/tab_close.gif) no-repeat right top;
+}
+
+.dojoRemoteTabPaneCloseHover {
+	background-image : url(images/tab_close_h.gif);
+}
+
+.dojoRemoteTabClose {
+	display : inline-block;
+	height : 12px;
+	width : 12px;
+	padding : 0 12px 0 0;
+	margin : 0 -10px 0 10px;
+	background : url(images/tab_close.gif) no-repeat right top;
+	cursor : default;
+}
+
+.dojoRemoteTabCloseHover {
+	background-image : url(images/tab_close_h.gif);
+}
+
+.dojoRemoteTab.current {
+	padding-bottom : 1px;
+	border-bottom : 0;
+	background-position : 0 -150px;
+}
+
+.dojoRemoteTab.current div {
+	padding-bottom : 5px;
+	margin-bottom : -1px;
+	background-position : 100% -150px;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+div.statusBar {
+	background-color: ThreeDFace;
+	height: 28px;
+	padding: 1px;
+	overflow: hidden;
+	font-size: 12px;
+}
+
+div.statusPanel {
+	background-color: ThreeDFace;
+	border: 1px solid;
+	border-color: ThreeDShadow ThreeDHighlight ThreeDHighlight ThreeDShadow;
+	margin: 1px;
+	padding: 2px 6px;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ResizableTextarea.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,14 @@
+&lt;div&gt;
+	&lt;div style=&quot;border: 2px solid black; width: 90%; height: 200px;&quot;
+		dojoAttachPoint=&quot;rootLayoutNode&quot;&gt;
+		&lt;div dojoAttachPoint=&quot;textAreaContainerNode&quot; 
+			style=&quot;border: 0px; margin: 0px; overflow: hidden;&quot;&gt;
+		&lt;/div&gt;
+		&lt;div dojoAttachPoint=&quot;statusBarContainerNode&quot; class=&quot;statusBar&quot;&gt;
+			&lt;div dojoAttachPoint=&quot;statusLabelNode&quot; 
+				class=&quot;statusPanel&quot;
+				style=&quot;padding-right: 0px; z-index: 1;&quot;&gt;drag to resize&lt;/div&gt;
+			&lt;div dojoAttachPoint=&quot;resizeHandleNode&quot;&gt;&lt;/div&gt;
+		&lt;/div&gt;
+	&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ResizeHandle.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ResizeHandle.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ResizeHandle.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,12 @@
+.dojoHtmlResizeHandle {
+	float: right;
+	position: absolute;
+	right: 2px;
+	bottom: 2px;
+	width: 13px;
+	height: 13px;
+	z-index: 20;
+	cursor: nw-resize;
+	background-image: url(grabCorner.gif);
+	line-height: 0px;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Show.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Show.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Show.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,59 @@
<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">+ at media</A> screen {
+	html, body {
+		margin: 0px;
+		padding: 0px;
+		width: 100%;
+	}
+	h1 {
+		font-size: 50px;
+	}
+	p, li {
+		font-size: 30px;
+	}
+	.dojoShowNav {
+		background: #369;
+		overflow: hidden;
+		position: absolute;
+		height: 5px;
+		bottom: 0px;
+		left: 0px;
+		width: 100%;
+		text-align: center;
+	}
+	.dojoShowNav input {
+		margin: 0px;
+	}
+	.dojoShowHider {
+		height: 5px;
+		overflow: hidden;
+		width: 100%;
+	}
+	.dojoShowPrint {
+		position: absolute;
+		left: 5px;
+		top: 0px;
+	}
+	.dojoShow {
+		display: none;
+	}
+}
<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">+ at media</A> print {
+	.dojoShow {
+		display: none !important;
+	}
+	.dojoShowPrint {
+		display: block !important;
+	}
+	.dojoShowPrintSlide {
+		border: 1px solid #aaa;
+		padding: 10px;
+		margin-bottom: 15px;
+	}
+	.dojoShowPrintSlide, ul {
+	page-break-inside: avoid;
+	}
+	h1 {
+		margin-top: 0;
+		page-break-after: avoid;
+	}
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Show.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Show.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Show.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,11 @@
+&lt;div class=&quot;dojoShow&quot;&gt;
+	&lt;div dojoAttachPoint=&quot;contentNode&quot;&gt;&lt;/div&gt;
+	&lt;div class=&quot;dojoShowNav&quot; dojoAttachPoint=&quot;nav&quot;&gt;
+		&lt;div class=&quot;dojoShowHider&quot; dojoAttachPoint=&quot;hider&quot;&gt;&lt;/div&gt;
+		&lt;span unselectable=&quot;on&quot; style=&quot;cursor: default;&quot; dojoAttachEvent=&quot;onClick:previousSlide&quot;&gt;&lt;&lt;/span&gt;
+		&lt;select dojoAttachEvent=&quot;onClick:gotoSlideByEvent&quot; dojoAttachPoint=&quot;select&quot;&gt;
+			&lt;option dojoAttachPoint=&quot;option&quot;&gt;Title&lt;/option&gt;
+		&lt;/select&gt;
+		&lt;span unselectable=&quot;on&quot; style=&quot;cursor: default;&quot; dojoAttachEvent=&quot;onClick:nextSlide&quot;&gt;&gt;&lt;/span&gt;
+	&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,12 @@
+.dojoShowSlideTitle {
+	height: 100px;
+	background: #369;
+}
+.dojoShowSlideTitle h1 {
+	margin-top: 0;
+	line-height: 100px;
+	margin-left: 30px;
+}
+.dojoShowSlideBody {
+	margin: 15px;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ShowSlide.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+&lt;div class=&quot;dojoShowSlide&quot;&gt;
+	&lt;div class=&quot;dojoShowSlideTitle&quot;&gt;
+		&lt;h1 dojoAttachPoint=&quot;htmlTitle&quot;&gt;Title&lt;/h1&gt;
+	&lt;/div&gt;
+	&lt;div class=&quot;dojoShowSlideBody&quot; dojoAttachPoint=&quot;containerNode&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,9 @@
+.slideShowImg {
+	position: absolute;
+	left: 0px;
+	top: 0px; 
+	border: 2px solid #4d4d4d;
+	padding: 0px;
+	margin: 0px;
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/SlideShow.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+&lt;div style=&quot;position: relative; padding: 3px;&quot;&gt;
+		&lt;div&gt;
+			&lt;input type=&quot;button&quot; value=&quot;pause&quot; 
+				dojoAttachPoint=&quot;startStopButton&quot;
+				dojoAttachEvent=&quot;onClick: togglePaused;&quot;&gt;
+		&lt;/div&gt;
+		&lt;div style=&quot;position: relative; width: ${this.width}; height: ${this.height};&quot;
+			dojoAttachPoint=&quot;imagesContainer&quot;
+			dojoAttachEvent=&quot;onClick: togglePaused;&quot;&gt;
+			&lt;img dojoAttachPoint=&quot;img1&quot; class=&quot;slideShowImg&quot; 
+				style=&quot;z-index: 1; width: ${this.width}; height: ${this.height};&quot;  /&gt;
+			&lt;img dojoAttachPoint=&quot;img2&quot; class=&quot;slideShowImg&quot; 
+				style=&quot;z-index: 0; width: ${this.width}; height: ${this.height};&quot; /&gt;
+		&lt;/div&gt;	
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Slider.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Slider.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Slider.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,61 @@
+.sliderMain {
+  border: 0px !important;
+  border-spacing: 0px !important;
+  line-height: 0px !important;
+  padding: 0px !important;
+  display: -moz-inline-table !important;
+  display: inline !important;
+  -moz-user-focus: normal !important;
+}
+
+.sliderComponent {
+  border: 0px;
+  padding: 0px;
+  margin: 0px;
+}
+
+.sliderHandle { 
+  top: 0px;
+  left: 0px;
+  z-index: 1000;
+  position: absolute !important;
+}
+
+.sliderOutsetButton { 
+  border-style: outset;
+  border-width: 0px 1px 1px 0px;
+  border-color: black;
+}
+
+.sliderInsetButton { 
+  border-style: inset;
+  border-width: 1px 0px 0px 1px;
+  border-color: black;
+}
+
+.sliderButtonY {
+  margin: 0px;
+  padding: 0px;
+  z-index: 900;
+}
+
+.sliderButtonX {
+  margin: 0px;
+  padding: 0px;
+  z-index: 900;
+}
+
+.sliderBackground { 
+  z-index: 0;
+  display: block !important;
+  position: relative !important;
+}
+
+.sliderProgressBackground { 
+  z-index: 800;
+  position: absolute !important;
+  clip: rect(0px,0px,0px,0px);
+}
+
+.sliderBackgroundSizeOnly { 
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Slider.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Slider.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Slider.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,56 @@
+&lt;table _=&quot;weird end tag formatting is to prevent whitespace from becoming &nbsp;&quot; 
+	class=&quot;sliderMain&quot; 
+	dojoAttachPoint=&quot;focusNode&quot; 
+	dojoAttachEvent=&quot;onmousedown:_setFocus; onkey:_handleKeyEvents; onkeyup:_buttonReleased; onmouseup:_buttonReleased; onmousewheel:_mouseWheeled;&quot;
+	tabindex=&quot;0&quot; cols=3 cellpadding=0 cellspacing=0 style=&quot;&quot;&gt;
+	&lt;tr valign=middle align=center&gt;
+		&lt;td class=&quot;sliderComponent&quot; colspan=3 dojoAttachPoint=topBorderNode style=&quot;&quot;
+			&gt;&lt;img class=&quot;sliderOutsetButton sliderButtonY&quot;
+				dojoAttachPoint=topButtonNode 
+				dojoAttachEvent=&quot;onmousedown:_topButtonPressed; onmousemove:_discardEvent; ondblclick:_topButtonDoubleClicked;&quot;
+				src=&quot;${this.topButtonSrc}&quot; 
+				style=&quot;${this.buttonStyleY}&quot;
+		&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr valign=middle align=center&gt;
+		&lt;td class=&quot;sliderComponent&quot; dojoAttachPoint=leftBorderNode style=&quot;&quot;
+			&gt;&lt;img class=&quot;sliderOutsetButton sliderButtonX&quot;
+				dojoAttachPoint=leftButtonNode
+				dojoAttachEvent=&quot;onmousedown:_leftButtonPressed; onmousemove:_discardEvent; ondblclick:_leftButtonDoubleClicked;&quot;
+				src=&quot;${this.leftButtonSrc}&quot; 
+				style=&quot;${this.buttonStyleX}&quot;
+		&gt;&lt;/td&gt;
+		&lt;td dojoAttachPoint=constrainingContainerNode 
+			class=&quot;sliderComponent sliderBackground&quot;
+			style=&quot;${this.backgroundStyle}&quot;
+			&gt;&lt;img src=&quot;${this.handleSrc}&quot; 
+				class=sliderHandle
+				dojoAttachPoint=sliderHandleNode
+				style=&quot;${this.handleStyle}&quot;
+			&gt;&lt;img src=&quot;${this.progressBackgroundSrc}&quot;
+				class=&quot;sliderBackgroundSizeOnly sliderProgressBackground&quot;
+				dojoAttachPoint=progressBackgroundNode
+				style=&quot;${this.backgroundSize}&quot;
+			&gt;&lt;img src=&quot;${this.backgroundSrc}&quot; 
+				class=sliderBackgroundSizeOnly
+				dojoAttachPoint=sliderBackgroundNode
+				style=&quot;${this.backgroundSize}&quot;
+		&gt;&lt;/td&gt;
+		&lt;td class=&quot;sliderComponent&quot; dojoAttachPoint=rightBorderNode style=&quot;&quot;
+			&gt;&lt;img class=&quot;sliderOutsetButton sliderButtonX&quot;
+				dojoAttachPoint=rightButtonNode
+				dojoAttachEvent=&quot;onmousedown:_rightButtonPressed; onmousemove:_discardEvent; ondblclick:_rightButtonDoubleClicked;&quot;
+				src=&quot;${this.rightButtonSrc}&quot; 
+				style=&quot;${this.buttonStyleX}&quot;
+		&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+	&lt;tr valign=middle align=center&gt;
+		&lt;td class=&quot;sliderComponent&quot; colspan=3 dojoAttachPoint=bottomBorderNode style=&quot;&quot;
+			&gt;&lt;img class=&quot;sliderOutsetButton sliderButtonY&quot;
+				dojoAttachPoint=bottomButtonNode 
+				dojoAttachEvent=&quot;onmousedown:_bottomButtonPressed; onmousemove:_discardEvent; ondblclick:_bottomButtonDoubleClicked;&quot;
+				src=&quot;${this.bottomButtonSrc}&quot; 
+				style=&quot;${this.buttonStyleY}&quot;
+		&gt;&lt;/td&gt;
+	&lt;/tr&gt;
+&lt;/table&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/SliderHorizontal.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/SliderHorizontal.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/SliderHorizontal.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,3 @@
+&lt;div class=&quot;sliderMainHorizontal&quot;&gt;
+    &lt;div class=&quot;sliderHandleHorizontal&quot; dojoAttachPoint=&quot;sliderHandle&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/SliderVertical.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/SliderVertical.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/SliderVertical.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,3 @@
+&lt;div class=&quot;sliderMainVertical&quot;&gt;
+    &lt;div class=&quot;sliderHandleVertical&quot; dojoAttachPoint=&quot;sliderHandle&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,34 @@
+/* inline the table holding the &lt;input&gt; and buttons (method varies by browser) */
+.ie .dojoSpinner, .safari .dojoSpinner {
+	display: inline;
+}
+
+.moz .dojoSpinner {
+	display: -moz-inline-box;
+}
+
+.opera .dojoSpinner {
+	display: inline-table;
+}
+
+/* generic stuff for the table */
+.dojoSpinner td {
+	padding:0px;
+	margin:0px;
+	vertical-align: middle;
+}
+table.dojoSpinner {
+	border:0px;
+	border-spacing:0px;
+	line-height:0px;
+	padding:0px;
+	margin: 0px;
+	vertical-align: middle;
+}
+
+/* the buttons */
+.dojoSpinner img {
+	display: block;
+	border-width:0px 1px 1px 0px;
+	border-style:outset;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Spinner.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,25 @@
+&lt;span _=&quot;weird end tag formatting is to prevent whitespace from becoming &nbsp;&quot;
+	style='float:${this.htmlfloat};'
+	&gt;&lt;table cellpadding=0 cellspacing=0 class=&quot;dojoSpinner&quot;&gt;
+		&lt;tr&gt;
+			&lt;td
+				&gt;&lt;input
+					dojoAttachPoint='textbox' type='${this.type}'
+					dojoAttachEvent='onblur;onfocus;onkey:_handleKeyEvents;onKeyUp:_onSpinnerKeyUp;onresize:_resize'
+					id='${this.widgetId}' name='${this.name}' size='${this.size}' maxlength='${this.maxlength}'
+					value='${this.value}' class='${this.className}' autocomplete=&quot;off&quot;
+			&gt;&lt;/td&gt;
+			&lt;td
+				&gt;&lt;img dojoAttachPoint=&quot;upArrowNode&quot;
+					dojoAttachEvent=&quot;onDblClick: _upArrowDoubleClicked;  onMouseDown: _upArrowPressed; onMouseUp: _arrowReleased; onMouseOut: _arrowReleased; onMouseMove: _discardEvent;&quot;
+					src=&quot;${this.incrementSrc}&quot; style=&quot;width: ${this.buttonSize.width}px; height: ${this.buttonSize.height}px;&quot;
+				&gt;&lt;img dojoAttachPoint=&quot;downArrowNode&quot;
+					dojoAttachEvent=&quot;onDblClick: _downArrowDoubleClicked;  onMouseDown: _downArrowPressed; onMouseUp: _arrowReleased; onMouseOut: _arrowReleased; onMouseMove: _discardEvent;&quot;
+					src=&quot;${this.decrementSrc}&quot; style=&quot;width: ${this.buttonSize.width}px; height: ${this.buttonSize.height}px;&quot;
+			&gt;&lt;/td&gt;
+		&lt;/tr&gt;
+	&lt;/table
+	&gt;&lt;span dojoAttachPoint='invalidSpan' class='${this.invalidClass}'&gt;${this.messages.invalidMessage}&lt;/span
+	&gt;&lt;span dojoAttachPoint='missingSpan' class='${this.missingClass}'&gt;${this.messages.missingMessage}&lt;/span
+	&gt;&lt;span dojoAttachPoint='rangeSpan' class='${this.rangeClass}'&gt;${this.messages.rangeMessage}&lt;/span
+&gt;&lt;/span&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/SplitContainer.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/SplitContainer.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/SplitContainer.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,40 @@
+.dojoSplitContainer{
+	position: relative;
+	overflow: hidden;
+	display: block;
+}
+
+.dojoSplitPane{
+	position: absolute;
+}
+
+.dojoSplitContainerSizerH,
+.dojoSplitContainerSizerV {
+	font-size: 1px;
+	cursor: move;
+	cursor: w-resize;
+	background-color: ThreeDFace;
+	border: 1px solid;
+	border-color: ThreeDHighlight ThreeDShadow ThreeDShadow ThreeDHighlight;
+	margin: 0;
+}
+
+.dojoSplitContainerSizerV {
+	cursor: n-resize;
+}
+
+.dojoSplitContainerVirtualSizerH,
+.dojoSplitContainerVirtualSizerV {
+	font-size: 1px;
+	cursor: move;
+	cursor: w-resize;
+	background-color: ThreeDShadow;
+	-moz-opacity: 0.5;
+	opacity: 0.5;
+	filter: Alpha(Opacity=50);
+	margin: 0;
+}
+
+.dojoSplitContainerVirtualSizerV {
+	cursor: n-resize;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,163 @@
+.dojoTabContainer {
+	position : relative;
+}
+
+.dojoTabPaneWrapper {
+	border : 1px solid #6290d2;
+	_zoom: 1; /* force IE6 layout mode so top border doesnt disappear */
+	display: block;
+	clear: both;
+	overflow: hidden;
+}
+
+.dojoTabLabels-top {
+	position : relative;
+	top : 0px;
+	left : 0px;
+	overflow : visible;
+	margin-bottom : -1px;
+	width : 100%;
+	z-index: 2;	/* so the bottom of the tab label will cover up the border of dojoTabPaneWrapper */
+}
+
+.dojoTabNoLayout.dojoTabLabels-top .dojoTab {
+	margin-bottom: -1px;
+	_margin-bottom: 0px; /* IE filter so top border lines up correctly */
+}
+
+.dojoTab {
+	position : relative;
+	float : left;
+	padding-left : 9px;
+	border-bottom : 1px solid #6290d2;
+	background : url(images/tab_left.gif) no-repeat left top;
+	cursor: pointer;
+	white-space: nowrap;
+	z-index: 3;
+}
+
+.dojoTab div {
+	display : block;
+	padding : 4px 15px 4px 6px;
+	background : url(images/tab_top_right.gif) no-repeat right top;
+	color : #333;
+	font-size : 90%;
+}
+
+.dojoTab .close {
+	display : inline-block;
+	height : 12px;
+	width : 12px;
+	padding : 0 12px 0 0;
+	margin : 0 -10px 0 10px;
+	cursor : default;
+	font-size: small;
+}
+
+.dojoTab .closeImage {
+	background : url(images/tab_close.gif) no-repeat right top;
+}
+
+.dojoTab .closeHover {
+	background-image : url(images/tab_close_h.gif);
+}
+
+.dojoTab.current {
+	padding-bottom : 1px;
+	border-bottom : 0;
+	background-position : 0 -150px;
+}
+
+.dojoTab.current div {
+	padding-bottom : 5px;
+	margin-bottom : -1px;
+	background-position : 100% -150px;
+}
+
+/* bottom tabs */
+
+.dojoTabLabels-bottom {
+	position : relative;
+	bottom : 0px;
+	left : 0px;
+	overflow : visible;
+	margin-top : -1px;
+	width : 100%;
+	z-index: 2;
+}
+
+.dojoTabNoLayout.dojoTabLabels-bottom {
+	position : relative;
+}
+
+.dojoTabLabels-bottom .dojoTab {
+	border-top :  1px solid #6290d2;
+	border-bottom : 0;
+	background : url(images/tab_bot_left.gif) no-repeat left bottom;
+}
+
+.dojoTabLabels-bottom .dojoTab div {
+	background : url(images/tab_bot_right.gif) no-repeat right bottom;
+}
+
+.dojoTabLabels-bottom .dojoTab.current {
+	border-top : 0;
+	background : url(images/tab_bot_left_curr.gif) no-repeat left bottom;
+}
+
+.dojoTabLabels-bottom .dojoTab.current div {
+	padding-top : 4px;
+	background : url(images/tab_bot_right_curr.gif) no-repeat right bottom;
+}
+
+/* right-h tabs */
+
+.dojoTabLabels-right-h {
+	overflow : visible;
+	margin-left : -1px;
+	z-index: 2;
+}
+
+.dojoTabLabels-right-h .dojoTab {
+	padding-left : 0;
+	border-left :  1px solid #6290d2;
+	border-bottom : 0;
+	background : url(images/tab_bot_right.gif) no-repeat right bottom;
+	float : none;
+}
+
+.dojoTabLabels-right-h .dojoTab div {
+	padding : 4px 15px 4px 15px;
+}
+
+.dojoTabLabels-right-h .dojoTab.current {
+	border-left :  0;
+	border-bottom :  1px solid #6290d2;
+}
+
+/* left-h tabs */
+
+.dojoTabLabels-left-h {
+	overflow : visible;
+	margin-right : -1px;
+	z-index: 2;
+}
+
+.dojoTabLabels-left-h .dojoTab {
+	border-right :  1px solid #6290d2;
+	border-bottom : 0;
+	float : none;
+	background : url(images/tab_top_left.gif) no-repeat left top;
+}
+
+.dojoTabLabels-left-h .dojoTab.current {
+	border-right : 0;
+	border-bottom :  1px solid #6290d2;
+	padding-bottom : 0;
+	background : url(images/tab_top_left.gif) no-repeat 0 -150px;
+}
+
+.dojoTabLabels-left-h .dojoTab div {
+	background : 0;
+	border-bottom :  1px solid #6290d2;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TabContainer.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,4 @@
+&lt;div id=&quot;${this.widgetId}&quot; class=&quot;dojoTabContainer&quot;&gt;
+	&lt;div dojoAttachPoint=&quot;tablistNode&quot;&gt;&lt;/div&gt;
+	&lt;div class=&quot;dojoTabPaneWrapper&quot; dojoAttachPoint=&quot;containerNode&quot; dojoAttachEvent=&quot;onKey&quot; waiRole=&quot;tabpanel&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TabContainerA11y.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TabContainerA11y.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TabContainerA11y.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,175 @@
+.dojoTabContainer {
+	position : relative;
+}
+
+.dojoTabPaneWrapper {
+	position : relative;
+	border : 1px solid #6290d2;
+	clear: both;
+	_zoom: 1; /* force IE6 layout mode so top border doesnt disappear */
+}
+
+.dojoTabLabels-top {
+	position : absolute;
+	top : 0px;
+	left : 0px;
+	overflow : visible;
+	margin-bottom : -1px;
+	width : 100%;
+	z-index: 2;	/* so the bottom of the tab label will cover up the border of dojoTabPaneWrapper */
+}
+
+.dojoTabNoLayout.dojoTabLabels-top {
+	position : relative;
+}
+
+.dojoTabNoLayout.dojoTabLabels-top .dojoTab {
+	margin-bottom: -1px;
+	_margin-bottom: 0px; /* IE filter so top border lines up correctly */
+}
+
+.dojoTab {
+	position : relative;
+	float : left;
+	padding-left : 9px;
+	border-bottom : 1px solid #6290d2;
+	cursor: pointer;
+	white-space: nowrap;
+	z-index: 3;
+}
+
+.dojoTab div {
+	display : block;
+	padding : 4px 15px 4px 6px;
+	color : #333;
+	font-size : 90%;
+}
+
+.dojoTabPanePaneClose {
+	position : absolute;
+	bottom : 0px;
+	right : 6px;
+	height : 12px;
+	width : 12px;
+	font-size : small;
+}
+.dojoTabPanePaneCloseImage {
+}
+
+.dojoTabPanePaneCloseHover {
+}
+
+.dojoTabClose {
+	display : inline-block;
+	height : 12px;
+	width : 12px;
+	padding : 0 12px 0 0;
+	margin : 0 -10px 0 10px;
+	cursor : default;
+	font-size: small;
+}
+
+.dojoTabCloseImage {
+}
+
+.dojoTabCloseHover {
+}
+
+.dojoTab.current {
+	padding-bottom : 1px;
+	border-bottom : 0;
+	background-position : 0 -150px;
+}
+
+.dojoTab.current div {
+	padding-bottom : 5px;
+	margin-bottom : -1px;
+	background-position : 100% -150px;
+}
+
+/* bottom tabs */
+
+.dojoTabLabels-bottom {
+	position : absolute;
+	bottom : 0px;
+	left : 0px;
+	overflow : visible;
+	margin-top : -1px;
+	width : 100%;
+	z-index: 2;
+}
+
+.dojoTabNoLayout.dojoTabLabels-bottom {
+	position : relative;
+}
+
+.dojoTabLabels-bottom .dojoTab {
+	border-top :  1px solid #6290d2;
+	border-bottom : 0;
+}
+
+.dojoTabLabels-bottom .dojoTab div {
+}
+
+.dojoTabLabels-bottom .dojoTab.current {
+	border-top : 0;
+}
+
+.dojoTabLabels-bottom .dojoTab.current div {
+	padding-top : 4px;
+}
+
+/* right-h tabs */
+
+.dojoTabLabels-right-h {
+	position : absolute;
+	top : 0px;
+	right : 0px;
+	overflow : visible;
+	margin-left : -1px;
+	z-index: 2;
+}
+
+.dojoTabLabels-right-h .dojoTab {
+	padding-left : 0;
+	border-left :  1px solid #6290d2;
+	border-bottom : 0;
+	float : none;
+}
+
+.dojoTabLabels-right-h .dojoTab div {
+	padding : 4px 15px 4px 15px;
+}
+
+.dojoTabLabels-right-h .dojoTab.current {
+	border-left :  0;
+	border-bottom :  1px solid #6290d2;
+}
+
+/* left-h tabs */
+
+.dojoTabLabels-left-h {
+	position : absolute;
+	top : 0px;
+	left : 0px;
+	overflow : visible;
+	margin-right : -1px;
+	z-index: 2;
+}
+
+.dojoTabLabels-left-h .dojoTab {
+	border-right :  1px solid #6290d2;
+	border-bottom : 0;
+	float : none;
+}
+
+.dojoTabLabels-left-h .dojoTab.current {
+	border-right : 0;
+	border-bottom :  1px solid #6290d2;
+	padding-bottom : 0;
+}
+
+.dojoTabLabels-left-h .dojoTab div {
+	background : 0;
+	border-bottom :  1px solid #6290d2;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TaskBar.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TaskBar.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TaskBar.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+.dojoTaskBarItem {
+	display: inline-block;
+	background-color: ThreeDFace;
+	border: outset 2px;
+	margin-right: 5px;
+	cursor: pointer;
+	height: 35px;
+	width: 100px;
+	font-size: 10pt;
+	white-space: nowrap;
+	text-align: center;
+	float: left;
+	overflow: hidden;
+}
+
+.dojoTaskBarItem img {
+	vertical-align: middle;
+	margin-right: 5px;
+	margin-left: 5px;	
+	height: 32px;
+	width: 32px;
+}
+
+.dojoTaskBarItem a {
+	 color: black;
+	text-decoration: none;
+}
+
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TaskBarItemTemplate.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TaskBarItemTemplate.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TaskBarItemTemplate.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,2 @@
+&lt;div class=&quot;dojoTaskBarItem&quot; dojoAttachEvent=&quot;onClick&quot;&gt;
+&lt;/div&gt;
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Textbox.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Textbox.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Textbox.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,5 @@
+&lt;span style='float:${this.htmlfloat};'&gt;
+	&lt;input dojoAttachPoint='textbox' dojoAttachEvent='onblur;onfocus'
+		id='${this.widgetId}' name='${this.name}'
+		class='${this.className}' type='${this.type}' &gt;
+&lt;/span&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,179 @@
+/*Time Picker */
+.timePickerContainer {
+	width:122px;
+	font-family:Tahoma, Myriad, Helvetica, Arial, Verdana, sans-serif;
+	font-size:16px;
+}
+
+.timeContainer {
+	border-collapse:collapse;
+	border-spacing:0;
+}
+
+.timeContainer thead {
+	color:#293a4b;
+	font-size:0.9em;
+	font-weight:700;
+}
+
+.timeContainer thead td {
+	padding:0.25em;
+	font-size:0.80em;
+	border-bottom:1px solid #6782A8;
+}
+
+.timeCorner {
+	width:10px;
+}
+
+.cornerTopLeft {
+	background: url(&quot;images/dpCurveTL.png&quot;) top left no-repeat;
+}
+
+.cornerTopRight {
+	background: url(&quot;images/dpCurveTR.png&quot;) top right no-repeat;
+}
+
+.timeLabelContainer {
+	background: url(&quot;images/dpMonthBg.png&quot;) top left repeat-x;
+}
+
+.hours, .minutes, .timeBorder {
+	background: #7591bc url(&quot;images/dpBg.gif&quot;) top left repeat-x;
+
+}
+
+.hours td, .minutes td {
+	padding:0.2em;
+	text-align:center;
+	font-size:0.7em;
+	font-weight:bold;
+	cursor:pointer;
+	cursor:hand;
+	color:#fff;
+}
+
+.minutes {
+	border-left:1px solid #f5d1db;
+}
+
+.hours {
+	border-right:1px solid #6782A8;
+}
+
+.hourSelector {
+	border-right:1px solid #6782A8;
+	padding:5px;
+	padding-right:10px;
+}
+
+.minutesSelector {
+	padding:5px;
+	border-left:1px solid #f5c7d4;
+	text-align:center;
+}
+
+.minutesHeading {
+	padding-left:9px !important;
+}
+
+.timeOptions {
+	background-color:#F9C9D7;
+}
+
+.timeContainer .cornerBottomLeft, .timeContainer .cornerBottomRight, .timeContainer .timeOptions {
+	border-top:1px solid #6782A8;
+}
+
+.timeContainer .cornerBottomLeft {
+	background: url(&quot;images/dpCurveBL.png&quot;) bottom left no-repeat !important;
+	width:9px !important;
+	padding:0;
+	margin:0;
+}
+
+.timeContainer .cornerBottomRight {
+	background: url(&quot;images/dpCurveBR.png&quot;) bottom right no-repeat !important;
+	width:9px !important;
+	padding:0;
+	margin:0;
+}
+
+.timeOptions {
+	color:#fff;
+	background:url(&quot;images/dpYearBg.png&quot;) top left repeat-x;
+
+}
+
+.selectedItem {
+	background-color:#fff;
+	color:#6782a8 !important;
+}
+
+.timeOptions .selectedItem {
+	color:#fff !important;
+	background-color:#9ec3fb !important;
+}
+
+.anyTimeContainer {
+	text-align:center;
+	font-weight:bold;
+	font-size:0.7em;
+	padding:0.1em;
+	cursor:pointer;
+	cursor:hand;
+	color:#fff !important;
+}
+
+.amPmContainer {
+	width:100%;
+}
+
+.amPmContainer td {
+	text-align:center;
+	font-size:0.7em;
+	font-weight:bold;
+	cursor:pointer;
+	cursor:hand;
+	color:#fff;
+}
+
+
+
+/*.timePickerContainer {
+	margin:1.75em 0 0.5em 0;
+	width:10em;
+	float:left;
+}
+
+.timeContainer {
+	border-collapse:collapse;
+	border-spacing:0;
+}
+
+.timeContainer thead td{
+	border-bottom:1px solid #e6e6e6;
+	padding:0 0.4em 0.2em 0.4em;
+}
+
+.timeContainer td {
+	font-size:0.9em;
+	padding:0 0.25em 0 0.25em;
+	text-align:left;
+	cursor:pointer;cursor:hand;
+}
+
+.timeContainer td.minutesHeading {
+	border-left:1px solid #e6e6e6;
+	border-right:1px solid #e6e6e6;	
+}
+
+.timeContainer .minutes {
+	border-left:1px solid #e6e6e6;
+	border-right:1px solid #e6e6e6;
+}
+
+.selectedItem {
+	background-color:#3a3a3a;
+	color:#ffffff;
+}*/

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TimePicker.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,98 @@
+&lt;div class=&quot;timePickerContainer&quot; dojoAttachPoint=&quot;timePickerContainerNode&quot;&gt;
+	&lt;table class=&quot;timeContainer&quot; cellspacing=&quot;0&quot; &gt;
+		&lt;thead&gt;
+			&lt;tr&gt;
+				&lt;td class=&quot;timeCorner cornerTopLeft&quot; valign=&quot;top&quot;&gt;&nbsp;&lt;/td&gt;
+				&lt;td class=&quot;timeLabelContainer hourSelector&quot;&gt;${this.calendar.field-hour}&lt;/td&gt;
+				&lt;td class=&quot;timeLabelContainer minutesHeading&quot;&gt;${this.calendar.field-minute}&lt;/td&gt;
+				&lt;td class=&quot;timeCorner cornerTopRight&quot; valign=&quot;top&quot;&gt;&nbsp;&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/thead&gt;
+		&lt;tbody&gt;
+			&lt;tr&gt;
+				&lt;td valign=&quot;top&quot; colspan=&quot;2&quot; class=&quot;hours&quot;&gt;
+					&lt;table align=&quot;center&quot;&gt;
+						&lt;tbody dojoAttachPoint=&quot;hourContainerNode&quot;  
+							dojoAttachEvent=&quot;onClick: onSetSelectedHour;&quot;&gt;
+							&lt;tr&gt;
+								&lt;td&gt;12&lt;/td&gt;
+								&lt;td&gt;6&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;1&lt;/td&gt;
+								&lt;td&gt;7&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;2&lt;/td&gt;
+								&lt;td&gt;8&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;3&lt;/td&gt;
+								&lt;td&gt;9&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;4&lt;/td&gt;
+								&lt;td&gt;10&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;5&lt;/td&gt;
+								&lt;td&gt;11&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/tbody&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+				&lt;td valign=&quot;top&quot; class=&quot;minutes&quot; colspan=&quot;2&quot;&gt;
+					&lt;table align=&quot;center&quot;&gt;
+						&lt;tbody dojoAttachPoint=&quot;minuteContainerNode&quot; 
+							dojoAttachEvent=&quot;onClick: onSetSelectedMinute;&quot;&gt;
+							&lt;tr&gt;
+								&lt;td&gt;00&lt;/td&gt;
+								&lt;td&gt;30&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;05&lt;/td&gt;
+								&lt;td&gt;35&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;10&lt;/td&gt;
+								&lt;td&gt;40&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;15&lt;/td&gt;
+								&lt;td&gt;45&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;20&lt;/td&gt;
+								&lt;td&gt;50&lt;/td&gt;
+							&lt;/tr&gt;
+							&lt;tr&gt;
+								&lt;td&gt;25&lt;/td&gt;
+								&lt;td&gt;55&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/tbody&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+			&lt;/tr&gt;
+			&lt;tr&gt;
+				&lt;td class=&quot;cornerBottomLeft&quot;&gt;&nbsp;&lt;/td&gt;
+				&lt;td valign=&quot;top&quot; class=&quot;timeOptions&quot;&gt;
+					&lt;table class=&quot;amPmContainer&quot;&gt;
+						&lt;tbody dojoAttachPoint=&quot;amPmContainerNode&quot; 
+							dojoAttachEvent=&quot;onClick: onSetSelectedAmPm;&quot;&gt;
+							&lt;tr&gt;
+								&lt;td id=&quot;am&quot;&gt;${this.calendar.am}&lt;/td&gt;
+								&lt;td id=&quot;pm&quot;&gt;${this.calendar.pm}&lt;/td&gt;
+							&lt;/tr&gt;
+						&lt;/tbody&gt;
+					&lt;/table&gt;
+				&lt;/td&gt;
+				&lt;td class=&quot;timeOptions&quot;&gt;
+					&lt;div dojoAttachPoint=&quot;anyTimeContainerNode&quot; 
+						dojoAttachEvent=&quot;onClick: onSetSelectedAnyTime;&quot; 
+						class=&quot;anyTimeContainer&quot;&gt;${this.widgetStrings.any}&lt;/div&gt;
+				&lt;/td&gt;
+				&lt;td class=&quot;cornerBottomRight&quot;&gt;&nbsp;&lt;/td&gt;
+			&lt;/tr&gt;
+		&lt;/tbody&gt;
+	&lt;/table&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TitlePane.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TitlePane.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TitlePane.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,4 @@
+&lt;div dojoAttachPoint=&quot;domNode&quot;&gt;
+&lt;div dojoAttachPoint=&quot;labelNode&quot; dojoAttachEvent=&quot;onclick: onLabelClick&quot;&gt;&lt;/div&gt;
+&lt;div dojoAttachPoint=&quot;containerNode&quot;&gt;&lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Toaster.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Toaster.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Toaster.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,42 @@
+.dojoToasterClip {
+	position: absolute;
+	overflow: hidden;
+}
+
+.dojoToasterContainer {
+	display: block;
+	position: absolute;
+	width: 17.5em;
+	z-index: 5000;
+	margin: 0px;
+	font:0.75em Tahoma, Helvetica, Verdana, Arial;
+}
+
+.dojoToasterContent{
+	padding:1em;
+	padding-top:0.25em;
+	background:#73c74a;
+}
+
+.dojoToasterMessage{ 
+	color:#fff;
+}
+.dojoToasterWarning{ }
+.dojoToasterError,
+.dojoToasterFatal{
+	font-weight:bold;
+	color:#fff;
+}
+
+
+.dojoToasterWarning .dojoToasterContent{
+	padding:1em;
+	padding-top:0.25em;
+	background:#d4d943;
+} 
+
+.dojoToasterError .dojoToasterContent{
+	padding:1em;
+	padding-top:0.25em;
+	background:#c46600;
+} 

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Toolbar.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Toolbar.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Toolbar.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+.toolbarContainer {
+	border-bottom : 0;
+	background-color : #def;
+	color : ButtonText;
+	font : Menu;
+	background-image: url(images/toolbar-bg.gif);
+}
+
+.toolbar {
+	padding : 2px 4px;
+	min-height : 26px;
+	_height : 26px;
+}
+
+.toolbarItem {
+	float : left;
+	padding : 1px 2px;
+	margin : 0 2px 1px 0;
+	cursor : pointer;
+}
+
+.toolbarItem.selected, .toolbarItem.down {
+	margin : 1px 1px 0 1px;
+	padding : 0px 1px;
+	border : 1px solid #bbf;
+	background-color : #fafaff;
+}
+
+.toolbarButton img {
+	vertical-align : bottom;
+}
+
+.toolbarButton span {
+	line-height : 16px;
+	vertical-align : middle;
+}
+
+.toolbarButton.hover {
+	padding : 0px 1px;
+	border : 1px solid #99c;
+}
+
+.toolbarItem.disabled {
+	opacity : 0.3;
+	filter : alpha(opacity=30);
+	cursor : default;
+}
+
+.toolbarSeparator {
+	cursor : default;
+}
+
+.toolbarFlexibleSpace {
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TooltipTemplate.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TooltipTemplate.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TooltipTemplate.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+.dojoTooltip {
+	border: solid black 1px;
+	background: beige;
+	color: black;
+	position: absolute;
+	font-size: small;
+	padding: 2px 2px 2px 2px;
+	z-index: 10;
+	display: block;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Tree.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Tree.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Tree.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,29 @@
+.dojoTree {
+	font: caption;
+	font-size: 11px;
+	font-weight: normal;
+	overflow: auto;
+}
+
+.dojoTreeNodeLabel {
+	padding: 1px 2px;
+	color: WindowText;
+	cursor: default;
+}
+
+.dojoTreeNodeLabel:hover {
+	text-decoration: underline;
+}
+
+.dojoTreeNodeLabelSelected {
+	background-color: Highlight;
+	color: HighlightText;
+}
+
+.dojoTree div {
+	white-space: nowrap;
+}
+
+.dojoTree img {
+	vertical-align: middle;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TreeDisableWrap.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TreeDisableWrap.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TreeDisableWrap.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,9 @@
+
+/* CSS for TreeDisableWrapExtension */
+
+.TreeDisableWrap {
+	white-space: nowrap;
+}
+.TreeIEDisableWrap {
+	width: expression( 5 + firstChild.offsetWidth );
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TreeDocIcon.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TreeDocIcon.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TreeDocIcon.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,55 @@
+
+/* CSS for TreeDocIconExtension */
+
+
+/* long vertical line under docIcon, connecting w/ children */
+.TreeStateChildrenYes-ExpandOpen .TreeIconContent {
+    background-image : url('../templates/images/TreeV3/i_long.gif');
+    background-repeat : no-repeat;
+    background-position: 18px 9px;
+}
+
+/* close has higher priority */
+.TreeStateChildrenYes-ExpandClosed .TreeIconContent {
+    background-image : url();
+}
+
+/* higher priotity: same length and appear after background-definition */
+.TreeStateChildrenNo-ExpandLeaf .TreeIconContent {
+    background-image : url();
+}
+
+.TreeStateChildrenNo-ExpandClosed .TreeIconContent {
+    background-image : url();
+}
+
+.TreeStateChildrenNo-ExpandOpen .TreeIconContent {
+    background-image : url();
+}
+
+
+/* highest priority */
+.TreeIconDocument {
+    background-image: url('../templates/images/TreeV3/document.gif');
+}
+
+.TreeExpandOpen .TreeIconFolder {
+    background-image: url('../templates/images/TreeV3/open.gif');
+}
+
+.TreeExpandClosed .TreeIconFolder {
+    background-image: url('../templates/images/TreeV3/closed.gif');
+}
+
+/* generic class for docIcon */
+.TreeIcon {
+    width: 18px;
+    height: 18px;
+    float: left;
+    display: inline;
+    background-repeat : no-repeat;
+}
+
+div.TreeContent {
+    margin-left: 36px;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TreeEditor.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TreeEditor.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TreeEditor.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,4 @@
+html, body {
+      background-color: #ffc;
+      color: black;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/TreeV3.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/TreeV3.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/TreeV3.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,82 @@
+/* indent for all tree children excepts root */
+.TreeNode {
+    background-image : url('../templates/images/TreeV3/i.gif');
+    background-position : top left;
+    background-repeat : repeat-y;
+    margin-left: 19px;
+    zoom: 1;
+}
+.TreeIsRoot {
+    margin-left: 0;
+}
+ 
+/* left vertical line (grid) for all nodes */
+.TreeIsLast {
+    background-image: url('../templates/images/TreeV3/i_half.gif');
+    background-repeat : no-repeat;
+}
+ 
+.TreeExpandOpen .TreeExpand {
+    background-image: url('../templates/images/TreeV3/expand_minus.gif');
+}
+ 
+/* closed is higher priority than open */
+.TreeExpandClosed .TreeExpand {
+    background-image: url('../templates/images/TreeV3/expand_plus.gif');
+}
+ 
+/* highest priority */
+.TreeExpandLeaf .TreeExpand {
+    background-image: url('../templates/images/TreeV3/expand_leaf.gif');
+}
+
+/* 
+should always override any expand setting, but do not touch children.
+if I add .TreeExpand .TreeExpandLoading same time and put it to top/bottom, then it will take precedence over +- for all descendants or always fail
+so I have to remove TreeExpand and process this one specifically
+*/
+
+.TreeExpandLoading   {
+    width: 18px;
+    height: 18px;
+    float: left;
+    display: inline;
+    background-repeat : no-repeat;
+    background-image: url('../templates/images/TreeV3/expand_loading.gif');
+}
+ 
+.TreeContent {
+    min-height: 18px;
+    min-width: 18px;
+    margin-left:18px;
+    cursor: default;
+    /* can't make inline - multiline bugs */
+}
+
+.TreeIEContent {
+	height: 18px;
+}
+ 
+.TreeExpand {
+    width: 18px;
+    height: 18px;
+    float: left;
+    display: inline;
+    background-repeat : no-repeat;
+}
+ 
+/* same style as IE selection */
+.TreeNodeEmphasized {
+    background-color: Highlight;
+    color: HighlightText;
+}
+ 
+.TreeContent .RichTextEditable, .TreeContent .RichTextEditable iframe {
+      background-color: #ffc;
+      color: black;
+}
+
+/* don't use :focus due to opera's lack of support on div's */
+.TreeLabelFocused {
+      outline: 1px invert dotted;
+}

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Validate.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Validate.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Validate.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,12 @@
+.dojoValidateEmpty{
+	background-color: #00FFFF;
+}
+.dojoValidateValid{
+	background-color: #cfc;
+}
+.dojoValidateInvalid{
+	background-color: #fcc;
+}
+.dojoValidateRange{
+	background-color: #ccf;
+}
\ No newline at end of file

Added: tags/parley-0.55/root/static/magic/src/widget/templates/ValidationTextbox.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/ValidationTextbox.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/ValidationTextbox.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,8 @@
+&lt;span style='float:${this.htmlfloat};'&gt;
+	&lt;input dojoAttachPoint='textbox' type='${this.type}' dojoAttachEvent='onblur;onfocus;onkeyup'
+		id='${this.widgetId}' name='${this.name}' size='${this.size}' maxlength='${this.maxlength}'
+		class='${this.className}' style=''&gt;
+	&lt;span dojoAttachPoint='invalidSpan' class='${this.invalidClass}'&gt;${this.messages.invalidMessage}&lt;/span&gt;
+	&lt;span dojoAttachPoint='missingSpan' class='${this.missingClass}'&gt;${this.messages.missingMessage}&lt;/span&gt;
+	&lt;span dojoAttachPoint='rangeSpan' class='${this.rangeClass}'&gt;${this.messages.rangeMessage}&lt;/span&gt;
+&lt;/span&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,72 @@
+.WizardContainer {
+	background: #EEEEEE;
+	border: #798EC5 1px solid;
+	padding: 2px;
+}
+
+.WizardTitle {
+	color: #003366;
+	padding: 8px 5px 15px 2px;
+	font-weight: bold;
+	font-size: x-small;
+	font-style: normal;
+	font-family: Verdana, Arial, Helvetica;
+	text-align: left;
+}
+
+.WizardText {
+	color: #000033;
+	font-weight: normal;
+	font-size: xx-small;
+	font-family: Verdana, Arial, Helvetica;
+	padding: 2 50; text-align: justify;
+}
+
+.WizardLightText {
+	color: #666666;
+	font-weight: normal;
+	font-size: xx-small;
+	font-family: verdana, arial, helvetica;
+	padding: 2px 50px;
+	text-align: justify;
+}
+
+.WizardButtonHolder {
+	text-align: right;
+	padding: 10px 5px;
+}
+
+.WizardButton {
+	color: #ffffff;
+	background: #798EC5;
+	font-size: xx-small;
+	font-family: verdana, arial, helvetica, sans-serif;
+	border-right: #000000 1px solid;
+	border-bottom: #000000 1px solid;
+	border-left: #666666 1px solid;
+	border-top: #666666 1px solid;
+	padding-right: 4px;
+	padding-left: 4px;
+	text-decoration: none; height: 18px;
+}
+
+.WizardButton:hover {
+	cursor: pointer;
+}
+
+.WizardButtonDisabled {
+	color: #eeeeee;
+	background-color: #999999;
+	font-size: xx-small;
+	FONT-FAMILY: verdana, arial, helvetica, sans-serif;
+	border-right: #000000 1px solid;
+	border-bottom: #000000 1px solid;
+	border-left: #798EC5 1px solid;
+	border-top: #798EC5 1px solid;
+	padding-right: 4px;
+	padding-left: 4px;
+	text-decoration: none;
+	height: 18px;
+}
+
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/Wizard.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+&lt;div class=&quot;WizardContainer&quot; dojoAttachPoint=&quot;wizardNode&quot;&gt;
+    &lt;div class=&quot;WizardText&quot; dojoAttachPoint=&quot;wizardPanelContainerNode&quot;&gt;
+    &lt;/div&gt;
+    &lt;div class=&quot;WizardButtonHolder&quot; dojoAttachPoint=&quot;wizardControlContainerNode&quot;&gt;
+        &lt;input class=&quot;WizardButton&quot; type=&quot;button&quot; dojoAttachPoint=&quot;previousButton&quot;/&gt;
+        &lt;input class=&quot;WizardButton&quot; type=&quot;button&quot; dojoAttachPoint=&quot;nextButton&quot;/&gt;
+        &lt;input class=&quot;WizardButton&quot; type=&quot;button&quot; dojoAttachPoint=&quot;doneButton&quot; style=&quot;display:none&quot;/&gt;
+        &lt;input class=&quot;WizardButton&quot; type=&quot;button&quot; dojoAttachPoint=&quot;cancelButton&quot;/&gt;
+    &lt;/div&gt;
+&lt;/div&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/aggregate.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/aggregate.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/backcolor.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/backcolor.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/bg-fade.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/bg-fade.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/bold.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/bold.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/cancel.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/cancel.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/copy.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/copy.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/createlink.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/createlink.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/cut.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/cut.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/delete.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/delete.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/forecolor.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/forecolor.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/hilitecolor.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/hilitecolor.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/indent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/indent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/inserthorizontalrule.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/inserthorizontalrule.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertimage.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertimage.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertorderedlist.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertorderedlist.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/inserttable.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/inserttable.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertunorderedlist.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/insertunorderedlist.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/italic.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/italic.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifycenter.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifycenter.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyfull.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyfull.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyleft.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyleft.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyright.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/justifyright.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/left_to_right.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/left_to_right.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_bullet_indent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_bullet_indent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_bullet_outdent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_bullet_outdent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_num_indent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_num_indent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_num_outdent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/list_num_outdent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/outdent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/outdent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/paste.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/paste.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/redo.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/redo.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/removeformat.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/removeformat.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/right_to_left.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/right_to_left.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/save.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/save.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/sep.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/sep.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/space.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/space.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/strikethrough.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/strikethrough.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/subscript.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/subscript.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/superscript.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/superscript.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/underline.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/underline.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/undo.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/undo.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/wikiword.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/buttons/wikiword.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/check.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/check.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/decrementMonth.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/decrementMonth.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/decrementWeek.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/decrementWeek.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/grabCorner.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/grabCorner.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/Tree.css
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/Tree.css	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/Tree.css	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,36 @@
+
+.dojoTree {
+	font: caption;
+	font-size: 11px;
+	font-weight: normal;
+	overflow: auto;
+}
+
+
+.dojoTreeNodeLabelTitle {
+	padding-left: 2px;
+	color: WindowText;
+}
+
+.dojoTreeNodeLabel {
+	cursor:hand;
+	cursor:pointer;
+}
+
+.dojoTreeNodeLabelTitle:hover {
+	text-decoration: underline;
+}
+
+.dojoTreeNodeLabelSelected {
+	background-color: Highlight;
+	color: HighlightText;
+}
+
+.dojoTree div {
+	white-space: nowrap;
+}
+
+.dojoTree img, .dojoTreeNodeLabel img {
+	vertical-align: middle;
+}
+

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/blank.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/blank.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/closed.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/closed.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/document.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/document.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/minus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/minus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/plus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/plus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/transparent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/transparent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_blank.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_blank.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_child.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_child.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_expand_minus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_expand_minus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_expand_plus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_expand_plus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_c.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_c.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_p.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_p.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_t.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_t.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_v.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_v.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_x.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_x.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_y.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_y.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_z.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_grid_z.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_loading.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_loading.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_loading.jpg
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/Tree/treenode_loading.jpg
___________________________________________________________________
Name: svn:mime-type
   + image/jpeg

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/closed.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/closed.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/document.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/document.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_leaf.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_leaf.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_loading.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_loading.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_minus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_minus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_plus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/expand_plus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_bhalf.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_bhalf.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_half.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_half.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_long.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/i_long.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/minus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/minus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/open.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/open.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/plus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/plus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/t.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/t.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/x.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/TreeV3/x.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/bar.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/bar.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/bdYearBg.1.gif
===================================================================

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/bdYearBg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/bdYearBg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/blank.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/blank.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/clock.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/clock.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/combo_box_arrow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/combo_box_arrow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dateIcon.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dateIcon.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/decrementMonth.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/decrementMonth.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/decrementMonth.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/decrementMonth.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpBg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpBg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveBL.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveBL.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveBR.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveBR.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveTL.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveTL.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveTR.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpCurveTR.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpHorizLine.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpHorizLine.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpHorizLineFoot.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpHorizLineFoot.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg2.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpMonthBg2.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpVertLine.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpVertLine.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpYearBg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpYearBg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpYearBg.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dpYearBg.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dropdownButtonsArrow-disabled.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dropdownButtonsArrow-disabled.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/dropdownButtonsArrow.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/dropdownButtonsArrow.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneClose.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneClose.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneMaximize.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneMaximize.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneMinimize.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneMinimize.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneRestore.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/floatingPaneRestore.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/h-bar.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/h-bar.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/incrementMonth.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/incrementMonth.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/incrementMonth.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/incrementMonth.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/no.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/no.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/no.svg
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/images/no.svg	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/images/no.svg	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,11 @@
+&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
+&lt;!-- Generator: Adobe Illustrator 12.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 51448)  --&gt;
+&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;<A HREF="http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd</A>&quot; [
+	&lt;!ENTITY ns_svg &quot;<A HREF="http://www.w3.org/2000/svg">http://www.w3.org/2000/svg</A>&quot;&gt;
+	&lt;!ENTITY ns_xlink &quot;<A HREF="http://www.w3.org/1999/xlink">http://www.w3.org/1999/xlink</A>&quot;&gt;
+]&gt;
+&lt;svg  version=&quot;1.1&quot; id=&quot;Layer_1&quot; xmlns=&quot;&amp;ns_svg;&quot; xmlns:xlink=&quot;&amp;ns_xlink;&quot; width=&quot;15.433&quot; height=&quot;15.433&quot;
+	 viewBox=&quot;0 0 15.433 15.433&quot; overflow=&quot;visible&quot; enable-background=&quot;new 0 0 15.433 15.433&quot; xml:space=&quot;preserve&quot;&gt;
+&lt;circle fill=&quot;none&quot; stroke=&quot;#D02026&quot; stroke-width=&quot;2&quot; cx=&quot;7.716&quot; cy=&quot;7.716&quot; r=&quot;6.716&quot;/&gt;
+&lt;line fill=&quot;none&quot; stroke=&quot;#D02026&quot; stroke-width=&quot;2&quot; x1=&quot;3.02&quot; y1=&quot;12.352&quot; x2=&quot;12.639&quot; y2=&quot;2.732&quot;/&gt;
+&lt;/svg&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/scBackground.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/scBackground.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg-progress-vert.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg-progress-vert.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg-vert.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg-vert.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-bg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button-horz.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button-horz.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button-vert.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button-vert.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider-button.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_down_arrow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_down_arrow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_left_arrow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_left_arrow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_right_arrow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_right_arrow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_up_arrow.png
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/slider_up_arrow.png
___________________________________________________________________
Name: svn:mime-type
   + image/x-png

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaAccordionOff.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaAccordionOff.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaAccordionSelected.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaAccordionSelected.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-c.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-c.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-r.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaActive-r.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaBarBg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaBarBg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-c.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-c.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-r.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaButton-r.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-c.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-c.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-r.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaDisabled-r.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaMenuBg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaMenuBg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-c.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-c.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-r.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/soriaPressed-r.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/spinnerDecrement.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/spinnerDecrement.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/spinnerIncrement.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/spinnerIncrement.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_disabled.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_disabled.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_off.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_off.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_on.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/submenu_on.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_left.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_left.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_left_curr.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_left_curr.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_right.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_right.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_right_curr.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_bot_right_curr.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_close.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_close.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_close_h.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_close_h.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left_r.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left_r.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left_r_curr.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_left_r_curr.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right_r.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right_r.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right_r_curr.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_right_r_curr.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_top_left.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_top_left.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_top_right.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/tab_top_right.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/timeIcon.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/timeIcon.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/toolbar-bg.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/toolbar-bg.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/transparent.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/transparent.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_blank.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_blank.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_child.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_child.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_expand_minus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_expand_minus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_expand_plus.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_expand_plus.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_c.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_c.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_l.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_l.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_p.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_p.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_t.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_t.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_v.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_v.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_x.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_x.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_y.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_y.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_z.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_grid_z.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_node.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/treenode_node.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/verticalbar.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/verticalbar.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/images/whiteDownArrow.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/images/whiteDownArrow.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/incrementMonth.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/incrementMonth.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/incrementWeek.gif
===================================================================
(Binary files differ)


Property changes on: tags/parley-0.55/root/static/magic/src/widget/templates/incrementWeek.gif
___________________________________________________________________
Name: svn:mime-type
   + image/gif

Added: tags/parley-0.55/root/static/magic/src/widget/templates/richtextframe.html
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/templates/richtextframe.html	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/templates/richtextframe.html	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,24 @@
+&lt;!-- &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt; --&gt;
+
+&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot; 
+	&quot;DTD/xhtml1-strict.dtd&quot;&gt;
+&lt;html&gt;
+	&lt;head&gt;
+		&lt;title&gt;&lt;/title&gt;
+		&lt;script type=&quot;text/javascript&quot;&gt;
+			function init(){
+				document.designMode = 'on';
+				try{
+					parentPageDomain = document.location.href.split('#')[1];
+					if(parentPageDomain){
+						document.domain = parentPageDomain;
+					}
+				}catch(e){ }
+			}
+			window.onload = init;
+		&lt;/script&gt;
+	&lt;/head&gt;
+	&lt;body&gt;
+		&lt;br /&gt;
+	&lt;/body&gt;
+&lt;/html&gt;

Added: tags/parley-0.55/root/static/magic/src/widget/validate.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/validate.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/validate.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,15 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.validate&quot;);
+dojo.deprecated(&quot;dojo.widget.validate&quot;, &quot;use one of the specific widgets in dojo.widget.&lt;name&gt;Textbox instead&quot;, &quot;0.5&quot;);
+

Added: tags/parley-0.55/root/static/magic/src/widget/vml/Chart.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/widget/vml/Chart.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/widget/vml/Chart.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,527 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.widget.vml.Chart&quot;);
+dojo.require(&quot;dojo.widget.HtmlWidget&quot;);
+dojo.require(&quot;dojo.widget.Chart&quot;);
+dojo.require(&quot;dojo.math&quot;);
+dojo.require(&quot;dojo.html.layout&quot;);
+dojo.require(&quot;dojo.gfx.color&quot;);
+dojo.widget.defineWidget(&quot;dojo.widget.vml.Chart&quot;, [dojo.widget.HtmlWidget, dojo.widget.Chart], function () {
+	this.templatePath = null;
+	this.templateCssPath = null;
+	this._isInitialize = false;
+	this.hasData = false;
+	this.vectorNode = null;
+	this.plotArea = null;
+	this.dataGroup = null;
+	this.axisGroup = null;
+	this.properties = {height:0, width:0, defaultWidth:600, defaultHeight:400, plotType:null, padding:{top:10, bottom:2, left:60, right:30}, axes:{x:{plotAt:0, label:&quot;&quot;, unitLabel:&quot;&quot;, unitType:Number, nUnitsToShow:10, range:{min:0, max:200}}, y:{plotAt:0, label:&quot;&quot;, unitLabel:&quot;&quot;, unitType:Number, nUnitsToShow:10, range:{min:0, max:200}}}};
+}, {parseProperties:function (node) {
+	var bRangeX = false;
+	var bRangeY = false;
+	if (node.getAttribute(&quot;width&quot;)) {
+		this.properties.width = node.getAttribute(&quot;width&quot;);
+	}
+	if (node.getAttribute(&quot;height&quot;)) {
+		this.properties.height = node.getAttribute(&quot;height&quot;);
+	}
+	if (node.getAttribute(&quot;plotType&quot;)) {
+		this.properties.plotType = node.getAttribute(&quot;plotType&quot;);
+	}
+	if (node.getAttribute(&quot;padding&quot;)) {
+		if (node.getAttribute(&quot;padding&quot;).indexOf(&quot;,&quot;) &gt; -1) {
+			var p = node.getAttribute(&quot;padding&quot;).split(&quot;,&quot;);
+		} else {
+			var p = node.getAttribute(&quot;padding&quot;).split(&quot; &quot;);
+		}
+		if (p.length == 1) {
+			var pad = parseFloat(p[0]);
+			this.properties.padding.top = pad;
+			this.properties.padding.right = pad;
+			this.properties.padding.bottom = pad;
+			this.properties.padding.left = pad;
+		} else {
+			if (p.length == 2) {
+				var padV = parseFloat(p[0]);
+				var padH = parseFloat(p[1]);
+				this.properties.padding.top = padV;
+				this.properties.padding.right = padH;
+				this.properties.padding.bottom = padV;
+				this.properties.padding.left = padH;
+			} else {
+				if (p.length == 4) {
+					this.properties.padding.top = parseFloat(p[0]);
+					this.properties.padding.right = parseFloat(p[1]);
+					this.properties.padding.bottom = parseFloat(p[2]);
+					this.properties.padding.left = parseFloat(p[3]);
+				}
+			}
+		}
+	}
+	if (node.getAttribute(&quot;rangeX&quot;)) {
+		var p = node.getAttribute(&quot;rangeX&quot;);
+		if (p.indexOf(&quot;,&quot;) &gt; -1) {
+			p = p.split(&quot;,&quot;);
+		} else {
+			p = p.split(&quot; &quot;);
+		}
+		this.properties.axes.x.range.min = parseFloat(p[0]);
+		this.properties.axes.x.range.max = parseFloat(p[1]);
+		bRangeX = true;
+	}
+	if (node.getAttribute(&quot;rangeY&quot;)) {
+		var p = node.getAttribute(&quot;rangeY&quot;);
+		if (p.indexOf(&quot;,&quot;) &gt; -1) {
+			p = p.split(&quot;,&quot;);
+		} else {
+			p = p.split(&quot; &quot;);
+		}
+		this.properties.axes.y.range.min = parseFloat(p[0]);
+		this.properties.axes.y.range.max = parseFloat(p[1]);
+		bRangeY = true;
+	}
+	return {rangeX:bRangeX, rangeY:bRangeY};
+}, setAxesPlot:function (table) {
+	if (table.getAttribute(&quot;axisAt&quot;)) {
+		var p = table.getAttribute(&quot;axisAt&quot;);
+		if (p.indexOf(&quot;,&quot;) &gt; -1) {
+			p = p.split(&quot;,&quot;);
+		} else {
+			p = p.split(&quot; &quot;);
+		}
+		if (!isNaN(parseFloat(p[0]))) {
+			this.properties.axes.x.plotAt = parseFloat(p[0]);
+		} else {
+			if (p[0].toLowerCase() == &quot;ymin&quot;) {
+				this.properties.axes.x.plotAt = this.properties.axes.y.range.min;
+			} else {
+				if (p[0].toLowerCase() == &quot;ymax&quot;) {
+					this.properties.axes.x.plotAt = this.properties.axes.y.range.max;
+				}
+			}
+		}
+		if (!isNaN(parseFloat(p[1]))) {
+			this.properties.axes.y.plotAt = parseFloat(p[1]);
+		} else {
+			if (p[1].toLowerCase() == &quot;xmin&quot;) {
+				this.properties.axes.y.plotAt = this.properties.axes.x.range.min;
+			} else {
+				if (p[1].toLowerCase() == &quot;xmax&quot;) {
+					this.properties.axes.y.plotAt = this.properties.axes.x.range.max;
+				}
+			}
+		}
+	} else {
+		this.properties.axes.x.plotAt = this.properties.axes.y.range.min;
+		this.properties.axes.y.plotAt = this.properties.axes.x.range.min;
+	}
+}, drawVectorNode:function () {
+	if (this.vectorNode) {
+		this.destroy();
+	}
+	this.vectorNode = document.createElement(&quot;div&quot;);
+	this.vectorNode.style.width = this.properties.width + &quot;px&quot;;
+	this.vectorNode.style.height = this.properties.height + &quot;px&quot;;
+	this.vectorNode.style.position = &quot;relative&quot;;
+	this.domNode.appendChild(this.vectorNode);
+}, drawPlotArea:function () {
+	var plotWidth = this.properties.width - this.properties.padding.left - this.properties.padding.right;
+	var plotHeight = this.properties.height - this.properties.padding.top - this.properties.padding.bottom;
+	if (this.plotArea) {
+		this.plotArea.parentNode.removeChild(this.plotArea);
+		this.plotArea = null;
+	}
+	this.plotArea = document.createElement(&quot;div&quot;);
+	this.plotArea.style.position = &quot;absolute&quot;;
+	this.plotArea.style.backgroundColor = &quot;#fff&quot;;
+	this.plotArea.style.top = (this.properties.padding.top) - 2 + &quot;px&quot;;
+	this.plotArea.style.left = (this.properties.padding.left - 1) + &quot;px&quot;;
+	this.plotArea.style.width = plotWidth + &quot;px&quot;;
+	this.plotArea.style.height = plotHeight + &quot;px&quot;;
+	this.plotArea.style.clip = &quot;rect(0 &quot; + plotWidth + &quot; &quot; + plotHeight + &quot; 0)&quot;;
+	this.vectorNode.appendChild(this.plotArea);
+}, drawDataGroup:function () {
+	var plotWidth = this.properties.width - this.properties.padding.left - this.properties.padding.right;
+	var plotHeight = this.properties.height - this.properties.padding.top - this.properties.padding.bottom;
+	if (this.dataGroup) {
+		this.dataGroup.parentNode.removeChild(this.dataGroup);
+		this.dataGroup = null;
+	}
+	this.dataGroup = document.createElement(&quot;div&quot;);
+	this.dataGroup.style.position = &quot;absolute&quot;;
+	this.dataGroup.setAttribute(&quot;title&quot;, &quot;Data Group&quot;);
+	this.dataGroup.style.top = &quot;0px&quot;;
+	this.dataGroup.style.left = &quot;0px&quot;;
+	this.dataGroup.style.width = plotWidth + &quot;px&quot;;
+	this.dataGroup.style.height = plotHeight + &quot;px&quot;;
+	this.plotArea.appendChild(this.dataGroup);
+}, drawAxes:function () {
+	var plotWidth = this.properties.width - this.properties.padding.left - this.properties.padding.right;
+	var plotHeight = this.properties.height - this.properties.padding.top - this.properties.padding.bottom;
+	if (this.axisGroup) {
+		this.axisGroup.parentNode.removeChild(this.axisGroup);
+		this.axisGroup = null;
+	}
+	this.axisGroup = document.createElement(&quot;div&quot;);
+	this.axisGroup.style.position = &quot;absolute&quot;;
+	this.axisGroup.setAttribute(&quot;title&quot;, &quot;Axis Group&quot;);
+	this.axisGroup.style.top = &quot;0px&quot;;
+	this.axisGroup.style.left = &quot;0px&quot;;
+	this.axisGroup.style.width = plotWidth + &quot;px&quot;;
+	this.axisGroup.style.height = plotHeight + &quot;px&quot;;
+	this.plotArea.appendChild(this.axisGroup);
+	var stroke = 1;
+	var line = document.createElement(&quot;v:line&quot;);
+	var y = dojo.widget.vml.Chart.Plotter.getY(this.properties.axes.x.plotAt, this);
+	line.setAttribute(&quot;from&quot;, &quot;0px,&quot; + y + &quot;px&quot;);
+	line.setAttribute(&quot;to&quot;, plotWidth + &quot;px,&quot; + y + &quot;px&quot;);
+	line.style.position = &quot;absolute&quot;;
+	line.style.top = &quot;0px&quot;;
+	line.style.left = &quot;0px&quot;;
+	line.style.antialias = &quot;false&quot;;
+	line.setAttribute(&quot;strokecolor&quot;, &quot;#666&quot;);
+	line.setAttribute(&quot;strokeweight&quot;, stroke * 2 + &quot;px&quot;);
+	this.axisGroup.appendChild(line);
+	var line = document.createElement(&quot;v:line&quot;);
+	var x = dojo.widget.vml.Chart.Plotter.getX(this.properties.axes.y.plotAt, this);
+	line.setAttribute(&quot;from&quot;, x + &quot;px,0px&quot;);
+	line.setAttribute(&quot;to&quot;, x + &quot;px,&quot; + plotHeight + &quot;px&quot;);
+	line.style.position = &quot;absolute&quot;;
+	line.style.top = &quot;0px&quot;;
+	line.style.left = &quot;0px&quot;;
+	line.style.antialias = &quot;false&quot;;
+	line.setAttribute(&quot;strokecolor&quot;, &quot;#666&quot;);
+	line.setAttribute(&quot;strokeweight&quot;, stroke * 2 + &quot;px&quot;);
+	this.axisGroup.appendChild(line);
+	var size = 10;
+	var t = document.createElement(&quot;div&quot;);
+	t.style.position = &quot;absolute&quot;;
+	t.style.top = (this.properties.height - this.properties.padding.bottom) + &quot;px&quot;;
+	t.style.left = this.properties.padding.left + &quot;px&quot;;
+	t.style.fontFamily = &quot;sans-serif&quot;;
+	t.style.fontSize = size + &quot;px&quot;;
+	t.innerHTML = dojo.math.round(parseFloat(this.properties.axes.x.range.min), 2);
+	this.vectorNode.appendChild(t);
+	t = document.createElement(&quot;div&quot;);
+	t.style.position = &quot;absolute&quot;;
+	t.style.top = (this.properties.height - this.properties.padding.bottom) + &quot;px&quot;;
+	t.style.left = (this.properties.width - this.properties.padding.right - size) + &quot;px&quot;;
+	t.style.fontFamily = &quot;sans-serif&quot;;
+	t.style.fontSize = size + &quot;px&quot;;
+	t.innerHTML = dojo.math.round(parseFloat(this.properties.axes.x.range.max), 2);
+	this.vectorNode.appendChild(t);
+	t = document.createElement(&quot;div&quot;);
+	t.style.position = &quot;absolute&quot;;
+	t.style.top = (size / 2) + &quot;px&quot;;
+	t.style.left = &quot;0px&quot;;
+	t.style.width = this.properties.padding.left + &quot;px&quot;;
+	t.style.textAlign = &quot;right&quot;;
+	t.style.paddingRight = &quot;4px&quot;;
+	t.style.fontFamily = &quot;sans-serif&quot;;
+	t.style.fontSize = size + &quot;px&quot;;
+	t.innerHTML = dojo.math.round(parseFloat(this.properties.axes.y.range.max), 2);
+	this.vectorNode.appendChild(t);
+	t = document.createElement(&quot;div&quot;);
+	t.style.position = &quot;absolute&quot;;
+	t.style.top = (this.properties.height - this.properties.padding.bottom - size) + &quot;px&quot;;
+	t.style.left = &quot;0px&quot;;
+	t.style.width = this.properties.padding.left + &quot;px&quot;;
+	t.style.textAlign = &quot;right&quot;;
+	t.style.paddingRight = &quot;4px&quot;;
+	t.style.fontFamily = &quot;sans-serif&quot;;
+	t.style.fontSize = size + &quot;px&quot;;
+	t.innerHTML = dojo.math.round(parseFloat(this.properties.axes.y.range.min), 2);
+	this.vectorNode.appendChild(t);
+}, init:function () {
+	if (!this.properties.width || !this.properties.height) {
+		var box = dojo.html.getContentBox(this.domNode);
+		if (!this.properties.width) {
+			this.properties.width = (box.width &lt; 32) ? this.properties.defaultWidth : box.width;
+		}
+		if (!this.properties.height) {
+			this.properties.height = (box.height &lt; 32) ? this.properties.defaultHeight : box.height;
+		}
+	}
+	this.drawVectorNode();
+	this.drawPlotArea();
+	this.drawDataGroup();
+	this.drawAxes();
+	this.assignColors();
+	this._isInitialized = true;
+}, destroy:function () {
+	while (this.domNode.childNodes.length &gt; 0) {
+		this.domNode.removeChild(this.domNode.childNodes[0]);
+	}
+	this.vectorNode = this.plotArea = this.dataGroup = this.axisGroup = null;
+}, render:function () {
+	if (this.dataGroup) {
+		while (this.dataGroup.childNodes.length &gt; 0) {
+			this.dataGroup.removeChild(this.dataGroup.childNodes[0]);
+		}
+	} else {
+		this.init();
+	}
+	for (var i = 0; i &lt; this.series.length; i++) {
+		dojo.widget.vml.Chart.Plotter.plot(this.series[i], this);
+	}
+}, postCreate:function () {
+	var table = this.domNode.getElementsByTagName(&quot;table&quot;)[0];
+	if (table) {
+		var ranges = this.parseProperties(table);
+		var bRangeX = false;
+		var bRangeY = false;
+		var axisValues = this.parseData(table);
+		if (!bRangeX) {
+			this.properties.axes.x.range = {min:axisValues.x.min, max:axisValues.x.max};
+		}
+		if (!bRangeY) {
+			this.properties.axes.y.range = {min:axisValues.y.min, max:axisValues.y.max};
+		}
+		this.setAxesPlot(table);
+		this.domNode.removeChild(table);
+	}
+	if (this.series.length &gt; 0) {
+		this.render();
+	}
+}});
+dojo.widget.vml.Chart.Plotter = new function () {
+	var self = this;
+	var plotters = {};
+	var types = dojo.widget.Chart.PlotTypes;
+	this.getX = function (value, chart) {
+		var v = parseFloat(value);
+		var min = chart.properties.axes.x.range.min;
+		var max = chart.properties.axes.x.range.max;
+		var ofst = 0 - min;
+		min += ofst;
+		max += ofst;
+		v += ofst;
+		var xmin = 0;
+		var xmax = chart.properties.width - chart.properties.padding.left - chart.properties.padding.right;
+		var x = (v * ((xmax - xmin) / max)) + xmin;
+		return x;
+	};
+	this.getY = function (value, chart) {
+		var v = parseFloat(value);
+		var max = chart.properties.axes.y.range.max;
+		var min = chart.properties.axes.y.range.min;
+		var ofst = 0;
+		if (min &lt; 0) {
+			ofst += Math.abs(min);
+		}
+		min += ofst;
+		max += ofst;
+		v += ofst;
+		var ymin = chart.properties.height - chart.properties.padding.top - chart.properties.padding.bottom;
+		var ymax = 0;
+		var y = (((ymin - ymax) / (max - min)) * (max - v)) + ymax;
+		return y;
+	};
+	this.addPlotter = function (name, func) {
+		plotters[name] = func;
+	};
+	this.plot = function (series, chart) {
+		if (series.values.length == 0) {
+			return;
+		}
+		if (series.plotType &amp;&amp; plotters[series.plotType]) {
+			return plotters[series.plotType](series, chart);
+		} else {
+			if (chart.plotType &amp;&amp; plotters[chart.plotType]) {
+				return plotters[chart.plotType](series, chart);
+			}
+		}
+	};
+	plotters[&quot;bar&quot;] = function (series, chart) {
+		var space = 1;
+		var lastW = 0;
+		var ys = [];
+		var yAxis = self.getY(chart.properties.axes.x.plotAt, chart);
+		var yA = yAxis;
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = self.getX(series.values[i].x, chart);
+			var w;
+			if (i == series.values.length - 1) {
+				w = lastW;
+			} else {
+				w = self.getX(series.values[i + 1].x, chart) - x - space;
+				lastW = w;
+			}
+			x -= (w / 2);
+			var y = self.getY(series.values[i].value, chart);
+			var h = Math.abs(yA - y);
+			if (parseFloat(series.values[i].value) &lt; chart.properties.axes.x.plotAt) {
+				y = yA;
+			}
+			var bar = document.createElement(&quot;v:rect&quot;);
+			bar.style.position = &quot;absolute&quot;;
+			bar.style.top = y + &quot;px&quot;;
+			bar.style.left = x + &quot;px&quot;;
+			bar.style.width = w + &quot;px&quot;;
+			bar.style.height = h + &quot;px&quot;;
+			bar.setAttribute(&quot;fillColor&quot;, series.color);
+			bar.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+			bar.style.antialias = &quot;false&quot;;
+			bar.setAttribute(&quot;title&quot;, series.label + &quot; (&quot; + i + &quot;): &quot; + series.values[i].value);
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.9&quot;);
+			bar.appendChild(fill);
+			chart.dataGroup.appendChild(bar);
+		}
+	};
+	plotters[&quot;line&quot;] = function (series, chart) {
+		var tension = 1.5;
+		var line = document.createElement(&quot;v:shape&quot;);
+		line.setAttribute(&quot;strokeweight&quot;, &quot;2px&quot;);
+		line.setAttribute(&quot;strokecolor&quot;, series.color);
+		line.setAttribute(&quot;fillcolor&quot;, &quot;none&quot;);
+		line.setAttribute(&quot;filled&quot;, &quot;false&quot;);
+		line.setAttribute(&quot;title&quot;, series.label);
+		line.setAttribute(&quot;coordsize&quot;, chart.properties.width + &quot;,&quot; + chart.properties.height);
+		line.style.position = &quot;absolute&quot;;
+		line.style.top = &quot;0px&quot;;
+		line.style.left = &quot;0px&quot;;
+		line.style.width = chart.properties.width + &quot;px&quot;;
+		line.style.height = chart.properties.height + &quot;px&quot;;
+		var stroke = document.createElement(&quot;v:stroke&quot;);
+		stroke.setAttribute(&quot;opacity&quot;, &quot;0.85&quot;);
+		line.appendChild(stroke);
+		var path = [];
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = Math.round(self.getX(series.values[i].x, chart));
+			var y = Math.round(self.getY(series.values[i].value, chart));
+			if (i == 0) {
+				path.push(&quot;m&quot;);
+				path.push(x + &quot;,&quot; + y);
+			} else {
+				var lastx = Math.round(self.getX(series.values[i - 1].x, chart));
+				var lasty = Math.round(self.getY(series.values[i - 1].value, chart));
+				var dx = x - lastx;
+				var dy = y - lasty;
+				path.push(&quot;c&quot;);
+				var cx = Math.round((x - (tension - 1) * (dx / tension)));
+				path.push(cx + &quot;,&quot; + lasty);
+				cx = Math.round((x - (dx / tension)));
+				path.push(cx + &quot;,&quot; + y);
+				path.push(x + &quot;,&quot; + y);
+			}
+		}
+		line.setAttribute(&quot;path&quot;, path.join(&quot; &quot;) + &quot; e&quot;);
+		chart.dataGroup.appendChild(line);
+	};
+	plotters[&quot;area&quot;] = function (series, chart) {
+		var tension = 1.5;
+		var line = document.createElement(&quot;v:shape&quot;);
+		line.setAttribute(&quot;strokeweight&quot;, &quot;1px&quot;);
+		line.setAttribute(&quot;strokecolor&quot;, series.color);
+		line.setAttribute(&quot;fillcolor&quot;, series.color);
+		line.setAttribute(&quot;title&quot;, series.label);
+		line.setAttribute(&quot;coordsize&quot;, chart.properties.width + &quot;,&quot; + chart.properties.height);
+		line.style.position = &quot;absolute&quot;;
+		line.style.top = &quot;0px&quot;;
+		line.style.left = &quot;0px&quot;;
+		line.style.width = chart.properties.width + &quot;px&quot;;
+		line.style.height = chart.properties.height + &quot;px&quot;;
+		var stroke = document.createElement(&quot;v:stroke&quot;);
+		stroke.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+		line.appendChild(stroke);
+		var fill = document.createElement(&quot;v:fill&quot;);
+		fill.setAttribute(&quot;opacity&quot;, &quot;0.4&quot;);
+		line.appendChild(fill);
+		var path = [];
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = Math.round(self.getX(series.values[i].x, chart));
+			var y = Math.round(self.getY(series.values[i].value, chart));
+			if (i == 0) {
+				path.push(&quot;m&quot;);
+				path.push(x + &quot;,&quot; + y);
+			} else {
+				var lastx = Math.round(self.getX(series.values[i - 1].x, chart));
+				var lasty = Math.round(self.getY(series.values[i - 1].value, chart));
+				var dx = x - lastx;
+				var dy = y - lasty;
+				path.push(&quot;c&quot;);
+				var cx = Math.round((x - (tension - 1) * (dx / tension)));
+				path.push(cx + &quot;,&quot; + lasty);
+				cx = Math.round((x - (dx / tension)));
+				path.push(cx + &quot;,&quot; + y);
+				path.push(x + &quot;,&quot; + y);
+			}
+		}
+		path.push(&quot;l&quot;);
+		path.push(x + &quot;,&quot; + self.getY(0, chart));
+		path.push(&quot;l&quot;);
+		path.push(self.getX(0, chart) + &quot;,&quot; + self.getY(0, chart));
+		line.setAttribute(&quot;path&quot;, path.join(&quot; &quot;) + &quot; x e&quot;);
+		chart.dataGroup.appendChild(line);
+	};
+	plotters[&quot;scatter&quot;] = function (series, chart) {
+		var r = 6;
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var x = self.getX(series.values[i].x, chart);
+			var y = self.getY(series.values[i].value, chart);
+			var mod = r / 2;
+			var point = document.createElement(&quot;v:rect&quot;);
+			point.setAttribute(&quot;fillcolor&quot;, series.color);
+			point.setAttribute(&quot;strokecolor&quot;, series.color);
+			point.setAttribute(&quot;title&quot;, series.label + &quot;: &quot; + series.values[i].value);
+			point.style.position = &quot;absolute&quot;;
+			point.style.rotation = &quot;45&quot;;
+			point.style.top = (y - mod) + &quot;px&quot;;
+			point.style.left = (x - mod) + &quot;px&quot;;
+			point.style.width = r + &quot;px&quot;;
+			point.style.height = r + &quot;px&quot;;
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.6&quot;);
+			point.appendChild(fill);
+			chart.dataGroup.appendChild(point);
+		}
+	};
+	plotters[&quot;bubble&quot;] = function (series, chart) {
+		var minR = 1;
+		var min = chart.properties.axes.x.range.min;
+		var max = chart.properties.axes.x.range.max;
+		var ofst = 0 - min;
+		min += ofst;
+		max += ofst;
+		var xmin = chart.properties.padding.left;
+		var xmax = chart.properties.width - chart.properties.padding.right;
+		var factor = (max - min) / (xmax - xmin) * 25;
+		for (var i = 0; i &lt; series.values.length; i++) {
+			var size = series.values[i].size;
+			if (isNaN(parseFloat(size))) {
+				size = minR;
+			}
+			var radius = (parseFloat(size) * factor) / 2;
+			var diameter = radius * 2;
+			var cx = self.getX(series.values[i].x, chart);
+			var cy = self.getY(series.values[i].value, chart);
+			var top = cy - radius;
+			var left = cx - radius;
+			var point = document.createElement(&quot;v:oval&quot;);
+			point.setAttribute(&quot;fillcolor&quot;, series.color);
+			point.setAttribute(&quot;title&quot;, series.label + &quot;: &quot; + series.values[i].value + &quot; (&quot; + size + &quot;)&quot;);
+			point.setAttribute(&quot;stroked&quot;, &quot;false&quot;);
+			point.style.position = &quot;absolute&quot;;
+			point.style.top = top + &quot;px&quot;;
+			point.style.left = left + &quot;px&quot;;
+			point.style.width = diameter + &quot;px&quot;;
+			point.style.height = diameter + &quot;px&quot;;
+			var fill = document.createElement(&quot;v:fill&quot;);
+			fill.setAttribute(&quot;opacity&quot;, &quot;0.8&quot;);
+			point.appendChild(fill);
+			chart.dataGroup.appendChild(point);
+		}
+	};
+}();
+

Added: tags/parley-0.55/root/static/magic/src/xml/Parse.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/xml/Parse.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/xml/Parse.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,165 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.xml.Parse&quot;);
+dojo.require(&quot;dojo.dom&quot;);
+dojo.xml.Parse = function () {
+	var isIE = ((dojo.render.html.capable) &amp;&amp; (dojo.render.html.ie));
+	function getTagName(node) {
+		try {
+			return node.tagName.toLowerCase();
+		}
+		catch (e) {
+			return &quot;&quot;;
+		}
+	}
+	function getDojoTagName(node) {
+		var tagName = getTagName(node);
+		if (!tagName) {
+			return &quot;&quot;;
+		}
+		if ((dojo.widget) &amp;&amp; (dojo.widget.tags[tagName])) {
+			return tagName;
+		}
+		var p = tagName.indexOf(&quot;:&quot;);
+		if (p &gt;= 0) {
+			return tagName;
+		}
+		if (tagName.substr(0, 5) == &quot;dojo:&quot;) {
+			return tagName;
+		}
+		if (dojo.render.html.capable &amp;&amp; dojo.render.html.ie &amp;&amp; node.scopeName != &quot;HTML&quot;) {
+			return node.scopeName.toLowerCase() + &quot;:&quot; + tagName;
+		}
+		if (tagName.substr(0, 4) == &quot;dojo&quot;) {
+			return &quot;dojo:&quot; + tagName.substring(4);
+		}
+		var djt = node.getAttribute(&quot;dojoType&quot;) || node.getAttribute(&quot;dojotype&quot;);
+		if (djt) {
+			if (djt.indexOf(&quot;:&quot;) &lt; 0) {
+				djt = &quot;dojo:&quot; + djt;
+			}
+			return djt.toLowerCase();
+		}
+		djt = node.getAttributeNS &amp;&amp; node.getAttributeNS(dojo.dom.dojoml, &quot;type&quot;);
+		if (djt) {
+			return &quot;dojo:&quot; + djt.toLowerCase();
+		}
+		try {
+			djt = node.getAttribute(&quot;dojo:type&quot;);
+		}
+		catch (e) {
+		}
+		if (djt) {
+			return &quot;dojo:&quot; + djt.toLowerCase();
+		}
+		if ((dj_global[&quot;djConfig&quot;]) &amp;&amp; (!djConfig[&quot;ignoreClassNames&quot;])) {
+			var classes = node.className || node.getAttribute(&quot;class&quot;);
+			if ((classes) &amp;&amp; (classes.indexOf) &amp;&amp; (classes.indexOf(&quot;dojo-&quot;) != -1)) {
+				var aclasses = classes.split(&quot; &quot;);
+				for (var x = 0, c = aclasses.length; x &lt; c; x++) {
+					if (aclasses[x].slice(0, 5) == &quot;dojo-&quot;) {
+						return &quot;dojo:&quot; + aclasses[x].substr(5).toLowerCase();
+					}
+				}
+			}
+		}
+		return &quot;&quot;;
+	}
+	this.parseElement = function (node, hasParentNodeSet, optimizeForDojoML, thisIdx) {
+		var tagName = getTagName(node);
+		if (isIE &amp;&amp; tagName.indexOf(&quot;/&quot;) == 0) {
+			return null;
+		}
+		try {
+			var attr = node.getAttribute(&quot;parseWidgets&quot;);
+			if (attr &amp;&amp; attr.toLowerCase() == &quot;false&quot;) {
+				return {};
+			}
+		}
+		catch (e) {
+		}
+		var process = true;
+		if (optimizeForDojoML) {
+			var dojoTagName = getDojoTagName(node);
+			tagName = dojoTagName || tagName;
+			process = Boolean(dojoTagName);
+		}
+		var parsedNodeSet = {};
+		parsedNodeSet[tagName] = [];
+		var pos = tagName.indexOf(&quot;:&quot;);
+		if (pos &gt; 0) {
+			var ns = tagName.substring(0, pos);
+			parsedNodeSet[&quot;ns&quot;] = ns;
+			if ((dojo.ns) &amp;&amp; (!dojo.ns.allow(ns))) {
+				process = false;
+			}
+		}
+		if (process) {
+			var attributeSet = this.parseAttributes(node);
+			for (var attr in attributeSet) {
+				if ((!parsedNodeSet[tagName][attr]) || (typeof parsedNodeSet[tagName][attr] != &quot;array&quot;)) {
+					parsedNodeSet[tagName][attr] = [];
+				}
+				parsedNodeSet[tagName][attr].push(attributeSet[attr]);
+			}
+			parsedNodeSet[tagName].nodeRef = node;
+			parsedNodeSet.tagName = tagName;
+			parsedNodeSet.index = thisIdx || 0;
+		}
+		var count = 0;
+		for (var i = 0; i &lt; node.childNodes.length; i++) {
+			var tcn = node.childNodes.item(i);
+			switch (tcn.nodeType) {
+			  case dojo.dom.ELEMENT_NODE:
+				var ctn = getDojoTagName(tcn) || getTagName(tcn);
+				if (!parsedNodeSet[ctn]) {
+					parsedNodeSet[ctn] = [];
+				}
+				parsedNodeSet[ctn].push(this.parseElement(tcn, true, optimizeForDojoML, count));
+				if ((tcn.childNodes.length == 1) &amp;&amp; (tcn.childNodes.item(0).nodeType == dojo.dom.TEXT_NODE)) {
+					parsedNodeSet[ctn][parsedNodeSet[ctn].length - 1].value = tcn.childNodes.item(0).nodeValue;
+				}
+				count++;
+				break;
+			  case dojo.dom.TEXT_NODE:
+				if (node.childNodes.length == 1) {
+					parsedNodeSet[tagName].push({value:node.childNodes.item(0).nodeValue});
+				}
+				break;
+			  default:
+				break;
+			}
+		}
+		return parsedNodeSet;
+	};
+	this.parseAttributes = function (node) {
+		var parsedAttributeSet = {};
+		var atts = node.attributes;
+		var attnode, i = 0;
+		while ((attnode = atts[i++])) {
+			if (isIE) {
+				if (!attnode) {
+					continue;
+				}
+				if ((typeof attnode == &quot;object&quot;) &amp;&amp; (typeof attnode.nodeValue == &quot;undefined&quot;) || (attnode.nodeValue == null) || (attnode.nodeValue == &quot;&quot;)) {
+					continue;
+				}
+			}
+			var nn = attnode.nodeName.split(&quot;:&quot;);
+			nn = (nn.length == 2) ? nn[1] : attnode.nodeName;
+			parsedAttributeSet[nn] = {value:attnode.nodeValue};
+		}
+		return parsedAttributeSet;
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/xml/XslTransform.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/xml/XslTransform.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/xml/XslTransform.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,159 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.provide(&quot;dojo.xml.XslTransform&quot;);
+dojo.xml.XslTransform = function (xsltUri) {
+	dojo.debug(&quot;XslTransform is supported by Internet Explorer and Mozilla, with limited support in Opera 9 (no document function support).&quot;);
+	var IS_IE = dojo.render.html.ie;
+	var ACTIVEX_DOMS = [&quot;Msxml2.DOMDocument.5.0&quot;, &quot;Msxml2.DOMDocument.4.0&quot;, &quot;Msxml2.DOMDocument.3.0&quot;, &quot;MSXML2.DOMDocument&quot;, &quot;MSXML.DOMDocument&quot;, &quot;Microsoft.XMLDOM&quot;];
+	var ACTIVEX_FT_DOMS = [&quot;Msxml2.FreeThreadedDOMDocument.5.0&quot;, &quot;MSXML2.FreeThreadedDOMDocument.4.0&quot;, &quot;MSXML2.FreeThreadedDOMDocument.3.0&quot;];
+	var ACTIVEX_TEMPLATES = [&quot;Msxml2.XSLTemplate.5.0&quot;, &quot;Msxml2.XSLTemplate.4.0&quot;, &quot;MSXML2.XSLTemplate.3.0&quot;];
+	function getActiveXImpl(activeXArray) {
+		for (var i = 0; i &lt; activeXArray.length; i++) {
+			try {
+				var testObj = new ActiveXObject(activeXArray[i]);
+				if (testObj) {
+					return activeXArray[i];
+				}
+			}
+			catch (e) {
+			}
+		}
+		dojo.raise(&quot;Could not find an ActiveX implementation in:\n\n &quot; + activeXArray);
+	}
+	if (xsltUri == null || xsltUri == undefined) {
+		dojo.raise(&quot;You must pass the URI String for the XSL file to be used!&quot;);
+		return false;
+	}
+	var xsltDocument = null;
+	var xsltProcessor = null;
+	if (IS_IE) {
+		xsltDocument = new ActiveXObject(getActiveXImpl(ACTIVEX_FT_DOMS));
+		xsltDocument.async = false;
+	} else {
+		xsltProcessor = new XSLTProcessor();
+		xsltDocument = document.implementation.createDocument(&quot;&quot;, &quot;&quot;, null);
+		xsltDocument.addEventListener(&quot;load&quot;, onXslLoad, false);
+	}
+	xsltDocument.load(xsltUri);
+	if (IS_IE) {
+		var xslt = new ActiveXObject(getActiveXImpl(ACTIVEX_TEMPLATES));
+		xslt.stylesheet = xsltDocument;
+		xsltProcessor = xslt.createProcessor();
+	}
+	function onXslLoad() {
+		xsltProcessor.importStylesheet(xsltDocument);
+	}
+	function getResultDom(xmlDoc, params) {
+		if (IS_IE) {
+			addIeParams(params);
+			var result = getIeResultDom(xmlDoc);
+			removeIeParams(params);
+			return result;
+		} else {
+			return getMozillaResultDom(xmlDoc, params);
+		}
+	}
+	function addIeParams(params) {
+		if (!params) {
+			return;
+		}
+		for (var i = 0; i &lt; params.length; i++) {
+			xsltProcessor.addParameter(params[i][0], params[i][1]);
+		}
+	}
+	function removeIeParams(params) {
+		if (!params) {
+			return;
+		}
+		for (var i = 0; i &lt; params.length; i++) {
+			xsltProcessor.addParameter(params[i][0], &quot;&quot;);
+		}
+	}
+	function getIeResultDom(xmlDoc) {
+		xsltProcessor.input = xmlDoc;
+		var outDoc = new ActiveXObject(getActiveXImpl(ACTIVEX_DOMS));
+		outDoc.async = false;
+		outDoc.validateOnParse = false;
+		xsltProcessor.output = outDoc;
+		xsltProcessor.transform();
+		if (outDoc.parseError.errorCode != 0) {
+			var err = outDoc.parseError;
+			dojo.raise(&quot;err.errorCode: &quot; + err.errorCode + &quot;\n\nerr.reason: &quot; + err.reason + &quot;\n\nerr.url: &quot; + err.url + &quot;\n\nerr.srcText: &quot; + err.srcText);
+		}
+		return outDoc;
+	}
+	function getIeResultStr(xmlDoc, params) {
+		xsltProcessor.input = xmlDoc;
+		xsltProcessor.transform();
+		return xsltProcessor.output;
+	}
+	function addMozillaParams(params) {
+		if (!params) {
+			return;
+		}
+		for (var i = 0; i &lt; params.length; i++) {
+			xsltProcessor.setParameter(null, params[i][0], params[i][1]);
+		}
+	}
+	function getMozillaResultDom(xmlDoc, params) {
+		addMozillaParams(params);
+		var resultDoc = xsltProcessor.transformToDocument(xmlDoc);
+		xsltProcessor.clearParameters();
+		return resultDoc;
+	}
+	function getMozillaResultStr(xmlDoc, params, parentDoc) {
+		addMozillaParams(params);
+		var resultDoc = xsltProcessor.transformToFragment(xmlDoc, parentDoc);
+		var serializer = new XMLSerializer();
+		xsltProcessor.clearParameters();
+		return serializer.serializeToString(resultDoc);
+	}
+	this.getResultString = function (xmlDoc, params, parentDoc) {
+		var content = null;
+		if (IS_IE) {
+			addIeParams(params);
+			content = getIeResultStr(xmlDoc, params);
+			removeIeParams(params);
+		} else {
+			content = getMozillaResultStr(xmlDoc, params, parentDoc);
+		}
+		return content;
+	};
+	this.transformToContentPane = function (xmlDoc, params, contentPane, parentDoc) {
+		var content = this.getResultString(xmlDoc, params, parentDoc);
+		contentPane.setContent(content);
+	};
+	this.transformToRegion = function (xmlDoc, params, region, parentDoc) {
+		try {
+			var content = this.getResultString(xmlDoc, params, parentDoc);
+			region.innerHTML = content;
+		}
+		catch (e) {
+			dojo.raise(e.message + &quot;\n\n xsltUri: &quot; + xsltUri);
+		}
+	};
+	this.transformToDocument = function (xmlDoc, params) {
+		return getResultDom(xmlDoc, params);
+	};
+	this.transformToWindow = function (xmlDoc, params, windowDoc, parentDoc) {
+		try {
+			windowDoc.open();
+			windowDoc.write(this.getResultString(xmlDoc, params, parentDoc));
+			windowDoc.close();
+		}
+		catch (e) {
+			dojo.raise(e.message + &quot;\n\n xsltUri: &quot; + xsltUri);
+		}
+	};
+};
+

Added: tags/parley-0.55/root/static/magic/src/xml/__package__.js
===================================================================
--- tags/parley-0.55/root/static/magic/src/xml/__package__.js	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/root/static/magic/src/xml/__package__.js	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,16 @@
+/*
+	Copyright (c) 2004-2006, The Dojo Foundation
+	All Rights Reserved.
+
+	Licensed under the Academic Free License version 2.1 or above OR the
+	modified BSD license. For more information on Dojo licensing, see:
+
+		<A HREF="http://dojotoolkit.org/community/licensing.shtml">http://dojotoolkit.org/community/licensing.shtml</A>
+*/
+
+
+
+dojo.require(&quot;dojo.xml.Parse&quot;);
+dojo.kwCompoundRequire({common:[&quot;dojo.dom&quot;], browser:[&quot;dojo.html.*&quot;], dashboard:[&quot;dojo.html.*&quot;]});
+dojo.provide(&quot;dojo.xml.*&quot;);
+

Added: tags/parley-0.55/root/static/script/prototype.js
===================================================================

Added: tags/parley-0.55/script/parley_cgi.pl
===================================================================
--- tags/parley-0.55/script/parley_cgi.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/parley_cgi.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,37 @@
+#!/usr/bin/perl -w
+
+BEGIN { $ENV{CATALYST_ENGINE} ||= 'CGI' }
+
+use strict;
+use warnings;
+use FindBin;
+use lib &quot;$FindBin::Bin/../lib&quot;;
+use Parley;
+
+Parley-&gt;run;
+
+1;
+
+=head1 NAME
+
+parley_cgi.pl - Catalyst CGI
+
+=head1 SYNOPSIS
+
+See L&lt;Catalyst::Manual&gt;
+
+=head1 DESCRIPTION
+
+Run a Catalyst application as a cgi script.
+
+=head1 AUTHOR
+
+Sebastian Riedel, C&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">sri at oook.de</A>&gt;
+
+=head1 COPYRIGHT
+
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut


Property changes on: tags/parley-0.55/script/parley_cgi.pl
___________________________________________________________________
Name: svn:executable
   + *

Added: tags/parley-0.55/script/parley_create.pl
===================================================================
--- tags/parley-0.55/script/parley_create.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/parley_create.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,74 @@
+#!/usr/bin/perl -w
+
+use strict;
+use warnings;
+use Getopt::Long;
+use Pod::Usage;
+use Catalyst::Helper;
+
+my $force = 0;
+my $mech  = 0;
+my $help  = 0;
+
+GetOptions(
+    'nonew|force'    =&gt; \$force,
+    'mech|mechanize' =&gt; \$mech,
+    'help|?'         =&gt; \$help
+ );
+
+pod2usage(1) if ( $help || !$ARGV[0] );
+
+my $helper = Catalyst::Helper-&gt;new( { '.newfiles' =&gt; !$force, mech =&gt; $mech } );
+
+pod2usage(1) unless $helper-&gt;mk_component( 'Parley', @ARGV );
+
+1;
+
+=head1 NAME
+
+parley_create.pl - Create a new Catalyst Component
+
+=head1 SYNOPSIS
+
+parley_create.pl [options] model|view|controller name [helper] [options]
+
+ Options:
+   -force        don't create a .new file where a file to be created exists
+   -mechanize    use Test::WWW::Mechanize::Catalyst for tests if available
+   -help         display this help and exits
+
+ Examples:
+   parley_create.pl controller My::Controller
+   parley_create.pl -mechanize controller My::Controller
+   parley_create.pl view My::View
+   parley_create.pl view MyView TT
+   parley_create.pl view TT TT
+   parley_create.pl model My::Model
+   parley_create.pl model SomeDB DBIC::Schema MyApp::Schema create=dynamic\
+   dbi:SQLite:/tmp/my.db
+   parley_create.pl model AnotherDB DBIC::Schema MyApp::Schema create=static\
+   dbi:Pg:dbname=foo root 4321
+
+ See also:
+   perldoc Catalyst::Manual
+   perldoc Catalyst::Manual::Intro
+
+=head1 DESCRIPTION
+
+Create a new Catalyst Component.
+
+Existing component files are not overwritten.  If any of the component files
+to be created already exist the file will be written with a '.new' suffix.
+This behavior can be suppressed with the C&lt;-force&gt; option.
+
+=head1 AUTHOR
+
+Sebastian Riedel, C&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">sri at oook.de</A>&gt;
+Maintained by the Catalyst Core Team.
+
+=head1 COPYRIGHT
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut


Property changes on: tags/parley-0.55/script/parley_create.pl
___________________________________________________________________
Name: svn:executable
   + *

Added: tags/parley-0.55/script/parley_email_engine.pl
===================================================================
--- tags/parley-0.55/script/parley_email_engine.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/parley_email_engine.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,262 @@
+#!/usr/bin/env perl
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+
+BEGIN {
+    # use the lib directory relative to ourself
+    use FindBin;
+    use lib &quot;$FindBin::Bin/../lib&quot;;
+
+    # for building email(s)
+    use MIME::Lite;
+
+    # since we're going to be a daemon ...
+    use Proc::Daemon;
+    use Proc::PID::File;
+
+    # somewhere to send stuff
+    use Sys::Syslog qw( :DEFAULT :standard :macros );
+
+    # our in to the database ...
+    use Parley::Schema;
+}
+
+use version; our $VERSION = qv('0.0.1');
+
+# whether we should be exiting
+our $exit = 0;
+
+# prepare syslog for use
+openlog(
+    q{parley_email_engine},
+    q{ndelay,pid},
+    LOG_USER
+)
+    or die $!;
+syslog( LOG_INFO, q{script started} )
+    or die $!;
+
+# have we been asked to stop running?
+if (@ARGV &amp;&amp; $ARGV[0] eq q{stop}) {
+    # we need to quit!
+
+    # get the pid file ...
+    my $pid = Proc::PID::File-&gt;running(
+        debug   =&gt; 0,
+        name    =&gt; q{parley_email_engine},
+        dir     =&gt; q{/tmp},
+    );
+    if (not $pid) {
+        syslog( LOG_INFO, qq{daemon not running!} );
+        exit;
+    }
+
+    # send a kill signal
+    kill( 2, $pid );
+    syslog( LOG_INFO, qq{STOP signal sent!\n} );
+    exit;
+}
+
+# connect to the schema
+my $schema = schema_connect();
+
+# daemon
+my $pid;
+if ($pid = Proc::Daemon::Fork) { # parent
+    # nothing here
+}
+else { # child
+    Proc::Daemon::Init;
+
+    openlog(
+        q{parley_email_engine},
+        q{ndelay,pid},
+        LOG_USER
+    )
+        or die $!;
+    syslog( LOG_INFO, q{child process created} );
+
+    # how to deal with given signals
+    $SIG{TERM}  = sub { $exit = 1 };
+    $SIG{INT}   = sub { $exit = 1 };
+    $SIG{CHLD}  = q{IGNORE};
+    $SIG{HUP}   = q{IGNORE};
+
+    my $status_ok;
+    $status_ok = open(STDOUT, '&gt;&gt;', '/tmp/parley_email_engine.log');
+    if (not $status_ok) {
+        syslog( LOG_ERR, &quot;failed to reopen STDOUT: $!&quot; );
+        exit;
+    }
+    $status_ok = open(STDERR, '&gt;&amp;STDOUT');
+    if (not $status_ok) {
+        syslog( LOG_ERR, &quot;failed to re-open STDERR to STDOUT: $!&quot; );
+        exit;
+    }
+
+    # make sure we aren't already running
+    if (Proc::PID::File-&gt;running(
+            debug   =&gt; 0,
+            name    =&gt; q{parley_email_engine},
+            dir     =&gt; q{/tmp},
+        )
+    ) {
+        syslog( LOG_INFO, qq{Already Running!} );
+        exit;
+    }
+
+    while (1) {
+        child_process($schema);
+        sleep(1);
+    }
+}
+
+sub child_process {
+    my $schema = shift;
+
+    # get the oldest unsent email in the queue
+    my $rs = $schema-&gt;resultset('EmailQueue')-&gt;search(
+        {
+            attempted_delivery =&gt; 0,
+        },
+        {
+            # oldest first
+            order_by    =&gt; 'queued ASC',
+            # one result
+            rows        =&gt; 1,
+        }
+    );
+
+    # if we have anything waiting to be sent ...
+    if ($rs-&gt;count()) {
+        my $queue_item = $rs-&gt;first();
+        send_email( $queue_item );
+    }
+
+    # have we been asked to stop?
+    if ($exit) {
+        syslog(
+            LOG_INFO,
+            q{STOP signal recieved}
+        );
+        exit;
+    }
+}
+
+sub schema_connect {
+    my $schema;
+    eval {
+        $schema = Parley::Schema-&gt;connect(
+            q{dbi:Pg:dbname=parley},
+            q{parley},
+            undef,
+            { RaiseError =&gt; 0, PrintError =&gt; 0 },
+        );
+    };
+    if ($@) {
+        syslog( LOG_INFO, $@ );
+        exit;
+    }
+    if (not defined $schema) {
+        syslog( LOG_INFO, $! );
+        exit;
+    }
+
+    return $schema;
+}
+
+sub send_email {
+    my $queue_item = shift;
+    my ($email);
+
+    # are we text/plain or multipart/alternative?
+    if (defined $queue_item-&gt;html_content()) {
+        $email = build_multipart_email( $queue_item );
+    }
+    else {
+        $email = build_text_email( $queue_item );
+    }
+
+    # print the email out for now, no need to send anything
+    $email-&gt;send();
+    # update the table to say we've attempted delivery
+    $queue_item-&gt;attempted_delivery(1);
+    $queue_item-&gt;update();
+
+    return;
+}
+
+sub _common_mail_options {
+    my $queue_item = shift;
+
+    my %options = (
+        From            =&gt; $queue_item-&gt;sender(),
+        To              =&gt; nice_to_header( $queue_item-&gt;recipient() ),
+        Subject         =&gt; $queue_item-&gt;subject(),
+        'X-Application' =&gt; qq{parley_email_engine ($VERSION)},
+    );
+
+    return \%options;
+}
+
+
+sub build_text_email {
+    my $queue_item = shift;
+    my ($msg);
+
+    # create a straight-forward text email
+    $msg = MIME::Lite-&gt;new(
+        %{ _common_mail_options($queue_item) },
+
+        Type        =&gt; 'TEXT',
+        Data        =&gt; $queue_item-&gt;text_content(),
+        Encoding    =&gt; 'quoted-printable',
+    )
+        or die $!;
+
+    return $msg;
+}
+
+sub build_multipart_email {
+    my $queue_item = shift;
+    my ($msg);
+
+    # create the multipart container
+    $msg = MIME::Lite-&gt;new(
+        %{ _common_mail_options($queue_item) },
+
+        Type    =&gt; 'multipart/alternative',
+    )
+        or die $!;
+
+    # add the text part
+    $msg-&gt;attach(
+        Type    =&gt; 'text/plain',
+        Data    =&gt; $queue_item-&gt;text_content(),
+    );
+    # add the html part
+    $msg-&gt;attach(
+        Type    =&gt; 'text/html',
+        Data    =&gt; $queue_item-&gt;html_content(),
+    );
+
+    return $msg;
+}
+
+
+
+sub nice_to_header {
+    my $recipient = shift;
+
+    my $string =
+          $recipient-&gt;first_name()
+        . q{ }
+        . $recipient-&gt;last_name()
+        . q{ &lt;}
+        . $recipient-&gt;email()
+        . q{&gt;}
+    ;
+
+    return $string;
+}


Property changes on: tags/parley-0.55/script/parley_email_engine.pl
___________________________________________________________________
Name: svn:executable
   + *

Added: tags/parley-0.55/script/parley_fastcgi.pl
===================================================================
--- tags/parley-0.55/script/parley_fastcgi.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/parley_fastcgi.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,80 @@
+#!/usr/bin/perl -w
+
+BEGIN { $ENV{CATALYST_ENGINE} ||= 'FastCGI' }
+
+use strict;
+use warnings;
+use Getopt::Long;
+use Pod::Usage;
+use FindBin;
+use lib &quot;$FindBin::Bin/../lib&quot;;
+use Parley;
+
+my $help = 0;
+my ( $listen, $nproc, $pidfile, $manager, $detach, $keep_stderr );
+ 
+GetOptions(
+    'help|?'      =&gt; \$help,
+    'listen|l=s'  =&gt; \$listen,
+    'nproc|n=i'   =&gt; \$nproc,
+    'pidfile|p=s' =&gt; \$pidfile,
+    'manager|M=s' =&gt; \$manager,
+    'daemon|d'    =&gt; \$detach,
+    'keeperr|e'   =&gt; \$keep_stderr,
+);
+
+pod2usage(1) if $help;
+
+Parley-&gt;run( 
+    $listen, 
+    {   nproc   =&gt; $nproc,
+        pidfile =&gt; $pidfile, 
+        manager =&gt; $manager,
+        detach  =&gt; $detach,
+	keep_stderr =&gt; $keep_stderr,
+    }
+);
+
+1;
+
+=head1 NAME
+
+parley_fastcgi.pl - Catalyst FastCGI
+
+=head1 SYNOPSIS
+
+parley_fastcgi.pl [options]
+ 
+ Options:
+   -? -help      display this help and exits
+   -l -listen    Socket path to listen on
+                 (defaults to standard input)
+                 can be HOST:PORT, :PORT or a
+                 filesystem path
+   -n -nproc     specify number of processes to keep
+                 to serve requests (defaults to 1,
+                 requires -listen)
+   -p -pidfile   specify filename for pid file
+                 (requires -listen)
+   -d -daemon    daemonize (requires -listen)
+   -M -manager   specify alternate process manager
+                 (FCGI::ProcManager sub-class)
+                 or empty string to disable
+   -e -keeperr   send error messages to STDOUT, not
+                 to the webserver
+
+=head1 DESCRIPTION
+
+Run a Catalyst application as fastcgi.
+
+=head1 AUTHOR
+
+Sebastian Riedel, C&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">sri at oook.de</A>&gt;
+Maintained by the Catalyst Core Team.
+
+=head1 COPYRIGHT
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut


Property changes on: tags/parley-0.55/script/parley_fastcgi.pl
___________________________________________________________________
Name: svn:executable
   + *

Added: tags/parley-0.55/script/parley_server.pl
===================================================================
--- tags/parley-0.55/script/parley_server.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/parley_server.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,111 @@
+#!/usr/bin/perl -w
+
+BEGIN { 
+    $ENV{CATALYST_ENGINE} ||= 'HTTP';
+    $ENV{CATALYST_SCRIPT_GEN} = 30;
+    require Catalyst::Engine::HTTP;
+}  
+
+use strict;
+use warnings;
+use Getopt::Long;
+use Pod::Usage;
+use FindBin;
+use lib &quot;$FindBin::Bin/../lib&quot;;
+
+my $debug             = 0;
+my $fork              = 0;
+my $help              = 0;
+my $host              = undef;
+my $port              = 3000;
+my $keepalive         = 0;
+my $restart           = 0;
+my $restart_delay     = 1;
+my $restart_regex     = '\.yml$|\.yaml$|\.pm$';
+my $restart_directory = undef;
+
+my @argv = @ARGV;
+
+GetOptions(
+    'debug|d'             =&gt; \$debug,
+    'fork'                =&gt; \$fork,
+    'help|?'              =&gt; \$help,
+    'host=s'              =&gt; \$host,
+    'port=s'              =&gt; \$port,
+    'keepalive|k'         =&gt; \$keepalive,
+    'restart|r'           =&gt; \$restart,
+    'restartdelay|rd=s'   =&gt; \$restart_delay,
+    'restartregex|rr=s'   =&gt; \$restart_regex,
+    'restartdirectory=s'  =&gt; \$restart_directory,
+);
+
+pod2usage(1) if $help;
+
+if ( $restart ) {
+    $ENV{CATALYST_ENGINE} = 'HTTP::Restarter';
+}
+if ( $debug ) {
+    $ENV{CATALYST_DEBUG} = 1;
+}
+
+# This is require instead of use so that the above environment
+# variables can be set at runtime.
+require Parley;
+
+Parley-&gt;run( $port, $host, {
+    argv              =&gt; \@argv,
+    'fork'            =&gt; $fork,
+    keepalive         =&gt; $keepalive,
+    restart           =&gt; $restart,
+    restart_delay     =&gt; $restart_delay,
+    restart_regex     =&gt; qr/$restart_regex/,
+    restart_directory =&gt; $restart_directory,
+} );
+
+1;
+
+=head1 NAME
+
+parley_server.pl - Catalyst Testserver
+
+=head1 SYNOPSIS
+
+parley_server.pl [options]
+
+ Options:
+   -d -debug          force debug mode
+   -f -fork           handle each request in a new process
+                      (defaults to false)
+   -? -help           display this help and exits
+      -host           host (defaults to all)
+   -p -port           port (defaults to 3000)
+   -k -keepalive      enable keep-alive connections
+   -r -restart        restart when files get modified
+                      (defaults to false)
+   -rd -restartdelay  delay between file checks
+   -rr -restartregex  regex match files that trigger
+                      a restart when modified
+                      (defaults to '\.yml$|\.yaml$|\.pm$')
+   -restartdirectory  the directory to search for
+                      modified files
+                      (defaults to '../')
+
+ See also:
+   perldoc Catalyst::Manual
+   perldoc Catalyst::Manual::Intro
+
+=head1 DESCRIPTION
+
+Run a Catalyst Testserver for this application.
+
+=head1 AUTHOR
+
+Sebastian Riedel, C&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">sri at oook.de</A>&gt;
+Maintained by the Catalyst Core Team.
+
+=head1 COPYRIGHT
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut


Property changes on: tags/parley-0.55/script/parley_server.pl
___________________________________________________________________
Name: svn:executable
   + *

Added: tags/parley-0.55/script/parley_test.pl
===================================================================
--- tags/parley-0.55/script/parley_test.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/parley_test.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,54 @@
+#!/usr/bin/perl -w
+
+use strict;
+use warnings;
+use Getopt::Long;
+use Pod::Usage;
+use FindBin;
+use lib &quot;$FindBin::Bin/../lib&quot;;
+use Catalyst::Test 'Parley';
+
+my $help = 0;
+
+GetOptions( 'help|?' =&gt; \$help );
+
+pod2usage(1) if ( $help || !$ARGV[0] );
+
+print request($ARGV[0])-&gt;content . &quot;\n&quot;;
+
+1;
+
+=head1 NAME
+
+parley_test.pl - Catalyst Test
+
+=head1 SYNOPSIS
+
+parley_test.pl [options] uri
+
+ Options:
+   -help    display this help and exits
+
+ Examples:
+   parley_test.pl <A HREF="http://localhost/some_action">http://localhost/some_action</A>
+   parley_test.pl /some_action
+
+ See also:
+   perldoc Catalyst::Manual
+   perldoc Catalyst::Manual::Intro
+
+=head1 DESCRIPTION
+
+Run a Catalyst action from the command line.
+
+=head1 AUTHOR
+
+Sebastian Riedel, C&lt;<A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">sri at oook.de</A>&gt;
+Maintained by the Catalyst Core Team.
+
+=head1 COPYRIGHT
+
+This library is free software, you can redistribute it and/or modify
+it under the same terms as Perl itself.
+
+=cut


Property changes on: tags/parley-0.55/script/parley_test.pl
___________________________________________________________________
Name: svn:executable
   + *

Added: tags/parley-0.55/script/time_string_sample.pl
===================================================================
--- tags/parley-0.55/script/time_string_sample.pl	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/script/time_string_sample.pl	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,27 @@
+#!/usr/bin/perl
+use strict;
+use warnings;
+use DateTime;
+
+use POSIX 'strftime';
+
+my @time_formats = (
+    q{%A %d %B %Y at %R},
+    q{%F %T},
+    q{%c},
+    q{%A at %R},
+    q{%a, %d %b; %R},
+
+    q{%R, %b %d},
+    q{%R, %b %d '%y},
+    q{%R, %b %d %Y},
+);
+
+foreach my $tf (@time_formats) {
+    my $dt = DateTime-&gt;now();
+    print $dt-&gt;strftime( $tf ), qq{\n};
+
+    printf(qq{INSERT INTO preference_time_string (time_string, sample) VALUES ('%s', '%s');\n}, $tf, strftime($tf, 0, 15, 18, 13, 6, 106));
+
+    print qq{\n};
+}

Added: tags/parley-0.55/t/01app.t
===================================================================
--- tags/parley-0.55/t/01app.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/01app.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,7 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 2;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+
+ok( request('/')-&gt;is_success, 'Request should succeed' );

Added: tags/parley-0.55/t/02pod.t
===================================================================
--- tags/parley-0.55/t/02pod.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/02pod.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,9 @@
+use strict;
+use warnings;
+use Test::More;
+
+eval &quot;use Test::Pod 1.14&quot;;
+plan skip_all =&gt; 'Test::Pod 1.14 required' if $@;
+plan skip_all =&gt; 'set TEST_POD to enable this test' unless $ENV{TEST_POD};
+
+all_pod_files_ok();

Added: tags/parley-0.55/t/03podcoverage.t
===================================================================
--- tags/parley-0.55/t/03podcoverage.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/03podcoverage.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,9 @@
+use strict;
+use warnings;
+use Test::More;
+
+eval &quot;use Test::Pod::Coverage 1.04&quot;;
+plan skip_all =&gt; 'Test::Pod::Coverage 1.04 required' if $@;
+plan skip_all =&gt; 'set TEST_POD to enable this test' unless $ENV{TEST_POD};
+
+all_pod_coverage_ok();

Added: tags/parley-0.55/t/04_forumcode.t
===================================================================
--- tags/parley-0.55/t/04_forumcode.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/04_forumcode.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,227 @@
+#!/usr/bin/perl
+use strict;
+use warnings;
+
+my @forum_tests;
+
+BEGIN {
+    # a list of tests for forumcode()
+    @forum_tests = (
+        # escaped HTML stuff
+        {
+            in  =&gt; '&lt;b&gt;foo&lt;/b&gt; &amp;',
+            out =&gt; '&lt;b&gt;foo&lt;/b&gt; &amp;',
+        },
+        {
+            in  =&gt; '#FF0000',
+            out =&gt; '#FF0000',
+        },
+
+        ## BOLD
+        # [b] tag
+        {
+            in  =&gt; '[b]foo[/b]',
+            out =&gt; '&lt;b&gt;foo&lt;/b&gt;',
+        },
+        {
+            in  =&gt; '[b]foo',
+            out =&gt; '[b]foo',
+        },
+        # **foo** bold magic
+        {
+            in  =&gt; '**foo**',
+            out =&gt; '&lt;b&gt;foo&lt;/b&gt;',
+        },
+        # replace all bold tags
+        {
+            in  =&gt; '[b]foo[/b][b]bar[/b]**baz****quux**',
+            out =&gt; '&lt;b&gt;foo&lt;/b&gt;&lt;b&gt;bar&lt;/b&gt;&lt;b&gt;baz&lt;/b&gt;&lt;b&gt;quux&lt;/b&gt;',
+        },
+
+        ## UNDERLINE
+        # [u] tag
+        {
+            in  =&gt; '[u]foo[/u]',
+            out =&gt; '&lt;u&gt;foo&lt;/u&gt;',
+        },
+        # __foo__ underline magic
+        {
+            in  =&gt; '__foo__',
+            out =&gt; '&lt;u&gt;foo&lt;/u&gt;',
+        },
+        # replace all underline tags
+        {
+            in  =&gt; '[u]foo[/u][u]bar[/u]__baz____quux__',
+            out =&gt; '&lt;u&gt;foo&lt;/u&gt;&lt;u&gt;bar&lt;/u&gt;&lt;u&gt;baz&lt;/u&gt;&lt;u&gt;quux&lt;/u&gt;',
+        },
+
+        ## ITALIC
+        # [i] tag
+        {
+            in  =&gt; '[i]foo[/i]',
+            out =&gt; '&lt;i&gt;foo&lt;/i&gt;',
+        },
+#        # //foo// italic magic
+#        {
+#            in  =&gt; '//foo//',
+#            out =&gt; '&lt;i&gt;foo&lt;/i&gt;',
+#        },
+        # replace all italic tags
+        {
+            in  =&gt; '[i]foo[/i][i]bar[/i]//baz////quux//',
+            out =&gt; '&lt;i&gt;foo&lt;/i&gt;&lt;i&gt;bar&lt;/i&gt;//baz////quux//',
+            #out =&gt; '&lt;i&gt;foo&lt;/i&gt;&lt;i&gt;bar&lt;/i&gt;&lt;i&gt;baz&lt;/i&gt;&lt;i&gt;quux&lt;/i&gt;',
+        },
+
+        # link testing
+        {
+            in  =&gt; '[url]<A HREF="http://www.google.com/[/url">http://www.google.com/[/url</A>]',
+            out =&gt; '&lt;a href=&quot;<A HREF="http://www.google.com/">http://www.google.com/</A>&quot;&gt;<A HREF="http://www.google.com/&lt;/a">http://www.google.com/&lt;/a</A>&gt;',
+        },
+        {
+            in  =&gt; '[url name=&quot;Google&quot;]<A HREF="http://www.google.com/[/url">http://www.google.com/[/url</A>]',
+            out =&gt; '&lt;a href=&quot;<A HREF="http://www.google.com/">http://www.google.com/</A>&quot;&gt;Google&lt;/a&gt;',
+        },
+        {
+            in  =&gt; '[url name=&quot;Google&quot; ]<A HREF="http://www.google.com/[/url">http://www.google.com/[/url</A>]',
+            out =&gt; '&lt;a href=&quot;<A HREF="http://www.google.com/">http://www.google.com/</A>&quot;&gt;Google&lt;/a&gt;',
+        },
+
+        # let people put odd stuff in the name if they really want
+        {
+            in  =&gt; '[url name=&quot;&quot;&quot;&quot;]X[/url]',
+            out =&gt; '&lt;a href=&quot;X&quot;&gt;&quot;&quot;&lt;/a&gt;',
+        },
+
+        # not proper URL tags
+        {
+            in  =&gt; '[url name=&quot;]X[/url]',
+            out =&gt; '[url name=&quot;]X[/url]',
+        },
+        {
+            in  =&gt; '[url name=]X[/url]',
+            out =&gt; '[url name=]X[/url]',
+        },
+        # nothing between opening and closing tags
+        {
+            in  =&gt; '[url][/url]',
+            out =&gt; '[url][/url]',
+        },
+
+        # bold in the URL name ..
+        {
+            in  =&gt; '[url name=&quot;[b]Bold[/b]&quot;]X[/url]',
+            out =&gt; '&lt;a href=&quot;X&quot;&gt;&lt;b&gt;Bold&lt;/b&gt;&lt;/a&gt;',
+        },
+
+        # url with query params ...
+        # surprisingly the escaped query-string seems to be dealt with
+        # correctly (in forefox at least)
+        {
+            in      =&gt; '[url name=&quot;X&quot;]<A HREF="http://google.com?q=Foo&amp;something=Bar[/url">http://google.com?q=Foo&amp;something=Bar[/url</A>]',
+            out     =&gt; '&lt;a href=&quot;<A HREF="http://google.com?q=Foo&amp;amp;something=Bar">http://google.com?q=Foo&amp;something=Bar</A>&quot;&gt;X&lt;/a&gt;',
+            diag    =&gt; 'Test this URL in browsers!',
+        },
+
+        # image tag
+        {
+            in  =&gt; '[img]<A HREF="http://somewhere.com/myImage.jpg[/img">http://somewhere.com/myImage.jpg[/img</A>]',
+            out =&gt; '&lt;img src=&quot;<A HREF="http://somewhere.com/myImage.jpg">http://somewhere.com/myImage.jpg</A>&quot; /&gt;',
+        },
+        {
+            in      =&gt; q{[img alt='Foo']<A HREF="http://somewhere.com/myImage.jpg[/img">http://somewhere.com/myImage.jpg[/img</A>]},
+            out     =&gt; q{&lt;img src=&quot;<A HREF="http://somewhere.com/myImage.jpg">http://somewhere.com/myImage.jpg</A>&quot; alt='Foo' /&gt;},
+            diag    =&gt; 'Test this URL in browsers!',
+        },
+        {
+            in      =&gt; q{[img alt=&quot;Foo&quot;]<A HREF="http://somewhere.com/myImage.jpg[/img">http://somewhere.com/myImage.jpg[/img</A>]},
+            out     =&gt; q{&lt;img src=&quot;<A HREF="http://somewhere.com/myImage.jpg">http://somewhere.com/myImage.jpg</A>&quot; alt=&quot;Foo&quot; /&gt;},
+            diag    =&gt; 'Test this URL in browsers!',
+        },
+
+        {
+            in      =&gt;q{One:
+[img]<A HREF="http://localhost:3000/static/images/btn_88x31_powered.png[/img">http://localhost:3000/static/images/btn_88x31_powered.png[/img</A>]
+And another:
+[img]<A HREF="http://localhost:3000/static/images/btn_88x31_powered.png[/img">http://localhost:3000/static/images/btn_88x31_powered.png[/img</A>]},
+            out     =&gt; q{One:&lt;br /&gt;&lt;img src=&quot;<A HREF="http://localhost:3000/static/images/btn_88x31_powered.png">http://localhost:3000/static/images/btn_88x31_powered.png</A>&quot; /&gt;&lt;br /&gt;And another:&lt;br /&gt;&lt;img src=&quot;<A HREF="http://localhost:3000/static/images/btn_88x31_powered.png">http://localhost:3000/static/images/btn_88x31_powered.png</A>&quot; /&gt;},
+        },
+
+
+        # colouring
+        {
+            in      =&gt; q{[colour=red]Red Text[/colour]},
+            out     =&gt; q{&lt;span style=&quot;color: red&quot;&gt;Red Text&lt;/span&gt;},
+        },
+        {
+            in      =&gt; q{[colour=#FF0000]Red Text[/colour]},
+            out     =&gt; q{&lt;span style=&quot;color: #FF0000&quot;&gt;Red Text&lt;/span&gt;},
+        },
+        {
+            in      =&gt; q{[colour=#F00]Red Text[/colour]},
+            out     =&gt; q{&lt;span style=&quot;color: #F00&quot;&gt;Red Text&lt;/span&gt;},
+        },
+        {
+            in      =&gt; q{[colour=OrAnge]OrAnge Text[/colour]},
+            out     =&gt; q{&lt;span style=&quot;color: OrAnge&quot;&gt;OrAnge Text&lt;/span&gt;},
+        },
+        # coloring - for the Merkins
+        {
+            in      =&gt; q{[color=red]Red Text[/color]},
+            out     =&gt; q{&lt;span style=&quot;color: red&quot;&gt;Red Text&lt;/span&gt;},
+        },
+        {
+            in      =&gt; q{[color=#FF0000]Red Text[/color]},
+            out     =&gt; q{&lt;span style=&quot;color: #FF0000&quot;&gt;Red Text&lt;/span&gt;},
+        },
+        {
+            in      =&gt; q{[color=#F00]Red Text[/color]},
+            out     =&gt; q{&lt;span style=&quot;color: #F00&quot;&gt;Red Text&lt;/span&gt;},
+        },
+        {
+            in      =&gt; q{[color=OrAnge]OrAnge Text[/color]},
+            out     =&gt; q{&lt;span style=&quot;color: OrAnge&quot;&gt;OrAnge Text&lt;/span&gt;},
+        },
+
+
+        # lists
+        # unordered
+        {
+            in      =&gt; q{[list]
+            [*]Red
+            [*]Blue
+            [*]Yellow
+            [/list]},
+            out     =&gt; q{&lt;ul&gt;&lt;li&gt;Red&lt;/li&gt;&lt;li&gt;Blue&lt;/li&gt;&lt;li&gt;Yellow&lt;/li&gt;&lt;/ul&gt;},
+        },
+        # ordered
+        {
+            in      =&gt; q{[list]
+            [1]Red
+            [1]Blue
+            [1]Yellow
+            [/list]},
+            out     =&gt; q{&lt;ol&gt;&lt;li&gt;Red&lt;/li&gt;&lt;li&gt;Blue&lt;/li&gt;&lt;li&gt;Yellow&lt;/li&gt;&lt;/ol&gt;},
+        },
+    );
+
+    # test count is a fixed number of tests + the length of the @tests array
+    use Test::More;
+    plan tests =&gt; ( 3 + scalar(@forum_tests) );
+
+    use_ok( 'Template::Plugin::ForumCode' );
+};
+
+# create a new thingy
+my $tt_forum = Template::Plugin::ForumCode-&gt;new();
+isnt(undef, $tt_forum, 'Plugin object is defined');
+isa_ok($tt_forum, 'Template::Plugin::ForumCode');
+
+# now some formatting tests for forumcode()
+foreach my $test (@forum_tests) {
+    my $text = $tt_forum-&gt;forumcode($test-&gt;{in});
+    if (defined $test-&gt;{diag}) {
+        diag(&quot;$test-&gt;{out} - $test-&gt;{diag}&quot;);
+    }
+    is($text, $test-&gt;{out}, qq{forumcode('$test-&gt;{in}')});
+}

Added: tags/parley-0.55/t/50.text_search.sql.t
===================================================================
--- tags/parley-0.55/t/50.text_search.sql.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/50.text_search.sql.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,212 @@
+#!/usr/bin/env perl
+# vim: ts=8 sts=4 et sw=4 sr sta
+use strict;
+use warnings;
+use Data::Dump qw(pp);
+
+use Test::More tests =&gt; 42;
+
+BEGIN {
+    use_ok('Text::Search::SQL');
+}
+
+# GLOBAL VARIABLES
+my ($sp);
+
+# make sure we offer the expected methods in the interface
+can_ok('Text::Search::SQL',
+    qw[
+        new
+        set_search_term
+        get_search_term
+        set_search_fields
+        get_search_fields
+        set_search_type
+        get_search_type
+        set_chunks
+        get_chunks
+        set_sql_where
+        get_sql_where
+        parse
+
+        _parse_chunks
+    ]
+);
+
+# get a new instance of the object, name sure it's what we're expecting
+$sp = Text::Search::SQL-&gt;new();
+isa_ok($sp, q{Text::Search::SQL});
+
+# calling with no argument means we should have default attributes
+is( $sp-&gt;{search_term}, undef, q{undefined search_term} );
+
+# create a new object with a search_term in the call to new
+$sp = Text::Search::SQL-&gt;new(
+    {
+        search_term =&gt; 'one man'
+    }
+);
+isa_ok($sp, q{Text::Search::SQL});
+
+# calling with no argument means we should have default attributes
+is( $sp-&gt;{search_term}, q{one man}, q{search_term is 'one man'} );
+
+# using set_search_term() gives expected results
+$sp-&gt;set_search_term('went to mow');
+is( $sp-&gt;{search_term}, q{went to mow}, q{search_term is 'went to mow'} );
+
+# data to loop through for _parse_chunks() and parse() tests
+my @data = (
+    {
+        input   =&gt; q{isn't},
+        parse  =&gt; [ q{isn't} ],
+
+        search_fields   =&gt; [ qw/subject/ ],
+        sql_where       =&gt; [
+            subject =&gt; { '=' =&gt; [ q{isn't} ] },
+        ],
+    },
+    {
+        input   =&gt; q{went to mow},
+        parse  =&gt; ['went', 'to', 'mow'],
+
+        search_fields   =&gt; [ qw/subject/ ],
+        sql_where       =&gt; [
+            subject =&gt; { '=' =&gt; [ qw(went to mow) ] },
+        ],
+    },
+    {
+        input   =&gt; q{&quot;went to&quot; mow},
+        parse  =&gt; ['went to', 'mow'],
+
+        search_fields   =&gt; [ qw/subject/ ],
+        sql_where       =&gt; [
+            subject =&gt; { '=' =&gt; [ q{went to}, q{mow} ] },
+        ],
+    },
+    {
+        input   =&gt; q{'went to' mow},
+        parse  =&gt; [ q{'went}, q{to'}, q{mow} ],
+    },
+    {
+        input   =&gt; q{'went to' &quot;mow a meadow&quot;},
+        parse  =&gt; [ q{'went}, q{mow a meadow}, q{to'}],
+    },
+    {
+        input   =&gt; q{went to' mow a meadow&quot;},
+        parse  =&gt; [ q{a}, q{meadow&quot;}, q{mow}, q{to'}, q{went} ],
+    },
+    {
+        input   =&gt; q{went to' mow a &quot;meadow&quot;'},
+        parse  =&gt; [ q{'}, q{a}, q{meadow}, q{mow}, q{to'}, q{went} ],
+    },
+    {
+        input   =&gt; q{went to&quot; mow a 'meadow'&quot;},
+        parse  =&gt; [ q{ mow a 'meadow'}, q{to}, q{went} ],
+    },
+    {
+        input   =&gt; q{isn't it nice to be here?},
+        parse  =&gt; [ q{isn't}, q{it}, q{nice}, q{to}, q{be}, q{here?} ],
+    },
+    {
+        input   =&gt; q{&quot;isn't it nice to be here?&quot;},
+        parse  =&gt; [ q{isn't it nice to be here?} ],
+    },
+
+    # some tests geared to the returned where data
+    {
+        input   =&gt; q{alpha beta},
+        parse  =&gt; [ qw(alpha beta) ],
+
+        search_fields   =&gt; [ qw(subject) ],
+        sql_where       =&gt; [
+            subject =&gt; { '=' =&gt; [ qw(alpha beta) ] },
+        ],
+    },
+    {
+        input   =&gt; q{alpha beta},
+        parse  =&gt; [ qw(alpha beta) ],
+
+        search_fields   =&gt; [ qw(subject message) ],
+        sql_where       =&gt; [
+            subject =&gt; { '=' =&gt; [ qw(alpha beta) ] },
+            message =&gt; { '=' =&gt; [ qw(alpha beta) ] },
+        ],
+    },
+
+    # search type tests
+    {
+        input   =&gt; q{haven't},
+        chunks  =&gt; [ q{haven't} ],
+        parse   =&gt; [ q{%haven't%} ],
+
+        search_fields   =&gt; [ qw/subject/ ],
+        search_type     =&gt; q{like},
+        sql_where       =&gt; [
+            subject =&gt; { 'like' =&gt; [ q{%haven't%} ] },
+        ],
+    },
+    {
+        input   =&gt; q{alpha beta gamma},
+        parse   =&gt; [ qw(alpha beta gamma) ],
+
+        search_fields   =&gt; [ qw(subject message) ],
+        search_type     =&gt; q{like},
+        sql_where       =&gt; [
+            subject =&gt; { 'like' =&gt; [ qw(%alpha% %beta% %gamma%) ] },
+            message =&gt; { 'like' =&gt; [ qw(%alpha% %beta% %gamma%) ] },
+        ],
+    },
+);
+
+# tests for _parse_chunks()
+foreach my $data (@data) {
+    # _parse_chunks()
+    my $chunks = $sp-&gt;_parse_chunks( $data-&gt;{input} );
+    my $expected = $data-&gt;{chunks} || $data-&gt;{parse};
+
+    is_deeply(
+        [ sort @{ $chunks } ],
+        [ sort @{ $expected } ],
+        qq{_parse_chunks: $data-&gt;{input}}
+    );
+
+    # check where clause meets our expectation
+    if (defined $data-&gt;{search_fields}) {
+        $sp-&gt;set_search_fields( $data-&gt;{search_fields} );
+    }
+
+    # parse()
+    $sp-&gt;set_search_term( $data-&gt;{input} );
+    # if we have a search_type, set it
+    if (defined $data-&gt;{search_type}) {
+        $sp-&gt;set_search_type( $data-&gt;{search_type} );
+        is (
+            $sp-&gt;get_search_type(),
+            $data-&gt;{search_type},
+            qq{search_type set correctly for $data-&gt;{input}}
+        )
+    };
+    $sp-&gt;parse();
+    # if we're not doing a like search, we should have matching chunks
+    if( not defined $data-&gt;{search_type}
+            or
+        $data-&gt;{search_type} !~ m{\A(?:like|ilike)\z}xms
+    ) {
+        is_deeply(
+            $sp-&gt;{chunks},
+            $chunks,
+            qq{\$sp-&gt;{chunks} matches _parse_chunks($data-&gt;{input})}
+        );
+    }
+
+    # where clause
+    if (defined $data-&gt;{sql_where}) {
+        is_deeply(
+            $sp-&gt;get_sql_where(),
+            $data-&gt;{sql_where},
+            qq{correct where data for $data-&gt;{input}},
+        );
+    }
+}
+

Added: tags/parley-0.55/t/controller_Admin.t
===================================================================
--- tags/parley-0.55/t/controller_Admin.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_Admin.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::Admin' }
+
+ok( request('/admin')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_Forum.t
===================================================================
--- tags/parley-0.55/t/controller_Forum.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_Forum.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::Forum' }
+
+ok( request('/forum')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_Help.t
===================================================================
--- tags/parley-0.55/t/controller_Help.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_Help.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::Help' }
+
+ok( request('/help')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_My.t
===================================================================
--- tags/parley-0.55/t/controller_My.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_My.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::My' }
+
+ok( request('/my')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_Post.t
===================================================================
--- tags/parley-0.55/t/controller_Post.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_Post.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::Post' }
+
+ok( request('/post')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_Search.t
===================================================================
--- tags/parley-0.55/t/controller_Search.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_Search.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::Search' }
+
+ok( request('/search')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_Thread.t
===================================================================
--- tags/parley-0.55/t/controller_Thread.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_Thread.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::Thread' }
+
+ok( request('/thread')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/controller_User.t
===================================================================
--- tags/parley-0.55/t/controller_User.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/controller_User.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,10 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 3;
+
+BEGIN { use_ok 'Catalyst::Test', 'Parley' }
+BEGIN { use_ok 'Parley::Controller::User' }
+
+ok( request('/user')-&gt;is_success, 'Request should succeed' );
+
+

Added: tags/parley-0.55/t/model_ParleyDB.t
===================================================================
--- tags/parley-0.55/t/model_ParleyDB.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/model_ParleyDB.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 1;
+
+BEGIN { use_ok 'Parley::Model::ParleyDB' }
+

Added: tags/parley-0.55/t/view_Plain.t
===================================================================
--- tags/parley-0.55/t/view_Plain.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/view_Plain.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 1;
+
+BEGIN { use_ok 'Parley::View::Plain' }
+

Added: tags/parley-0.55/t/view_TT.t
===================================================================
--- tags/parley-0.55/t/view_TT.t	2007-08-31 19:18:19 UTC (rev 456)
+++ tags/parley-0.55/t/view_TT.t	2007-08-31 19:18:32 UTC (rev 457)
@@ -0,0 +1,6 @@
+use strict;
+use warnings;
+use Test::More tests =&gt; 1;
+
+BEGIN { use_ok 'Parley::View::TT' }
+


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000342.html">[Parley-svn] r456 - / trunk trunk/lib
</A></li>
	<LI>Next message: <A HREF="000344.html">[Parley-svn] r458 - / trunk trunk/lib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#350">[ date ]</a>
              <a href="thread.html#350">[ thread ]</a>
              <a href="subject.html#350">[ subject ]</a>
              <a href="author.html#350">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/parley-svn">More information about the Parley-svn
mailing list</a><br>
</body></html>
