<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Parley-svn] r953 - / trunk/root/static trunk/t
   </TITLE>
   <LINK REL="Index" HREF="http://lists.berlios.de/pipermail/parley-svn/2008-October/index.html" >
   <LINK REL="made" HREF="mailto:parley-svn%40lists.berlios.de?Subject=Re%3A%20%5BParley-svn%5D%20r953%20-%20/%20trunk/root/static%20trunk/t&In-Reply-To=%3C200810091359.m99DxwcC030732%40sheep.berlios.de%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000835.html">
   <LINK REL="Next"  HREF="000837.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Parley-svn] r953 - / trunk/root/static trunk/t</H1>
    <B>chiselwright at BerliOS</B> 
    <A HREF="mailto:parley-svn%40lists.berlios.de?Subject=Re%3A%20%5BParley-svn%5D%20r953%20-%20/%20trunk/root/static%20trunk/t&In-Reply-To=%3C200810091359.m99DxwcC030732%40sheep.berlios.de%3E"
       TITLE="[Parley-svn] r953 - / trunk/root/static trunk/t">chiselwright at mail.berlios.de
       </A><BR>
    <I>Thu Oct  9 15:59:58 CEST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="000835.html">[Parley-svn] r952 - / tags/parley-0.53 tags/parley-0.53/db tags/parley-0.53/lib tags/parley-0.53/lib/Parley/Controller tags/parley-0.53/lib/Parley/Controller/User tags/parley-0.53/lib/Parley/Schema tags/parley-0.53/lib/Template/Plugin tags/parley-0.53/root/base/forum tags/parley-0.53/root/base/menu tags/parley-0.53/root/base/menu/left tags/parley-0.53/root/base/my tags/parley-0.53/root/base/thread tags/parley-0.53/root/css tags/parley-0.53/root/static/magic tags/parley-0.53/root/static/magic/src tags/parley-0.53/root/static/magic/src/animation tags/parley-0.53/root/static/magic/src/collections tags/parley-0.53/root/static/magic/src/compat tags/parley-0.53/root/static/magic/src/crypto tags/parley-0.53/root/static/magic/src/data tags/parley-0.53/root/static/magic/src/data/format tags/parley-0.53/root/static/magic/src/data/provider tags/parley-0.53/root/static/magic/src/debug tags/parley-0.53/root/static/magic/src/dnd tags/parley-0.53/root/static/magic/src/event tags/parley-0.53/ro! ot/static/magic/src/flash/flash6 tags/parley-0.53/root/static/magic/src/fx tags/parley-0.53/root/static/magic/src/graphics tags/parley-0.53/root/static/magic/src/graphics/color tags/parley-0.53/root/static/magic/src/html tags/parley-0.53/root/static/magic/src/html/images tags/parley-0.53/root/static/magic/src/i18n tags/parley-0.53/root/static/magic/src/io tags/parley-0.53/root/static/magic/src/lang tags/parley-0.53/root/static/magic/src/lfx tags/parley-0.53/root/static/magic/src/logging tags/parley-0.53/root/static/magic/src/math tags/parley-0.53/root/static/magic/src/reflect tags/parley-0.53/root/static/magic/src/rpc tags/parley-0.53/root/static/magic/src/selection tags/parley-0.53/root/static/magic/src/storage tags/parley-0.53/root/static/magic/src/string tags/parley-0.53/root/static/magic/src/text tags/parley-0.53/root/static/magic/src/undo tags/parley-0.53/root/static/magic/src/uri tags/parley-0.53/root/static/magic/src/uuid tags/parley-0.53/root/static/magic/src/valida! te tags/parley-0.53/root/static/magic/src/widget tags/parley-0! .53/root
</A></li>
        <LI>Next message: <A HREF="000837.html">[Parley-svn] r954 - / trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#836">[ date ]</a>
              <a href="thread.html#836">[ thread ]</a>
              <a href="subject.html#836">[ subject ]</a>
              <a href="author.html#836">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Author: chiselwright
Date: 2008-10-09 15:59:58 +0200 (Thu, 09 Oct 2008)
New Revision: 953

Modified:
   /
   trunk/root/static/MessagePreview-min.js
   trunk/root/static/MessagePreview.js
   trunk/t/04_forumcode.t
Log:
 <A HREF="https://lists.berlios.de/mailman/listinfo/parley-svn">r8271 at wiggin</A>:  chisel | 2008-10-08 19:21:18 +0100
 + added ForumCode test for string containing '+'
 + added MessagePreview fix for messages containing '+' symbols (vanish in preview, and re-appear in post)



Property changes on: 
___________________________________________________________________
Name: svk:merge
   - 6a361f96-f029-0410-94f8-848cdd0f6ccf:/local/parley:8204
6fba2e3f-c318-0410-85fa-910d1bc53201:/local/parley:5151
c0683b51-46fc-0310-adae-a083e7ee0929:/local/berlios/parley:15762
f1659af6-751b-0410-a472-c93ec2bf8afc:/local/parley:1222
   + 6a361f96-f029-0410-94f8-848cdd0f6ccf:/local/parley:8271
6fba2e3f-c318-0410-85fa-910d1bc53201:/local/parley:5151
c0683b51-46fc-0310-adae-a083e7ee0929:/local/berlios/parley:15762
f1659af6-751b-0410-a472-c93ec2bf8afc:/local/parley:1222

Modified: trunk/root/static/MessagePreview-min.js
===================================================================
--- trunk/root/static/MessagePreview-min.js	2008-10-08 11:42:12 UTC (rev 952)
+++ trunk/root/static/MessagePreview-min.js	2008-10-09 13:59:58 UTC (rev 953)
@@ -1 +1 @@
-(function(){ParleyMessagePreview=function(){var Dom=YAHOO.util.Dom,YU=YAHOO.util;this.config={trigger:&quot;message_preview&quot;,user_input:&quot;thread_message&quot;,container:&quot;message_container&quot;,trigger_evt:&quot;click&quot;,post_url:&quot;post/preview&quot;,label_edit:&quot;Edit&quot;,label_preview:&quot;Preview&quot;};this.message_source=false;this.message_preview=false;this.handleSuccess=function(o){var data=eval(&quot;(&quot;+o.responseText+&quot;)&quot;);var obj=o.argument.obj;if(data.formatted){obj.previewElId=YU.Dom.generateId();obj.user_input.style.visibility=&quot;hidden&quot;;var pWidth=obj.user_input.clientWidth,pHeight=obj.user_input.clientHeight,pLeft=obj.user_input.offsetLeft,pTop=obj.user_input.offsetTop;obj.preview_overlay=new YAHOO.widget.Overlay(&quot;preview_overlay&quot;,{context:[obj.config.user_input,&quot;tl&quot;,&quot;tl&quot;],visible:true,width:obj.user_input.clientWidth+&quot;px&quot;,height:obj.user_input.clientHeight+&quot;px&quot;});obj.preview_overlay.setBody(data.formatted);obj.preview_overlay.render(document.body);Dom.get(&quot;preview_overlay&quot;).style.overflow=&quot;auto&quot;;obj.trigger.!
 value=obj.config.label_edit;YU.Event.removeListener(obj.trigger,&quot;click&quot;);YU.Event.addListener(obj.trigger,obj.config.trigger_evt,obj.edit,obj,true)}};this.handleFailure=function(o){console.log(&quot;failure&quot;)};this.edit=function(){this.trigger.value=this.config.label_preview;this.user_input.style.visibility=&quot;visible&quot;;this.preview_overlay.destroy();YU.Event.removeListener(this.trigger,&quot;click&quot;);YU.Event.addListener(this.trigger,this.config.trigger_evt,this.preview,this,true)};this.preview=function(){var request=YU.Connect.asyncRequest(&quot;POST&quot;,this.config.post_url,{success:this.handleSuccess,failure:this.handleFailure,argument:{obj:this}},&quot;msg_source=&quot;+escape(this.user_input.value))};this.init=function(){this.container=Dom.get(this.config.container);this.user_input=Dom.get(this.config.user_input);this.trigger=Dom.get(this.config.trigger);YU.Event.addListener(this.trigger,this.config.trigger_evt,this.preview,this,true)}}})();
\ No newline at end of file
+(function(){ParleyMessagePreview=function(){var Dom=YAHOO.util.Dom,YU=YAHOO.util;this.config={trigger:&quot;message_preview&quot;,user_input:&quot;thread_message&quot;,container:&quot;message_container&quot;,trigger_evt:&quot;click&quot;,post_url:&quot;post/preview&quot;,label_edit:&quot;Edit&quot;,label_preview:&quot;Preview&quot;};this.message_source=false;this.message_preview=false;this.handleSuccess=function(o){var data=eval(&quot;(&quot;+o.responseText+&quot;)&quot;);var obj=o.argument.obj;if(data.formatted){obj.previewElId=YU.Dom.generateId();obj.user_input.style.visibility=&quot;hidden&quot;;var pWidth=obj.user_input.clientWidth,pHeight=obj.user_input.clientHeight,pLeft=obj.user_input.offsetLeft,pTop=obj.user_input.offsetTop;obj.preview_overlay=new YAHOO.widget.Overlay(&quot;preview_overlay&quot;,{context:[obj.config.user_input,&quot;tl&quot;,&quot;tl&quot;],visible:true,width:obj.user_input.clientWidth+&quot;px&quot;,height:obj.user_input.clientHeight+&quot;px&quot;});obj.preview_overlay.setBody(data.formatted);obj.preview_overlay.render(document.body);Dom.get(&quot;preview_overlay&quot;).style.overflow=&quot;auto&quot;;obj.trigger.!
 value=obj.config.label_edit;YU.Event.removeListener(obj.trigger,&quot;click&quot;);YU.Event.addListener(obj.trigger,obj.config.trigger_evt,obj.edit,obj,true)}};this.handleFailure=function(o){console.log(&quot;failure&quot;)};this.edit=function(){this.trigger.value=this.config.label_preview;this.user_input.style.visibility=&quot;visible&quot;;this.preview_overlay.destroy();YU.Event.removeListener(this.trigger,&quot;click&quot;);YU.Event.addListener(this.trigger,this.config.trigger_evt,this.preview,this,true)};this.preview=function(){var msgSource=escape(this.user_input.value);msgSource=msgSource.replace(/\+/g,&quot;%2b&quot;);var request=YU.Connect.asyncRequest(&quot;POST&quot;,this.config.post_url,{success:this.handleSuccess,failure:this.handleFailure,argument:{obj:this}},&quot;msg_source=&quot;+msgSource)};this.init=function(){this.container=Dom.get(this.config.container);this.user_input=Dom.get(this.config.user_input);this.trigger=Dom.get(this.config.trigger);YU.Event.addListener(this.trigger,this.config.trigger_evt,this.preview,this,true)}!
 }})();
\ No newline at end of file

Modified: trunk/root/static/MessagePreview.js
===================================================================
--- trunk/root/static/MessagePreview.js	2008-10-08 11:42:12 UTC (rev 952)
+++ trunk/root/static/MessagePreview.js	2008-10-09 13:59:58 UTC (rev 953)
@@ -114,6 +114,11 @@
         };
 
         this.preview = function() {
+            /* we need to escape the string */
+            /* we also need to (separately) escape '+' during submission */
+            var msgSource = escape(this.user_input.value);
+            msgSource = msgSource.replace(/\+/g, '%2b');
+
             var request = YU.Connect.asyncRequest(
                 'POST',
                 this.config.post_url, //'post/preview',
@@ -124,7 +129,7 @@
                         obj: this
                     }
                 },
-                'msg_source=' + escape(this.user_input.value)
+                'msg_source=' + msgSource
             );
         };
 

Modified: trunk/t/04_forumcode.t
===================================================================
--- trunk/t/04_forumcode.t	2008-10-08 11:42:12 UTC (rev 952)
+++ trunk/t/04_forumcode.t	2008-10-09 13:59:58 UTC (rev 953)
@@ -16,6 +16,10 @@
             in  =&gt; '#FF0000',
             out =&gt; '#FF0000',
         },
+        {
+            in  =&gt; '1 + 2',
+            out =&gt; '1 + 2',
+        },
 
         ## BOLD
         # [b] tag


</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000835.html">[Parley-svn] r952 - / tags/parley-0.53 tags/parley-0.53/db tags/parley-0.53/lib tags/parley-0.53/lib/Parley/Controller tags/parley-0.53/lib/Parley/Controller/User tags/parley-0.53/lib/Parley/Schema tags/parley-0.53/lib/Template/Plugin tags/parley-0.53/root/base/forum tags/parley-0.53/root/base/menu tags/parley-0.53/root/base/menu/left tags/parley-0.53/root/base/my tags/parley-0.53/root/base/thread tags/parley-0.53/root/css tags/parley-0.53/root/static/magic tags/parley-0.53/root/static/magic/src tags/parley-0.53/root/static/magic/src/animation tags/parley-0.53/root/static/magic/src/collections tags/parley-0.53/root/static/magic/src/compat tags/parley-0.53/root/static/magic/src/crypto tags/parley-0.53/root/static/magic/src/data tags/parley-0.53/root/static/magic/src/data/format tags/parley-0.53/root/static/magic/src/data/provider tags/parley-0.53/root/static/magic/src/debug tags/parley-0.53/root/static/magic/src/dnd tags/parley-0.53/root/static/magic/src/event tags/parley-0.53/ro! ot/static/magic/src/flash/flash6 tags/parley-0.53/root/static/magic/src/fx tags/parley-0.53/root/static/magic/src/graphics tags/parley-0.53/root/static/magic/src/graphics/color tags/parley-0.53/root/static/magic/src/html tags/parley-0.53/root/static/magic/src/html/images tags/parley-0.53/root/static/magic/src/i18n tags/parley-0.53/root/static/magic/src/io tags/parley-0.53/root/static/magic/src/lang tags/parley-0.53/root/static/magic/src/lfx tags/parley-0.53/root/static/magic/src/logging tags/parley-0.53/root/static/magic/src/math tags/parley-0.53/root/static/magic/src/reflect tags/parley-0.53/root/static/magic/src/rpc tags/parley-0.53/root/static/magic/src/selection tags/parley-0.53/root/static/magic/src/storage tags/parley-0.53/root/static/magic/src/string tags/parley-0.53/root/static/magic/src/text tags/parley-0.53/root/static/magic/src/undo tags/parley-0.53/root/static/magic/src/uri tags/parley-0.53/root/static/magic/src/uuid tags/parley-0.53/root/static/magic/src/valida! te tags/parley-0.53/root/static/magic/src/widget tags/parley-0! .53/root
</A></li>
	<LI>Next message: <A HREF="000837.html">[Parley-svn] r954 - / trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#836">[ date ]</a>
              <a href="thread.html#836">[ thread ]</a>
              <a href="subject.html#836">[ subject ]</a>
              <a href="author.html#836">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://lists.berlios.de/mailman/listinfo/parley-svn">More information about the Parley-svn
mailing list</a><br>
</body></html>
